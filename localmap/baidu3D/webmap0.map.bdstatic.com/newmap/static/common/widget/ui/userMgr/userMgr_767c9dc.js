define("common:widget/ui/userMgr/userMgr.js",function(e,i,t){function a(e){var i=e.split("@");return i[0].length<3?e:(i[0]=i[0].charAt(0)+i[0].charAt(1)+"****"+i[0].charAt(i[0].length-1),i[0]+"@"+i[1])}function s(e){return e.substr(0,3)+"*****"+e.substr(e.length-3)}function n(e){if(!e)return"";var i="",t=e.uName,n=e.email,o=e.mobile;e.incomplete&&(t=e.displayname),t?i=t:n?i=a(n):o&&(i=s(o)),"thirdappid"in e&&!e.uName&&!e.email&&!e.mobile&&(i='<img src="http://passport.bdimg.com/passApi/img/icon_'+e.thirdappid+'_16.png" style="vertical-align:middle;padding-right:2px">'+i);var l=['<ul><li id="usernameInfo" style="height:22px;" class="uname mn-lk-w">'];return l.push(e.uName?'<a id="username" class="mn-lk" target="_blank" href="../../../../../../../map.baidu.com/ugc/user/index.htm"/*tpa=http://map.baidu.com/ugc/user/index*/>'+i+"<em></em></a>":'<a id="username" class="mn-lk" href="https://passport.baidu.com/v2/?ucenteradduname">'+i+"<em></em></a>"),l.push('<div id="popUserInfoId" style="width:80px;right:0;visibility:hidden;" class="mn-tip"><ul class="mn"><li>'),l.push(e.uName?'<a class="my-info" target="_blank" href="../../../../../../../map.baidu.com/ugc/user/index.htm"/*tpa=http://map.baidu.com/ugc/user/index*/>我的主页</a>':'<a class="my-info" href="https://passport.baidu.com/v2/?ucenteradduname">我的主页</a>'),l.push('</li><li><a class="my-info" href="'+p+'">帐号设置</a></li><li><a class="logout" href="javascript:void(0)">退出</a></li></ul></div>'),l.push('<li class="line">|</li>'),l.push('<li class="book-order"><a class="action" href="javascript:void(0);" >&nbsp;订单查询<em></em></a></li>'),l.push('<li class="line">|</li>'),l.push('<li><a href="http://nlbc.baidu.com/lbs-lbc/?from=maptop" target="_blank" class="lbc_txt">商户免费标注</a><a href="http://developer.baidu.com/map/" target="_blank" >地图API</a></li>'),l.push('<li class="line">|</li>'),l.push('<li><a href="http://www.baidu.com/"  target="_blank" >百度首页</a></li>'),l.join("")}function o(){v?v.show():r.getLink(function(e){baidu.sio(u+"passApi/js/uni_login_wrapper.js?cdnversion="+(new Date).getTime()).callByBrowser(function(){baidu.g("passport-login-pop")||(v=passport.pop.init({apiOpt:{staticPage:m,product:"ma",charset:"utf-8",u:e||location.href,memberPass:!0,safeFlag:0},cache:!1,authsite:b,authsiteCfg:{act:"implicit",u:e||location.href},tangram:!0}),v.show())})})}function l(e,i){var t=_++;e.innerHTML='<ul class="login-tab">                 <li class="tab-item tab-item-left tab-selected">                     <a href="#" onclick="return false;" hidefocus="true">普通登录</a>                 </li>                 <li class="tab-item tab-item-right">                     <a href="#" onclick="return false;" hidefocus="true">手机登录</a>                 </li>            </ul>            <div id="ss_pass_login_form'+t+'" class="tang-pass-loginPanel"></div>            <div id="otherLogin'+t+'" class="pass-phoenix-list" style="margin-left:55px;"></div>            <div class="nopass">没有百度帐号？<a href="https://passport.baidu.com/v2/?reg&regType=1&tpl=ma" target="_blank">立即注册</a></div>',baidu.sio(u+"phoenix/account/jsapi?a="+(new Date).getTime()).callByBrowser(function(){baidu.phoenix.require(b,{target:"otherLogin"+t,tpl:"map",act:"implicit",html:{tsina:"新浪微博",renren:"人人网",qzone:"qq号",tqq:"腾讯微博"},u:i||location.href})}),baidu.sio(u+"passApi/js/wrapper.js?cdnversion="+(new Date).getTime()).callByBrowser(function(){function e(e,i){i.children("li").each(function(t){baidu(this).click(function(a){a.preventDefault(),i.children("li").removeClass("tab-selected"),baidu(this).addClass("tab-selected"),e.switchTo(["normal","phone"][t])})})}passport.use("login",{tangram:!1},function(a){var s=new a.passport.login({product:"map",staticPage:m,u:i||location.href,charset:"",memberPass:!0,safeFlag:0});s.on("loginSuccess",function(){top.location.reload()}),baidu("#ss_pass_login_form"+t).html(""),s.render("ss_pass_login_form"+t),e(s,baidu("#ss_pass_login_form"+t).prevAll("ul.login-tab"))})})}var r=e("common:widget/ui/mapShare/MapShare.js"),u="https://passport.baidu.com/",c="../../../../../../../map.baidu.com/-qt=ssn"/*tpa=http://map.baidu.com/?qt=ssn*/,p="http://passport.baidu.com/?center&tpl=ma&aid=7&default_tab=4",d="&tpl=ma",m="http://"+location.host+"/v3Jump.html",h="1",f="0",g=['<ul class="order-list">','<li><a target="_blank" class="order-list-movie" href="http://webmap0.map.bdstatic.com/detail?qt=orderlist&type=movie">电影订单</a></li>',"</ul>"].join("");if(6==T.browser.ie||7==T.browser.ie)var b=["tsina","renren","tqq"];else var b=["qzone","tsina","renren","tqq"];var v,_=0,w={loginStatus:!1,init:function(e){this.update({onsuccess:function(){e&&e()}}),this.generateOrder()},generateOrder:function(){var e;baidu.dom("#user_info").delegate(".book-order","mouseenter",function(){var i=baidu(this).find(".order-list");e&&clearTimeout(e),0==i.length&&(i=baidu(this).append(baidu(g))),i.show()}).delegate(".book-order","mouseleave",function(){var i=baidu(this).find(".order-list");i.length>0&&(e=setTimeout(function(){i.hide()},50))}).delegate(".order-list-hotel","click",function(){var e=w.userState&&w.userState.isOnline||"0";window.addStat(1,{da_src:"inf.order_hotel",from:"map",user:e})})},getState:function(e){T.jsonp(c,function(i){i&&e(i)})},login:function(e,i){e?l(e,i):o()},logout:function(){r.getLink(function(e){window.location.href=u+"?logout"+d+"&u="+encodeURIComponent(e)})},update:function(e){e=e||{};var i=this,t=(T.g("login"),T.g("logout_user_info")),a=T.g("login_user_info");T("#login").on("click",function(e){e=window.event||e,baidu.event.preventDefault(e),i.login(),e.returnValue=!1}),i.loginStatus=!1,this.getState(function(s){function o(){i.tipTimer=setTimeout(function(){T.g("popUserInfoId").style.visibility="hidden"},200)}switch(i.userState=s,s.isOnline){case h:t.style.display="none",a.style.display="inline",a.innerHTML=n(s),T.g("username").onmouseover=function(){T.g("popUserInfoId").style.visibility="visible"},T.g("username").onmouseout=o,T.g("popUserInfoId").onmouseover=function(){window.clearTimeout(i.tipTimer)},T.g("popUserInfoId").onmouseout=o,baidu("#popUserInfoId a.logout").one("click",function(e){i.logout(),e.preventDefault()}),e&&e.onsuccess&&e.onsuccess(s),i.loginStatus=!0;break;case f:t.style.display="block",a.style.display="none"}})}};t.exports=w});