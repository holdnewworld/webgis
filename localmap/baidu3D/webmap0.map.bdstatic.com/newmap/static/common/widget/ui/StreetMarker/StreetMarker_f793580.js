define("common:widget/ui/StreetMarker/StreetMarker.js",function(t,i,e){function o(t){T.lang.Class.call(this),this.initialize||this.init(t)}var n=t("common:widget/ui/util/util.js"),a=t("common:widget/ui/mapUtil/mapUtil.js"),s=t("common:widget/ui/PanoUtil/PanoUtil.js"),p=t("common:widget/pano/PanoInterface/PanoInterface.js"),l=t("common:widget/ui/config/config.js"),r=l.modelConfig;T.lang.inherits(o,T.lang.Class,"StreetMarker"),T.object.extend(o.prototype,{initialize:!1,isOpen:!1,showlabel:!0,point:null,panoId:null,panoType:"",exitMkr:null,exitLbl:null,level:16,init:function(t){t=t||{},this.initialize=!0,this.isOpen=!0,this.point=t.point,this.panoId=t.panoId,this.panoType=t.panoType||Pano.PANO_TYPE_STREET,this.level=t.level||this.level,this.cityName=r.cityName,this.createMarker(this.point)},createMarker:function(t){var i=baidu.browser.ie<7?"../../../images/street_tool_png8_d133824.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_png8_d133824.png*/:"../../../images/street_tool_c1d9c10.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_c1d9c10.png*/,e=new BMap.Icon(i,new BMap.Size(21,32),{imageOffset:new BMap.Size(-1,-42)});this.exitMkr=new BMap.Marker(t,{icon:e,offset:new BMap.Size(0,-2),title:"点击进入全景"}),map.addOverlay(this.exitMkr),this.exitMkr.setTop(!0,9999999);var o='<div style="line-height: 25px;height:25px;margin-right:10px;">刚才在这里</div><a href="javascript:void(0)" style="border: 0;position: absolute;height:10px;width: 10px;background: url(http://webmap1.map.bdstatic.com/newmap/static/common/images/moBtnClose_1eecca8.png) no-repeat 0px 0px;right: 7px;top: 7px;">';this.exitLbl=a.createNormalTip(o,{point:t,offset:new BMap.Size(-45,-59)}),this.exitLbl.setStyle({backgroundColor:"none",backgroundImage:"url("+i+")",backgroundRepeat:"no-repeat",backgroundPosition:" 0px 0px",height:"39px",width:"92px",border:"0",position:"absolute",left:"0px",top:"1px",zoom:1,zIndex:1e5,textAlign:"center"}),map.addOverlay(this.exitLbl),map.zoomTo(this.level),map.panTo(t),map.getZoom()<9&&this.showPanoTip(),this.addEvents()},addEvents:function(){var t=this;this.exitMkr.addEventListener("click",function(i){baidu.event.preventDefault(i.domEvent),baidu.event.stopPropagation(i.domEvent),"photo_tour"==t.panoType?p.showPhotoTour(t.uid,t.panoId):p.showPano({point:t.point,panoId:t.panoId,panoType:t.panoType})}),this.exitMkr.addEventListener("mouseover",function(){s.panoMarker&&s.panoMarker.disable()}),this.exitMkr.addEventListener("mouseout",function(){s.panoMarker&&s.panoMarker.enable()}),this.exitMkr.addEventListener("remove",function(){t.exitMkr=null,t.exitLbl=null});var i=this.exitLbl.domElement.childNodes[1];T.on(i,"click",function(){t.exitLbl&&t.exitLbl.hide(),t.showlabel=!1})},show:function(t,i,e){"全国"!=r.cityName&&(this.cityName=r.cityName),this.point=i,this.panoId=t.panoId,this.panoType=t.panoType||this.panoType,this.isOpen=!0,this.exitMkr||this.createMarker(i),this.showlabel&&(this.exitLbl.setPoint(i),this.exitLbl.show()),this.exitMkr.setPoint(i),this.exitMkr.show(),map.panTo(i),map.zoomTo(e||this.level),map.getZoom()<9&&this.showPanoTip()},hide:function(){this.isOpen=!1,this.exitMkr&&this.exitMkr.hide(),showlabel&&this.exitLbl&&this.exitLbl.hide()},showPanoTip:function(){if(!T.G("defCityTip")){var t='<div id="defCityTip" class="GR_Tip def_city_tip"></div>';n.beforeEndHTML(document.body,t)}T.G("defCityTip").innerHTML='<div class="tip_cont">全国模式下无全景路网显示，您可以<a class="cur_city" href="javascript:void(0);" onclick="Instance(\''+this.guid+"').recoverDefaultMap()\">切换回"+this.cityName+"</a></div><button onclick=\"Instance('"+this.guid+"').closePanoTip(T.G('defCityTip'));\"></button>",this.setTipPos(T.G("defCityTip")),setTimeout(function(){var t=T.G("defCityTip");t&&(t.style.display="none")},5e3)},setTipPos:function(t){t.style.display="block";var i=T.g("MapInfoCon").clientWidth,e=n.getClientSize().width,o=t.clientWidth,a=e/2-o/2;map.fullScreenMode?t.style.top="38px":(t.style.top="145px",a+=i/2),t.style.left=a+"px"},closePanoTip:function(t){t&&(t.style.display="none")},recoverDefaultMap:function(){var t=this.point,i=16;map.zoomTo(i),map.panTo(t),this.closePanoTip()}}),e.exports=o});