define("common:widget/com/BusTrans/BusTrans.js",function(require,exports,module){function BusTrans(t){window.BusTransInst=this,MapComponent.call(this,t),this.schemes=[],this.panoEntranceData=[],this.transWndAndLineRelations=[],this.routePoints=[],this.sWalkPoints=[],this.eWalkPoints=[],this.tWalkPoints=[],this.transPoints=[],this.transPointsDict={},this.routeBound=[],this.sWalkBound=[],this.tWalkBound=[],this.eWalkBound=[],this.sWalkReal=[],this.tWalkReal=[],this.eWalkReal=[],this.transWins=[],this.switchLines=[],this.changeHtmls=[],this.schemeNames=[],this.mapZoomLevel=1,this.stopUids=[],this.stopPts=[],this.busType=[],this.clickIndex=[],this.schemeIndex=-1,this.routeIndex=[],this.sTransPoints=[],this.zoneStaTips=[],this.zoneBusStopPois=[],this.para=[],this.geoloaded=[],this.page=1,this.pagecap=5,this.loaded=!1,this.state=[],this.unfold=0,this.expend=60,this.rindex=-1,this.windex=-1,this.tindex=-1,this.lineType=[[0,2,3,4,5,6,7,9,10,11],[1,12,13,14],[8]],this.hasSubway=!1,this.isOperated=!1,this.strategy=0,this.enableDragging=!0,this.walkMkrs=[],this.exptype="dep",this.exptime="",this.version=5,this.startQDate="",this.startQTime="",this.trafficType=["全部","不坐地铁"],this.trafType=0,this.schemeTipList=[],this.routeTips=["","首班发车","末班发车","停"],this.noSbwQuery="[0,2,4,7,5,8,9,10,11]",this.CLS_SELECTED="selected",this.scrollPanel=new baidu.ui.ScrollPanel({container:"main_result_content",overflow:"overflow-y",autoUpdate:!1}),Share.setSmSCode(0)}var MapComponent=require("common:widget/com/MapComponent.js"),componentManager=require("common:widget/com/componentManager.js"),config=require("common:widget/ui/config/config.js"),constants=require("common:widget/ui/constant/Constant.js"),searchData=require("common:widget/ui/searchData/searchData.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),util=require("common:widget/ui/util/util.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),transUtil=require("common:widget/ui/transUtil/transUtil.js"),SchemeFaver=require("common:widget/ui/SchemeFaver/SchemeFaver.js"),SyncMgr=require("common:widget/ui/SyncMgr/SyncMgr.js"),Share=require("common:widget/ui/mapShare/MapShare.js"),BShare=require("common:widget/ui/toolShare/ToolShare.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),taxi=require("common:widget/ui/taxiMgr/TaxiMgr.js"),mapInfoScrollPanel=require("common:widget/ui/mapInfoScroll/mapInfoScroll.js"),transInfo=require("common:widget/ui/transInfoWindow/transInfoWindow.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),PanoEntranceUtil=require("common:widget/ui/PanoEntranceUtil/PanoEntranceUtil.js"),iknow=require("common:widget/ui/iKnow/iKnow.js"),sms=require("common:widget/ui/sms/sms.js"),setComplaintCenterURL=require("common:widget/ui/SetComplaintCenter/SetComplaintCenter.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,currentlines=[],currentmarks=[],changeTS='<tr class="#className#" onclick="BusTransInst.highRoute(event,#tIndex#,#rIndex#,this)" onmouseover="BusTransInst.trOver(event,this)" onmouseout="BusTransInst.trOut(event,this)">          <th><div class="#typeClass#">&nbsp;</div></th>          <td>          <a data-name="#name#" data-uid="#uid#" href="javascript:void(0);" class="list_street_view_poi" style="visibility:#visibility#"><img src="'+modelConfig.timg+"\" ></a><div class='tf'><a class='cs' onclick=\"BusTransInst.highZoneSta(event, '#lineUid#','#stUid#','#edUid#',#tIndex#,#rIndex#,this);return false;\" href='javascript:void(0)'>#viaStops#站</a></div><p style='padding-right:8px'>乘坐&nbsp;<span class='kl' title='#busTypeTip#'>#lineName#</span>#changLines#,&nbsp;在&nbsp;<a class='ks' href='javascript:void(0)' onclick=\"BusTransInst.clickStop(event,#tIndex#,#cIndex#);return false;\">#getOffName#</a>&nbsp;下车#getOffExit#&nbsp;&nbsp;#trans_time_tip#&nbsp;#bus_type_tip#</p></td>          </tr>",walkTS='<tr class="#className#" onclick="BusTransInst.highWalk(event,#tIndex#,#wIndex#,#wType#,this);BusTransInst.WalkContent(this,#tIndex#,#wType#,#wIndex#,#wInfo#)" onmouseover="BusTransInst.trOver(event,this)" onmouseout="BusTransInst.trOut(event,this)" >          <th><div class="step"></div></th>          <td><a data-name="#name#" data-uid="#uid#" href="javascript:void(0);" class="list_street_view_poi" style="visibility:#visibility#"><img src="'+modelConfig.timg+"\" ></a><div class='tf'>#walkDistance#</div><p style='padding-right:60px'>步行至&nbsp;<span>#walkName#</span></p></td>        </tr>",turtype=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转","左转穿过马路继续向前","右转穿过马路继续向前","左转穿过马路往回走","右转穿过马路往回走","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向","经#WalkType#穿过马路并往回走","经#WalkType#穿过马路并继续向前","到路口斜对面并继续向前","到路口斜对面，向左前方转","到路口斜对面，左转","到路口斜对面，向左后方转","到路口斜对面，向右前方转","到路口斜对面，右转","到路口斜对面，向右后方转","到路口斜对面，直走","继续向前","向左前方转过#WalkType#","左转过#WalkType#","向左后方转过#WalkType#","向右前方转过#WalkType#","右转过#WalkType#","向右后方转过#WalkType#","直走过#WalkType#","继续向前"],turtype1=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转"],rettype=["","从起点出发","到达目的地","途经点","走"],roadtype=["","环岛","无属性道路","主路","高速连接路","交叉点内路段","连接道路","停车场内部道路","服务区内部道路","桥","步行街","辅路","匝道","全封闭道路","未定义交通区域","POI连接路","隧道","步行道","公交专用道","提前右转道","广场内部道路","公园内部道路"],worktype=["","人行道","天桥","地下通道","人行通道","直梯","扶梯","阶梯","斜坡","索道"],expTips=["已显示全部公交线路","未显示已停运公交线路|查看全部线路","该时间没有可用公交路线，已显示全部方案","已显示全部公交线路（含停运）|查看可用线路"],schemeTips=["","该方案有首班车未开风险","该方案有错过末班车风险","该方案班车已停运"],style=".clear{clear:both;height:0;overflow:hidden}.route{*margin-top:0;clear:both}.route li{margin-bottom:6px;cursor:pointer;position:relative;zoom:1}.route li.active{cursor:default}.route .con{color:#666;border:1px solid #9cb5ff}.route .con .way{font-size:14px;line-height:25px;padding:4px 10px 4px 19px;color:#3d6dcc;position:relative;zoom:1}.route .con .km{text-align:left;line-height:14px;display:none;font:400 12px arial,sans-serif;color:gray}.route .con .kmZ{text-align:left;height:32px;line-height:32px;display:none;font:400 12px arial,sans-serif;color:gray;padding-left:10px;background-color:#ebf1fb;cursor:auto;border-top:1px solid #a4bcea;*position:relative}.route .kmZ .sp{float:right;color:#c5d2ec;margin:0 4px;font-weight:400}.route .con .debug{display:none;text-align:right;padding-right:5px;margin-top:-4px;padding-top:3px;*padding-right:37px}.route .on .way{color:#3d6dcc;font-weight:700;background-color:#ebf1fb}.route .con .i{height:22px;line-height:22px;overflow:hidden;float:right;margin:6px 0 0;float:right;zoom:1}.route .con .i2{height:22px;line-height:22px;overflow:hidden;margin:0;float:right;zoom:1;margin-top:5px}.sendMoileMouseOut{width:77px;height:22px;float:left;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat 0 -226px}.sendMoileMouseOver{width:77px;height:22px;float:left;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat 0 -250px;cursor:pointer}.favMouseOut{width:14px;height:14px;float:left;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat -28px -203px}.favMouseOver{width:14px;height:14px;float:left;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat -44px -203px;cursor:pointer}.printMouseOut{width:14px;height:14px;float:left;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat -58px -202px}.printMouseOver{width:14px;height:14px;float:left;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat -74px -202px}span.printMouseOver a{display:block;width:14px;height:14px}.phoneImgTip{width:14px;height:20px;float:left;display:block;margin-top:8px;margin-right:2px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) no-repeat -75px -178px}.route .info .sel{background:#f6f6f6;cursor:default}.route .info .sel_td{background:#f6f6f6;cursor:default}.route .info .sel_td td,.route .info .sel_td th{border-bottom:0}.route .info .walk_div{line-height:18px}.route .info .walk_div td,.route .info .walk_div th{border-top:1px solid #ccc;border-bottom:0}.route .info .walk_div th{padding-left:4px}.route .info .walk_div td span{font-weight:700}.route .info .closeWalkInfo{float:right;color:#3D6DCC;cursor:pointer;text-decoration:underline;margin-top:-10px}.route .info table{width:100%}.route .info .list_street_view_poi{margin-left:14px}.route .info{color:#000;border-top:1px solid #a4bcea;display:none;cursor:pointer;padding-bottom:5px}.route .active .con .km{display:block}.route .active .con .kmZ{display:block;line-height:32px;cursor:auto;position:relative}.route .active .con .kmZ span.time_dis{display:inline-block;float:left}.route .info h3{height:26px;font-size:12px;color:#fff;padding:5px 6px 0 25px;line-height:26px}.route .info h3 span{display:block;float:left;height:19px;display:block;line-height:19px;margin:3px 8px auto 10px;color:#333;*margin-left:5px}.route .info h3.no1{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_trans_bg_109fe77.png) no-repeat 3px 7px}.route .info h3.no2{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_trans_bg_109fe77.png) no-repeat 3px -24px}.route .info th{padding:5px 0;line-height:20px;text-align:left;vertical-align:top}.route .info th p{padding-left:25px}.route .info th div{width:25px;height:18px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat;float:left}.route .info th .step{background-position:-126px -211px}.route .info th .bybus{background-position:-99px -211px}.route .info th .bysub{background-position:-155px -211px}.route .info th .byship{background-position:-99px -211px}.route .info td{padding:5px 6px 5px 5px;line-height:20px;vertical-align:top;width:100%}.route .info .walk_div td{padding-right:0}.route .info .focus th,.route .info .focus td{background:#EAEDF5}.route .info .km2 span{color:#666;float:right;margin-top:-20px}.route .print{text-align:right;line-height:20px;padding-right:5px}.route a{color:#3d6dcc}.route a.ks{cursor:pointer;text-decoration:none}.route a.ks:hover{text-decoration:underline}.route .also_t a{text-decoration:none}.route .also_t a:hover{text-decoration:underline}.route .kl{color:#3d6dcc;font-weight:700}.route .rarr{position:relative;top:-2px;_top:0}.route .also_t{color:#3d6dcc}.route .info td .tf{float:right;padding:0 0 0 5px;color:gray}.route .info td .tf a.cs{text-decoration:underline;cursor:pointer;color:gray}.route .info td p{*line-height:23px}.walk_tips{background:#fff3cb;height:25px;line-height:25px;padding-left:3px;margin:0 20px 8px 12px;display:none}.walk_tips a{color:#4472e2}.bus_strategySel,.bus_strategySel_on{width:315px;height:26px;line-height:26px;margin:8px 10px;overflow:hidden;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/new_map_nav_c10446f.gif) no-repeat 0 0}.bus_strategySel .noSel,.bus_strategySel .sel{float:left;width:104px;line-height:26px;*line-height:29px;overflow:hidden;text-align:center;margin:0;padding:0}.bs_taxiCost{text-indent:4px;padding:10px 0}div.select_time,div.traffic_type{margin:10px 10px 5px 15px;position:relative}div.select_time label,div.traffic_type label{float:left;margin:6px 3px auto 0}div.select_time ul li{display:inline-block;*display:inline;*zoom:1;text-indent:0;padding:0;position:relative}div.select_time input{height:23px;border:0;padding-left:8px;margin-right:10px;_margin-right:0;line-height:23px;overflow:hidden;cursor:pointer;width:104px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_cal_bg_cc64c3a.png) 0 -31px no-repeat}#bs_start_time{text-indent:24px;margin:0;*margin-left:-20px}div.select_time span.bs_cal,div.select_time span.bs_clc,div.select_time span.bs_tm{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_cal_bg_cc64c3a.png) no-repeat;position:absolute;display:block;cursor:pointer}div.select_time span.bs_cal{height:15px;width:18px;background-position:-16px -104px;left:90px;top:5px;position:absolute}div.select_time span.bs_clc{height:15px;width:18px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/bus_time_a101b24.png) no-repeat 0 0;left:90px;top:5px;position:absolute}div.select_time span.bs_tm{height:5px;width:8px;background-position:0 -103px;left:96px;top:8px;position:absolute;display:block;*overflow:hidden}div.select_time li.selected input#bs_start_time{background-position:-116px -31px}div.select_time li.selected span.bs_tm{background-position:0 -112px}div.traffic_type .select_type{display:inline-block;position:relative}div.traffic_type .select_type span{width:98px;height:26px;line-height:26px;text-align:left;display:inline-block;cursor:pointer;padding-left:15px;overflow:hidden;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_cal_bg_cc64c3a.png) 0 -30px no-repeat}.select_type em{height:8px;width:10px;display:inline-block;position:absolute;left:90px;top:8px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_cal_bg_cc64c3a.png) 0 -102px no-repeat;overflow:hidden;cursor:pointer}div.traffic_list{background:#fff;width:110px;border:1px solid #d8d8d8;border-top:0 solid;position:absolute;top:26px;left:63px;_left:0;display:none;padding-bottom:3px;padding-top:3px;z-index:999;cursor:pointer}div.traffic_list a{width:auto;height:25px;display:block;padding-left:15px;color:#000;line-height:25px;text-decoration:none}div.traffic_list a:hover{background:#f0f0f0;color:#00c}div.exp_tip{height:25px;line-height:25px;display:block;position:relative;background-color:#ffffdf;border:1px solid #f4f4d3;padding-left:10px;margin:0 23px 8px 10px}div.exp_tip a{display:inline-block;float:right;margin-right:10px;*position:absolute;*right:5px;*bottom:0}span.bus_time{font-size:12px;font-weight:400;color:#666;margin-left:15px;margin-right:5px}span.bus_type_tip{display:block;width:30px;height:18px;color:#fff;font-weight:400;font-size:12px;line-height:17px;text-align:center;float:right;position:relative;top:4px}span.bus_type_tip_time{color:#ff742e;display:block}span.bus_type_0{background:#ff8853}span.bus_type_2{background:#ff4141}span.bus_type_3{background:#43cc8d}span.bus_type_4{background:#333f89}.route .info table tr.over{background-color:#ebf1fb}.route li.mover .con,.route li.mover .top,.route li.mover .bottom{background-color:#ebf1fb;font-weight:700}.route .con .way em{width:18px;height:17px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_cal_bg_cc64c3a.png) no-repeat;display:inline-block;vertical-align:middle;line-height:17px}.route .con .hcard{position:absolute;left:0;top:0;width:11px;height:13px;border:1px solid #c5d4ff;background:#d5dffe;color:#fff;font-family:Arial;line-height:13px;font-size:12px;text-align:center}.route li.mover .hcard,.route .on .hcard{background:#a6bcfe;border-left:1px solid #ccd8ff;border-top:1px solid #ccd8ff;border-bottom:1px solid #9cb5ff;border-right:1px solid #9cb5ff;font-weight:400}.route .con .way em.scm_tip_1{background-position:-38px -104px}.route .con .way em.scm_tip_2{background-position:-38px -104px}.route .con .way em.scm_tip_3{background-position:-61px -104px}.route .con .stop{color:#666;font-weight:400}.route tbody td em{width:18px;height:15px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_cal_bg_cc64c3a.png) no-repeat -38px -104px;display:inline-block;vertical-align:middle;bottom:0}.route td span.ts_tip_1{height:15px;display:inline-block;color:#468b02}.route td span.ts_tip_2{height:15px;display:inline-block;color:#e43023}";require.loadCss({content:style,name:"BusTrans"}),T.lang.inherits(BusTrans,MapComponent,"BusTrans"),T.object.extend(BusTrans.prototype,{render:function(){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="busAdContainer" >',"undefined"==typeof new_cms_ad?"":new_cms_ad,'</div>  <div id="route_top" class="route_top">    <div class="select_time clearfix">       <label >出发时间：</label><ul><li><input type="text" id="bs_start_date" maxlength="10" readonly="readonly" /><span class="bs_cal"></span></li><li><input type="text" id="bs_start_time" value="0" maxlength="6" readonly="readonly" /><span class="bs_clc"></span></li></ul>    </div>    ',"undefined"==typeof traffic_type?"":traffic_type,'     <div id="route_type" class="bus_strategySel" style="',"undefined"==typeof route_type_width?"":route_type_width,'">      <div class="strategySel_r">           <div id="strategySel" style="width:319px">                <span class="leftBorLine"></span>                <div class="noSel" id="type0">较快捷</div>                <div class="noSel" id="type2"><span class="lineBg">少换乘</span></div>                <div class="noSel" id="type3"><span class="lineBg">少步行</span></div>                <span class="rightBorLine"></span>           </div>       </div>    </div>    ',"undefined"==typeof bs_exp_tip?"":bs_exp_tip,'    <div id="walk_tips" class="walk_tips">起点与终点距离较近，您可',"undefined"==typeof onlywalk?"":onlywalk,'。</div></div><div class="route_contentWrapper">    <div id="main_result_content" class="result_holder">      <div class="special">              <ul id="route_list" class="route">',"undefined"==typeof routeScheme?"":routeScheme,'</ul>              </div>      <div id="route_page"></div>     <div id="taxiCost" class="bs_taxiCost">      <span id="taxiText" onclick="addStat(\'busscheme.blscheme.texifee\');BusTransInst.getTaxi(this);">打车费用<span id="taxiJG"></span></span> <span style="color:#999999">(按驾车的最短路程计算)</span>    </div>             <div id="route_tips" class="route_tips">百度提醒您：以上行车线路仅供参考，如有问题请到<a id="mapComplaintCenter" target="_blank" href="http://tousu.baidu.com/map/add">百度地图投诉中心</a>反馈。</div>      <div id="pctomoBusId" class="pctomo_bus"></div>                </div></div><div id="route_total" class="route_bottom">  <p class="rp">查看：<a tid="routeReturn" href="javascript:void(0)" onclick="addStat(\'busscheme.blscheme.shownav\');BusTransInst.returnBus();return false;">返程</a>&nbsp;|&nbsp;<a href="javascript:void(0)" onclick="BusTransInst.navigate()">驾车</a>&nbsp;',"undefined"==typeof walkInfo?"":walkInfo,'</p>    <p class="lp"><a href="javascript:void(0)" tid="reChoice" onclick="addStat(\'busscheme.blscheme.reselectterminal\');BusTransInst.backAddr()">重选起终点</a></p></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],templateObj={},me=this,win=window,json=this.json;if(this.resetMInfo(),mapInfoScrollPanel&&mapInfoScrollPanel.hide(),addStat("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/bus.busscheme.bus","show"),this.cinfo&&1==this.cinfo.isPos)return 0==this.cinfo.destFlag?(win.conType=0,win.conPoint=this.cinfo.point):(win.conType=1,win.conPoint=this.cinfo.point),void this.setContext();if(!json||!json.result)return;var result=json.result;if(22==result.type){var url=this.modelQuery;return url=url.replace("sn=0","sn=1"),url=url.replace("en=0","en=1"),void componentManager.go(url)}this.error=result.error,this.total=result.total;var time=result.time;this.start=result.start,this.end=result.end,this.db=result.db;var slen=this.start.wd.length,elen=this.end.wd.length;this.startName=slen>26?baidu.string(this.start.wd).subByte(26,"..."):this.start.wd,this.endName=elen>26?baidu.string(this.end.wd).subByte(26,"..."):this.end.wd,this.startName=baidu.encodeHTML(this.startName),this.endName=baidu.encodeHTML(this.endName),this.s_query=result.s_query?result.s_query:this.start.wd,this.e_query=result.e_query?result.e_query:this.end.wd,this.s_query=baidu.encodeHTML(this.s_query),this.e_query=baidu.encodeHTML(this.e_query),this.startPoint=this.start.pt,this.endPoint=this.end.pt,this.sBus=this.start.bus_stop,this.eBus=this.end.bus_stop,this.suid=this.start.uid,this.euid=this.end.uid,this.strategy=result.sy,this.trafType=this.cinfo&&this.cinfo.trafType||this.trafType,win.cxtBusPoints||(win.cxtBusPoints=[]);var xy=this.start.pt.split(","),sp=new BMap.Point(xy[0],xy[1]);win.cxtBusPoints[0]={p:sp,n:this.startName,t:0};var xy=this.end.pt.split(","),ep=new BMap.Point(xy[0],xy[1]);if(win.cxtBusPoints[1]={p:ep,n:this.endName,t:1},this.cn=modelConfig.cityName,this.currentCity=modelConfig.cityCode,this.curCity=json.current_city,!this.total||0==this.total)return addStat("crosscitybusscheme.blscheme.noblscheme"),this.RenderNoResult();this.mapZoomLevel=map.zoomLevel,this.schemes[this.page-1]=json.content,this.cinfo._index&&(this.state=this.cinfo._index.split(","),this.page=parseInt(this.state[2]),this.cinfo._index=null);var routeScheme=this.makeScheme(this.page),dis=parseFloat(BMap.Project.getDistanceByMC(sp,ep));1500>dis?(templateObj.walkInfo='|&nbsp;<a href="javascript:void(0)" onclick="BusTransInst.navWalk();return false;">步行</a>',templateObj.onlywalk='<a href="javascript:void(0)" onclick="BusTransInst.navWalk();return false;">步行前往</a>'):templateObj.walkInfo="",templateObj.routeScheme=routeScheme,templateObj.route_type_width="",templateObj.bs_exp_tip=this.getExpRoutesTip(result),templateObj.traffic_type=json.current_city.sup_subway?this.getTrafficTypeHtml():"";var cmsAdStr=this._setNewCms();return this.cmsAdStrFlag=cmsAdStr?1:0,templateObj.new_cms_ad=cmsAdStr,template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/BusTrans/BusTrans.js",ln:373})}},initialize:function(){function t(){e.isOperated=!0}try{var e=this,i=window,s=this.json;if(!s)return;if(2!=searchBox._curSelIndex&&searchBox.setSwitchTab(2),s&&s.result){var n=baidu.encodeHTML(null==s.result.start.wd?"":s.result.start.wd),a=baidu.encodeHTML(null==s.result.end.wd?"":s.result.end.wd);searchBox.setValue("BusSearchSta",n),searchBox.setValue("BusSearchEnd",a)}searchBox.busSSG1&&searchBox.busSSG1.setValue(document.fmbus.word_from.value),searchBox.busSSG2&&searchBox.busSSG2.setValue(document.fmbus.word_to.value),BoxContainer.showSpecial({type:"subway"}),BoxContainer.resetStatus();var o=this.cinfo.isDragStartOrFinishPoint;if(this.json.content&&PanoUtil.isPanoStatus()&&!o&&PanoUtil.closePano("search"),this.setNavQuery(),0!=this.error||!this.total||0==this.total)return i.startPoi=mapUtil.addDestPoi(i.cxtBusPoints[0].p,"",constants.DEST_START),i.startPoi.addEventListener("ondragstart",function(t){e.dragStart(t)}),i.startPoi.addEventListener("ondraging",function(t){e.draging(t)}),i.startPoi.addEventListener("ondragend",function(t){e.dragEnd(t,0)}),i.startPoi.enableDragging(!0),i.startPoi._sc=e.curCity.code,i.endPoi=mapUtil.addDestPoi(i.cxtBusPoints[1].p,"",constants.DEST_END),i.endPoi.addEventListener("ondragstart",function(t){e.dragStart(t)}),i.endPoi.addEventListener("ondraging",function(t){e.draging(t)}),i.endPoi.addEventListener("ondragend",function(t){e.dragEnd(t,1)}),i.endPoi.enableDragging(!0),void(i.endPoi._ec=e.curCity.code);if(this.startPoint&&this.endPoint){var r=this.startPoint.split(","),l=new BMap.Point(r[0],r[1]),r=this.endPoint.split(","),p=new BMap.Point(r[0],r[1]),d=parseFloat(BMap.Project.getDistanceByMC(l,p));T.G("walk_tips")&&(T.G("walk_tips").style.display=1e3>d?"block":"none")}this._binder(),map.mapType==BMAP_TYPE_DIMENSIONAL&&this.busTranFor3D(!1),map.addEventListener("dragend",t),map.addEventListener("zoomend",t),map.addEventListener("zoomend",this.redrawArrow),map.addEventListener("moveend",this.redrawArrow),baidu.on(i,"onresize",function(){e.scrollPanel&&e.scrollPanel.update()}),baidu.on("busAdClose","click",function(){baidu.g("busAdContainer").innerHTML="",T.cookie.set("busCmsAd","2",{expires:6048e5}),e.resizeBusContent(),e.scrollPanel&&e.scrollPanel.update()}),this.setCmsAds(),this.scrollPanel.render("main_result_content"),this.bindBsEvents(),this.setDefTime(),this.setModelQuery(),this.showSendSmsTip(),mapInfoScrollPanel?mapInfoScrollPanel.hide():T.g("MapInfo").style.overflowY="hidden",this.load(),setComplaintCenterURL(map,e),window.weipaiTool&&window.weipaiTool.resetStatus(),this.cinfo&&"bt"==this.cinfo.sms&&(sms&&sms.ready("","bt"),Share.setSmSCode("bt")),Share.setParam("ttype",this.trafType)}catch(c){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/exception.fire","catch",{msg:c.message||c.description,path:"common:widget/com/BusTrans/BusTrans.js",ln:550})}},setNavQuery:function(){var t=this;require.async("common:widget/ui/throughpoint/Throughpoint.js",function(e){var i=e.getQueryParam(),s=e.getCityCode();t.navQueryString="nav&navtp=0&c="+t.currentCity+"&sy=0&drag=0&sc="+t.currentCity+"&st=1&ec="+s+t.currentCity+"&et=1&sn=2$$"+t.suid+"$$"+t.startPoint+"$$"+encodeURIComponent(t.start.wd)+"$$$$$$&en="+i+"2$$"+t.euid+"$$"+t.endPoint+"$$"+encodeURIComponent(t.end.wd)+"$$$$$$&sq="+encodeURIComponent(t.s_query)+"&eq="+encodeURIComponent(t.e_query)})},setCmsAds:function(){var t=require("common:widget/ui/CMSUtil/cmsControl.js");baidu.g("pctomoBusId").innerHTML=t.getPc2MoStr("bus")},_setNewCms:function(){var cmsAdStr="";if(_OLR){eval("var adJson ="http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/+_OLR.index);var adJsonValue=adJson.special&&adJson.special.data&&adJson.special.data.top.bus?adJson.special.data.top.bus:"";if("2"!==T.cookie.get("busCmsAd")){var adLength=adJsonValue?adJsonValue.length:0;if(adJsonValue&&adLength>0){var myDate=new Date,accessTurn=myDate.getHours()%adLength;cmsAdStr=adJsonValue[accessTurn].icon?'<div class="newCmsAd" style="background-image:url('+adJsonValue[accessTurn].icon+') !important;">':'<div class="newCmsAd">',cmsAdStr=adJsonValue[accessTurn].link2?cmsAdStr+adJsonValue[accessTurn].title+'<a href="'+adJsonValue[accessTurn].link1+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.buslink', 'click', {da_trd:'"+adJsonValue[accessTurn].title+"'});\">"+adJsonValue[accessTurn].link_text1+'</a>&nbsp;&nbsp;<span>|</span>&nbsp;&nbsp;<a href="'+adJsonValue[accessTurn].link2+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.buslink', 'click', {da_trd:'"+adJsonValue[accessTurn].title+"'});\">"+adJsonValue[accessTurn].link_text2+'</a><a id="busAdClose" class="closeBtn" href="#"></a></div>':cmsAdStr+adJsonValue[accessTurn].title+'<a href="'+adJsonValue[accessTurn].link1+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.buslink', 'click', {da_trd:'"+adJsonValue[accessTurn].title+"'});\">"+adJsonValue[accessTurn].link_text1+'</a><a id="busAdClose" class="closeBtn" href="#"></a></div>'}else cmsAdStr=""}}return""!=cmsAdStr&&addStat("indexleftmenu.links.buslink","show"),cmsAdStr},load:function(){if(this.json.taxi){var t=this.json.taxi.detail[0].totalPrice;T.G("taxiJG")&&(T.G("taxiJG").innerHTML=": "+t+"元")}else T.G("taxiCost")&&(T.G("taxiCost").style.display="none");this.resizeBusContent&&this.resizeBusContent()},unload:function(){window.cxtBusPoints=null,window.startPoi=null,window.endPoi=null,this.scrollPanel=null,currentlines=[],T.un(window,"onresize",this.resizeBusContent),BoxContainer.hiddenSpecial();var t=T.G("defCityTip");t&&(t.style.display="none");var e=baidu.g("bus_start_tip");e&&(e.style.display="none"),map.removeEventListener("zoomend",this.redrawArrow),map.removeEventListener("moveend",this.redrawArrow),MapComponent.prototype.unload.apply(this,arguments),Share.setParam("ttype",null)},setModelQuery:function(){var t=1==this.sBus?0:1,e=1==this.eBus?0:1,i=0==this.json.result.exptype?"all":"dep";this.modelQuery="bt&bttp=0&c="+this.currentCity+"&"+this.getStrategy(this.strategy)+"&en="+e+"$$"+this.euid+"$$"+this.endPoint+"$$"+encodeURIComponent(this.end.wd)+"$$$$$$&sn="+t+"$$"+this.suid+"$$"+this.startPoint+"$$"+encodeURIComponent(this.start.wd)+"$$$$$$&sq="+encodeURIComponent(this.e_query)+"&eq="+encodeURIComponent(this.s_query)+"&exptype="+i+"&exptime="+this.exptime+"&version="+this.version},resetMInfo:function(){var t=this;BShare&&(BShare.getMInfo=function(){var e="";if(t.total&&0!=t.total)var i=t.s_query,s=t.e_query,n=t.schemeIndex,a=t.schemeNames,e=BShare.fixName(i+"到"+s)+" "+a[n].join("，换");return{text:e,className:t._className}})},RenderNoResult:function(){try{var iknowEl=iknow.getIknowCode("想知道:"+this.cn+" 从"+this.start.wd+"到"+this.end.wd+"怎么坐公交？"),template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<div class='result_holder' style='padding:10px'>  <p>在<strong>","undefined"==typeof city_name?"":city_name,"</strong>    未能计算出从“    <span class='nr_kw'>","undefined"==typeof start_wd?"":start_wd,"</span>”到“    <span class='nr_kw'>","undefined"==typeof end_wd?"":end_wd,"</span>”公交路线，抱歉。  </P>    ","undefined"==typeof iknow?"":iknow,"  <p style='padding-left:3px;margin:10px 0;height:25px;line-height:25px;background:#FFF3CB'>    您可尝试查看<a href='javascript:void(0)' onclick=\"addStat('busscheme.blscheme.noblavlchknav');BusTransInst.navigate();return false;\">驾车路线</a>。  </p>  <div class='nr_suggest'>您还可以：\"    <ul>      <li>看看地图当前城市是否有误，尝试更换城市</li>      <li>您可在地图上移动起点、终点，再次尝试</li>      <li>您可更换关键词再次尝试</li>    </ul>  </div>  <br/>  <div id='route_tips' class='route_tips'>百度提醒您：以上方案仅供参考，如有问题请到<a id='mapComplaintCenter' target='_blank'  href='http://tousu.baidu.com/map/add'>百度地图投诉中心</a>反馈。  </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],templateObj={city_name:this.cn,start_wd:baidu.encodeHTML(this.start.wd),end_wd:baidu.encodeHTML(this.end.wd),iknow:iknowEl};return template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/BusTrans/BusTrans.js",ln:708})}},setValueByCBK:function(t){function e(t){var e=t.target.getPoint();util.loadSearchInfo(function(i){var s=i.createSearchInfoWnd({title:l},{x:e.lng,y:e.lat,isMenu:!0});i.openSearchInfoWnd(s,t.target,{pano:!0,panoPoint:e}),s.addEventListener("open",function(){i.switchInfoWndTab(1,"iw_esn")})})}function i(t){var e=t.target.getPoint();util.loadSearchInfo(function(i){var s=i.createSearchInfoWnd({title:l},{x:e.lng,y:e.lat,isMenu:!0});i.openSearchInfoWnd(s,t.target,{pano:!0,panoPoint:e}),s.addEventListener("open",function(){i.switchInfoWndTab(0,"iw_ssn")})})}var s=t.content,n=this,a=window,o=null,r=t.result;if(o=0==a.conType?this.startP:this.endP,!s)return void(0==a.conType?(map.removeOverlay(a.startPoi),a.startPoi=null):(map.removeOverlay(a.endPoi),a.endPoi=null));if(s){var l=s.address||"未知路段",p=r.code||config.modelConfig.cityCode;a.cxtBusPoints||(a.cxtBusPoints=[]);var d=(n.strategy?n.strategy:0,map.temp.infoWin);if(0==a.conType)return a.cxtBusPoints[0]={p:o,n:l},a.startPoi?a.startPoi.setPoint(a.cxtBusPoints[0].p):(a.startPoi=mapUtil.addDestPoi(a.cxtBusPoints[0].p,"",constants.DEST_START),a.startPoi.addEventListener("ondragstart",function(t){n.dragStart(t)}),a.startPoi.addEventListener("ondraging",function(t){n.draging(t)}),a.startPoi.addEventListener("ondragend",function(t){n.dragEnd(t,0)}),a.startPoi.enableDragging(!0)),a.startPoi._sc=p,searchBox.busSSG1.setValue(l),searchBox.inputInfo.BusSearchSta.note=l,searchBox.inputInfo.BusSearchSta.point=a.startPoi.point.lng+","+a.startPoi.point.lat,searchBox.driveSSG1.setValue(l),searchBox.inputInfo.DriveSearchSta.note=l,searchBox.inputInfo.DriveSearchSta.point=a.startPoi.point.lng+","+a.startPoi.point.lat,a.startPoi&&a.endPoi?this.startGo(p):d&&d.isOpen()&&d._ext&&"未知地点"!=d._ext.name&&(a.endPoi=mapUtil.addDestPoi(d.getPoint(),"",constants.DEST_END),a.endPoi.addEventListener("ondragstart",function(t){n.dragStart(t)}),a.endPoi.addEventListener("ondraging",function(t){n.draging(t)}),a.endPoi.addEventListener("ondragend"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/,function(t){n.dragEnd(t,1)}),a.endPoi.enableDragging(!0),a.endPoi._ec=n.curCity&&n.curCity.code?n.curCity.code:p,a.cxtBusPoints[1]={p:d.getPoint(),n:d._ext.name||"未知地点",t:1},a.startPoi&&a.endPoi&&this.startGo(p)),s=null,a.startPoi.addEventListener("click",e),void a.startPoi.addEventListener("ondraging",function(){this.closeInfoWindow(),a.startPoi.removeEventListener("click",e)
});if(1==a.conType)return a.cxtBusPoints[1]={p:o,n:l},a.endPoi?a.endPoi.setPoint(a.cxtBusPoints[1].p):(a.endPoi=mapUtil.addDestPoi(a.cxtBusPoints[1].p,"",constants.DEST_END),a.endPoi.addEventListener("ondragstart",function(t){n.dragStart(t)}),a.endPoi.addEventListener("ondraging",function(t){n.draging(t)}),a.endPoi.addEventListener("ondragend",function(t){n.dragEnd(t,1)}),a.endPoi.enableDragging(!0)),a.endPoi._ec=p,searchBox.busSSG2.setValue(l),searchBox.inputInfo.BusSearchEnd.note=l,searchBox.inputInfo.BusSearchEnd.point=a.endPoi.point.lng+","+a.endPoi.point.lat,searchBox.driveSSG2.setValue(l),searchBox.inputInfo.DriveSearchEnd.note=l,searchBox.inputInfo.DriveSearchEnd.point=a.endPoi.point.lng+","+a.endPoi.point.lat,a.startPoi&&a.endPoi?this.endGo(p):d&&d.isOpen()&&d._ext&&"未知地点"!=d._ext.name&&(a.startPoi=mapUtil.addDestPoi(d.getPoint(),"",constants.DEST_START),a.startPoi.addEventListener("ondragstart",function(t){n.dragStart(t)}),a.startPoi.addEventListener("ondraging",function(t){n.draging(t)}),a.startPoi.addEventListener("ondragend"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusTrans/,function(t){n.dragEnd(t,0)}),a.startPoi.enableDragging(!0),a.startPoi._sc=n.curCity&&n.curCity.code?n.curCity.code:p,a.cxtBusPoints[0]={p:d.getPoint(),n:d._ext.name||"未知地点",t:0},a.startPoi&&a.endPoi&&this.endGo(p)),s=null,a.endPoi.addEventListener("click",i),void a.endPoi.addEventListener("ondraging",function(){this.closeInfoWindow(),a.endPoi.removeEventListener("click",i)})}},setContext:function(){var t=window.conPoint;if(t){{t.lng+","+t.lat}mapUtil.getGEORevertAddress(t,function(t){BusTransInst.setValueByCBK(t)}),0==window.conType?this.startP=t:this.endP=t}},_binder:function(){var t=this,e=window;this.state[0]&&this.state[1]?this.setScheme(parseInt(this.state[0]),parseInt(this.state[1])):this.setScheme(0,1),this.resizeBusContent&&this.clearTempRoute&&T.un(e,"onresize",this.resizeBusContent),this.resizeBusContent(),this.changStrategy(t.strategy),T.on(e,"onresize",this.resizeBusContent)},changStrategy:function(t){if(T.g("strategySel")){var e=this,i=T.g("strategySel");if(i)for(var s=baidu("#strategySel div").get(),n=0;n<s.length;n++){var a=s[n];t==a.id.charAt(4)&&(a.className="sel",a.checked=1),a.style.cursor="pointer",T.on(a,"click",function(t){e.doRadioClick(t,this)}),T.on(a,"mouseover",function(t){e.doRadioOver(t,this)}),T.on(a,"mouseout",function(t){e.doRadioOut(t,this)})}}},doRadioClick:function(t,e){var i=this;T.g("type"+i.strategy)?T.g("type"+i.strategy).className="noSel":null,e.className="sel",e.checked=1;var s=1==i.sBus?0:1,n=1==i.eBus?0:1;i.strategy=e.id.charAt(4),navigator.cookieEnabled&&T.cookie.set("Map_busTranType",i.strategy,{expires:new Date((new Date).getTime()+31536e6)}),componentManager.go("bt&c="+i.currentCity+"&"+i.getStrategy(i.strategy)+"&sn="+s+"$$"+i.suid+"$$"+i.startPoint+"$$"+encodeURIComponent(i.start.wd)+"$$$$$$&en="+n+"$$"+i.euid+"$$"+i.endPoint+"$$"+encodeURIComponent(i.end.wd)+"$$$$$$&sq="+encodeURIComponent(i.s_query)+"&eq="+encodeURIComponent(i.e_query)+"&rn="+i.pagecap+"&reqtp=1&exptype="+i.exptype+"&exptime="+i.exptime+"&version="+i.version,{cinfo:{trafType:i.trafType}})},doRadioOver:function(t,e){for(var i=this,s=e,n=baidu(s).children("span").get(),a=baidu("#strategySel span").get(),o=0,r=s.id.charAt(4),l=0;l<a.length;l++)a[l]==n[0]&&(o=l);r==i.strategy?(T.g("route_type").className="bus_strategySel bus_strategySel_on",0==r?a[0].className="leftBorLine leftBorLine_active_on":3==r&&(a[a.length-1].className="rightBorLine rightBorLine_active_on")):(s.className="noSel noSel_on",0==r?a[0].className="leftBorLine leftBorLine_on":3==r&&(a[a.length-1].className="rightBorLine rightBorLine_on")),n[0]&&(n[0].className="lineBg lineBg_on"),o+2<a.length&&a[o+1]&&(a[o+1].className="lineBg lineBg_on")},doRadioOut:function(t,e){for(var i=this,s=e,n=baidu(s).children("span").get(),a=baidu("#strategySel span").get(),o=0,r=s.id.charAt(4),l=0;l<a.length;l++)a[l]==n[0]&&(o=l);r==i.strategy?(T.g("route_type").className="bus_strategySel",0==r?a[0].className="leftBorLine":3==r&&(a[a.length-1].className="rightBorLine")):(s.className="noSel",0==r?a[0].className="leftBorLine":3==r&&(a[a.length-1].className="rightBorLine")),n[0]&&(n[0].className="lineBg"),o+2<a.length&&a[o+1]&&(a[o+1].className="lineBg")},makeScheme:function(t){this.loaded=!1,this.page=t?t:1;var e=(this.page-1)*this.pagecap,i=this.page*this.pagecap;i=i<this.total?i:this.total;for(var s=[],n=e,a=n;++a,i>n;n++){s.push('<li onclick="BusTransInst.setScheme('+n+",1,event,1);addStat('busscheme.blscheme.blscheme"+(n+1)+'\');" onMouseOver="BusTransInst.mover('+n+',this,event)" onMouseMove="BusTransInst.move()" onMouseOut="BusTransInst.mout('+n+',this,event)"  >'),s.push('<div id="scheme_'+n+'" class="con" >'),this.routeIndex[n]=[0,0];var o=this.fill(n,0,0);s.push(o),s.push("</div>"),s.push("</li>")}var r=s.join("");return T.G("route_list")&&(T.G("route_list").innerHTML=r),r},fill:function(t,e,i){var s=this.schemes[this.page-1][t-(this.page-1)*this.pagecap];this.routeIndex[t]||(this.routeIndex[t]=[0,0]),this.routeIndex[t]=[e,i];var n=this.routeIndex[t],a=0,o=0,r=n[0],l=s.lines,p=l[r],d=s.stops[r],c=s.exts,u=c[r];s.stops[0].length||(d=s.stops);var h=d.length,m=p.length;this.routePoints[t]||(this.routePoints[t]=[]),this.sWalkPoints[t]||(this.sWalkPoints[t]=[]),this.eWalkPoints[t]||(this.eWalkPoints[t]=[]),this.tWalkPoints[t]||(this.tWalkPoints[t]=[]),this.transPoints[t]||(this.transPoints[t]=[]),this.sTransPoints[t]||(this.sTransPoints[t]=[]),this.routeBound[t]||(this.routeBound[t]=[]),this.sWalkBound[t]||(this.sWalkBound[t]=[]),this.tWalkBound[t]||(this.tWalkBound[t]=[]),this.eWalkBound[t]||(this.eWalkBound[t]=[]),this.tWalkReal[t]||(this.tWalkReal[t]=[]),this.transWins[t]=[],this.switchLines[t]=[],this.changeHtmls[t]||(this.changeHtmls[t]=[]),this.schemeNames[t]&&void 0!=this.clickIndex[t]||(this.schemeNames[t]=[]),this.stopUids[t]||(this.stopUids[t]=[]),this.stopPts[t]||(this.stopPts[t]=[]);var g=[],f=0,v=0;this.busType[t]||(this.busType[t]=[]);var b,y,_,x,w,k,P;for(b=0;m>b;b++)if(y=[],_=p[b],T.isObject(_)){f++,P=_.type||0,1==P&&(this.hasSubway=!0),x=_.name,1==P?x.indexOf("号线")>-1?(k=x.indexOf("环(")>-1?x.substr(0,x.indexOf("环("))+"环)":x,k=k.indexOf("环")>-1?k:k.replace(/\(.*?-(.*?)\)/,"($1")+"方向)",w=x.indexOf("(")>-1?x.substr(0,x.indexOf("(")):x):(k=x,k=k.replace(/\(.*?-(.*?)\)/,"($1")+"方向)",w=x.indexOf("(")>-1?x.substr(0,x.indexOf("(")):x):(k=x.indexOf("(")>-1?x.substr(0,x.indexOf("(")):x,util.isInteger(k)&&(k+="路"),w=k),this.busType[t].push({t:P,n:k});var S=_.uid;a+=_.distance,void 0==this.clickIndex[t]?this.schemeNames[t].push(w):this.clickIndex[t]==b&&this.schemeNames[t].splice(this.clickIndex[t],1,w);var B=mapUtil.parse2Geo(_.geo);this.routeBound[t].push(B.bound),this.routePoints[t].push(B.points),void 0!=this.clickIndex[t]||this.para[t]||(this.stopUids[t].push(_.st_uid),this.stopUids[t].push(_.ed_uid));var I,$,C,L,W=(n[1],[]);for(C=0;C<l.length;C++){I=l[C][b],L=I.name,1==P?L.indexOf("号线")>-1?($=L.indexOf("环(")>-1?L.substr(0,L.indexOf("环("))+"环)":L,$=$.indexOf("环")>-1?$:$.replace(/\(.*?-(.*?)\)/,"($1")+"方向)"):($=L,$=$.replace(/\(.*?-(.*?)\)/,"($1")+"方向)"):($=L.indexOf("(")>-1?L.substr(0,L.indexOf("(")):L,util.isInteger(k)&&($+="路"));var E=I.uid;if(C!=r&&S!=E&&-1==W.toString().indexOf(E)){W.push(E);var R,M=s.stops[C],U=M[b].getOn,O=M[b+1].getOff,N="";if(U.geo&&O.geo)var R=mapUtil.parse2Geo(U.geo).points,N=mapUtil.parse2Geo(O.geo).points;y.push(' <a href="javascript:void(0)" onclick="BusTransInst.show('+t+","+C+","+b+",'"+I.st_uid+"','"+I.ed_uid+"','"+R+"','"+N+'\',event);return false;" onmouseover="BusTransInst.select('+t+","+C+","+b+')" onmouseout="BusTransInst.unselect('+t+","+C+","+b+')">'+$+"</a>")}}var D=changeTS.replace(/#guid#/gi,this.guid);D=this.state[3]&&parseInt(this.state[0])==t&&parseInt(this.state[3])==b?D.replace(/#className#/gi,"sel"):D.replace(/#className#/gi,""),D=D.replace(/#visibility#/gi,"hidden"),D=D.replace(/#uid#/gi,d[b+1].getOff.uid),D=D.replace(/#name#/gi,d[b+1].getOff.name);var j=this.returnLType(P),A="bybus";0==j?A="bybus":1==j?A="bysub":2==j&&(A="byship"),D=D.replace(/#typeClass#/gi,A),D=D.replace(/#tIndex#/gi,t),D=D.replace(/#rIndex#/gi,b),D=D.replace(/#lineName#/gi,k);var G=_.kind,q="";_.tip||(G&&(16&G||1&G||4&G||8&G)&&(q=_.timetable),q&&(D=D.replace(/#bus_type_tip#/gi,'<span class="bus_type_tip_time">运营时间：'+q+"</span>"))),D=D.replace(/#busTypeTip#/gi,"运营时间:"+_.timetable);var o=(_.time/60).toFixed(1);if(D=D.replace(/#transTime#/gi,o),0==b){var z=d[b].getOn,F=(mapUtil.parse2Geo(z.geo).points,this.spliceSN(z.name));D=D.replace(/#getOnName#/gi,F),D=D.replace(/#sIndex#/gi,b+1)}else if(m-6>=b&&0!=b){var z=d[b].getOn,F=(mapUtil.parse2Geo(z.geo).points,this.spliceSN(z.name));D=D.replace(/#getOnName#/gi,F),D=D.replace(/#sIndex#/gi,2*b+1)}var H="";if(b>0&&m-6>=b){{var V=d[b],Q=V.getOff,J=V.getOn,Y=V.walk;mapUtil.parse2Geo(Q.geo).points,mapUtil.parse2Geo(J.geo).points}if(J.name!=Q.name||Y&&Y.distance>=25){H=walkTS.replace(/#guid#/gi,this.guid),H=H.replace(/#tIndex#/gi,t),H=H.replace(/#wIndex#/gi,v),H=H.replace(/#wType#/gi,1),H=this.state[4]&&this.state[5]&&parseInt(this.state[0])==t&&parseInt(this.state[4])==v&&1==parseInt(this.state[5])?H.replace(/#className#/gi,"sel"):H.replace(/#className#/gi,""),H=H.replace(/#visibility#/gi,"hidden"),H=H.replace(/#uid#/,J.uid),H=H.replace(/#name#/,J.name);var Z=Y.distance;if(10>Z?Z="10米":Z>10&&1e3>=Z?Z=10*(Z/10).toFixed(0)+"米":Z>1e3&&(Z=(Z/1e3).toFixed(1)+"公里"),1==this.busType[t][b-1].t&&1==this.busType[t][b].t)H=H.replace(/到达/gi,"换乘"),H=H.replace(/步行至/gi,"站内换乘"),H=H.replace(/#walkName#/gi,k),H=H.replace(/#wInfo#/gi,"{inSubway:1}"),H=H.replace(/#walkDistance#/gi,Z);else{H=H.replace(/#wInfo#/gi,"{}");var F=(Y.ename?"<span>("+T.trim(Y.ename)+")</span>":"","<a class='ks' href='javascript:void(0)'  onclick=\"BusTransInst.clickStop(event,"+t+","+(2*b+1)+');return false;">'+F+"</a>");H=H.replace(/#walkName#/gi,F),H=H.replace(/#walkDistance#/gi,'<a class="cs">'+Z+"</a>")}var K=(Y.time/60).toFixed(1);H=H.replace(/#walkTime#/gi,K),g.push(H)}Y&&v++}var X=_.tip||0,te=this.routeTips[X];if(1==X||2==X){var ee=1==X?_.startTime:_.endTime,ie=te?'<em title="有错过'+te+'风险" ></em><span class="ts_tip_'+X+'" >'+te+ee+"</span>":"";D=D.replace(/#trans_time_tip#/i,ie),D=D.replace(/#bus_type_tip#/i,"")}else D=D.replace(/#trans_time_tip#/i,""),D=D.replace(/#bus_type_tip#/i,"");if(b==m-6){var se=this.spliceSN(d[h-1].getOff.name);D=D.replace(/#getOffName#/gi,se),D=D.replace(/#cIndex#/gi,2*(h-1))}else if(b>=0){var se=this.spliceSN(d[b+1].getOff.name),ne=d[b+1],ae=ne.walk,oe="";ae&&ae.distance>0&&(oe=ae.sname?"<span>("+T.trim(ae.sname)+")</span>":""),D=D.replace(/#getOffName#/gi,se),D=D.replace(/#getOffExit#/gi,oe),D=D.replace(/#cIndex#/gi,2*(b+1))}D=D.replace(/#viaStops#/gi,_.station_num),D=D.replace(/#lineUid#/gi,_.uid),D=D.replace(/#stUid#/gi,_.st_uid),D=D.replace(/#edUid#/gi,_.ed_uid);var Z=(_.distance/1e3).toFixed(1);D=D.replace(/#viaDistance#/gi,Z);var re=y.join(",");this.switchLines[t].push(re),D=re?D.replace(/#changLines#/gi,'<span class="also_t">(或'+re+")</span>"):D.replace(/#changLines#/gi,""),this.changeHtmls[t][b]=D,g.push(this.changeHtmls[t][b])}for(var b=0;h>b;b++){var le=d[b],O=le.getOff,U=le.getOn,N=mapUtil.parse2Geo(O.geo),R=mapUtil.parse2Geo(U.geo),pe=le.walk;if(a+=pe.distance,0==b){var F=this.spliceSN(U.name);if(void 0!=this.clickIndex[t]||this.geoloaded[t]?(this.transPoints[t][2*b]=[N.points,O.name,-1],this.transPoints[t][2*b+1]=[R.points,F,this.busType[t][b].t]):(this.transPoints[t].push([N.points,O.name,-1]),this.transPoints[t].push([R.points,F,this.busType[t][b].t])),this.transPointsDict[O.uid+"_1"]={mercatorLnglat:N.points,uid:this.json.result.start.uid,poiType:"FF0101",name:this.start.wd},this.transPointsDict[U.uid]={mercatorLnglat:R.points,poiType:1==this.busType[t][b].t?"010A03":"010A05",name:U.name},pe&&pe.geo&&pe.distance>0){var de=mapUtil.parse2Geo(pe.geo);try{de.points+=";"+this.transPoints[t][1][0]}catch(ce){}this.sWalkPoints[t].push(de.points),this.sWalkBound[t].push(de.bound),this.sWalkReal[t]=pe.real}void 0!=this.clickIndex[t]||this.para[t]||(this.stopPts[t].push(N.points),this.stopPts[t].push(R.points));var ue=null;le&&le.getOn&&""!=le.getOn.uid&&""!=this.json.result.start.uid&&"1"==this.json.result.start.bus_stop?ue=le.getOn.uid:this.json.result.start&&this.json.result.start.uid&&""!=this.json.result.start.uid&&(ue=this.json.result.start.uid),this.transWins[t].push(transInfo.createTransInfoWnd({title:this.start.wd,curIndex:2*b,total:2*h,obj:this,nextInfo:"到"+F,nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk,transUid:ue}));var se=this.spliceSN(d[1].getOff.name);this.transWins[t].push(transInfo.createTransInfoWnd({title:F+"上车",content:this.getSLHtml(t,b,null,p),curIndex:2*b+1,total:2*h,obj:this,nextInfo:"到"+se+"下车",nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}))}if(b>0&&h-1>b){var se=this.spliceSN(O.name),F=this.spliceSN(U.name);if(void 0!=this.clickIndex[t]||this.geoloaded[t]?(this.transPoints[t][2*b]=[N.points,se,this.busType[t][b-1].t],this.transPoints[t][2*b+1]=[R.points,F,this.busType[t][b].t]):(this.transPoints[t].push([N.points,se,this.busType[t][b-1].t]),this.transPoints[t].push([R.points,F,this.busType[t][b].t])),this.transPointsDict[O.uid]={mercatorLnglat:N.points,poiType:1==this.busType[t][b-1].t?"010A03":"010A05",name:O.name},this.transPointsDict[U.uid]={mercatorLnglat:R.points,poiType:1==this.busType[t][b].t?"010A03":"010A05",name:U.name},pe&&pe.geo&&pe.distance>=0){var de=mapUtil.parse2Geo(pe.geo);try{de.points=this.transPoints[t][2*b][0]+";"+de.points+";"+this.transPoints[t][2*b+1][0]}catch(ce){}this.tWalkPoints[t].push(de.points),this.tWalkBound[t].push(de.bound),this.tWalkReal[t].push(pe.real)}void 0!=this.clickIndex[t]||this.para[t]||(this.stopPts[t].push(N.points),this.stopPts[t].push(R.points));var he="到"+F+"上车";1==this.busType[t][b-1].t&&1==this.busType[t][b].t&&(he="换乘"+this.busType[t][b].n),this.transWins[t].push(transInfo.createTransInfoWnd({title:se+"下车",content:this.getSLHtml(t,b-1,"down",p),curIndex:2*b,total:2*h,obj:this,nextInfo:he,nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}));var se=this.spliceSN(d[b+1].getOff.name);this.transWins[t].push(transInfo.createTransInfoWnd({title:F+"上车",content:this.getSLHtml(t,b,null,p),curIndex:2*b+1,total:2*h,obj:this,nextInfo:"到"+se+"下车",nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}))}if(b==h-1){var se=this.spliceSN(O.name);if(void 0!=this.clickIndex[t]||this.geoloaded[t]||(this.transPoints[t].push([N.points,se,this.busType[t][b-1].t]),this.transPoints[t].push([R.points,U.name,-1])),this.transPointsDict[O.uid]={mercatorLnglat:N.points,poiType:1==this.busType[t][b-1].t?"010A03":"010A05",name:O.name},this.transPointsDict[U.uid+"_2"]={mercatorLnglat:R.points,uid:this.json.result.end.uid,poiType:"FF0102",name:baidu.encodeHTML(this.end.wd)},pe&&pe.geo&&pe.distance>0){var de=mapUtil.parse2Geo(pe.geo);try{var me=this.transPoints[t];de.points=me[me.length-2][0]+";"+de.points}catch(ce){}this.eWalkPoints[t].push(de.points),this.eWalkBound[t].push(de.bound),this.eWalkReal[t]=pe.real}void 0!=this.clickIndex[t]||this.para[t]||(this.stopPts[t].push(N.points),this.stopPts[t].push(R.points)),this.transWins[t].push(transInfo.createTransInfoWnd({title:se+"下车",content:this.getSLHtml(t,b-1,"down",p),curIndex:2*b,total:2*h,obj:this,nextInfo:"到达"+baidu.encodeHTML(this.end.wd),nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk}));var ge="";le&&le.getOff&&""!=le.getOff.uid&&""!=this.json.result.end.uid&&"1"==this.json.result.end.bus_stop?ge=le.getOff.uid:this.json.result.end&&this.json.result.end.uid&&""!=this.json.result.end.uid&&(ge=this.json.result.end.uid),this.transWins[t].push(transInfo.createTransInfoWnd({title:baidu.encodeHTML(this.end.wd),curIndex:2*b+1,total:2*h,obj:this,nextInfo:"",nextTransCbk:this.nextTransCbk,zoomTransCbk:this.zoomTransCbk,transUid:ge}))}}var fe=this.fillScheme(t,h,d,a,g,u);return this.transWndAndLineRelations[t]=this.getTransWndAndLineRelation(h,d,m,p),this.para[t]=!0,fe.join("")},getTransWndAndLineRelation:function(t,e,i,s){var n=[],a=0;n.push(a),a+=1;var o=e[0],r=o.walk;r&&r.distance>0?(n.push(a),a+=1):n.push(a-1);for(var l=0;i>l;l++){var p=s[l];if("object"==typeof p){if(0!=l){var d=e[l],c=d.getOff,u=d.getOn,h=d.walk;l>0&&i-6>=l&&(u.name!=c.name||h&&h.distance>=25)?(n.push(a),a+=1):n.push(a-1)}n.push(a),a+=1}}var m=e[t-1],g=m.walk;return g&&g.distance>0&&(a+=1),n.push(a),n},fillScheme:function(t,e,i,s,n,a){var o=a.time,r=a.price,l=a.walk_distance,p=a.walk_time,d=this.schemeNames[t].join("&nbsp;<span class='rarr'>→</span>&nbsp;"),c=[],u="",h="",m="",g="",f=a.arrive_time||"",v=a.tip||0;this.schemeTipList[t]=v,m=schemeTips[v]?'<em title="'+schemeTips[v]+'" class="scm_tip_'+v+'"></em>':"",u='<span class="bus_time">全程约'+transUtil.formatTime(o,"bustime")+"</span>";var b=a.kind;v||b&&(16&b?g='<span class="bus_type_tip bus_type_4">夜班</span>':1&b?g='<span class="bus_type_tip bus_type_0">假日</span>':4&b?g='<span class="bus_type_tip bus_type_2">高峰</span>':8&b&&(g='<span class="bus_type_tip bus_type_3">定班</span>')),f=3!=v&&""!=f?"约"+this.getFormatTime(f).time+"到达/":"",h=1e3>s?s+"米":(s/1e3).toFixed(1)+"公里";var y=3==v?"way stop":"way";c.push('<p id="blInfo_'+t+'" class="'+y+"\"><span class='hcard'>"+(t+1)+"</span>"+g+d+u+m+"</p>"),c.push('<div id="blDis_'+t+"\" class='kmZ'><span class='time_dis'>"+f+h+"</span>");var _=this.guid+"_favbtn_"+t,x="driveSmSBtnID_"+t,w="drivePrintBtnID_"+t,k="../../../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/;c.push('<span class="i2 printMouseOut" tid=\'busPrintBtn_'+t+"' id='"+w+"' onclick=\"BusTransInst.printBusLine(this, event,"+t+')" onMouseover = "BusTransInst.driveFavBtnMouseOver(this,event,3)" onmouseout = "BusTransInst.driveFavBtnMouseOut(this,event,3)"><a href="javascript:void(0)" title="打印" target=\'Print\'> <img src="'+k+'" alt="打印" /></a></span>'),c.push('<b class="sp">|</b><span tid=\'busFavBtn_'+t+"' id='"+_+'\' class=\'favMouseOut i2\' title="加入收藏夹" onclick="BusTransInst.addToFav(this, event)" onMouseover = "BusTransInst.driveFavBtnMouseOver(this,event,2)" onmouseout = "BusTransInst.driveFavBtnMouseOut(this,event,2)"><img src="'+k+'" alt="加入收藏夹" /></span>'),c.push('<b class="sp">|</b><span class="sendMoileMouseOut i2" id =\''+x+"' tid='busSmSBtn_"+t+'\' title="发送到手机" onclick="BusTransInst.sendSms(this, event);" onMouseover = "BusTransInst.driveFavBtnMouseOver(this,event,1)" onmouseout = "BusTransInst.driveFavBtnMouseOut(this,event,1)"><img src="'+k+'" alt="发送到手机" /></span>'),c.push('<p class="clear"></p>'),c.push("</div>"),1==this.db&&c.push('<p class="debug"><br/>db:[distance:'+s+",time:"+o+",price:"+r+",<br/>walk_distance:"+l+",walk_time:"+p+"]</p>"),c.push(void 0==this.clickIndex[t]?'<div class="info" id="route_'+t+'">':'<div class="info" style="display:block" id="route_'+t+'">');var P="hidden",S=baidu.string.encodeHTML(this.startName),B=baidu.string(S).getByteLength()>34?baidu.string(S).subByte(34)+"...":S,I=[this.guid,t,this.start.wd,i[0].getOff.uid,P,modelConfig.timg,S,B],$=baidu.string.format('<h3 class="no1 arr" onclick="Instance(\'#{0}\').clickStop(event, #{1},0)" ><a data-name="#{2}" data-uid="#{3}_1" href="javascript:void(0);" class="list_street_view_poi" style="visibility:#{4};"><img src="#{5}" /></a><span id="startInfo_#{1}" title="#{6}">#{7}</span></h3>',I);c.push($),c.push('<table id="trans_'+t+'" cellspacing="0" cellpadding="0">');var C=i[0],L=C.walk;if(L&&L.distance>0){var W='<a class="cs">'+this.formatDis(L.distance)+"</a>",E=(L.time/60).toFixed(1),R=(L.ename?"<span>("+T.trim(L.ename)+")</span>":"","<a class='ks' href='javascript:void(0)' onclick=\"BusTransInst.clickStop(event,"+t+',1);return false;">'+this.spliceSN(C.getOn.name)+"</a>"),M=walkTS.replace(/#guid#/gi,this.guid);M=M.replace(/#tIndex#/gi,t),M=M.replace(/#wIndex#/gi,0),M=M.replace(/#wType#/gi,0),M=M.replace(/#walkName#/gi,R),M=M.replace(/#walkDistance#/gi,W),M=M.replace(/#walkTime#/gi,E),M=M.replace(/#wInfo#/gi,"{}"),M=M.replace(/#visibility#/gi,"hidden"),M=M.replace(/#uid#/gi,C.getOn.uid),M=M.replace(/#name#/gi,C.getOn.name),M=this.state[4]&&this.state[5]&&parseInt(this.state[0])==t&&0==parseInt(this.state[4])&&0==parseInt(this.state[5])?M.replace(/#className#/gi,"sel"):M.replace(/#className#/gi,""),c.push(M)}c.push(n.join(""));var U=i[e-1],O=U.walk;if(O&&O.distance>0){var N='<a class="cs">'+this.formatDis(O.distance)+"</a>",D=(O.time/60).toFixed(1),j=walkTS.replace(/#guid#/gi,this.guid);j=j.replace(/#tIndex#/gi,t),j=j.replace(/#wIndex#/gi,0),j=j.replace(/#wType#/gi,2),j=j.replace(/#walkName#/gi,baidu.string.encodeHTML(this.endName)),j=j.replace(/#walkDistance#/gi,N),j=j.replace(/#walkTime#/gi,D),j=j.replace(/#wInfo#/gi,"{}"),j=j.replace(/#visibility#/gi,"hidden"),j=j.replace(/#uid#/gi,U.getOn.uid+"_2"),j=j.replace(/#name#/gi,U.getOn.name),j=this.state[4]&&this.state[5]&&parseInt(this.state[0])==t&&0==parseInt(this.state[4])&&2==parseInt(this.state[5])?j.replace(/#className#/gi,"sel"):j.replace(/#className#/gi,""),c.push(j)}c.push("</table>");var P="hidden",A=baidu.string.encodeHTML(this.endName),G=baidu.string.getByteLength(A)>34?baidu.string.subByte(A,34)+"...":A,I=[this.guid,t,2*e-1,this.end.wd,U.getOn.uid,P,modelConfig.timg,A,G],q=baidu.string.format('<span id="endSpan"><h3 class="no2" onclick="Instance(\'#{0}\').clickStop(event,#{1},#{2})"><a data-name="#{3}" data-uid="#{4}_2" href="javascript:void(0);" class="list_street_view_poi" style="visibility:#{5}";><img src="#{6}" ></a><span id="endInfo_#{1}" title="#{7}">#{8}</span></h3></span>',I);return c.push(q),c.push("</div>"),c},getSLHtml:function(t,e,i,s){var n=this,a=[];return a.push("down"==arguments[2]?"<dl tid='iwLineBox' class='lfs'><dt>"+s[e].name+"</dt>":"<dl tid='iwLineBox' class='lfs'><dt>乘坐"+s[e].name+"</dt>"),a.push('<dd><table cellspacing="1" cellpadding="0" width="100%">'),s[e].startTime&&a.push("<tr><th>起点站首末班时间</th><td>"+s[e].startTime+" - "+s[e].endTime+"</td></tr>"),s[e].zonePrice&&0!=s[e].zonePrice?a.push("<tr><th>地铁全程票价</th><td>"+(s[e].zonePrice/100).toFixed(2)+"元</td></tr>"):1!=n.returnLType(s[e].type)&&s[e].totalPrice&&a.push("<tr><th>单程最高票价</th><td>"+(s[e].totalPrice/100).toFixed(2)+"元</td></tr>"),a.push("</table></dd>"),"down"!=arguments[2]&&""!=n.switchLines[t][e]&&a.push("<dd class='op'>也可乘坐:"+n.switchLines[t][e]+"</dd>"),a.push("</dl>"),a.join("")},setScheme:function(t,e,i,s){this.exportOverlays={routes:[],transMarkers:[],destMarkers:[],tips:[]};var i=i||window.event;i&&util.stopBubble(i),window.searchInViewCtrl&&searchInViewCtrl.exit();var n=this;n.routeIndex[t]||(n.routeIndex[t]=[0,0]),n.schemeIndex!=t?(n.schemeIndex=t,n.addPoiRoute(t,n.routeIndex[t][0],n.routeIndex[t][1]),n.state[0]&&n.state[3]&&(n.highRoute(null,parseInt(n.state[0]),parseInt(n.state[3]),null),n.state[3]=null),n.state[4]&&n.state[5]&&(n.highWalk(null,parseInt(n.state[0]),parseInt(n.state[4]),parseInt(n.state[5]),null),n.state[4]=null,n.state[5]=null)):n.addPoiRoute(t,n.routeIndex[t][0],n.routeIndex[t][1]);try{n.addWalkIcon(n.json.content[n.schemeIndex].stops[0])}catch(i){}if(s=1==this.unfold?2:s,this.unfoldScheme(t,e,i,s),this.hideWalkContent(),this.scrollPanel&&this.scrollPanel.update(),SchemeFaver.isRepeat.call(this,{pathtype:1,dom:T.G(this.guid+"_favbtn_"+t)}),1==this.unfold){var a=this.schemeTipList[t]||0;2==a?addStat("busscheme.blscheme.missedlastbusprpo"+(t+1)):1==a&&addStat("busscheme.blscheme.missedfirstbusprpo"+(t+1))}},unfoldScheme:function(t,e,i,s){var n=this,a=T.G("trans_"+t);if(a&&1==n.loaded)for(var o=0;o<a.rows.length;o++)a.rows[o].className="",n.rindex=-1,n.tindex=-1,n.windex=-1;var r=(n.page-1)*n.pagecap,l=n.page*n.pagecap;l=l<n.total?l:n.total;for(var o=r;l>o;o++){var p=T.G("route_"+o),d=T.G("scheme_"+o),c=d.parentNode;if(t==r&&0==n.loaded&&(T.rc(c,"mover"),T.ac(c,"on"),T.ac(c,"active"),p.style.display="block",T.G("main_result_content")&&(T.G("main_result_content").scrollTop=0),n.loaded=!0),t==o&&1==e){if(s&&1!=s){var u=n.getCurrentStyle(p,"display");"none"!=u?(p.style.display="none",T.rc(c,"active"),n.unfold=0,addStat("busscheme.blscheme.blscheme"+(t+1),"hide")):(p.style.display="block",T.ac(c,"active"),T.rc(c,"mover"),1==n.loaded?addStat("busscheme.blscheme.blscheme"+(t+1),"show"):n.loaded=!0,n.unfold=1)}else p.style.display="block",T.ac(c,"active"),n.unfold=1,addStat("busscheme.blscheme.blscheme"+(t+1),"show");T.rc(c,"mover"),T.ac(c,"on")}else t==o&&0==e?(T.rc(c,"mover"),T.ac(c,"on")):(p.style.display="none",c.className="")}Share.listIndex=t+","+n.unfold+","+n.page},getCurrentStyle:function(t,e){var i=window;return t.currentStyle?t.currentStyle[e]:i.getComputedStyle?(e=e.replace(/([A-Z])/g,"-$1"),e=e.toLowerCase(),i.getComputedStyle(t,"").getPropertyValue(e)):null},removePoi:function(){if(this.transPois){for(var t=0;t<this.transPois.length;t++)map.removeOverlay(this.transPois[t]);this.transPois=null}},removeTip:function(){if(this.zoneStaTips){for(var t=0,e=this.zoneStaTips.length;e>t;t++)map.removeOverlay(this.zoneStaTips[t]);for(var t=0;t<this.zoneBusStopPois.length;t++)this.zoneBusStopPois[t]&&(this.zoneBusStopPois[t].remove(),this.zoneBusStopPois[t]=null)}},removeLine:function(){if(this.routeLines){for(var t=0;t<this.routeLines.length;t++)mapUtil.removeRoute(this.routeLines[t]);this.routeLines=null}if(this.sWalkLines){for(var t=0;t<this.sWalkLines.length;t++)mapUtil.removeRoute(this.sWalkLines[t]);this.sWalkLines=null}if(this.tWalkLines){for(var t=0;t<this.tWalkLines.length;t++)mapUtil.removeRoute(this.tWalkLines[t]);this.tWalkLines=null}if(this.eWalkLines){for(var t=0;t<this.eWalkLines.length;t++)mapUtil.removeRoute(this.eWalkLines[t]);this.eWalkLines=null}this.highLine&&mapUtil.removeRoute(this.highLine)},addPoi:function(t,e){function i(t,e,i,s){if(PanoEntranceUtil.walkThroughPanoEntrances(t,s,"bus"),s&&0!=s.length&&e[0]&&!e[0]._hasPanoThumbnail){e[0]._hasPanoThumbnail=!0;for(var n=0,a=e.length;a>n;n++)e[n]=PanoEntranceUtil.addPanoThumbnailsInInfoWnd([e[n]],[s[i[n]]],s,"bus")[0]}}var s=this.schemes[this.page-1][t-(this.page-1)*this.pagecap],n=this,a=(new BMap.Size(7,-40),n.transPoints[t]);if(a){for(var o=a.length,r={},l={},p=0,d=0;o>p;p++){var c;if(0==p)r={point:a[p][0],text:"",type:constants.DEST_START},this.exportOverlays.destMarkers.push(r),c=mapUtil.addDestPoi(a[p][0],"拖动以更改路线",constants.DEST_START),c.addEventListener("ondragstart",function(t){n.dragStart(t)}),c.addEventListener("ondraging",function(t){n.draging(t)}),c.addEventListener("ondragend",function(t){n.dragEnd(t,0)}),map.mapType!=BMAP_TYPE_DIMENSIONAL&&c.enableDragging(!0),window.startPoi=c,window.startPoi._sc=n.curCity.code;else if(p==o-1)r={point:a[p][0],text:"",type:constants.DEST_END},this.exportOverlays.destMarkers.push(r),c=mapUtil.addDestPoi(a[p][0],"拖动以更改路线",constants.DEST_END),c.addEventListener("ondragstart",function(t){n.dragStart(t)}),c.addEventListener("ondraging",function(t){n.draging(t)}),c.addEventListener("ondragend",function(t){n.dragEnd(t,1)}),map.mapType!=BMAP_TYPE_DIMENSIONAL&&c.enableDragging(!0),window.endPoi=c,window.endPoi._ec=n.curCity.code;else if(p>0&&o-1>p){var u=n.returnLType(a[p][2]),h=0;0==u?h=constants.TRANS_TYPE_BUS:1==u?h=constants.TRANS_TYPE_SUB:2==u&&(h=constants.TRANS_TYPE_BUS),r={point:a[p][0].toString(),type:h,text:a[p][1]},this.exportOverlays.transMarkers.push(r),c=mapUtil.addTransPoi(r.point,r.type,r.text);var m=n.transWins[t][p];if(c.addEventListener("click",n.getClickMarker(m,c,p)),p%2!=0){var g=s.lines[e][d++];if("object"!=typeof g)return;var f=g.name,v=f.indexOf("("),f=v>=0?f.substring(0,v):f;f+=/\D+/.test(f)?"":"路";var b=g.time;l={content:"乘坐"+f+"<span>车程约"+transUtil.formatTime(b)+"</span>",className:"TipC2",opts:{point:c.getPoint(),offset:new BMap.Size(8,-57),style:{background:"url(http://webmap2.map.bdstatic.com/newmap/static/common/images/tip2_04a17e7.gif) 0 0 no-repeat",color:"#000",height:"48px",border:"0",padding:"0 0 0 4px"}}},n.zoneStaTips.push(mapUtil.createTip(l.content,l.className,l.opts)),this.exportOverlays.tips.push(l),this.sTransPoints[t].push(c.getPoint())}}if(c){var y=p,m=(a[y].toString(),n.transWins[t][y]);m&&n.cinfo._popIndex==y&&(n.getClickMarker(m,c,n.cinfo._popIndex)(),n.cinfo._popIndex=null),n.transPois||(n.transPois=[]),n.transPois.push(c)}}if(n.transPois){var _=n.transWins[t][0],x=n.transPois[0];n.openSWin=function(){n.getClickMarker(_,x,0)()},x.addEventListener("click",n.openSWin);var w=n.transWins[t][o-1],k=n.transPois[o-1];n.openEWin=function(){n.getClickMarker(w,k,o-1)()},k.addEventListener("click",n.openEWin)}for(var P,S,B=[],I=T("#scheme_"+t).find(".list_street_view_poi"),p=0;p<I.length;p++)S=I[p].getAttribute("data-uid"),P=this.transPointsDict[S],P||(P={uid:S}),B.push(P);this.panoEntranceData[t]&&this.panoEntranceData[t].length==I.length?i(I,n.transWins[t],n.transWndAndLineRelations[t],n.panoEntranceData[t]):PanoEntranceUtil.insertPanoInfoInSearch(B,"bus",function(e){n.panoEntranceData[t]=e,i(I,n.transWins[t],n.transWndAndLineRelations[t],e)})}},dragStart:function(){this.dateStart=(new Date).getTime()},draging:function(){this.dateEnd=(new Date).getTime();var t=this.dateEnd-this.dateStart;t>10&&this.transPois&&(this.transPois[0].removeEventListener("click",this.openSWin),this.transPois[this.transPois.length-1].removeEventListener("click",this.openEWin))},dragEnd:function(t,e){var i=t.target;if(this.isEndPointDrag=e,i){var s=i.point;s&&mapUtil.getGEORevertAddress(s,function(t){BusTransInst.setNameByCBK(t)})}},setNameByCBK:function(t){function e(t){var e=t.target.getPoint();util.loadSearchInfo(function(i){var s=i.createSearchInfoWnd({title:d},{x:e.lng,y:e.lat,isMenu:!0});i.openSearchInfoWnd(s,t.target),s.addEventListener("open",function(){i.switchInfoWndTab(1,"iw_esn")})})}function i(t){var e=t.target.getPoint();util.loadSearchInfo(function(i){var s=i.createSearchInfoWnd({title:d},{x:e.lng,y:e.lat,isMenu:!0});i.openSearchInfoWnd(s,t.target),s.addEventListener("open",function(){i.switchInfoWndTab(0,"iw_ssn")})})}var s=this,n=window,a=util.getPoiPoint(t.content.point.x+","+t.content.point.y),o=t.content,r=o.address_detail?o.address_detail.city_code:modelConfig.cityCode;if(s.curCity=s.curCity?s.curCity:{code:modelConfig.cityCode},o){var l,p,d=o.address||"未知路段";if(0==this.isEndPointDrag?(searchBox.busSSG1.setValue(d),searchBox.inputInfo.BusSearchSta.note=d,searchBox.inputInfo.BusSearchSta.point=a.lng+","+a.lat,searchBox.driveSSG1.setValue(d),searchBox.inputInfo.DriveSearchSta.note=d,searchBox.inputInfo.DriveSearchSta.point=a.lng+","+a.lat,n.cxtBusPoints[0]={p:a,n:d,t:0},l=r,p=s.curCity.code):(searchBox.busSSG2.setValue(d),searchBox.inputInfo.BusSearchEnd.note=d,searchBox.inputInfo.BusSearchEnd.point=a.lng+","+a.lat,searchBox.driveSSG2.setValue(d),searchBox.inputInfo.DriveSearchEnd.note=d,searchBox.inputInfo.DriveSearchEnd.point=a.lng+","+a.lat,n.cxtBusPoints[1]={p:a,n:d,t:1},p=r,l=s.curCity.code),n.cxtBusPoints[0]&&n.cxtBusPoints[1]){var c=n.cxtBusPoints[0].p.lng+","+n.cxtBusPoints[0].p.lat,u=n.cxtBusPoints[1].p.lng+","+n.cxtBusPoints[1].p.lat,h="bt&c="+modelConfig.cityCode+"&sc="+l+"&ec="+p+"&"+s.getStrategy(s.strategy)+"&sn=1$$$$"+c+"$$"+encodeURIComponent(n.cxtBusPoints[0].n)+"$$$$$$&en=1$$$$"+u+"$$"+encodeURIComponent(n.cxtBusPoints[1].n)+"$$$$$$&rn="+s.pagecap+"&exptype="+s.exptype+"&exptime="+s.exptime+"&version="+s.version;componentManager.go(h,{cinfo:{trafType:s.trafType,isDragStartOrFinishPoint:!0}})}else 0==this.isEndPointDrag?(n.startPoi.addEventListener("click",e),n.startPoi.addEventListener("ondraging",function(){this.closeInfoWindow(),n.startPoi.removeEventListener("click",e)})):(n.endPoi.addEventListener("click",i),n.endPoi.addEventListener("ondraging",function(){this.closeInfoWindow(),n.endPoi.removeEventListener("click",i)}))}else if(s.transPois){var c=util.getPointByStr(s.startPoint);s.transPois[0].setPoint(c);var u=util.getPointByStr(s.endPoint);s.transPois[s.transPois.length-1].setPoint(u)}},addRoute:function(t){currentlines=[];var e=this.routePoints[t],i={};if(e){for(var s=0;s<e.length;s++){i={points:e[s].toString(),type:constants.ROUTE_TYPE_BUS},this.exportOverlays.routes.push(i);var n=mapUtil.addRoute(i.points,i.type);this.routeLines||(this.routeLines=[]),this.routeLines.push(n)
}for(var a=this.sWalkPoints[t],s=0;s<a.length;s++){this.sWalkLines||(this.sWalkLines=[]),1==this.sWalkReal[t]?(i={points:a[s].toString(),type:constants.ROUTE_TYPE_WALK},currentlines.push(this.sWalkPoints[t][0])):i={points:a[s].toString(),type:constants.ROUTE_TYPE_BADWAY};var o=mapUtil.addRoute(i.points,i.type);this.exportOverlays.routes.push(i),this.sWalkLines.push(o)}for(var r=this.tWalkPoints[t],s=0;s<r.length;s++){this.tWalkLines||(this.tWalkLines=[]),1==this.tWalkReal[t][s]?(i={points:r[s].toString(),type:constants.ROUTE_TYPE_WALK},currentlines.push(this.tWalkPoints[t][s])):i={points:r[s].toString(),type:constants.ROUTE_TYPE_BADWAY};var o=mapUtil.addRoute(i.points,i.type);this.exportOverlays.routes.push(i),this.tWalkLines.push(o)}for(var l=this.eWalkPoints[t],s=0;s<l.length;s++){this.eWalkLines||(this.eWalkLines=[]),1==this.eWalkReal[t]?(i={points:l[s].toString(),type:constants.ROUTE_TYPE_WALK},currentlines.push(this.eWalkPoints[t][0])):i={points:l[s].toString(),type:constants.ROUTE_TYPE_BADWAY};var o=mapUtil.addRoute(i.points,i.type);this.exportOverlays.routes.push(i),this.eWalkLines.push(o)}this.exportOverlays.arrows=currentlines,this.redrawArrow()}},addTempRoute:function(t){var e=this.routePoints[t];if(e){this.tempLineIndex=t;for(var i=0;i<e.length;i++){var s=mapUtil.addRoute(e[i].toString(),constants.ROUTE_TYPE_TEMP_BUS);this.tempRouteLines||(this.tempRouteLines=[]),this.tempRouteLines.push(s)}for(var n=this.sWalkPoints[t],i=0;i<n.length;i++){var a=mapUtil.addRoute(n[i].toString(),constants.ROUTE_TYPE_TEMP_WALK);this.sTempWalkLines||(this.sTempWalkLines=[]),this.sTempWalkLines.push(a)}for(var o=this.tWalkPoints[t],i=0;i<o.length;i++){var a=mapUtil.addRoute(o[i].toString(),constants.ROUTE_TYPE_TEMP_WALK);this.tTempWalkLines||(this.tTempWalkLines=[]),this.tTempWalkLines.push(a)}for(var r=this.eWalkPoints[t],i=0;i<r.length;i++){var a=mapUtil.addRoute(r[i].toString(),constants.ROUTE_TYPE_TEMP_WALK);this.eTempWalkLines||(this.eTempWalkLines=[]),this.eTempWalkLines.push(a)}}},removeTempLine:function(){if(this.tempRouteLines){for(var t=0;t<this.tempRouteLines.length;t++)mapUtil.removeRoute(this.tempRouteLines[t]);this.tempRouteLines=null}if(this.sTempWalkLines){for(var t=0;t<this.sTempWalkLines.length;t++)mapUtil.removeRoute(this.sTempWalkLines[t]);this.sTempWalkLines=null}if(this.tTempWalkLines){for(var t=0;t<this.tTempWalkLines.length;t++)mapUtil.removeRoute(this.tTempWalkLines[t]);this.tTempWalkLines=null}if(this.eTempWalkLines){for(var t=0;t<this.eTempWalkLines.length;t++)mapUtil.removeRoute(this.eTempWalkLines[t]);this.eTempWalkLines=null}},addPoiRoute:function(t,e,i){map.closeInfoWindow(),this.removeLine(),this.removePoi(),this.removeTip(),this.addRoute(t,e,i),this.addPoi(t,e,i);var s;this.routeBound[t]&&(s=this.routeBound[t].concat(this.sWalkBound[t],this.tWalkBound[t],this.eWalkBound[t]));var n=util.getBPoints(s);if(this.cinfo._maplevel&&this.cinfo._centerPoint)map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel),this.cinfo._centerPoint=null,this.cinfo._maplevel=null;else if(n){if(map.mapType==BMAP_TYPE_DIMENSIONAL){var a=BMap.MapType[BMAP_TYPE_DIMENSIONAL].citys,o=a[map.currentCity][1],r=util.getPointsBounds(n),l=mapUtil.getBitLevel(r);o.intersects(r)?(15>=l&&(l=15),map.centerAndZoom(window.startPoi.getPoint(),l)):(maptypeCtrl.select(BMAP_TYPE_NORMAL),mapUtil.setViewport(n,this.expend))}else mapUtil.setViewport(n,this.expend);this.mapZoomLevel=map.zoomLevel}},getClickMarker:function(t,e,i){return function(){Share.popIndex=i,transInfo.transInfoWindow(e,t)}},close:function(){},show:function(t,e,i,s,n,a,o,r){var r=r||window.event,l=this;util.stopBubble(r),l.redRoute&&mapUtil.unSelectRoute(l.redRoute),l.clickIndex[t]=i,l.routeIndex[t]=[e,i],l.stopUids[t][2*i]=s,l.stopUids[t][2*i+1]=n,l.stopPts[t][2*i+1]=a,l.stopPts[t][2*i+2]=o;var p=l.schemes[l.page-1][t-(l.page-1)*l.pagecap].stops[e],d=p[0].getOff,c=p[p.length-1].getOn,u=l.stopPts[t][0]=mapUtil.parse2Geo(d.geo).points,h=l.stopPts[t][l.stopPts[t].length-1]=mapUtil.parse2Geo(c.geo).points;l.routePoints[t]=[],l.sWalkPoints[t]=[],l.tWalkPoints[t]=[],l.eWalkPoints[t]=[],l.routeBound[t]=[],l.sWalkBound[t]=[],l.tWalkBound[t]=[],l.eWalkBound[t]=[];var m=l.routePoints[t];if(m&&0!=m.length){l.schemeIndex=t,T.G("scheme_"+t).innerHTML=l.fill(t,e,i);for(var g=0,f=l.transPoints[t].length;f>g;g++)l.transPoints[t][g][0]=l.stopPts[t][g];l.addPoiRoute(t,e,i);var v=T.G("route_"+t);v.style.display="block"==v.style.display?"none":"block"}else{var b="blg&blgtp=0&c="+l.currentCity+"&sn="+u+"&en="+h+"&uids=["+l.stopUids[t].join(",")+"]";searchData.fetch(b,function(s){l.callbackWalkLine(s,t,e,i)})}},callbackWalkLine:function(t,e,i,s){var n=this,a=t.content;if(a){n.routeBound[e]||(n.boundBound[e]=[]);var o=a.line,r=n.schemes[n.page-1][e-(n.page-1)*n.pagecap];if(o)for(var l=r.lines[i],p=0;p<o.length;p++){var d=o[p];l[p].geo=d.geo}var c=a.walk;if(c.length>0)for(var u=r.stops[i],h=0;h<c.length;h++)u[h].walk.distance=c[h].dis,u[h].walk.geo=c[h].geo,0!=h&&h!=c.length-1&&this.tWalkReal[e].push(c[h].real),"sname"in c[h]&&(u[h].walk.sname=c[h].sname),"ename"in c[h]&&(u[h].walk.ename=c[h].ename);n.schemeIndex=e;for(var p=0,m=n.transPoints[e].length;m>p;p++)n.transPoints[e][p][0]=n.stopPts[e][p];T.G("scheme_"+e).innerHTML=n.fill(e,i,s),c.length>0&&(this.sWalkReal[e]=c[0].real,this.eWalkReal[e]=c[c.length-1].real),n.addPoiRoute(e,i,s)}try{n.addWalkIcon1(c)}catch(g){}},select:function(){},unselect:function(){this.highLine&&mapUtil.removeRoute(this.highLine)},mover:function(t,e,i){var s=this,n=window,i=i||n.event;if(s.routeIndex[t]||(s.routeIndex[t]=[0,0]),n._clearTempLineTimer&&clearTimeout(n._clearTempLineTimer),s.schemeIndex!=t&&s.tempLineIndex!=t){s.removeTempLine(),n._addTempLineTimer&&clearTimeout(n._addTempLineTimer),n._addTempLineTimer=setTimeout(function(){s.addTempRoute(t,s.routeIndex[t][0],s.routeIndex[t][1])},100);for(var a=e.parentNode.getElementsByTagName("li"),o=0;o<a.length;o++)o==t%s.pagecap?T.ac(a[o],"mover"):s.schemeIndex%s.pagecap!=o&&T.rc(a[o],"mover")}},mout:function(t,e,i){{var i=i||window.event,s=this,n=window;i.srcElement||i.target}window._addTempLineTimer&&clearTimeout(window._addTempLineTimer),n._clearTempLineTimer=setTimeout(function(){if(s.removeTempLine(),e.parentNode){for(var t=e.parentNode.getElementsByTagName("li"),i=0;i<t.length;i++)s.schemeIndex%s.pagecap!=i&&(t[i].className="");s.tempLineIndex=null,s.clearTempRoute&&s.clearTempRoute()}},10)},move:function(){window._clearTempLineTimer&&clearTimeout(window._clearTempLineTimer)},trOver:function(t,e){baidu(e).addClass("over")},trOut:function(t,e){baidu(e).removeClass("over")},cancelClick:function(t,e){var e=e||window.event;util.stopBubble(e)},setValue:function(t){var e=T.G("destTable_"+this.guid),i=e.rows[t],s=i.cells[1],n=i.cells[2];n.innerHTML='<input type="submit" value="确定" onclick="BusTransInst.submit('+t+')" class="btn">',s.innerHTML='<input id="dest_#guid#_2" type="text"  class="ipt" value="'+s.innerHTML+'">',s.firstChild.focus()},submit:function(t){var e=T.G("destTable_"+this.guid),i=e.rows[t],s=i.cells[1].childNodes[0];i.cells[1].innerHTML=s.value,i.cells[2].className="modify",i.cells[2].innerHTML='<a href="javascript:void(0)" onclick="BusTransInst.setValue('+t+');return false;">修改</a>';for(var n=e.rows.length,a=[],o=0;n>o;o++){var r=e.rows[o].cells[1].childNodes[0];if(r){var l=parseInt(r.nodeType);1==l&&a.push(r.value),3==l&&a.push(r.nodeValue)}}a[0]&&a[1]&&(a[0]!=this.startName||a[1]!=this.endName)&&componentManager.go("bt&c="+this.currentCity+"&"+this.getStrategy(this.strategy)+"&sn=2$$$$$$"+encodeURIComponent(a[0])+"$$$$$$&en=2$$$$$$"+encodeURIComponent(a[1])+"$$$$$$&exptype="+this.exptype+"&exptime="+this.exptime+"&version="+this.version,{cinfo:{trafType:me.trafType}})},round:function(t,e){for(var i=1;e>0;i*=10,e--);for(;0>e;i/=10,e);return Math.round(t*i)/i},nextTransCbk:function(t,e){var i=e.transWins[e.schemeIndex][t],s=e.transPois[t];e.panoEntranceData[e.schemeIndex]&&(s.panoData=e.panoEntranceData[e.schemeIndex][t]),transInfo.transInfoWindow(s,i)},zoomTransCbk:function(t,e){var i=BMap.MapType[map.mapType].zoomLevelMax;map.zoomTo(0==t?i:e.mapZoomLevel!=map.zoomLevel?e.mapZoomLevel:i-3)},highRoute:function(t,e,i,s){this.hideWalkContent(),map.closeInfoWindow(),this.removeTip();var t=t||window.event;t&&util.stopBubble(t);var n=[this.routeBound[e][i]],a=util.getBPoints(n);if(this.cinfo._maplevel&&this.cinfo._centerPoint?(map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel),this.cinfo._centerPoint=null,this.cinfo._maplevel=null):a&&(mapUtil.setViewport(a,this.expend),this.mapZoomLevel=map.zoomLevel),s)for(var o=s.parentNode.getElementsByTagName("tr"),r=0;r<o.length;r++)o[r].className=o[r]==s?"sel":"";this.redRoute&&mapUtil.unSelectRoute(this.redRoute),this.routeLines&&(this.redRoute=this.routeLines[i],mapUtil.selectRoute(this.redRoute)),this.tindex=-1,this.windex=-1,this.rindex=i,Share.listIndex=e+","+this.unfold+","+this.page+","+this.rindex},WalkContent:function(t,e,i,s,n){var a=this,o=(t.parentNode.parentNode.id,""),r="",l="",p="",d=this.schemes[this.page-1][e-(this.page-1)*this.pagecap],c=d.stops[this.routeIndex[e][0]],u=d.lines[this.routeIndex[e][0]],h="";n=n||{};var m=0,g=1;if(0==i)o=a.startPoint,r=mapUtil.parse2Geo(c[0].getOn.geo).points,c[0].walk.ename&&(r=a.getPointFromLine(0,1,c)),l=a.start.wd,p=c[0].getOn.name,m=a.getDistance(c[0].walk.distance),g=2;else if(1!=i||n.inSubway){if(2!=i)return void a.hideWalkContent();g=1,o=mapUtil.parse2Geo(c[c.length-1].getOff.geo).points,c[c.length-1].walk.sname&&(o=a.getPointFromLine(c.length-1,0,c)),h=a.getWalkDirection(c.length-2,c.length-1,u,c),r=a.endPoint,l=c[c.length-1].getOff.name,p=a.end.wd,m=a.getDistance(c[c.length-1].walk.distance)}else o=mapUtil.parse2Geo(c[s+1].getOff.geo).points,c[s+1].walk.sname&&(o=a.getPointFromLine(s+1,0,c)),h=a.getWalkDirection(s,s+1,u,c),r=mapUtil.parse2Geo(c[s+1].getOn.geo).points,c[s+1].walk.ename&&(r=a.getPointFromLine(s+1,1,c)),l=c[s+1].getOff.name,p=c[s+1].getOn.name,m=a.getDistance(c[s+1].walk.distance),""!=c[s+1].walk.sname?g=1:""!=c[s+1].walk.ename&&(g=2);if(this.WalkContent.openId&&this.WalkContent.openId!="tr_"+e+"_"+i+"_"+s&&this.hideWalkContent(),T.G("tr_"+e+"_"+i+"_"+s)){if(this.WalkContent.openId=="tr_"+e+"_"+i+"_"+s||"none"!=T.G("tr_"+e+"_"+i+"_"+s).style.display)return a.hideWalkContent("self"),void a.scrollPanel.update();t.className="sel_td",T.G("tr_"+e+"_"+i+"_"+s).style.display="",T.G("tr_"+e+"_"+i+"_"+s).className="sel",t.style.cursor="default",a.scrollPanel.update()}else{var f="walk&version=2.0&walktp=1&c="+a.currentCity+"&wdrag=0&sc="+a.currentCity+"&ec="+a.currentCity+"&"+a.getStrategy(a.strategy)+"&en=1$$$$"+r+"$$"+encodeURIComponent(p)+"$$$$$$&sn=1$$$$"+o+"$$"+encodeURIComponent(l)+"$$$$$$&sq="+encodeURIComponent(l)+"&eq="+encodeURIComponent(p)+"&region="+i,a=this;searchData.fetch(f,function(n){a.getWalkPlans(n,{showDistance:m,addDistanOn:g,walkDirection:h,endWd:p,m:i,n:e,w:s,obj:t})})}this.WalkContent.openId="tr_"+e+"_"+i+"_"+s,this.WalkContent.navDom=t},getWalkPlans:function(t,e){var i=this,s=e.showDistance,n=e.addDistanOn,a=e.walkDirection,o=e.endWd,r=e.m,l=e.n,p=e.w,d=e.obj,c=t.content.kps;rss=t.content.rss;var u=[""];if(c&&rss){u.push('<table id="table_info" width="100%" border="0" cellspacing="0" cellpadding="0">');for(var h=c.length,m=0,g=0,f=0;h>f;f++){var v=c[f].rt,b=parseInt(rss[f].d),y=0;y=10>=b?10:1e3>b?10*(b/10).toFixed(0):1e3*(b/1e3).toFixed(1),f>0&&h-1>f&&(g+=y)}for(var f=0;h>f;f++){var v=c[f].rt,b=parseInt(rss[f].d),_="",x=1,w=s-g;if(1==n?x=1:2==n&&(x=h-2),f==x&&w>0&&(b+=w),_=10>=b?"10米":1e3>b?10*(b/10).toFixed(0)+"米":(b/1e3).toFixed(1)+"公里",0==f)u.push("<tr>"),u.push("<th>"+(m+1)+".</th>"),u.push("<td>"),u.push('<a data-point="'+mapUtil.parse2Geo(c[f].pt).points+'" data-poitype="" href="javascript:void(0);" class="list_street_view_poi walk_street_view" style="visibility:hidden"><img src="'+modelConfig.timg+'" ></a>'),u.push(0==r?"从<span>起点</span>向<span>"+turtype[c[0].tt]+"</span>出发，"+a:a);else if(1==f){var k=i.getPreRoadStr(rss[f],f>0?rss[f-1]:null),P=T.trim(rss[f+1].n);k=""==k?roadtype[rss[f].t]:k,P=""==P?roadtype[rss[f+1].t]:P;var S="进入",B=rss[f+1].t;9==B||12==B?S="上":(0==B||B>=22||rss[f].n==rss[f+1].n&&1!=B)&&(S="",P=""),(9==c[f].tt||10==c[f].tt||11==c[f].tt||12==c[f].tt)&&(S="",P="");var I=i.getTurStr(c[f].tt,rss[f].wt,c[f].extt),$=20==rss[f].t||21==rss[f].t?"<span>离开"+rss[f].n+"</span>，":"",C=rss[f].t>=22?"":rettype[c[f].rt]+_;if(u.push(k+C+"，"+$+"<span>"+I+"</span>"+S+"<span>"+P+"</span>"),3==c[f+1].rt){var v=c[f+1].rt,L=rettype[v];u.push("到达<span>"+L+"</span>")}h>3&&u.push("</td></tr>"),m++}else if(f==h-2){var k=i.getPreRoadStr(rss[f],f>0?rss[f-1]:null);k=""==k?roadtype[rss[f].t]:k,u.push("<tr>"),u.push("<th>"+(m+1)+".</th>");var $="",I=i.getTurStr(c[f].tt,rss[f].wt,c[f].extt),C=rss[f].t>=22?"":rettype[c[f].rt]+_;u.push("<td>"),u.push('<a data-point="'+mapUtil.parse2Geo(c[f].pt).points+'" data-poitype="" href="javascript:void(0);" class="list_street_view_poi walk_street_view" style="visibility:hidden"><img src="'+modelConfig.timg+'" ></a>'),u.push(k+C+$+I);{mapUtil.parse2Geo(rss[f].g)}m++}else if(f==h-1&&2==v){var W=i.spliceSN(o);2==r&&(W="终点"),h>3?u.push("，到达<strong>"+W+"</strong>"):(3==h&&0!=rss[1].wt&&u.push("，"),u.push("到达<strong>"+W+"</strong>")),u.push("</td>"),u.push("</tr>")}else if(h-2>f&&3!=v){var k=i.getPreRoadStr(rss[f],f>0?rss[f-1]:null),P=rss[f+1].n;k=""==k?roadtype[rss[f].t]:k,P=""==P?roadtype[rss[f+1].t]:P,k=T.trim(k),P=T.trim(P);var v=c[f+1].rt,S="进入",B=rss[f+1].t;if(9==B||12==B?S="上":(0==B||B>=22||rss[f].n==rss[f+1].n&&1!=B)&&(S="",P=""),u.push("<tr>"),u.push("<th>"+(m+1)+".</th>"),(9==c[f].tt||10==c[f].tt||11==c[f].tt||12==c[f].tt)&&(S="",P=""),u.push("<td>"),u.push('<a data-point="'+mapUtil.parse2Geo(c[f].pt).points+'" data-poitype="" href="javascript:void(0);" class="list_street_view_poi walk_street_view" style="visibility:hidden"><img src="'+modelConfig.timg+'" ></a>'),3==v){var L=rettype[v];u.push("<td>"+k+rettype[c[f].rt]+_+"，到达<span>"+i.spliceSN(L)+"</span></td>")}else{var I=i.getTurStr(c[f].tt,rss[f].wt,c[f].extt),$=20==rss[f].t||21==rss[f].t?"<span>离开"+rss[f].n+"</span>，":"",C=rss[f].t>=22?"":rettype[c[f].rt]+_;u.push(k+C+"，"+$+"<span>"+I+"</span>"+S+"<span>"+P+"</span>")}u.push("</td>"),u.push("</tr>"),m++}}u.push("</table>")}var E=document.createElement("tr");E.id="tr_"+l+"_"+r+"_"+p;var R=document.createElement("td");E.className="sel",R.innerHTML="<div class='walk_div'>"+u.join("")+"</div><span onclick='BusTransInst.hideWalkContent(\"bt\")' class='closeWalkInfo'>收起</span>",R.setAttribute("colSpan","2"),R.onclick=function(t){util.stopBubble(t)},E.appendChild(R),T.dom.insertAfter(E,d),d.className="sel_td",i.scrollPanel.update();for(var M=[],U=T(R).find(".list_street_view_poi"),f=0;f<U.length;f++)M.push({mercatorLnglat:U[f].getAttribute("data-point"),poiType:U[f].getAttribute("data-poitype"),name:U[f].getAttribute("data-name")});var O=this.panoEntranceData[e.n];PanoEntranceUtil.insertPanoInfoInSearch(M,"buswalk",function(t){PanoEntranceUtil.walkThroughPanoEntrances(U,t,"buswalk",O)})},hideWalkContent:function(t){this.WalkContent.openId&&T.G(this.WalkContent.openId)&&this.WalkContent.navDom&&(T.G(this.WalkContent.openId).style.display="none","self"==t||"bt"==t?(this.WalkContent.navDom.className="sel",this.WalkContent.navDom.style.cursor="pointer"):this.WalkContent.navDom.className="",this.WalkContent.openId="",this.WalkContent.navDom=""),this.scrollPanel&&this.scrollPanel.update()},getTurStr:function(t,e,i){var s="";if(e>0){var n=i>0?21==t||22==t?"<span>"+turtype1[i]+"</span>，":"<span>"+turtype1[i]+"过"+worktype[e]+"</span>，":"<span>过"+worktype[e]+"</span>，";t>0&&13>t?s=n+turtype[t]:t>=21?s=n+turtype[t].replace(/#WalkType#/gi,"<span>"+worktype[e]+"</span>"):(s="<span>"+turtype1[i]+"过"+worktype[e]+"</span>",0!=t&&(s+="，"))}else s=turtype[t].replace(/#WalkType#/gi,"<span>"+worktype[e]+"</span>");return s},getPreRoadStr:function(t,e){var i=e&&t.n==e.n?"继续":"",s=""==t.n?roadtype[t.t]:"过街天桥"==t.n?"天桥":t.n,n=t.t>=22?"过":"沿";return 0==t.d?0==t.wt?""==s?"":"至<span>"+s+"</span>":"过<span>"+worktype[t.wt]+"</span>至<span>"+s+"</span>":""==roadtype[t.t]?"":i+n+"<span>"+s+"</span>"},highWalk:function(t,e,i,s,n){map.closeInfoWindow(),this.removeTip();var t=t||window.event;if(t&&util.stopBubble(t),n)for(var a=n.parentNode.getElementsByTagName("tr"),o=0;o<a.length;o++)a[o].className=a[o]==n?"sel":"";this.redRoute&&(mapUtil.unSelectRoute(this.redRoute),this.redRoute=null),s=parseInt(s);var r=[];switch(s){case 0:this.sWalkLines[i]&&(this.redRoute=this.sWalkLines[i],r.push(this.sWalkBound[e][i]));break;case 1:this.tWalkLines[i]&&(this.redRoute=this.tWalkLines[i],r.push(this.tWalkBound[e][i]));break;case 2:this.eWalkLines&&this.eWalkLines[i]&&(this.redRoute=this.eWalkLines[i],r.push(this.eWalkBound[e][i]))}var l=util.getBPoints(r);this.cinfo._maplevel&&this.cinfo._centerPoint?(map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel),this.cinfo._centerPoint=null,this.cinfo._maplevel=null):l&&(mapUtil.setViewport(l,this.expend),this.mapZoomLevel=map.zoomLevel),mapUtil.selectRoute(this.redRoute),this.redrawArrow();var p=this;setTimeout(function(){p.redrawArrow()},300),this.rindex=-1,this.tindex=s,this.windex=i,Share.listIndex=e+","+this.unfold+","+this.page+","+this.rindex+","+this.windex+","+this.tindex},highZoneSta:function(t,e,i,s,n,a){map.closeInfoWindow(),this.removeTip();var o=this,r=this.schemes[this.page-1][n-(this.page-1)*this.pagecap],l=r.stops[0][a+1].getOff,p=mapUtil.parse2Geo(l.geo).points,d="bsl&newmap=1&c="+this.currentCity+"&uid="+e+"&suid="+i+"&euid="+s+"&ie=utf-8&t="+(new Date).getTime();searchData.fetch(d,function(t){var e=t.content[0],i=e.stations;o.zoneStaPoints=[],o.zoneBusStopPois=[],o.zoneStaTips=[];for(var s=0,n=i.length;n>s;s++)!function(){var t=s,n=util.parseGeo(i[t].geo);if(1==n.type){var a=mapUtil.addBusStopPoi(n.points,i[t].name);o.zoneBusStopPois.push(a),o.zoneStaPoints.push(util.getPoiPoint(n.points)),o.zoneStaTips.push(mapUtil.createTip(e.stations[s].name,"TipC",{point:util.getPointByStr(n.points)}))}}();o.zoneStaPoints.push(p),o.zoneStaTips.push(mapUtil.createTip(l.name,"TipC",{point:util.getPointByStr(p)}))})},clickStop:function(t,e,i){if(this.transPois){var s=this.transPois[i];this.panoEntranceData[e]&&(s.panoData=this.panoEntranceData[e][i]);var n=this.transWins[e][i],a=s.getPoint();transInfo.transInfoWindow(s,n,{ccode:this.currentCity}),this.isOperated?util.isInBounds(a)||map.setCenter(a):map.centerAndZoom(a,18)}util.stopBubble(t)},returnBus:function(){var t=1==this.sBus?0:1,e=1==this.eBus?0:1,i=this;i.cinfo&&1==i.cinfo.isSingle&&(i.cinfo.t=0==i.cinfo.t?1:0),i.cinfo.trafType=i.trafType;var s="bt&c="+this.currentCity+"&"+i.getStrategy(i.strategy)+"&sn="+e+"$$"+this.euid+"$$"+this.endPoint+"$$"+encodeURIComponent(this.end.wd)+"$$$$$$&en="+t+"$$"+this.suid+"$$"+this.startPoint+"$$"+encodeURIComponent(this.start.wd)+"$$$$$$&sq="+encodeURIComponent(this.e_query)+"&eq="+encodeURIComponent(this.s_query)+"&exptype="+this.exptype+"&exptime="+this.exptime+"&version="+this.version;componentManager.go(s,{cinfo:i.cinfo})},backAddr:function(){var t=this;t.cinfo&&1==t.cinfo.isSingle?(t.cinfo.trafType=t.trafType,componentManager.go(t.cinfo.q+"&src=4",{cinfo:t.cinfo})):componentManager.go("bt&c="+this.currentCity+"&sn=2$$"+this.suid+"$$"+this.startPoint+"$$"+encodeURIComponent(this.s_query)+"$$$$$$&en=2$$"+this.euid+"$$"+this.endPoint+"$$"+encodeURIComponent(this.e_query)+"$$$$$$&src=4&exptype="+this.exptype+"&exptime="+this.exptime+"&version="+this.version,{cinfo:{trafType:t.trafType}})},getNavQuery:function(){var t=this;return t.navQueryString},navigate:function(){addStat("busscheme.blscheme.noblavlchknav"),searchBox.setSwitchTab(3);var t=this;t.cinfo&&1==t.cinfo.isSingle&&(t.cinfo.q=t.cinfo.q.replace(/^bse&/,"nse&")),searchBox._ByClickTab=!1,componentManager.go(t.navQueryString,{cinfo:t.cinfo})},navWalk:function(){var t=this;t.cinfo&&1==t.cinfo.isSingle&&(t.cinfo.q=t.cinfo.q.replace(/^bse&/,"nse&")),componentManager.go("walk&version=2.0&walktp=1&c="+t.currentCity+"&wdrag=0&sc="+t.currentCity+"&ec="+t.currentCity+"&"+t.getStrategy(t.strategy)+"&en=1$$$$"+t.endPoint+"$$"+encodeURIComponent(t.end.wd)+"$$$$$$&sn=1$$$$"+t.startPoint+"$$"+encodeURIComponent(t.start.wd)+"$$$$$$&sq="+encodeURIComponent(t.s_query)+"&eq="+encodeURIComponent(t.e_query),{cinfo:t.cinfo})},returnLType:function(t){var e,i,s,n,a=this.lineType.length;for(e=0;a>e;e++)for(s=this.lineType[e],i=0;i<s.length;i++)if(n=s[i],n==t)return e},getStrategy:function(t){return 1==this.trafType?"sy="+t+"&f="+this.noSbwQuery:"sy="+t},spliceSN:function(t){var e=t.substring(t.length-1);return"站"==e?t:t+"站"},formatDis:function(t){return 10>t?t="10米":t>10&&1e3>=t?t=10*(t/10).toFixed(0)+"米":t>1e3&&(t=(t/1e3).toFixed(1)+"公里"),t},getTaxi:function(t){var e=this,i=e.navQueryString;e.cinfo&&1==e.cinfo.isSingle&&(e.cinfo.q=e.cinfo.q.replace(/^bse&/,"nse&")),i.indexOf("&sy=0")>=0&&(i=i.replace("&sy=0","&sy=1")),taxi.openTaxi(t,{data:this.json.taxi,from:"sd"})},busTranFor3D:function(t){window.startPoi&&(t?window.startPoi.enableDragging():window.startPoi.disableDragging(),window.startPoi.setTitle("")),window.endPoi&&(t?window.endPoi.enableDragging():window.endPoi.disableDragging(),window.endPoi.setTitle(""))},addWalkIcon:function(t){for(var e=0,i=this.walkMkrs.length;i>e;e++)map.removeOverlay(this.walkMkrs[e]);this.walkMkrs=[];for(var e=0,i=t.length;i>e;e++)if(t[e].walk&&t[e].walk.wfi)for(var s=t[e].walk.wfi.split("|"),n=1,a=s.length;a>n;n++)this._addWalkIcon(s[n])},addWalkIcon1:function(t){for(var e=0,i=this.walkMkrs.length;i>e;e++)map.removeOverlay(this.walkMkrs[e]);this.walkMkrs=[];for(var e=0,i=t.length;i>e;e++)if(t[e].wfi)for(var s=t[e].wfi.split("|"),n=1,a=s.length;a>n;n++)this._addWalkIcon(s[n])},_addWalkIcon:function(t){function e(){map.getZoom()<16?T.browser.ie>=8?setTimeout(function(){r&&r.hide()},100):r&&r.hide():r&&r.show()}var i=t.split("$"),s=util.getPoiPoint(mapUtil.parse2Geo(i[1]).points),n=[{wd:"非步行设施"},{wd:"人行道"},{wd:"天桥",img:[0,-20],w:18},{wd:"地下通道",img:[0,0],w:18},{wd:"人行通道"},{wd:"直梯"},{wd:"扶梯"},{wd:"阶梯"},{wd:"斜坡"},{wd:"索道"},{wd:"广场",img:[0,-40],w:18}],a=n[1*i[0]];if(a&&a.img){var o=new BMap.Icon("../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/walkflag_16127a7.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/walkflag_16127a7.png*/,new BMap.Size(a.w,a.w),{offset:new BMap.Size(a.w/2,a.w/2),imageOffset:new BMap.Size(a.img[0],a.img[1])}),r=new BMap.Marker(s,{icon:o});map.addOverlay(r),this.walkMkrs.push(r),map.getZoom()<16?r.hide():r.show(),map.addEventListener("zoomend",e),r.addEventListener("remove",function(){map.removeEventListener("zoomend",e)});var l=new BMap.Label(a.wd);map.addOverlay(l),l.setStyle({backgroundColor:"#EEFFED",borderColor:"#6D8760",color:"#4D6B37",lineHeight:"16px",paddingTop:"0px",paddingBottom:"0px"}),l.setPoint(s),l.setOffset(new BMap.Size(1*a.w/2+2,0-1*a.w/2)),l.hide();var p=!1;r.addEventListener("onmouseover",function(){p=!0,setTimeout(function(){p&&l.show()},500)}),r.addEventListener("onmouseout",function(){l.hide(),p=!1})}},addToFav:function(t,e){var i=this;util.stopBubble(window.event||e),SyncMgr.checkFav(function(){SchemeFaver.toClound.call(i,{pathtype:1,dom:t})},this),addStat("busscheme.blscheme.blfavourite")},sendSms:function(t,e){util.stopBubble(window.event||e),sms&&sms.ready(t,"bt"),addStat("busscheme.blscheme.bltomb")},printBusLine:function(t,e){util.stopBubble(window.event||e);var i=baidu(t).children("a").get(0),s={ttype:this.trafType};return require.async("common:widget/ui/PrintMap/PrintMap.js",function(t){t.printMap(i,s)}),addStat("busscheme.blscheme.blprint"),!1},driveFavBtnMouseOver:function(t,e,i){util.stopBubble(e||window.event),"undefined"!=typeof t&&(1==i?t.className="sendMoileMouseOver i2":2==i?"i hasafav"!=t.className&&(t.className="favMouseOver i2"):3==i&&(t.className="printMouseOver i2"))},driveFavBtnMouseOut:function(t,e,i){util.stopBubble(window.event||e),"undefined"!=typeof t&&(1==i?t.className="sendMoileMouseOut i2":2==i?"i hasafav"!=t.className&&(t.className="favMouseOut i2"):3==i&&(t.className="printMouseOut i2"))},showSendSmsTip:function(){if(!window.isPrint){if(!T.G("defCityTip")){var t='<div id="defCityTip" class="GR_Tip def_city_tip"></div>';util.beforeEndHTML(document.body,t)}T.G("defCityTip").innerHTML='<div class="tip_cont"><div class="phoneImgTip"></div>把搜索结果<a class="cur_city" href="javascript:void(0);" >免费发送到手机</a></div><button onclick="addStat(\'navscheme.navscheme.navtombtipsclose\');BusTransInst.removeTipOnResultPage(T.G(\'defCityTip\'));"></button>',this.setTipPos(T.G("defCityTip")),baidu(".tip_cont a.cur_city").one("click",function(t){sms.ready(this,"bt"),addStat("busscheme.blscheme.bltiptomb"),t.preventDefault()})}},setTipPos:function(t){t.style.display="block";var e=T.g("MapInfoCon").clientWidth,i=util.getClientSize().width,s=t.clientWidth,n=i/2-s/2;map.fullScreenMode?t.style.top="38px":(t.style.top="145px",n+=e/2),t.style.left=n+"px"},removeTipOnResultPage:function(t){t&&(t.style.display="none",modelConfig.notShowTipInResultPage=!0)},resizeBusContent:function(){var t=BusTransInst,e=T.G("route_top"),i=T.G("route_total");if(e){var s=T.G("main_result_content"),n=e.parentNode,a=(T.dom.getPosition(n),util.getClientSize()),o=e.offsetHeight,r=i?i.offsetHeight:0,l=a.height-156-5-o-r;t.cmsAdStrFlag&&(l-=35),l=l>0?l:0;var p=baidu.g("busAdContainer"),d=26;p.childNodes&&p.childNodes.length>0||(l+=d),s&&(s.style.height=l+"px"),n.scrollTop=scrollbottom=0}},clearTempRoute:function(t){var e=window.BusTransInst,i=(t||window.event,T.G("route_list"));if(i){e.removeTempLine&&e.removeTempLine();for(var s=i.getElementsByTagName("li"),n=0;n<s.length;n++)e.schemeIndex%e.pagecap!=n&&(s[n].className="")}},getDistance:function(t){return 10>t?t=10:t>10&&1e3>=t?t=10*(t/10).toFixed(0):t>1e3&&(t=1e3*(t/1e3).toFixed(1)),t},getPointFromLine:function(t,e,i){var s=mapUtil.parse2Geo(i[t].walk.geo).points;return s=s.split(";"),0==e?s=s[0]:1==e&&(s=s[s.length-1]),s},startGo:function(t){var e=window,i=this,s=e.startPoi.point,n=e.endPoi.point,a=e.startPoi._sc,o=e.endPoi._ec,r="bt&c="+t+"&sc="+a+"&ec="+o+"&sn=1$$$$"+s.lng+","+s.lat+"$$"+encodeURIComponent(e.cxtBusPoints[0].n)+"$$$$$$&en=1$$$$"+n.lng+","+n.lat+"$$"+encodeURIComponent(e.cxtBusPoints[1].n)+"$$$$$$&rn="+i.pagecap+"&exptype="+this.exptype+"&exptime="+this.exptime+"&version="+this.version;componentManager.go(r,{cinfo:{trafType:i.trafType}})},endGo:function(t){var e=window,i=this,s=e.startPoi.point,n=e.endPoi.point,a=e.startPoi._sc,o=e.endPoi._ec,r="bt&c="+t+"&sc="+a+"&ec="+o+"&sn=1$$$$"+s.lng+","+s.lat+"$$"+encodeURIComponent(e.cxtBusPoints[0].n)+"$$$$$$&en=1$$$$"+n.lng+","+n.lat+"$$"+encodeURIComponent(e.cxtBusPoints[1].n)+"$$$$$$&rn="+i.pagecap+"&exptype="+i.exptype+"&exptime="+i.exptime+"&version="+this.version;componentManager.go(r,{cinfo:{trafType:i.trafType}})},getWalkDirection:function(t,e,i,s){var n=this,a="";if(0==i[t].type){var o=mapUtil.parse2Geo(s[e].walk.geo).points.split(";"),r=mapUtil.parse2Geo(i[t].geo).points.split(";");r=r[r.length-2];var l=o[0],p=o[1],d=n.getCosA(r,l,p);Math.abs(d)<.9||(a=d>0?"下车<span>继续向前</span>，":"下车<span>往回</span>，")}return a},getCosA:function(t,e,i){t=t.split(","),e=e.split(","),i=i.split(",");var s=e[0]-t[0],n=e[1]-t[1],a=i[0]-e[0],o=i[1]-e[1],r=(s*a+n*o)/Math.sqrt((s*s+a*a)*(n*n+o*o));return r},getExpRoutesTip:function(t){var e=t.rplt?t.rplt:0;if(0==e)return"";var i=expTips[e].split("|"),s=i[1]?'<a href="javascript:void(0)" class="route_show" onclick="BusTransInst.reSearchRoutes('+e+');return false;">'+i[1]+"</a>":"",n='<div class="exp_tip"><span>'+i[0]+"</span>"+s+'<p class="clear"></p></div>';return 1==e?addStat("busscheme.blscheme.offstreamblhidden","show"):0==e?addStat("busscheme.blscheme.allbldisped","show"):2==e&&addStat("busscheme.blscheme.noblavldispall","show"),n},getTrafficTypeHtml:function(){var t=this.trafficType,e=this.trafType,i=this.getListHtml(e),s=['<div class="traffic_type">',"<label >交通工具：</label>",'<span id="select_type" class="select_type">','<span data-value="'+e+'">'+t[e]+"</span><em></em>","</span>",'<div id="traffic_list" class="traffic_list">',i,"</div>","</div>"];return s.join("")},getListHtml:function(t){for(var e=[],i=this.trafficType,t=t||0,s=0;s<i.length;s++)s!=t&&e.push('<a href="javascript:void(0)" data-value="'+s+'">'+i[s]+"</a>");return e.join("")},setDefTime:function(){var t=this.getStartTime();baidu("#bs_start_date").val(t.sdate),baidu("#bs_start_time").val(t.stime),this.setTimeTip()},getStartTime:function(){var t=this.json.result&&this.json.result.exptime?this.json.result.exptime:"",e=this.getFormatTime(t);this.startQDate=e.date,this.startQTime=e.time,this.exptime=this.startQDate+" "+this.startQTime;var i=this.getClientTime(),s=i.cdate,n=i.ctime;return{sdate:this.startQDate||s,stime:this.startQTime||n}},bindBsEvents:function(){var t=this,e=baidu("#bs_start_date"),i=baidu("#bs_start_time"),s=baidu("#select_type"),n=baidu("#traffic_list"),a=baidu("span.bs_cal").get(0),o=i.get(0),r=(e.parent("li").get(0),i.parent("li").get(0)),l=this.CLS_SELECTED;baidu.on(e,"click",function(e){util.stopBubble(e),t.startTimeCmp&&(t.startTimeCmp.hide(),baidu(r).removeClass(l)),t.startDateCmp?t.startDateCmp.show():t.loadCalendar()}),baidu.on(a,"click",function(t){util.stopBubble(t),e.trigger("click")}),baidu.on(r,"click",function(e){util.stopBubble(e),t.startDateCmp&&t.startDateCmp.hide(),t.toggleBtn(o)}),baidu.on(s,"click",function(t){util.stopBubble(t),n.toggle()}),baidu.on(n,"click",function(e){util.stopBubble(e),t.doListClick(e,s,n)}),baidu.on(document.body,"click",function(t){util.stopBubble(t),n.hide(),baidu(r).removeClass(l)})},toggleBtn:function(t){var e=this;this.toggleSelected(t),e.startTimeCmp?e.startTimeCmp.visible?e.startTimeCmp.hide():e.startTimeCmp.show(e.startQTime):e.loadTimePanel()},toggleSelected:function(t){var e=this.CLS_SELECTED,t=T.dom.getAncestorByTag(t,"li");T.dom.hasClass(t,e)?T.dom.removeClass(t,e):T.dom.addClass(t,e)},loadCalendar:function(){var t=this;require.async("common:widget/ui/Calendar/Calendar.js",function(e){t.startDateCmp=new e({count:1,input:"bs_start_date",cur_btn:!0,onSelectDay:function(e){t.startQDate=t.formatDate(e.toString()),BusTrans.dateRem=t.startQDate,t.exptype="dep",t.exptime=t.startQDate+" "+t.startQTime,t.getNewRoutes(t.trafType)}}),t.startDateCmp.show()})},loadTimePanel:function(){var t=this;require.async("common:widget/ui/TimePanel/TimePanel.js",function(e){t.startTimeCmp=new e({anchor:"bs_start_time",cur_btn:!0,cur_time:t.startQTime,onTimeSelected:function(e){t.startQTime=e,BusTrans.timeRem=e,t.exptype="dep",t.exptime=t.startQDate+" "+e,t.getNewRoutes(t.trafType)}}),t.startTimeCmp.show(t.startQTime),document.body.appendChild(t.startTimeCmp.dom)})},doListClick:function(t,e,i){var s=this.trafficType,n=T.event.getTarget(t),a="a"===n.tagName.toLowerCase()?n:T.dom.getAncestorByTag(n,"a"),o=baidu.dom(e).children("span")[0];if(o){var r=baidu(o).attr("data-value"),l=baidu(a).attr("data-value");baidu(o).attr("data-value",l),baidu(o).text(s[l]),baidu(a).attr("data-value",r),baidu(a).text(s[r]),i.hide(),this.trafType=l,this.exptype="dep",this.getNewRoutes(l),Share.setParam("ttype",this.trafType)}},getNewRoutes:function(){var t=this,e=1==t.sBus?0:1,i=1==t.eBus?0:1,s=this.strategy;t.exptime=t.startQDate+" "+t.startQTime;var n="bt&c="+t.currentCity+"&"+t.getStrategy(s)+"&sn="+e+"$$"+t.suid+"$$"+t.startPoint+"$$"+encodeURIComponent(t.start.wd)+"$$$$$$&en="+i+"$$"+t.euid+"$$"+t.endPoint+"$$"+encodeURIComponent(t.end.wd)+"$$$$$$&sq="+encodeURIComponent(t.s_query)+"&eq="+encodeURIComponent(t.e_query)+"&rn="+t.pagecap+"&reqtp=1&exptype="+t.exptype+"&exptime="+t.exptime+"&version="+this.version;componentManager.go(n,{cinfo:{trafType:t.trafType}})},reSearchRoutes:function(t){switch(parseInt(t)){case 0:case 3:this.exptype="dep";break;case 1:this.exptype="all";break;case 2:}var e=this,i=1==e.sBus?0:1,s=1==e.eBus?0:1;e.exptime=e.startQDate+" "+e.startQTime;var n="bt&c="+e.currentCity+"&"+e.getStrategy(e.strategy)+"&sn="+i+"$$"+e.suid+"$$"+e.startPoint+"$$"+encodeURIComponent(e.start.wd)+"$$$$$$&en="+s+"$$"+e.euid+"$$"+e.endPoint+"$$"+encodeURIComponent(e.end.wd)+"$$$$$$&sq="+encodeURIComponent(e.s_query)+"&eq="+encodeURIComponent(e.e_query)+"&rn="+e.pagecap+"&reqtp=1&exptype="+e.exptype+"&exptime="+e.exptime+"&version="+this.version;
componentManager.go(n,{cinfo:{trafType:e.trafType}})},setTimeTip:function(){if(navigator.cookieEnabled&&0!=parseInt(T.cookie.get("bus_time_tip"))&&!window.isPrint){var t=T.g("bus_time_tip");t||(t=T.dom.create("div",{id:"bus_time_tip"}),document.body.appendChild(t)),componentManager.load("BusTimeTip",{dom:baidu.g("bus_time_tip"),cinfo:{el:baidu.g("bs_start_time")}})}},getFormatTime:function(t){if(!t)return{};var e=t.split("T"),i=e[1].split(":");i[1]=10*Math.ceil(i[1]/10),60==i[1]&&(i[0]=(parseInt(i[0],10)+1)%24,i[1]=0),i[0]=util.fixed(i[0],2),i[1]=util.fixed(i[1],2);var s=e[0],n=i[0]+":"+i[1];return{date:s,time:n}},getClientTime:function(){var t=new Date,e=T.date.format(t,"yyyy-MM-dd"),i=t.getHours(),s=t.getMinutes(),n=s>=10?s:baidu.number.pad(s,2),a=i+":"+n;return{cdate:e,ctime:a}},formatDate:function(t){var e=t;return t&&t.length>7&&(e=t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2)),e},redrawArrow:function(){for(var t=0;t<currentmarks.length;t++)map.removeOverlay(currentmarks[t]);currentmarks=[];for(var t=0;t<currentlines.length;t++)currentmarks=currentmarks.concat(mapUtil.addArrow(currentlines[t].split(";"),map))},getOverlays:function(){return this.exportOverlays}}),module.exports=BusTrans});