define("common:widget/com/RouteAddr/RouteAddr.js",function(require,exports,module){function RouteAddr(t){window.RouteAddrInst=this,MapComponent.call(this,t),this.markersList=[],this.pointsList=[],this.markerDest=null,this.curPageIndex=0,this.totalPage=1,this.startName="",this.endName="",this.resCity=[0,0,0,0,0,0,0],this.resCount=[0,0,0,0,0,0,0],this.resType=[0,0,0,0,0,0,0],this.currentNull=[-1,-1,-1,-1,-1,-1,-1],this.endIndex=1,this.curPointIndex=0,this.qInfo=[{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1}],this.locPois=[],this.ifNav=0,this.moPars={o:null,n1:0,n2:0},this.originCity_List,this.moreCityScrollPanel=new baidu.ui.ScrollPanel({container:"moreCity_scrollPanel",overflow:"overflow-y",autoUpdate:!1}),this.curSelectedIndex=-1,this.exptype="dep",this.exptime="",this.version=5}var constants=require("common:widget/ui/constant/Constant.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),util=require("common:widget/ui/util/util.js"),AID=require("common:widget/ui/areaCfg/areaCfg.js"),sideBar=require("common:widget/ui/mapInfo/mapInfo.js"),Page=require("common:widget/ui/page/Page.js"),MapComponent=require("common:widget/com/MapComponent.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),searchData=require("common:widget/ui/searchData/searchData.js"),componentManager=require("common:widget/com/componentManager.js"),config=require("common:widget/ui/config/config.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,constant=require("common:widget/ui/constant/Constant.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),PanoEntranceUtil=require("common:widget/ui/PanoEntranceUtil/PanoEntranceUtil.js");T.lang.inherits(RouteAddr,MapComponent,"RouteAddr"),T.object.extend(RouteAddr.prototype,{render:function(){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="RouteAddressOuterBkg">    <div class="RouteAddressTip"><span>请选择准确的起点、途经点或终点</span></div>    <div class="RouteAddressInnerBkg">        <div id="pos5" style="display:none"></div>        <div id="RouteAddress_DIV0" class="',"undefined"==typeof startPointClass?"":startPointClass,'">                    <div class="sel_body">            <div class="sel_body_top" onclick="RouteAddrInst.showLst(0)">              <div class="sel_body_title">                <div class="sel_body_sign"></div>                <div class="sel_body_name">起点：<b id="B_PointName0">',"undefined"==typeof startPoint?"":startPoint,'</b></div>              </div>              <div id="RD_TOP_BUT0" class="sel_body_button">',"undefined"==typeof startButton?"":startButton,'</div>            </div>            <div class="sel_body_body" id="RADIV_BODY0">',"undefined"==typeof startBody?"":startBody,"</div>          </div>                  </div>        ","undefined"==typeof tpList?"":tpList,'        <div id="RouteAddress_DIV',"undefined"==typeof endIndex?"":endIndex,'" class="',"undefined"==typeof endPointClass?"":endPointClass,'">                    <div class="sel_body">            <div class="sel_body_top" onclick="RouteAddrInst.showLst(',"undefined"==typeof endIndex?"":endIndex,')">              <div class="sel_body_title">                <div class="sel_body_sign"></div>                <div class="sel_body_name">终点：<b id="B_PointName',"undefined"==typeof endIndex?"":endIndex,'">',"undefined"==typeof endPoint?"":endPoint,'</b></div>              </div>              <div id="RD_TOP_BUT',"undefined"==typeof endIndex?"":endIndex,'" class="sel_body_button">',"undefined"==typeof endButton?"":endButton,'</div>            </div>            <div class="sel_body_body" id="RADIV_BODY',"undefined"==typeof endIndex?"":endIndex,'">',"undefined"==typeof endBody?"":endBody,'</div>          </div>                  </div>        <div id="pos6" style="display:none"></div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],style=".RouteAddressOuterBkg{position:relative;padding:32px 4px 4px 3px;background-color:#fd9}.RouteAddressInnerBkg{padding:3px 5px 8px 8px;background-color:#fff}#RouteAddress_DIV1{margin-top:5px}.RouteAddressTip{position:absolute;width:340px;top:0;text-align:center;height:30px;line-height:30px;color:#994c00}.route_tip_con{position:absolute;top:145px}.route_tip_con .route_tip{position:absolute;width:233px;height:29px;color:#803300;text-align:center;line-height:29px;border:#cc967a solid 1px;background:#fff2b2;z-index:100000}.route_tip_con .route_tip span{position:absolute;top:0;right:0;_right:-1px;width:14px;height:13px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat 0 -121px;cursor:pointer}.route_tip_con .route_tip_shadow{width:233px;height:29px;position:absolute;left:1px;top:1px;background:#505050;border:1px solid #505050;opacity:.2;filter:alpha(opacity=20)}.sel_body_body_page{margin:5px 0}.sel_n{margin-top:5px;width:329px;overflow:hidden}.sel_n .sel_top{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -418px;height:4px;font-size:0}.sel_n .sel_body_top{height:32px;width:100%;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat 0 -41px}.sel_n .sel_body_title{float:left;width:100%;height:31px}.sel_n .sel_body_sign{margin-top:1px;width:30px;height:31px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -79px -387px}.sel_n .sel_body_name{margin:0 20px 0 30px;padding:8px 7px 7px;font-size:14px;color:#FA8722}.sel_n .sel_body_button{float:left;width:55px;margin-left:-55px;padding-top:8px}.sel_n .sel_body_button a{}.sel_n .sel_bottom{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -415px;height:4px;font-size:0}.sel_n .sel_body_body{padding:3px 0 0}.sel_n1{margin-top:5px;width:329px;overflow:hidden}.sel_n1 .sel_top{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -418px;height:4px;font-size:0}.sel_n1 .sel_body_top{height:31px;width:100%;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/sel_body_n_top_62b5674.gif) repeat-x}.sel_n1 .sel_body_top{height:32px;width:100%;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat 0 -41px}.sel_n1 .sel_body_title{float:left;width:100%;height:31px;cursor:pointer}.sel_n1 .sel_body_sign{margin-top:1px;width:30px;height:31px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -79px -387px}.sel_n1 .sel_body_name{margin:0 20px 0 30px;padding:8px 7px 7px;font-size:14px;color:#FA8722}.sel_n1 .sel_body_button{float:left;width:20px;height:31px;margin-left:-23px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -253px -382px;overflow:hidden;zoom:1;cursor:pointer}.sel_n1 .sel_body_button a{display:none}.sel_n1 .sel_body_body{display:none}.sel_n1 .sel_bottom{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -415px;height:4px;font-size:0}.sel_y{margin-top:5px;width:329px;overflow:hidden}.sel_y .sel_top{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -439px;height:4px;zoom:1;font-size:0}.sel_y .sel_body_top{height:32px;width:100%;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat 0 0}.sel_y .sel_body_title{float:left;width:100%;height:31px;cursor:pointer}.sel_y .sel_body_sign{margin-top:1px;width:30px;height:31px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -167px -384px}.sel_y .sel_body_name{margin:0 20px 0 30px;padding:8px 7px 7px;font-size:14px;color:#5B7BCB}.sel_y .sel_body_button{float:left;width:20px;height:31px;margin-left:-20px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -269px -297px;cursor:pointer}.sel_y .sel_body_button a{display:none}.sel_y .sel_body_body{display:none;height:0}.sel_y .sel_body_body_div{}.sel_y .sel_bottom{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -436px;height:4px;font-size:0;jx-apptest-map00.jx.baidu.com}.sel_y .sel_body_body_page{display:none;height:0}.sel_x{margin-top:5px;width:329px;overflow:hidden}.sel_x .sel_top{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -418px;height:4px;font-size:0}.sel_x .sel_body_top{height:32px;width:100%;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat 0 -41px}.sel_x .sel_body_title{float:left;width:100%;height:31px}.sel_x .sel_body_sign{margin-top:1px;width:30px;height:31px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -122px -384px}.sel_x .sel_body_name{margin:0 20px 0 30px;padding:8px 7px 7px;font-size:14px;color:#FA8722}.sel_x .sel_body_button{float:left;width:55px;margin-left:-55px;padding-top:8px}.sel_x .sel_body_button a{}.sel_x .sel_body_body{}.sel_x .sel_body_body_div{padding:5px 5px 0}.sel_x .sel_bottom{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -415px;height:4px;font-size:0}.sel_x1{margin-top:5px;width:329px;overflow:hidden}.sel_x1 .sel_top{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -418px;height:4px;font-size:0}.sel_x1 .sel_body_top{height:32px;width:100%;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat 0 -41px}.sel_x1 .sel_body_title{float:left;width:100%;height:31px;cursor:pointer}.sel_x1 .sel_body_sign{margin-top:1px;width:30px;height:31px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -122px -384px}.sel_x1 .sel_body_name{margin:0 20px 0 30px;padding:8px 7px 7px;font-size:14px;color:#FA8722}.sel_x1 .sel_body_button{float:left;width:55px;height:31px;margin-left:-55px}.sel_x1 .sel_body_button a{display:none}.sel_x1 .sel_body_body{display:none;height:0}.sel_x1 .sel_body_body_div{padding:5px 5px 0}.sel_x1 .sel_bottom{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat 0 -415px;height:4px;font-size:0}.sel_body_citylist{height:100px;padding:0 0 0 5px}.sel_body_resitem{table-layout:fixed;overflow-x:hidden;overflow-y:hidden;height:220px;width:329px}.sel_body_resitem table{margin-right:5px}.sel_body_resitem tr{cursor:pointer}.sel_body_resitem th{padding-top:5px;padding-left:5px;text-align:left;vertical-align:top;width:22px}.sel_body_resitem th div.iconbg{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/markers_new_ie6_843ae9b.png) no-repeat scroll 0 0;height:29px;width:24px}.sel_body_resitem th div.icon{cursor:pointer}.sel_body_resitem th div#no_0_1,.sel_body_resitem th div#no_1_1{background-position:0 -64px}.sel_body_resitem th div#no_0_2,.sel_body_resitem th div#no_1_2{background-position:-24px -64px}.sel_body_resitem th div#no_0_3,.sel_body_resitem th div#no_1_3{background-position:-48px -64px}.sel_body_resitem th div#no_0_4,.sel_body_resitem th div#no_1_4{background-position:-72px -64px}.sel_body_resitem th div#no_0_5,.sel_body_resitem th div#no_1_5{background-position:-96px -64px}.sel_body_resitem th div#no_0_6,.sel_body_resitem th div#no_1_6{background-position:-120px -64px}.sel_body_resitem th div#no_0_7,.sel_body_resitem th div#no_1_7{background-position:-144px -64px}.sel_body_resitem th div#no_0_8,.sel_body_resitem th div#no_1_8{background-position:-168px -64px}.sel_body_resitem th div#no_0_9,.sel_body_resitem th div#no_1_9{background-position:-192px -64px}.sel_body_resitem th div#no_0_10,.sel_body_resitem th div#no_1_10{background-position:-216px -64px}.sel_body_resitem td{line-height:160%;padding:3px 0 3px 3px;vertical-align:top}.sel_body_resitem div.ra_td_title{float:left;margin-right:40px}.sel_body_resitem div.ra_td_button{float:right;width:40px}.sel_body_resitem div.ra_td_button input{height:18px;font-size:12px;width:40px}.sel_body_resitem div.clear{clear:both;height:0;width:100%}.sel_body_resitem td .selBtn{width:70px;height:29px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat -21px -81px;text-align:center;line-height:29px;visibility:hidden;color:#b35900;display:inline-block;*display:inline;*zoom:1}.sel_body_resitem td .list_street_view_poi{display:inline-block;float:none;margin-right:6px;position:static;*vertical-align:-3px;_vertical-align:-5px;*display:inline;*zoom:1}.selInfoWndBtn{width:70px;height:29px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/addrPage_6f51ab7.png?v=20121107) no-repeat -21px -81px;text-align:center;line-height:29px;margin:0 auto;cursor:pointer;color:#b35900}.sel_body_body td a{text-decoration:none;cursor:auto}.sel_body_body td a:hover,.sel_body_body td a:focus{text-decoration:underline}";require.loadCss({content:style,name:"RouteAddr"});var templateObj={};this.setStatusByRes(this.json),this.json=this.parseJson(this.json);var json=this.json;if(!json.result)return;TPM.state="route",window.contextMenu&&window.contextMenu.getItem(1).disable(),this.originCity_List=json.result.city_list,this.endIndex=json.content.tpList.length+1;var endIndex=this.endIndex;if(endIndex=endIndex?endIndex:1,this.cinfo&&1==this.cinfo.isSingle&&json.current_city&&0==json.current_city.sup_bus&&(13==json.result.type||24==json.result.type)){this.ifNav=1;var htmln=["<p style='margin:10px'>抱歉，该城市暂无公交路线查询功能<br />","您可以<a href='javascript:void(0)' onclick='RouteAddrInst.goDrv();return false;'>查看驾车路线</a>。</p>"];return htmln.join("")}if(json.result&&json.result.if_nav&&1==json.result.if_nav&&(13==json.result.type||24==json.result.type)){this.ifNav=1;var htmln=["<div class='mapinfo_con'>","<p>暂不支持跨城市公交查询，抱歉。</P>","<p>您可尝试查看<a href='javascript:void(0)' onclick=\"RouteAddrInst.navigate();return false;\">驾车路线</a>。</p>","<div class='nr_suggest'>百度建议您：","<ul><li>看看地图当前城市是否有误，尝试更换城市</li>","<li>您可在地图上移动起点、终点，再次尝试</li>","<li>您可更换关键词再次尝试</li>","</ul></div>","<div id='route_tips' class='route_tips'>百度提醒您：如果您有任何意见和建议，请到<a id='mapComplaintCenter' target='_blank'  href='http://tousu.baidu.com/map/add'>百度地图投诉中心</a>反馈。</div>","</div>"];return htmln.join("")}var contInfo=json.content,dotBodyArr=[],classList=["sel_n","sel_n1","sel_y","sel_x","sel_x1"],pointClassType=[-1,-1],bolName=[],topButtonStr=[];window.contextMenu.getItem(0).enable(),window.contextMenu.getItem(2).enable(),this.tpCity=[json.current_city.code,json.current_city.code],tempCode=json.current_city.code;for(var j=0;endIndex+1>j;j++){var tpJson=null;if(dotBodyArr.push([]),bolName.push(""),topButtonStr.push(""),0==j)json.result.start_city&&(this.tpCity[0]=json.result.start_city.code||json.result.start_city[0]&&json.result.start_city[0].code||1,tempCode=this.tpCity[0]);else if(json.result.end_city){var endCitys=json.result.end_city;this.tpCity[j]=json.result.end_city.code||json.result.end_city[j-1]&&json.result.end_city[j-1].code||1,tempCode=this.tpCity[j]}if(tpJson=this.getCurPoint(j),json.result.count[j]>0&&1!=json.result.city_list[j]){13!=json.result.type&&24!=json.result.type&&(topButtonStr[j]='<a href="javascript:void(0)" onclick="RouteAddrInst.changeCity(this,'+j+');return false;">更换城市</a>'),dotBodyArr[j].push('<div id="RADiv_ResItem'+j+'" class="sel_body_body_div sel_body_resitem">'),this["scrollPanel"+j]=new baidu.ui.ScrollPanel({container:"RADiv_ResItem"+j,overflow:"overflow-y",autoUpdate:!1});var n2=[0,9];if(tpJson.length<10&&(n2[1]=tpJson.length-1),dotBodyArr[j].push(this.makeListTable(j,n2)),json.result.count[j]>10&&(dotBodyArr[j].push('<div id="RADiv_PAGE'+j+'" style="height:20px;" class="sel_body_body_page"></div>'),this.totalPage=Math.ceil(json.result.count[j]/10),this.curPageIndex=1),dotBodyArr[j].push("</div>"),1==json.result.prio_flag[j]){pointClassType[j]=2,this.qInfo[j].n=tpJson[0].name,this.qInfo[j].c=tempCode,this.qInfo[j].u=tpJson[0].uid;var geo=util.getPointByStr(util.parseGeo(tpJson[0].geo).points);this.qInfo[j].x=geo.lng,this.qInfo[j].y=geo.lat,this.qInfo[j].t=tpJson[0].poiType;var markerDest=this.addPointMarker(geo,tpJson[0].name,j,!0);this.markerDest=markerDest,this.locPois.push(markerDest.point),bolName[j]=tpJson[0].name,0==j&&window.contextMenu.getItem(0).disable(),j==endIndex&&window.contextMenu.getItem(2).disable()}else pointClassType[j]=0}else if(json.result.count[j]>0&&1==json.result.city_list[j]){topButtonStr[j]='<a href="javascript:void(0)" onclick="RouteAddrInst.changeCity(this,'+j+');return false;">更换城市</a>',dotBodyArr[j].push('<div id="DIV_CityList'+j+'" class="sel_body_body_div sel_body_citylist">'),this.json.result.current_null&&0==this.json.result.current_null[j]||dotBodyArr[j].push('<div style="margin-top:10px;">在<b>'+json.current_city.name+"</b>未找到相关地点。</div>"),dotBodyArr[j].push('<div style="margin-top:10px">在以下城市有结果，请选择城市：</div>'),dotBodyArr[j].push('<div style="margin-top:10px">'),dotBodyArr[j].push('<table cellspacing="0" cellpadding="0" border="0" align="left" width="100%" style="margin: 0px 0pt 8px;"><tr>');for(var i=0,k=0;i<(tpJson.length>6?6:tpJson.length);i++,k++){var city=tpJson[i],name=city.name,code=city.code,num=city.num,cnlen=2*name.length,enlen=num.toString().length+2,tollen=cnlen+enlen;if(12>=tollen)dotBodyArr[j].push('<td width="33%" valign="top">');else{if(k%3==2){dotBodyArr[j].push("</tr><tr>"),dotBodyArr[j].push('<td width="66%" valign="top" colspan="2">'),dotBodyArr[j].push('<a href="javascript:void(0)" tid="selCity_'+i+'" class="hotcity" onclick="RouteAddrInst._changeCity('+j+", {code:'"+tpJson[i].code+"', name:'"+tpJson[i].name+"'});return false;\">"+tpJson[i].name+"</a>("+tpJson[i].num+")"),dotBodyArr[j].push("</td>"),k+=2;continue}dotBodyArr[j].push('<td width="66%" valign="top" colspan="2">'),k++}dotBodyArr[j].push('<a href="javascript:void(0)" class="hotcity" tid="selCity_'+i+'" onclick="RouteAddrInst._changeCity('+j+", {code:'"+tpJson[i].code+"', name:'"+tpJson[i].name+"'});return false;\">"+tpJson[i].name+"</a>("+tpJson[i].num+")</td>"),(k+1)%3==0&&dotBodyArr[j].push("</tr><tr>")}dotBodyArr[j].push("</tr></table></div>"),1==json.result.city_list[j]&&json.result.count[j]>6&&dotBodyArr[j].push('<div style="clear:both;margin-:10px"><a class="arrowLink" href="javascript:void(0)" onclick="RouteAddrInst.showMoreCity('+j+',this);return false;">更多城市</a></div>'),dotBodyArr[j].push("</div>"),pointClassType[j]=0}else dotBodyArr[j].push('<div id="DIV_CityList'+j+'" class="sel_body_body_div sel_body_citylist">'),dotBodyArr[j].push('<div style="margin-top:10px;margin-left:10px;">在<b>'+json.current_city.name+"</b>未找到相关地点。</div>"),13!=json.result.type&&24!=json.result.type&&dotBodyArr[j].push('<div style="margin-top:10px;margin-left:10px;">在全国也没有找到结果</div>'),dotBodyArr[j].push('<div style="margin-top:10px;margin-left:10px;">您可更换关键词再尝试。</div></div>'),pointClassType[j]=3}for(var noresultItem,notSureItem,tpNoResult=!1,seNoResult=!1,i=0,classType;i<pointClassType.length;i++)if(classType=pointClassType[i],3==classType&&(0==i||i==endIndex?seNoResult=!0:tpNoResult=!0),3!=classType||noresultItem)if(noresultItem)(0==classType||3==classType)&&(pointClassType[i]=classType+1);else{if(0==classType&&!notSureItem){this.curPointIndex=i,notSureItem=i+1;continue}notSureItem&&0==classType&&(pointClassType[i]=1)}else this.curPointIndex=i,notSureItem&&(pointClassType[notSureItem-1]=1),noresultItem=i+1;if(templateObj.startPointClass=classList[pointClassType[0]],this.startName=json.result.s_query?json.result.s_query:json.result.s_wd,24==json.result.type||29==json.result.type){var fm=24==json.result.type?"Bus":"Drive";searchBox.setValue(fm+"SearchSta",json.result.s_query||json.result.s_word||""),searchBox.setValue(fm+"SearchEnd",json.result.e_query||json.result.e_word||"")}if(templateObj.startPoint=""==bolName[0]?T.string.subByte(this.startName,14,"..."):T.string.subByte(bolName[0],14,"..."),templateObj.startBody=dotBodyArr[0].join(""),templateObj.endPointClass=classList[pointClassType[endIndex]],this.endName=json.result.e_query?"string"==typeof json.result.e_query?json.result.e_query:json.result.e_query[endIndex-1]:"string"==typeof json.result.e_wd?json.result.e_wd:json.result.e_wd[endIndex-1],""==bolName[endIndex]){var __endName=baidu.string.filterFormat.escapeString(this.endName);templateObj.endPoint=T.string.subByte(__endName,14,"...")}else bolName[endIndex]=baidu.string.filterFormat.escapeString(bolName[endIndex]),templateObj.endPoint=T.string.subByte(bolName[endIndex],14,"...");templateObj.endBody=dotBodyArr[endIndex].join(""),templateObj.startButton=topButtonStr[0],templateObj.endIndex=endIndex,templateObj.endButton=topButtonStr[endIndex],this.tpName=[];for(var tpListHtml=[""],i=0;i<contInfo.tpList.length;i++){var tpIndex=i+1,poiName=bolName[tpIndex];""==poiName&&(poiName=json.result.e_wd[i]),this.tpName.push(poiName);var tpTemplate=['<div id="RouteAddress_DIV'+tpIndex+'" class="'+classList[pointClassType[tpIndex]]+'">','  <div class="sel_body">','    <div class="sel_body_top" onclick="RouteAddrInst.showLst('+tpIndex+')">','     <div class="sel_body_title">','        <div class="sel_body_sign"></div>','        <div class="sel_body_name">途经点'+tpIndex+'：<b id="B_PointName'+tpIndex+'">'+T.string.subByte(poiName,14,"...")+"</b></div>","      </div>",'     <div id="RD_TOP_BUT'+tpIndex+'" class="sel_body_button">'+topButtonStr[tpIndex]+"</div>","    </div>",'    <div class="sel_body_body" id="RADIV_BODY'+tpIndex+'">'+dotBodyArr[tpIndex].join("")+"</div>","  </div>","</div>"].join("\n");tpListHtml.push(tpTemplate)}return templateObj.tpList=tpListHtml.join(""),template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/RouteAddr/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/RouteAddr/RouteAddr.js",ln:424})}},initialize:function(){try{{var t=this,e=this.endIndex;this.json}if(1==this.ifNav)return window.contextMenu.getItem(0).disable(),void window.contextMenu.getItem(2).disable();t.setParsValue();for(var n=0;e>=n;n++)T.G("RADiv_PAGE"+n)&&(pg0=new Page("RADiv_PAGE"+n,function(e){var n=t.curPointIndex,s=[10*(e-1),10*e-1];t.resCount[n]<s[1]+1&&(s[1]=t.resCount[n]-1),T.G("RA_ResItem_"+n)&&(T.dom.remove(T.G("RA_ResItem_"+n)),T.dom.insertHTML(T.G("RADiv_ResItem"+n),"AFTERBEGIN",t.makeListTable(n,s)),t.setPanoEntrances()),t.addMarkers(n,s,!0),t.setRAStyle(),t.adjustListHeight(),T.G("RADiv_ResItem"+n).scrollTop=0,t["scrollPanel"+n]&&t["scrollPanel"+n].update(),t.curPageIndex=e},{pagecap:5,pageCount:t.totalPage,page:t.curPageIndex}));t.setRAStyle(),window.ifBindRAStyleOnResize=!1,window.ifBindRAStyleOnResize||T.on(window,"onresize",function(){"RouteAddr"==window.currentComponent._className&&(window.ifBindRAStyleOnResize=!0,window.currentComponent.setRAStyle(),t.adjustListHeight())});var s=[0,9],o=this.curPointIndex,i=T.G("RouteAddress_DIV"+o),r=this.getCurPoint(o);"sel_n"==i.className?(t._highLightInput(o),this.json.content&&1!=this.json.result.city_list[o]&&r&&r.length>0&&(r.length<s[1]+1&&(s[1]=r.length-1),t.addMarkers(o,s),t.select(o,0))):this.markerDest&&"sel_x"==i.className&&mapUtil.setViewport(this.locPois);for(var a=0;e>=a;a++)if("sel_y"==T.G("RouteAddress_DIV"+a).className){var d=this.getCurPoint(a);d.length>0&&d[0].ifFromIW&&1==d[0].ifFromIW&&(T.rc(T.G("RD_TOP_BUT"+a),"sel_body_button"),T.G("RD_TOP_BUT"+a).innerHTML="")}t._highLightInput(this.curPointIndex),PanoUtil.closePano(),this.setPanoEntrances()}catch(l){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/RouteAddr/exception.fire","catch",{msg:l.message||l.description,path:"common:widget/com/RouteAddr/RouteAddr.js",ln:543})}},setStatusByRes:function(t){if(t.current_city&&!(1&t.result.result_show||29!=t.result.type&&13!=t.result.type)){var e=t.current_city,n=["country","province","city","area"],s=null!=e.type?modelConfig.level[n[e.type]]:void 0,o=null!=e.geo?o=util.geoToPoint(e.geo):void 0;map.enableLoadTiles?(s&&map.zoomTo(s),o&&map.setCenter(o)):(map.enableLoadTiles=!0,map.centerAndZoom(o||map.getCenter(),s||map.getZoom()))}if(19==t.result.type||29==t.result.type){3!=searchBox._curSelIndex&&searchBox.setSwitchTab(3);var i="",r="";19==t.result.type&&(i=t.result.s_wd?t.result.s_wd:"",r=t.result.e_wd&&t.result.e_wd[t.result.e_wd.length-1]?t.result.e_wd[t.result.e_wd.length-1]:""),searchBox.driveSSG1?searchBox.driveSSG1.setValue(i):searchBox.setValue("DriveSearchSta",i),searchBox.driveSSG2?searchBox.driveSSG2.setValue(r):searchBox.setValue("DriveSearchEnd",r)}else(13==t.result.type||24==t.result.type)&&(2!=searchBox._curSelIndex&&searchBox.setSwitchTab(2),13==t.result.type&&(searchBox.setValue("BusSearchSta",null==t.result.s_wd?"":t.result.s_wd),searchBox.setValue("BusSearchEnd",null==t.result.e_wd?"":t.result.e_wd)),searchBox.busSSG1&&searchBox.busSSG1.setValue(document.fmbus.word_from.value),searchBox.busSSG2&&searchBox.busSSG2.setValue(document.fmbus.word_to.value))},_highLightInput:function(t){var e=this;e.clearHighLightInput(),0==t?1==searchBox._curSelIndex?T.ac(T.g("PoiSearchSpan"),"inputHighLight"):2==searchBox._curSelIndex?T.ac(T.g("BusSearchStaSpan"),"inputHighLight"):3==searchBox._curSelIndex&&T.ac(T.g("DriveSearchStaSpan"),"inputHighLight"):t==this.endIndex?1==searchBox._curSelIndex?T.ac(T.g("PoiSearchSpan"),"inputHighLight"):2==searchBox._curSelIndex?T.ac(T.g("BusSearchEndSpan"),"inputHighLight"):3==searchBox._curSelIndex&&T.ac(T.g("DriveSearchEndSpan"),"inputHighLight"):TPM.highLightInput(t-1)},clearHighLightInput:function(){TPM.clearHighLightInput(),T.rc(T.g("PoiSearchSpan"),"inputHighLight"),T.rc(T.g("BusSearchStaSpan"),"inputHighLight"),T.rc(T.g("BusSearchEndSpan"),"inputHighLight"),T.rc(T.g("DriveSearchStaSpan"),"inputHighLight"),T.rc(T.g("DriveSearchEndSpan"),"inputHighLight")},adjustListHeight:function(){},unload:function(){TPM.state="",TPM.clearTpListInMap(),window.contextMenu.getItem(1).enable(),this.clearHighLightInput();for(var t=0;t<=this.endIndex;t++)this["scrollPanel"+t]=null;this.moreCityScrollPanel=null,this.removeTip(),MapComponent.prototype.unload.call(this)},getCMStart:function(t,e){var n=window.currentComponent;n&&n.getCMQuery(0,t,e)},getCMEnd:function(t,e){var n=window.currentComponent;n&&n.getCMQuery(this.endIndex,t,e)},isAllPointSure:function(){for(var t=0;t<=this.endIndex;t++)if(""==this.qInfo[t].n)return!1;return!0},getCMQuery:function(t,e,n){var s=this,o=e.content;if(s.qInfo[t].n=""==o.name?"未知路段":o.name,s.qInfo[t].c=e.result.code,s.qInfo[t].u=0,s.qInfo[t].x=n.lng,s.qInfo[t].y=n.lat,s.qInfo[t].t=0,0==t?(s.json.content.start=[{name:s.qInfo[t].n,poiType:s.qInfo[t].t,uid:s.qInfo[t].u,addr:"",geo:"1|"+n.lng+","+n.lat+";"+n.lng+","+n.lat+"|"+n.lng+","+n.lat,ifFromIW:1}],s.json.result.s_wd=s.qInfo[t].n,s.json.result.s_query=s.qInfo[t].n,s.json.result.total[0]=1,s.json.result.count[0]=1,s.json.result.current_null&&(s.json.result.current_null[0]=0),s.json.result.prio_flag[0]=1,s.json.result.city_list[0]=0):(s.json.content.end=[{name:s.qInfo[t].n,poiType:s.qInfo[t].t,uid:s.qInfo[t].u,addr:"",geo:"1|"+n.lng+","+n.lat+";"+n.lng+","+n.lat+"|"+n.lng+","+n.lat,ifFromIW:1}],s.json.result.e_wd=s.qInfo[t].n,s.json.result.e_query=s.qInfo[t].n,s.json.result.total[1]=1,s.json.result.count[1]=1,s.json.result.current_null&&(s.json.result.current_null[1]=0),s.json.result.prio_flag[1]=1,s.json.result.city_list[1]=0),this.isAllPointSure())s.submit();else{T.G("B_PointName"+t).innerHTML=T.string.subByte(s.qInfo[t].n,14,"..."),s.markerDest=this.addPointMarker(n,s.qInfo[t].n,t,!0),T.G("RouteAddress_DIV"+t).className="sel_y",T.G("RD_TOP_BUT"+t).innerHTML="",T.rc(T.G("RD_TOP_BUT"+t),"sel_body_button");var i=0==t?1:0;if(s.clearMarkers(),0==s.resType[i]){T.G("RouteAddress_DIV"+i).className="sel_n";var r=s.curPageIndex,a=10*(r-1)+9,d=(s.json.content,this.getCurPoint(i));d.length<a+1&&(a=d.length-1),s.addMarkers(i,[10*(r-1),a])}else T.G("RouteAddress_DIV"+i).className="sel_x";s.setRAStyle(),0==t?window.contextMenu.getItem(0).disable():t==this.endIndex&&window.contextMenu.getItem(2).disable()}},parseJson:function(t){t.content.tpList=[];for(var e=this.modelQuery.split("&"),n=!1,s=0,o=e.length;o>s;s++)if(0==e[s].indexOf("isSingle=true")){n=!0;break}if(n){this.cinfo||(this.cinfo={}),this.cinfo.isSingle=!0,this.cinfo.kwn={};for(var i,r,s=0,o=e.length;o>s;s++){var a=e[s].split("=");switch(a[0]){case"t":this.cinfo.t=a[1];break;case"name":this.cinfo.kwn.name=decodeURIComponent(a[1]);break;case"uid":this.cinfo.kwn.uid=a[1];break;case"poiType":this.cinfo.kwn.poiType=a[1];break;case"ptx":i=a[1];break;case"pty":r=a[1];break;case"req":this.cinfo.q=decodeURIComponent(a[1])}}this.cinfo.kwn.pt=new BMap.Point(i,r),this.cinfo.kwn.geo="1|"+i+","+r+";"+i+","+r+"|"+i+","+r+";",this.cinfo.kwn.ifFromIW=1}if(this.cinfo&&1==this.cinfo.isSingle){var d=this.cinfo.t;if(0==d){t.result.s_wd=t.result.wd,t.result.s_query=t.result.return_query,t.result.total=[t.result.total,1],t.result.count=[t.result.count,1],t.result.e_query=this.cinfo.kwn.name,t.result.current_null=[t.result.current_null,0];var l=t.content;t.content=[],t.content.start=l,t.content.end=[this.cinfo.kwn],t.result.prio_flag=[0,1],t.result.city_list=[t.result.city_list,0]}else if(1==d){t.result.e_wd=t.result.wd,t.result.e_query=t.result.return_query,t.result.s_query=this.cinfo.kwn.name,t.result.total=[1,t.result.total],t.result.count=[1,t.result.count],t.result.current_null=[0,t.result.current_null];var l=t.content;t.content=[],t.content.end=l,t.content.start=[this.cinfo.kwn],t.result.prio_flag=[1,0],t.result.city_list=[0,t.result.city_list]}}if(t.content.tpList=[],19==t.result.type){this.parseQuery(t);var l=t.content,p=[],o=l.length;if(t.content={start:[],end:[]},o>2)for(var s=1;o-1>s;s++)p.push(l[s]);t.content.end=l[o-1],t.content.tpList=p,t.content.start=l[0]}return t.content||(t.content={start:[],end:[]}),t},parseQuery:function(t){TPM.clearTpListInMap();var e,n,s=this.modelQuery,o={},i=this,r=s.split("&"),a={},d=0,l=0,p=[],c=t.result,u=[];o.city_list=[],o.count=[],o.current_null=[],o.e_query=[],o.e_wd=[],o.end_city=[],o.wd2=[],o.prio_flag=[],o.sug_index=[],o.total=[],o.s_wd="",o.s_query="",this.canShowList=[],c.e_wd||(c.e_wd=[],c.e_query=[]);for(var _,h=1;h<r.length;h++)if(_=r[h]){var m=_.split("=");a[m[0]]=m[1]}e=this.parseOnePosition(a.sn),n=e.type,o.s_wd=1==n?e.keyword:c.s_wd,o.s_query=1==n?e.keyword:c.s_query,searchBox.driveSSG1?searchBox.driveSSG1.setValue(o.s_wd):searchBox.setValue("DriveSearchSta",o.s_wd),1==n&&(i.qInfo[d].n=o.s_wd,i.qInfo[d].x=e.point.split(",")[0],i.qInfo[d].y=e.point.split(",")[1]),this.canShowList.push(2==n),o.total.push(1==n?1:c.total[l]),o.count.push(1==n?1:c.count[l]),o.current_null.push(1==n?0:c.current_null[l]),o.prio_flag.push(1==n?1:c.prio_flag[l]),o.sug_index.push(1==n?"":c.sug_index[l]),p.push(1==n?[{name:e.keyword,geo:"1|"+e.point+";"+e.point+"|"+e.point+";"}]:t.content[l]),o.city_list.push(1==n?0:c.city_list[l]),o.wd2.push(1==n?"":c.wd2[l]),2==n&&l++,d++,u=decodeURIComponent(a.en).split("to:");for(var _,h=0;_=u[h];h++){_=this.parseOnePosition(_),n=_.type,2==n&&_.uid&&_.point&&(n=1),this.canShowList.push(2==n);var g=2==n?_.keyword:0==l?c.s_wd:c.e_wd[l-1];o.e_wd.push(g),o.e_query.push(g),h==u.length-1&&(searchBox.driveSSG2?searchBox.driveSSG2.setValue(g):searchBox.setValue("DriveSearchEnd",g)),o.end_city.push(1==n?t.current_city:0==l?c.start_city:c.end_city[l-1]),1==n&&(i.qInfo[d].n=o.s_wd,i.qInfo[d].x=_.point.split(",")[0],i.qInfo[d].y=_.point.split(",")[1]),_.if_wp&&((!TPM.allInputs||TPM.allInputs.length<d)&&TPM.insertTP(d-1,{query:o.e_wd[d-1],addr:o.wd2[d],point:1==n?util.getPoiPoint(_.point):null,uid:_.uid}),TPM.tpListInMap.push({query:o.e_wd[d-1],addr:o.wd2[d],point:1==n?util.getPoiPoint(_.point):null,uid:_.uid})),o.total.push(1==n?1:c.total[l]),o.count.push(1==n?1:c.count[l]),o.current_null.push(1==n?0:c.current_null[l]),o.prio_flag.push(1==n?1:c.prio_flag[l]),o.sug_index.push(1==n?"":c.sug_index[l]),p.push(1==n?[{name:_.keyword,geo:"1|"+_.point+";"+_.point+"|"+_.point+";"}]:t.content[l]),o.city_list.push(1==n?0:c.city_list[l]),o.wd2.push(1==n?"":c.wd2[l]),2==n&&l++,d++
}T.extend(t.result,o),t.content=p},parseOnePosition:function(t){var t=decodeURIComponent(t),e=t.split("$$");return{type:e[0],uid:e[1],point:e[2],keyword:decodeURIComponent(e[3]),if_sug:e[4],keyword2:decodeURIComponent(e[5]),fe_xy:e[6],if_wp:e[7]}},setParsValue:function(){this.resCity=this.tpCity;for(var t=0;t<=this.endIndex;t++)this.json.result.count[t]>0?0==this.json.result.city_list[t]?(this.resType[t]=1==this.json.result.prio_flag[t]?1:0,this.resCount[t]=this.json.result.count[t]):this.resType[t]=2:this.resType[t]=3;this.json.result.current_null&&(this.currentNull=this.json.result.current_null)},setRAStyle:function(){var t=this;if("RouteAddr"==window.currentComponent._className){var e,n,s=this.curPointIndex,o=T.G("RouteAddress_DIV"+s),i=83,r=this["scrollPanel"+s],a=10,d=T.g("MapHolder").offsetHeight,l=document.getElementById("RouteAddress_DIV"+(s==this.endIndex?0:s+1));r||(t["scrollPanel"+s]=new baidu.ui.ScrollPanel({container:"RADiv_ResItem"+s,overflow:"overflow-y",autoUpdate:!1})),"sel_x"==o.className?a=2:(o.className="sel_n")&&(a=10),e=T.g("RADiv_ResItem"+s),e||(e=T.g("DIV_CityList"+s),i+=a),n=d-(l.offsetHeight+5)*(this.json.content.tpList.length+2)-i,0>n&&(n=0),e.style.height=n+"px",r&&(r.getMain()?r.update():r.render(e.id))}},clearMarkers:function(){for(var t=0,e=this.markersList.length;e>t;t++)map.removeOverlay(this.markersList[t]);this.markersList=[],this.pointsList=[]},addMarkers:function(t,e){var n=(this.json.content||[],this),s=this.getCurPoint(t);if(n.clearMarkers(),s){for(var o=e[0];o<=e[1];o++)if(s[o]){var i=util.parseGeo(s[o].geo);n.markersList.push(mapUtil.addSearchPoi(i.points,o-e[0],s[o].name,{type:"RouteAddrMarker"})),n.pointsList.push(util.getPointByStr(i.points))}var r=n.pointsList;if(n.markerDest&&n.resCity[0]==n.resCity[1]&&r.push(n.markerDest.point),map.mapType==BMAP_TYPE_DIMENSIONAL){var a=BMap.MapType[BMAP_TYPE_DIMENSIONAL].citys,d=a[map.currentCity][1],l=util.getPointsBounds(r),p=mapUtil.getBitLevel(l);d.intersects(l)?(15>=p&&(p=15),map.centerAndZoom(r[0],p)):(maptypeCtrl.select(BMAP_TYPE_NORMAL),mapUtil.setViewport(r))}else mapUtil.setViewport(r);11==n.pointsList.length&&n.pointsList.pop();for(var c=this.markersList,o=e[0];o<=e[1];o++)!function(){var s=o;c[o-e[0]]&&(c[o-e[0]].addEventListener("click",function(){n.select(t,s)}),c[o-e[0]].addEventListener("mouseover",function(){var e=s%10;n.curSelectedIndex!=e&&n._selectIt(t,e)}),c[o-e[0]].addEventListener("mouseout",function(){var e=s%10;n.curSelectedIndex!=e&&n._unSelectIt(t,e)}))}()}},submit:function(){var t=this;require.async("common:widget/ui/throughpoint/Throughpoint.js",function(e){t._submitQuery(e)})},_submitQuery:function(t){var e=this,n=modelConfig.cityCode,s=e.qInfo[0].c,o=e.qInfo[e.endIndex].c,i={},r="",a="",d="",l="",p="",c=1,u=1;if(24==e.json.result.type&&0==e.originCity_List){var _=e.cinfo.t;0==_?(s=e.json.result.city.code,o=e.json.current_city.code):(s=e.json.current_city.code,o=e.json.result.city.code)}if(s==o&&(n=s),13==e.json.result.type||23==e.json.result.type||24==e.json.result.type)23==e.json.result.type&&s!=o?(a=e.qInfo[0],d=e.qInfo[1],l="1$$"+a.u+"$$"+a.x+","+a.y+"$$"+encodeURIComponent(a.n)+"$$$$$$",p=h+"1$$"+d.u+"$$"+d.x+","+d.y+"$$"+encodeURIComponent(d.n)+"$$$$$$",i={da_src:"pcmappg.routeaddr",navtp:4,c:n,sc:s,ec:o,sy:0,drag:0,sn:l,en:p,sq:encodeURIComponent(this.startName),eq:encodeURIComponent(this.endName)},r="nav&"+util.jsonToQuery(i,null),componentManager.go(r,{cinfo:e.cinfo})):((e.qInfo[0].t==constant.POI_TYPE_BUSSTOP||e.qInfo[0].t==constant.POI_TYPE_SUBSTOP)&&(c=0),(e.qInfo[1].t==constant.POI_TYPE_BUSSTOP||e.qInfo[1].t==constant.POI_TYPE_SUBSTOP)&&(u=0),l=c+"$$"+e.qInfo[0].u+"$$"+e.qInfo[0].x+","+e.qInfo[0].y+"$$"+encodeURIComponent(e.qInfo[0].n)+"$$$$$$",p=u+"$$"+e.qInfo[1].u+"$$"+e.qInfo[1].x+","+e.qInfo[1].y+"$$"+encodeURIComponent(e.qInfo[1].n)+"$$$$$$",i={da_src:"pcmappg.routeaddr",bttp:4,c:n,sc:s,ec:o,sn:l,en:p,sq:encodeURIComponent(this.startName),eq:encodeURIComponent(this.endName),exptype:this.exptype,exptime:this.exptime,version:this.version},r="bt&"+util.jsonToQuery(i,null),componentManager.go(r,{cinfo:e.cinfo}));else{for(var h="",m="",g=this.endIndex,y=0;y<t.tpListInMap.length;y++){var f=t.tpListInMap[y];h+=t.getTPointQueryParam(f),m+=e.qInfo[y+1].c+"+to:"}a=e.qInfo[0],d=e.qInfo[g],l="1$$"+a.u+"$$"+a.x+","+a.y+"$$"+encodeURIComponent(a.n)+"$$$$$$",p=h+"1$$"+d.u+"$$"+d.x+","+d.y+"$$"+encodeURIComponent(d.n)+"$$$$$$",i={da_src:"pcmappg.routeaddr",navtp:4,c:n,sc:s,ec:m+o,sy:0,drag:0,sn:l,en:p,sq:encodeURIComponent(this.startName),eq:encodeURIComponent(this.endName)},r="nav&"+util.jsonToQuery(i,null),componentManager.go(r,{cinfo:e.cinfo})}},addPointMarker:function(t,e,n,s,o){var i;if(0==n)i=mapUtil.addDestPoi(t,e,0,!0);else if(n==this.endIndex)i=mapUtil.addDestPoi(t,e,1,!0);else{var r=TPM.tpListInMap[n-1];r.point=util.getPoiPoint(t),o&&(r.uid=o),i=TPM.createMarkerByTp(r,n-1,!0)}return i},itmSelect:function(t,e){var n=this,s=(n.json.content||[],this.getCurPoint(t));n.qInfo[t].n=s[e].name,n.qInfo[t].c=this.resCity[t],n.qInfo[t].u=s[e].uid;var o=util.getPointByStr(util.parseGeo(s[e].geo).points);if(n.qInfo[t].x=o.lng,n.qInfo[t].y=o.lat,n.qInfo[t].t=s[e].poiType,T.G("B_PointName"+t).innerHTML=T.string.subByte(s[e].name,14,"..."),n.markerDest=this.addPointMarker(o,s[e].name,t,!0),0!=t&&t!=this.endIndex){var i=TPM.tpListInMap[t-1];i.query=s[e].name}if(n.clearMarkers(),this.isAllPointSure())n.markerDest&&(map.removeOverlay(n.markerDest),n.markerDest=null),n.submit();else{T.G("RouteAddress_DIV"+t).className="sel_y";for(var r=0,a=1;a<=this.endIndex;a++){var d=(t+a)%(this.endIndex+1);if("sel_y"!=T.G("RouteAddress_DIV"+d).className){r=d;break}}if(0==n.resType[r]){T.G("RouteAddress_DIV"+r).className="sel_n";var l=n.curPageIndex,p=10*(l-1)+9,c=this.getCurPoint(r);c.length<p+1&&(p=c.length-1),n.addMarkers(r,[10*(l-1),p]),n.select(r,0),n._highLightInput(r)}else 2==n.resType[r]?(T.G("RouteAddress_DIV"+r).className="sel_n",n._highLightInput(r)):T.G("RouteAddress_DIV"+r).className="sel_x";this.curPointIndex=r,n.setRAStyle(),n.adjustListHeight(),window.contextMenu.getItem(0==t?0:t==this.endIndex?2:1).disable()}},getCurPoint:function(t){return 0==t?this.json.content.start:t==this.endIndex?this.json.content.end:this.json.content.tpList[t-1]},select:function(t,e,n){if(arguments.length>2){n=n||window.e;var s=n.srcElement||n.target;if("selBtn"==s.className)return}var o=(this.json.content||[],this),i=o.getCurPoint(t);map.closeInfoWindow(),i&&(o.resCity[0]!=o.resCity[1]&&o.markerDest&&mapUtil.setViewport(o.pointsList),this._showInfoWindow(i,t,e),-1!=this.curSelectedIndex&&this._unSelectIt(t,this.curSelectedIndex),this.curSelectedIndex=e%10,this._selectIt(t,this.curSelectedIndex))},_showInfoWindow:function(t,e,n){var s=this,o=t[n],i="<span class='iw_poi_title' title='"+o.name+"'>"+T.string.subByte(o.name,25,"...")+"</span>",r=[],a="";o.addr&&""!=o.addr&&(o.poiType==constants.POI_TYPE_NORMAL?a="地址: "+o.addr:o.poiType==constants.POI_TYPE_BUSSTOP?a="途经公交车："+T.array.unique(o.addr.split(";")).join("; "):o.poiType==constants.POI_TYPE_SUBSTOP&&(a="途经地铁："+T.array.unique(o.addr.split(";")).join("; "))),r.push("<div style='padding:11px 11px 6px 11px;line-height:20px;word-break:break-all'>"+a+"</div>"),r.push("<div style='line-height:180%;margin-bottom:10px;'>");var d="选为途经点";0==e&&(d="选为起点"),e==this.endIndex&&(d="选为终点"),r.push("<div style='text-align:center;'><div class='selInfoWndBtn' onclick='RouteAddrInst.itmSelect("+e+","+n+");' onmouseover='RouteAddrInst._selBtnOver(this)' onmousedown='RouteAddrInst._selBtnDown(this)' onmouseout='RouteAddrInst._selBtnOut(this)' />"+d+"</div>"),r.push("</div>");var l=new BMap.InfoWindow(r.join(""),{title:i,height:0,width:280,margin:[0,0,0,0]}),p=n%10;if(s.panoData){var c=0;if(1==e){var u=this.getCurPoint(0).length;c=u>10?10+p:u+p}else c=p;s.panoData[c]&&(l=PanoEntranceUtil.addPanoThumbnailsInInfoWnd([l],[s.panoData[c]],s.panoData,"routeaddr")[0])}l.addEventListener("close",function(){s._unSelectIt(e,p),s.curSelectedIndex=-1}),this.markersList&&this.markersList[p]&&this.markersList[p].openInfoWindow(l)},makeListTable:function(t,e,n){this.curSelectedIndex=-1;var s=n?n:this.getCurPoint(t),o=[];o.push('<div id="RA_ResItem_'+t+'"><table border="0" cellspacing="0" cellpadding="0" style="width:100%">');for(var i=e[0];i<=e[1];i++){o.push('<tr onmouseover="RouteAddrInst._lstMouseOver(this, 0,'+t+", "+(i-e[0])+', event)" onmouseout="RouteAddrInst._lstMouseOut(this, 0,'+t+", "+(i-e[0])+', event)" onclick="RouteAddrInst.select('+t+","+i+', event);"><th><div title="在图上显示该点" class="icon iconbg" id="no_'+t+"_"+(i-e[0]+1)+'"></div></th>');var r=0==t?"选为起点":t==this.endIndex?"选为终点":"选为途经点";o.push('<td style="word-break:break-all;padding-right:24px">'),o.push('<a href="javascript:void(0)">'+s[i].name+"</a>"),s[i].addr&&""!=s[i].addr&&(o.push("<div>"),s[i].poiType==constants.POI_TYPE_NORMAL?o.push('<span style="color:#999">地址: '+s[i].addr+"</span>"):s[i].poiType==constants.POI_TYPE_BUSSTOP?o.push('<span style="color:#999">途经公交车：</span>'+T.array.unique(s[i].addr.split(";")).join("; ")):s[i].poiType==constants.POI_TYPE_SUBSTOP&&o.push('<span style="color:#999">途经地铁：</span>'+T.array.unique(s[i].addr.split(";")).join("; ")),o.push("</div>")),o.push("</td>"),o.push('<td style="vertical-align:middle;width:106px"><div tid="selBtn_'+t+"_"+i+'" class="selBtn" onclick="RouteAddrInst.itmSelect('+t+","+i+');return false;" onmouseover="RouteAddrInst._selBtnOver(this)" onmouseout="RouteAddrInst._selBtnOut(this)" onmousedown="RouteAddrInst._selBtnDown(this)">'+r+"</div>"),o.push('<a data-uid="'+s[i].uid+'" data-index="'+(i-e[0])+'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:hidden"><img src="../../../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ ></a>'),o.push("</td>"),o.push("</tr>")}return o.push("</table></div>"),o.join("")},_selBtnOver:function(t){t.style.backgroundPosition="-100px -81px"},_selBtnOut:function(t){t.style.backgroundPosition="-21px -81px"},_selBtnDown:function(t){t.style.backgroundPosition="-220px -81px",t.style.fontWeight="bold"},_lstMouseOver:function(t,e,n,s){this.curSelectedIndex!=s&&(map.closeInfoWindow(),this._selectIt(n,s))},_selectIt:function(t,e){var n,s=this;if(n=T.G("RA_ResItem_"+t).childNodes[0]){var o=n.rows[e];if(o){o.style.backgroundColor="#F4F4F4";var i=o.getElementsByTagName("td")[1],r=i.childNodes[0];r.style.visibility="visible";var a=o.getElementsByTagName("th")[0],d=a.childNodes[0];d.style.backgroundPosition=24*-e+"px -32px"}}if(s.markersList.length>e){var l=new BMap.Icon(constants.A_J_MARKER_IMG,constants.A_J_MARKER_BLUE_SIZE,{offset:constants.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-constants.A_J_MARKER_BLUE_ICON_WID*e,-constants.A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:constants.A_J_MARKER_INFOWND_OFFSET});s.markersList[e].setIcon(l),s._setTop(s.markersList[e],!0,!0)}},_unSelectIt:function(t,e){var n=this,s=null;if(T.G("RA_ResItem_"+t)&&(s=T.G("RA_ResItem_"+t).childNodes[0]),s){var o=s.rows[e];o.style.backgroundColor="#ffffff";var i=o.getElementsByTagName("td")[1],r=i.childNodes[0];r.style.visibility="";var a=o.getElementsByTagName("th")[0],d=a.childNodes[0];d.style.backgroundPosition=24*-e+"px -64px"}if(n.markersList.length>e){var l=new BMap.Icon(constants.A_J_MARKER_IMG,constants.A_J_MARKER_RED_SIZE,{offset:constants.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(-constants.A_J_MARKER_RED_ICON_WID*e,-constants.A_J_MARKER_ORANGE_ICON_Y),infoWindowOffset:constants.A_J_MARKER_INFOWND_OFFSET});n.markersList[e].setIcon(l),n._setTop(n.markersList[e],!1)}},_lstMouseOut:function(t,e,n,s){this.curSelectedIndex!=s&&this._unSelectIt(n,s)},_setTop:function(t,e,n){return t&&t.setTop?e&&!t._isTop&&t.iconDom&&t.iconDom.style?(t._isTop=!0,void(n?t.setTop(!0,1000100):t.setTop(!0))):void(!e&&t.iconDom&&t.iconDom.style&&(delete t._isTop,t.setTop(!1))):void 0},getCurPoiName:function(t){return void 0==t&&(t=this.curPointIndex),0==t?this.startName:t==this.endIndex?this.endName:this.tpName[t-1]},showLst:function(t){this.curPointIndex=t;var e=this,n=e.json.content.tpList,s=n.length+1,o=this.getCurPoint(t);if(!o||1!=o.length||!o[0].ifFromIW||1!=o[0].ifFromIW){var i=e.curPageIndex,r=T.g("RouteAddress_DIV"+t).className;if("sel_n"!=r&&"sel_x"!=r&&(!this.canShowList||this.canShowList[t])){if("sel_n1"==r||"sel_y"==r||"sel_x1"==r){for(var a=0;s>=a;a++){var d=T.G("RouteAddress_DIV"+a);T.G("B_PointName"+a).innerHTML=T.string.subByte(this.getCurPoiName(a),14,"..."),"sel_x"==d.className?d.className="sel_x1":"sel_n"==d.className&&(d.className="sel_n1")}if(e.clearMarkers(),e.markerDest&&(map.removeOverlay(e.markerDest),e.markerDest=null),"sel_y"==r&&(e.qInfo[t]={n:"",c:0,u:0,x:0,y:0,t:-1},e.resType[t]=0),e.json.result.count[t]<=0)T.G("RouteAddress_DIV"+t).className="sel_x";else if(T.G("RouteAddress_DIV"+t).className="sel_n",1!=e.json.result.city_list[t]){var l=10*(i[t]-1)+9;o.length<l+1&&(l=o.length-1),e.addMarkers(t,[10*(i[t]-1),l])}(0==t||t==s)&&window.contextMenu.getItem(0==t?0:2).enable()}(0==t||t==s)&&e._highLightInput(0==t?0:1),e.setRAStyle(),e.adjustListHeight(),this.curSelectedIndex=-1}}},changeCity:function(t,e){var n=this,s=T.dom.getPosition(t),o=T.G("MapInfo"),i=0;i=s.top+18-o.scrollTop;var r={left:30,height:402,top:i,ifAddrPage:!0,echo:function(t){t.changed=1,t.name=decodeURIComponent(t.name),n._changeCity(e,t)}};indexUtil.selectCity(t,r)},_changeCity:function(t,e){function n(e){{var n=e.result;e.content}o.resCity[t]=e.current_city.code,indexUtil.setCurCity(e.current_city.name,e.current_city.code,e.current_city.type,e.current_city),n.count>0?0==n.city_list?(o.resCount[t]=n.count,o.resType[t]=0):(o.resCount[t]=0,o.resType[t]=2):(o.resCount[t]=0,o.resType[t]=3),o.json.result.city_list[t]=n.city_list,o.currentNull[t]=n.current_null,o._reSetPage(t,o.resType[t],e),o.setRAStyle(),o.adjustListHeight(),0==t?window.contextMenu.getItem(0).enable():t==o.endIndex&&window.contextMenu.getItem(2).enable()}var s="&nsetp=1&cn="+encodeURIComponent(e.name)+(1==e.changed?"":"&click=1");searchData.fetch("nse&c="+e.code+"&wd="+encodeURIComponent(this.getCurPoiName(t))+"&src=5"+s,n);var o=this;o.pop&&(o.pop.close(),o.pop=null)},_reSetPage:function(t,e,n){var s=[],o=this;switch(e){case 0:13!=n.result.type&&24!=n.result.type&&(T.G("RD_TOP_BUT"+t).innerHTML='<a href="javascript:void(0)" onclick="RouteAddrInst.changeCity(this,'+t+');return false;">更换城市</a>'),s.push('<div id="RADiv_ResItem'+t+'" class="sel_body_body_div sel_body_resitem">');var i=[0,9];n.content.length<10&&(i[1]=n.content.length-1),0==t&&(this.json.content.start=n.content),t==this.endIndex?this.json.content.end=n.content:this.json.content.tpList[t-1]=n.content,s.push(o.makeListTable(t,i)),n.result.count>10&&(s.push('<div id="RADiv_PAGE'+t+'" style="height:20px;" class="sel_body_body_page"></div>'),o.totalPage=Math.ceil(n.result.count/10),o.curPageIndex=1),s.push("</div>"),T.G("RADIV_BODY"+t).innerHTML=s.join(""),T.G("RouteAddress_DIV"+t).className="sel_n";var r=[0,9];n.content.length<r[1]+1&&(r[1]=n.content.length-1),o.addMarkers(t,r);break;case 2:13!=n.result.type&&24!=n.result.type&&(T.G("RD_TOP_BUT"+t).innerHTML='<a href="javascript:void(0)" onclick="RouteAddrInst.changeCity(this,'+t+');return false;">更换城市</a>'),s.push('<div id="DIV_CityList'+t+'" class="sel_body_body_div sel_body_citylist">'),1*n.result.current_null!=0&&s.push('<div style="margin-top:10px;">在<b>'+n.current_city.name+"</b>未找到相关地点。</div>"),s.push('<div style="margin-top:10px">在以下城市有结果，请选择城市：</div>'),s.push('<div style="margin-top:10px">'),s.push('<table cellspacing="0" cellpadding="0" border="0" align="left" width="100%" style="margin: 0px 0pt 8px;"><tr>');for(var a=0,d=0;a<(n.content.length>6?6:n.content.length);a++,d++){var l=n.content[a],p=l.name,c=(l.code,l.num),u=2*p.length,_=c.toString().length+2,h=u+_;if(12>=h)s.push('<td width="33%" valign="top">');else{if(d%3==2){s.push("</tr><tr>"),s.push('<td width="66%" valign="top" colspan="2">'),s.push('<a href="javascript:void(0)" class="hotcity" tid="selCity_'+a+'" onclick="RouteAddrInst._changeCity('+t+", {code:'"+n.content[a].code+"', name:'"+n.content[a].name+"'});return false;\">"+n.content[a].name+"</a>("+n.content[a].num+")"),s.push("</td>"),d+=2;continue}s.push('<td width="66%" valign="top" colspan="2">'),d++}s.push('<a href="javascript:void(0)" class="hotcity" tid="selCity_'+a+'" onclick="RouteAddrInst._changeCity('+t+", {code:'"+n.content[a].code+"', name:'"+n.content[a].name+"'});return false;\">"+n.content[a].name+"</a>("+n.content[a].num+")</td>"),(d+1)%3==0&&s.push("</tr><tr>")}s.push("</tr></table></div>"),1==n.result.city_list&&n.result.count>6&&s.push('<div style="clear:both;margin-:10px"><a class="arrowLink" href="javascript:void(0)" onclick="RouteAddrInst.showMoreCity('+t+',this);return false;">更多城市</a></div>'),s.push("</div>"),T.G("RADIV_BODY"+t).innerHTML=s.join(""),T.G("RouteAddress_DIV"+t).className="sel_n",o.totalPage=0,o.curPageIndex=1;break;case 3:s.push('<div id="DIV_CityList'+t+'">'),s.push('<div style="margin-top:10px;">在<b>'+n.current_city.name+"</b>未找到相关地点。</div>"),s.push('<div style="margin-top:10px">在全国也没有找到结果</div></div>'),T.G("RADIV_BODY"+t).innerHTML=s.join(""),T.G("RouteAddress_DIV"+t).className="sel_x",o.totalPage=0,o.curPageIndex=1}if(0==e&&T.G("RADiv_PAGE"+t)&&T.G("RADiv_PAGE"+t)){new Page("RADiv_PAGE"+t,function(e){var n=[10*(e-1),10*e-1];o.resCount[t]<n[1]+1&&(n[1]=o.resCount[t]-1);var s="RA_ResItem_"+t,i="RADiv_ResItem"+t;T.G(s)&&(T.dom.remove(T.G(s)),T.dom.insertHTML(T.G(i),"AFTERBEGIN",o.makeListTable(t,n))),o.addMarkers(t,n,!0),o.setRAStyle(),T.G("RADiv_ResItem"+t).scrollTop=0,o["scrollPanel"+t]&&o["scrollPanel"+t].update(),o.curPageIndex=e},{pagecap:5,pageCount:o.totalPage,page:o.curPageIndex})}o.setPanoEntrances()},showMoreCity:function(t,e){var n=this;if(this.pop&&1==this.pop.visible)return void this.pop.hide();if(this.pop&&0==this.pop.visible)return void this.pop.show();var s=this.getCurPoiName(t),o="";o=1==this.currentNull[t]?AID["中国"]:this.resCity[t],searchData.fetch("cmc&c="+o+"&wd="+encodeURIComponent(s),function(s){n._showMCPopup(s,t,e)})},_showMCPopup:function(t,e,n){if(t&&(!t||t.content)){var e=e;this.curSelIndex=-1;var s=T.dom.getPosition(n),o=T.G("MapInfo"),i=s.top+18-o.scrollTop,r=this;require.async("common:widget/ui/Popup/Popup.js",function(n){r.pop=new n({title:"更多城市",content:r._getMoreCityListHtml(t,e),height:160,width:240,addDom:T.G("moreCityPop"),close:function(){r.pop=null}}),r.pop.addConnectDom(T.G("moreCity1")),r.pop.render(),r.moreCityScrollPanel.render("moreCity_scrollPanel"),r.pop.getDom().style.left="12px",r.pop.getDom().style.top=i+"px",r.pop.getDom().id="more_city_popup"})}},_getMoreCityListHtml:function(t,e){var n=t.result;if(n.count<=0)return"没找到相关数据，抱歉。";var s=n.city_type,o=t.content;if(o&&!(o&&o.length<=0)){var i=[];if(i.push("<div class='moreCity_wrapper'>"),i.push("<div id='moreCity_scrollPanel' class='moreCity_scrollPanel'>"),1==s){i.push("<ol class='mc_list2'>");for(var r=o[0].city,a=0;a<r.length;a++)i.push("<li><a href='javascript:void(0)' onclick='RouteAddrInst._changeCity("+e+',{code:"'+r[a].code+'",name:"'+r[a].name+"\"});return false;'>"+r[a].name+"</a>("+r[a].num+")</li>");i.push("</ol>")}else{i.push("<ol class='mc_list'>");for(var d=0;d<o.length;d++){i.push("<li><a id='prov_"+d+"' href='javascript:void(0)' onclick='return RouteAddrInst.unfoldCityList("+d+", event)'>"),i.push(o[d].province+"</a>("+o[d].num+")");var r=o[d].city;i.push("<ol id='cl_"+d+"'class='mc_list_city' style='display:none'>");for(var a=0,l=r.length;l>a;a++)i.push("<li><a href='javascript:void(0)' onclick='RouteAddrInst._changeCity("+e+',{code:"'+r[a].code+'",name:"'+r[a].name+"\"});return false;'>"+r[a].name+"</a>("+r[a].num+")</li>");i.push("</ol></li>")}i.push("</ol>")}return i.push("</div>"),i.push("</div"),i.join("")}},unfoldCityList:function(t){var e=T.G("cl_"+t);return e&&"block"==e.style.display?this._hide(t):(this._hide(this.curSelIndex),this._show(t)),e.parentNode.parentNode.parentNode&&(e.parentNode.parentNode.parentNode.scrollTop=24*t,this.moreCityScrollPanel.update()),!1},_show:function(t){if(-1!=t){var e=T.G("cl_"+t);T.ac(T.G("prov_"+t),"fold"),e.style.display="block",this.curSelIndex=t}},_hide:function(t){if(-1!=t){var e=T.G("cl_"+t);T.rc(T.G("prov_"+t),"fold"),e.style.display="none"}},navigate:function(){searchBox._ByClickTab=!1,componentManager.go("nav&c="+this.json.current_city.code+"&sc="+this.json.current_city.code+"&ec="+this.json.current_city.code+"&sn=2$$$$$$"+encodeURIComponent(this.json.result.s_wd||this.json.result.s_query)+"$$&en=2$$$$$$"+encodeURIComponent(this.json.result.e_wd||this.json.result.e_query)+"$$")},goDrv:function(){var t="",e=1,n=this.cinfo.kwn;(n.poiType==constants.POI_TYPE_BUSSTOP||n.poiType==constants.POI_TYPE_SUBSTOP)&&(e=0),searchBox._ByClickTab=!1;var s=this.json.current_city.code,o="&en=";1==this.cinfo.t&&(o="&sn="),t=o+e+"$$"+n.uid+"$$"+n.pt.lng+","+n.pt.lat+"$$"+n.name+"$$";var i="nse&c="+s+"&wd="+encodeURIComponent(this.json.result.wd)+"&isSingle=true&t="+this.cinfo.t+"&name="+encodeURIComponent(n.name)+"&uid="+n.uid+"&ptx="+n.pt.lng+"&pty="+n.pt.lat+"&poiType="+n.poiType+t;i=i+"&req="+encodeURIComponent(i),componentManager.go(i,{cinfo:{q:i,c:s,isSingle:!0,t:this.cinfo.t,kwn:{name:n.name,uid:n.uid,pt:n.pt,poiType:n.poiType}}})},removeTip:function(){},addTip:function(){var t=util.getClientSize().width;"open"==sideBar.status&&(t-=310),this.routeTip&&util.beforeEndHTML(document.body,this.routeTip)},setPanoEntrances:function(){for(var t=this.$el.find(".list_street_view_poi"),e=[],n=this,s=0;s<t.length;s++)e.push({uid:t[s].getAttribute("data-uid"),index:t[s].getAttribute("data-index")});PanoEntranceUtil.insertPanoInfoInSearch(e,"routeaddr",function(e){n.panoData=e,PanoEntranceUtil.walkThroughPanoEntrances(t,e,"routeaddr")})}}),module.exports=RouteAddr});