define("common:widget/com/PanoInfoWindow/PanoInfoWindow.js",function(require,exports,module){function PanoInfoWindow(t){T.lang.Class.call(this,t),this.infoData=null,this.dom=t.dom||{},this.cinfo=t.cinfo||{},searchInfoWindow=this.cinfo.searchInfoWindow||{},this.render(),this.initialize()}var BaseComponent=require("common:widget/com/BaseComponent.js"),util=require("common:widget/ui/util/util.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),PanoInfoUtil=require("common:widget/ui/PanoInfoUtil/PanoInfoUtil.js"),SmpMgr=require("common:widget/ui/setMyPlace/SetMyPlaceMgr.js"),config=require("common:widget/ui/config/config.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,constant=require("common:widget/ui/constant/Constant.js"),sugInstance=window.sugInstance||{},searchInfoWindow=null;T.lang.inherits(PanoInfoWindow,T.lang.Class,"PanoInfoWindow"),T.object.extend(PanoInfoWindow.prototype,{render:function(){try{var t=".panoUserSignCtrl{position:absolute;top:-26px!important;right:16px!important;height:20px;text-align:right;min-width:52px;z-index:1}.panoUserSignCtrl .ctrl .shareBtn b{left:0!important;top:0!important}#panorangekw{width:78px;height:20px;line-height:20px;border:1px solid #A5ACB2}#iw_pano_ssn,#iw_pano_esn{margin-right:0;margin-left:0;width:153px;*width:151px;padding-right:23px;height:21px;line-height:21px;border:#b3b3b3 solid 1px}.pano_bubble_pop{position:absolute;cursor:default;border:1px solid #999;background-color:#fff;width:345px}.pano_bubble_title{line-height:30px;background-color:#f9f9f9;overflow:hidden;height:30px;white-space:nowrap;width:345px}.pano_bubble_top{border-bottom:1px solid #ccc;height:31px}.pano_bubble_btn{float:right;position:absolute;top:0;right:0;height:30px;background-color:#f9f9f9}.pano_bubble_center{z-index:3;position:relative;width:345px}.pano_bubble_content{width:345px;overflow:hidden}.pano_bubble_bottom{display:block;z-index:2;position:absolute;width:345px}.pano-right{position:absolute;top:50px;left:345px}.pano-left{position:absolute;top:50px;left:-11px}";require.loadCss({content:t,name:"PanoInfoWindow"})}catch(i){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/PanoInfoWindow/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/com/PanoInfoWindow/PanoInfoWindow.js",ln:40})}},initialize:function(){try{var t=this,i="/?qt=inf&uid="+this.cinfo.uid+"&ie=utf-8&t="+(new Date).getTime();baidu.ajax(i,{dataType:"json",success:function(i){t.getInfo(i)},error:function(){}})}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/PanoInfoWindow/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/PanoInfoWindow/PanoInfoWindow.js",ln:56})}},getInfo:function(json){var _this=this,win=window;if(json&&json.content){_this.infoData=json;var cont=json.content,geoPoint=util.geoToPoint(cont.geo),ntitle=cont.name.replace(/[\u0100-\uffff]/g,"##").length>30?cont.name.substring(0,14)+"...":cont.name,direct=_this.cinfo.direction;arrowCls=direct?"pano-right":"pano-left",arrowImg=direct?"../../../images/panorama/pano-right_87f67f4.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/pano-right_87f67f4.png*/:"../../../images/panorama/pano-left_de67b5e.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/pano-left_de67b5e.png*/,timg="../../../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/;var detail=_this.getDetailLink(cont);detail&&ntitle.replace(/[\u0100-\uffff]/g,"##").length>25&&(ntitle=ntitle.substring(0,11)+"...");var placeReserveInfo=_this.getPlaceReserveInfo(cont),template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="BMap_bubble_pop pano_bubble_pop"><div class="BMap_bubble_top pano_bubble_top"><div class="BMap_bubble_title pano_bubble_title"><p class="iw_poi_title" title="',"undefined"==typeof title?"":title,'">',"undefined"==typeof ntitle?"":ntitle,"","undefined"==typeof detail?"":detail,'</p></div><div class="BMap_bubble_buttons pano_bubble_btn" ><div style="cursor: pointer; display: none;"><img style="position:absolute;top:9px;width:10px;height:10px;-moz-user-select:none;cursor:pointer;z-index:10000;display:none" src="',"../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/api/iw_plus.gif"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/api/iw_plus.gif*/,'"></div><div class="pano_inf_close" style="cursor:pointer;width:32px;height:30px"><img style="position:absolute;top:9px;right:12px;width:10px;height:10px;-moz-user-select:none;cursor:pointer;z-index:10000;" src="',"../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/api/iw_close.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/api/iw_close.gif*/,'"></div></div></div><div class="BMap_bubble_center pano_bubble_center" ><div class="BMap_bubble_content pano_bubble_content"><div class="iw_poi_conTop"><div class="iw_poi_content iw_poi_content_search" style="width:330px;"><table cellspacing="0" class="table_addr_tel"><tbody><tr tid="iw_poi_addr"><th>地址：&nbsp;</th><td>',"undefined"==typeof address?"":address,"&nbsp;</td></tr>"),tel&&_template_fun_array.push('    <tr tid="iw_poi_tel">    <th>电话：&nbsp;</th>    <td>',"undefined"==typeof tel?"":tel,"</td>    </tr>"),_template_fun_array.push('</tbody></table></div><div class="iw_btn_con"></div>',"undefined"==typeof placeReserveInfo?"":placeReserveInfo,'</div><div class="iw_poi_inter" id="iw_pano_inter"><ul class="nav_tab"><li id="pano_tab2" class="third blueA hover" ><img src="',"undefined"==typeof timg?"":timg,'">在附近找</li><li id="pano_tab0" class="second blueA "><img src="',"undefined"==typeof timg?"":timg,'">到这里去</li><li id="pano_tab1" class="first blueA " ><img src="',"undefined"==typeof timg?"":timg,'">从这里出发</li></ul><div id="iw_pano_tab0" class="nav_tab_content" style="display:none"><form id="iw_s_pano_frm"><div><span class="lef">起点</span><span id="iw_pano_ssnSpan" class="iw_txt_wrap"><input id="iw_pano_ssn" type="text" size="22" maxlength="100" autocomplete="off"><span class="smp_iws_btn" title="常用地点" ></span></span><input id="iw_ssb_pano_btn" type="submit" value="公交" class="iw_bt" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'"><input id="iw_ssd_pano_btn" type="button" class="iw_bt" value="驾车" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'"></div></form></div><div id="iw_pano_tab1" class="nav_tab_content" style="display:none"><form id="iw_e_pano_frm"><div><span class="lef">终点</span><span id="iw_pano_esnSpan" class="iw_txt_wrap"><input id="iw_pano_esn" type="text" size="22" maxlength="100" autocomplete="off"><span class="smp_iwe_btn" title="常用地点" ></span></span><input id="iw_esb_pano_btn" type="submit" value="公交" class="iw_bt" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'"><input id="iw_esd_pano_btn" type="button" value="驾车" class="iw_bt" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'"></div></form></div><div id="iw_pano_tab2" class="nav_tab_content" style="display:block"><div class="iw_cate_list" ><a href="javascript:void(0)" tid="iwNSLink"  class="first">宾馆</a><a href="javascript:void(0)" >餐馆</a><a href="javascript:void(0)" >银行</a><a href="javascript:void(0)">医院</a><a href="javascript:void(0)" >公交站</a></div><div class="iw_cate_form"><form ><input id="panorangekw" type="text" size="19" maxlength="100" autocomplete="off" /><input tid="iwNSBtn" type="submit" value="搜索" class="iw_bt" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'" /></form></div></div></div><div id="userSignEdit" style="display:none;"></div></div></div><div class="BMap_bubble_bottom pano_bubble_bottom"></div><img class="',"undefined"==typeof arrow?"":arrow,'" src="',"undefined"==typeof arrowImg?"":arrowImg,'" width="11" height="14" /></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];baidu.g("panoInfoWindow").innerHTML=template({pguid:_this.guid,pointx:geoPoint.lng,pointy:geoPoint.lat,uid:cont.uid,title:cont.name,ntitle:ntitle,address:cont.addr,tel:cont.tel,ccode:json.current_city.code||modelConfig.cityCode,arrow:arrowCls,arrowImg:arrowImg,timg:timg,detail:detail,placeReserveInfo:placeReserveInfo}),_this.addSwitchTabEvent(json,geoPoint)}},addSwitchTabEvent:function(t,i){var e=this,n=baidu.g("pano_tab0"),o=baidu.g("pano_tab1"),a=baidu.g("pano_tab2"),s=baidu.g("iw_pano_tab0"),l=baidu.g("iw_pano_tab1"),d=baidu.g("iw_pano_tab2");baidu.on(n,"click",function(){baidu.addClass(n,"hover"),baidu.removeClass(o,"hover"),baidu.removeClass(a,"hover"),baidu.setStyle(s,"display","block"),baidu.setStyle(l,"display","none"),baidu.setStyle(d,"display","none")}),baidu.on("pano_tab1","click",function(){baidu.addClass(o,"hover"),baidu.removeClass(n,"hover"),baidu.removeClass(a,"hover"),baidu.setStyle(l,"display","block"),baidu.setStyle(s,"display","none"),baidu.setStyle(d,"display","none")}),baidu.on("pano_tab2","click",function(){baidu.addClass(a,"hover"),baidu.removeClass(n,"hover"),baidu.removeClass(o,"hover"),baidu.setStyle(d,"display","block"),baidu.setStyle(s,"display","none"),baidu.setStyle(l,"display","none")}),baidu("#iw_s_pano_frm").on("submit",function(t){e.panoInfoSearch(t),t.preventDefault()}),baidu("#iw_e_pano_frm").on("submit",function(t){e.panoInfoSearch(t),t.preventDefault()}),baidu("#iw_ssd_pano_btn").on("click",function(t){e.panoInfoSearch(t),t.preventDefault()}),baidu("#iw_esd_pano_btn").on("click",function(t){e.panoInfoSearch(t),t.preventDefault()}),baidu(".pano_inf_close").on("click",function(){PanoInfoUtil.close()}),baidu("#iw_pano_ssnSpan .smp_iws_btn").on("click",function(t){SmpMgr.openList("iw_pano_ssn",t)}),baidu("#iw_pano_esnSpan .smp_iwe_btn").on("click",function(t){SmpMgr.openList("iw_pano_esn",t)});var p=this.infoData.content,c=p.uid,r=this.infoData.current_city.code||modelConfig.cityCode,i=util.geoToPoint(p.geo),_=i.lng,u=i.lat;baidu(".iw_cate_list").delegate("a","click",function(t){e.roundSearchByLink(t,c,"",r,0,_,u,0),t.preventDefault()}),baidu(".iw_cate_form form").on("submit",function(t){e.roundSearchByInput("panorangekw",c,null,r,null,_,u,0),t.preventDefault()}),searchInfoWindow.iwExt=searchInfoWindow.iwNavSubmit._ext={uid:t.content.uid,pt:new BMap.Point(i.lng,i.lat),name:t.content.name},this.loadSugg(t)},loadSugg:function(t){require.async("common:widget/ui/MapSuggest/MapSuggest.js",function(i){"undefined"!=typeof i&&(sugInstance.iw_sugg_0=new i({inputid:"iw_pano_ssn",offset:[1,0],closeB:1,qType:2,cityid:t.current_city.code||modelConfig.cityCode}),sugInstance.iw_sugg_1=new i({inputid:"iw_pano_esn",offset:[1,0],closeB:1,qType:2,cityid:t.current_city.code||modelConfig.cityCode}))})},panoInfoSearch:function(t){searchInfoWindow.iwNavSubmit(t),PanoInfoUtil.close(),PanoUtil.hide()},roundSearchByLink:function(t,i,e,n,o,a,s){var l=t.target||t.srcElement;"a"==l.nodeName.toLowerCase()&&(searchInfoWindow.roundSearchByLink(l,i,e,n,o,a,s,!1),PanoInfoUtil.close())},roundSearchByInput:function(t,i,e,n,o,a,s){searchInfoWindow.roundSearchByInput(t,i,e,n,o,a,s,!1),PanoInfoUtil.close()},getPlaceReserveInfo:function(t){var i=t.detail&&t.ty==constant.GEO_TYPE_POINT||t.poiType==constant.POI_TYPE_BUSLINE||t.poiType==constant.POI_TYPE_SUBLINE;if(!i||!window.place)return"";var e=t.ext,n=window.place.placeRe,o=t.poiType||constant.POI_TYPE_NORMAL,a=t.uid,s=modelConfig.cityCode;return e&&n.test(e.src_name)?window.place.generateAsyncBookPrice({ext:e,uid:a,poiType:o,cityCode:s}):e&&e.detail_info&&e.detail_info.book_info&&"undefined"!=typeof e.detail_info.movie_film_count?window.place.generateAsyncBookByMovie({uid:a,poiType:o,category:e.src_name,cityCode:s}):void 0},getDetailLink:function(t){var i=t.detail&&t.ty==constant.GEO_TYPE_POINT||t.poiType==constant.POI_TYPE_BUSLINE||t.poiType==constant.POI_TYPE_SUBLINE;if(i&&window.place){var e=t.ext,n=e&&e.pic_info?e.pic_info:[],o=window.place.placeRe,a=t.uid,s=!!e&&e.src_name,l=t.poiType||constant.POI_TYPE_NORMAL,d=modelConfig.cityCode;if(e&&("biaozhu_data"==s||o.test(e.src_name))){var p="详情";return"biaozhu_data"==e.src_name&&(""!=e.detail_info[1].description||e.youhui_info.length>0&&(""!=e.youhui_info[0].info||2==e.youhui_info[0].date.length)||n.length>0)?"":"<a href='javascript:void(0)' onclick='place.showDetail(\""+a+'", '+l+", "+d+', "'+e.src_name+'","Page","Iw");return false;\'>'+p+"&raquo;</a>"}return"<a href='javascript:void(0)' onclick='place.showDetail(\""+a+'", '+l+", "+d+");return false;'>详情&raquo;</a>"}return""}}),module.exports=PanoInfoWindow});