define("common:widget/ui/StreetView/StreetView.js",function(o,n,t){function e(o,n){T.lang.Class.call(this),this.panoType=Pano.PANO_TYPE_STREET,this.panoInt=Pano.PanoInteract,this.panoDomain=s.PANO_URL,this.udtVersion=r.UDT_VERSION||"20130819",this.loadSwf="../swf/pano/BaiduPanoLoader_86f20aa.swf"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/swf/pano/BaiduPanoLoader_86f20aa.swf*/,this.scapeSwf="../swf/pano/BDStreetScape_7aada2f.swf"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/swf/pano/BDStreetScape_7aada2f.swf*/,this._init(o,n)}var i=(o("common:widget/ui/PanoInteract/PanoInteract.js"),o("common:widget/ui/PanoramaSwfUtil/PanoramaSwfUtil.js")),a=o("common:widget/ui/config/config.js"),s=(a.mapConfig,a.modelConfig,a.urlConfig),r=a.mapVersion;T.lang.inherits(e,T.lang.Class,"StreetView"),T.object.extend(e.prototype,{config:{},panoHolder:"",initVars:{},panoId:"",position:null,panoPov:null,panoLevel:1,panoSize:null,visible:!1,dbClickZoom:!0,scrollZoom:!0,keybordOp:!0,autoRotate:!1,hasBindEvents:!1,loaded:!1,_init:function(o,n){this.config=n||{},this.panoHolder=baidu.g(o),this._setInitVars(),this._createFlash(),this._bindEvents(),this._showPano()},_setInitVars:function(){var o=this.config,n=o.panoType||this.panoType,t=o.heading,e=o.pitch,i=o.poiUid||"",a=o.size||this.getPanoSize(),r=s.PANO_TILE_URL instanceof Array?s.PANO_TILE_URL.join("|"):s.PANO_TILE_URL,h="",d="";"inter"==n?(h=o.innerId,d=o.panoId):h=o.panoId,this.initVars={pid:h,iid:d,poiuid:i,panoType:n,heading:t,pitch:e,width:a.width,height:a.height,panoUrl:this.scapeSwf,domain:this.panoDomain,panoTileUrl:r,udtVersion:this.udtVersion,jsInterfaceNamespace:"Pano.PanoInteract"}},_createFlash:function(){baidu.g("PanoramaFlash")||i.create({id:"PanoramaFlash",width:"100%",height:"100%",allowscriptaccess:"always",scale:"showall",wmode:"opaque",quality:"best",url:this.loadSwf,ver:"10",errorMessage:"您未安装Flash Player播放器或者版本过低",vars:this.initVars},this.panoHolder)},getPanoSize:function(){var o=baidu.g(this.panoHolder),n=o.clientWidth,t=o.clientHeight;return{width:n,height:t}},_showPano:function(){this.panoHolder.style.display="block",this.panoHolder.style.visibility="visible",this.panoSize=this.config.size||this.getPanoSize(),this.show()},show:function(){var o=this.panoSize;this.panoHolder.style.visibility="visible",this.panoHolder.style.width=o.width+"px",this.panoHolder.style.height=o.height+"px",this.panoHolder.style.zIndex=10,this.setVisible(!0),this._bindMouseWheelEvent()},hide:function(){this.panoHolder.style.visibility="hidden",this.panoHolder.style.zIndex=-1e4,this.panoInt.closePano(),this.setVisible(!1),this._removeMouseWheelEvent()},remove:function(){this.hide(),this.panoHolder.innerHTML=""},setPano:function(o,n){if(n=n||{},"string"==typeof o&&o){var t=n.size||this.getSize(),e=this.panoType=n.panoType||this.panoType,i={panoType:e,width:t.width,height:t.height,heading:n.heading,pitch:n.pitch,x:n.x,y:n.y,poiuid:n.poiUid||""};this.panoInt.setPano(o,i)}this.setRoutParamsToFlash()},switchPano:function(o){"string"==typeof o&&o&&this.panoInt.switchPano(o)},getId:function(){return this.panoId},getPosition:function(){return this.position},getPov:function(){return this.panoPov},getZoom:function(){return this.panoLevel},getSize:function(){return this.panoSize},getVisible:function(){return this.visible},setId:function(o){"string"==typeof o&&o&&(this.panoId=o,this.setPano(o))},setPosition:function(o){"object"==typeof o&&(this.position=o)},setPov:function(o){o&&"object"==typeof o&&(this.panoPov=o,this.panoInt.setPov(o))},setZoom:function(o){!isNaN(o)&&o>=0&&(this.panoLevel=o,this.panoInt.setZoom(o))},setSize:function(o){"object"==typeof o&&(this.panoSize=o,this.panoHolder.style.width=o.width+"px",this.panoHolder.style.height=o.height+"px",this.panoInt.setSize(o))},setVisible:function(o){this.visible=o,this._onVisibleChange(o)},enableDoubleClickZoom:function(){this.dbClickZoom=!0},disableDoubleClickZoom:function(){this.dbClickZoom=!1},enableScrollWheelZoom:function(){this.scrollZoom=!0},disableScrollWheelZoom:function(){this.scrollZoom=!1},disableKeybord:function(){this.keybordOp=!0},enableKeybord:function(){this.keybordOp=!1},disableAutoRotate:function(){this.autoRotate=!0},enableAutoRotate:function(){this.autoRotate=!1},zoomIn:function(){this.panoLevel<3?this.panoLevel++:this.panoLevel,this.panoInt.zoom(1),this.dispatchEvent("onzoom",{ztype:zoomin})},zoomOut:function(){this.panoLevel>1?this.panoLevel--:this.panoLevel,this.panoInt.zoom(-1),this.dispatchEvent("onzoom",{ztype:zoomout})},addFlashMarkers:function(o){this.panoInt.addFlashMarkers(o)},clearMarkers:function(){this.panoInt.clearMarkers()},_bindEvents:function(){var o=this.panoInt,n=this,t=this.guid;o.addEventListener("onload",function(o){n._onLoad(o)},t+"_PanoLoaded"),o.addEventListener("onUnLoad",function(o){n._onUnLoad(o)},t+"_PanoUnLoaded"),o.addEventListener("onPanoChanged",function(o){n._onPanoChange(o)},t+"_PanoChanged"),o.addEventListener("onPovChanged",function(o){n._onPovChange(o)},t+"_PanoPovChanged"),o.addEventListener("onZoom",function(o){n._onZoom(o)},t+"_PanoZoomed"),o.addEventListener("onError",function(o){n._onError(o)},t+"_PanoFlashError"),o.addEventListener("onPOIClick",function(o){n._onPOIClick(o)},t+"_PanoPOIClick"),o.addEventListener("onFloorChanged",function(o){n._onFloorChange(o)},t+"_PanoFloorChange"),o.addEventListener("onEnterIndoor",function(o){n._onEnterIndoor(o)},t+"_PanoEnterIndoor"),o.addEventListener("onExitIndoor",function(o){n._onExitIndoor(o)},t+"_PanoExitIndoor"),o.addEventListener("onIndoorPanoChanged",function(o){n._onIndoorPanoChange(o)},t+"_IndoorPanoChange")},_removeEvents:function(){var o=this.panoInt;o.removeEventListener("onload",guid+"_PanoLoaded"),o.removeEventListener("onUnLoad",guid+"_PanoUnLoaded"),o.removeEventListener("onPanoChanged",guid+"_PanoChanged"),o.removeEventListener("onPovChanged",guid+"_PanoPovChanged"),o.removeEventListener("onZoom",guid+"_PanoZoomed"),o.removeEventListener("onError",guid+"_PanoFlashError"),o.removeEventListener("onPOIClick",guid+"_PanoPOIClick"),o.removeEventListener("onFloorChanged",guid+"_PanoFloorChange"),o.removeEventListener("onEnterIndoor",guid+"_PanoEnterIndoor"),o.removeEventListener("onExitIndoor",guid+"_PanoExitIndoor"),o.removeEventListener("onIndoorPanoChanged",guid+"_IndoorPanoChange")},_bindMouseWheelEvent:function(){var o=this.panoInt,n=this.panoHolder,t=this;baidu.browser.firefox?baidu.on(n,"DOMMouseScroll",function(n){baidu.event.stopPropagation(n),t.scrollZoom&&(o.zoom(-n.detail),t._addStat())}):baidu.on(n,"onmousewheel",function(n){baidu.event.stopPropagation(n),t.scrollZoom&&(o.zoom(n.wheelDelta),t._addStat())})},_removeMouseWheelEvent:function(){baidu.browser.firefox?baidu.un(this.panoHolder,"DOMMouseScroll"):baidu.un(this.panoHolder,"onmousewheel")},_onLoad:function(){this.loaded=!0,this.dispatchEvent("onLoad",{loaded:!0}),this.setRoutParamsToFlash()},_onUnload:function(){this.loaded=!1,this.dispatchEvent("onUnload",{unloaded:!0})},_onError:function(o){this.dispatchEvent("onError",{errorType:o.errorType})},_onPanoChange:function(o){this.dispatchEvent("onPanoChanged",o)},_onPovChange:function(o){this.dispatchEvent("onPovChanged",{pov:o})},_onPOIClick:function(o){this.dispatchEvent("onPOIClick",o)},_onZoom:function(o){this.dispatchEvent("onZoom",o)},_onVisibleChange:function(o){this.dispatchEvent("onVisibleChange",{visible:o})},_onFloorChange:function(o){this.dispatchEvent("onFloorChanged",o)},_onEnterIndoor:function(o){this.panoType=Pano.PANO_TYPE_INDOOR,this.dispatchEvent("onEnterIndoor",o)},_onExitIndoor:function(o){this.panoType=Pano.PANO_TYPE_STREET,this.dispatchEvent("onExitIndoor",o)},_onIndoorPanoChange:function(o){this.dispatchEvent("onIndoorPanoChanged",o)},_addStat:function(){"function"==typeof addStat&&addStat(STAT_CODE.STAT_STREETVIEW,{item:this.panoType,func:"zoom"})},_getNavParams:function(){var o="";return currentComponent&&"NavTrans"==currentComponent.name&&(o=currentComponent.getPanoNavParams()),o},setRoutParamsToFlash:function(){if(!this.isCloseRoutInFlash()){var o=this._getNavParams();o&&(this.panoInt.setRoutParams(o),addStat(STAT_CODE.STAT_STREETVIEW,{func:"enterrout"}))}},isCloseRoutInFlash:function(){for(var o=window.G_POC||[],n=0;n<o.length;n++)if(-999==o[n])return!0;return!1}}),t.exports=e});
;define("common:widget/ui/PanoramaSwfUtil/PanoramaSwfUtil.js",function(e,t,r){var a=function(){function e(){this._ie=window.ActiveXObject&&!window.opera,this._objDefAttrs=this._ie?' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"':' type="application/x-shockwave-flash"',this._objAttrKeys=["id","width","height","align","data"],this._objParamKeys=["wmode","movie","flashvars","scale","quality","play","loop","menu","salign","bgcolor","base","allowscriptaccess","allownetworking","allowfullscreen","seamlesstabbing","devicefont","swliveconnect"]}return baidu.extend(e.prototype,{create:function(e,t){var r=this._genHtml(e);t&&"string"==typeof t&&(t=document.getElementById(t)),t?t.innerHTML=r:document.write(r)},remove:function(e){var t=this.getSwf(e);if(t&&this._ie){t.style.display="none";for(var r in t)"function"==typeof t[r]&&(t[r]=null);window.CollectGarbage&&setTimeout(window.CollectGarbage,0)}t.parentNode.removeChild(t)},getFlashPlayerVersion:function(){var e=this,t=function(){var r=function(){var t=navigator;if(t.plugins&&t.mimeTypes.length){var r=t.plugins["Shockwave Flash"];if(r&&r.description)return r.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(e._ie)try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(a){var n=a.GetVariable("$version");return n.replace(/WIN/g,"").replace(/,/g,".")}}catch(i){}}();return t=function(){return r},r};return t()},getSwf:function(e){return document.getElementById(e)},_compareVersion:function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length),a=0;r>a;a++){var n=e[a],i=t[a];if(!n||!i)return n||i?n?1:-1:0;if(n=Number(n),i=Number(i),i>n)return-1;if(n>i)return 1}return 0},_genHtml:function(e){if(e=e||{},e.movie=e.url||"",e.altHtml=e.errorMessage||"",e.vars){var t=e.vars,r=[],a=null,n=null;for(a in t)n=t[a],r.push(a+"="+encodeURIComponent(n));e.flashvars=r.join("&")}e.minVer=e.ver;var i,o,s=e.minVer,l=e.maxVer;if(s||l){var c=this.getFlashPlayerVersion();if(!c||s&&this._compareVersion(c,s)<0||l&&this._compareVersion(c,l)>0)return e.altHtml||""}var h=["<object",this._objDefAttrs];for(e.data=e.movie,i=0;i<this._objAttrKeys.length;i++)o=this._objAttrKeys[i],e.hasOwnProperty(o)&&h.push(" ",o,'="',e[o],'"');for(h.push(">"),i=0;i<this._objParamKeys.length;i++)o=this._objParamKeys[i],e.hasOwnProperty(o)&&h.push('<param name="',o,'" value="',e[o],'"/>');return h.push("</object>"),h.join("")}}),new e}();r.exports=a});
;define("common:widget/ui/PanoInteract/PanoInteract.js",function(t,n,a){var o=window.Pano=window.Pano||{},e=t("common:widget/ui/PanoramaSwfUtil/PanoramaSwfUtil.js");o.PanoInteract=function(t){function n(){var t=e.getSwf("PanoramaFlash");return t||{}}var a={cityName:"",cityCode:1,isExitIndoorPano:!0,setPano:function(t,a){if(t){this.panoType=a.panoType,this.isExitIndoorPano===!1&&"street"===a.panoType&&this.exitIndoorPano(a);var o=n();o.set&&(a.id=t,o.set("panoOptions",a))}},setPov:function(t){try{var a=n();a.set&&a.set("pov",t)}catch(o){}},setSize:function(t){try{var a=n();if(a.set){var o=t.width,e=t.height;a.width=o,a.height=e,a.set("size",{width:o,height:e})}}catch(i){}},setRoutParams:function(t){try{var a=n();a.set&&a.set("routParams",t)}catch(o){}},zoom:function(t){var a=n(),o=0;a.get&&(o=a.get("zoom"),t>0?a.set("zoom",o+1):a.set("zoom",o-1))},switchPano:function(t){try{var a=n();a.set&&a.set("indoorPano",t)}catch(o){}},closePano:function(){var t=n();this.isExitIndoorPano===!1&&this.exitIndoorPano(null);try{t&&t.doAction&&t.doAction("closePano")}catch(a){}},addFlashMarkers:function(t){try{var a=n();a.doAction&&a.doAction("addMarkers",t)}catch(o){}},clearMarkers:function(){try{var t=n();t.doAction&&t.doAction("clearMarkers")}catch(a){}},getPanoramaPropertyFromFlash:function(t){try{var a=n();if(a.get)return a.get(t)}catch(o){return""}},flashLoaded:function(){this.dispatchEvent("onload",{loaded:!0})},flashUnLoaded:function(){this.dispatchEvent("onUnLoad",{unloaded:!0})},flashError:function(t){this.dispatchEvent("onError",{errorType:t})},setPanoView:function(t){this.isExitIndoorPano===!1&&"street"===t.panoType&&this.exitIndoorPano(t),"object"!=typeof t||isNaN(t.x)||isNaN(t.y)||this.dispatchEvent("onPanoChanged",{pano:t})},setPanoPov:function(t){if(t&&!isNaN(t.heading)){var n=parseInt(t.heading),a=parseInt(t.pitch);this.dispatchEvent("onPovChanged",{heading:n,pitch:a})}},clickPanoPOI:function(t){t&&"object"==typeof t&&this.dispatchEvent("onPOIClick",{data:t})},enterIndoorPano:function(t){this.isExitIndoorPano=!1,t&&"object"==typeof t&&this.dispatchEvent("onEnterIndoor",{data:t})},exitIndoorPano:function(t){this.isExitIndoorPano=!0,"object"==typeof t&&this.dispatchEvent("onExitIndoor",{data:t})},floorChange:function(t){t&&"object"==typeof t&&this.dispatchEvent("onFloorChanged",{data:t})},switchIndoorPano:function(t){t&&"object"==typeof t&&this.dispatchEvent("onIndoorPanoChanged",{data:t})},sendPanoStat:function(t){"function"!=typeof addStat||isNaN(t)||addStat(STAT_CODE.STAT_STREETVIEW,{type:t,catalog:"flash"})},sendFeedback:function(n){var a="http://"+location.host+"/pano/feedback/index.html?"+n;t.open(a,"newwindow")},getCityName:function(){return this.cityName}};return a=baidu.lang.createSingle(a)}(window),o.PanoInteract.dispatchFlashEvent=function(t,n){switch(t){case"pov_changed":o.PanoInteract.setPanoPov(n);break;case"sdata_loaded":o.PanoInteract.setPanoView(n);break;case"pano_poi_click":o.PanoInteract.clickPanoPOI(n);break;case"indoor_enter":o.PanoInteract.enterIndoorPano(n);break;case"indoor_id_changed":o.PanoInteract.switchIndoorPano(n);break;case"floor_changed":o.PanoInteract.floorChange(n);break;case"indoor_exit":o.PanoInteract.exitIndoorPano(n);break;case"interface_ready":o.PanoInteract.flashLoaded(n);break;case"pano_error":o.PanoInteract.flashError(n);break;case"street_drag":o.PanoInteract.sendPanoStat(6);break;case"indoor_drag":o.PanoInteract.sendPanoStat(7);break;case"order_click":o.PanoInteract.sendPanoStat(24);break;case"mode_change":o.PanoInteract.sendPanoStat(26);break;case"plane_click":o.PanoInteract.sendPanoStat(27)}},o.PanoInteract.doAction=function(t,n){switch(t){case"openFeedbackPage":o.PanoInteract.sendFeedback(n)}},o.PanoInteract.get=function(t){var n=null;switch(t){case"cityName":n=o.PanoInteract.getCityName()}return n},a.exports=o.PanoInteract=o.PanoInteract});
;define("common:widget/ui/StreetOverViewFrame/StreetOverViewFrame.js",function(e,t,i){function s(e,t){T.lang.Class.call(this),this.init(e,t)}var a=window.Pano=window.Pano||{};T.lang.inherits(s,T.lang.Class,"StreetOverViewFrame"),T.object.extend(s.prototype,{_addAttribute:function(e){for(var t in e)this[t]=e[t]},init:function(e,t){this._addAttribute({isOpen:!0,layoutType:0,frameWidget:{toggleBtn:null,sizeBtn:null,sv_l:null,sv_t:null,sv_r:null,sv_b:null},frameSize:{width:window.screen.width>1440?230:180,height:window.screen.width>1440?230:180,MIN_WIDTH:window.screen.width>1440?230:180,MIN_HEIGHT:window.screen.width>1440?230:180,ADSORB_LEFT:120,ADSORB_TOP:120,MAX_WIDTH:null,MAX_HEIGHT:null,MIN_LEFT_TOP:{x:null,y:null}},mapHolder:T.g(t.mapHolder),panoHolder:T.g(t.panoHolder),frameHolder:T.g(e),cursorLayer:null,mapHolderPos:{left:0,top:0},contentContainer:null,mousePos:{x:0,y:0}}),this.init_vars(),this._createOverFrame(),this._setStyle(),this.addEvents()},addEvents:function(){this.addDragEvent(),this.bindSizeEvents()},init_vars:function(){this.mapHolderPos=T.dom.getPosition(this.mapHolder)},_updateFrameSizeConstant:function(e,t,i){var s=t.clientWidth,o=t.clientHeight,r=this.getDomPosition(this.frameWidget.sizeBtn),h=a.PanoLayoutType;return e.MAX_WIDTH=s,e.MAX_HEIGHT=o,e.MIN_LEFT_TOP={x:i.left+s-e.MIN_WIDTH+this.mousePos.x-r.left,y:i.top+o-e.MIN_HEIGHT+this.mousePos.y-r.top},(this.layoutType==h.DEFAULT||this.layoutType==h.DEFINE)&&(e.MIN_LEFT_TOP.x-=10,e.MIN_LEFT_TOP.y-=10),e},WindowResize:function(){var e=this,t=e.getMapHolderStyle(),i=(e.getSize(),this.frameSize),s=a.PanoLayoutType,o=t.height-this.frameSize.ADSORB_TOP,r=t.width-this.frameSize.ADSORB_LEFT,h=i.width,n=i.height;switch(e.layoutType){case s.FULL_HORIZON:h=t.width,n=o;break;case s.FULL_VERTICAL:h=r,n=t.height;break;case s.SPLIT_HORIZON:h=t.width,n=o<i.height?o:i.height;break;case s.SPLIT_VERTICAL:h=r<i.width?r:i.width,n=t.height;break;case s.DEFINE:h=r-10<i.width?r-10:i.width,n=o-10<i.height?o-10:i.height}h=h<e.frameSize.MIN_WIDTH?e.frameSize.MIN_WIDTH:h,n=n<e.frameSize.MIN_HEIGHT?e.frameSize.MIN_HEIGHT:n,e.frameSize.width=h,e.frameSize.height=n,e._onWindowResize(),parseInt(this.frameHolder.style.width)<e.frameSize.MIN_WIDTH||e.adjustFrameSize({width:h,height:n})},addDragEvent:function(){var e,t,i,s,o,r,h,n,d,l=this;this.ThumbnailMapSizeBtnUp=function(){var e=l.getSize();l.frameSize.width=e.width,l.frameSize.height=e.height,l.frameHolder.releaseCapture?l.frameHolder.releaseCapture():window.captureEvents&&window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP),T.un(document,"mousemove",l.ThumbnailMapSizeBtnMove),T.un(document,"mouseup",l.ThumbnailMapSizeBtnUp),T.dom.remove(l.cursorLayer),l._onDragEnd()},this.ThumbnailMapSizeBtnMove=function(e){var t=e.pageX,a=e.pageY;if(a>d&&o>a)n>=t?(h=l.frameSize.height+l.mousePos.y-a,l.adjustFrameSize({width:l.frameSize.MAX_WIDTH,height:h}),l.layoutType=i.SPLIT_HORIZON,l.frameHolder.className="street_map_split",l._onAbsorb()):t>n&&s>t?(r=l.frameSize.width+l.mousePos.x-t,h=l.frameSize.height+l.mousePos.y-a,l.adjustFrameSize({width:r,height:h}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFINE,l.frameHolder.className="street_map_resize",l._onResize()):t>=s&&(h=l.frameSize.height+l.mousePos.y-a,l.adjustFrameSize({width:l.frameSize.MIN_WIDTH,height:h}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFINE,l.frameHolder.className="street_map_resize",l._onResize());else if(d>=a)if(n>=t){if(l.frameHolder.className="street_map_split",l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL)return;var u,m,p=l.getMapHolderStyle();l.layoutType==i.SPLIT_VERTICAL?(u=p.width-l.frameSize.ADSORB_LEFT,m=p.height,l._onEnterFull(u,m,i.SPLIT_VERTICAL),l.layoutType=i.FULL_VERTICAL):(u=p.width,m=p.height-l.frameSize.ADSORB_TOP,l._onEnterFull(u,m,i.SPLIT_HORIZON),l.layoutType=i.FULL_HORIZON),l.adjustFrameSize({width:u,height:m})}else t>n&&s>t?(r=l.frameSize.width+l.mousePos.x-t,l.adjustFrameSize({width:r,height:l.frameSize.MAX_HEIGHT}),l.layoutType=i.SPLIT_VERTICAL,l.frameHolder.className="street_map_split",l._onAbsorb()):t>=s&&(l.adjustFrameSize({width:l.frameSize.MIN_WIDTH,height:l.frameSize.MAX_HEIGHT}),l.layoutType=i.SPLIT_VERTICAL,l.frameHolder.className="street_map_split",l._onAbsorb());else a>=o&&(n>=t?(l.adjustFrameSize({width:l.frameSize.MAX_WIDTH,height:l.frameSize.MIN_HEIGHT}),l.layoutType=i.SPLIT_HORIZON,l.frameHolder.className="street_map_split",l._onAbsorb()):t>n&&s>t?(r=l.frameSize.width+l.mousePos.x-t,l.adjustFrameSize({width:r,height:l.frameSize.MIN_HEIGHT}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFINE,l.frameHolder.className="street_map_resize",l._onResize()):t>=s&&(l.adjustFrameSize({width:l.frameSize.MIN_WIDTH,height:l.frameSize.MIN_HEIGHT}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFAULT,l.frameHolder.className="street_map_resize",l._onMiniSize()))},this.ThumbnailMapSizeBtnDown=function(r){baidu.event.preventDefault(r),baidu.event.stopPropagation(r),l.mapHolderPos.left=T.dom.getPosition(l.mapHolder).left,l.mapHolderPos.top=T.dom.getPosition(l.mapHolder).top;var h=l.getSize();l.frameSize.width=h.width,l.frameSize.height=h.height,l.mousePos.x=r.clientX,l.mousePos.y=r.clientY,l.frameSize=l._updateFrameSizeConstant(l.frameSize,l.mapHolder,l.mapHolderPos),e=l.mapHolderPos,t=l.frameSize,i=a.PanoLayoutType,s=l.frameSize.MIN_LEFT_TOP.x,o=l.frameSize.MIN_LEFT_TOP.y,n=e.left+t.ADSORB_LEFT,d=e.top+t.ADSORB_TOP,l.cursorLayer=l.cursorLayer?l.cursorLayer:l._createDragMsk(),document.body.appendChild(l.cursorLayer),l.frameHolder.setCapture?l.frameHolder.setCapture():window.captureEvents&&window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP),T.on(document,"mousemove",l.ThumbnailMapSizeBtnMove),T.on(document,"mouseup",l.ThumbnailMapSizeBtnUp)},T.on(this.frameWidget.sizeBtn,"mousedown",this.ThumbnailMapSizeBtnDown)},removeTMEvents:function(){T.un(this.frameWidget.sizeBtn,"mousedown",this.ThumbnailMapSizeBtnDown),this.init_vars()},getDomPosition:function(e){var t=0,i=0;for(e=baidu.g(e);e!=document;e=e.parentNode)t+=e.offsetLeft,i+=e.offsetTop;return{left:t,top:i}},_createDragMsk:function(){if(this.cursorLayer)return this.cursorLayer;var e=T.dom.create("div");return baidu.setStyles(e,{width:"100%",height:"100%",cursor:"se-resize",overflow:"hidden",position:"absolute",top:"0px",left:"0px",background:"none",zIndex:1e8}),e},_createOverFrame:function(){this.frameHolder.className="street_map_resize";var e=T.dom.create("div");baidu.setStyles(e,{width:"100%",height:"100%",background:"none"}),this.contentContainer=T.dom.create("div"),baidu.setStyles(this.contentContainer,{width:"100%",height:"100%",background:"none"}),this.frameWidget.sv_l=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_l,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"0px 1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",left:"0px",top:"4px",width:"3px",zIndex:"39"}),this.frameWidget.sv_t=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_t,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",left:"0px",top:"0px",height:"3px",zIndex:"38"}),this.frameWidget.sv_r=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_r,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"0px 1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",right:"0px",top:"4px",width:"3px",zIndex:"39"}),this.frameWidget.sv_b=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_b,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",right:"0px",bottom:"0px",height:"3px",zIndex:"38"}),this.frameWidget.toggleBtn=T.dom.create("div",{"class":"street_om_btn",title:"隐藏地图"}),this.frameWidget.leftTopBlock=T.dom.create("div",{"class":"street_sz_btn"}),this.frameWidget.sizeBtn=T.dom.create("div",{"class":"street_size_btn",title:"拖拽调整大小"}),e.appendChild(this.contentContainer),e.appendChild(this.frameWidget.sv_l),e.appendChild(this.frameWidget.sv_t),e.appendChild(this.frameWidget.sv_r),e.appendChild(this.frameWidget.sv_b),e.appendChild(this.frameWidget.leftTopBlock),e.appendChild(this.frameWidget.sizeBtn),e.appendChild(this.frameWidget.toggleBtn),this.frameHolder.appendChild(e),this.adjustFrameSize({width:this.frameSize.width,height:this.frameSize.height})},_setStyle:function(){{var e=this,t=this.frameWidget.toggleBtn,i=this.frameWidget.sizeBtn;this.getMapHolderStyle()}T.on(t,"click",function(t){T.rc(this,"om_hover"),T.rc(this,"om_c_hover"),e.setOverStatus(this,t)}),T.on(t,"mouseover",function(){e.isOpen?T.ac(this,"om_hover"):T.ac(this,"om_c_hover")}),T.on(t,"mouseout",function(){e.isOpen?T.rc(this,"om_hover"):T.rc(this,"om_c_hover")}),T.on(i,"mouseover",function(){T.ac(this,"sz_hover")}),T.on(i,"mouseout",function(){T.rc(this,"sz_hover")})},setOverStatus:function(e){{var t;this.getMapHolderStyle(),a.PanoLayoutType}this.isOpen?(this.isOpen=!1,this.frameSize.width=parseInt(this.frameHolder.style.width),this.frameSize.height=parseInt(this.frameHolder.style.height),this.adjustFrameSize({width:19,height:18}),this._onVisibleChange(),T.ac(e,"om_close"),T.rc(e,"om_hover"),this.frameWidget.toggleBtn.title="展开地图"):(this.isOpen=!0,t=this.getShowRealFrameSize(),this.adjustFrameSize(t),T.rc(e,"om_close"),T.rc(e,"om_c_hover"),this.frameWidget.toggleBtn.title="隐藏地图",this._onVisibleChange())},show:function(){this.addEvents();var e=this.getShowRealFrameSize();this.adjustFrameSize(e),this.frameHolder.style.display="block",this.frameWidget.toggleBtn.className="street_om_btn",this.isOpen=!0,this._onVisibleChange()},getShowRealFrameSize:function(){this.init_vars();var e=this.frameSize.width,t=this.frameSize.height,i=this.getMapHolderStyle(),s=a.PanoLayoutType;switch(this.layoutType){case s.SPLIT_HORIZON:e=i.width;break;case s.SPLIT_VERTICAL:t=i.height;break;case s.FULL_HORIZON:e=i.width,t=i.height-this.frameSize.ADSORB_TOP;break;case s.FULL_VERTICAL:e=i.width-this.frameSize.ADSORB_LEFT,t=i.height}return{width:e,height:t}},hide:function(){this.isOpen=!1,this.removeTMEvents(),this.removeSizeEvents(),this.frameHolder.style.display="none",T.rc(this.frameWidget.toggleBtn,"om_hover"),T.rc(this.frameWidget.toggleBtn,"om_c_hover"),this._onVisibleChange()},setVisible:function(e){this.isOpen=e,this._onVisibleChange(),this.frameHolder.style.display=e?"block":"none"},adjustFrameSize:function(e){if(null!=e.width){var t=e.width;this.frameHolder.style.width=t+"px",this.frameWidget.sv_t.style.width=(t-2>=0?t-2:0)+"px",this.frameWidget.sv_b.style.width=(t-2>=0?t-2:0)+"px"}if(null!=e.height){var i=e.height;this.frameHolder.style.height=i+"px",this.frameWidget.sv_l.style.height=(i-8>=0?i-8:0)+"px",this.frameWidget.sv_r.style.height=(i-8>=0?i-8:0)+"px",this.frameWidget.sizeBtn.style.height=this.layoutType==a.PanoLayoutType.SPLIT_VERTICAL||this.layoutType==a.PanoLayoutType.FULL_VERTICAL?"52px":"20px"}},getSize:function(){return{width:parseInt(this.frameHolder.style.width),height:parseInt(this.frameHolder.style.height)}},getMapHolderStyle:function(){return{width:this.mapHolder.clientWidth,height:this.mapHolder.clientHeight,marLeft:parseInt(""==this.mapHolder.style.marginLeft?350:this.mapHolder.style.marginLeft)}},setHolderSizeLarger:function(e){if(this.isOpen){var t=a.PanoLayoutType,i=e.width,s=e.height;switch(this.layoutType){case t.SPLIT_HORIZON:s=null;break;case t.SPLIT_VERTICAL:i=null;break;case t.FULL_HORIZON:s=e.height-this.frameSize.ADSORB_TOP;break;case t.FULL_VERTICAL:i=e.width-this.frameSize.ADSORB_LEFT;break;default:i=null,s=null}this.adjustFrameSize({width:i,height:s}),this.frameSize.width=i,this.frameSize.height=s}this._onHolderResize()},setHolderSizeSmaller:function(e){if(this.isOpen){var t=a.PanoLayoutType,i=e.width,s=e.height,o=this.getSize(),r=o.width,h=o.height,n=this.frameSize.ADSORB_TOP,d=this.frameSize.ADSORB_LEFT;switch(this.layoutType){case t.SPLIT_HORIZON:s=h>s-n?s-n:h;break;case t.SPLIT_VERTICAL:i=r>i-d?i-d:r;break;case t.DEFINE:case t.DEFAULT:i=r>i-10-d?i-10-d:r,s=h>s-10-n?s-10-n:h;break;case t.FULL_HORIZON:s-=n;break;case t.FULL_VERTICAL:i-=d}this.adjustFrameSize({width:i,height:s}),this.frameSize.width=i,this.frameSize.height=s}this._onHolderResize()},bindSizeEvents:function(){var t=e("common:widget/ui/fullScreen/fullScreen.js"),i=e("common:widget/ui/mapInfo/mapInfo.js"),s=this,a=this.guid;s.setSizeLargerFunc=function(e){var t=e.size;s.setHolderSizeLarger(t)},s.setSizeSmallerFunc=function(e){var t=e.size;s.setHolderSizeSmaller(t)},t.addEventListener("onFullScreen",s.setSizeLargerFunc,a+"_onFullScreen"),t.addEventListener("onExitFull",s.setSizeSmallerFunc,a+"_onExitFull"),i.addEventListener("onShowSide",s.setSizeSmallerFunc,a+"_onShowSide"),i.addEventListener("onHideSide",s.setSizeLargerFunc,a+"_onHideSide")},removeSizeEvents:function(){var t=e("common:widget/ui/fullScreen/fullScreen.js"),i=e("common:widget/ui/mapInfo/mapInfo.js"),s=this.guid;t.removeEventListener("onFullScreen",s+"_onFullScreen"),t.removeEventListener("onExitFull",s+"_onExitFull"),i.removeEventListener("onShowSide",s+"_onShowSide"),i.removeEventListener("onHideSide",s+"_onHideSide")},_onEnterFull:function(e,t){this.dispatchEvent("onEnterFull",{size:{width:e,height:t},layout:this.layoutType})},_onRetDefault:function(){var e=this.getSize();this.dispatchEvent("onRetDefault",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onResize:function(){var e=this.getSize(),t=this.isOpen?e.width:0,i=this.isOpen?e.height:0;this.dispatchEvent("onResize",{size:{width:t,height:i},layout:this.layoutType})},_onWindowResize:function(){var e=this.getSize(),t=this.isOpen?e.width:0,i=this.isOpen?e.height:0;this.dispatchEvent("onWindowResize",{size:{width:t,height:i},layout:this.layoutType})},_onHolderResize:function(){var e=this.getSize(),t=this.isOpen?e.width:0,i=this.isOpen?e.height:0;this.dispatchEvent("onHolderResize",{size:{width:t,height:i},layout:this.layoutType})},_onAbsorb:function(){var e=this.getSize();this.dispatchEvent("onAbsorb",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onDragEnd:function(){var e=this.getSize();this.dispatchEvent("onDragEnd",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onMiniSize:function(){var e=this.getSize();this.dispatchEvent("onMiniSize",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onVisibleChange:function(){var e=this.getSize();this.dispatchEvent("onVisibleChange",{visible:this.isOpen,size:{width:e.width,height:e.height},layout:this.layoutType})}}),i.exports=s});
;define("common:widget/ui/StreetOverView/StreetOverView.js",function(e,t,n){function i(e){e=e||{},baidu.lang.Class.call(this),this.dom=baidu.g(e.dom),this.cinfo=e,this.arrows=[],this.arrowMarkers=[],this.render(),this.initialize()}var o=window.Pano=window.Pano||{},a=e("common:widget/com/componentManager.js"),r=e("common:widget/ui/fullScreen/fullScreen.js"),s=(e("common:widget/ui/mapInfo/mapInfo.js"),e("common:widget/ui/PanoService/PanoService.js")),d=e("common:widget/ui/PanoOverlay/PanoOverlay.js"),v=e("common:widget/ui/PanoUtil/PanoUtil.js"),p=e("common:widget/ui/config/config.js"),l=p.modelConfig,c=(p.mapConfig,e("common:widget/ui/mapUtil/mapUtil.js"));baidu.lang.inherits(i,baidu.lang.Class,"StreetOverView"),baidu.object.extend(i.prototype,{point:null,level:0,panoType:o.PANO_TYPE_STREET,overFrame:null,mapContainer:null,miniMap:null,panoView:null,panoMode:"day",render:function(){try{var e=this.cinfo;if(!e.point)return;this.point=e.point,this.level=e.level,this.overFrame=e.overFrame,this.panoView=e.panoView,this.mapContainer=e.mapContainer}catch(t){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/ui/StreetOverView/StreetOverView.js",ln:58})}},initialize:function(){try{this.initMiniMap(this.point,this.level),this.initPanoOverlay(),this.bindPanoEvents(),this.bindFrameEvents(),this.addOverlays()}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/ui/StreetOverView/StreetOverView.js",ln:68})}},initMiniMap:function(e,t){var n=BMAP_NORMAL_MAP,i=this.miniMap=new BMap.Map(this.mapContainer,{coordType:BMAP_COORD_MERCATOR,zoomLevelMin:3,mapType:n});i.enableScrollWheelZoom(),i.enableInertialDragging(),i.enableContinuousZoom(),i.centerAndZoom(e,t),i.setDefaultCursor("pointer"),this.addPanoLayer(i),this.stdMapCtrl=new BMap.NavigationControl({offset:new BMap.Size(10,8),type:BMAP_NAVIGATION_CONTROL_ZOOM,anchor:BMAP_ANCHOR_TOP_RIGHT}),i.addControl(this.stdMapCtrl),this.setPanoPoiClick(i)},addPanoLayer:function(t){var n=this;this.roadLayer?this.roadLayer.show():e.async("common:widget/ui/StreetViewLayer/StreetViewLayer.js",function(e){n.roadLayer=new e({map:t}),n.roadLayer.show()})},setPanoPoiClick:function(t){var n=this;n.panoPoiClick?n.panoPoiClick.refresh(t):e.async("common:widget/ui/PanoPoiClick/PanoPoiClick.js",function(e){n.panoPoiClick=new e(t,"panoPoiClick")})},initPanoOverlay:function(){this.prePos=this.point,this.stOverlay=new d(this.point),this.miniMap.addOverlay(this.stOverlay),this.miniMap.setCenter(this.point),this.getCurCity(),this.bindMkrEvents()},bindFrameEvents:function(){var e=this,t=this.miniMap,n=this.stOverlay,i=this.overFrame,o=this.guid;e.setMapCenter=function(){e._setCenter()},e.setMapCenterDelay=function(){window.setTimeout(function(){e._setCenter()},100)},e.setVisPos=function(e){n.setOffset(),e.visible&&window.setTimeout(function(){t.setCenter(n.getPosition())},100)},e.mapClickFunc=function(t){e.getPanoInfo(t.point)},i.addEventListener("onMiniSize",e.setMapCenter),i.addEventListener("onResize",e.setMapCenter),i.addEventListener("onAbsorb",e.setMapCenter),i.addEventListener("onDragEnd",e.setMapCenter),i.addEventListener("onWindowResize",e.setMapCenter),i.addEventListener("onHolderResize",e.setMapCenterDelay),i.addEventListener("onVisibleChange",e.setVisPos),t.addEventListener("click",e.mapClickFunc),t.addEventListener("maptypechange",function(t){t.mapType;e.roadLayer&&e.roadLayer.update()},o+"_maptypechange"),t.addEventListener("zoomstart",function(){e._centerPt=t.getCenter()},o+"_zoomstart"),t.addEventListener("zoomend",function(){t.setCenter(e._centerPt),v.level=e.level=t.getZoom()},o+"_zoomend"),this.hasFrameEvents=!0},removeFrameEvents:function(){if(this.hasFrameEvents){var e=this,t=this.miniMap,n=this.overFrame,i=this.guid;n.removeEventListener("onMiniSize",e.setMapCenter),n.removeEventListener("onResize",e.setMapCenter),n.removeEventListener("onAbsorb",e.setMapCenter),n.removeEventListener("onDragEnd",e.setMapCenter),n.removeEventListener("onHolderResize",e.setMapCenterDelay),n.removeEventListener("onVisibleChange",e.setVisPos),n.removeEventListener("onWindowResize",e.setMapCenter),t.removeEventListener("click",e.mapClickFunc),t.removeEventListener("maptypechange",i+"_maptypechange"),t.removeEventListener("zoomstart",i+"_zoomstart"),t.removeEventListener("zoomend",i+"_zoomend"),t.removeEventListener("moveend",i+"_moveend"),e.setMapCenter=null,e.setVisPos=null,e.mapClickFunc=null,e.mapZoom=null,this.hasFrameEvents=!1}},bindPanoEvents:function(){{var t=this.panoView,n=r,i=e("common:widget/ui/mapInfo/mapInfo.js"),o=this,a=this.miniMap,s=this.overFrame;this.guid}o.panoChangedFunc=function(e){var t=e.pano,n=new BMap.Point(t.x,t.y),i=t.heading||0;o.prePos=n,o.setMkrPos(n),o.stOverlay.setDirection(i),o.panoMode=t.mode||o.panoMode},o.povChangedFunc=function(e){var t=e.pov;o.stOverlay.setDirection(t.heading)},o.setPosition=function(){if(0!=s.layoutType&&o.stOverlay){o.stOverlay.setOffset();var e=o.stOverlay.getPosition();a.setCenter(e)}},t.addEventListener("onPanoChanged",o.panoChangedFunc),t.addEventListener("onPovChanged",o.povChangedFunc),n.addEventListener("onFullScreen",o.setPosition),n.addEventListener("onExitFull",o.setPosition),i.addEventListener("onShowSide",o.setPosition),i.addEventListener("onHideSide",o.setPosition)},removePanoEvents:function(){var t=this.panoView,n=r,i=e("common:widget/ui/mapInfo/mapInfo.js"),o=this;t.removeEventListener("onPanoChanged",o.panoChangedFunc),t.removeEventListener("onPovChanged",o.povChangedFunc),n.removeEventListener("onFullScreen",o.setPosition),n.removeEventListener("onExitFull",o.setPosition),i.removeEventListener("onShowSide",o.setPosition),i.removeEventListener("onHideSide",o.setPosition),o.panoChangedFunc=null,o.povChangedFunc=null,o.setPosition=null},bindMkrEvents:function(){var e=this.stOverlay,t=this;t.rotatFunc=function(e){t.setViewPov(e.angle)},t.dragendFunc=function(e){t.getPanoInfo(e.point)},e.addEventListener("oncircleclick",t.rotatFunc),e.addEventListener("onrotating",t.rotatFunc),e.addEventListener("onrotateend",t.rotatFunc),e.addEventListener("ondragend",t.dragendFunc)},removeMkrEvents:function(){var e=this.stOverlay,t=this;e&&(e.removeEventListener("oncircleclick",t.rotatFunc),e.removeEventListener("onrotating",t.rotatFunc),e.removeEventListener("onrotateend",t.rotatFunc),e.removeEventListener("ondragend",t.dragendFunc),t.rotatFunc=null,t.dragendFunc=null)},removeEvents:function(){this.removeFrameEvents(),this.removePanoEvents(),this.removeMkrEvents(),this.stOverlay&&this.stOverlay.hide(),this.miniMap=null,this.stOverlay=null,this.tipLabel=null},showTip:function(e){if(this.tipLabel)this.tipLabel.setPoint(e),this.tipLabel.show(),this.delayHide();else{var t={point:e,offset:new BMap.Size(0,0)};this.tipLabel=new BMap.Label("<div style='text-align:center;margin-top:5px;'>此处无全景</div ><div style='color:#4869a5;' >请点击蓝色路网</div>",t),this.tipLabel.setStyle({backgroundColor:"#fff",borderColor:"#b1b1b1",borderWidth:"1px",fontSize:"12px",height:"50px",lineHeight:"20px",fontFamily:"微软雅黑"}),this.miniMap.addOverlay(this.tipLabel),this.delayHide()}},delayHide:function(){var e=this;this.tipTimer&&window.clearTimeout(this.tipTimer),this.tipTimer=window.setTimeout(function(){e.tipLabel&&e.tipLabel.hide()},2e3)},resetPos:function(){this.prePos&&this.stOverlay&&(this.stOverlay.setPosition(this.prePos),this.miniMap.panTo(this.prePos))},getPanoInfo:function(e){this.tipLabel&&this.tipLabel.hide();var t=this,n=e;s.getStreetBriefByLocation({point:n,level:t.miniMap.getZoom(),mode:t.panoMode},function(e){if(0==e.error&&e.content&&e.content.id){var i=e.content.id,o=e.content.point;t.prePos=o,t.setMkrPos(o),t.panoView&&t.panoView.setPano(i,{panoType:t.panoType}),t.getCurCity()}else t.showTip(n),t.resetPos()},this)},setViewPov:function(e){if(this.tipLabel&&this.tipLabel.hide(),!isNaN(e)){var t={heading:parseInt(e),pitch:0};this.panoView.setPov(t)}},setMkrPos:function(e){this.stOverlay.setPosition(e),this.miniMap.setCenter(e)},getCurCity:function(){var e=this,t=this.miniMap,n=t.getBounds(),i=n.minX+","+n.minY+";"+n.maxX+","+n.maxY,o=t.getZoom(),a=(new Date).getTime();baidu.ajax("/?newmap=1&qt=ncent&ie=utf-8&b="+i+"&l="+o+"&t="+a,{dataType:"json",success:function(t){t&&t.content&&t.current_city&&e.setCurCity(t.current_city)},error:function(){}})},setCurCity:function(e){var t=o.PanoInteract.cityName=e.name,n=o.PanoInteract.cityCode=e.code;n!=l.cityCode&&a.go("cur&wd="+encodeURIComponent(t),{cinfo:{isFromPano:!0},onload:function(){}})},_setCenter:function(){if(this.stOverlay){var e=this.stOverlay.getPosition();this.stOverlay.setOffset(),this.miniMap.setCenter(e)}},update:function(e,t){t=t||this.level,e&&t&&this.miniMap.centerAndZoom(e,t)},redrawArrow:function(){for(var e=0;e<this.arrowMarkers.length;e++)this.miniMap.removeOverlay(this.arrowMarkers[e]);this.arrowMarkers=[];for(var e=0;e<this.arrows.length;e++)this.arrowMarkers=this.arrowMarkers.concat(c.addArrow(this.arrows[e].split(";"),this.miniMap))},addOverlays:function(){var e=this,t=window.currentComponent;if(t&&t.getOverlays){this.viewportPoints=[];var n,i=t.getOverlays(),o=i.routes;if(o)for(var a=0;a<o.length;a++)n=c.addRoute(o[a].points,o[a].type,void 0,this.miniMap),this.viewportPoints=this.viewportPoints.concat(n.points);var r=i.drRoutes;if(r)for(var a=0;a<r.length;a++){n=c.addDrRoute(r[a].flag,r[a].obj,!1,this.miniMap);for(var a=0;a<n.length;a++)this.viewportPoints=this.viewportPoints.concat(n[a].points)}var s=i.transMarkers;if(s)for(var a=0;a<s.length;a++)c.addTransPoi(s[a].point,s[a].type,s[a].text,this.miniMap);var d=i.destMarkers;if(d)for(var a=0;a<d.length;a++)c.addDestPoi(d[a].point,d[a].text,d[a].type,void 0,this.miniMap);var v=i.arrows;v&&(this.arrows=v,this.redrawArrow(),this.miniMap.addEventListener("zoomend",function(){e.redrawArrow()},this.guid+"_zoomend"),this.miniMap.addEventListener("moveend",function(){e.redrawArrow()},this.guid+"_moveend"));var p=i.tips;if(p)for(var a=0;a<p.length;a++)c.createTip(p[a].content,p[a].className,p[a].opts,this.miniMap);var l=i.markers;if(l)for(var a=0;a<l.length;a++)this.miniMap.addOverlay(new BMap.Marker(l[a].point,{icon:l[a].icon,title:l[a].title}))}}}),n.exports=i});
;define("common:widget/ui/PanoOverlay/PanoOverlay.js",function(e,t,i){function o(e,t){e&&e instanceof BMap.Point&&(this._map=null,this._mapc=null,this._container=null,this._position=e,this._size=null,this._viewsetting=0,this._moving=!1,this._nowviewtype=0,this._viewtypetimer=null,this._dragMovePixel=null,this._arrowDirection="-168px -72px",this._direction=null,t=t||{},this._opts=baidu.extend(baidu.extend(this._opts||{},{enableDragging:!0,anchor:new BMap.Size(-40,-18)}),t),this.MAP_PAN_DIRECTION=[[0,0],[-1,-1],[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1]],this.DIV_ROTATE_DIRECTION=[[0,-1200],[22.5,-1120],[45,-1040],[67.5,-960],[90,-880],[112.5,-800],[135,-720],[157.5,-640],[180,-560],[202.5,-480],[225,-400],[247.5,-320],[270,-240],[292.5,-160],[315,-80],[337.5,-0]],this.ARROW_ROTATE_DIRECTION=[[0,-360],[22.5,-336],[45,-312],[67.5,-288],[90,-264],[112.5,-240],[135,-216],[157.5,-192],[180,-168],[202.5,-144],[225,-120],[247.5,-96],[270,-72],[292.5,-48],[315,-24],[337.5,-0]])}function n(e,t,i){0!=t.indexOf("on")&&(t="on"+t);var o=new baidu.lang.Event(t);if(i)for(var n in i)o[n]=i[n];e.dispatchEvent(o)}function a(e){var e=window.event||e;baidu.event.preventDefault(e),baidu.event.stopPropagation(e)}var r=e("common:widget/ui/util/util.js");o.prototype=new BMap.Overlay,o.prototype.initialize=function(e){try{var t=this,i=t._container=document.createElement("div"),o=document.createElement("div"),n="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/panorama/pano_markers_1f7469f.png)!important";t._map=e,t._div=i,t._arrow=o,t._mapc=e.getContainer(),t._bgu=n;var a=baidu.dom.getPosition(this._mapc);return this._mapcTop=a.top,this._mapcLeft=a.left,t._rotating=!1,t._setDefCursor(),baidu.extend(i.style,{position:"absolute",zIndex:BMap.Overlay.getZIndex(t._position.lat),backgroundRepeat:"no-repeat",backgroundPosition:"-560px 0",cursor:"pointer",height:"36px",width:"80px"}),baidu(i).addClass("pano-overlay-ie"),baidu.extend(o.style,{position:"absolute",cursor:t.defaultCursor,backgroundRepeat:"no-repeat",backgroundPosition:"-168px -72px",left:"27px",height:"42px",width:"24px",marginTop:"-18px"}),baidu(o).addClass("pano-overlay-ie"),i.appendChild(o),t._map.getPanes().labelPane.appendChild(i),t._setEventDispath(),i}catch(r){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:r.message||r.description,path:"common:widget/ui/PanoOverlay/PanoOverlay.js",ln:174})}},o.prototype.draw=function(){var e=this._opts.anchor,t=this._map.pointToOverlayPixel(this._position);this._container.style.left=t.x+e.width+"px",this._container.style.top=t.y+e.height+"px"},o.prototype.enableDragging=function(){this._opts.enableDragging=!0},o.prototype.disableDragging=function(){this._opts.enableDragging=!1},o.prototype.getPosition=function(){return this._position},o.prototype.setPosition=function(e){!e instanceof BMap.Point||(this._position=e,this.draw())},o.prototype.getDirection=function(){return this._direction},o.prototype.setDirection=function(e){if(!isNaN(e)){var t=this._direction=e;this._getRotateDirection(t)}},o.prototype.setOffset=function(){var e=baidu.dom.getPosition(this._mapc);this._mapcTop=e.top,this._mapcLeft=e.left},o.prototype.remove=function(){n(this,"onremove"),this._container&&r.purgeEvents(this._container),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container)},o.prototype._setDefCursor=function(){T.browser.firefox?(this.defaultCursor="-moz-grab",this.draggingCursor="-moz-grabbing"):T.browser.chrome||T.browser.safari?(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur) 8 8, default",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur) 8 8, default"):(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur)",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur)")},o.prototype._getRotateDirection=function(e){if(!isNaN(e)){{var t=this.DIV_ROTATE_DIRECTION,i=this.ARROW_ROTATE_DIRECTION,o=0,n=e-31.75;i.length}if(n>t[15][0])this._div.style.backgroundPosition=t[15][1]+"px 0",this._arrow.style.backgroundPosition=this._arrowDirection=i[15][1]+"px -72px";else for(var o=0;16>o;o++)if(n<t[o][0]){this._div.style.backgroundPosition=t[o][1]+"px 0",this._arrow.style.backgroundPosition=this._arrowDirection=i[o][1]+"px -72px";break}}},o.prototype._getMoveDirection=function(e,t){if(!isNaN(e)&&!isNaN(t)){var i=-1,o=e-this.preX;return this.preX>5&&0>o?i=0:this.preX>5&&o>0&&(i=1),this.preX=e,this.preY=t,i}},o.prototype._setEventDispath=function(){function e(e){var e=window.event||e,i=e.pageX||e.clientX||0,o=e.pageY||e.clientY||0,n=new BMap.Pixel(i,o),a=t._map.pixelToPoint(n);return{pixel:n,point:a}}var t=this,i=t._container,o=t._arrow,r=t._mapc,p=!1,s=!1,l=null;o.onclick=function(e){n(t,"onarrclick"),a(e)},i.onclick=function(i){var o=e(i),r=o.pixel.x-t._mapcLeft,p=o.pixel.y-t._mapcTop,s=t._map.pointToPixel(t._position).x,l=t._map.pointToPixel(t._position).y,u=180-Math.atan2(r-s,p-l)/3.1415926/2*360;t._getRotateDirection(u),n(t,"oncircleclick",{point:o.point,pixel:o.pixel,angle:u}),a(i)},i.onmousedown=function(o){var s=e(o),u=s.pixel.x-t._mapcLeft,c=s.pixel.y-t._mapcTop,m=t._map.pointToPixel(t._position).x,g=t._map.pointToPixel(t._position).y,h=180-Math.atan2(u-m,c-g)/3.1415926/2*360;l=s.pixel,p=!0,t._rotating||(t._rotating=!0,i.setCapture?(baidu.on(i,"onmousemove",_),baidu.on(i,"onmouseup",d)):(baidu.on(window,"onmousemove",_),baidu.on(window,"onmouseup",d))),n(t,"onrotatestart",{point:s.point,pixel:s.pixel,angle:h}),i.setCapture&&i.setCapture(),r.style.MozUserSelect="none",r.style.KhtmlUserSelect="none",r.style.WebkitUserSelect="none",r.unselectable="on",r.onselectstart=function(){return!1},a(o)},o.onmousedown=function(p){var _=e(p);return o.setCapture?(baidu.on(o,"onmousemove",c),baidu.on(o,"onmouseup",u)):(baidu.on(window,"onmousemove",c),baidu.on(window,"onmouseup",u)),t._opts.enableDragging?(l=_.pixel,n(t,"ondragstart",{point:t._position}),s=!0,o.style.cursor=t.draggingCursor,baidu(i).removeClass("pano-overlay-ie"),o.setCapture&&o.setCapture(),r.style.MozUserSelect="none",r.style.KhtmlUserSelect="none",r.style.WebkitUserSelect="none",r.unselectable="on",r.onselectstart=function(){return!1},void a(p)):void a(p)};var u=function(_){e(_);return n(t,"onmouseup",{point:t._position}),o.releaseCapture?(baidu.un(o,"onmousemove",c),baidu.un(o,"onmouseup",u)):(baidu.un(window,"onmousemove",c),baidu.un(window,"onmouseup",u)),t._opts.enableDragging?(o.releaseCapture&&o.releaseCapture(),o.style.backgroundPosition=t._arrowDirection,baidu(i).addClass("pano-overlay-ie"),o.style.cursor=t.defaultCursor,clearInterval(t._viewtypetimer),n(t,"ondragend",{point:t._position}),s=!1,p=!1,l=null,r.style.MozUserSelect="",r.style.KhtmlUserSelect="",r.style.WebkitUserSelect="",r.unselectable="off",r.onselectstart=function(){},void a(_)):void a(_)},c=function(i){if(t._opts.enableDragging&&s){var r=e(i),p=t._map.pointToPixel(t._position),u=r.pixel.x-l.x+p.x,c=r.pixel.y-l.y+p.y;switch(l=r.pixel,t._getMoveDirection(u,c)){case-1:o.style.backgroundPosition="-168px -72px";break;case 0:o.style.backgroundPosition="-408px -72px";break;case 1:o.style.backgroundPosition="-432px -72px";break;default:o.style.backgroundPosition="-168px -72px"}m(i),n(t,"ondragging",{point:t._position}),a(i)}},_=function(i){if(p){var o=e(i),r=o.pixel.x-t._mapcLeft,s=o.pixel.y-t._mapcTop,l=t._map.pointToPixel(t._position).x,u=t._map.pointToPixel(t._position).y,c=t._direction=180-Math.atan2(r-l,s-u)/3.1415926/2*360;t._getRotateDirection(c),n(t,"onrotating",{point:o.point,pixel:o.pixel,angle:c}),a(i)}},d=function(o){if(t._rotating){t._rotating=!1,i.releaseCapture?(baidu.un(i,"onmousemove",_),baidu.un(i,"onmouseup",d)):(baidu.un(window,"onmousemove",_),baidu.un(window,"onmouseup",d)),i.releaseCapture&&i.releaseCapture();var p=e(o);n(t,"onrotateend",{point:p.point,pixel:p.pixel,angle:t._direction}),r.style.MozUserSelect="",r.style.KhtmlUserSelect="",r.style.WebkitUserSelect="",r.unselectable="off",r.onselectstart=function(){},a(o)}},m=function(i){if(t._opts.enableDragging&&s){var o=e(i),n=(t._map.pointToPixel(t._position),o.pixel.x-t._mapcLeft),a=o.pixel.y-t._mapcTop;l=o.pixel,t._position=t._map.pixelToPoint(new BMap.Pixel(n,a));var p=null,u=n/r.offsetWidth,c=a/r.offsetHeight,p=g(u,c);if(t._nowviewport&&p===t._nowviewport)t.draw();else if(0==p)t._position=t._map.pixelToPoint(new BMap.Pixel(n,a)),t.draw(),t._nowviewport=0,clearInterval(t._viewtypetimer);else{clearInterval(t._viewtypetimer),t._nowviewport=p,t.draw();{var _=t._map.pointToPixel(t._map.getCenter()).x,d=t._map.pointToPixel(t._map.getCenter()).y;t._map.pixelToPoint(new BMap.Pixel(_,d))}t._viewtypetimer=setInterval(function(){t._map.panBy(-8*t.MAP_PAN_DIRECTION[p][0],-8*t.MAP_PAN_DIRECTION[p][1],null,!0),__x=t._map.pointToPixel(t._position).x+8*t.MAP_PAN_DIRECTION[p][0],__y=t._map.pointToPixel(t._position).y+8*t.MAP_PAN_DIRECTION[p][1],t._position=t._map.pixelToPoint(new BMap.Pixel(__x,__y)),t.draw()},30)}}},g=function(e,t){if(!isNaN(e)&&!isNaN(t)){var i,o=.2,n=.2;return o>e?i=n>t?1:t>1-n?3:2:e>1-o?i=n>t?7:t>1-n?5:6:n>t?i=8:t>1-n?i=4:(i=0,i=0),i}}},i.exports=o});