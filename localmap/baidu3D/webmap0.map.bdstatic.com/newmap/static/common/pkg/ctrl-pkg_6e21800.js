define("common:widget/ui/MapTest/MapTest.js",function(t,e,a){function n(){T.ajax("/newmap/static/common/images/transparent.gif?t="+Math.floor(1e6*Math.random()),{success:function(t,e){e.slow?ErrorMonitor("web","req_slow"+e.slow,"",!0,{xhr:e,type:"slow",url:"../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/}):ErrorMonitor("web","succ","",!0,{xhr:e,type:"succ",url:"../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/})},error:function(t){ErrorMonitor("web","req_fail",t.status,!0,{xhr:t,type:"fail",url:"../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/})}})}function r(){var t=new Image,e=(new Date).getTime(),a={timeStart:e};t.onerror=function(){a.timeEnd=(new Date).getTime(),ErrorMonitor("cdn","req_fail","",!0,{url:"../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif*/,type:"fail",xhr:a})},t.onload=function(){a.timeEnd=(new Date).getTime();var t=a.timeEnd-e,n=!1;t>6e3?n=6:t>3e3?n=3:t>2e3&&(n=2),n?ErrorMonitor("cdn","req_slow"+n,"",!0,{url:"../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif*/,type:"slow",xhr:a}):ErrorMonitor("cdn","succ","",!0,{url:"../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif*/,type:"succ",xhr:a})},t.src="http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent_cdn_3254726.gif?t="+Math.floor(1e6*Math.random())}a.exports={testCDN:r,testWeb:n}});
;define("common:widget/ui/loadCtrls/LoadCtrls.js",function(n,e,o){function t(){var n=window.overviewCtrl;n&&(n.addEventListener("viewchanging",function(){var n=parseInt(T.g("MapHolder").style.height);n=0>n?0:n,T.g("shad_v")&&(T.g("shad_v").style.height=n+"px")}),n.addEventListener("viewchanged",function(){var n=parseInt(T.g("MapHolder").style.height);n=0>n?0:n,T.g("shad_v")&&(T.g("shad_v").style.height=n+"px")}),n.addEventListener("hide",function(){var n=parseInt(T.g("MapHolder").style.height);n=0>n?0:n,T.g("shad_v")&&(T.g("shad_v").style.height=n+"px")}),n.addEventListener("show",function(){var n=parseInt(T.g("MapHolder").style.height);n=0>n?0:n,T.g("shad_v")&&(T.g("shad_v").style.height=n+"px")}))}function i(){try{h.pvstat();var e=Math.random();.2>e?x.testWeb():.4>e&&x.testCDN(),ErrorMonitor("load","BASE","");var o=window._OLR&&baidu.json.parse(window._OLR.index);o&&o.content&&1==o.content.code?ErrorMonitor("load","loccity_fail","",void 0,{url:"",xhr:{startTime:0,endTime:0},type:"fail"}):ErrorMonitor("load","succ","",void 0,{url:"",xhr:{startTime:0,endTime:0},type:"succ"})}catch(t){console.log("init stat fail")}map.addEventListener("movestart",function(){window.firstbounds=l.formatBounds()}),map.addEventListener("moveend",function(){window.lastbounds=l.formatBounds(),window.useraction="move",a()}),map.addEventListener("zoomstart",function(){window.firstbounds=l.formatBounds()}),map.addEventListener("zoomend",function(){window.lastbounds=l.formatBounds(),window.useraction="zoom",a()}),map.addEventListener("clickex",function(n){n.overlay&&n.overlay instanceof BMap.Circle&&this.getInfoWindow()&&this.closeInfoWindow()}),map.addEventListener("click",function(){T(".search_box input").blur()}),n.async("common:widget/ui/changeMap/ChangeMap.js",function(n){n(map)})}function a(){}function c(){var n=baidu.url.queryToJson(location.href);n&&n.hb&&n.hb==BMAP_TYPE_HYBIRD&&n.tn&&n.tn==BMAP_SATELLITE_MAP&&window.maptypeCtrl&&window.maptypeCtrl.streetMapMgr(!0),g.processUrlQuery(),g.handleUrlExt()}function r(){var n=l.getParam(location.href);if(n&&1==n.mapdebug){var e=window.location.protocol+"//"+window.location.host;e+=window.location.pathname?window.location.pathname:"/",e+="mapdebug.js"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/pkg/mapdebug.js*/,T.Ajax.request(e,{async:!1,onsuccess:function(n){var e=n.responseText;window.execScript?window.execScript(e):window.eval(e),"undefined"!=typeof mapDebug&&mapDebug.openDebug()}})}}function s(){y.init(),b.init(),T(".browser-close").click(function(){T("#browser-warning").remove()}),baidu("#imgLogo").on("click",function(n){m.go("cur&wd="+encodeURIComponent(M.cityName),{cinfo:{from:"home_btn"}}),n.preventDefault()}),baidu("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/.logo_nav .nav").delegate("a","click",function(){var n=parseInt(baidu(this).data("index"));p.switchUrl(this,n)}),T.isIE(6)||T.isIE(7)?(T(".return-new-link").hide(),T(".return-new-link").parent().next().hide()):T("#searchWrapper").on("click",".return-new-link",function(){T.cookie.set("force","newsample",{expires:6048e5}),addStat("indexheader.searchbox.returnnew","click",{da_e_name:"pcmap3"}),location.href="http://webmap0.map.bdstatic.com/"})}function d(){T.browser.isWebkit&&console.log("%c        %c\n如果你勤于关注LBS的发展，乐于关注定位技术，善于思考身边本地生活信息与技术融合的未来；\n  那么百度LBS研发部热忱欢迎你加入我们，共同探索LBS的技术、产品与商业模式的创新；一起定位百度地图与你我的未来。\n  期待您的加盟。http://map.baidu.com/zt/hr/20131122/\n  %c邮件请注明来自：console","background:url(http://map.baidu.com/zt/hr/logo-map-console.png) no-repeat;font-size:33px","background:none","color:red")}function u(){n.async("common:widget/ui/MapCenter/MapCenter.js",function(n){n.init()}),n.async("common:widget/ui/publicEvent/PublicEvent.js",function(n){window.pubEvent=new n,pubEvent.init({cityId:M.cityCode,cityType:M.cityType})}),n.async("common:widget/ui/clickcity/ClickCity.js",function(n){window.MPC_Mgr=n}),n.async("common:widget/ui/contextMenu/ContextMenu.js",function(n){window.contextMenu=n.init()}),componentManager.loadPlaceAsync()}var m=n("common:widget/com/componentManager.js"),l=(n("common:widget/ui/areaCfg/areaCfg.js"),n("common:widget/ui/util/util.js")),w=n("common:widget/ui/searchBox/searchBox.js"),p=n("common:widget/ui/indexUtil/IndexUtil.js"),g=n("common:widget/ui/urlQueryProcessor/UrlQueryProcessor.js"),f=n("common:widget/ui/config/config.js"),h=(n("common:widget/ui/constant/Constant.js"),n("common:widget/ui/stat/CodeStat.js")),v=n("common:widget/ui/setMyPlace/SetMyPlaceMgr.js"),y=n("common:widget/ui/fullScreen/fullScreen.js"),b=n("common:widget/ui/mapInfo/mapInfo.js"),M=f.modelConfig,x=n("common:widget/ui/MapTest/MapTest.js");o.exports={init:function(){v.init(),t(),i(),u(),c(),w.suggest(),s(),r(),d(),document.fmHistory&&(document.fmHistory.action="http://webmap0.map.bdstatic.com/newmap/static/common/history_d35a118.html")}}});
;define("common:widget/ui/dataCopyRight/dataCopyRight.js",function(a,t){{var p=a("common:widget/ui/areaCfg/areaCfg.js"),o=a("common:widget/ui/config/config.js"),n=o.modelConfig;o.mapConfig}t.setCopyRight=function(){if(!window.isPrint){var a,t=n.cityCode,o=map.mapType,i=[p["常州"],p["南昌"],p["乌鲁木齐"],p["无锡"],p["福州"],p["泉州"],p["珠海"],p["贵阳"]],e=([p["北京"],p["上海"],p["广州"],p["深圳"],p["宁波"],p["石家庄"],p["沈阳"],p["长春"],p["青岛"],p["温州"],p["台州"],p["金华"],p["佛山"],p["中山"],p["昆明"],p["南宁"],p["苏州"],p["西安"],p["济南"],p["郑州"],p["合肥"],p["呼和浩特"],p["杭州"],p["成都"],p["武汉"],p["长沙"],p["天津"],p["南京"],p["重庆"],p["大连"],p["东莞"],p["厦门"]],[p["香港特别行政区"]]),r=T.array.indexOf(i,""+t)>-1,m=T.array.indexOf(e,""+t)>-1,g=t>=9e3&&9378>=t;a=g?["&copy; #{0} Baidu - GS(2014)6081号&nbsp;- Data &copy; "]:["&copy; #{0} Baidu - GS(2012)6003号&nbsp;- Data &copy; "],o===BMAP_PERSPECTIVE_MAP?a.push('<a target="_blank" href="http://www.o.cn/">都市圈</a>'):o===BMAP_SATELLITE_MAP?(r&&a.push(' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>'),m&&a.push(' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>'),g&&(a.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'),a.push(' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>'))):(r&&o!=BMAP_TYPE_DIMENSIONAL&&a.push(' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>'),m&&a.push(' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>'),g&&(a.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'),a.push(' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>'))),window.copyCtrl||(window.copyCtrl=new BMap.CopyrightControl,map.addControl(window.copyCtrl));var l=(new Date).getFullYear();window.copyCtrl.addCopyright({content:baidu.string.format(a.join(""),[l]),id:1})}}});
;define("common:widget/ui/urlQueryProcessor/UrlQueryProcessor.js",function(e,n,o){function t(e){if(!e.data||!e.data[0].result){var n=c.getParam(location.href),o=n.latlng.split(",")[1],t=n.latlng.split(",")[0],d=BMap.Project.convertLL2MC(new BMap.Point(o,t)),r=new BMap.Marker(d);map.addOverlay(r),map.centerAndZoom(d,17),n.autoOpen&&"true"==n.autoOpen&&i(r,d),r.addEventListener("click",function(){a.iw&&a.iw.isOpen()||i(r,d)})}}function i(n,o){e.async("common:widget/ui/searchInfoWindow/searchInfoWindow.js",function(e){a.iw=e.createSearchInfoWnd({title:T.encodeHTML(t.tit),mingpian:T.encodeHTML(t.content)},{cityCode:f.cityCode,x:o.lng,y:o.lat}),e.openSearchInfoWndPOI(a.iw,n)})}function a(){var e=c.getParam(location.href),n=e&&e.title||"",o=e&&e.content||"";e&&e.latlng&&(n||""==n)&&(o||""==o)&&(t.tit=c.filtQuery(decodeURIComponent(n)),t.content=c.filtQuery(decodeURIComponent(o)),d({confilterWords:[t.tit+t.content]}))}function d(e){for(var n=e.confilterWords,o=(e.callback,"../../../../../map.baidu.com/maps/transformers/confilter-.htm"/*tpa=http://map.baidu.com/maps/transformers/confilter?*/),i=[],a=0;a<n.length;a++)i.push("q[]="+encodeURIComponent(n[a]));baidu.jsonp(o+"&"+i.join("&"),function(e){t(e)},{cbtype:"cb"})}var c=e("common:widget/ui/util/util.js"),r=e("common:widget/ui/searchBox/searchBox.js"),s=e("common:widget/com/componentManager.js"),l=e("common:widget/ui/config/config.js"),f=l.modelConfig,u=(l.mapConfig,{processUrlQuery:function(){var e=window.location.search?window.location.search.substr(1):"";if(e){for(var n=e.split("&"),o={},t=0,i=n.length;i>t;t++){var a=n[t].split("=");try{o[a[0]]=decodeURIComponent(a[1])}catch(d){continue}}var l=o.saddr||o.daddr,u=c.filtQuery(o.saddr)||c.filtQuery(o.daddr);if(l)if(u){var m=o.ccode||f.cityCode;if(c.filtQuery(o.saddr)&&c.filtQuery(o.daddr)){var p="t"==o.dirflag?"bs":"nav",g=encodeURIComponent("2$$$$$$"+o.saddr+"$$0$$$$"),w=encodeURIComponent("2$$$$$$"+o.daddr+"$$0$$$$");s.go("bs"==p?"bt&c="+m+"&sn="+g+"&en="+w:"nav&c="+m+"&sc="+m+"&ec="+m+"&sn="+g+"&en="+w+(window.navTimeCache?"&time_index="+window.navTimeCache.timeIndex+"&day="+window.navTimeCache.day:"&time_index=-1&day=-1"))}else s.go("s&wd="+encodeURIComponent(u)+"&c="+m,{onload:function(){o.dirflag="d"==o.dirflag?"d":"t";var e="d"==o.dirflag?3:2;setTimeout(function(){r.setSwitchTab(e),r.setQValue(o.saddr,e,0),r.setQValue(o.daddr,e,1),o.saddr?r.setQFocus(e,1):r.setQFocus(e,0)},1)}})}else{var $="d"==o.dirflag?3:2;r.setSwitchTab($)}}},handleUrlExt:a});o.exports=u});
;define("common:widget/ui/changeMap/ChangeMap.js",function(e,t,a){function o(e){e.addEventListener("zoomend",function(){d["3d_city"][p.cityCode]&&map.getZoom()>=12||(e.mapType!=BMAP_TYPE_DIMENSIONAL&&(map.currentCity="",map.cityCode=""),i.setMapCtrlWhenMoving(p.cityCode))});var t=0;e.addEventListener("maptypechange",function(a){function o(){e.removeEventListener("tilesloaded",o)}{var n=a.mapType,p=a.exMapType,d=window.currentComponent;d._className}m&&m.resetWidth(),i.setDataCopyRight(),n===BMAP_SATELLITE_MAP?(copyCtrl&&copyCtrl.addSateMapStyle(),scaleCtrl&&scaleCtrl.addSateMapStyle()):p===BMAP_SATELLITE_MAP&&(copyCtrl&&copyCtrl.removeSateMapStyle(),scaleCtrl&&scaleCtrl.removeSateMapStyle()),0==t&&(e.addEventListener("tilesloaded",o),t=1),"B_NORMAL_MAP"==n?addStat("basemap.maptypechange.normalmap"):"B_SATELLITE_MAP"==n?addStat("basemap.maptypechange.satellitetype"):"B_DIMENSIONAL_MAP"==n&&addStat("basemap.maptypechange.3dmap")})}var n=(e("common:widget/com/componentManager.js"),e("common:widget/ui/config/config.js")),i=e("common:widget/ui/indexUtil/IndexUtil.js"),m=(e("common:widget/ui/mapInfo/mapInfo.js"),e("common:widget/ui/Traffic/Traffic.js"),e("common:widget/ui/tools/tools.js")),p=n.modelConfig,d=n.mapConfig;a.exports=o});
;define("common:widget/ui/MapCenter/MapCenter.js",function(t,e,n){function i(){T.lang.Class.call(this),this._map=map,this.startPoint=map.centerPoint,this.unit=1e4,this.url=d.MAP_CENT_URL+"?newmap=1&qt=cen",this._cbks=[]}function a(){var t=map.getBounds(),e=function(t){return 1e3*parseInt(t/1e3)};return e(t.minX)+","+e(t.minY)+";"+e(t.maxX)+","+e(t.maxY)}var s=t("common:widget/ui/config/config.js"),o=t("common:widget/ui/Traffic/Traffic.js"),r=t("common:widget/ui/Weather/Weather.js"),c=t("common:widget/ui/indexUtil/IndexUtil.js"),u=t("common:widget/ui/AQIMgr/AQIMgr.js"),l=s.modelConfig,d=(s.mapConfig,s.urlConfig);T.extend(i.prototype,{init:function(){var t=this,e=map;l.enableMapMove=!0,e.addEventListener("load",function(e){t.request(e),o.setHighLevel()}),e.addEventListener("moveend",function(e){t.request(e)}),e.addEventListener("dragend",function(e){t.request(e)}),e.addEventListener("zoomend",function(e){t.request(e),o.setHighLevel()})},request:function(){if(r.active||0!=l.enableMapMove&&map.mapType!=BMAP_TYPE_DIMENSIONAL){var t=map.zoomLevel,e=window.currentComponent;if((!e||"AQIMap"!=e._className)&&4>=t)return window.temp.map_level=t,c.setCurCity("全国","1",0),c.setSupBus(0),baidu.g("air_quality_btn").innerHTML="",void(baidu.g("txt_weather").innerHTML="");var n=map.centerPoint,i=this.startPoint,s=Math.sqrt((i.lng-n.lng)*(i.lng-n.lng)+(i.lat-n.lat)*(i.lat-n.lat));if(s>this.unit||window.temp.map_level!=t||r.active){window.temp.map_level=t,this.startPoint=n;var o=this,d=this.url+"&b="+a()+"&l="+t;d+=u.isActive()?"&dtype=2":"&dtype=1",baidu.jsonp(d,function(t){t&&t.content&&o.curCity(t)})}}},curCity:function(t){if(t&&(r.add(t.weather),u.set(t.aqi,t.current_city,"mapcenter")),0!=l.enableMapMove){try{var e=t,n=e.content,i=e.current_city,a=(i.code,i.type);n.sup=i.sup,c.setCurCity(n.name,n.uid,a,n),null!=n.sup_bus&&c.setSupBus(n.sup_bus),e.hot_city&&window._OLR&&(window._OLR.hot_city=e.hot_city)}catch(s){}for(var o=0,d=this._cbks.length;d>o;o++)this._cbks[o]&&"function"==typeof this._cbks[o]&&this._cbks[o]()}},addCallback:function(t){this._cbks.push(t)},removeCallback:function(t){for(var e=0,n=this._cbks.length;n>e;e++)this._cbks[e]===t&&(this._cbks.splice(e,1),e--)},clearCallbacks:function(){this._cbks.length=0}}),n.exports=new i});
;define("common:widget/ui/publicEvent/PublicEvent.js",function(e,t,n){function i(){T.lang.Class.call(this)}var a=e("common:widget/com/componentManager.js"),s=e("common:widget/ui/config/config.js"),o=e("common:widget/ui/tools/tools.js"),r=e("common:widget/ui/PanoUtil/PanoUtil.js"),c=s.modelConfig;T.lang.inherits(i,T.lang.Class,"PublicEvent"),T.object.extend(i.prototype,{layerUrl:"../../../../../map.baidu.com/maps/interfaces/lbscloud/getOnlineLayers.htm"/*tpa=http://map.baidu.com/maps/interfaces/lbscloud/getOnlineLayers*/,dataUrl:"../../../../../map.baidu.com/maps/interfaces/lbscloud/getPoisByBounds.htm"/*tpa=http://map.baidu.com/maps/interfaces/lbscloud/getPoisByBounds*/,eventIcons:"../../../../../bs.baidu.com/incident-mis/incident-icon.png"/*tpa=http://bs.baidu.com/incident-mis/incident-icon.png*/,iconType:"big",bigIconZoom:14,cityId:1,cityType:2,eventLayers:null,poiData:null,layerUids:"",moveType:"",cacheData:{},eventDataIds:[],curTileId:"",markers:{},opened:!1,mapEvent:null,isInfoMove:!1,clickMkr:null,openInfData:null,init:function(e){window.isPrint||r.isOpen||(e=e||{},this.cityId=e.cityId||c.cityCode,this.cityType=e.cityType||c.cityType,this._map=map,this.bind(),this.getEventsLayers())},bind:function(){},open:function(){var e=this;this.opened||this.mapEvent||this.bindEvents(),this.opened=!0;var t=map.getZoom();t>=8?e.getEventsData():e.addOvMarker()},close:function(){this.opened=!1,this.setEventTool(!0,"show"),this.clearEvents(),this.removeMarker(),this.isInfoMove=!1,this.moveType="",map.closeInfoWindow()},toggle:function(){this.opened?this.close():this.open()},show:function(){for(var e=this,t=0;t<e.markers.length;t++){var n=e.markers[t];n.isVisible()?null:n.show()}e.ishide=!1,e.setEventTool(!0,"hide")},hide:function(){for(var e=this,t=0;t<e.markers.length;t++){var n=e.markers[t];n.isVisible()?n.hide():null}e.ishide=!0,e.setEventTool(!0,"show")},getEventsLayers:function(){var e=this,t=this.layerUrl+"?group=1";baidu.jsonp(t,function(t){e.getLayerCbk(t)})},getLayerCbk:function(e){if(e&&e.contents&&0==e.status&&e.contents.length>0){var t=this.eventLayers=e.contents;this.layerUids=this.getBoundLayers(t),this.bindEvents(),this.open()}},getBoundLayers:function(e){if(e&&!(e.length<1)){for(var t=map.getBounds(),n="",i=null,a=null,s=null,o=null,r=null,c=0,d=e.length;d>c;c++)i=e[c].bounds.split("|"),a=i[0].split(","),s=i[1].split(","),o=new BMap.Bounds(a[0],a[1],s[0],s[1]),r=t.intersects(o),r&&(n=""==n?e[c].uid:n+","+e[c].uid);return n}},bindEvents:function(){var e=this;this.mapEvent=function(t){e.moveType=t.type;var n=map.getZoom();n>=8?e.getEventsData():e.addOvMarker()},this.mapChange=function(t){var n=t.mapType;n===BMAP_TYPE_DIMENSIONAL?e.hide():e.mapEvent(t)},map.addEventListener("load",e.mapEvent),map.addEventListener("moveend",e.mapEvent),map.addEventListener("resize",e.mapEvent),map.addEventListener("zoomend",e.mapEvent),map.addEventListener("dragend",e.mapEvent),map.addEventListener("maptypechange",e.mapChange)},clearEvents:function(){var e=this;map.removeEventListener("load",e.mapEvent),map.removeEventListener("moveend",e.mapEvent),map.removeEventListener("resize",e.mapEvent),map.removeEventListener("zoomend",e.mapEvent),map.removeEventListener("dragend",e.mapEvent),map.removeEventListener("maptypechange",e.mapChange),e.mapEvent=null,e.mapChange=null},getEventsData:function(){var e=this,t=map.getBounds(),n=t.getMin(),i=t.getMax(),a=t.minX+","+t.minY+"|"+t.maxX+","+t.maxY,s=map.getZoom(),o=map.getTileId(n,s),r=map.getTileId(i,s);if(this.curTileId=o.row+"_"+o.column+"_"+r.row+"_"+r.column+"_"+s,this.cacheData&&this.cacheData[this.curTileId])this.addMarkers(this.cacheData[this.curTileId]);else{var c=this.layerUids=this.getBoundLayers(this.eventLayers);if(c){var d=this.dataUrl+"?"+baidu.url.jsonToQuery({bounds:a,ids:c,btype:"mc"},encodeURIComponent);baidu.jsonp(d,function(t){e.getDataCbk(t)})}else this.setEventTool(!1,"hide")}},getDataCbk:function(e){e&&e.contents&&e.contents.length>0?(this.cacheData[this.curTileId]=e.contents,this.addMarkers(e.contents)):this.setEventTool(!1,"hide")},setEventTool:function(e,t){var n=T.g("tool_event");r.isOpen||(n.innerHTML="show"==t?'<span class="toolBtn-cont"><span class="toolBtn-img"></span>显示突发事件</span>':'<span class="toolBtn-cont"><span class="toolBtn-img"></span>隐藏突发事件</span>',n.style.display=1==e?"block":"none"),map.getMapType()==BMAP_TYPE_DIMENSIONAL&&(n.style.display="none"),o.resetWidth()},addOvMarker:function(){if(this.removeMarker(),this.eventLayers&&!(this.eventLayers.length<1)){if(!this.opened)return void this.setEventTool(!0,"show");this.setEventTool(!0,"hide");for(var e=this,t=e.eventLayers,n=[],i=22,a=20,s=0,o=t.length;o>s;s++){var r=t[s].cpoint,c=r.split(","),d=new BMap.Point(c[0],c[1]),p=new BMap.Icon(this.eventIcons,new BMap.Size(i,a),{imageOffset:new BMap.Size(0,-20)}),l=new BMap.Marker(d,{icon:p,enableMassClear:!1});l.addEventListener("click",function(){var t=this.domElement.cpoint,n=t.split(","),i=new BMap.Point(n[0],n[1]);e.switchCity(i)}),map.addOverlay(l),l.domElement=l.domElement||{},l.domElement.title=t[s].title,l.domElement.cpoint=t[s].cpoint,n.push(l)}e.markers=n}},switchCity:function(e){var t,n=this,i=baidu.string.format("http://api.map.baidu.com/?qt=rgc&x=#{0}&y=#{1}&dis_poi=100&poi_num=10&ie=utf-8&oue=1&res=webmap",e.lng,e.lat);baidu.jsonp(i,function(i){i&&i.content&&i.content.address_detail&&(t=i.content.address_detail.city,a.go("cur&wd="+t,function(){map.setCenter(e);var t=n.getBdStr(),i=n.getBoundLayers(n.eventLayers),a=n.dataUrl+"?"+baidu.url.jsonToQuery({bounds:t,ids:i,btype:"mc"},encodeURIComponent);baidu.jsonp(a,function(e){n.getDataCbk(e)})}))})},addMarkers:function(e){var t=this,n=[];if(this.removeMarker(),!this.opened)return void this.setEventTool(!0,"show");this.setEventTool(!0,"hide");for(var i=0;i<e.length;i++){var a=this.createMkr(e[i],e);map.addOverlay(a),n.push(a)}t.markers=n;for(var i=0,s=e.length;s>i;i++)if("onmoveend"==this.moveType&&this.isInfoMove&&e[i].uid==this.openUid){var o=e[i].mercator,r=o.split(","),c=new BMap.Point(r[0],r[1]);map.openInfoWindow(this.openInfWin,c),this.isInfoMove=!1,this.moveType="";break}},removeMarker:function(){for(var e=this,t=0;t<e.markers.length;t++)map.removeOverlay(e.markers[t]);e.markers=[]},createMkr:function(e){if(e&&e.mercator){var t=e.mercator,n=t.split(","),i=new BMap.Point(n[0],n[1]),a=this.createIcon(e),s=this.creteLabel(e),o=new BMap.Marker(i,{icon:a});o.setLabel(s),o._eventData=e;var r=this.createMkrInfWin(e);return this.bindMrkEvents(r,o),o}},creteLabel:function(e){var t=new BMap.Label(e.title,{offset:new BMap.Size(20,18)});return t.setStyle({borderColor:"#acaba9",color:"#4d4a43",cursor:"pointer",padding:"2px 3px"}),t.hide(),t},createIcon:function(e){if(e.icon){var t=this,n=map.getZoom(),i="string"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/==typeof e.icon?baidu.json.parse(e.icon):c,a=22,s=20,o=i.offx,r=i.offy;t.iconType="big",n<t.bigIconZoom&&(a=17,s=17,o=i.offx+i.soffx,t.iconType="small");var c=new BMap.Icon(this.eventIcons,new BMap.Size(a,s),{imageOffset:new BMap.Size(o,r),infoWindowOffset:new BMap.Size(15,0)});return c}},createMkrInfWin:function(e){var t,n,i="string"==typeof e.icon?baidu.json.parse(e.icon):i,a=i.soffx,s=i.offx+a,o=i.offy,r=e.desclink?'<a target="_blank" href="'+e.desclink+'" >详情</a>':"",c=e.desclink?baidu.string(e.title).subByte(22,"..."):baidu.string(e.title).subByte(26,"..."),d='<span class="iw_pub_evt_title" title="'+e.title+'"><em style="background-position:'+s+"px "+o+'px; "></em>'+c+r+"</span>";n=""==e.desc||"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/==typeof e.desc?"":'<p class="evt_desc" >'+e.desc+"</p>",t=e.img?e.imglink?'<p class="evt_img" ><a target="_blank" href="'+e.imglink+'" ><img width="260" height="140" src="'+e.img+'"/></a></p>':'<p class="evt_img" ><img width="260" height="140" src="'+e.img+'"/></p>':"";var p='<div class="iw_pub_evt_content" >'+n+t+"</div>",l=new BMap.InfoWindow(p,{margin:[42,10,20,10],title:d,width:280,enableAutoPan:!0,enableCloseOnClick:!1});return l},bindMrkEvents:function(e,t){var n=this;t.addEventListener("mouseover",function(){this.setTop(!0),e.isOpen()||this.getLabel()&&this.getLabel().show()}),t.addEventListener("mouseout",function(){e.isOpen()||(this.getLabel()&&this.getLabel().hide(),this.setTop(!1))}),t.addEventListener("click",function(){n.clickMkr=this,n.openUid=this._eventData.uid,this.openInfoWindow(e),this.getLabel()&&this.getLabel().hide()}),e.addEventListener("open",function(){n.openInfWin=this,n.isInfoMove=!0})},clearCache:function(){this.cacheData={},this.eventDataIds=[]},getBdStr:function(){var e=map.getBounds(),t=e.minX+","+e.minY+"|"+e.maxX+","+e.maxY;return t}}),n.exports=i});
;define("common:widget/ui/contextMenu/ContextMenu.js",function(n,e,t){function o(){var e=function(n){i.loadTPMAsync("RouteAddr"==window.currentComponent._className?1==s._curSelIndex||2==s._curSelIndex?function(){i.load("BusTrans",{dom:["a"],cinfo:{isPos:!0,destFlag:0,point:n},record:!1,isMainRequest:"no"})}:function(){i.load("NavTrans",{dom:["a"],cinfo:{isPos:!0,destFlag:0,point:n},record:!1,isMainRequest:"no"})}:s._curSelIndex<3?function(){i.load("BusTrans",{dom:["a"],cinfo:{isPos:!0,destFlag:0,point:n},record:!1,isMainRequest:"no"})}:function(){i.load("NavTrans",{dom:["a"],cinfo:{isPos:!0,destFlag:0,point:n},record:!1,isMainRequest:"no"})}),addStat("poiinfowin.rightmenu.starthere")},t=function(e){addStat("poiinfowin.rightmenu.passthroughhere"),s._curSelIndex<3&&s.setSwitchTab(3),n.async("common:widget/ui/throughpoint/Throughpoint.js",function(n){n.addTPointByPoint(e)})},o=function(n){if(addStat("poiinfowin.rightmenu.goinghere"),"RouteAddr"==window.currentComponent._className){var e=n.lng+","+n.lat,t=window.currentComponent||{};i.go("sd&pt="+e+"&r=5000",t.getCMEnd,n)}else s._curSelIndex<3?i.load("BusTrans",{dom:["a"],cinfo:{isPos:!0,destFlag:1,point:n},record:!1,isMainRequest:"no"}):i.load("NavTrans",{dom:["a"],cinfo:{isPos:!0,destFlag:1,point:n},record:!1,isMainRequest:"no"})},d=function(e){n.async("common:widget/ui/searchInfoWindow/searchInfoWindow.js",function(n){var t=e,o=n.addRangeSearchCenterPoi(t),a=n.createRangeInfoWnd(t);a.addEventListener("close",function(){n.exitRangeSearch(),a.overlay&&a.overlay.remove()}),a.addEventListener("open",function(){window.GRControll&&window.GRControll.setGRequestFlg(1500),map.addEventListener("moveend",function(){setTimeout(function(){if(T.g("rangekw"))try{T.g("rangekw").focus()}catch(n){}},100),map.removeEventListener("moveend",arguments.callee)})}),n.openSearchInfoWnd(a,o,{pano:!0,panoPoint:t})}),addStat("poiinfowin.rightmenu.searchnb")},r=function(n){map.zoomIn(n),addStat("poiinfowin.rightmenu.zoomin")},c=function(n){map.zoomOut(n),addStat("poiinfowin.rightmenu.zoomout")},m=function(n){map.panTo(n),addStat("poiinfowin.rightmenu.centrehere")},u=a([{text:"<span id='cmitem_start'> 以此为起点</span>",callback:e,width:90},{text:"<span id='cmitem_pass'> 以此为途经点</span>",callback:t,width:90},{text:"<span id='cmitem_end'> 以此为终点</span>",callback:o,width:90},{separator:!0},{text:"<span id='cmitem_nsearch'> 在此点附近找...</span>",callback:d,width:90},{separator:!0},{text:"<span id='cmitem_zoomin'>放大</span>",callback:r,width:70},{text:"<span id='cmitem_zoomout'>缩小</span>",callback:c,width:70},{text:"<span id='cmitem_center'>居中</span>",callback:m,width:70}]);return map.addEventListener("maptypechange",function(){this.getMapType()==BMAP_NORMAL_MAP?u.enable():this.getMapType()==BMAP_PERSPECTIVE_MAP&&u.disable()}),u.addEventListener("open",function(){if(!window.currentComponent||"RouteAddr"!=window.currentComponent._className){var e=this;this.getItem(0)&&this.getItem(0).enable(),this.getItem(2)&&this.getItem(2).enable(),map.getZoom()<10?this.getItem(3).disable():this.getItem(3).enable(),map.getZoom()==map.config.zoomLevelMax?this.getItem(4).disable():this.getItem(4).enable(),map.getZoom()==map.config.zoomLevelMin?this.getItem(5).disable():this.getItem(5).enable(),n.async("common:widget/ui/throughpoint/Throughpoint.js",function(n){n.onContextMenu()?e.getItem(1).enable():e.getItem(1).disable()})}}),u}function a(n,e,t){var o=new BMap.ContextMenu({container:e});e&&e!==map?o.initialize(map):map.addContextMenu(o);for(var a=0,i=n.length;i>a;a++){var s=n[a];s.separator?o.addSeparator():o.addItem(new BMap.MenuItem(s.text,s.callback||function(){},{width:s.width||100,id:s.id}))}return o.setCursor(t),o}var i=n("common:widget/com/componentManager.js"),s=(n("common:widget/ui/mapInfo/mapInfo.js"),n("common:widget/ui/searchBox/searchBox.js")),d={init:function(){var n=o();return n},create:function(n,e,t){var o=a(n,e,t);return o},destroy:function(n){n&&n.destroy&&(n.destroy(),n=null)}};t.exports=d});
;define("common:widget/ui/StreetViewTool/StreetViewTool.js",function(t,e,i){function o(t){this._map=t.map||map,this.defaultCursor=this._map.config.defaultCursor,this.draggingCursor=this._map.config.draggingCursor,this.isOpen=!1,this.isBtnActionOpen=!1,this.startTop=70,this.startRight=13,this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new BMap.Size(this.startRight,this.startTop),this.ICON=["-50px -152px","0px -152px"]}var s,n,a=(t("common:widget/ui/util/util.js"),t("common:widget/ui/stat/CodeStat.js"),t("common:widget/ui/indexUtil/IndexUtil.js")),r=t("common:widget/ui/PanoService/PanoService.js"),p=t("common:widget/ui/config/config.js"),u=p.modelConfig,d=(p.mapConfig,18);o.prototype=new BMap.Control,o.prototype.initialize=function(){try{var t=document.createElement("div"),e=this.streetTool=document.createElement("div"),i=this._map.getContainer(),o="../images/street_tool_c1d9c10.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_c1d9c10.png*/;return baidu.setStyles(t,{width:"50px",height:"52px",margin:0,padding:0,cursor:"pointer"}),baidu.setStyles(e,{width:"50px",height:"52px",backgroundImage:'url("'+o+'")',backgroundRepeat:"no-repeat",backgroundPosition:this.ICON[1]}),t.appendChild(e),i.appendChild(t),this.addEvents(),t}catch(s){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/ui/StreetViewTool/StreetViewTool.js",ln:80})}},o.prototype.addEvents=function(){var e=this,i=window,o=this.streetTool;baidu.on(o,"click",function(){return a.isSupportStreetView()?(s=null,e._setMouseOver(),void e.setStatus()):void t.async("common:widget/pano/module/PanoCityPageModule/PanoCityPageModule.js",function(t){var e=new t;e.initialize(u.cityCode)})}),baidu.on(o,"mouseover",function(){e.isOpen||e._setMouseOver()}),baidu.on(o,"mouseout",function(){e.isOpen||e._setMouseOut()}),this._map.addEventListener("maptypechange",function(t){if(a.isSupportStreetView()){var i=t.mapType;i===BMAP_TYPE_DIMENSIONAL?(e.hide(),e.resetStatus()):(e.show(),e.setPostion(),e.isOpen&&e.roadLayer&&e.roadLayer.update())}});this._map.addEventListener("zoomend",function(){var t=e._map.getZoom();a.isSupportStreetView()&&d>=t&&e.isOpen&&!n&&"mouseScroll"==s&&(e.resetStatus(),e.streetViewUtil.resetStatus())}),this._map.addEventListener("zoomexceeded",function(t){if(a.isSupportStreetView()){var i=t.targetZoom;20!==i||e.isOpen||(s="mouseScroll",e.setPostion(),e.resetStatus(),e.setStatus(),s="mouseScroll",n||addStat(STAT_CODE.STAT_PANORAMA,{item:"mousewheel-raodnet-open"}))}}),i.maptypeCtrl.addEventListener("hide",function(){e.setPostion()}),i.maptypeCtrl.addEventListener("show",function(){e.setPostion()})},o.prototype.bindKeyEvent=function(){this.isEnableKey=!0;var t=this,e=T.browser.ie&&T.browser.ie<=7?"keypress":"keydown";baidu.on(document,e,function(i){if(27==i.keyCode){t.isOpen&&t.isEnableKey&&(t.resetStatus(),t.streetViewUtil&&t.streetViewUtil.resetStatus());var o=arguments.callee;T.un(document,e,o),o=null}})},o.prototype._setMouseOver=function(){this.streetTool.style.backgroundPosition=this.ICON[0]},o.prototype._setMouseOut=function(){this.streetTool.style.backgroundPosition=this.ICON[1]};var l=function(){var t=T.G("defCityTip");t&&(t.style.display="none")};o.prototype.setStatus=function(t){var e=this;n=t,this.isOpen?(this.isOpen=!1,this.streetViewUtil&&this.streetViewUtil.resetStatus(),this.roadLayer&&this.roadLayer.hide(),this._setMouseOut(),this._map.setDefaultCursor(this.defaultCursor),e._panoPoiClick&&(e._panoPoiClick.removeSpotEvent(),e._panoPoiClick.hideOverlays(),e._panoPoiClick.clearPoiCache(),MPC_Mgr.bindMouseMove(),MPC_Mgr.bindSpotEvent()),l()):(this.isOpen=!0,this._setMouseOver(),this.checkPanoInfo(),addStat(STAT_CODE.STAT_PANORAMA,{catalog:"tool",func:"click"}))},o.prototype.checkPanoInfo=function(){var t=this,e=this._map.getBounds();r.checkBounds(e,function(e){e&&0==e.error&&e.content?(t.loadStreetView(),t.setTools()):(t.isEnableKey=!1,t.isOpen=!1,t._setMouseOut(),map.setDefaultCursor(t.defaultCursor))},t)},o.prototype.resetStatus=function(){var t=window;this._setMouseOut(),this.isOpen=!1,resetStatus=null,l(),this._map.setDefaultCursor(this.defaultCursor),this._map.setDraggingCursor(this.draggingCursor),this.setPostion(),this.streetViewUtil&&this.streetViewUtil.removeEvents(),this.roadLayer&&this.roadLayer.hide(),this._panoPoiClick&&(this._panoPoiClick.removeSpotEvent(),this._panoPoiClick.hideOverlays(),this._panoPoiClick.clearPoiCache()),t.MPC_Mgr&&(t.MPC_Mgr.bindMouseMove(),t.MPC_Mgr.bindSpotEvent())},o.prototype.setTools=function(){var t=window;t.captureCtrl&&t.captureCtrl.endCapture(),t.MapSignInst&&t.MapSignInst.exituserSign()},o.prototype.loadStreetView=function(){this._map.closeInfoWindow();var e=this,i=window;t.async(["common:widget/ui/StreetViewLayer/StreetViewLayer.js","common:widget/ui/StreetViewUtil/StreetViewUtil.js","common:widget/ui/PanoPoiClick/PanoPoiClick.js"],function(t,o,s){if(i.MPC_Mgr&&i.MPC_Mgr.removeSpotEvent(),i.weipaiTool){{i.weipaiTool.wpClick}i.weipaiTool.isOpen&&i.weipaiTool.resetStatus()}e.streetViewUtil=new o({map:e._map,panoTool:e,exitLargeMapMode:!1}),e.roadLayer||(e.roadLayer=new t({map:e._map})),e.roadLayer.show(),e._panoPoiClick?e._panoPoiClick.refresh(e._map):e._panoPoiClick=new s(e._map,"_panoPoiClick"),e.bindKeyEvent()})},o.prototype.setPostion=function(){if(this.isVisible()){var t=window,e=this._map.getMapType(),i=maptypeCtrl.isVisible(),o=this.startTop,s=this.startRight;o="B_SATELLITE_MAP"==e?i?132:45:i?102:45,this.setOffset(new BMap.Size(s,o)),t.weipaiTool&&t.weipaiTool.isVisible()&&t.weipaiTool.setPostion()}},o.prototype.getToolPos=function(){var t=T.dom.getPosition(this._map.getContainer()),e=this.getDom(),i=this.getOffset(),o=i.width+e.clientWidth+10,s=i.height+t.top;return{top:s,right:o}},i.exports=o});
;define("common:widget/ui/Storage/Storage.js",function(e,t,a){baidu.storage={},baidu.storage._isValidKey=function(e){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(e)},baidu.storage.userData=function(){var e="_BAIDU.ALL.KEY_",t=function(){var e=null;return e=document.createElement("input"),e.type="hidden",e.addBehavior("#default#userData"),document.body.appendChild(e),e},a=function(e,a){try{var r=t(),o=a||{};if(o.expires){var u;"number"==typeof o.expires&&(u=new Date,u.setTime(u.getTime()+o.expires)),r.expires=u.toUTCString()}o.expires=null,r.setAttribute(o.key,o.value),r.save(o.key)}catch(i){}},r=function(t,r){a(t,r),result=o({key:e}),result=result?{value:result}:{key:e,value:""},new RegExp("(^||)"+t+"(||$)").test(result.value)||(result.value+="|"+t,a(e,result))},o=function(e){try{var a=t();return a.load(e.key),a.getAttribute(e.key)||null}catch(r){return null}},u=function(e){try{var a=t();a.load(e.key),a.removeAttribute(e.key);var r=new Date;r.setTime(r.getTime()-1),a.expires=r.toUTCString(),a.save(e.key)}catch(o){}},i=function(){if(result=o({key:e})){result={value:result};for(var t=(result.value||"").split("|"),a=t.length,r=0;a>r;r++)u({key:t[r]})}};return{getItem:o,setItem:r,removeItem:u,clearAll:i}}(),baidu.storage._isSupportLocalStorage=function(){return"localStorage"in window&&null!==window.localStorage},baidu.storage.isSupportStorage=function(){return"localStorage"in window&&null!==window.localStorage||document.all},baidu.storage.set=function(e){if(baidu.storage._isValidKey(e.key)){var t=e||{};baidu.storage._isSupportLocalStorage()?(window.localStorage.setItem(t.key,t.value),e.expires&&window.localStorage.setItem(t.key+".expires",t.expires)):baidu.storage.userData.setItem(e.key,t)}},baidu.storage.get=function(e){var t=null;if(!baidu.storage._isValidKey(e.key))return t;if(baidu.storage._isSupportLocalStorage()){if(t=window.localStorage.getItem(e.key)){var a=window.localStorage.getItem(e.key+".expires");t={value:t,expires:a?new Date(a):null},t&&t.expires&&t.expires<new Date&&(t=null,window.localStorage.removeItem(e.key))}}else t=baidu.storage.userData.getItem(e),t&&(t={value:t});return t?t.value:null},baidu.storage.remove=function(e){baidu.storage._isSupportLocalStorage()?(window.localStorage.removeItem(e.key),window.localStorage.removeItem(e.key+".expires")):baidu.storage.userData.removeItem(e)},baidu.storage.clearAll=function(){baidu.storage._isSupportLocalStorage()?window.localStorage.clear():baidu.storage.userData.clearAll()},a.exports=baidu.storage});
;define("common:widget/ui/MapSuggest/MapSuggest.js",function(require,exports,module){function proxy(){for(var t=[],s=0,e=arguments.length;e>s;s++)t[s]=arguments[s];var i=t[0];return t.shift(),function(){i.apply(null,t)}}function BMAddEvent(t,s,e){"undefined"!=typeof window.attachEvent?t.attachEvent("on"+s,e):window.addEventListener&&t.addEventListener(s,e,!0)}Object.extend=function(t,s){for(var e in s)t[e]=s[e];return t},Object.extend(Object,{clone:function(t){return Object.extend({},t)}});var Class=function(){for(var t=function(){this.initialize.apply(this,arguments)},s=0;s<arguments.length;s++){var e=arguments[s];for(var i in e.prototype)t.prototype[i]=e.prototype[i]}return t.child=function(){return new Class(this)},t.extend=function(s){for(var e in s)t.prototype[e]=s[e]},t};Function.prototype.bindAsEventListener=function(t){var s=this;return function(e){s.call(t,e||window.event)}};var util=require("common:widget/ui/util/util.js"),smpMgrStorer=require("common:widget/ui/setMyPlace/SetMyPlaceStorer.js"),config=require("common:widget/ui/config/config.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,_bdMapSuggest=null,isShowSug=!0,bdMapSuggest=new Class;bdMapSuggest.prototype={GE:function(t){return document.getElementById(t)},C:function(t){return document.createElement(t)},clktr:function(t){var s=!1;if(t.id&&t.id.indexOf("myaddr")<0){{var e=t.id.split("__"),i=e[2];e[1]}if((0==this.qType||2==this.qType)&&i>-1&&null!=this.SD){var r=this.SD.s[i];if(""!=r.split("$")[3]&&this.callback&&(s=!0,this.setValue(t.cells[2].childNodes[0].nodeValue),"function"==typeof this.callback&&(0==this.qType||2==this.qType?this.callback(t.cells[3].innerHTML,!0):this.callback(t.cells[2].childNodes[0].nodeValue,!0))),""!=r.split("$")[3])s=!0,this.setValue(t.cells[2].childNodes[0].nodeValue);else{s=!0,this.setValue(t.cells[2].childNodes[0].nodeValue);var d="";try{d=t.cells[3].childNodes[0].nodeValue+t.cells[2].childNodes[0].nodeValue}catch(n){d=t.cells[3].innerHTML+t.cells[2].innerHTML}"function"==typeof this.callback&&this.callback(t.cells[3].innerHTML,!1),setTimeout(proxy(this.sendQuery.bindAsEventListener(this),d),200)}}}s||(this.cs(),this.sub(t.cells[2].childNodes[0].nodeValue))},sub:function(t){this.I.value=t},csc:function(){this.cs(),this.I.blur(),this.I.focus(),"function"==typeof this.closeSuggest&&this.closeSuggest(),isShowSug=!1},trMouseOver:function(t){this.ct(),t.className="mo",this.mouseOnSug=!0},trMouseDown:function(t){this.E=!0,t=t||window.event;for(var s=t.target||t.srcElement;"tr"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/!=s.tagName.toLowerCase();)s=s.parentNode;return this.clktr(s),this.I.focus(),this.isIE?void 0:(e.stopPropagation(),!1)},setSug:function(){if("object"==typeof this.SD&&"undefined"!=typeof this.SD.s){var SmpMgr=require("common:widget/ui/setMyPlace/SetMyPlaceMgr.js"),tab=this.C("table");with(tab)id="bdmap_sugt_"+this.sgId,style.backgroundColor="#fff",cellSpacing=0,cellPadding=1,style.cursor="default";var tb=this.C("tbody");tab.appendChild(tb);var regStr=this.I.value.replace(/[\?\*\|\\()\[\]|\(|\)]/g,""),regStr=regStr.replace(" ",""),reExp=new RegExp(regStr,"g"),reExp1="<b>"+regStr+"</b>",ifShowFLg=!1;this.getSugNum();var sugNumLength;sugNumLength=this.S.sugNum>this.SD.s.length?this.SD.s.length:this.S.sugNum;for(var i=0;sugNumLength>i;i++)if(3!=this.SD.t||this.SD.s[i].split("$")[4].split(";")[0]==eval(this.cityId)&&this.SD.s[i].split("$")[3]!=this.I.value){ifShowFLg=!0;var tr=tb.insertRow(-1);tr.id="tr__"+this.sgId+"__"+i,tr.onmouseover=proxy(this.trMouseOver.bindAsEventListener(this),tr),tr.onmouseout=this.ct.bindAsEventListener(this);var me=this;tr.onmousedown=function(t){me.trMouseDown(t)};var td=tr.insertCell(-1),td1=tr.insertCell(-1),td2=tr.insertCell(-1),td3=tr.insertCell(-1),text_indent=this.offsetPos1[0]<0?-this.offsetPos1[0]-1:this.offsetPos1[0];td.style.textIndent=text_indent+"px",td2.style.display="none",td3.style.display="none";var sdwords=this.SD.s[i].split("$");switch(this.SD.t){case 0:td1.style.display="none";var keywordStr="";""==sdwords[3]?sdwords[2].toLowerCase().indexOf(regStr.toLowerCase())>-1?(keywordStr=sdwords[2],td.innerHTML=sdwords[2].replace(reExp,reExp1)+'&nbsp;<span class="spoi1">'+sdwords[0]+sdwords[1]+"</span>",td3.innerHTML=sdwords[0]+sdwords[1]):sdwords[1].toLowerCase().indexOf(regStr.toLowerCase())>-1||(sdwords[1]+sdwords[2]).toLowerCase().indexOf(regStr.toLowerCase())>-1?(keywordStr=sdwords[1]+sdwords[2],td.innerHTML=(sdwords[1]+sdwords[2]).replace(reExp,reExp1)+'&nbsp;<span class="spoi1">'+sdwords[0]+"</span>",td3.innerHTML=sdwords[0]):(keywordStr=sdwords[0]+sdwords[1]+sdwords[2],td.innerHTML=(sdwords[0]+sdwords[1]+sdwords[2]).replace(reExp,reExp1),td3.innerHTML=""):(keywordStr=sdwords[3],td.innerHTML=sdwords[3].replace(reExp,reExp1)+'&nbsp;<span class="spoi1">'+(sdwords[0]+sdwords[1]).replace(reExp,reExp1)+"</span>",td3.innerHTML=sdwords[0]+sdwords[1]+sdwords[2]),td2.innerHTML=keywordStr;break;case 1:td1.style.display="none",""!=sdwords[1]&&(td.innerHTML=(sdwords[0]+sdwords[1]).replace(reExp,reExp1),td2.innerHTML=sdwords[0]+sdwords[1]);break;case 2:td1.style.display="none";var keywordStr="";""==sdwords[3]?sdwords[2].toLowerCase().indexOf(regStr.toLowerCase())>-1?(keywordStr=sdwords[2],td.innerHTML=sdwords[2].replace(reExp,reExp1)+'&nbsp;<span class="spoi1">'+sdwords[0]+sdwords[1]+"</span>",td3.innerHTML=sdwords[0]+sdwords[1]):sdwords[1].toLowerCase().indexOf(regStr.toLowerCase())>-1||(sdwords[1]+sdwords[2]).toLowerCase().indexOf(regStr.toLowerCase())>-1?(keywordStr=sdwords[1]+sdwords[2],td.innerHTML=(sdwords[1]+sdwords[2]).replace(reExp,reExp1)+'&nbsp;<span class="spoi1">'+sdwords[0]+"</span>",td3.innerHTML=sdwords[0]):(keywordStr=sdwords[0]+sdwords[1]+sdwords[2],td.innerHTML=(sdwords[0]+sdwords[1]+sdwords[2]).replace(reExp,reExp1),td3.innerHTML=""):(keywordStr=sdwords[3],td.innerHTML=sdwords[3].replace(reExp,reExp1)+'&nbsp;<span class="spoi1">'+(sdwords[0]+sdwords[1]).replace(reExp,reExp1)+"</span>",td3.innerHTML=sdwords[0]+sdwords[1]+sdwords[2]),td2.innerHTML=keywordStr;break;case 3:td.innerHTML=td2.innerHTML=sdwords[3],td.width=95;for(var tmpLineArr=sdwords[4].split(";"),lineArr=tmpLineArr[1].split(","),lineStr="",j=lineArr.length-1;j>=0;j--)lineStr+='<div class="sugg_l_'+tmpLineArr[0]+" sugg_"+tmpLineArr[0]+"_l"+lineArr[j]+'"></div>';td1.innerHTML=lineStr,td1.width=55}}var addrData=smpMgrStorer.getAll();if(addrData&&addrData.length>0){var me=this,text_indentw=me.offsetPos1[0]<0?-me.offsetPos1[0]-1:me.offsetPos1[0],addrRegStr=this.I.value.replace(/[\?\*\|\\()\[\]]/g,"");addrRegStr=this.I.value.replace(" ","");for(var addrRreExp1="<b>"+addrRegStr+"</b>",my_addr_th,my_addr_td,searchW,my_addr_td1,my_addr_td2,my_addr_td3,k=0,len=addrData.length;len>k;k++)searchW=new RegExp("^"+addrRegStr),searchW.test(addrData[k].note)&&(my_addr_th=tb.insertRow(-1),my_addr_td=my_addr_th.insertCell(-1),my_addr_td1=my_addr_th.insertCell(-1),my_addr_td2=my_addr_th.insertCell(-1),my_addr_td3=my_addr_th.insertCell(-1),my_addr_th.id="myAddr_"+k,my_addr_td1.style.display="none",my_addr_td2.style.display="none",my_addr_td3.style.display="none",my_addr_td1.innerHTML=" ",my_addr_td2.innerHTML=" ",my_addr_td3.innerHTML=" ",my_addr_td.style.textIndent=text_indentw+"px",my_addr_td.className="sugMyAddr",my_addr_td.innerHTML="<span>常用地点-"+addrRreExp1+addrData[k].note.replace(addrRegStr,"")+"</span>",my_addr_th.onmouseover=function(){this.className="mo"},my_addr_th.onmouseout=function(){this.className="ml"},my_addr_th.onclick=function(t){return function(){me.cs();var s=addrData[t].uid;SmpMgr.itemClick(s,me.sgId),addStat("indexheader.searchbox.fusedplace")}}(k),addStat("indexheader.searchbox.fusedplace","show"))}if(0==this.closeBol){var th=tb.insertRow(-1),td=th.insertCell(-1);td.style.textAlign="right",td.style.borderTop="1px solid #EBEBEB";var oa=this.C("A");oa.style.color="#888",oa.style.paddingRight="5px",oa.href="javascript:void(0)",oa.title="关闭",oa.innerHTML="关闭",oa.onclick=this.csc.bindAsEventListener(this),td.appendChild(oa);var td1=th.insertCell(-1);td1.style.display="none";var td2=th.insertCell(-1);td2.style.display="none"}if(this.S.innerHTML="",this.S.appendChild(tab),this.T=this.GE("bdmap_sugt_"+this.sgId),ifShowFLg||3==this.SD.t&&1==this.SD.s.length&&this.SD.s[0].split("$")[3]==this.I.value)this.setPos(),this.GE("noResTip"+this.sgId)&&(this.GE("noResTip"+this.sgId).style.display="none"),this.ifSubmit=!1;else{if(this.S.style.display="none",this.isIE&&(this.GE("bdmap_sugif_"+this.sgId).style.display="none"),this.GE("noResTip"+this.sgId)){var tmpRt=this.GE("noResTip"+this.sgId),iPos=this.getPos(this.I);tmpRt.style.left=iPos[0]+this.offsetPos[0]+"px",tmpRt.style.top=iPos[1]+this.offsetPos[1]+parseInt(this.I.offsetHeight)+"px",tmpRt.innerHTML=this.nonResTip,tmpRt.style.display=""}this.ifSubmit=!0}this.c=-1,this.s3=""}},setPos:function(){var t,s,e,i=T.g(this.I.id+"Span");i?(t=T.dom.getPosition(i),s=i.clientWidth,e=i.offsetHeight):(t=T.dom.getPosition(this.I),s=this.I.clientWidth,e=this.I.offsetHeight),("iw_ssn"==this.I.id||"iw_esn"==this.I.id)&&(s-=2),this.S.style.top="PoiSearch"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/==this.I.id?t.top+e-1+"px":"iw_ssn"==this.I.id||"iw_esn"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/==this.I.id?t.top+e-1+"px":t.top+e+"px",this.S.style.left=t.left+"px",this.S.style.display="block",s>=this.T.offsetWidth+2&&(this.T.style.width=s+"px")},getSugNum:function(){var t,s,e,i,r=T.g(this.I.id+"Span");r?(t=T.dom.getPosition(r),s=r.offsetHeight):(t=T.dom.getPosition(this.I),s=this.I.offsetHeight),"PoiSearch"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/==this.I.id?(this.S.style.top=t.top+s-1+"px",e=document.body.clientHeight-t.top-s+1):(this.S.style.top=t.top+s-4+"px",e=document.body.clientHeight-t.top-s+4),i=parseInt((e-30)/27),this.S.sugNum=1>i?0:i>10?10:i},resetPos:function(){"none"!=this.S.style.display&&this.setPos()},ct:function(){for(var t=this.T.rows,s=0;s<t.length;s++)t[s].className="ml"},cs:function(){this.isIE&&this.GE("bdmap_sugif_"+this.sgId)&&(this.GE("bdmap_sugif_"+this.sgId).style.display="none"),this.S&&(this.S.style.display="none"),this.GE("noResTip"+this.sgId)&&(this.GE("noResTip"+this.sgId).style.display="none"),this.timer3=0,this.c=-1},cb:function(){var t=!0,s=this.I.value,e=require("common:widget/ui/searchBox/searchBox.js");if(!e.notShowSuggest.state){if("undefined"!=typeof this.T&&null!=this.T)for(var i=this.T.rows,r=0;r<i.length;r++)"mo"==i[r].className&&i[r].id.indexOf("myAddr")<0&&(s!=i[r].cells[2].childNodes[0].nodeValue||this.mouseOnSug||(t=!1));t&&!this.K&&this.S&&(this.ifSend?this.sendQuery():this.ifSend=!0)}},sendQuery:function(qString){qString?(this.queryWord=this.I.value,this.specQuery1=!0):this.specQuery1=!1;var cityId=eval(this.cityId),pars="",bounds=util.formatBounds();pars=1==cityId&&this.I.id.indexOf("BusSearch")>-1?"/su?wd="+encodeURIComponent(qString?qString:this.I.value)+"&cid="+cityId+"&type=0&newmap=1&b="+bounds+"&t="+(new Date).getTime():"/su?wd="+encodeURIComponent(qString?qString:this.I.value)+"&cid="+cityId+"&type="+this.qType+"&newmap=1&b="+bounds+"&t="+(new Date).getTime();var me=this;baidu.ajax(pars,{dataType:"json",cache:!0,success:function(t,s){me.sugCallBack(t),s.slow?ErrorMonitor("su","req_slow"+s.slow,"",.02,{xhr:s,url:pars,type:"slow",unique:!0}):ErrorMonitor("su","succ","",.02,{xhr:s,url:pars,type:"succ",unique:!0})},error:function(t){ErrorMonitor("su","req_fail","",.02,{xhr:t,url:pars,type:"fail",unique:!0})}})},sugCallBack:function(t){if(!this.tooFast&&t){var s=t;if("object"==typeof s&&"undefined"!=typeof s.s&&"undefined"!=typeof s.s[0]){var e=!1;if(1==s.s.length)switch(s.t){case 0:case 1:case 2:s.s[0].replace(/\$/g,"")==this.I.value&&(e=!0);break;case 3:s.s[0].split("$")[3]==this.I.value&&(e=!0)}(this.enterQuery||3==s.t)&&e?(this.cs(),this.SD={},this.enterQuery=!1,this.ifSubmit=!0):(this.SD=s,this.setSug())}else{if(this.cs(),this.SD={},this.GE("noResTip"+this.sgId)){var i=this.GE("noResTip"+this.sgId),r=this.getPos(this.I);i.style.left=r[0]+this.offsetPos[0]+"px",i.style.top=r[1]+this.offsetPos[1]+parseInt(this.I.offsetHeight)+"px",i.innerHTML=this.nonResTip,i.style.display=""}this.ifSubmit=!0}}},setValue:function(t){var s=["BusSearchSta","BusSearchEnd","DriveSearchSta","DriveSearchEnd"];this.cs(),this.ifSend=!1;for(var e=require("common:widget/ui/searchBox/searchBox.js"),i=0;i<s.length;i++)if(this.I.id==s[i])return void e.setValue(s[i],t);this.I.value=t},f:function(){if(!this.GE(this.sgId))return void this.disposeSug();var t=this.I.value;t==this.s1&&""!=t&&t!=this.s3?0==this.timer2&&(isShowSug?this.timer2=setTimeout(this.cb.bindAsEventListener(this),100):this.s3=t):(clearTimeout(this.timer2),this.timer2=0,this.s1=t,""==t&&this.cs(),this.s3!=this.I.value&&(this.s3=""))},resetSuggestion:function(){"none"!=this.S.style.display&&setTimeout(function(){this.cs(),null!=this.SD&&(this.setSug(this.SD),this.I.focus())},100)},keyDownSuggest:function(t){var s=require("common:widget/ui/setMyPlace/SetMyPlaceMgr.js");_bdMapSuggest=this,l=t||window.event,this.K=!1;var e;if(27==l.keyCode)return this.isIE?l.returnValue=!1:l.preventDefault(),this.I.blur(),void this.I.focus();if(13==l.keyCode){if(this.T&&this.T.getElementsByTagName("TR")[this.c]){var i=this.T.getElementsByTagName("TR")[this.c];if(i.id&&i.id.indexOf("myAddr")>-1){var r=(i.id.indexOf("myAddr"),1*i.id.substring(i.id.length-1,i.id.length)),d=smpMgrStorer.getAll();return s.itemClick(d[r].uid,this.sgId),this.cs(),void util.preventDefault(l)}}if(-1==this.c)return this.cs(),this.tooFast=!0,setTimeout(this.setTooFast.bindAsEventListener(this),1e3),!0;if(this.ifSubmit)return this.tooFast=!0,setTimeout(this.setTooFast.bindAsEventListener(this),1e3),!0;if((0==this.qType||2==this.qType)&&this.c>-1&&null!=this.SD){var n=this.SD.s[this.c];if(this.callback&&""!=n.split("$")[3]&&(this.tooFast=!0,setTimeout(this.setTooFast.bindAsEventListener(this),1e3),"function"==typeof this.callback)){var o=this.T.getElementsByTagName("TR")[this.c].cells[3].childNodes[0],a=o&&o.nodeValue;this.callback(a,!0)}if(""!=n.split("$")[3])this.c=-1;else{this.enterQuery=!0;var h="";try{h=this.T.getElementsByTagName("TR")[this.c].cells[3].childNodes[0].nodeValue+this.T.getElementsByTagName("TR")[this.c].cells[2].childNodes[0].nodeValue}catch(l){h=this.T.getElementsByTagName("TR")[this.c].cells[3].innerHTML+this.T.getElementsByTagName("TR")[this.c].cells[2].innerHTML}"function"==typeof this.callback&&this.callback(this.T.getElementsByTagName("TR")[this.c].cells[3].innerHTML,!1),this.sendQuery(h)}}else this.enterQuery=!0,this.sendQuery();return this.cs(),util.preventDefault(l),!1}if((38==l.keyCode||40==l.keyCode)&&(this.mouseOnSug=!1,"none"!=this.S.style.display)){var u=this.T.rows;if(0==this.closeBol)var c=u.length-1;else var c=u.length;for(var g=0;c>g;g++)if("mo"==u[g].className){this.c=g;break}this.ct();var e;if(38==l.keyCode)if(0==this.c)this.I.value=this.specQuery1?this.queryWord:this.SD.q,this.c=-1,this.K=!0;else if(-1==this.c&&(this.c=c),e=u[--this.c],e.className="mo",e.id&&e.id.indexOf("myAddr")>-1){var r=(e.id.indexOf("myAddr"),1*e.id.substring(e.id.length-1,e.id.length)),d=smpMgrStorer.getAll(),p=d[r].uid.toString();s.itemClick(p,this.sgId,this.sgId,"sug")}else this.I.value=e.cells[2].childNodes[0].nodeValue;if(40==l.keyCode)if(this.c==c-1)this.I.value=this.specQuery1?this.queryWord:this.SD.q,this.c=-1,this.K=!0;else if(e=u[++this.c],e.className="mo",e.id&&e.id.indexOf("myAddr")>-1){var r=(e.id.indexOf("myAddr"),1*e.id.substring(e.id.length-1,e.id.length)),d=smpMgrStorer.getAll(),p=d[r].uid.toString();s.itemClick(p,this.sgId,this.sgId,"sug")}else this.I.value=e.cells[2].childNodes[0].nodeValue;this.isIE||l.preventDefault()}},docMouseDown:function(t){var s=this;_bdMapSuggest&&(s=_bdMapSuggest),e=t||window.event;var i=e.target||e.srcElement;if(i!=s.I){for(;i=i.parentNode;)if(i==s.S||i==s.I)return void(s.isClkSug=!0);0==s.timer3&&(s.timer3=setTimeout(s.cs.bindAsEventListener(s),200))}},docKeyDown:function(t){this.isGecko&&(e=t||window.event,e.ctrlKey&&(61==e.keyCode||107==e.keyCode||109==e.keyCode||96==e.keyCode||48==e.keyCode)&&this.resetSuggestion())},beforeDeaSuggest:function(){this.E&&(window.event.cancelBubble=!0,window.event.returnValue=!1,this.E=!1)},keyBlurSuggest:function(){this.isClkSug||0==this.timer3&&(this.timer3=setTimeout(this.cs.bindAsEventListener(this),200)),this.isClkSug=!1},creatSugDiv:function(){if(!this.GE("bdmap_sug_"+this.sgId)){var sugdiv=this.C("div");with(sugdiv)id="bdmap_sug_"+this.sgId,className="sug",position="absolute",onselectstart="return false",style.display="none",style.zIndex="200001";document.body.appendChild(sugdiv)}if(this.S=this.GE("bdmap_sug_"+this.sgId),this.isIE){var sug_if=this.C("IFRAME");with(sug_if.src="javascript:void(0)",sug_if.id="bdmap_sugif_"+this.sgId,sug_if.style)display="none",position="absolute";this.S.parentNode.insertBefore(sug_if,this.S)}if(3==this.qType){var nrtdiv=this.C("div");with(nrtdiv)id="noResTip"+this.sgId,className="sugtip",position="absolute",onselectstart="return false",style.display="none",style.zIndex="200";document.body.appendChild(nrtdiv)}},disposeSug:function(){clearTimeout(this.timer2),this.timer2=0,this.s1=this.I.value,clearInterval(this.timer1),this.GE("bdmap_sug_"+this.sgId)&&document.body.removeChild(this.GE("bdmap_sug_"+this.sgId)),this.GE("noResTip"+this.sgId)&&document.body.removeChild(this.GE("noResTip"+this.sgId)),this.isIE&&this.GE("bdmap_sugif_"+this.sgId)&&document.body.removeChild(this.GE("bdmap_sugif_"+this.sgId)),this.isIE&&this.GE("imgLogo")&&(this.GE("imgLogo").style.display="block",this.GE("imgLogo").style.display="")},getPos:function(t){for(var s=0,e=0;null!=t;)s+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return[s,e]},setTooFast:function(){this.tooFast=!1},initialize:function(t,s,e){try{this.callback=s,this.closeSuggest=e,this.sgId=t.inputid,this.cookieN=t.cookiename||"bdmapsug",this.cityId=t.cityid||modelConfig.cityCode,this.closeBol=t.closeB||0,this.qType=t.qType||0,this.nonResTip="抱歉，未找到相关的车站",this.offsetPos=t.offset||[0,0],this.offsetPos1=t.offset1||[0,0],this.closeTip=t.closeTip||0,this._sq=t._sq||!1,this.mouseOnSug=!1,this.queryWord="",this.ifSubmit=!1,this.S=null,this.enterQuery=!1,this.ifSend=!0,this.I=this.GE(t.inputid),this.I.value="",this.tooFast=!1,this.SD,this.CS=null,this.c=-1,this.K=!1,this.mouseOnSug=!1,this.specQuery1=!1,this.E=!1,this.isIE=-1!=navigator.userAgent.indexOf("MSIE")&&!window.opera,this.isWebKit=navigator.userAgent.indexOf("AppleWebKit/")>-1,this.isGecko=navigator.userAgent.indexOf("Gecko")>-1&&-1==navigator.userAgent.indexOf("KHTML"),this.timer3=0,this.T=null,this.s1="",this.s3="",this.timer1,this.timer2=0,this.isClkSug=!1,this.I.setAttribute("autocomplete","off"),this.creatSugDiv(),this.I.onblur=this.keyBlurSuggest.bindAsEventListener(this),this.I.onkeydown=this.keyDownSuggest.bindAsEventListener(this),document.onmousedown=this.docMouseDown.bindAsEventListener(this),document.onkeydown=this.docKeyDown.bindAsEventListener(this),this.I.onbeforedeactivate=this.beforeDeaSuggest.bindAsEventListener(this),this.s3=this.I.value,this.timer1=setInterval(this.f.bindAsEventListener(this),10),baidu(window).on("resize",this.resetPos.bindAsEventListener(this))}catch(i){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/ui/MapSuggest/MapSuggest.js",ln:999})}}};var CloseSuggestion=bdMapSuggest.prototype.closeSuggestion=function(){return Object({closeTime:null,showTip:function(t){var s=null;T.g("sugoff")?s=T.g("sugoff"):(s=document.createElement("div"),s.id="sugoff",s.className="mapsug_off_tip",s.onselectstart="return false",document.body.appendChild(s)),s.innerHTML="提示功能已关闭,您可以刷新页面(F5)再次启用";var e=this.getPos(t);s.style.left=1*e[0]-8+"px",s.style.top=1*e[1]-2+parseInt(t.offsetHeight)+"px",t.offsetWidth>=s.offsetWidth&&(s.style.width=t.offsetWidth+"px"),this.closeTime=setTimeout(function(){clearTimeout(CloseSuggestion.closeTime),T.g("sugoff")&&document.body.removeChild(T.g("sugoff"))},2500)},getPos:function(t){for(var s=0,e=0;null!=t;)s+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return[s,e]}})}();module.exports=bdMapSuggest});
;define("common:widget/ui/throughpoint/Throughpoint.js",function(t,e,n){var s=t("common:widget/ui/mapUtil/mapUtil.js"),a=t("common:widget/ui/util/util.js"),o=t("common:widget/ui/config/config.js"),r=o.modelConfig,p=(o.mapConfig,t("common:widget/ui/setMyPlace/SetMyPlaceMgr.js")),u={tpList:[],tpListInMap:[],status:"",support:function(t){return t||(t=this.curType),"3"==t},onContextMenu:function(){return this.canAddNewPoint()&&this.support()?!0:!1},highLightInput:function(t){for(var e,n=0;e=this.allInputs[n];n++)n==t?T.ac(e.parentNode,"inputHighLight"):T.rc(e.parentNode,"inputHighLight");t>0?this.showExtendPanel():(this.onfocusInput=null,this.hiddenOtherPoints())},clearHighLightInput:function(){if(this.allInputs)for(var t,e=0;t=this.allInputs[e];e++)T.rc(t.parentNode,"inputHighLight")},getReturnIcon:function(t){t||(t=this.curType);var e=3==t?"nav":"bus",n=this.ei;return n||(n=this.ei={}),n[e]||(n[e]=T.g(e+"ReturnIcon")),n[e]},state:"",onSwitchTab:function(t){if(this.curType!=t){this.curType=t;var e=this,n=T.g(3==t?"DriveSearchEndSpan":"BusSearchEndSpan");if(this.inputSpan=n,this._countDom&&(this._countDom.style.cssText=""),1!=t)if(e.support(t)){if(this.getTPPanel().parentNode==this.inputSpan.parentNode){this.adjustInputStyle(n.parentNode);var e=this;window.setTimeout(function(){e.displayTpCount()},100)}else this.adjustInputStyle(n.parentNode,!0);e.createAddTPointIcon(n,t);for(var i,s=0;i=this.tpList[s];s++)i.marker&&i.marker.show()}else{this.onfocusInput=null,this.hiddenOtherPoints();for(var i,s=0;i=this.tpList[s];s++)i.marker&&i.marker.hide();this.clearTpListInMap()}}},clearTpListInMap:function(){for(var t,e=0;t=this.tpListInMap[e];e++)t.marker&&map.removeOverlay(t.marker);this.tpListInMap=[]},addTPointByPoint:function(t){if("nav"==this.state){var e={point:t},n=this.tpListInMap.length;return this.tpListInMap.push(e),this.createMarkerByTp(e,n),s.getGEORevertAddress(t,function(t){u.addTPointCBK(t)}),void(this.needRaiseAdd=!0)}var e,i=this.tpList,n=0;if(!window.isPrint)if(0==i.length)this.createInputItem();else{for(;(e=i[n])&&this.isOnePointEnsured(e);n++);if(e)if(0==n)this.getTPPanel().parentNode!=this.inputSpan.parentNode&&this.createInputItem();else{var a=this.attachPanel().getElementsByTagName("input").length;n>a&&this.createInputItem()}else 5>n&&this.createInputItem()}if(5>n)e||(e=this.tpList[n]),e.query="未知路段",this.suggests[n].setValue(e.query),e.point=t,T.rc(this.allInputs[n],"tpInput_bg"),T.rc(this.allInputs[n],"tpInput_bg_focus"),s.getGEORevertAddress(t,function(t){u.addTPointCBK(t)}),this.createMarkerByTp(e,n),this.afterAddByPoint&&this.afterAddByPoint({tp:e,index:n}),this.displayTpCount();else{var o=this.createAddTPointIcon(this.inputSpan,this.curType);T.rc(o,"add_tpoint_icon_on"),T.ac(o,"add_tpoint_icon_disable"),T.un(o,"mouseover",this.addTPointIconHoverFunc)}addStat("navscheme.navscheme.addtp","click")},createMarkerByTp:function(t,e,n){if(isNaN(e)&&(e=T.array.indexOf(this.tpList,t)),t.point||t.rPoint){{var i=this.getIconByIndex(e),a=t.point?t.point:t.rPoint,o=baidu.encodeHTML(t.query);t.query?t.query:"途经点"+(e+1)}t.marker=new BMap.Marker(a,{icon:i,title:o}),map.addOverlay(t.marker),n||(t.marker.addEventListener("mouseover",function(){if("route"!=u.state){u.isOverTp=!0;var t=u;t.curSelMarker!=this&&t.getRemoveIconInMap(this)}else this.disableDragging()}),t.marker.addEventListener("mouseout",function(){u.isOverTp=!1,u.hideRemoveIconInMap()}),t.marker.addEventListener("dragend",function(t){""==u.state&&s.getGEORevertAddress(t.point,function(t){u.addTPointCBK(t)})}),t.marker.enableDragging())}return t.marker},hideRemoveIconInMap:function(){window.setTimeout(function(){var t=u;t.isOverTp||t.isOverIcon||(t.curSelMarker=null,map.removeOverlay(t.removeMarker))},200)},getRemoveIconInMap:function(t){var e;this.removeMarker&&map.removeOverlay(this.removeMarker),e=new BMap.Label("<div style='position:relative;'><div id='tppoint_remove_icon' class='tppoint_remove_icon' title='删除途经点'></div></div>",{offset:{width:40,height:-10}}),t.setLabel(e),this.curSelMarker=t,e.addEventListener("mouseover",function(){u.isOverIcon=!0}),e.setStyle({zIndex:25}),e.addEventListener("mouseout",function(){u.hideRemoveIconInMap(),u.isOverIcon=!1}),T.on("tppoint_remove_icon","click",function(){var t=u;if(map.removeOverlay(t.removeMarker),"nav"==t.state){if(t.curSelMarker){for(var e,n=a.getOverlayPoint(t.curSelMarker),i=0;e=t.tpListInMap[i];i++){var s=e.point?e.point:e.rPoint;if(s.lat==n.lat||s.lng==n.lng){t.tpListInMap.splice(i,1),t.onDeleteTp&&t.onDeleteTp({tp:e,index:i});break}}var o=t.createAddTPointIcon(t.inputSpan,t.curType);T.rc(o,"add_tpoint_icon_disable"),T.on(o,"mouseover",t.addTPointIconHoverFunc)}}else if(t.curSelMarker){var r=a.getOverlayPoint(t.curSelMarker),p=t.getTPAndIndexByPoint(r).index;t.removeItemByIndex(p),map.removeOverlay(t.curSelMarker)}t.onfocusInput=null,t.hiddenOtherPoints(!0),addStat("navscheme.navscheme.removetp","click")}),this.removeMarker=e},getTPAndIndexByPoint:function(t){t.lat=t.y?t.y:t.lat,t.lng=t.x?t.x:t.lng;for(var e,n={},i="nav"==this.state?this.tpListInMap:this.tpList,s=0;e=i[s];s++)if(e.marker){var o=a.getOverlayPoint(e.marker);o.lat==t.lat&&o.lng==t.lng&&(n.index=s,n.tp=e)}return n},getIconByIndex:function(t){return new BMap.Icon("../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/tpicon_ea18b98.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/tpicon_ea18b98.png*/,new BMap.Size(36,36),{imageOffset:new BMap.Size(-62-36*t,0)})},addTPointCBK:function(t){if(this.setSearchBox(),this.setValueByCBK=!0,window.setTimeout(function(){u.setValueByCBK=!1},50),t.content){var e=t.content,n=this.getTPAndIndexByPoint({x:t.result.x,y:t.result.y});if(n.tp){if(""===e.address&&(e.address="未知路段"),n.tp.query=e.address,"nav"!=this.state){var i=this.allInputs[n.index];this.suggests[n.index].setValue(n.tp.query),n.tp.marker&&n.tp.marker.setTitle(e.address),T.rc(i,"tpInput_bg"),T.rc(i,"tpInput_bg_focus")}this.afterAddByPoint&&this.needRaiseAdd&&(this.afterAddByPoint({tp:n.tp,index:n.index}),this.needRaiseAdd=!1)}}},addTPointIconHoverFunc:function(){T.ac(this,"add_tpoint_icon_on")},createAddTPointIcon:function(t,e){var n="addTPointIcon"+e,i=T.g(n);return i||(i=T.dom.create("span",{className:"add_tpoint_icon",title:"增加途经点",id:n}),i.style.width="21px",T.on(i,"mouseover",this.addTPointIconHoverFunc),T.on(i,"mouseout",function(){T.rc(this,"add_tpoint_icon_on")}),T.on(i,"mousedown",function(t){a.preventDefault(t)}),T.on(i,"click",function(t){addStat("indexheader.searchbox.addpassbypoints"),addStat("navscheme.navscheme.addtp","click"),u.createInputItem(!0),a.stopBubble(t)}),t.parentNode.insertBefore(i,t.nextSibling)),i},getTPPanel:function(){var t="tppoint_panel",e=T.g(t);return e||(e=T.dom.create("span",{id:t,className:"tppoint_panel"}),this.getRecycle().appendChild(e)),e},attachPanel:function(){var t="tppoint_panel_attach",e=T.g(t);return e||(e=T.dom.create("div",{id:t,className:"tppoint_panel_attach"}),document.body.appendChild(e),T.on(e,"click",function(t){a.stopBubble(t)})),e},removeItem:function(t){if(t){var e=t.getElementsByTagName("input")[0];this.removeItemByInput(e),addStat("navscheme.navscheme.removetp","click")}},removeItemByIndex:function(t){this.removeItemByInput(this.allInputs[t])},removeItemByInput:function(t){this.setSearchBox();var e=this.attachPanel(),n=baidu(e).find("input").get(),i=-1;if(t.value="",0==n.length)this.getRecycle().appendChild(t.parentNode),this.adjustInputStyle(null,!0);else{t.parentNode.parentNode==e&&(i=T.array(n).indexOf(t));for(var s,a=i;s=n[a+1];a++){var o;-1==a?(o=t,t.value=s.value):(o=n[a],n[a].value=s.value),""!=o.value&&(T.rc(o,"tpInput_bg_focus"),T.rc(o,"tpInput_bg"))}n[n.length-1].value="",this.getRecycle().appendChild(e.lastChild)}0==n.length&&(this.removeFirstRowOrderNumber(),this._countDom&&(this._countDom.style.cssText=""));var r=this.tpListInMap[i+1];this.tpListInMap.splice(i+1,1),u.onDeleteTp&&u.onDeleteTp({tp:r,index:i+1}),""==e.style.cssText&&this.displayTpCount();var p=this.createAddTPointIcon(this.inputSpan,this.curType);T.rc(p,"add_tpoint_icon_disable"),T.on(p,"mouseover",this.addTPointIconHoverFunc)},disposeOnePoint:function(t,e){t.query="",t.uid="",t.point="",t.addr="",t.cityCode="",t.rPoint="",t.marker&&!e&&map.removeOverlay(t.marker)},isOnePointEdit:function(t){return t.query||t.point||t.uid||t.addr},isOnePointEnsured:function(t){return t.point||t.addr||t.rPoint},addExtendItem:function(t,e){var n="tppoint_panel_"+e,i=T.g(n),s=this.allInputs[e];i||(i=this.createDomByHtml("<span id="+n+' class="tppoint_panel" style="width: 144px;_width:144px;margin:0px;background-color:#ffffff;"></span>')),t.appendChild(i),i.appendChild(s),this.addRemoveIcon(i),this.addOrderNumber(s,e),this.suggests[e]||this.bindMapSuggest(e)},getStyleWidth:function(t){var e=t.style.width;return parseInt(e.substr(0,e.length-2))},addOrderNumber:function(t,e){var n=this.createOrderNumber(e+1),i=this.getStyleWidth(t);n.parentNode!=t.parentNode&&(t.parentNode.appendChild(n),t.parentNode.style.paddingLeft=this.ORDERWIDTH+"px",t.parentNode.style.width=this.getStyleWidth(t.parentNode)-this.ORDERWIDTH+7+"px",t.style.width=0!=e?i-this.ORDERWIDTH+5+"px":"83px")},setTPPointBySmp:function(t,e){var n=T.g(t),i={point:a.getPoiPoint(e.point),query:e.note},s=0;s=T.array.indexOf(this.allInputs,n),s>=0&&this.insertTP(s,i)},FWIDTH:115,OWIDTH:148,ORDERWIDTH:27,bindMapSuggest:function(e){var n=this.allInputs[e];this.suggests||(this.suggests=[]);var s=4,a=8;T.browser.ie&&(s=3),7==T.browser.ie&&(a=7),cityCode=r.cityCode,this.tpList[e]||(this.tpList[e]={}),this.tpList[e].cityCode&&(cityCode=this.tpList[i].cityCode),this.tpList[e].query&&(this.setSearchBox(),n.value=this.tpList[e]);var o=this;t.async("common:widget/ui/MapSuggest/MapSuggest.js",function(t){o.suggests.push(new t({inputid:n.id,closeTip:1,offset1:[-s,0]},function(t){var e=this.I,n=u.tpList[T.array.indexOf(u.allInputs,e)];n.query=e.value,n.addr=t},function(){CloseSuggestion.showTip(n)}))})},removeFirstRowOrderNumber:function(){var t=this.allInputs[0],e=t.parentNode,n=this.createOrderNumber(1);n.parentNode==e&&(this.getRecycle().appendChild(this.createOrderNumber(1)),t.style.width=this.getStyleWidth(t)+this.ORDERWIDTH-5+"px",e.style.paddingLeft="",e.style.width=this.getStyleWidth(e)+this.ORDERWIDTH-7+"px")},getSearchableTpCount:function(){for(var t,e=0,n=0;t=this.tpList[n];n++)this.isOnePointEdit(t)&&e++;return e},displayTpCount:function(){this._countDom||(this._countDom=document.getElementById("ditu_tpm_count"),this._countDom||(this._countDom=this.createDomByHtml("<span class='ditu_tpm_count' id='ditu_tpm_count'></span>"),document.body.appendChild(this._countDom)));var t=this.getSearchableTpCount(),e=this.getTPPanel(),n=this.attachPanel(),i=n.getElementsByTagName("input");this._countDom.innerHTML=t;var s=T.dom.getPosition(e);return t>1&&i.length>0&&s.left>0?void(this._countDom.style.cssText="left:"+(s.left+145)+"px;top:"+(s.top-7)+"px"):void(this._countDom.style.cssText="")},hiddenOtherPoints:function(t){if(!this.onfocusInput){{var e=this.attachPanel();this.getTPPanel()}if(""==e.style.cssText&&!t)return;{var e=this.attachPanel();e.getElementsByTagName("input"),this.getTPPanel()}e.style.cssText="",3==this.curType&&this.displayTpCount(),t||this.removeFirstRowOrderNumber()}},getQueryParam:function(t){for(var e,n=[],i=0;e=this.tpList[i];i++)this.isOnePointEdit(e)&&("function"==typeof t&&t(),n.push(this.getTPointQueryParam(e)));return n.join("")},isAllPointSure:function(t){for(var e,n=(t?5:this.tpList.length,0);e=this.tpList[n];n++)if(this.isOnePointEdit(e)&&!this.isOnePointEnsured(e))return!1;return!0},canAddNewPoint:function(){if(this.tpList.length<5)return!0;if("nav"==this.state){if(this.tpListInMap.length<5)return!0}else for(var t=0;5>t;t++){var e=this.tpList[t];if(!this.isOnePointEnsured(e))return!0}return!1},getCityCode:function(){for(var t,e=[],n=r.cityCode||1,i=0;t=this.tpList[i];i++)this.isOnePointEdit(t)&&e.push(n+"+to:");return e.join("")},getTPointQueryParam:function(t,e){var n=2,i="",s="",a="",o="0",r="",p="",u="1";return(t.point||t.rPoint)&&(n=1,s=t.point?t.point.lng+","+t.point.lat:t.rPoint.lng+","+t.rPoint.lat,t.uid&&(n=2,i=t.uid)),t.query&&(a=encodeURIComponent(t.query)),t.addr&&(o="1",r=encodeURIComponent(t.addr)),isNaN(e)||(n=e),n+"$$"+i+"$$"+s+"$$"+a+"$$"+o+"$$"+r+"$$"+p+"$$"+u+"$$+to:"},addRemoveIcon:function(t){var e=t.getElementsByTagName("input")[0],n=document.getElementById("i_"+e.id),i=t==this.getTPPanel();n||(n=this.createDomByHtml('<span class="tppoint_remove" id="i_'+e.id+'"" title="删除途经点" ></span>'),i&&(n.style.right="19px"),e.style.width=i?this.getStyleWidth(e)-8+"px":this.getStyleWidth(e)-25+"px"),t.appendChild(n);var s=this;baidu("#i_"+e.id).off("click"),baidu("#i_"+e.id).on("click",function(t){s.removeItem(this.parentNode),t.stopPropagation()})},createInputBox:function(){if(this.allInputs||(this.allInputs=[]),(l=this.allInputs.length)<5){var t=T.dom.create("input",{type:"text",className:"tpInput tpInput_bg",autoComplete:"off",_from:"onway",maxLength:"256",id:"onway_"+(l+1)});this.allInputs.push(t),T.on(t,"focus",function(){u.onfocusInput=this,""==this.value&&T.ac(this,"tpInput_bg_focus"),u.showExtendPanel()}),T.on(t,"mouseover",function(){u.imTimer||(u.imTimer=window.setTimeout(function(){u.showExtendPanel(),u.imTimer=null},100))}),T.on(t,"blur",function(){u.onfocusInput=null,""==this.value&&(T.rc(this,"tpInput_bg_focus"),T.ac(this,"tpInput_bg"))}),t.style.width=0==l?this.FWIDTH+"px":this.OWIDTH+"px";var e=function(t){var e=!t.propertyName||"value"==t.propertyName;if(e){var n=u,i=t.srcElement?t.srcElement:t.target,s=n.tpList[T.array.indexOf(n.allInputs,i)];n.onfocusInput==i&&n.disposeOnePoint(s),s.addr="",""==i.value?i==n.onfocusInput?T.ac(i,"tpInput_bg_focus"):T.ac(i,"tpInput_bg"):(T.rc(i,"tpInput_bg"),T.rc(i,"tpInput_bg_focus"http://webmap0.map.bdstatic.com/newmap/static/common/pkg/)),s.query=i.value}};T.browser.ie?t.attachEvent("onpropertychange",e):T.on(t,"input",e)}},setInputValue:function(t,e){var n=this.allInputs[t];""!=e?(T.rc(n,"tpInput_bg"),T.rc(n,"tpInput_bg_focus")):T.ac(n,"tp_Input_bg"),this.suggests[t].setValue(e)},getRecycle:function(){return this._recycle||(this._recycle=document.getElementById("ditu_tpm_recycle"),this._recycle||(this._recycle=T.dom.create("div",{id:"ditu_tpm_recycle"}),this._recycle.style.display="none",document.body.appendChild(this._recycle))),this._recycle},createDomByHtml:function(t){if(!this._fragment){var e=document.createDocumentFragment(),n=document.createElement("div");e.appendChild(n),this._fragment=n}return this._fragment.innerHTML=t,this._fragment.childNodes[0]},createInputItem:function(t){var e=this.getTPPanel(),n=this.inputSpan.parentNode;if(this.createInputBox(),e.parentNode!=n){if(n.insertBefore(e,this.inputSpan),0==e.childNodes.length){e.appendChild(this.allInputs[0]);var n=e.parentNode;this.bindSmpPlace(this.allInputs[0]),this.suggests&&this.suggests[0]||this.bindMapSuggest(0),t?(this.allInputs[0].focus(),this.onfocusInput=this.allInputs[0]):this.onfocusInput=null}this.adjustInputStyle(n),this.addRemoveIcon(e)}else{var i=this.attachPanel(e),s=i.getElementsByTagName("input"),a=s.length;if(4>a&&(a++,this.addExtendItem(i,a)),t?(this.showExtendPanel(e),this.allInputs[a].focus(),this.onfocusInput=this.allInputs[a]):(this.onfocusInput=null,this.hiddenOtherPoints(!0)),a>=4){var i=this.createAddTPointIcon(this.inputSpan,this.curType);T.rc(i,"add_tpoint_icon_on"),T.ac(i,"add_tpoint_icon_disable"),T.un(i,"mouseover",this.addTPointIconHoverFunc)}}},showExtendPanel:function(t){t||(t=this.getTPPanel());var e=T.dom.getPosition(t),n=this.attachPanel(),i=this.allInputs[0];""==n.style.cssText&&0!=n.getElementsByTagName("input").length&&(this.addOrderNumber(i,0),e.left>0&&(n.style.cssText="width:160px;height:"+30*length+"px;left:"+e.left+"px;top:"+(e.top+31)+"px;_top:"+(e.top+33)+"px;"),this._countDom&&(this._countDom.style.cssText=""),this.hasBindBodyClick||(this.hasBindBodyClick=!0,T.on(document.body,"click",function(){u.hiddenOtherPoints()}),map.addEventListener("mousedown",function(){u.hiddenOtherPoints()})))},bindSmpPlace:function(t){var e=this.createDomByHtml('<span class="smp_navt_btn" style="right:1px;" title="常用地点"></span>');T.dom.insertAfter(e,t),baidu(".smp_navt_btn").on("click",function(e){p.openList(t.id,e)})},createOrderNumber:function(t){var e=document.getElementById("tp_point_order_"+t);return e?e:this.createDomByHtml("<span class='tppoint_order' id='tp_point_order_"+t+"'>"+t+"</span>")},adjustInputStyle:function(t,e){t||(t=this.inputSpan.parentNode);var n=e?"search_input_tp":"search_input_tp_explode",i=e?"width:192px;":"width:144px",s=e?"170px":"115px",a=e?"460px":"487px",o=e?"0":"4",r=T.g("MaptoDown_tip");r&&(T.g("MaptoDown_tip").style.left=e?"742px":"772px"),baidu.dom.hasClass(t,"drive_flag")?(baidu.dom.setStyle(t,"width",a),baidu.dom.setStyle(t,"z-index",o),t.parentNode.className=n):t.className=n;for(var p,u=0;p=t.childNodes[u];u++)if(p.getElementsByTagName){var d=p.getElementsByTagName("input");d.length>0&&(p.style.cssText=i,d[0].style.width=s)}this.getReturnIcon().style.display=e?"":"none",e&&this._countDom&&(this._countDom.style.cssText="")},reset:function(){try{this.onfocusInput=null,this.hiddenOtherPoints();for(var t,e=0;t=this.tpList[e];e++)this.disposeOnePoint(t),this.tpList[e]={},this.allInputs[e]&&(this.allInputs[e].value="",T.ac(this.allInputs[e],"tpInput_bg"),this.getRecycle().appendChild(this.allInputs[e].parentNode));this.getRecycle().appendChild(this.getTPPanel()),u.clearTpListInMap(),this.adjustInputStyle(null,!0)}catch(n){console.log("TPM reset:",n)}},insertTP:function(t,e){if(!window.isPrint){var n=T.extend({},e);if(this.tpList.length>t)if(this.tpList[t]=e,t>0){var i=this.attachPanel(),s=i.getElementsByTagName("input");s.length<t&&this.createInputItem()}else{var a=this.getTPPanel(),o=this.inputSpan.parentNode;a.parentNode!=o&&this.createInputItem()}else{if(this.tpList.length!=t)return;this.tpList.push(e),this.createInputItem()}this.tpList[t]=n,this.setInputValue(t,this.tpList[t].query),this.displayTpCount()}},setSearchBox:function(){var e=t("common:widget/ui/searchBox/searchBox.js");e.notShowSuggest.run()}};n.exports=u});
;define("common:widget/ui/searchInfoWindow/searchInfoWindow.js",function(e,i,t){var n=e("common:widget/com/componentManager.js"),a=e("common:widget/ui/util/util.js"),o=e("common:widget/ui/constant/Constant.js"),s=(e("common:widget/ui/searchBox/searchBox.js"),e("common:widget/ui/signMgr/signMgr.js")),r=(e("common:widget/ui/mapInfo/mapInfo.js"),e("common:widget/ui/mapUtil/mapUtil.js")),d=e("common:widget/ui/indexUtil/IndexUtil.js"),c=e("common:widget/ui/sms/sms.js"),l=e("common:widget/ui/config/config.js"),p=e("common:widget/pano/PanoInterface/PanoInterface.js"),u=l.modelConfig,h=(l.mapConfig,l.urlConfig),f={content:null,opts:null,queryWd:"",iwExt:null,iwOpts:null,rangeSearchCenterMarker:null,addRangeSearchCenterPoi:function(e,i,t,n){this.rangeSearchCenterMarker&&(this.rangeSearchCenterMarker.remove(),this.rangeSearchCenterMarker=null);var s=a.getPoiPoint(e);if(s){var r=new BMap.Icon(o.A_J_MARKER_IMG,o.A_J_MARKER_BLUE_SIZE,{offset:o.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-68,-156),infoWindowOffset:o.A_J_MARKER_INFOWND_OFFSET}),d=n||25e5,c=new BMap.Marker(s,{icon:r,zIndexFixed:!0,baseZIndex:d});return map.addOverlay(c),c._stCode=o.OVERLAY_STYLE.MKR_RCTR,t||(this.rangeSearchCenterMarker=c),i&&c.setTitle(i),c}},createSearchInfoWnd:function(e,i){this.content=e,this.opts=i||{};var t=e.title,n=e.addr,a=e.desc,r=e.blinfo,d=e.tel&&e.tel.replace(/(,|;)/gi,", "),c=e.uid||"",l=e.poiType||o.POI_TYPE_NORMAL,p=e.hasDetail,f=e.ext,_=e.transUid,w=e.mingpian,m=f&&f.pic_info?f.pic_info:[],g=e.userSign||0,v=e.fav||0,b=e.content,S=(e.bizType,i.tabIndex),y=window.place?window.place.placeRe:"",C=(window.place?window.place.placeConfig:"",window.place?!!f&&f.src_name:""),I="cater"===C,x=e.origin_id&&e.origin_id.overview_guid?e.origin_id.overview_guid:"",k=e.catId,P="",R="",M="",B=this,G=e.pano||0,E=e.indoor_pano||0,O=("undefined"==typeof e.pano_index?-1:e.pano_index,e.wd||"",e.street_id||"");m.length>0&&m[0].pics&&(m=f.pic_info[0].pics),i||(i={});var N=i.cityCode||u.cityCode,j=["","",""],U=["none","none","none"];if(void 0!==S&&U[S]?(j[S]="hover",U[S]="block"):(j[1]="hover",U[1]="block"),!t)return null;var L=!!f;if(L)switch(f.src_name){case"ctrip_hotel":break;case"ctrip_site":L=!1;break;case"dianping":L=!1;break;case"house_new":break;case"house_ershou":break;case"biaozhu_data":}this.hasDetailPage=y?!(!f||!y.test(C)):"";var A=t;l==o.POI_TYPE_BUSSTOP?A+="-公交车站":l==o.POI_TYPE_SUBSTOP&&(A+="-地铁站"),P=A,A.replace(/[\u0100-\uffff]/g,"##").length>30&&(A=A.substring(0,14)+"...");var D=0;if(f&&f.detail_info){var W=f.detail_info;W.premium2&&"[object Array]"==Object.prototype.toString.call(W.premium2)&&W.premium2.length&&(D=1)}var F="<p class='iw_poi_title "+(I?"cater_title":"")+"' title='"+t+"'>";if(F+="<span class='susIconSetFlag'></span>",I||p||!i.hideDetail&&(l==o.POI_TYPE_BUSLINE||l==o.POI_TYPE_SUBLINE)){var $=I?20:25,Y=I?9:11;A.replace(/[\u0100-\uffff]/g,"##").length>$&&(A=A.substring(0,Y)+"...");var q="";if(y&&f&&("biaozhu_data"==f.src_name||y.test(C))){var z="详情";if("biaozhu_data"==f.src_name&&(""!=f.detail_info[1].description||f.youhui_info.length>0&&(""!=f.youhui_info[0].info||2==f.youhui_info[0].date.length)||m.length>0))F+=A;else{var H=f.detail_info,X=H&&(H.pc_bookable||H.di_review_keyword||H.groupon_num||H.premium_flag);if(F+="cater"==f.src_name?"<a  href='javascript:void(0)' class='title' onclick='addStat(\"poiinfowin.poi.title\");place.showDetail(\""+c+'", '+l+", "+N+', "'+f.src_name+'","Page","Iw");return false;\'>'+A+"</a>":"<a  href='javascript:void(0)' class='title' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "'+f.src_name+'","Page","Iw");return false;\'>'+A+"</a>",y.test(C)){var V=(C.toUpperCase()+"_","");"hospital"==C&&e.business_id&&(V=e.business_id),"cater"==C?X&&(F+="<a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "'+f.src_name+'","Page","Iw"'+(V?',false,"'+V+'"':"")+');addStat("poiinfowin.poi.detail");'+q+"return false;'>"+z+"&raquo;</a>"):F+="<a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "'+f.src_name+'","Page","Iw"'+(V?',false,"'+V+'"':"")+");"+q+"return false;'>"+z+"&raquo;</a>"}else F+="<a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "'+f.src_name+'","Page","Iw");'+q+"return false;'>"+z+"&raquo;</a>"}}else F+="<a href='javascript:void(0)' class='title' onclick='place.showDetail(\""+c+'", '+l+", "+N+");return false;'>"+A+"</a>",F+="<a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+");"+q+"return false;'>详情&raquo;</a>"}else F+=A;F+="</p>";var J=[],K="";if(g&&(K='style="display:none;"'),I)J.push("<div class='cater_poi_conTop'"+K+">"),J.push(place.caterPopInner.contentHtml(e,N)),J.push("</div>");else{if(J.push("<div class='iw_poi_conTop'"+K+">"),G){var Q=i&&i.isFromMPC?O:c;J.push("<div class='panoInfoBox' title='"+t+"外景' title='查看全景' >");var Z=h.PANO_URL+"/pr/?qt=poiprv&uid="+Q+"&width=323&height=101&quality=80&fovx=250";J.push("<img class='pano_thumnail_img' width=323 height=101 border='0' alt='"+t+"外景' src='"+Z+"' id='pano_"+c+"'/>"),J.push("<div class='panoInfoBoxTitleBg'></div><a href='javascript:void(0)' class='panoInfoBoxTitleContent' >进入全景&gt;&gt;</a>"),J.push("</div>"),E&&J.push("<a href='javascript:void(0)' title='"+t+"内景' class='panoInfoBoxInner' >"+ei+"内景</a>")}if(!G&&E){J.push("<div class='panoInfoBox' title='"+t+"内景' title='查看内景' >");var Z=E;J.push("<img class='pano_thumnail_img' width=323 height=101 border='0' alt='"+t+"内景' src='"+Z+"' id='pano_"+c+"'/>"),J.push("<div class='panoInfoBoxTitleBg'></div><a href='javascript:void(0)' class='panoInfoBoxTitleContent' >进入全景&gt;&gt;</a>"),J.push("</div>")}if(window.place&&J.push(place.initAlert(e)),L&&f.pic&&f.pic.length>0&&f.pic[0]&&J.push("<div style='float:right;width:70px;height:70px;overflow:hidden;display:inline' title='"+t+"'><img border='0' alt='"+t+"' src='"+f.pic[0]+"'/></div>"),L&&f.src_name&&("biaozhu_data"==f.src_name&&"1"==f.yw_type&&m.length>0&&m[0].minurl||y&&y.test(f.src_name)&&f.detail_info&&f.detail_info.image)){var ei="",ii="",ti=106,ni=104,ai=71,oi=69,si="",ri="",di="ISHOP_INFO_IMG",ci="";if(this.createSearchInfoWnd.iwImgLoading=1,"biaozhu_data"==f.src_name?(ei=m[0].title,ii=m[0].minurl):(ei=t,ti=106,ni=104,ai=71,oi=69,si=" style='border:#bdbdbd solid 1px'",ii=f.detail_info.image,di=f.src_name,ci="Page_Pic",ri=";text-align:center"),/sina|soufun/i.test(ii)&&(ii+="?"),!G&&!E){if(J.push("090300"==e.catId?"<div style='float:right;width:"+ti+"px;height:"+ai+"px;display:none"+ri+"' title='"+ei+"'>":"<div style='float:right;width:"+ti+"px;height:"+ai+"px;display:inline"+ri+"' title='"+ei+"'>"),y&&y.test(f.src_name)){{C.toUpperCase()+"_"}J.push("<a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "'+di+'", "'+ci+'","Iw");return false;\'\'>')}else J.push("<a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "'+di+'", "'+ci+'","Iw");return false;\'\'>');var li="http://webmap3.map.bdimg.com/maps/services/thumbnails?width="+ni+"&height="+oi+"&align=center,center&src="+encodeURIComponent(ii);J.push("<img tid='iw_poi_img' width='"+ni+"' height='"+oi+"' border='0'"+si+" alt='"+ei+"' src='"+li+"' id='detail_"+c+"'/>"),J.push("</a>"),J.push("</div>")}6==T.browser.ie&&(this.createSearchInfoWnd.iwImgLoadingSum=0,this.createSearchInfoWnd.iwImgLoadingTimer&&clearInterval(this.createSearchInfoWnd.iwImgLoadingTimer),this.createSearchInfoWnd.iwImgLoadingTimer=setInterval(function(){B.createSearchInfoWnd.iwImgLoadingSum>=100&&(clearInterval(B.createSearchInfoWnd.iwImgLoadingTimer),B.createSearchInfoWnd.iwImgLoadingSum=0),B.createSearchInfoWnd.iwImgLoading&&T.G("detail_"+c)&&(T.G("detail_"+c).src=ii,B.createSearchInfoWnd.iwImgLoadingSum++)},100))}var pi=25;if(L&&f&&f.title_link?J.push("<div class='iw_poi_content iw_poi_content_search' style='width:220px'>"):L&&f&&("biaozhu_data"==f.src_name&&m.length>0||y&&y.test(f.src_name)&&f.detail_info&&f.detail_info.image&&"090300"==!e.catId)?J.push("<div class='iw_poi_content iw_poi_content_search' style='width:214px;'>"):(J.push("<div class='iw_poi_content iw_poi_content_search'>"),pi=35),f&&"biaozhu_data"==f.src_name){if(J.push("<div>"),f.detail_info&&f.detail_info.length>0){if(f.detail_info[0].city.length>0){var ui=f.detail_info[0],hi=ui.city[0].replace(/\d+\-/g,"");("北京市"==hi||"重庆市"==hi||"上海市"==hi||"天津市"==hi||"澳门特别行政区"==hi||"香港特别行政区"==hi)&&(ui.city[0]="");var fi=ui.city.join("").replace(/\d+\-/g,"");J.push(fi)}""!=f.detail_info[0].street&&J.push(f.detail_info[0].street),""!=f.detail_info[0].address&&J.push(f.detail_info[0].address)}if(J.push("</div>"),f.detail_info&&f.detail_info.length>0&&f.detail_info[0].tels.length>0)for(var _i=0,wi=f.detail_info[0].tels.length;wi>_i;_i++)2!=f.detail_info[0].tels[_i].type&&J.push("<div>"+f.detail_info[0].tels[_i].no+"</div>");if(""!=f.detail_info[0].website&&J.push("<div><a style='color:#A49FD1' target='_blank' href='"+f.detail_info[0].website+"'>"+T.string.subByte(f.detail_info[0].website,pi,"...")+"</a></div>"),"1"==f.yw_type){if(f.youhui_info.length>0&&(""!=f.youhui_info[0].date||""!=f.youhui_info[0].info||f.youhui_info[0].pics.length>0)){J.push("<div>优惠信息：</div>");var mi="http://map.baidu.com/ishop/detail.html?newmap=1&s="+encodeURIComponent("inf&uid="+c+"&c="+N+"&newmap=1")+"#speresult";J.push("<div><a target='_blank' style='color:#A49FD1' href='"+mi+"'>"+T.string.subByte(mi,pi,"...")+"</a></div>")}(""!=f.detail_info[1].description||f.youhui_info.length>0&&(""!=f.youhui_info[0].info||f.youhui_info[0].date.length>0||f.youhui_info[0].pics.length>0)||m.length>0)&&J.push("<div style='margin-top:3px;'><a href='javascript:void(0)' onclick='place.showDetail(\""+c+'", '+l+", "+N+', "ISHOP_INFO");return false;\'>更多详情&raquo;</a></div>')}}else if(n)if(l==o.POI_TYPE_BUSSTOP||l==o.POI_TYPE_SUBSTOP){if(J.push("<p>车次："),r){for(var gi=[],_i=0,vi=r.length;vi-1>_i;_i++)if(!baidu.array.contains(gi,r[_i].addr)){var bi="s&wd="+r[_i].addr+"&c="+u.cityCode,Si=encodeURIComponent(bi.replace(/&b=\((-?\d+)(\.\d+),(-?\d+)(\.\d+);(-?\d+)(\.\d+),(-?\d+)(\.\d+)\)/gi,"")),yi="?newmap=1&shareurl=1&s="+Si;J.push('<a class="detail blueA" tid="poiDetail_'+_i+'" target="_blank" href="'+yi+'" >'+r[_i].addr+"; </a>"),gi.push(r[_i].addr)}if(!baidu.array.contains(gi,r[_i].addr)){var bi="s&wd="+r[vi-1].addr+"&c="+u.cityCode,Si=encodeURIComponent(bi.replace(/&b=\((-?\d+)(\.\d+),(-?\d+)(\.\d+);(-?\d+)(\.\d+),(-?\d+)(\.\d+)\)/gi,"")),yi="?newmap=1&shareurl=1&s="+Si;J.push('<a class="detail blueA" tid="poiDetail_'+vi+'" href="'+yi+'" >'+r[vi-1].addr+"</a>")}}else n&&J.push(n);J.push("</p>"),R=(l==o.POI_TYPE_BUSSTOP?"途经公交：":"途经地铁：")+n}else J.push('<table cellspacing="0" class="table_addr_tel"><tr tid="iw_poi_addr"><th>地址：&nbsp;</th><td>'),J.push(n+"&nbsp;</td></tr>"),R=n,d&&(J.push('<tr tid="iw_poi_tel"><th>电话：&nbsp;</th><td>'+d+"</td></tr>"),M=d),J.push("</table>");else d&&(J.push('<table cellspacing="0" class="table_addr_tel">'),n&&J.push('<tr tid="iw_poi_addr"><th>地址：&nbsp;</th><td>'+n+"</td></tr>"),J.push('<tr tid="iw_poi_tel"><th>电话：&nbsp;</th><td>'+d+"</td></tr>"),M=d,J.push("</table>"));if(a&&J.push("<p>"+a+"</p>"),window.place&&f&&y.test(f.src_name)&&(J.push(window.place.generatePlaceIwTopInfo({ext:f,uid:c,poiType:l,cityCode:N,catId:k})),d&&(d=d.replace("、","<br />"))),L&&f&&f.title_link){var Ci=["<p style='margin-top:2px'>"];if(f.title_link)for(var _i=0,vi=f.title_link.length;vi>_i;_i++)Ci.push("<a class='ns_link' href='"+f.title_link[_i].link+"' target='_blank' >"+f.title_link[_i].title+"</a>"),_i<f.title_link.length-1&&Ci.push("&nbsp;&nbsp;");J.push(Ci.join("")),J.push("</p>")}J.push("</div>"),w&&J.push("<p>"+w+"</p>"),window.place&&(f&&f.detail_info&&y.test(f.src_name)&&J.push(window.place.generatePlaceIwBottomInfo({ext:f,uid:c,poiType:l,cityCode:N,categoryId:k})),f&&window.place&&y.test(f.src_name)&&J.push(window.place.generateAsyncBookPrice({ext:f,uid:c,poiType:l,cityCode:N})),window.place&&f&&f.detail_info&&f.detail_info.book_info&&"undefined"!=typeof f.detail_info.movie_film_count&&J.push(window.place.generateAsyncBookByMovie({uid:c,poiType:l,category:f.src_name,cityCode:N}))),J.push("<div class='iw_btn_con suspendContainer'></div>"),J.push("<div class='iw_btn_con'>"),"undefined"!=typeof e.ext_type&&1&e.ext_type&&J.push('<span class="inr_iw" onmouseover="this.className=\'inr_iw_on\'" onmouseout="this.className=\'inr_iw\'" onmousedown="this.className=\'inr_iw_down\'" onmouseup="this.className=\'inr_iw_on\'"  title="查看室内地图"></span>'),J.push("</div>"),J.push("</div>")}if(g||c||i.smp){if(g?(J.push('<div id="userSignContent">'+b+"</div>"),J.push('<div id="userSignCtrl" class="userShowCtrl" >')):J.push('<div id="userSignCtrl" class="userShowCtrl" data-nosign="true" >'),J.push('<div class="ctrl">'),e.jiucuofr){e.jiucuofr}else;g&&!v?(J.push('<span class="edit"><b  class="sign_edit" title="修改"></b></span>'),J.push('<span class="delete"><b class="sign_del" title="删除此点"></b></span>')):i.smp&&(J.push('<span class="edit"><b class="smp_edit" title="修改"></b></span>'),J.push('<span class="delete"><b class="smp_del" title="删除此点"></b></span>'));var Ti="";if((s._USERSHARE||!g)&&!i.smp){var Ii="",xi="",ki="shareBtn_u  fuck";g||(Ii="onmouseover=\"T.ac(this,'span_focus')\" onmouseout=\"T.rc(this,'span_focus')\"",xi="分享",ki="shareBtn fuck");{i.x+" "+i.y}Ti='<span class="'+ki+'" '+Ii+' title="将此点在图区上的位置分享给好友"><b></b>'+xi+"</span>",s._USERSHARE&&g&&J.push(Ti)}I&&G&&J.push('<span class="pano-box"><a class="panoBtn" href="javascript:;" title="全景"><b class="pano" title="全景" style="cursor:pointer;"></b></a></span>');var Pi,Ri="";if(s._USERFAV){var Mi=t.replace(/\"/g,"&quot;"),Bi=[];n?Bi.push(l==o.POI_TYPE_BUSSTOP||l==o.POI_TYPE_SUBSTOP?"车次:"+n+"<br/>":"地址:"+n+"<br/>"):b&&Bi.push(b),d&&Bi.push("电话:"+d);var Gi=Bi.join("").replace(/\"/g,"&quot;"),Ei=window.parseFloat(i.x)+"|"+window.parseFloat(i.y),Oi={point:Ei,uid:c,cityCode:N,title:Mi,content:Gi,panoGuid:x},Ni=/'/g;Ni.test(n)&&(n=n.replace(Ni," "),Gi=Gi.replace(Ni," ")),g?(Pi={userSign:g,isfav:v,json:Oi},J.push('<span class="fav" id="JiwFav" data-title=\''+Mi+"' data-cont='"+Gi+'\' title="加入收藏夹"><b></b></span>')):(Pi={json:Oi},J.push('<span class="fav" id="JiwFav" data-title=\''+Mi+"' data-cont='"+Gi+"' uid=\""+c+'" title="加入收藏夹"><b></b></span>'))}!g&&c&&J.push("<span class='send_telf'><b  title=\"免费发送到手机\"></b></span>"),!g&&c&&J.push('<span><a class="sms_jiucuo"  href="http://i.map.baidu.com/api/page/poicorrect/addpoiproblempc?business_trigger=11&poi_uid='+c+'" target="_blank"><b class="jiucuo" title="纠错" style="cursor:pointer;"></b></a></span>'),g||(J.push("<span id='iw_tool_icon' class='box' onmouseover=\"this.className='box box_on';T.g('iw_tool_box').style.top=''\"><b></b>"),J.push('<div class="iw_tool_box" id="iw_tool_box" style="top:-2000px">'),Ri='<span id="JiwFav" class="point"  data-title=\''+Mi+"' data-cont='"+Gi+'\' onmouseover="T.ac(this,\'span_focus\')" onmouseout="T.rc(this,\'span_focus\')" title="将此点的位置标记在地图上"><b></b>标记</span>',J.push(Ri),J.push(Ti),J.push('<span class="sicon08 carIcon" onmouseover="T.ac(this,\'span_focus\')" onmouseout="T.rc(this,\'span_focus\')"  title="发至汽车"><b></b>发至汽车</span>'),J.push("</div></span>")),J.push("</div>"),J.push('<div class="share" id="iw_share_con" style="display:none">'),J.push("</div>"),J.push("</div>")}J.push("<div class='iw_poi_inter' id='iw_poi_inter'>");var ji="../images/transparent.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/transparent.gif*/;J.push("<ul class='nav_tab "+(I?"cater_tab":"")+"'>"),J.push("<li id='nav_tab0' data-tab='0' class='second blueA "+j[1]+"' ><img src='"+ji+"'>到这里去</li>"),J.push("<li id='nav_tab1' data-tab='1' class='first blueA "+j[2]+"' ><img src='"+ji+"'>从这里出发</li>"),J.push("<li id='nav_tab2'  data-tab='2'  class='third blueA "+j[0]+"' ><img src='"+ji+"'>在附近找</li>"),J.push("</ul>"),J.push("<div id='iw_tab0' class='nav_tab_content' style='display:"+U[1]+"'>"),J.push("<form id='iw_s_frm'>"),J.push("<div style='white-space:nowrap;'><span class='lef'>起点</span><span id='iw_ssnSpan' class='iw_txt_wrap'><input id='iw_ssn' type='text' size='22' maxlength='100' autocomplete='off' /><span class='smp_iws_btn' title='常用地点' ></span></span>"),J.push("<input id='iw_ssb_btn' type='submit' value='公交' class='iw_bt' onmouseover='this.className=\"iw_bt_over\"' onmouseout='this.className=\"iw_bt\"' onmousedown='this.className=\"iw_bt_down\"' onmouseup='this.className=\"iw_bt_over\"' />"),J.push("<input id='iw_ssd_btn' type='button' class='iw_bt' value='驾车' onmouseover='this.className=\"iw_bt_over\"' onmouseout='this.className=\"iw_bt\"' onmousedown='this.className=\"iw_bt_down\"' onmouseup='this.className=\"iw_bt_over\"' /></div>"),J.push("</form></div>"),J.push("<div id='iw_tab1' class='nav_tab_content' style='display:"+U[2]+"'>"),J.push("<form id='iw_e_frm'>"),J.push("<div style='white-space:nowrap;'><span class='lef'>终点</span><span id='iw_esnSpan' class='iw_txt_wrap'><input id='iw_esn' type='text' size='22' maxlength='100' autocomplete='off'/><span class='smp_iwe_btn' title='常用地点' ></span></span>"),J.push("<input id='iw_esb_btn' type='submit' value='公交' class='iw_bt' onmouseover='this.className=\"iw_bt_over\"' onmouseout='this.className=\"iw_bt\"' onmousedown='this.className=\"iw_bt_down\"' onmouseup='this.className=\"iw_bt_over\"'/>"),J.push("<input id='iw_esd_btn' type='button' value='驾车' class='iw_bt' onmouseover='this.className=\"iw_bt_over\"' onmouseout='this.className=\"iw_bt\"' onmousedown='this.className=\"iw_bt_down\"' onmouseup='this.className=\"iw_bt_over\"' /></div>"),J.push("</form></div>"),J.push("<div id='iw_tab2' class='nav_tab_content' style='white-space:nowrap;display:"+U[0]+"'>"),J.push("<div class='iw_cate_list'>");var Ui=["酒店","餐馆","银行","医院","公交站"];if(i&&i.isFromMPC)var Li=1;else var Li=0;if(c)for(var _i=0,vi=Ui.length;vi>_i;_i++)J.push(0==_i?this.generateSingleLink(Ui[_i],c,"",N,!0,i.x+", "+i.y,Li):this.generateSingleLink(Ui[_i],c,"",N,!1,i.x+", "+i.y,Li));else for(var _i=0,vi=Ui.length;vi>_i;_i++)J.push(0==_i?this.generateSingleLinkForRange(Ui[_i],i.x+","+i.y,"",N,!0,null,i.statCode||0,Li,g):this.generateSingleLinkForRange(Ui[_i],i.x+","+i.y,"",N,!1,null,i.statCode||0,Li,g));if(J.push("</div>"),J.push("<div class='iw_cate_form'>"),J.push("<form  class='info_form' >"),J.push("<input id='rangekw' type='text' size='19' maxLength='100' autocomplete='off' /> "),J.push("<input tid='iwNSBtn' type='submit' value='搜索' class='iw_bt' onmouseover='this.className=\"iw_bt_over\"' onmouseout='this.className=\"iw_bt\"' onmousedown='this.className=\"iw_bt_down\"' onmouseup='this.className=\"iw_bt_over\"' />"),J.push("</form></div></div>"),J.push("</div>"),J.push("<div id='userSignEdit' style='display:none;'></div>"),window.place&&window.place.result&&place.place_dateType){place.place_dateType.toUpperCase()}var Ai=[0,-26];i.forBusLine&&(Ai[1]=-5),i.isMenu&&(Ai[1]=-30);var Di=this.createInfWindow(F,J.join(""));return Pi&&(Di.favObj=Pi),Di._config.collisions=[[65,245],[233,39],[10,10],[10,10]],Di._ext={uid:c,pt:new BMap.Point(i.x,i.y),name:t,c:N,poiType:l,geoloc:i.geoloc,placesrcname:C},Di._transUid=_,window.place&&(window.place.iw=Di),/餐饮/.test(e.cate)&&addStat("poiinfowin.poi.poiinfowin"),Di},createInfWindow:function(e,i){var t=this,n=345,a=new BMap.InfoWindow(i,{title:e,height:0,width:n,margin:[42,10,20,10]});return a.addEventListener("open",function(){var e=a.overlay.getLabel();e&&e._indoor&&e.hide(),map.infoWindow.closeButton&&!map.infoWindow.closeButton._statBinded&&(map.infoWindow.closeButton._statBinded=!0),t.bindInfoEvents(this)}),a.addEventListener("close",function(){var e=a.overlay.getLabel();e&&e._indoor&&e.show()}),a},bindInfoEvents:function(){var i=e("common:widget/ui/setMyPlace/SetMyPlaceMgr.js"),t=this,n=this.content,a=this.opts||{},r=n.title,d=n.addr,l=(n.desc,n.tel&&n.tel.replace(/(,|;)/gi,", "),n.uid||""),h=n.poiType||o.POI_TYPE_NORMAL,f=(n.hasDetail,n.ext),_=(n.transUid,n.fav||0),w=(n.content,n.bizType,a.tabIndex,a.cityCode||u.cityCode),m="",g="",v="",b=a.x+" "+a.y,S=parseFloat(a.x)+"|"+parseFloat(a.y),y=n.userSign||0,C=n.origin_id&&n.origin_id.overview_guid?n.origin_id.overview_guid:"",I=n.pano||0,x=n.indoor_pano||0,k="undefined"==typeof n.pano_index?-1:n.pano_index,P=n.wd||"",R=n.street_id||"";(I||!I&&x)&&(baidu("#userSignCtrl .panoBtn").on("click",function(i){var t=a.isFromMPC?R:l;e.async("common:widget/ui/PanoInfoUtil/PanoInfoUtil.js",function(e){e.callPano({uid:t,index:k,addr:d,from:"infownd|poi",wd:P})}),addStat("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/poiinfoWin.poi.pano","click",{da_trd:"cater"}),i.preventDefault()}),baidu(".iw_poi_conTop .panoInfoBox").on("click",function(e){var i="street";addStat(STAT_CODE.STAT_PANORAMA,{catalog:"poi",from:"infownd",item:i});var t=a.isFromMPC?R:l;!I&&x&&(i="inter",t=l),p.showPano({research:!0,panoType:i,searchParam:{uid:t,index:k,from:"infownd|poi",wd:P}}),e.preventDefault(),f&&window.place.placeHookPano(f,"iw")}),baidu(".iw_poi_conTop a.panoInfoBoxInner").on("click",function(e){addStat(STAT_CODE.STAT_PANORAMA,{catalog:"poi",from:"infownd",item:"inter"});var i=a.isFromMPC?R:l;p.showPano({research:!0,panoType:"inter",searchParam:{uid:i,index:k,from:"infownd|poi",wd:P}}),e.preventDefault(),f&&window.place.placeHookPano(f,"iw")}),baidu(".iw_poi_conTop  .pano_thumnail_img").on("error",function(){Pano.PanoEntranceUtil&&Pano.PanoEntranceUtil.thumbnailNotFound(this,323,101)})),baidu(".userShowCtrl").on("mouseout",function(e){var i=baidu(this).data("nosign");i&&t.iwMenuMouseOut(this,e)}),baidu(".userShowCtrl").on("mousemove",function(){var e=baidu(this).data("nosign");e&&(t.menuAim({x:event.clientX,y:event.clientY},T.g("iw_tool_icon"),T.g("iw_tool_box"),!1,event.timeStamp||(new Date).getTime(),function(){T.g("iw_tool_icon").className="box",T.g("iw_tool_box").style.top="-2000px"})||(T.g("iw_tool_icon").className="box",T.g("iw_tool_box").style.top="-2000px"))}),y&&!_&&(baidu(".userShowCtrl .sign_edit").on("click",function(){MapSignInst.editInfoWnd({type:"button"})}),baidu(".userShowCtrl .sign_del").on("click",function(){MapSignInst.deletePoint()})),a.smp&&(baidu(".userShowCtrl .smp_edit").on("click",function(e){i.editMyPlace(e,a.smp)}),baidu(".userShowCtrl .smp_del").on("click",function(e){i.rmvMyplace(e,a.smp,r)})),baidu("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/.userShowCtrl .fuck").on("click",function(){addStat("poiinfowin.share.bubbleshare"),s.goShare({uid:l,cityCode:w,title:m,addr:g,tel:v,point:b})}),baidu("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/.userShowCtrl .fav").on("click",function(){addStat("poiinfowin.share.bubbleshare");var e=baidu(this).data("cont"),i=baidu(this).data("title");SyncMgr.goFav({point:S,uid:l,cityCode:w,title:i,content:e,panoGuid:C})}),baidu(".iw_tool_box .point").on("click",function(){addStat("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/poiinfowin.toolbar.mark");var e=baidu(this).data("cont"),i=baidu(this).data("title");s("searchPoiSign",{point:S,uid:l,cityCode:w,title:i,content:e,panoGuid:C})}),baidu("span.send_telf").on("click",function(e){addStat("poiinfowin.toolbar.poibubbletomb"),c.ready(this,l,h,w,"iw",this.hasDetailPage),e.preventDefault()}),baidu("a.sms_jiucuo").on("click",function(){n.jiucuofr||"";addStat("poiinfowin.revision.revisionbtn")}),baidu("span.carIcon").on("click",function(e){addStat("poiinfowin.toolbar.poibubbletocar"),c.ready(this,l,h,w,"iw"),e.preventDefault()}),baidu("ul.nav_tab").delegate("li","click",function(){var e=t.opts.isFromMPC?1:0,i=parseInt(baidu(this).data("tab")),n=e?"rangekw":"";t.switchInfoWndTab(i,n,!1,!1,!0)}),baidu("span.smp_iws_btn").on("click",function(e){i.openList("iw_ssn",e)}),baidu("span.smp_iwe_btn").on("click",function(e){i.openList("iw_esn",e)}),baidu(".iw_cate_form .info_form").on("submit",function(e){var i="rangekw",o=null,s=a.cityCode||u.cityCode,r=null,d=a.x,c=a.y,p=a.isFromMPC?!0:!1,h=p?1:0,f=n.userSign;l?t.roundSearchByInput(i,l,o,s,r,d,c,p):t.rangeSearchByInput(i,d,c,null,s,null,a.statCode||0,h,f),e.preventDefault()}),baidu("div.iw_cate_list").delegate("a","click",function(e){var i=(Boolean(baidu(this).data("fst")),""),n=a.cityCode||u.cityCode,o=a.isFromMPC?1:0,s=s?s:0,r=a.statCode||0;l?t.roundSearchByLink(this,l,i,n,0,a.x,a.y,o):t.rangeSearchByLink(this,a.x,a.y,i,n,null,r,o,s),e.preventDefault()})},goCorrect:function(){},openSearchInfoWndPOI:function(e,i,t){if(window.GRControll){var n=window.GRControll.ifChangeMap();0!=n.f&&window.GRControll.setGRequestFlg(2e3)}this.openSearchInfoWnd(e,i,t)},openSearchInfoWnd:function(i,t,n,o){if(!window.isPrint){var s=this,r=i._ext||{};if(r&&r.uid){var d=map.getBounds(),c=Math.min(d.minX,d.maxX),l=Math.max(d.minX,d.maxX),p=Math.min(d.minY,d.maxY),u=Math.max(d.minY,d.maxY),h="("+c+","+p+";"+l+","+u+")",f=(window.currentComponent&&window.currentComponent._className,window.currentComponent&&window.currentComponent.curKw||""),_={uid:r.uid,wd:f,b:h};r.placesrcname&&(_.place=1,_.category=r.placesrcname),addStat(STAT_CODE.STAT_USER_BEHAVIOUR_MINMING,_)}if(!n)var n={};if(i){var w=0;if(r&&r.detail_info){var m=r.detail_info;m.premium2&&"[object Array]"==Object.prototype.toString.call(m.premium2)&&m.premium2.length&&(w=1)}i.addEventListener("open",function(){var t=this.favObj;!function(){if(t){var e,i;if(SyncMgr&&SyncMgr.favCloudData&&SyncMgr.favCloudData.length>0){if(e=isNaN(n.favId)||-1==n.favId?SyncMgr.checkInFav({from:"poi",json:t.json}):n.favId,-1==e)return;i=T.g("JiwFav"),i.className="has_fav",i.title="取消收藏"}else setTimeout(arguments.callee,10)}}(),s.createInfoWndSugg(this,r);var o="",d="gr"==n.from||"poisearch"==n.from||"searchinview"==n.from;s.rangeSearchCenterMarker&&d&&a.getOverlayPoint(s.rangeSearchCenterMarker)!=a.getOverlayPoint(i)&&(s.switchInfoWndTab(0,"iw_ssn"),window.setTimeout(function(){o=s.rangeSearchCenterMarker.getTitle(),T.G("iw_ssn").value=o;var i=e("common:widget/ui/searchBox/searchBox.js");i.notShowSuggest.run()},100)),s.iwExt=r,s.iwOpts=n,T.on(T.G("iw_s_frm"),"submit",function(e){s.iwNavSubmit(e)}),T.on(T.G("iw_e_frm"),"submit",function(e){s.iwNavSubmit(e)}),T.on(T.G("iw_ssd_btn"),"click",function(e){s.iwNavSubmit(e)}),T.on(T.G("iw_esd_btn"),"click",function(e){s.iwNavSubmit(e)}),i.removeEventListener("open",arguments.callee)}),i.addEventListener("close",function(){i.iw_sugg_0&&(i.iw_sugg_0.disposeSug(),i.iw_sugg_0=null),i.iw_sugg_1&&(i.iw_sugg_1.disposeSug(),i.iw_sugg_1=null),i.removeEventListener("close",arguments.callee)}),n&&n.notMove&&i.disableAutoPan(),n&&n.pano&&n.panoPoint?e.async("common:widget/ui/PanoEntranceUtil/PanoEntranceUtil.js",function(e){e.addPanoEntranceInInfoWindow(i,n.panoPoint,function(e){e&&e.length>0&&(i=e[0],t&&t.openInfoWindow(i,n))})}):t?t.openInfoWindow(i,n):map.openInfoWindow(i,o,n)}}},createInfoWndSugg:function(i,t){e.async("common:widget/ui/MapSuggest/MapSuggest.js",function(e){i.iw_sugg_0=new e({inputid:"iw_ssn",offset:[1,0],closeB:1,qType:2,cityid:t.c},function(e){t.wd2=e}),i.iw_sugg_1=new e({inputid:"iw_esn",offset:[1,0],closeB:1,qType:2,cityid:t.c},function(e){t.wd2=e})})},switchInfoWndTab:function(e,i,t,n,a){var o=[T.G("nav_tab0"),T.G("nav_tab1"),T.G("nav_tab2")],s=[T.G("iw_tab0"),T.G("iw_tab1"),T.G("iw_tab2")];if(!o[e]||!o[e].className.match(/hover/)||t){if(T.ac(o[e],"hover"),a)switch(e){case 0:addStat("poiinfowin.tabexchange.goinghere");break;case 1:addStat("poiinfowin.tabexchange.fromhere");break;case 2:addStat("poiinfowin.tabexchange.searchnb")}s[e]&&(s[e].style.display="block");for(var r=0,d=o.length;d>r;r++)r!=e&&(T.rc(o[r],"hover"),s[r].style.display="none");if(i&&T.G(i))try{T.G(i).focus()}catch(c){setTimeout(function(){try{T.G(i).focus()}catch(e){}},100)}}},generateSingleLink:function(e,i,t,n,a,o,s){return a?"<a href='javascript:void(0)' tid='iwNSLink' data-fst='"+a+"'  class='first'>"+e+"</a>":"<a href='javascript:void(0)' data-fst='"+a+"' >"+e+"</a>"},generateSingleLinkForRange:function(e,i,t,n,a,o,s,r,d){d=d?d:0;return a?"<a href='javascript:void(0)' class='first' >"+e+"</a>":"<a href='javascript:void(0)' >"+e+"</a>"},roundSearchByLink:function(e,i,t,n,a,o,s,r){var d=r?1:0;if("a"==e.nodeName.toLowerCase()){var c=e.innerHTML;if(c){var l=a||0;switch(this.roundSearchByValue(c,i,t,n,l,o,s,d),e.innerHTML){case"银行":addStat("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/poiinfowin.nbsearch.bank");break;case"酒店":addStat("poiinfowin.nbsearch.hotel");break;case"医院":addStat("poiinfowin.nbsearch.hospital");break;case"餐馆":addStat("poiinfowin.nbsearch.restaurant");break;case"公交站":addStat("poiinfowin.nbsearch.busstation");break;default:addStat("poiinfowin.nbsearch.userinput")}}}},roundSearchByInput:function(e,i,t,n,o,s,r,d){var c=d?1:0;if(T.G(e)){if(!T.G(e).value)return T.G(e).focus(),!1;var l=o||1;this.roundSearchByValue(a.filtQuery(T.G(e).value),i,t,n,l,s,r,c),addStat("poiinfowin.rangesearch.userinput")}},roundSearchByValue:function(e,i,t,n,a,o,s,r,d){var c=1e3;if(e){if(null!==r)var l=1e3;else var l=window.GRControll?window.GRControll.GRCircleRadius:c;t&&T.G(t)&&(l=T.G(t).value);var p={r:l,c:n,wd:encodeURIComponent(e),nbtp:a,nb_x:o,nb_y:s};if(r)p.spotclick=1;else for(var u in d)d.hasOwnProperty(u)&&(p[u]=encodeURIComponent(d[u]));this.roundSearch(i,p)}},roundSearch:function(e,i){var t="",i=i||{};i=statParamInterceptor(i),i.query&&(i.query=encodeURIComponent(i.query));for(var a in i)"undefined"!=typeof i[a]&&(t=t+"&"+a+"="+i[a]);var o="nb"+t+"&uid="+e,s=16;if(window.GRControll&&(window.GRControll.GRCircleRadius=i.r,window.GRControll.isGRCircleShow=!0,window.GRControll.setGRequestFlg(1500),window.GRControll.GRCircleRadius>1500&&(s=15),window.GRControll.GRCircleRadius>2500&&(s=14)),map.centerAndZoom(new BMap.Point(i.nb_x,i.nb_y),s),o.indexOf("b=")<0){var r=map.getBounds(),d=Math.min(r.minX,r.maxX),c=Math.max(r.minX,r.maxX),l=Math.min(r.minY,r.maxY),p=Math.max(r.minY,r.maxY);o+="&b=("+d+","+l+";"+c+","+p+")"}if(o.indexOf("l=")<0){var r=map.getBounds();o+="&l="+map.zoomLevel}window.GRControll&&(window.GRControll.GRCircleRadius&&(o+="&gr_radius="+window.GRControll.GRCircleRadius),window.GRControll.openedMarker=null),n.go(o+"&from=webmap",{cinfo:{oc:i.c}})},rangeSearchByInput:function(e,i,t,n,o,s,r,d,c){var l=d?1:0;if(T.G(e))if(T.G(e).value){var p=s||1;addStat("poiinfowin.rangesearch.userinput"),this.rangeSearchByValue(a.filtQuery(T.G(e).value),i,t,n,o,p,r,l,null,c)}else T.G(e).focus()},rangeSearchByLink:function(e,i,t,n,a,o,s,r,d){var c=r?1:0;if("a"==e.nodeName.toLowerCase()){var l=e.innerHTML;if(l){var p=o||0;switch(e.innerHTML){case"银行":addStat("http://webmap0.map.bdstatic.com/newmap/static/common/pkg/poiinfowin.rangesearch.bank");break;case"酒店":addStat("poiinfowin.rangesearch.hotel");break;case"医院":addStat("poiinfowin.rangesearch.hospital");break;case"餐馆":addStat("poiinfowin.rangesearch.restaurant");break;case"公交站":addStat("poiinfowin.rangesearch.busstation");break;default:addStat("poiinfowin.rangesearch.userinput")}this.rangeSearchByValue(l,i,t,n,a,p,s,c,null,d)}}},rangeSearchByValue:function(e,i,t,n,a,o,s,r,d,c){if(a=u.cityCode,e){if(null!==r)var l=1e3;else var l=window.GRControll.GRCircleRadius;n&&T.G(n)&&(l=T.G(n).value),i=1*i,t=1*t,l=1*l;var p=i-l,h=t-l,f=i+l,_=t+l,w="("+p+","+h+";"+f+","+_+")",m={ar:w,wd:encodeURIComponent(e),c:a,bdtp:o,nb_x:i,nb_y:t,userSign:c};if(r)m.spotclick=1;else for(var g in d)d.hasOwnProperty(g)&&(m[g]=encodeURIComponent(d[g]));this.rangeSearch(m,new BMap.Point(i,t),l)}},rangeSearch:function(e,i,t){if(e){var o="";for(var r in e)"undefined"!=typeof e[r]&&(o=o+"&"+r+"="+e[r]);var d=16;window.GRControll&&(window.GRControll.GRCircleRadius=t,window.GRControll.isGRCircleShow=!0,window.GRControll.setGRequestFlg(1500),window.GRControll.GRCircleRadius>1500&&(d=15),window.GRControll.GRCircleRadius>2500&&(d=14)),map.centerAndZoom(i,d);var c="nb"+o;if(c.indexOf("b=")<0){var l=map.getBounds();c+="&b=("+l.minX+","+l.minY+";"+l.maxX+","+l.maxY+")"}if(c.indexOf("l=")<0){var l=map.getBounds();c+="&l="+map.zoomLevel}var p="中心点";if(e.userSign){for(var u,h=s.mapSign.pointInfo.list,r=0;u=h[r];r++)if(u.point==i.lng+"|"+i.lat){p=u.title;break}}else if(this.rangeSearchCenterMarker)p=this.rangeSearchCenterMarker.getTitle();else for(var u,f=map.getOverlays(),r=0;u=f[r];r++){var _=a.getOverlayPoint(u);if(_&&_.lat==i.lat&&_.lng==i.lng){p=u.getTitle();break}}p||(p="中心点");var w=this.getCenterPoiNameCbk._uid?this.getCenterPoiNameCbk._uid:"";w&&(c+="&uid="+w),window.GRControll&&window.GRControll.GRCircleRadius&&(c+="&gr_radius="+window.GRControll.GRCircleRadius),n.go(c+"&r="+t+"&from=webmap",{cinfo:{searchByContextMenu:!0,centerPoint:i,ctrPoiName:p,radius:t,oc:e.c,uid:w}})
}},getCenterPoiNameCbk:function(e){var i=this,t=map.getInfoWindow();if(t){var n=e.content;if(n&&n.address){var a=n.address;n.surround_poi&&n.surround_poi[0]&&(a=n.surround_poi[0].addr,this.getCenterPoiNameCbk._uid=n.surround_poi[0].uid);var o=t.getPoint?t.getPoint():t.GetPosition(),s=this.rangeSearchCenterMarker.getPoint?this.rangeSearchCenterMarker.getPoint():this.rangeSearchCenterMarker.GetPosition();if(o==s){var r="<p class='iw_poi_title' title='"+a+"'>"+a+"</p>";t.setTitle(r),this.rangeSearchCenterMarker.setTitle(a)}}}else window.setTimeout(function(){i.getCenterPoiNameCbk(e)},50)},createRangeInfoWnd:function(e){if(e){var i=this;return r.getGEORevertAddress(e,function(e){i.getCenterPoiNameCbk(e)}),this.createSearchInfoWnd({title:"未知地点",poiType:0},{x:e.lng,y:e.lat,statCode:STAT_CODE.STAT_CM_ROUND,tabIndex:0})}},exitRangeSearch:function(){this.rangeSearchCenterMarker&&(this.rangeSearchCenterMarker.remove(),this.rangeSearchCenterMarker=null)},iwNavSubmit:function(i){i=window.event||i;var t="",s="",r="sn",c="en",l="sc",p="ec",h="",f="",_={},w={},m=i.target||i.srcElement,g="",v=this.iwExt,b=this.iwOpts,S=v.c||u.cityCode,y="",C="",I="dep",x=d.getBusExpTime(),k=5,P=0;switch(m.id){case"iw_s_pano_frm":t="iw_pano_ssn",s="bt",r="en",c="sn",l="ec",p="sc",h="BusSearchEnd",f="BusSearchSta",P=0,y="0",g="end";break;case"iw_ssd_pano_btn":t="iw_pano_ssn",s="nav",h="DriveSearchEnd",f="DriveSearchSta",r="en",c="sn",l="ec",p="sc",P=0,C="0",g="end";break;case"iw_e_pano_frm":t="iw_pano_esn",s="bt",h="BusSearchSta",f="BusSearchEnd",P=1,y=1,g="start";break;case"iw_esd_pano_btn":t="iw_pano_esn",s="nav",h="DriveSearchSta",f="DriveSearchEnd",P=1,C=1,g="start";break;case"iw_s_frm":t="iw_ssn",s="bt",r="en",c="sn",l="ec",p="sc",h="BusSearchEnd",f="BusSearchSta",P=0,y="0",g="end";break;case"iw_e_frm":t="iw_esn",s="bt",h="BusSearchSta",f="BusSearchEnd",P=1,y=1,g="start";break;case"iw_ssd_btn":t="iw_ssn",s="nav",h="DriveSearchEnd",f="DriveSearchSta",r="en",c="sn",l="ec",p="sc",P=0,C="0",g="end";break;case"iw_esd_btn":t="iw_esn",s="nav",h="DriveSearchSta",f="DriveSearchEnd",P=1,C=1,g="start"}var R=T.g(t),M=T.string.trim(R.value),B=e("common:widget/ui/searchBox/searchBox.js"),G=e("common:widget/ui/setMyPlace/SetMyPlaceMgr.js"),E=B.inputInfo[t];if(this.rangeSearchCenterMarker&&M==this.rangeSearchCenterMarker.getTitle()){var O=a.getOverlayPoint(this.rangeSearchCenterMarker);E.point=O.lng+","+O.lat,E.note=M,E.ccode=S}var N=E&&E.point&&E.note==M;if(R&&G.helper.isEmpty(M))return R.focus(),void(i.returnValue=!1);if("start"==g?"bt"==s?addStat("poiinfowin.tabexchange.fromhere",null,{da_attr:"bus"}):"nav"==s&&addStat("poiinfowin.tabexchange.fromhere",null,{da_attr:"driving"}):"end"==g&&("bt"==s?addStat("poiinfowin.tabexchange.goinghere",null,{da_attr:"bus"}):"nav"==s&&addStat("poiinfowin.tabexchange.goinghere",null,{da_attr:"driving"})),N){var j=v.name,U=E.note,L=encodeURIComponent(j),A=encodeURIComponent(U),D=v.pt.lng+","+v.pt.lat,W=E.point,F=v.c,$=E.ccode;_={c:S,pn:0,rn:5},_[r]="1$$$$"+D+"$$"+L+"$$$$$$",_[c]="1$$$$"+W+"$$"+A+"$$$$$$",_[l]=F,_[p]=$,B.inputInfo[h]={note:j,ccode:F,point:D},B.inputInfo[f]={note:U,ccode:$,point:W}}else{s="bt"==s?"bse":"nse";var Y="pcmappg.routesrach.as"+g,q=v.pt.lng+","+v.pt.lat,z=v.name||"",H=v.uid||"",X=v.wd2?1:0,V=v.wd2||"",J=M,K=0,Q=v.poiType==o.POI_TYPE_BUSSTOP||v.poiType==o.POI_TYPE_SUBSTOP?0:1;_={c:S,da_src:Y,t:K,poiType:v.poiType,ptx:v.pt.lng,pty:v.pt.lat,sug:X,wd:encodeURIComponent(J),wd2:encodeURIComponent(V),name:encodeURIComponent(z),isSingle:"true",nsetp:C,bsetp:y},_=statParamInterceptor(_),_.query&&(_.query=encodeURIComponent(_.query)),_[r]=Q+"$$"+H+"$$"+q+"$$"+encodeURIComponent(z)+"$$$$$$","bse"==s&&(_.exptype=I,_.exptime=x,_.version=k),w={cinfo:{q:s+"&"+a.jsonToQuery(_),c:S,t:P,isSingle:!0,kwn:{name:z,uid:H,pt:v.pt,poiType:v.poiType}},dom:T.g("MapInfo")};var Z="iw_ssn"==t?h:f;B.inputInfo[Z]={note:z,ccode:S,point:q}}b&&b.isFromMPC&&(_.spotclick=1),window.GRControll&&window.GRControll.isGRequest&&(_.gr=5),1==v.geoloc&&(_.geoloc=1),("nav"==s||"nse"==s)&&(_.time_index=window.navTimeCache?window.navTimeCache.timeIndex+"":-1,_.day=window.navTimeCache?window.navTimeCache.day:-1),n.go(s+"&"+a.jsonToQuery(_),w),baidu.event.preventDefault(i)},menuAim:function(){var e,i=0,t=null;return function(n,a,o,s,r,d){var c,l,p,u;if(100>r-i)return!0;500>r-i&&t?(c=t.mainMenuPosition,l=t.subMenuPosition,p=t.mainMenuStyle,u=t.subMenuStyle):(t={},c=t.mainMenuPosition=T.dom.getPosition(a),l=t.subMenuPosition=T.dom.getPosition(o),p=t.mainMenuStyle={width:parseInt(T.dom.getComputedStyle(a,"width")||a.currentStyle.width),height:parseInt(T.dom.getComputedStyle(a,"height")||a.currentStyle.height)},u=t.subMenuStyle={width:parseInt(T.dom.getComputedStyle(o,"width")||o.currentStyle.width),height:parseInt(T.dom.getComputedStyle(o,"height")||o.currentStyle.height)});var h,f,_,w=function(){e=setTimeout(function(){d&&d()},500)};if(i=r,clearTimeout(e),l.left<=0||l.top<=0)return t=null,!1;if(s);else{if(n.y>=l.top)return!0;if(n.x<c.left)h=n.x-l.left,f=l.top-n.y,_=p.height/(c.left-l.left),w();else{if(!(n>c.left+p.width))return!0;h=l.left+u.width-n.x,f=l.top-n.y,_=p.height/(l.left+u.width-l.left-u.width),w()}}var m=_>=f/h;return m||clearTimeout(e),m}}(),iwMenuMouseOut:function(e,i){var t=T.g("iw_tool_box");i.relatedTarget=i.relatedTarget||i.toElement,i.target=i.target||i.fromElement,(i.relatedTarget!==e&&!baidu.dom.contains(e,i.relatedTarget)||(t===i.target||baidu.dom.contains(t,i.target))&&!baidu.dom.contains(t,i.relatedTarget))&&(T.g("iw_tool_icon").className="box",T.g("iw_tool_box").style.top="-2000px")}};t.exports=f});