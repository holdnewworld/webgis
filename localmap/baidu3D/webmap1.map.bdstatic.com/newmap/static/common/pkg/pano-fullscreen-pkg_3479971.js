define("common:widget/pano/base/PanoContext.js",function(o,n,e){function r(o){this._moduleHash=o}var t=o("common:widget/ui/config/config.js");T.object.extend(r.prototype,{getPanoUrlConfig:function(){var o=t.urlConfig,n=t.mapVersion,e="",r="",i="";return roadLayer="",indoorClickVersion="",imageUrl="",e=o.PANO_TILE_URL instanceof Array?o.PANO_TILE_URL.join("|"):o.PANO_TILE_URL,r=o.PANO_URL,i=n.UDT_VERSION,indoorClickVersion=n.INDOOR_CLICK_VER,roadLayer=o.PANO_ROAD_LAYER,imageUrl=o.PANO_3DIMAGE_URL,{PANO_TILE_URL:e,PANO_SERVICE_URL:r,PANO_UDT_VERSION:i,PANO_ROAD_LAYER_URL:roadLayer,PANO_INDOOR_CLICK_VERSION:indoorClickVersion,PANO_3DIMAGE_URL:imageUrl}},getConfig:function(){return t},getPanoServiceUrl:function(){return CONST.PANO_URL},getPanoOptions:function(){return this._moduleHash.PanoModule?this._moduleHash.PanoModule.getPanoOptions():null},getInnerId:function(){return this._moduleHash.PanoOverviewModule?this._moduleHash.PanoOverviewModule.getInnerId():null},getCurrentRoad:function(){return this._moduleHash.PanoCopyrightModule?this._moduleHash.PanoCopyrightModule.getCurrentRoad():null},getMarkerUidInBestPano:function(){return this._moduleHash.PanoModule?this._moduleHash.PanoModule.getMarkerUidInBestPano():""}}),e.exports=r});
;define("common:widget/pano/base/MapContext.js",function(e,t,o){function i(e){this._moduleHash=e}var n=e("common:widget/ui/config/config.js"),r=n.modelConfig;T.object.extend(i.prototype,{getLevel:function(){return map.getZoom()},getOverviewLevel:function(){var e=this._moduleHash.PanoOverviewModule;return e?e.getLevel():16},getPCMapCity:function(){return{cityId:r.cityCode,cityName:r.cityName}},getCurrentCity:function(e){var t=this._moduleHash.PanoOverviewModule;t?t.getCurrentCity(e):e({cityId:r.cityCode,cityName:r.cityName})},getPoint:function(){var e=this._moduleHash.PanoOverviewModule;return e?e.getPoint():null}}),o.exports=i});
;define("common:widget/pano/base/ModuleClass.js",function(t,n,e){var s=function(){},o=T.lang.Class.prototype.dispose,i=function(){this.$dispose&&this.$dispose(),o.call(this)},a=function(){T.lang.Class.call(this)};T.lang.inherits(a,T.lang.Class),T.object.extend(a.prototype,{ready:function(){this.fire("ready")},getName:function(){return this._className},constructor:function(){},initialize:function(){try{}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/base/ModuleClass.js",ln:50})}},isAsync:function(){return!1},getSupportEvents:function(){return[]},getShareParam:function(){return null}});var r=function(t,n){1===arguments.length&&(n=t,t=null);var e=s;n.constructor&&(e=n.constructor,delete n.constructor);var o=function(){T.lang.Class.call(this),e.apply(this)};return n.dispose&&(n.$dispose=n.dispose),n.dispose=i,t?T.lang.inherits(o,a,t):T.lang.inherits(o,a),T.object.extend(o.prototype,n),o};e.exports={extend:function(t,n){return r(t,n||{})}}});
;define("common:widget/pano/component/ScrollView/ScrollView.js",function(l,o,t){var n=function(l,o){o.container=l,this.container=l,this._scrollPanel=new baidu.ui.ScrollPanel(o),this._scrollPanel.render(l)};n.prototype={fit:function(l,o){var t=this.container.clientHeight,n=o*l,e=n+o,i=this.getScrollValue();if(!(n>=i&&i+o>=e)){if(i>n)this.scrollTo(n);else if(e>i+o){var r=n-(t-o);this.scrollTo(r)}return;var r}},scrollTo:function(l){this.container.scrollTop=l,this._scrollPanel.update()},getScrollValue:function(){return this.container.scrollTop},getScrollBarWidth:function(){return this._scrollPanel._scrollBarSize},update:function(){this._scrollPanel.update()}},t.exports=n});
;define("common:widget/pano/component/TableView/TableView.js",function(e,t,i){var l=e("common:widget/ui/Animation/Animation.js"),a=e("common:widget/pano/base/util.js");e.loadCss({content:".tableview-container{float:left;position:relative}.tableview-wapper{position:absolute;left:10px;overflow:hidden}.tableview-ul{list-style:none;padding:0;margin:0;position:relative}.tableview-li{cursor:pointer;position:relative}.tableview-li-hover{}.tableview-selected-border{background:0 0;position:absolute;width:100%;height:100%;top:0;left:0;filter:alpha(opacity=100)}.tableview-li-selected .tableview-selected-border{display:block}.tableview-horizontal-ul .tableview-li{float:left}.tableview-bg{background-repeat:no-repeat;background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons_249d710.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons-8_0ec7deb.png)}.tableview-la,.tableview-ra{position:absolute;width:22px;height:108px;text-align:center}.tableview-la{left:0}.tableview-ra{right:0}.tableview-la .tableview-bg,.tableview-ra .tableview-bg{width:18px;height:18px;margin:45px auto 0;display:block}.tableview-la .tableview-bg{background-position:0 -36px}.tableview-ra .tableview-bg{background-position:-54px -36px}.tableview-la:hover{_zoom:1}.tableview-la:hover .tableview-bg{background-position:-18px -36px}.tableview-ra:hover{_zoom:1}.tableview-ra:hover .tableview-bg{background-position:-72px -36px}.tableview-container .tableview-la-disabled .tableview-bg{background-position:-36px -36px}.tableview-container .tableview-la-disabled:hover{_zoom:1}.tableview-container .tableview-la-disabled:hover .tableview-bg{background-position:-36px -36px}.tableview-container .tableview-ra-disabled .tableview-bg{background-position:-90px -36px}.tableview-container .tableview-ra-disabled:hover{_zoom:1}.tableview-container .tableview-ra-disabled:hover .tableview-bg{background-position:-90px -36px}"});var s,o=function(){},n=function(e,t,i,a,n){var r=i-t;0!=r&&(s=new l.Animation,s.build({fps:60,transition:l.Transitions.linear,duration:n||300,render:function(i){try{e.style.left=t+r*i+"px"}catch(l){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:l.message||l.description,path:"common:widget/pano/component/TableView/TableView.js",ln:23})}},finish:a||o}))},r=function(e,t,i,l,a){if(t>=0)return baidu.dom.addClass(l,"tableview-la-disabled"),void baidu.dom.addClass(a,"tableview-ra-disabled");this.scrollLeft;i>e?baidu.dom.removeClass(l,"tableview-la-disabled"):baidu.dom.addClass(l,"tableview-la-disabled"),e>t?baidu.dom.removeClass(a,"tableview-ra-disabled"):baidu.dom.addClass(a,"tableview-ra-disabled")},h={viewWidth:200,viewHeight:300,margin:2,isHorizontal:!1,isFullSize:!1},d=function(e,t){this.options=a.merge(h,t),this.velocity=300,this.itemLength=0,this.contentSize={width:0,height:0},this.scrollAttr=this.options.isHorizontal?"left":"top",this.scrollValue=0,this.minScrollValue=0,this.maxScrollValue=0,this.viewWidth=this.options.viewWidth-60,this.viewHeight=this.options.viewHeight,this.scrollDistance=0,this.maxAnimationDistance=0,this.selectedIndex=void 0;var i=this.tableContainer=document.createElement("div");i.className="tableview-container",i.style.width=this.options.viewWidth+"px",i.style.height=this.options.viewHeight+"px";var l=this.viewHeight/2-9,s=this.leftArrow=document.createElement("a");s.href="javascript:void(0)",s.className="tableview-la",s.innerHTML='<span style="margin-top:'+l+'px;" class="tableview-bg"></span>',s.style.height=this.viewHeight+"px";var o=this.rightArrow=document.createElement("a");o.href="javascript:void(0)",o.className="tableview-ra",o.innerHTML='<span style="margin-top:'+l+'px;" class="tableview-bg"></span>',o.style.height=this.viewHeight+"px";var n=this.tableWapper=document.createElement("div");n.className="tableview-wapper",n.style.width=this.viewWidth+"px",n.style.height=this.viewHeight+"px";var r=this.ul=document.createElement("ul");r.className="tableview-ul"+(this.options.isHorizontal?" tableview-horizontal-ul":"");var d=this.selectBorder=document.createElement("div");d.className="tableview-selected-border",n.appendChild(r),i.appendChild(s),i.appendChild(n),i.appendChild(o),e.appendChild(i);var c=this,v=baidu(i);v.delegate("li","click",function(e){if(!c.ignoreUserEvent){var t=this.getAttribute("index");void 0!==t&&c.dispatchEvent("click",{index:1*t,elem:this,event:e})}}),v.delegate("li","mouseenter",function(e){if(!c.ignoreUserEvent){var t=this.getAttribute("index");T.dom.addClass(this,"tableview-li-hover"),void 0!==t&&c.dispatchEvent("mouseenter",{index:1*t,elem:this,event:e})}}),v.delegate("li","mouseleave",function(e){if(!c.ignoreUserEvent){var t=this.getAttribute("index");T.dom.removeClass(this,"tableview-li-hover"),void 0!==t&&c.dispatchEvent("mouseleave",{index:1*t,elem:this,event:e})}}),baidu(s).on("click",function(){if(!c.ignoreUserEvent){c.stopScroll();var e=1e3*Math.abs(c.maxScrollValue-c.minScrollValue)/(30*c.velocity);c.scrollTo(c.scrollValue+c.viewWidth,!1,!0,e,function(){c.scroll(-1)})}}),baidu(o).on("click",function(){if(!c.ignoreUserEvent){c.stopScroll();var e=1e3*Math.abs(c.maxScrollValue-c.minScrollValue)/(30*c.velocity);c.scrollTo(c.scrollValue+-c.viewWidth,!1,!0,e,function(){c.scroll(1)})}}),baidu(s).on("mouseenter",function(e){c.ignoreUserEvent||(c.scroll(-1),baidu.event.preventDefault(e))}),baidu(s).on("mouseleave",function(){c.stopScroll()}),baidu(o).on("mouseenter",function(e){c.ignoreUserEvent||(c.scroll(1),baidu.event.preventDefault(e))}),baidu(o).on("mouseleave",function(){c.stopScroll()})};baidu.lang.inherits(d,baidu.lang.Class),T.object.extend(d.prototype,{addItemContent:function(e,t){var i=document.createElement("li");if(i.className="tableview-li","string"==typeof e?i.innerHTML=e:i.appendChild(e),i.setAttribute("index",this.itemLength),this.itemLength++,void 0!==t?this.ul.insertBefore(i,t):this.ul.appendChild(i),this.options.isHorizontal===!0){var l=this.options.margin;i.style.margin="0 "+l+"px";var s=a.getDomSize(i.firstChild);this.contentSize.width+=s.width+2*l}return i},insertItemBefore:function(e,t){return this.addItemContent(t,e)},addComponent:function(e){this.tableWapper.appendChild(e)},resize:function(){if(this.options.isFullSize===!0)return this.viewWidth=this.contentSize.width,this.ul.style.width=this.contentSize.width+"px",this.tableWapper.style.width=this.viewWidth+"px",this.tableWapper.style.left="18px",this.tableContainer.style.width=this.viewWidth+36+"px",this.leftArrow.style.display="none",void(this.rightArrow.style.display="none");if(this.options.isHorizontal===!0){this.ul.style.width=this.contentSize.width+"px",this.minScrollValue=this.viewWidth-this.contentSize.width;var e=this.itemWidth=this.contentSize.width/this.itemLength;this.scrollDistance=Math.floor(this.viewWidth/e)*e,this.maxAnimationDistance=this.scrollDistance+30,r(this.scrollValue,this.minScrollValue,this.maxScrollValue,this.leftArrow,this.rightArrow),this.scrollValue<this.minScrollValue?this.scrollTo(this.minScrollValue):this.scrollValue>this.maxScrollValue&&this.scrollTo(this.maxScrollValue)}},setViewSize:function(e){this.viewWidth=e-60,this.tableContainer.style.width=e+"px",this.tableWapper.style.width=this.viewWidth+"px",this.resize()},clear:function(){for(var e=this.ul;e.lastChild;)e.removeChild(e.lastChild);this.contentSize={width:0,height:0}},scrollTo:function(e,t,i,l,a){var s=this.ul,o=this.scrollValue;e=Math.min(this.maxScrollValue,Math.max(this.minScrollValue,e)),!i&&(t||Math.abs(o-e)>this.maxAnimationDistance)?s.style.left=e+"px":n(s,o,e,a,l),this.scrollValue=e},scrollBy:function(e,t){var i=this.scrollValue+e;this.scrollTo(i,t)},scroll:function(e){if(e>0){var t=1e3*Math.abs(this.scrollValue-this.minScrollValue)/this.velocity;this.scrollTo(this.minScrollValue,!1,!0,t)}else{var t=1e3*Math.abs(this.scrollValue)/this.velocity;this.scrollTo(this.maxScrollValue,!1,!0,t)}},stopScroll:function(){if(s){s.stop(),s=null;var e=baidu.g(this.ul),t=e.style.left||"0px";this.scrollValue=parseInt(t.replace("px","")),r(this.scrollValue,this.minScrollValue,this.maxScrollValue,this.leftArrow,this.rightArrow)}},setSelectIndex:function(e,t){var i=baidu(this.tableWapper).find("li");if(null===e&&this.selectBorder.parentNode)return T(i[this.selectedIndex]).removeClass("selected-item"),this.selectedIndex=null,void this.selectBorder.parentNode.removeChild(this.selectBorder);var l=i[e];l&&(T(i[this.selectedIndex]).removeClass("selected-item"),T(l).addClass("selected-item"),this.selectedIndex=e,l.appendChild(this.selectBorder),t||this.fitImage(e))},getSelectIndex:function(){return this.selectedIndex},getSelectItem:function(){var e=baidu(this.tableWapper).find("li"),t=e[this.selectedIndex];return t},fitImage:function(e,t){if(!(this.minScrollValue>=0)){var i=this,l=baidu(this.tableWapper).find("li"),a=l[e];if(a){var s=this.itemWidth*e,o=s+this.itemWidth,n=-this.scrollValue;if(!(s>=n&&o<=n+this.viewWidth))if(n>s){var r=1e3*Math.abs(s+i.scrollValue)/i.velocity;this.scrollTo(-s,t,!1,r)}else if(o>n+this.viewWidth){var h=s-(this.viewWidth-this.itemWidth),r=1e3*Math.abs(h+i.scrollValue)/i.velocity;this.scrollTo(-h,t,!1,r)}}}},destroy:function(){T(this.tableContainer).off().remove()}}),i.exports=d});
;define("common:widget/pano/component/PanoAlbumComponent/AlbumView/AlbumView.js",function(n,e,o){function t(){}baidu.lang.inherits(t,baidu.lang.Class,"PanoAlbumViewComponent"),baidu.object.extend(t.prototype,{render:function(n,e){try{return n.replace(/\{(.*?)\}/g,function(n,o){return e[o]})}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/component/PanoAlbumComponent/AlbumView/AlbumView.js",ln:27})}},getImage3DUrl:function(n,e,o,t){var i="{baseURL}/?qt=pr3d&fovy=75&quality=80&panoid={panoId}&heading={panoHeading}&pitch={panoPitch}&width={width}&height={height}",a={baseURL:n,panoId:e.panoId,panoHeading:e.panoHeading,panoPitch:e.panoPitch+6,width:o,height:t};return i.replace(/\{(.*?)\}/g,function(n,e){return a[e]})}}),o.exports=t});
;define("common:widget/pano/component/PanoAlbumComponent/AlbumView/PoiAlbumView.js",function(n,t,o){function i(n){this._opts=n,this.IMAGE_SIZE={width:198,height:106}}var e=n("common:widget/pano/component/PanoAlbumComponent/AlbumView/AlbumView.js"),a=n("common:widget/pano/base/util.js"),m=a.getRandom()+"_imgonload";window[m]=function(n){var t=0,o=setInterval(function(){t+=.1,1>t?a.setOpacity(n,t):(clearTimeout(o),o=null,t=null,n.onload=null,n=null)},35)},T.inherits(i,e,"PanoAlbumPoiViewComponent"),T.extend(i.prototype,{initialize:function(){try{var n='<img width="{width}px" height="{height}px" src="{src}"/><div class="photo-desc"><i class="{icon}"></i><span title="{name}">{name}</span></div>',t=this,o=t._opts.data,i=t.IMAGE_SIZE,e=t._opts.context.panoContext.getPanoUrlConfig().PANO_3DIMAGE_URL;o.photUrl||(imgUrl=this.getImage3DUrl(e,o.data,i.width,i.height));var a={cbName:m,width:i.width,height:i.height,src:imgUrl,icon:"icon i-poi-"+o.type,name:o.name};return this.render(n,a)}catch(l){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:l.message||l.description,path:"common:widget/pano/component/PanoAlbumComponent/AlbumView/PoiAlbumView.js",ln:57})}}}),o.exports=i});
;define("common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js",function(require,exports,module){var Animation=require("common:widget/ui/Animation/Animation.js"),util=require("common:widget/pano/base/util.js"),DO_NOTHING=function(){},IMG_ERROR_URL="../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/img_error_8d3eb72.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/img_error_8d3eb72.png*/,ALBUM_ITEM_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('        <div class="panoAlbum-item-wraper">            '),src&&(_template_fun_array.push("                "),name?_template_fun_array.push('                    <img src="',"undefined"==typeof src?"":src,'" onerror="this.src=&#39;',"undefined"==typeof errorUrl?"":errorUrl,'&#39;" style="width:',"undefined"==typeof width?"":width,"px;height:","undefined"==typeof height?"":height,'px;" />                    <div class="photo-desc">                                                    <i class="icon ',"undefined"==typeof icon?"":icon,'"></i>                            <span title="',"undefined"==typeof name?"":name,'">',"undefined"==typeof name?"":name,"</span>                    </div>                "):_template_fun_array.push('                    <a id="ugc-upload-item" target="_blank" href="http://pai.baidu.com/"><img src="',"undefined"==typeof src?"":src,'" onerror="this.src=&#39;',"undefined"==typeof errorUrl?"":errorUrl,'&#39;" style="width:',"undefined"==typeof width?"":width,"px;height:","undefined"==typeof height?"":height,'px;" /></a>                '),_template_fun_array.push("            ")),_template_fun_array.push("        </div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],animation,createAlbumItem=function(e,t,i,o,n){var r=document.createElement("li");return r.style.width=e+"px",r.style.height=t+"px",r.className="panoAlbum-item",r.innerHTML=ALBUM_ITEM_TEMPLATE({src:i,icon:o,name:n,errorUrl:IMG_ERROR_URL,width:e,height:t}),r},fadeInOutEffect=function(e,t,i,o){var n=0,r=e.length,a=0,l=t.length,s=new Animation.Animation;return s.build({fps:40,transition:Animation.Transitions.easeOutQuad,duration:i,render:function(i){try{for(n=0;r>n;n++)util.setOpacity(e[n],i);for(a=0;l>a;a++)util.setOpacity(t[a],1-i)}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js",ln:44})}},finish:o||DO_NOTHING}),s},move=function(e,t,i,o,n){var r=i-t;0!=r&&(animation=new Animation.Animation,animation.build({fps:60,transition:Animation.Transitions.linear,duration:n||300,render:function(i){try{e.style.left=t+r*i+"px"}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js",ln:61})}},finish:function(){o&&o(e,i)}}))},checkArrowStatus=function(e,t,i,o,n){if(t>=0)return disableArrow(o),void disableArrow(n);this.scrollLeft;i>e?enableArrow(o):disableArrow(o),e>t?enableArrow(n):disableArrow(n)},disableArrow=function(e){baidu.dom.addClass(e,"arrow-disabled")},enableArrow=function(e){baidu.dom.removeClass(e,"arrow-disabled")};require.loadCss({content:'#panoGuideAlbum{height:108px;-moz-user-select:none;-webkit-user-select:none;position:relative}#panoGuideAlbum .left-arrow,#panoGuideAlbum .right-arrow{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/album_aae0aec.png) no-repeat}#panoGuideAlbum #l_arrow,#panoGuideAlbum #r_arrow{float:left;width:30px;height:108px;text-align:center}#panoGuideAlbum #l_arrow:hover,#panoGuideAlbum #r_arrow:hover{cursor:pointer}#panoGuideAlbum .l_arrow .left-arrow{display:inline-block;width:18px;height:18px;background-position:-95px -79px;margin-top:45px}#panoGuideAlbum .r_arrow .right-arrow{display:inline-block;width:18px;height:18px;background-position:-117px -79px;margin-top:45px}#panoGuideAlbum .l_arrow:hover{_zoom:1}#panoGuideAlbum .r_arrow:hover{_zoom:1}#panoGuideAlbum .l_arrow:hover .left-arrow{background-position:-77px -79px}#panoGuideAlbum .r_arrow:hover .right-arrow{background-position:-131px -79px}#panoGuideAlbum .arrow-disabled .left-arrow,#panoGuideAlbum .arrow-disabled:hover .left-arrow{background-position:-95px -99px}#panoGuideAlbum .arrow-disabled .right-arrow,#panoGuideAlbum .arrow-disabled:hover .right-arrow{background-position:-117px -99px}.panoAlbum-container{float:left;overflow:hidden;height:108px;position:relative}.panoAlbum-wraper{position:absolute}#panoGuideAlbum .panoAlbum-item{position:relative;float:left;border:1px #252525 solid;margin-right:5px;font-size:0;position:absolute}#panoGuideAlbum .panoAlbum-item-wraper{left:0;top:0;z-index:4;zoom:1}#panoGuideAlbum .panoAlbum-item img{cursor:pointer;border:0;width:100%;height:100%}#panoGuideAlbum .panoAlbum-item .photo-desc{position:absolute;bottom:0;left:0;width:198px;height:24px;padding-top:25px;font-size:12px;font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif;color:#abb0b2;z-index:3;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/album-title-bg_eeddd16.png) left bottom repeat-x;_background:0 0}#panoGuideAlbum .panoAlbum-item .photo-desc span{display:inline-block;text-indent:4px;vertical-align:middle;width:165px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#panoGuideAlbum .panoAlbum-item .selected-item{position:absolute;top:0;left:0;border:3px solid #3af;z-index:5}#panoGuideAlbum .panoAlbum-item-on{border:1px #3af solid}.panoAlbum-container{height:110px}#panoAlbum-scrollWraper{height:108px;overflow:hidden;position:relative}#panoGuideAlbum .icon{display:inline-block;width:18px;height:18px;vertical-align:middle;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/guide_icons2_56e908a.png) no-repeat;_background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/guide_icons2_8_ff4230f.png) no-repeat}#panoGuideAlbum .photo-desc .icon{margin-left:8px}#panoGuideAlbum .i-poi-1,#panoGuideAlbum .i-poi-2,#panoGuideAlbum .i-poi-4{background-position:-30px 3px}#panoGuideAlbum .i-poi-21{background-position:-39px 3px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-1,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-2,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-4{background-position:-30px -42px}#panoGuideAlbum .i-poi-3{background-position:2px 2px;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-3{background-position:1px -43px}#panoGuideAlbum .i-poi-6{background-position:-122px 1px;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-6{background-position:-122px -43px}#panoGuideAlbum .i-poi-5{background-position:-93px 0;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-5{background-position:-93px -44px}#panoGuideAlbum .i-poi-10,#panoGuideAlbum .i-poi-9,#panoGuideAlbum .i-poi-7{background-position:-64px 0;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-10,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-9,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-7{background-position:-66px -43px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-21{background-position:-39px -43px}.panoAlbum-item-wraper:hover .photo-desc span{color:#d3d8db}'});var AlbumComponent=function(e,t,i,o){this.itemWidth=t,this.itemHeight=i,this.itemMargin=6,this.ignoreUserEvent=!1,this.options=util.merge({},o),this.parentElem=e;var n=this;this.velocity=300,this.scrollLeft=0,this.minScrollLeft=0,this.maxScrollLeft=0;var r=0;this.viewWidth=0,this.itemOuterWidth=0,this.scrollDistance=0,this.maxAnimationDistance=0,this.selectedIndex=void 0;var a=this.container=document.createElement("div"),l="width:"+r+"px; height:"+this.itemHeight+"px; z-index:"+o.zIndex;a.setAttribute("id","panoGuideAlbum"),a.setAttribute("style",l);var s=util.each(["l","r"],function(e){var t=document.createElement("a");return t.id=e+"_arrow",t.href="javascript:void(0)",t.className=e+"_arrow",t.title="",t.innerHTML='<span class="'+("l"==e?"left-arrow":"right-arrow")+'"></span>',t},!0);if(this.leftArrow=s[0],this.rightArrow=s[1],this.albumContainer=document.createElement("div"),this.albumContainer.className="panoAlbum-container",this.albumWraper=document.createElement("div"),this.albumWraper.className="panoAlbum-wraper",this.albumContainer.appendChild(this.albumWraper),a.appendChild(s[0]),a.appendChild(this.albumContainer),a.appendChild(s[1]),e.appendChild(a),n.bindDomEvent(),a.onselectstart=function(){return!1},n._currentIndex>=0){var p=1,u=albumData.content[n._currentIndex],d=n.getFloorInfo(n._currentPanoId);d.floor&&p!=d.floor&&(u.data.source="PanoFloor",u.data.floor=d.floor,u.data.floorsData=d.floorsData,setTimeout(function(){n.dispatchEvent("floor_changed",{data:u.data})},100),p=d.floor)}};baidu.lang.inherits(AlbumComponent,baidu.lang.Class,"AlbumComponent"),baidu.object.extend(AlbumComponent.prototype,{ignoreMouseEvent:function(e){this.ignoreUserEvent=!!e},bindDomEvent:function(){var e=this,t=baidu(this.albumWraper);t.delegate("li","click",function(){if(!e.ignoreUserEvent){var t=this.getAttribute("index");void 0!==t&&e.dispatchEvent("click",{index:t})}}),t.delegate("li","mouseenter",function(){if(!e.ignoreUserEvent){var t=this.getAttribute("index");T.dom.addClass(this,"panoAlbum-item-on"),void 0!==t&&e.dispatchEvent("mouseenter",{index:t})}}),t.delegate("li","mouseleave",function(){if(!e.ignoreUserEvent){var t=this.getAttribute("index");T.dom.removeClass(this,"panoAlbum-item-on"),void 0!==t&&e.dispatchEvent("mouseleave",{index:t})}}),baidu(this.leftArrow).on("click",function(){if(!e.ignoreUserEvent){e.stopScroll();var t=1e3*Math.abs(e.maxScrollLeft-e.minScrollLeft)/(30*e.velocity);e.scrollTo(e.scrollLeft+e.viewWidth,!1,!0,t,function(){e.scroll(-1)})}}),baidu(this.rightArrow).on("click",function(){if(!e.ignoreUserEvent){e.stopScroll();var t=1e3*Math.abs(e.maxScrollLeft-e.minScrollLeft)/(30*e.velocity);e.scrollTo(e.scrollLeft+-e.viewWidth,!1,!0,t,function(){e.scroll(1)})}}),baidu(this.leftArrow).on("mouseenter",function(t){e.ignoreUserEvent||(e.scroll(-1),baidu.event.preventDefault(t))}),baidu(this.leftArrow).on("mouseleave",function(){e.stopScroll()}),baidu(this.rightArrow).on("mouseenter",function(t){e.ignoreUserEvent||(e.scroll(1),baidu.event.preventDefault(t))}),baidu(this.rightArrow).on("mouseleave",function(){e.stopScroll()}),this._window_Resize_handler=function(){e._timer&&clearTimeout(e._timer),e._timer=setTimeout(function(){e.resize()},100)},T.on(window,"resize",this._window_Resize_handler)},getCurrentLiPosition:function(e){var t=e*this.itemOuterWidth+this.scrollLeft+this.itemWidth/2+30,i=document.body.clientHeight-this.container.offsetHeight-10;return{x:t,y:i}},resize:function(e){{var t=this.data||[],i=e||document.body.clientWidth-this.parentElem.offsetLeft;this.viewWidth+60}this.viewWidth=i-60,this.itemOuterWidth=this.itemWidth+this.itemMargin+2;var o=t.length*this.itemOuterWidth;this.minScrollLeft=this.viewWidth-t.length*this.itemOuterWidth,this.scrollDistance=Math.floor(this.viewWidth/this.itemOuterWidth)*this.itemOuterWidth,this.maxAnimationDistance=this.scrollDistance+30,this.container.style.width=i+"px",this.albumContainer.style.width=this.viewWidth+"px",this.albumWraper.style.width=o+"px",checkArrowStatus(this.scrollLeft||0,this.minScrollLeft,this.maxScrollLeft,this.leftArrow,this.rightArrow)},unselect:function(){this.selectedIndex=void 0,baidu.dom.remove("selected-border")},setSelectIndex:function(e){baidu.dom.remove("selected-border");var t=baidu(this.albumWraper).find("li"),i=t[e];if(i){this.selectedIndex=e;var o=baidu.dom.create("div",{id:"selected-border","class":"selected-item"});o.style.height=this.itemHeight-6+"px",o.style.width=this.itemWidth-6+"px",o.style.zoom=1,i.appendChild(o),this.fitImage(e)}},getSelectIndex:function(){return this.selectedIndex},fitImage:function(e){if(this.canScroll){var t=this,i=baidu(this.albumWraper).find("li"),o=i[e];if(o){var n=this.itemOuterWidth*e,r=n+this.itemOuterWidth,a=-this.scrollLeft;if(!(n>=a&&r<=a+this.viewWidth))if(a>n){var l=1e3*Math.abs(n+t.scrollLeft)/t.velocity;this.scrollTo(-n,!1,!1,l)}else if(r>a+this.viewWidth){var s=n-(this.viewWidth-this.itemOuterWidth),l=1e3*Math.abs(s+t.scrollLeft)/t.velocity;this.scrollTo(-s,!1,!1,l)}}}},update:function(e){var t=this,i=this.data;this.data=e;var o=e?e.length:0,n=o*this.itemOuterWidth;this.minScrollLeft=this.viewWidth-o*this.itemOuterWidth,this.scrollDistance=Math.floor(this.viewWidth/this.itemOuterWidth)*this.itemOuterWidth,this.canScroll=n<=this.viewWidth?!1:!0,checkArrowStatus(this.scrollLeft||0,this.minScrollLeft,this.maxScrollLeft,this.leftArrow,this.rightArrow),t._currentIndex=-1;var r=e,a=baidu.g(this.albumWraper);a.style.zIndex=1;var l=this.itemWidth,s=this.itemHeight,p=this.itemOuterWidth,u=[];if(this.fadeInOutEffectAnim&&this.fadeInOutEffectAnim.stop(!0),i){var d=a.getElementsByTagName("li");if(d=util.converToArray(d),util.each(r,function(e,t){var o=i[t];if(o)if(o.src==e.src&&o.name==e.name);else{var n=d[t],r=createAlbumItem(l,s,e.src,e.icon,e.name);r.setAttribute("index",t),r.style.left=p*t+"px",a.insertBefore(r,n),u.push(n),n.parentNode.removeChild(n)}else{var r=createAlbumItem(l,s,e.src,e.icon,e.name);r.setAttribute("index",t),r.style.left=p*t+"px",a.appendChild(r)}}),r.length<i.length)for(var o=i.length,m=r.length;o>m;)a.removeChild(d.pop()),o--;if(util.each(u,function(e){a.appendChild(e)}),u.length>0){var h=function(){for(var e;u.length>0;)e=u.pop(),e.parentNode.removeChild(e);t.fadeInOutEffectAnim=null};this.fadeInOutEffectAnim=fadeInOutEffect([],u,800,h)}}else util.each(r,function(e,t){var i=createAlbumItem(l,s,e.src,e.icon,e.name);i.setAttribute("index",t),i.style.left=p*t+"px",a.appendChild(i)});(this.scrollLeft>this.maxScrollLeft||this.scrollLeft<this.minScrollLeft)&&this.scrollTo(0,!0)},scrollTo:function(e,t,i,o,n){var r=baidu.g(this.albumWraper),a=this.scrollLeft;e=Math.min(this.maxScrollLeft,Math.max(this.minScrollLeft,e)),!i&&(t||Math.abs(a-e)>this.maxAnimationDistance)?r.style.left=e+"px":move(r,a,e,n,o),this.scrollLeft=e},scrollBy:function(e,t){var i=this.scrollLeft+e;this.scrollTo(i,t)},scroll:function(e){var t=this;if(e>0){var i=1e3*Math.abs(this.scrollLeft-this.minScrollLeft)/this.velocity;this.scrollTo(this.minScrollLeft,!1,!0,i,function(){checkArrowStatus(t.scrollLeft,t.minScrollLeft,t.maxScrollLeft,t.leftArrow,t.rightArrow)})}else{var i=1e3*Math.abs(this.scrollLeft)/this.velocity;this.scrollTo(this.maxScrollLeft,!1,!0,i,function(){checkArrowStatus(t.scrollLeft,t.minScrollLeft,t.maxScrollLeft,t.leftArrow,t.rightArrow)})}},stopScroll:function(){if(animation){animation.stop(),animation=null;var e=baidu.g(this.albumWraper);this.scrollLeft=parseInt(e.style.left.replace("px","")),checkArrowStatus(this.scrollLeft,this.minScrollLeft,this.maxScrollLeft,this.leftArrow,this.rightArrow)}},getFloorInfo:function(e){var t=this;if(t._opts.floorData)for(var i=t._opts.floorData.floors,o=0,n=i.length;n>o;o++)for(var r=i[o],a=r.Points,l=0,s=a.length;s>l;l++){var p=a[l];if(e==p.PID)return{floor:r.Floor+"",floorsData:r}}return{floor:null,floorsData:null}},dispose:function(){baidu.dom.remove("panoGuideAlbum"),baidu.un(window,"resize",this._window_Resize_handler)}}),module.exports=AlbumComponent});
;define("common:widget/pano/component/FoldPanelComponent/FoldPanelComponent.js",function(t,e,i){function n(t,e,i){T.lang.Class.call(this);var n=this._opts=s.merge(f,i);this._parentNode=e,this._titleNode=t,this._anim=null,this.status=u.folded;var o=this._panelContainer=document.createElement("div");o.className="fold-panel-container";var l=this._contentContainer=document.createElement("div");l.setAttribute("role","contentContainer"),l.className="fold-panel-content",l.style.cssText=["position:absolute","padding:"+p].join(";");var a=this._contentHeader=document.createElement("div");a.style.cssText=["position: relative","z-index: 2"].join(";"),l.appendChild(a);var r=this._contentWapper=document.createElement("div");r.className="content-wapper",l.appendChild(r);var h=this._bgDom=document.createElement("div");h.className="fold-panel-bg";var d=[("left"==n.align?"left":"right")+":0"];s.isIE()?(d.push("filter:alpha(opacity=90)"),d.push("_filter:alpha(opacity=90)"),d.push("background-color:rgb("+n.backgroundColor+")")):d.push("background-color:rgba("+n.backgroundColor+", "+n.backgroundOpacity+")"),h.style.cssText=d.join(";"),l.appendChild(h);var m=this;s.each(c,function(t){T.on(o,t,function(e){m.dispatchEvent(t,e)})}),this._autoFoldTimer=null;var g=!1,y=function(){m.cancelDelayAction(),g||m.expand()},_=function(){m.cancelDelayAction(),g||(m._autoFoldTimer=setTimeout(function(){m.fold()},m._opts.foldDelay))};this.ignoreMouseEvent=function(t){g=!!t},m.addEventListener("mouseenter",y),m.addEventListener("mouseleave",_),T.on(t,"mouseenter",y),T.on(t,"mouseleave",_),o.appendChild(l),e.appendChild(o),this._titleNode.style.display="none"}var o=t("common:widget/ui/Animation/Animation.js"),s=t("common:widget/pano/base/util.js"),l=t("common:widget/pano/component/ScrollView/ScrollView.js");t.loadCss({content:".fold-panel-container{overflow:hidden;height:0;position:absolute;border-top:1px solid #53565d}.fold-panel-bg{z-index:0;position:absolute;width:100%;top:0;border-bottom-right-radius:2px;border-bottom-left-radius:2px}.content-wapper{z-index:10;position:relative}.fold-panel-content .scrollbar-y,.fold-panel-content .scrollbar-y-thumb-prev,.fold-panel-content .scrollbar-y-thumb-next,.fold-panel-content .scrollbar-y-prev,.fold-panel-content .scrollbar-y-next{background-image:none}.fold-panel-content .scrollbar-y-prev,.fold-panel-content .scrollbar-y-next{width:14px}.fold-panel-content .tangram-scrollbar-slider{margin:0 auto;border-radius:20px;background-color:#292c2f;opacity:.95;width:6px}.fold-panel-content .scrollbar-y-thumb-btn{margin:0 auto;width:4px;background:#B3B9C3;opacity:.3;border-radius:10px}",name:"FoldPanelComponent"});var a=150,r=100,h=300,d=40,c=["mouseenter","mouseleave","mouseover","mouseout","click"],p="6px 0",u={expanded:2,folded:-2,playing:1},f={backgroundColor:"37,37,37",backgroundOpacity:"0.9",foldDelay:1500,panelWidth:"auto",maxHeight:400,align:"right"},m=function(){},g=function(t,e,i,n,s){var l,c,p,u=t._titleNode,f=20,g=u.clientWidth,y=t._bgDom,_=y.clientHeight,b=y.clientWidth,v=n>i,C=!v,x=function(){v?(y.style.width=b+"px",y.style.height=_+"px",y.style.top=""):(y.style.width=b+"px",y.style.height="0",y.style.top="",y.parentNode.firstChild.style.visibility=""),s&&s()},w=function(){var e=new o.Animation,i=(t._bgDom.clientWidth,-f);return v&&(y.style.width=g+"px",y.style.height=f+"px",i=parseInt(_)+i,y.style.top=i+"px"),e.build({onStop:v?x:m,fps:d,delay:o.Animation.INFINITE,duration:a,render:function(t){try{C&&(t=1-t),y.style.top=i+f*t+"px"}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/component/FoldPanelComponent/FoldPanelComponent.js",ln:101})}},finish:function(){C&&(y.style.width=b+"px",y.style.height=_+"px",y.style.top="",y.parentNode.firstChild.style.visibility="")}}),e},D=function(){var t=new o.Animation,e=b-g;return t.build({delay:o.Animation.INFINITE,fps:d,duration:r,render:function(t){try{C&&(t=1-t),y.style.width=g+e*t+"px"}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/pano/component/FoldPanelComponent/FoldPanelComponent.js",ln:128})}},finish:function(){v?(y.style.width=b+"px",y.style.height=_+"px",y.style.top=""):y.parentNode.firstChild.style.visibility="hidden"}}),t},N=function(){var s=new o.Animation,l=t._contentContainer,a=n-i;return s.build({onStop:C?x:m,delay:o.Animation.INFINITE,fps:d,transition:o.Transitions["ease-out"],duration:h,render:function(t){try{C||(T(l).find(".tangram-scrollpanel").css("visibility","visible"),T(l).find(".pano_poi_content").css("visibility","visible")),l.style[e]=i+a*t+"px"}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/component/FoldPanelComponent/FoldPanelComponent.js",ln:159})}},finish:function(){T(l).find(".tangram-scrollpanel").css("visibility","hidden"),T(l).find(".pano_poi_content").css("visibility","hidden")}}),s};return y.parentNode.firstChild.style.visibility="","top"===t._opts.align?(p=N(),p.setFinishCallback(s),p.start(),p):v?(i+=f,l=w(),c=D(),p=N(),l.add(c),l.add(p),l.setFinishCallback(s),l.start(),l):(n+=f,l=w(),c=D(),p=N(),p.add(c),p.add(l),p.setFinishCallback(s),p.start(),p)};baidu.lang.inherits(n,baidu.lang.Class),T.object.extend(n.prototype,{setTitle:function(t){var e=this._titleNode;if(!t)return void(e.style.display="none");for(;e.lastChild;)e.removeChild(e.lastChild);if("string"==typeof t){var i=t;t=document.createElement("div"),t.innerHTML=i}e.style.display="",this._testTitle=t,e.appendChild(t)},setContentHeader:function(t){"string"==typeof t&&(t=s.trim(t),t=T(t)[0]);for(var e=this._contentHeader;e.lastChild;)e.removeChild(e.lastChild);e.appendChild(t)},setContent:function(t,e){for(var i=(this._contentWapper,this._contentWapper);i.lastChild;)i.removeChild(i.lastChild);"string"==typeof t&&(t=s.trim(t),t=T(t)[0]),t&&i.appendChild(t),i.style.height="auto",this._contentContainer.style.height="auto";var i=this._contentWapper,n=i.offsetHeight;if(0===n){var o=s.getDomSize(i);n=o.height}var a=e||this._opts.maxHeight,r=s.getDomSize(this._contentHeader);if(a-=r.height,n>a){if(i.style.height=a+"px",!this._scrollView){this._scrollView=new l(i,{overflow:"overflow-y",autoUpdate:!1});var h=T(this._contentContainer).find(".tangram-scrollpanel-main")[0];h.style.zIndex="1",h.style.position="relative"}}else i.style.height=n;this._scrollView&&this._scrollView.update(),this._panelContainer.style.height=this._bgDom.style.height=this._contentContainer.offsetHeight+"px",this.resize(),this._testContent=i.children[0]},setPosition:function(t,e){this._panelContainer.style.left=t+"px",this._panelContainer.style.top=e+"px"},toggle:function(){return this.status>0?this.fold():this.expand()},expand:function(t){this.cancelDelayAction();var e=this,i=this._contentContainer,n=this._ch,o=-n;t&&(e._autoFoldTimer=setTimeout(function(){e.fold()},t)),this.status>0||-1!==this.status&&(this.status=u.playing,this._panelContainer.style.height=this._bgDom.style.height=n+"px",this._panelContainer.style.width=this._bgDom.style.width=i.offsetWidth+"px",this._panelContainer.style.borderTop="1px solid #53565d",this.dispatchEvent("before_expand"),this._contentContainer.style.top=-n+"px",this._anim=g(this,"top",o,0,function(){e.status=u.expanded,e.dispatchEvent("after_expand")}))},fold:function(t){this.cancelDelayAction();var e=0;if(t)return this._anim&&this._anim.stop(!0),this.status=u.folded,this._panelContainer.style.height=this._bgDom.style.height="0",this._panelContainer.style.border="0",this.dispatchEvent("before_fold"),void this.dispatchEvent("after_fold");if(!(this.status<0)&&1!==this.status){var i=this;this.status=-u.playing,this.dispatchEvent("before_fold"),this._anim=g(this,"top",e,-this._panelContainer.clientHeight,function(){i.status=u.folded,i._panelContainer.style.height=i._bgDom.style.height="0",i._panelContainer.style.border="0",i.dispatchEvent("after_fold")})}},setAlign:function(t){var e=this._bgDom;e.style.left="",e.style.right="","left"===t||"top"===t?this._bgDom.style.left="0":this._bgDom.style.right="0",this._opts.align=t},resize:function(){this._scrollView&&this._scrollView.update();var t=s.getDomSize(this._contentContainer);this._cw=t.width,this._ch=t.height,this._scrollView&&(this._cw+=this._scrollView.getScrollBarWidth())},cancelDelayAction:function(){this._autoFoldTimer&&clearTimeout(this._autoFoldTimer)},scrollTo:function(t){this._scrollView&&this._scrollView.scrollTo(t)},getScrollValue:function(){return this._scrollView?this._scrollView.getScrollValue():void 0},getViewSize:function(){return{width:this._contentWapper.clientWidth,height:this._contentWapper.clientHeight}},$:function(t){return T(t,this._contentWapper)},dispose:function(){this.cancelDelayAction(),this._anim&&this._anim.stop(!0),T.dom(this._panelContainer).off(),y=null,T.lang.Class.prototype.dispose.call(this)},save:function(){y={contentDom:this._testContent.cloneNode(!0),titleDom:this._testTitle.cloneNode(!0)}},restore:function(){this.cancelDelayAction(),this._anim&&this._anim.stop(!0),y?(this.setTitle(y.titleDom),this.setContent(y.contentDom)):(this.setTitle(""),this.setContent("")),this.fold(!0)}});var y=null;i.exports=n});
;define("common:widget/pano/model/PanoPoi.js",function(n,e,o){var i=n("common:widget/pano/base/util.js"),t=n("common:widget/pano/base/service.js"),r={},a=function(n){var e={};for(var o in n)e[o.toLowerCase()]=n[o];return e},u=function(n,e,o,i){if(o=o||10,i=i||4,o>=e)return null;n++;var t=Math.ceil(e/o);if(n>t)throw new Error("erro page num");var r,a=[],u=0;if(t-n>=i/2)for(r=n-Math.floor(i/2);a.length<i&&t>=r&&(r>0&&a.push(r),r++,u++,!(u>1e3)););else for(r=t;a.length<i&&r>0&&(a.unshift(r),r--,u++,!(u>1e3)););var c=!1;return{text:a,max:t,index:n,pageSize:o,hasHome:c,hasPrev:n>1?!0:!1,hasNext:t>n?!0:!1}},c={poi:function(n){var e=0;n.ext&&n.ext.other_info&&n.ext.other_info.base&&(e=n.ext.other_info.base.length);var o={name:n.name,poi_type:n.poiType,addr:n.addr,tel:n.tel,uid:n.uid,sid:n.pano&&n.street_id?n.street_id:void 0,src:n.ext?n.ext.src_name:void 0,movie_count:e,city:n.city_id,hasIndoor:!!n.indoor_pano};if(n.geo){var i=n.geo.split("|").pop().replace(";","").split(",");o.x=parseInt(i[0]),o.y=parseInt(i[1])}return o},hotel:function(n){var e=[],o=n.room_info;try{var t=window.place.hotel?window.place.hotel:window.place;t.otaDataDecode(o||[])}catch(r){i.log("ota decode failed"),o=[]}var a=function(n){try{var e={};return e.roomTypeName=n.basic_info.room_type_name,e.roomId=n.basic_info.room_id,i.each(n.ota_list,function(n){i.each(n.price_info,function(n){var n=parseInt(n.room_price.price)-parseInt(n.minus&&n.minus.price||0)-parseInt(n.coupons&&n.coupons.price||0)+parseInt(n.tax_info&&n.tax_info.price||0);e.price=e.price?e.price>n?n:e.price:n})}),e}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/model/PanoPoi.js",ln:167})}};return i.each(o,function(n){var o;return 2==e.length?!0:void((1==n.basic_info.book_state||2==n.basic_info.book_state)&&(o=a(n),o.roomTypeName&&o.price&&e.push(o)))}),e.length<2&&i.each(o,function(n){var o;return 2==e.length?!0:void(1!=n.basic_info.book_state&&2!=n.basic_info.book_state&&(o=a(n),o.roomTypeName&&o.price&&e.push(o)))}),0==e.length&&e.push({roomTypeName:"标准间",priceInfo:"暂无报价"}),e},movie:function(n){var e=i.each(n,function(n){return{id:n.movie_id,name:n.movie_name,type:n.movie_type,price:n.price||n.origin_price}},!0);return e},pano:a,guide:a,busline:function(n){function e(n){return n=n.match(/[\u4e00-\u9fa5\d]*/)[0]}function o(n,e){var o=90-180*Math.atan2(n.y-e.y,n.x-e.x)/Math.PI;return 0>o&&(o+=360),o}var t={};return n&&(t.buslineName=e(n.buslineName),t.buslineFullName=n.buslineName,t.stations=i.each(n.stations,function(e,i){e.stationName=i+1+"&nbsp;&nbsp;"+e.name;var t=e.pano;if(!t)return e;var r=o({x:e.point.x,y:e.point.y},{x:t.PanoX,y:t.PanoY});return e.pano={poiuid:e.uid,pid:t.PID,name:e.name,index:-1,dir:r,pitch:0,x:e.point.x,y:e.point.y,panox:t.PanoX,panoy:t.PanoY,rank:100,catalog:n.catalog},e},!0)),t},indoorPoi:function(n){if(n.content.base.address||n.content.base.phone){var e=n.content.lvyou;return e&&(e.entrance_price&&e.shop_hours||e.sug_time||e.best_time)||delete n.content.lvyou,n.content}return null}},s=function(n,e){return r[n]?r[n]:(n||(this.poi=null,this.hotel=null,this.pano=null,this.movie=null),r[n]=this,this._uid=n,void(this._cityCode=e))};s.prototype={getUid:function(){return this._uid},extend:function(){var n=Array.prototype.slice.call(arguments,0),e=this._uid,o=this,r=i.each(n,function(n){switch(n){case p.poi:return void 0!==o.poi?void 0:t.getPanoPoiInfoByUid(e).then(function(e){o.poi=c[n](e.content)});case p.pano:return void 0!==o.pano?void 0:t.getPanoInfoByUid(e).then(function(e){e=e.content[0].poiinfo,o.pano=c[n](e)});case p.hotel:return void 0!==o.hotel?void 0:t.getHotelInfoByUid(e).then(function(e){return 0!=e.errorNo?void(o.hotel=null):void(o.hotel=c[n](e))});case p.movie:return void 0!==o.movie?void 0:t.getMovieInfoByUid(e).then(function(e){return 0==e.length?void(o.movie=null):void(o.movie=c[n](e))});case p.indoorPoi:return t.getIndoorPoiInfoByUid(e).then(function(e){return e?void(o.indoorPoi=c[n](e)):void(o.indoorPoi=null)});case p.busline:return t.getBuslineByUid(e,o._cityCode).then(function(e){return e?void(o.busline=c[n](e)):void(o.busline=null)})}},!0);return T.when.apply(T,r)}};var p={poi:"poi",hotel:"hotel",movie:"movie",pano:"pano",busline:"busline",indoorPoi:"indoorPoi"};s.TYPE=p,s.getInstaceByPanoId=function(n){for(var e in r){var o=r[e];if(o.pano&&o.pano.pid===n)return o}return null},s.initWithPoiSearchResult=function(n){var e={},o=i.each(n.content,function(n,e){var o=new s(n.uid);return o.poi=c.poi(n),o.index=e,o},!0);e.content=o,e.wd=n.result.wd;var t=n.result;return e.pageInfo=u(t.page_num,t.total),e},s.initWithBuslineResult=function(n){var e={},o=i.each(n.stations,function(n,e){var o=new s(n.uid);return o.pano=n.pano,o.stationName=n.stationName,o.index=e,o},!0);return e.content=o,e.buslineName=n.buslineName,e},o.exports=s});
;define("common:widget/pano/model/IndoorData.js",function(t,i,o){var n=t("common:widget/pano/base/CatalogMap.js"),a=t("common:widget/pano/base/util.js"),r=t("common:widget/pano/base/service.js"),e={unfetch:1,fetching:2,fetched:3},s={},h=function(t,i){var o=Math.cos(i*Math.PI/180),n=Math.sin(i*Math.PI/180),a=t.x*o-t.y*n,r=t.x*n+t.y*o;return{x:a,y:r}},u=function(t,i){var o=t.imgwidth,n=t.imgheight,r=t.scale,e=360-t.northdir,s=t.ltpoint,u=Math.ceil(Math.log(o/256)/Math.log(2))+1,c=Math.ceil(Math.log(n/256)/Math.log(2))+1,d=Math.min(u,c),f=Math.ceil((d+1)/2),l=256*Math.pow(2,u-1),g=256*Math.pow(2,c-1),p=Math.floor(l-o)/2,_=Math.floor(g-n)/2,v=[],v=a.each(t.points,function(t){var i=(t.x-s.x)/100/r,o=(t.y-s.y)/100/r,n=h({x:i,y:o},e);return n.x=n.x+p,n.y=-n.y+_,{id:t.pid,pin:t.pin,name:t.name,catlog:t.catalog,panox:t.x/100,panoy:t.y/100,x:n.x,y:n.y,defaultAngle:0}},!0);return{realFloor:t.floor,floor:i,width:l,height:g,points:v,zoomLevel:d,defZoom:f,startid:t.startid,uid:t.startid}},c=function(t){var i=t.entrances&&t.entrances[0]&&t.entrances[0].uid?t.entrances[0]:t;return{x:i.breakx/100,y:i.breaky/100,pid:i.breakid}},d=function(t){var i={},o=[];a.each(t,function(t){a.each(t.points,function(t){if(t.catalog){var o=n.getCatalogInfo(t.catalog);i[o.label]||(i[o.label]=[]),i[o.label].push(t)}})});for(var r in i)o.push({id:1*i[r][0].catalog,label:r,points:i[r]});return o.sort(function(t,i){return t.id>i.id?1:-1}),o},f=function(t){return"f53e5bf37bf62ebfb34c4992"===t.iid,{pid:t.pid,imagetype:void 0===t.imagetype?t.hasimg:t.imagetype,poiuid:t.uid,exitInfo:c(t),floors:a.each(t.floors,u,!0),catalogInfo:d(t.floors)}},l=function(t,i){return s[t]?s[t]:(s[t]=this,this._iid=t,this._data={},this._status=e.unfetch,this._fetchPromise=null,this._currentFloor=void 0,void(i||this.fetch()))};l.prototype={fetch:function(t){if(this._status==e.unfetch){this._status=e.fetching;var i=this;this._fetchPromise=r.getIndoorData(this._iid).then(function(t){return void 0===t?void(i._basicData=void 0):(i._basicData=t,i._currentFloor=Math.max(t.defaultfloor-1,0),i._data=f(t),i._status=e.fetched,i._data)})}return t&&this.onLoad(t),this},isLoaded:function(){return this._status===e.fetched},getIID:function(){return this._iid},onLoad:function(t){return this.isLoaded()?t():this._fetchPromise.then(t),this},setCurrentPid:function(t){var i=this.getFloorInfo(),o=void 0,n=void 0;return a.each(i,function(i,r){return a.each(i.points,function(i,a){return i.id==t?(o=r,n=a,!0):void 0}),void 0===o&&i.startid===t?(o=r,!0):void 0!==o?!0:void 0}),this._currentPoint=n,this._currentFloor=void 0===o?this._basicData.defaultfloor-1:o,this._currentFloor<0&&(this._currentFloor=0),o},getExitInfo:function(){return this._data.exitInfo},getFloorInfo:function(t){return 0===arguments.length?this._data.floors:this._data.floors[t]},getPointInfo:function(t,i){return this._data.floors[t].points[i]},getBasicData:function(){return this._basicData},getCurrentFloor:function(){return this._currentFloor},getCurrentPoint:function(){return this._currentPoint},hasIndoorData:function(){return void 0!==this._basicData},hasPlanMap:function(){return 1==this._data.imagetype},has2DMap:function(){return 2==this._data.imagetype},getCatalogList:function(){return this._data.catalogInfo},getCurrentPointData:function(){var t=this.getPointInfo(this._currentFloor,this._currentPoint),i={pid:t.id,x:t.panox,y:t.panoy};return i},getCurrentFloorData:function(){var t=this.getFloorInfo(this._currentFloor),i=this.getExitInfo(),o=a.copy(t);if(o.innerId=this._iid,o.poiuid=this._data.poiuid,o.hasImage=this.hasPlanMap()?1:0,o.floor=this._currentFloor+1,o.x=i.x,o.y=i.y,o.pid=i.pid,void 0!==this.getCurrentPoint()){var n=this.getPointInfo(this.getCurrentFloor(),this.getCurrentPoint());o.currentPid=n.id}return o},get2DMapData:function(){return{mode:"day",panoHeading:0,panoId:this._basicData.breakid,panoMCPoint:{x:this._basicData.breakx/100,y:this._basicData.breaky/100},panoPitch:0,panoType:"inter",panoZoom:1}},getTopologyPoints:function(){var t=this.getFloorInfo(this._currentFloor),i=a.each(t.points,function(t){return t.pin?t:void 0},!0);return i},equal:function(t){return t instanceof l&&this.getIID()===t.getIID()?!0:!1}},o.exports=l});
;define("common:widget/pano/module/PanoShareModule/PanoShareModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),PanoShareUtil=require("common:widget/pano/module/PanoShareModule/PanoShareUtil.js"),style='#pano-share-panel{position:absolute;right:45px;width:380px;height:95px;z-index:100010;padding:0 15px;color:#fff;font-size:12px;background-color:#252525;opacity:.9;filter:alpha(opacity=90);_filter:alpha(opacity=90);border-radius:2px;font-size:12px}#pano-share-panel .left-area{float:left;width:74px}#pano-share-panel .right-area{float:left;width:302px}#pano-bin-code{visibility:hidden;margin-top:14px}#pano-share-panel .head{height:20px;line-height:20px;margin-top:10px;margin-bottom:6px;width:100%;color:#d3d8db}#pano-share-panel .close{float:right;width:18px;height:18px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons_249d710.png) no-repeat -108px -16px;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons-8_0ec7deb.png) no-repeat -108px -16px}#pano-share-panel .close:hover{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons_249d710.png) no-repeat -126px -18px;cursor:pointer;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons-8_0ec7deb.png) no-repeat -126px -18px;cursor:pointer}#pano-share-panel .inputContainer{position:relative;float:left;vertical-align:middle}#pano-share-panel .inputContainer .input{width:240px;height:20px;text-indent:5px;background-color:#252525;border:1px #53565c solid;vertical-align:middle;color:#fff}#pano-share-panel #pano-share-msg{position:absolute;right:0;top:0;width:60px;height:22px;line-height:22px;text-align:center;color:#3af;font-size:12px;border:1px solid #3af;display:none}#pano-share-panel .copyContainer{position:relative;float:left;vertical-align:middle;width:45px;height:23px;margin-left:2px}#pano-share-panel .copyContainer .copyBack{position:absolute;left:0;top:0;width:45px;height:22px;line-height:22px;margin-left:2px;border:1px #53565c solid;color:#d3d8db;text-align:center;text-decoration:none;z-index:1}#pano-share-panel .btn{position:absolute;left:0;top:0;z-index:2;width:45px;height:22px}#pano-share-panel .btn:hover{cursor:pointer}#pano-baiduShare{margin-top:2px}#pano_bdshare{width:140px;height:30px;overflow:hidden;float:left}span.bds_more,.bds_tools a{font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif;height:16px;float:left;display:block;padding-top:6px;padding-bottom:3px;padding-left:22px}#pano_bdshare .bds_more{float:left;padding-top:6px;padding-left:0;color:#9da1a3;line-height:16px}span.bds_btn_arr{float:left;height:10px;width:10px;margin-top:10px;padding-bottom:3px;margin-left:4px;cursor:pointer;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons_249d710.png) 0 -54px no-repeat;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-icons-8_0ec7deb.png) 0 -54px no-repeat}.bds_tools a{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bdshare_d642b88.png);background-repeat:no-repeat;cursor:pointer}.bds_qzone{background-position:0 -85px!important}.bds_tsina{background-position:0 -125px!important}.bds_baidu{background-position:0 -165px!important}.bds_renren{background-position:0 -205px!important}.bds_tqq{background-position:0 -245px!important}.bds_kaixin001{background-position:0 -285px!important}.bds_hi{background-position:0 -365px!important}.bds_douban{background-position:0 -405px!important}.bds_tsohu{background-position:0 -445px!important}.bds_msn{background-position:0 -485px!important}.bds_fx{background-position:0 -525px!important}#bdshare_iwshare{margin-left:3px}#bdshare_iwshare.bds_tools{height:24px;_margin-top:-3px}#bdshare_iwshare.bds_tools a{padding-bottom:2px;+padding-bottom:4px}#bds_btn_arr_iwshare{_margin-top:-3px}';require.loadCss({content:style});var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="pano-share-panel"><div class="left-area"><img id="pano-bin-code" src="" width="66" height="66"/></div><div class="right-area"><div class="head"><a id="pano-share-close" href="javascript:void(0)" title="关闭" class="close"></a>您可将当前地图上的内容分享给好友</div><ul><li class="inputContainer"><input id="pano-shareLink" class="input" type="text"/><span id="pano-share-msg"></span></li><li class="copyContainer"><span class="copyBack">复制</span><a id="copeLinkBtn" class="btn" title="复制"></a></li></ul><div id="pano-baiduShare"></div></div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],PanoShareModule=ModuleClass.extend("PanoShareModule",{constructor:function(){this._opts=null},initialize:function(a){try{this._opts=a;var e=template(),n=T(e)[0],t=T.g("pano-share-btn");a.sharePanelClassName?n.className=a.sharePanelClassName:n.style.top=t.offsetTop+"px",a.parent.appendChild(n);var o=T.g("copeLinkBtn"),i=baidu.swf.createHTML({id:"linkBtnFlh",url:"../swf/fClipboard.swf"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/swf/fClipboard.swf*/,width:"48",height:"26",wmode:"transparent",ver:"9.0.0"});o.innerHTML=i,this.bindCloseEvent(),this.bindCopyEvent(),this.addBaiduShare(),this.getShortLink(),this.bindGlobalClickEvent()}catch(p){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:p.message||p.description,path:"common:widget/pano/module/PanoShareModule/PanoShareModule.js",ln:57})}},getSupportEvents:function(){return["dispose"]},showMessage:function(a){var e=baidu.g("pano-share-msg");e.style.display="block",e.innerHTML=a,setTimeout(function(){e.style.display="none"},1300)},bindCopyEvent:function(){function a(){var a=baidu.swf.getMovie("linkBtnFlh");a&&a.flashInit&&a.flashInit()&&(clearInterval(n),a.setHandCursor(!0),a.setContentFuncName("pano_share_copy_getPasteData"))}var e=this,n=(T.G("pano-shareLink"),setInterval(a,500));window.pano_share_copy_getPasteData=function(){var a=T.G("pano-shareLink");return a?(e.showMessage("复制成功"),a.value):void 0}},bindCloseEvent:function(){var a=this;baidu.event.on("pano-share-close","click",function(){a.dispatchEvent("dispose")})},bindGlobalClickEvent:function(){var a=this,e=T.g("pano-share-panel");window.pano_share_global_click_handler=function(n){for(var t=n.srcElement||n.target;t;){if(t==e)return;if(t==document.body)return a.dispatchEvent("dispose"),T.un(document.body,"mousedown",window.pano_share_global_click_handler),void(window.pano_share_global_click_handler=null);t=t.parentNode}},T.on(document.body,"mousedown",window.pano_share_global_click_handler)},getShortLink:function(){var a=this._opts,e={data:a.context.panoContext.getPanoOptions(),iid:a.context.panoContext.getInnerId(),level:a.context.mapContext.getLevel(),shareParam:a.shareParam},n=PanoShareUtil.prepareShareParam(e);PanoShareUtil.getLink(n,function(a){baidu.g("pano-shareLink").value=a}),n.from="2dc",PanoShareUtil.getLink(n,function(a){var e=document.getElementById("pano-bin-code");e.src=PanoShareUtil.get2DCode(a),e.style.visibility="visible"})},addBaiduShare:function(){var a=this,e=baidu.g("pano-baiduShare"),n=T.G("pano-shareLink"),t=a._opts.context.panoContext.getPanoOptions();PanoShareUtil.creatShare(e,function(){return{data:t,roadName:a._opts.context.panoContext.getCurrentRoad(),link:n.value}})},dispose:function(){T.g("pano-share-panel")&&baidu.dom.remove("pano-share-panel")},event_panoChanged:function(a){var e=this,n=e._map,t=e._opts,o=a.data.panoType||"inter";e._currentPanoType!=o?(n.destroyAll(),e._reset(),t.data=a.data,e.create(o,t)):n.event_panoChanged&&n.event_panoChanged(a)}});module.exports=PanoShareModule});
;define("common:widget/pano/module/PanoShareModule/PanoShareUtil.js",function(e,n,t){var o=e("common:widget/ui/config/config.js"),a=o.urlConfig,r={SHARE_PROC_URL:"http://j.map.baidu.com/",getShareKeyList:function(){return{tsina:{title:"分享到新浪微博",code:1307,cbkcode:1317},tqq:{title:"分享到腾讯微博",code:1308,cbkcode:1318},qzone:{title:"分享到QQ空间",code:1306,cbkcode:1316},renren:{title:"分享到人人网",code:1309,cbkcode:1319},baidu:{title:"分享到百度搜藏",code:1310,cbkcode:1320},kaixin001:{title:"分享到开心网",code:1311,cbkcode:1321},hi:{title:"分享到百度空间",code:1312,cbkcode:1322},douban:{title:"分享到豆瓣网",code:1313,cbkcode:1323},tsohu:{title:"分享到搜狐微博",code:1314,cbkcode:1324},msn:{title:"分享到Myspace",code:1315,cbkcode:1325},fx:{title:"分享到飞信",code:1326,cbkcode:1327}}},getLink:function(e,n){var t=[];for(var o in e)null!=e[o]&&t.push(o+"="+e[o]);var a="http://map.baidu.com/?newmap=1&shareurl=1&"+t.join("&"),r=this.SHARE_PROC_URL+"?url="+encodeURIComponent(a)+"&web=true",i=!1;T.jsonp(r,function(e){i=!0,n(e&&e.url||a)}),setTimeout(function(){0==i&&n(a)},3e3)},get2DCode:function(e){var n=a.PANO_URL+"?qt=qrcode&width=66&url=";return n+encodeURIComponent(e)},creatShare:function(e,n){var t=this,o=this.getShareKeyList(),a=['<div id="pano_bdshare" class="bds_tools"><span class="bds_more">分享到：</span>'];for(var r in o){var i=o[r].title;a.push('<a _key="'+r+'" class="bds_'+r+'" title="'+i+'"></a>')}a.push('</div><span class="bds_btn_arr" id="pano_bds_btn_arr" title="更多网站"></span>'),e.innerHTML=a.join("");{var c=T.G("pano_bdshare"),d=T.G("pano_bds_btn_arr");c.getElementsByTagName("a")}d.onclick=function(){var e=178,n=120,o=15,a=0;!function r(){o>a&&(a++,c.style.width=Math.ceil(t._tween(a,e,n,o))+"px",setTimeout(r,10))}(),d.style.display="none"},T.on(c,"click",function(e){var o=e.target||e.srcElement,a=o.getAttribute("_key");o&&a&&t._openLink(window.open("about:blank"),a,n)})},_tween:function(e,n,t,o){return t*((e=e/o-1)*e*e+1)+n},_openLink:function(e,n,t){if(e){var o=t(),a=this._getShareInfo(o.roadName,o.link),r=a.text,i=(a.point,o.link+"#bshare-"+n);"fx"==n&&(i=i);var c="";("qzone"==n||"tsohu"==n)&&(imgSrc="../../../../../map.baidu.com/image/logo-map.png"/*tpa=http://map.baidu.com/image/logo-map.png*/),imgSrc=this.getPanoShare3DImageUrl(o.data),c=r;var d={to:n,url:i,pic:imgSrc,title:r,type:"text",desc:c,comment:" ",key:""};"tsina"==n&&(d.key="3694297746"),"tqq"==n&&(d.key="801199301");var p="http://share.baidu.com/s?"+this._jsonToQuery(d,encodeURIComponent);"renren"==n&&(d={resourceUrl:i,pic:imgSrc,title:r,description:c,charset:"UTF-8"},p="http://widget.renren.com/dialog/share?"+this._jsonToQuery(d,encodeURIComponent));try{e.location.href=p,e.focus()}catch(s){}}},_getShareInfo:function(e,n){{var t=e||"",o="【百度全景】";this.cinfo}return{text:t+" "+n+" "+o}},_jsonToQuery:function(e,n){var t=[];n=n||function(e){return e};for(var o in e){var a=e[o];""!=a&&null!=a&&"undefined"!=typeof a&&t.push(o+"="+n(a))}return t.join("&")},getPanoShare3DImageUrl:function(e){var n=a.PANO_URL+"?qt=share",t={panoid:e.panoId,heading:e.panoHeading,pitch:e.panoPitch,fovy:75,width:460,height:250,watermark:"baidumap",quality:80};for(var o in t)n=n+"&"+o+"="+t[o];return n},prepareShareParam:function(e){var n=e.data,t=n.panoMCPoint,o=(100*t.x+","+100*t.y,e.iid),a="";a="inter"===n.panoType?o:n.panoId;var r={panoid:a,panotype:n.panoType,heading:n.panoHeading,pitch:n.panoPitch,l:e.level,tn:"B_NORMAL_MAP",sc:0,newmap:1,shareurl:1};"inter"==n.panoType?(r.pid=n.panoId,r.iid=o):r.pid=n.panoId;var i={},c=!1;if(e.shareParam){for(var d in e.shareParam)(void 0!==e.shareParam[d]||null!==e.shareParam[d])&&(c=!0,i[d]=e.shareParam[d]);c&&(r.psp=encodeURIComponent(T.json.stringify(i)))}if(i.TrafficModule&&window.currentComponent&&("NavTrans"==currentComponent.name||"BusTrans"==currentComponent.name||"NavWalk"==currentComponent.name)){var p=window.currentComponent,s=p.modelQuery.replace(/&b=\((-?\d+)(\.\d+),(-?\d+)(\.\d+);(-?\d+)(\.\d+),(-?\d+)(\.\d+)\)/gi,"");r.s=encodeURIComponent(decodeURIComponent(s))}return r}};t.exports=r});
;define("common:widget/pano/module/PanoModule/FlashRender/FlashUtil.js",function(e,t,r){var n=function(){function e(){this._ie=(window.ActiveXObject||"ActiveXObject"in window)&&!window.opera,this._objDefAttrs=this._ie?' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"':' type="application/x-shockwave-flash"',this._objAttrKeys=["id","width","height","align","data"],this._objParamKeys=["wmode","movie","flashvars","scale","quality","play","loop","menu","salign","bgcolor","base","allowscriptaccess","allownetworking","allowfullscreen","seamlesstabbing","devicefont","swliveconnect"]}return baidu.extend(e.prototype,{create:function(e,t){var r=this._genHtml(e);t&&"string"==typeof t&&(t=document.getElementById(t)),t?t.innerHTML=r:document.write(r)},remove:function(e){var t=this.getSwf(e);if(t&&this._ie){t.style.display="none";for(var r in t)"function"==typeof t[r]&&(t[r]=null);window.CollectGarbage&&setTimeout(window.CollectGarbage,0)}t.parentNode.removeChild(t)},getFlashPlayerVersion:function(){var e=this,t=function(){var r=function(){var t=navigator;if(t.plugins&&t.mimeTypes.length){var r=t.plugins["Shockwave Flash"];if(r&&r.description)return r.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(e._ie)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(n){var a=n.GetVariable("$version");return a.replace(/WIN/g,"").replace(/,/g,".")}}catch(i){}}();return t=function(){return r},r};return t()},getSwf:function(e){return document.getElementById(e)},_compareVersion:function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length),n=0;r>n;n++){var a=e[n],i=t[n];if(!a||!i)return a||i?a?1:-1:0;if(a=Number(a),i=Number(i),i>a)return-1;if(a>i)return 1}return 0},_genHtml:function(e){if(e=e||{},e.movie=e.url||"",e.altHtml=e.errorMessage||"",e.vars){var t=e.vars,r=[],n=null,a=null;for(n in t)a=t[n],r.push(n+"="+encodeURIComponent(a));e.flashvars=r.join("&")}e.minVer=e.ver;var i,o,s=e.minVer,l=e.maxVer;if(s||l){var c=this.getFlashPlayerVersion();if(!c||s&&this._compareVersion(c,s)<0||l&&this._compareVersion(c,l)>0)return e.altHtml||""}var h=["<object",this._objDefAttrs];for(e.data=e.movie,i=0;i<this._objAttrKeys.length;i++)o=this._objAttrKeys[i],e.hasOwnProperty(o)&&h.push(" ",o,'="',e[o],'"');for(h.push(">"),i=0;i<this._objParamKeys.length;i++)o=this._objParamKeys[i],e.hasOwnProperty(o)&&h.push('<param name="',o,'" value="',e[o],'"/>');return h.push("</object>"),h.join("")}}),new e}();r.exports=n});
;define("common:widget/pano/module/PanoModule/FlashRender/FlashWraper.js",function(e,n,o){function a(e,n,o){T.lang.Class.call(this),this._flashDom=null,this._flashContainer=n,this._jsForFlashEventHandlers=null,this.initialize(e,o)}{var i=e("common:widget/pano/module/PanoModule/FlashRender/FlashUtil.js");e("common:widget/pano/module/PanoModule/FlashRender/FlashInterface.js")}a.FLASH_LOAD_FILE="../swf/pano_whole/FullscreenPanoLoader_8aff741.swf"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/swf/pano_whole/FullscreenPanoLoader_8aff741.swf*/,a.FLASH_SCAPE_FILE="../swf/pano_whole/BDStreetScape_68a50a0.swf"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/swf/pano_whole/BDStreetScape_68a50a0.swf*/,T.lang.inherits(a,T.lang.Class,"PanoFlashWraper"),T.object.extend(a.prototype,{initialize:function(e,n){try{this._createFlash(e,this._flashContainer,n),this._decorateFlash(),this._flashDom=i.getSwf("PanoramaFlash"+this.guid)}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoModule/FlashRender/FlashWraper.js",ln:42})}},doAction:function(e,n){"closePano"==e&&this._dispose(),this._flashDom.doAction&&this._flashDom.doAction(e,n)},gotoPOI:function(e){var e={id:e.uid,pid:e.panoId,x:100*e.x,y:100*e.y,rank:e.rank,panox:100*e.panoX,panoy:100*e.panoY,dir:e.panoHeading,pitch:e.panoPitch,poiLinex:e.poiLinex,poiLiney:e.poiLiney,tourId:e.tourId};this._flashDom.doAction("gotoPOI",e)},drawLineToPoint:function(e,n,o,a,i,t,s){var h=function(e,n){this.removeEventListener("draw_line_complete",h),s(n.data)};this.addEventListener("draw_line_complete",h),this._flashDom.doAction("drawPOILine",{pointX:100*a,pointY:100*i,pointRank:t,startX:n,startY:o,id:e||""})},setRoutParam:function(e){this.set("routParams",e)},closePano:function(){this._dispose()},addMarkers:function(e){this._flashDom.doAction("addMarkers",e)},hideRegion:function(){this._flashDom.doAction("hideRegion")},removeMarkers:function(e){this._flashDom.doAction("removeMarkers",e)},getMarkerUidInBestPano:function(){return this._flashDom.get("markerUidInBestPano")},playRouteVideo:function(e){return this._flashDom.doAction("playPanoVideo",e)},closeRouteVideo:function(){return this._flashDom.doAction("closePanoVideo")},get:function(e){return this._flashDom.get(e)},set:function(e,n){if("panoOptions"==e){var o=this._getContainerSize(this._flashDom);if(n.keepPov===!0){var a=this._flashDom.get("panoOptions");n.panoHeading=a.panoHeading,n.panoPitch=a.panoPitch}n={panoType:n.panoType,id:n.panoId||n.panoIId,pid:n.panoId,iid:n.panoIId,poiuid:n.panoUId,heading:n.panoHeading,pitch:n.panoPitch,zoom:n.panoZoom,width:o.width,height:o.height}}this._flashDom&&this._flashDom.set&&this._flashDom.set(e,n)},_decorateFlash:function(){this._bindJSEvent()},_dispose:function(){this._takeOffDecorateFlash(),this._flashContainer=null},_takeOffDecorateFlash:function(){this._removeJSEvent()},_removeJSEvent:function(){baidu.un(this._flashContainer,T.browser.firefox?"DOMMouseScroll":"onmousewheel",this._jsForFlashEventHandlers.mouseWheelHandler),baidu.un(window,"onresize",this._jsForFlashEventHandlers.resizeHandler)},_bindJSEvent:function(){var e=this;e._jsForFlashEventHandlers={},e._jsForFlashEventHandlers.mouseWheelHandler=function(n){var o=-n.detail/3||n.wheelDelta/120,a=e.get("zoom")+o;e.set("zoom",a),n.preventDefault()},e._jsForFlashEventHandlers.resizeHandler=function(){var n=e._getContainerSize(e._flashContainer);e.set("size",{width:n.width,height:n.height})},baidu.on(e._flashContainer,T.browser.firefox?"DOMMouseScroll":"onmousewheel",e._jsForFlashEventHandlers.mouseWheelHandler),baidu.on(window,"onresize",e._jsForFlashEventHandlers.resizeHandler)},_createFlash:function(e,n,o){var t=this._getFlashVars(e,n,o);i.create({id:"PanoramaFlash"+this.guid,width:"100%",height:"100%",allowscriptaccess:"always",scale:"showall",wmode:"opaque",quality:"high",url:a.FLASH_LOAD_FILE,ver:"10",errorMessage:"您未安装Flash Player播放器或者版本过低",vars:t},n)},_getFlashVars:function(e,n,o){var i=this._getContainerSize(n),t="",s="";"undefined"!=typeof e.panoHeading&&(t=e.panoHeading),"undefined"!=typeof e.panoPitch&&(s=e.panoPitch);var h={pid:e.panoId||"",iid:e.panoIId||"",poiuid:e.panoPoiUid||"",panoType:e.panoType||"",heading:t,pitch:s,width:i.width,height:i.height,panoUrl:a.FLASH_SCAPE_FILE,domain:o.PANO_SERVICE_URL,panoTileUrl:o.PANO_TILE_URL,udtVersion:o.PANO_UDT_VERSION,jsInterfaceNamespace:"Pano.PanoFlashInterface",swfIndex:this.guid};return h},_getContainerSize:function(e){return{width:e.clientWidth,height:e.clientHeight}}}),o.exports=a});
;define("common:widget/pano/module/PanoModule/FlashRender/FlashInterface.js",function(){function n(){}var o=window.Pano=window.Pano||{};baidu.extend(n,{dispatchFlashEvent:function(n,o,a){try{var e=baiduInstance(a);e.dispatchEvent(n,{data:o})}catch(t){throw window.console&&console.error(t,n,o,a),t}},get:function(){return null},doAction:function(){}}),o.PanoFlashInterface=n});
;define("common:widget/pano/module/PanoModule/FlashRender/Render.js",function(e,o,n){n.exports=e("common:widget/pano/module/PanoModule/FlashRender/FlashWraper.js")});
;define("common:widget/pano/module/PanoModule/PanoModule.js",function(e,a,t){var n=e("common:widget/pano/base/ModuleClass.js"),o=e("common:widget/pano/module/PanoModule/FlashRender/Render.js"),i=e("common:widget/pano/base/service.js"),r=e("common:widget/pano/model/IndoorData.js"),d=(e("common:widget/pano/model/PanoPoi.js"),e("common:widget/pano/base/util.js")),s=e("common:widget/pano/Transition/Transition.js"),p={},h="",_=null,l=void 0,c=0,u=n.extend("PanoModule",{constructor:function(){this._panoModuleContainer=null,this._panoConfigUrl=null,this._panoFlashWraper=null,this._asynCacheMethodDataMap={},this._flashInterfaceReady=!1,this._panoModuleMarkerIds=null,this._enableShareMarker=!0,this._returnMarkVars={panoUid:"",poiDetailUid:"",panoType:"",panoLastStreetPanoOptions:null},this._isVisiable=!0},initialize:function(e,a,t){try{if(this._panoModuleContainer=e,this._panoConfigUrl=a,this._mapContext=t,this.$shareParam){var n=this.$shareParam.markerUid;this._addMarkerByUid(n)}}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoModule/PanoModule.js",ln:72})}},showPano:function(e,a,t){if(l=t,this._panoFlashWraper)this._flashInterfaceReady&&(a&&(e.uid||e.tourId)?this._panoFlashWraper.gotoPOI(e):this._panoFlashWraper.set("panoOptions",e));else{{e.uid}this._initPanoFlash(e),this.dispatchEvent("visible_changed",{data:{visible:!0,panoOptions:e}})}if(e.panoMarkers){var n=this;this._panoModuleMarkerIds=[],d.each(e.panoMarkers,function(e){e.markerId=d.getUniqueId("MARKER_"),n._panoModuleMarkerIds.push(e.markerId)}),this.addMarkers(e.panoMarkers)}("inter"===e.panoType||e.panoIId)&&(this._returnMarkVars.panoUid=this._returnMarkVars.poiDetailUid)},setPov:function(e){this._flashInterfaceReady?this._panoFlashWraper.set("pov",{heading:e.panoHeading,pitch:e.panoPitch}):this._asynCacheMethodDataMap.setPov=e},setZoom:function(e){if(this._flashInterfaceReady){var a=this._panoFlashWraper.get("zoom");this._panoFlashWraper.set("zoom",a+e)}else this._asynCacheMethodDataMap.setZoom=e},addMarkers:function(e){return e&&e.length&&0!==e.length?(this._panoFlashWraper&&this._flashInterfaceReady?(this._panoFlashWraper.addMarkers(e),1==e.length&&this.dispatchEvent("add_search_marker",{markers:e})):this._asynCacheMethodDataMap.addMarkers=e,this):this},_addMarkerByUid:function(e){var a=this;i.getPanoInfoByUid(e,function(e){if(e&&e.content&&e.content[0]&&e.content[0].poiinfo){var t=e.content[0].poiinfo,n={markerId:d.getUniqueId("MARKER_"),poiuid:t.UID,pid:t.PID,panoIId:t.IID,poiType:t.belonging?"interPoi":"poi",catalog:t.Catalog,name:t.name,heading:t.Dir,pitch:t.Pitch,x:t.X,y:t.Y,px:t.PanoX,py:t.PanoY,index:-1};a.addMarkers([n])}})},removeMarkers:function(e){return this._panoFlashWraper&&this._flashInterfaceReady?this._panoFlashWraper.removeMarkers(e):this._asynCacheMethodDataMap.removeMarkers=e,this},removePanoModuleMarker:function(){return this._panoModuleMarkerIds&&this._panoModuleMarkerIds.length&&(this.removeMarkers(this._panoModuleMarkerIds),this._panoModuleMarkerIds=null),this},drawLineToPoint:function(e,a,t,n,o,i,r){this._panoFlashWraper.drawLineToPoint(e,a,t,n,o,i,r)},closePano:function(e){var a=this.getPanoOptions(),t=this,n=function(){t._panoFlashWraper&&(t._panoFlashWraper.closePano(),t._removePanoFlashEvents(),t._panoFlashWraper=null,t._flashInterfaceReady=!1,h=""),_&&_.has2DMap()||a&&(a.currentPoint=null),e||t.dispatchEvent("visible_changed",{data:{visible:!1,panoOptions:a}})};if(!a)return void n();var o=this._mapContext.getOverviewLevel(),i=new BMap.Point(a.panoMCPoint.x,a.panoMCPoint.y),r=a.panoHeading||0;s.exit(i,o,i,r,function(){n()})},setRoutParam:function(e){this._flashInterfaceReady?this._panoFlashWraper.setRoutParam(e):this._asynCacheMethodDataMap.setRoutParam=e},hideRegion:function(){this._flashInterfaceReady?this._panoFlashWraper.hideRegion():this._asynCacheMethodDataMap.hideRegion=[]},playRouteVideo:function(e,a){this._flashInterfaceReady&&(c=e,this._panoFlashWraper.playRouteVideo(a),addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-route-video"}),d.startClock("panoVideoPlayTime",function(e){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-route-video-play-time",time:e})}))},closeRouteVideo:function(){this._flashInterfaceReady&&(c=0,this._panoFlashWraper.closeRouteVideo(),d.stopClock("panoVideoPlayTime"))},getPanoOptions:function(){if(this._panoFlashWraper&&this._flashInterfaceReady){var e=this._panoFlashWraper.get("panoOptions"),a=this._panoFlashWraper.get("mercatorPosition");return e.currentPoint={x:a.mercatorX,y:a.mercatorY},e}return null},getPanoTimeline:function(){if(!this._panoFlashWraper)return null;var e=this._panoFlashWraper.get("sData");try{var a=e.content[0].TimeLine.length>0?e.content[0].TimeLine:null,t=e.content[0].MoveDir;if("inter"===e.content[0].Type)return null;if(a){for(var n=0,o=a.length;o>n;n++)a[n].dir=t;return a}}catch(i){return null}return null},_getSdata:function(){if(!this._panoFlashWraper)return null;var e=this._panoFlashWraper.get("sData"),a=e.content[0]||e.content,t=d.copy(a,!0);return t},getPanoCopyright:function(){if(this._panoFlashWraper&&this._flashInterfaceReady){var e=this._getSdata(),a={dataProviderIndex:e.provider,admission:e.admission,photoDate:e.date,roadName:e.rname||"",username:e.username||"",userid:e.userid};return a}return null},getPanoIndoorData:function(){if(this._panoFlashWraper&&this._flashInterfaceReady&&_){var e=_.getCurrentFloorData(),a=this._getSdata(),t=this._panoFlashWraper.get("pov"),n=(a.rx||a.x)/100,o=(a.ry||a.y)/100;return e.currentPoint={x:n,y:o,heading:t.heading},e}return null},getIndoorModel:function(){return _},_bindPanoFlashEvents:function(){var e=this,a=e._panoFlashWraper;a.addEventListener("indoor_exit",function(e){e&&e.data&&"topo"===e.data.changeWay&&addStat(STAT_CODE.STAT_PANORAMA,{item:"indoorview-exit-topo"})},"indoor_exit"+this.guid),a.addEventListener("zoom_changed",function(a){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-zoom"}),e.dispatchEvent("zoom_changed",{data:a.data})}),a.addEventListener("street_drag",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-drag"})}),a.addEventListener("pov_changed",function(a){"street"==e._returnMarkVars.panoType&&(e._returnMarkVars.panoLastStreetPanoOptions.panoHeading=a.data.heading,e._returnMarkVars.panoLastStreetPanoOptions.panoPitch=a.data.pitch),e.dispatchEvent("pov_changed",{data:{panoHeading:a.data.heading,panoPitch:a.data.pitch}})},"pov_changed"+this.guid),a.addEventListener("once_tiles_complete",function(){_?_.onLoad(function(){e.dispatchEvent("once_tiles_complete",{data:null})}):e.dispatchEvent("once_tiles_complete",{data:null}),a.removeEventListener("once_tiles_complete","once_tiles_complete"+e.guid)}),a.addEventListener("go_to_poi_complete",function(a){e._returnMarkVars.poiDetailUid=a.data.id,e.dispatchEvent("after_go_to_poi",a.data)}),a.addEventListener("go_to_poi_timeout",function(a){e.dispatchEvent("go_to_poi_timeout",a.data)}),a.addEventListener("overlay_mouseover",function(a){a.type="show_position",e.dispatchEvent("show_position",a)}),a.addEventListener("out_of_navigation_range",function(){e.dispatchEvent("pano_error",{data:"OUTOF_RANGE"})}),a.addEventListener("overlay_mouseout",function(){e.dispatchEvent("hide_position")}),a.addEventListener("idata_loaded",function(){}),a.addEventListener("sdata_loaded",function(a){var t=a.data,n=t.panoid||t.panoId;if(""==h)if("street"===t.panoType)e._fireSdataLoaded(a);else{var o=e._getSdata();_=new r(o.inters[0].iid);var i=o.id,d=o.inters&&o.inters[0]&&o.inters[0].floor||0;_.fetch(function(){var t=_.setCurrentPid(i);void 0==t&&(_._currentFloor=d),e.dispatchEvent("indoor_enter",{data:_.getCurrentFloorData(),indoorModel:_}),a.data.floor=d,e._fireSdataLoaded(a)})}else if("street"==h)if("street"===t.panoType)e._fireSdataLoaded(a);else{var o=e._getSdata();_=new r(o.inters[0].iid);var d=o.inters&&o.inters[0]&&o.inters[0].floor||0;_.fetch(function(){_.setCurrentPid(o.id);var t=_.getCurrentFloorData();t.x=(o.rx||o.x)/100,t.y=(o.ry||o.y)/100,e.dispatchEvent("indoor_enter",{data:t,indoorModel:_}),a.data.floor=d,e._fireSdataLoaded(a)})}else if("street"===t.panoType){var s=_.getBasicData();_=null;var p={uid:s.uid,panoId:s.breakid,panoX:s.breakx/100,panoY:s.breaky/100};e.dispatchEvent("indoor_exit",{data:p,pano_change_dispatcher:l}),l=null,e._fireSdataLoaded(a)}else{var c=_.getCurrentFloor(),u=_.setCurrentPid(n);if(void 0===u){var o=e._getSdata(),v=o.inters[0].iid;v==_.getIID()?(_._currentFloor=c,e.dispatchEvent("indoor_plan_id_changed",{data:{x:o.rx/100,y:o.ry/100,heading:t.heading}}),a.data.floor=c,e._fireSdataLoaded(a)):(_=new r(v),_.fetch(function(){e.dispatchEvent("indoor_enter",{data:_.getCurrentFloorData(),indoorModel:_}),e._fireSdataLoaded(a)}))}else if(c===u){var f=_.getCurrentPointData();e.dispatchEvent("indoor_plan_id_changed",{data:f}),e.dispatchEvent("pov_changed",{data:{panoHeading:t.heading,panoPitch:t.pitch}}),e._fireSdataLoaded(a)}else e.dispatchEvent("indoor_floor_changed",{data:_.getCurrentFloorData()}),e.dispatchEvent("pov_changed",{data:{panoHeading:t.heading,panoPitch:t.pitch}}),e._fireSdataLoaded(a)}h=t.panoType},"sdata_loaded"+this.guid),a.addEventListener("interface_ready",function(a){e._flashInterfaceReady=!0;for(var t in e._asynCacheMethodDataMap)e[t](e._asynCacheMethodDataMap[t]);e._asynCacheMethodDataMap={},e.dispatchEvent("interface_ready",a)},"interface_ready"+this.guid),a.addEventListener("pano_error",function(a){e.dispatchEvent("pano_error",{data:a.data})},"pano_error"+this.guid),a.addEventListener("pano_player_error",function(a){e.dispatchEvent("pano_player_error",{data:a.data})},"pano_player_error"+this.guid),a.addEventListener("deselect_poi",function(){e._returnMarkVars.poiDetailUid="",e.dispatchEvent("deselect_poi")},"deselect_poi"+this.guid),a.addEventListener("service_monitor",function(e){var a=e.data,t=a.type,n=a.param.timeLength,o=1!=a.errorCode,i=a.param.url,r=0;switch(t){case"pdata":r=.05;break;case"qsdata":r=1;break;case"routePoints":r=5;break;case"idata":case"plane":r=10;break;default:r=.4}d.monitorReport(t,o,n,i,r)},"service_monitor"+this.guid),a.addEventListener("add_statistic",function(e){var a=e.data;addStat(STAT_CODE.STAT_PANORAMA,a)},"add_statistic"+this.guid),a.addEventListener("update_pano_position",function(a){e.dispatchEvent("routeVideo_pano_changed",{data:{panoType:"street",panoHeading:a.data.heading,panoMCPoint:{x:a.data.x/100,y:a.data.y/100}}})},"update_pano_position"+this.guid)},_fireSdataLoaded:function(e){var a=this;a._mapContext.getCurrentCity(function(e){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-whole",cityCode:e.cityId})});var t=e.data;t={panoMode:t.mode,panoId:t.panoid,panoPitch:t.pitch,panoHeading:t.heading,panoType:t.panoType,panoMCPoint:{x:t.x,y:t.y},panoCopyright:t.copyright,floor:t.floor};var n=p.panoData;p.panoData=t,a.dispatchEvent("after_pano_changed",{data:t,last_data:n,pano_change_dispatcher:l}),l=void 0,"street"==t.panoType&&(a._returnMarkVars.panoLastStreetPanoOptions=t),a._returnMarkVars.panoType=t.panoType},_removePanoFlashEvents:function(){var e=this._panoFlashWraper;e.removeEventListener("pov_changed","pov_changed"+this.guid),e.removeEventListener("sdata_loaded","sdata_loaded"+this.guid),e.removeEventListener("indoor_enter","indoor_enter"+this.guid),e.removeEventListener("indoor_exit","indoor_exit"+this.guid),e.removeEventListener("indoor_id_changed","indoor_id_changed"+this.guid),e.removeEventListener("floor_changed","floor_changed"+this.guid),e.removeEventListener("interface_ready","interface_ready"+this.guid),e.removeEventListener("pano_error","pano_error"+this.guid),e.removeEventListener("pano_player_error","pano_player_error"+this.guid),e.removeEventListener("deselect_poi","deselect_poi"+this.guid),e.removeEventListener("service_monitor","service_monitor"+this.guid),e.removeEventListener("add_statistic","add_statistic"+this.guid),e.removeEventListener("update_pano_position","update_pano_position"+this.guid)},_initPanoFlash:function(e){this._panoFlashWraper=new o(e,this._panoModuleContainer,this._panoConfigUrl),this._bindPanoFlashEvents(),this._addPanoReturn()},_addPanoReturn:function(){var e=T('<div id="pano-return-btn"><a class="pano_button" href="javascript:void(0);"><span></span><em>返回</em></a></div>')[0],a=this,t=document.getElementById("pano-container");t.appendChild(e),T.on(e,"click",function(e){return e.preventDefault(),addStat(STAT_CODE.STAT_PANORAMA,{item:"return-click"}),2==c?(c=0,a.dispatchEvent("routeVideo_exit"),void d.stopClock("panoVideoPlayTime")):void("inter"==a._returnMarkVars.panoType&&a._returnMarkVars.panoLastStreetPanoOptions?a._returnMarkVars.panoUid?(a._returnMarkVars.panoLastStreetPanoOptions.uid=a._returnMarkVars.panoUid,a.showPano(a._returnMarkVars.panoLastStreetPanoOptions,!0,"returnButton")):a.showPano(a._returnMarkVars.panoLastStreetPanoOptions,null,"returnButton"):(c=0,a.closePano()))})},getPanoStatus:function(){return this._returnMarkVars.panoLastStreetPanoOptions},enableShareMarker:function(e){this._enableShareMarker=e},getShareParam:function(){if(!this._enableShareMarker)return null;var e=this.getMarkerUidInBestPano();return e?{markerUid:e}:null},getMarkerUidInBestPano:function(){var e="";return this._panoFlashWraper&&this._flashInterfaceReady&&(e=this._panoFlashWraper.getMarkerUidInBestPano()),e},setVisibility:function(e){var a=document.getElementById("pano-return-btn");e?(this._panoModuleContainer.style.visibility="",this._isVisiable=!0,a.style.display="block"):(this._panoModuleContainer.style.visibility="hidden",this._isVisiable=!1,a.style.display="none")},getSupportEvents:function(){return["pov_changed","zoom_changed","indoor_enter","indoor_exit","indoor_plan_id_changed","indoor_floor_changed","visible_changed","after_pano_changed","after_go_to_poi","once_tiles_complete","pano_error","pano_player_error","show_position","hide_position","deselect_poi","interface_ready","routeVideo_exit","routeVideo_pano_changed","add_search_marker"]}});t.exports=u});
;define("common:widget/pano/module/PanoToolModule/PanoToolModule.js",function(o,n,a){var t=o("common:widget/pano/base/ModuleClass.js"),e=4,i=1,s=null,l=t.extend("PanoToolModule",{constructor:function(){},initialize:function(o){try{this._container=o,this._events={},this._addFishboneTool(),this._addShareTool(),this._addUploadPano(),this._addClassifySearchTool()}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoToolModule/PanoToolModule.js",ln:24})}},getSupportEvents:function(){return["zoom_changed","tool_share_pano","classify_search_panel_visible"]},setItemsEnable:function(o){for(var n=this._container.getElementsByTagName("li"),a=0,t=o.length;t>a;a++){var e=o[a];n[a]&&(e===!0?n[a].style.display="block":e===!1&&(n[a].style.display="none"))}},_addFishboneTool:function(){var o=T('<li id="pano-fishbone-btn"><a id="pano-zoomout-btn" title="放大一级" href="javascript:void(0)" class="pano_button"><span></span></a><div class="pano-zoom-line"><div></div></div><a id="pano-zoomin-btn" href="javascript:void(0)" title="缩小一级" class="pano_button pano_zoom_in_disabled"><span></span></a></li>');T.dom(this._container).prepend(o);var n=this,a=T.g("pano-zoomin-btn"),t=T.g("pano-zoomout-btn"),e=T.g("pano-upload-btn");n._events.tool_zoom_out=function(){T("#pano-zoomout-btn").hasClass("pano_zoom_out_disabled")||n.dispatchEvent("zoom_changed",{data:1})},n._events.tool_zoom_in=function(){T("#pano-zoomin-btn").hasClass("pano_zoom_in_disabled")||n.dispatchEvent("zoom_changed",{data:-1})},n._events.tool_upload_redirect=function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-ugc-entrance-click"})},T.on(t,"click",n._events.tool_zoom_out),T.on(a,"click",n._events.tool_zoom_in),T.on(e,"click",n._events.tool_upload_redirect)},_addClassifySearchTool:function(){s=T('<li id="pano-classify-search-btn"><a class="pano_button" title="分类周边检索" href="javascript:void(0);"><span></span></a><div class="pano-zoom-line"><div></div></div></li>')[0],T.dom(this._container).prepend(s);var o=this;this._events.tool_classify_search=function(){o.dispatchEvent("classify_search_panel_visible",{data:s}),T.un(s,"mouseenter",o._events.tool_classify_search)},T.on(s,"mouseenter",this._events.tool_classify_search)},setClassifySearchVisible:function(o){s&&(s.style.display=o?"block":"none")},updateFishBone:function(o){T("#pano-zoomout-btn").removeClass("pano_zoom_out_disabled"),T("#pano-zoomin-btn").removeClass("pano_zoom_in_disabled"),o===e?T("#pano-zoomout-btn").addClass("pano_zoom_out_disabled"):o===i&&T("#pano-zoomin-btn").addClass("pano_zoom_in_disabled")},_addShareTool:function(){var o=T('<li id="pano-share-btn"><a class="pano_button" title="点击分享全景" href="javascript:void(0);"><span></span></a></li>');T.dom(this._container).prepend(o);var n=this;n._events.tool_share_pano=function(o){o.preventDefault(),n.dispatchEvent("tool_share_pano",{data:""})},T.on(o,"click",n._events.tool_share_pano)},_addUploadPano:function(){var o=T('<li id="pano-upload-btn"><a id="tool-ugc-upload" class="pano_button" title="上传全景照片" href="http://pai.baidu.com/" target="_blank"><span></span></a><div class="pano-zoom-line"><div></div></div></li>');T.dom(this._container).prepend(o)},dispose:function(){T.un(T.g("pano-zoomout-btn"),"click",this._events.tool_zoom_out),T.un(T.g("pano-zoomin-btn"),"click",this._events.tool_zoom_in),T.un(T.g("pano-upload-btn"),"click",this._events.tool_upload_redirect),T.un(T.g("pano-share-btn"),"click",this._events.tool_share_pano),this._container.removeChild(T.g("pano-fishbone-btn")),this._container.removeChild(T.g("pano-share-btn"))}});a.exports=l});
;define("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoLocatorComponent/PanoLocatorComponent.js",function(t,e,n){function i(t){this._opts=t,this.MAP_PAN_DIRECTION=[[0,0],[-1,-1],[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1]],this.DIV_ROTATE_DIRECTION=[[0,-19,-64],[22.5,-203,-59],[45,-391,-59],[67.5,-581,-58],[90,-778,-55],[112.5,-979,-50],[135,-1178,-55],[157.5,-1387,-51],[180,-1611,-60],[202.5,-1821,-61],[225,-2030,-65],[247.5,-2243,-73],[270,-2457,-62],[292.5,-2685,-65],[315,-2901,-70],[337.5,-3120,-70]];var e=t.position;e&&e instanceof BMap.Point&&(this._map=null,this._mapc=null,this._container=null,this._position=e,this._size=null,this._viewsetting=0,this._moving=!1,this._nowviewtype=0,this._viewtypetimer=null,this._dragMovePixel=null,this._arrowDirection="-168px -72px",this._direction=null,t=t||{},this._opts=baidu.extend(this._opts||{},{enableDragging:!0,anchor:new BMap.Size(-55,-55)}))}var o=t("common:widget/ui/util/util.js");baidu.lang.inherits(i,BMap.Overlay,"PanoLocatorComponent"),baidu.object.extend(i.prototype,{initialize:function(t){try{{this._opts}return this.initMapLocator(t)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoLocatorComponent/PanoLocatorComponent.js",ln:70})}},initMapLocator:function(t){var e=this,n=e._container=document.createElement("div"),i=document.createElement("div"),o="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/panorama/pano_markers_1f7469f.png)!important";e._map=t,e._div=n,e._arrow=i,e._mapc=t.getContainer(),e._bgu=o;var a=baidu.dom.getPosition(this._mapc);return this._mapcTop=a.top,this._mapcLeft=a.left,e._rotating=!1,e._setDefCursor(),baidu.extend(n.style,{position:"absolute",zIndex:BMap.Overlay.getZIndex(e._position.lat),backgroundRepeat:"no-repeat",backgroundPosition:"-560px 0",cursor:"pointer",height:"110px",width:"110px"}),baidu(n).addClass("pano-fan"),baidu.extend(i.style,{position:"absolute",backgroundRepeat:"no-repeat",backgroundPosition:"0 0",left:"40px",height:"24px",width:"24px",marginTop:"40px"}),baidu(i).addClass("pano-overlay-ie"),n.appendChild(i),e._map.getPanes().labelPane.appendChild(n),n},draw:function(){var t,e=this,n=e._opts.anchor;t=e._map.pointToOverlayPixel(this._position),e._container.style.left=t.x+n.width+"px",e._container.style.top=t.y+n.height+"px"},enableDragging:function(){this._opts.enableDragging=!0},disableDragging:function(){this._opts.enableDragging=!1},getPosition:function(){return this._position},setPosition:function(t){this._position=t,this.draw()},getDirection:function(){return this._direction},setDirection:function(t){if(!isNaN(t)){var e=this._direction=t;this._getRotateDirection(e)}},setOffset:function(){var t=baidu.dom.getPosition(this._mapc);this._mapcTop=t.top,this._mapcLeft=t.left},remove:function(){this._dispatchEvent(this,"onremove"),this._container&&o.purgeEvents(this._container),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container)},_setDefCursor:function(){T.browser.firefox?(this.defaultCursor="-moz-grab",this.draggingCursor="-moz-grabbing"):T.browser.chrome||T.browser.safari?(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur) 8 8, default",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur) 8 8, default"):(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur)",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur)")},_getRotateDirection:function(t){if(!isNaN(t)){{var e=this.DIV_ROTATE_DIRECTION,n=0,i=t-31.75;e.length}if(i>e[15][0])this._div.style.backgroundPosition=e[15][1]+"px "+e[15][2]+"px";else for(var n=0;16>n;n++)if(i<e[n][0]){this._div.style.backgroundPosition=e[n][1]+"px "+e[n][2]+"px";break}}},_getMoveDirection:function(t,e){if(!isNaN(t)&&!isNaN(e)){var n=-1,i=t-this.preX;return this.preX>5&&0>i?n=0:this.preX>5&&i>0&&(n=1),this.preX=t,this.preY=e,n}},_setEventDispath:function(){function t(t){var t=window.event||t,n=t.pageX||t.clientX||0,i=t.pageY||t.clientY||0,o=new BMap.Pixel(n,i),a=e._map.pixelToPoint(o);return{pixel:o,point:a}}var e=this,n=e._container,i=e._arrow,o=e._mapc,a=(e._dom,e._angle,!1),p=!1,s=null;i.onclick=function(t){e._dispatchEvent(e,"onarrclick"),e.stopAndPrevent(t)},n.onclick=function(n){var i=t(n),o=i.pixel.x-e._mapcLeft,a=i.pixel.y-e._mapcTop,p=e._map.pointToPixel(e._position).x,s=e._map.pointToPixel(e._position).y,r=180-Math.atan2(o-p,a-s)/3.1415926/2*360;e._getRotateDirection(r),e._dispatchEvent(e,"oncircleclick",{point:i.point,pixel:i.pixel,angle:r}),e.stopAndPrevent(n)},n.onmousedown=function(i){var p=t(i),r=p.pixel.x-e._mapcLeft,l=p.pixel.y-e._mapcTop,_=e._map.pointToPixel(e._position).x,d=e._map.pointToPixel(e._position).y,m=180-Math.atan2(r-_,l-d)/3.1415926/2*360;s=p.pixel,a=!0,e._rotating||(e._rotating=!0,n.setCapture?(baidu.on(n,"onmousemove",u),baidu.on(n,"onmouseup",c)):(baidu.on(window,"onmousemove",u),baidu.on(window,"onmouseup",c))),e._dispatchEvent(e,"onrotatestart",{point:p.point,pixel:p.pixel,angle:m}),n.setCapture&&n.setCapture(),o.style.MozUserSelect="none",o.style.KhtmlUserSelect="none",o.style.WebkitUserSelect="none",o.unselectable="on",o.onselectstart=function(){return!1},e.stopAndPrevent(i)},i.onmousedown=function(a){var u=t(a);return i.setCapture?(baidu.on(i,"onmousemove",l),baidu.on(i,"onmouseup",r)):(baidu.on(window,"onmousemove",l),baidu.on(window,"onmouseup",r)),e._opts.enableDragging?(s=u.pixel,e._dispatchEvent(e,"ondragstart",{point:e._position}),p=!0,i.style.cursor=e.draggingCursor,baidu(n).removeClass("pano-fan"),i.setCapture&&i.setCapture(),o.style.MozUserSelect="none",o.style.KhtmlUserSelect="none",o.style.WebkitUserSelect="none",o.unselectable="on",o.onselectstart=function(){return!1},void e.stopAndPrevent(a)):void e.stopAndPrevent(a)};var r=function(u){t(u);return e._dispatchEvent(e,"onmouseup",{point:e._position}),i.releaseCapture?(baidu.un(i,"onmousemove",l),baidu.un(i,"onmouseup",r)):(baidu.un(window,"onmousemove",l),baidu.un(window,"onmouseup",r)),e._opts.enableDragging?(i.releaseCapture&&i.releaseCapture(),baidu(n).addClass("pano-fan"),clearInterval(e._viewtypetimer),e._dispatchEvent(e,"ondragend",{point:e._position}),p=!1,a=!1,s=null,o.style.MozUserSelect="",o.style.KhtmlUserSelect="",o.style.WebkitUserSelect="",o.unselectable="off",o.onselectstart=function(){},void e.stopAndPrevent(u)):void e.stopAndPrevent(u)},l=function(n){if(e._opts.enableDragging&&p){var i,o,a,r=t(n);i=e._map.pointToPixel(e._position),o=r.pixel.x-s.x+i.x,a=r.pixel.y-s.y+i.y,s=r.pixel,_(n),e._dispatchEvent(e,"ondragging",{point:e._position}),e.stopAndPrevent(n)}},u=function(n){if(a){var i=t(n),o=i.pixel.x-e._mapcLeft,p=i.pixel.y-e._mapcTop,s=e._map.pointToPixel(e._position).x,r=e._map.pointToPixel(e._position).y,l=e._direction=180-Math.atan2(o-s,p-r)/3.1415926/2*360;e._getRotateDirection(l),e._dispatchEvent(e,"onrotating",{point:i.point,pixel:i.pixel,angle:l}),e.stopAndPrevent(n)}},c=function(i){if(e._rotating){e._rotating=!1,n.releaseCapture?(baidu.un(n,"onmousemove",u),baidu.un(n,"onmouseup",c)):(baidu.un(window,"onmousemove",u),baidu.un(window,"onmouseup",c)),n.releaseCapture&&n.releaseCapture();var a=t(i);e._dispatchEvent(e,"onrotateend",{point:a.point,pixel:a.pixel,angle:e._direction}),o.style.MozUserSelect="",o.style.KhtmlUserSelect="",o.style.WebkitUserSelect="",o.unselectable="off",o.onselectstart=function(){},e.stopAndPrevent(i)}},_=function(n){if(e._opts.enableDragging&&p){var i=t(n),a=(e._map.pointToPixel(e._position),i.pixel.x-e._mapcLeft),r=i.pixel.y-e._mapcTop;s=i.pixel,e._position=e._map.pixelToPoint(new BMap.Pixel(a,r));var l=null,u=a/o.offsetWidth,c=r/o.offsetHeight,l=d(u,c);if(e._nowviewport&&l===e._nowviewport)e.draw();else if(0==l)e._position=e._map.pixelToPoint(new BMap.Pixel(a,r)),e.draw(),e._nowviewport=0,clearInterval(e._viewtypetimer);else{clearInterval(e._viewtypetimer),e._nowviewport=l,e.draw();{var _=e._map.pointToPixel(e._map.getCenter()).x,m=e._map.pointToPixel(e._map.getCenter()).y;e._map.pixelToPoint(new BMap.Pixel(_,m))}e._viewtypetimer=setInterval(function(){e._map.panBy(-8*e.MAP_PAN_DIRECTION[l][0],-8*e.MAP_PAN_DIRECTION[l][1],null,!0),__x=e._map.pointToPixel(e._position).x+8*e.MAP_PAN_DIRECTION[l][0],__y=e._map.pointToPixel(e._position).y+8*e.MAP_PAN_DIRECTION[l][1],e._position=e._map.pixelToPoint(new BMap.Pixel(__x,__y)),e.draw()},30)}}},d=function(t,e){if(!isNaN(t)&&!isNaN(e)){var n,i=.2,o=.2;return i>t?n=o>e?1:e>1-o?3:2:t>1-i?n=o>e?7:e>1-o?5:6:o>e?n=8:e>1-o?n=4:(n=0,n=0),n}}},_dispatchEvent:function(t,e,n){0!=e.indexOf("on")&&(e="on"+e);var i=new baidu.lang.Event(e);if(n)for(var o in n)i[o]=n[o];t.dispatchEvent(i)},stopAndPrevent:function(t){var t=window.event||t;baidu.event.preventDefault(t),baidu.event.stopPropagation(t)}}),n.exports=i});
;define("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoPoiClickComponent/PanoPoiClickComponent.js",function(e,t,o){function n(e){this._opts=e,this._map=e.map,this.cbfunction=e.callback,this.cacheData={},this.maxCache=8,this.cacheIds=[],this.poiSpotId=null,this.spotOnId="",this.spotOnUid=null,this.mkr=null,this.label=null,this.squareSide=4,this.tMkr=null,this.tempMarker=null,this.tempLabel=null,this.overSpotPoint=null,this.isMoving=!1,this.fetchId="",this.curTileId="",this.labelName="",this.ic=new BMap.Icon("../images/panorama/pano_click_poi_9d48465.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/panorama/pano_click_poi_9d48465.png*/,new BMap.Size(20,24),{offset:new BMap.Size(10,12),infoWindowOffset:new BMap.Size(5,0)});var t=e.context.panoContext,o=t.getPanoUrlConfig();this.clickVersion=o.PANO_INDOOR_CLICK_VERSION||"1003",this.initialize()}baidu.lang.inherits(n,baidu.lang.Class,"PanoPoiClickComponent"),baidu.object.extend(n.prototype,{initialize:function(){try{this.bind()}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoPoiClickComponent/PanoPoiClickComponent.js",ln:51})}},refresh:function(e){var t=this;t.clearPoiCache(),t.hideOverlays(),t.tMkr=null,t.tempMarker=null,t.tempLabel=null,t.spotOnId=null,t._map=e,t.init()},bind:function(){this.bindMapRequest(),this.bindMouseMove(),this.bindSpotEvent()},bindMapRequest:function(){var e=this,t=e._map;t.addEventListener("tilesloaded",function(){t.getZoom()<10&&e.clearPoiCache()}),t.addEventListener("zoomend",function(){e.clearPoiCache(),e.hideOverlays()})},bindMouseMove:function(){var e=this,t=e._map;e._panomouseMoveEvent||(e._panomouseMoveEvent=function(t){e._mouseMoveEvent(t)}),t.addEventListener("mousemove",e._panomouseMoveEvent)},_mouseMoveEvent:function(e){var t=this,o=t._map;if(o.getZoom()<10)t.clearPoiCache();else{if(!e||!e.point)return;t.overSpotPoint=e.point,t.isMoving=!0;var n=o.getTileId(e.point,o.getZoom());if(!n.row||!n.column||!n.level)return;t.curTileId=n.level+"_"+n.row+"_"+n.column;var a=n.level+"_"+t.m1(n.row)+"_"+t.m1(n.column);t.cacheData[a]?t.spotOnId!=t.curTileId&&(t.clearPoiCache(),t._addSpot(t.curTileId)):t.sendRequest({l:n.level,x:t.m1(n.row),y:t.m1(n.column)})}},_addSpot:function(e){var t=this,o=t._map,n=e.split("_"),a=n[0]+"_"+t.m1(n[1])+"_"+t.m1(n[2]);if(t.cacheData[a]){var i=t.cacheData[a][e]?t.cacheData[a][e]:!1;if(i){t.poiSpotId=o.addSpots(i,{enableMultiResponse:!1}),t.spotOnId=e;for(var p=-1,r=0,l=t.cacheIds.length;l>r;r++)if(a==t.cacheIds[r]){p=r;break}p>=0&&(t.cacheIds.splice(p,1),t.cacheIds.push(a))}}},sendRequest:function(e){var t=this;if(e&&t.fetchId!=e.l+"_"+e.x+"_"+e.y){t.fetchId=e.l+"_"+e.x+"_"+e.y;var o=e.x+"_"+e.y+"_"+e.l+"_"+this.clickVersion;baidu.jsonp("http://pcsv0.map.bdimg.com/?qt=ck&tid="+o,{cbtype:"fn",success:function(e){e=e&&e.content||{},e&&e.length>0&&t.getPoiData(e)},error:function(){}})}},getPoiData:function(e){for(var t={},o=!1,n=this,a=n._map,i=0,p=e.length;p>i;i++){for(var r=[],l=e[i],s=0,c=l.uids.length;c>s;s++){var m=l.uids[s],d=(m.bound.xmax+m.bound.xmin)/2,u=(m.bound.ymax+m.bound.ymin)/2,v=a.pointToPixel(new BMap.Point(m.bound.xmin,m.bound.ymin)),h=a.pointToPixel(new BMap.Point(m.bound.xmax,m.bound.ymax)),f=[(v.x-h.x)/2,(h.y-v.y)/2,(h.x-v.x)/2,(v.y-h.y)/2];"street_1"!=m.catalog&&r.push({pt:new BMap.Point(d,u),bd:f,userdata:{name:m.name?m.name:"",uid:m.uid,type:m.type,iconpoint:m.icon?new BMap.Point(m.icon.x,m.icon.y):""},tag:"MAP_SPOT_INFO"})}n.curTileId&&n.curTileId==l.tileid&&(o=!0),t[l.tileid]=r}var _=e[0].tileid.split("_"),b=_[0]+"_"+n.m1(_[1])+"_"+n.m1(_[2]);if(n.cacheData[b]=t,n.cacheIds.push(b),n.cacheIds.length>n.maxCache){var M=n.cacheIds.shift();delete n.cacheData[M],delete M}o&&n._addSpot(n.curTileId)},bindSpotEvent:function(){var e=this;e.addSpotEvent()},addSpotEvent:function(){var e=this,t=e._map;e._panomoveOverSpot||(e._panomoveOverSpot=function(t){e.stopAndPrevent(t),e._moveOverSpot(t)}),e._panomoveOutSpot||(e._panomoveOutSpot=function(t){e._moveOutSpot(t)}),t.addEventListener("spotmouseover",e._panomoveOverSpot),t.addEventListener("spotmouseout",e._panomoveOutSpot)},removeSpotEvent:function(){var e=this,t=e._map;t.removeEventListener("mousemove",e._panomouseMoveEvent),t.removeEventListener("spotmouseover",e._panomoveOverSpot),t.removeEventListener("spotmouseout",e._panomoveOutSpot)},_moveOverSpot:function(e){var t=this,o=t._map;if(!(o.getZoom()<10)){var n=e.spots;if(n&&!(n.length<1)&&n[0].tag&&"MAP_SPOT_INFO"==n[0].tag){"_panoPoiClick"==t.cbfunction&&PanoUtil.panoMarker&&PanoUtil.panoMarker.disable();var a=n[0].userdata.iconpoint?n[0].userdata.iconpoint:n[0].pt;t.tempMarker&&t.tempMarker.map?(t.tempMarker.setPoint(a),t.tempMarker.show(),t.spotOnUid=n[0].userdata.uid):(t.tempMarker=new BMap.Marker(a,{icon:t.ic,zIndexFixed:!0,baseZIndex:3e6}),t.spotOnUid=n[0].userdata.uid,o.addOverlay(t.tempMarker),t.mkr=t.tempMarker,t.tempMarker.addEventListener("click",function(e){t.clickMkr(e),t.stopAndPrevent(e)})),t.tempMarker.setTop(!0),t.tMkr=t.tempMarker;var i={backgroundColor:"#FFFFE1",borderColor:"#8C8C8C",color:"#4D4D4D"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/};t.labelName=n[0].userdata.name,t.tempLabel&&t.tempLabel.map?(t.tempLabel.setPoint(a),t.tempLabel.setOffset(new BMap.Size(-6*t.labelName.length,16)),t.tempLabel.setContent(t.labelName),t.label=t.tempLabel,t.label.show()):(t.tempLabel=new BMap.Label(t.labelName,{point:a}),t.tempLabel.setOffset(new BMap.Size(-6*t.labelName.length,16)),t.tempLabel.setStyle(i),t.label=t.tempLabel,o.addOverlay(t.label))}}},_moveOutSpot:function(){var e=this,t=e._map;t.getZoom()<10||("_panoPoiClick"==e.cbfunction&&PanoUtil.panoMarker&&PanoUtil.panoMarker.enable(),e.tMkr=null,e.hideOverlays())},moveSpot:function(e){me.stopAndPrevent(e)},clickMkr:function(e){{var t=this,o=t._map;t.tMkr}o.removeOverlay(t.tempMarker),t.tMkr=null,t.tempMarker=null,t.tempLabel=null,t.spotOnId=null;var n="inter";t.dispatchEvent("click",{panoUid:t.spotOnUid,panoType:n}),t.stopAndPrevent(e),addStat(STAT_CODE.STAT_PANORAMA,{item:Pano.PANO_TYPE_INDOOR,catalog:"map",func:"click",from:"overview-map"})},clearPoiCache:function(){var e=this,t=e._map;e.poiSpotId&&(t.removeSpots(e.poiSpotId),e.poiSpotId=null,e.spotOnId=null)},hideOverlays:function(){var e=this;e.mkr&&e.mkr.hide(),e.label&&e.label.hide()},m1:function(e){return Math.floor(parseInt(e,10)/this.squareSide)},stopAndPrevent:function(e){var e=window.event||e;baidu.event.stopPropagation(e),baidu.event.preventDefault(e)}}),o.exports=n});
;define("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoRoadNetComponent/PanoRoadNetComponent.js",function(e,t,o){function a(e){baidu.lang.Class.call(this),this.map=e.map;var t=e.context.panoContext,o=t.getPanoUrlConfig();this.PANO_URL=o.PANO_ROAD_LAYER_URL,this.udtVersion=o.PANO_UDT_VERSION||"20130929",this.visible=!1,this.layerId=""}baidu.lang.inherits(a,baidu.lang.Class,"PanoRoadNetComponent"),baidu.object.extend(a.prototype,{show:function(){this.addLayer(),this.dispatchEvent("onshow",{visible:!0})},hide:function(){this.removeLayer(),this.dispatchEvent("onhide",{visible:!1})},isVisible:function(){return this.visible},addLayer:function(){var e=this,t=e.map;if(t&&!t.getTileLayer(e.layerId)){var o=!0,a=256,i=t.getMapType()==BMAP_NORMAL_MAP?"il":"sl",n=e.tilelayer=new BMap.TileLayer({transparentPng:o});n.zIndex=1,n.getTilesUrl=function(t,o){var n=BMap.MapType[this.getMapType()];if("object"!=typeof n||!t||0>o)return null;var r=Math.pow(2,18-o)*a,s=parseInt(t.lng/r),d=parseInt(t.lat/r),p=e.PANO_URL+"/tile/?udt="+e.udtVersion+"&qt=tile&styles="+i+"&x="+s+"&y="+d+"&z="+o;return T.browser.ie&&T.browser.ie<=6&&(p+="&color_dep=32"),p},t.addTileLayer(n),e.layerId=n.getMapType(),e.visible=!0,window.isPhotoTourSupported&&this.addPhotoTourLayer()}},addPhotoTourLayer:function(){var e={uid:"d270a38b230b50fced74f8f7",bound:{xmin:12958063,ymin:4826872,ymax:4826984,xmax:12958159},name:"故宫照片游",catalog:"street_1",type:"street",icon:{y:4826928,x:12958111}},t=new BMap.Marker(new BMap.Point(e.icon.x,e.icon.y),{icon:new BMap.Icon("../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/phototour_indoor_icon_59074d3.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/phototour_indoor_icon_59074d3.png*/,new BMap.Size(24,28),{offset:new BMap.Size(10,12),infoWindowOffset:new BMap.Size(5,0)}),zIndexFixed:!0,baseZIndex:3e6});this._photoMarker=t;var o=this;t.addEventListener("click",function(t){o.dispatchEvent("photo_tour_enter",{data:e.uid}),T.event.stopPropagation(t.domEvent)}),this.map.addOverlay(t)},removePhotoTourLayer:function(){this._photoMarker&&(this.map.removeOverlay(this._photoMarker),this._photoMarker=null)},removeLayer:function(){var e=this,t=e.map,o=t.getTileLayer(e.layerId);o&&(t.removeTileLayer(o),e.layerId=""),e.visible=!1,e.removePhotoTourLayer()},getLayerId:function(){return this.layerId},update:function(){this.removeLayer(),this.addLayer()}}),o.exports=a});
;define("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoMapComponent.js",function(e,t,o){function n(e,t,o){baidu.lang.Class.call(this),this.mapContainer=e,this._opts=t;var n=t.data.currentPoint||t.data.panoMCPoint;this.point=new BMap.Point(n.x,n.y),this.level=t.level||16,this._map=null,this._fishboneCtrl=null,this._roadnet=null,this._poiClickLayer=null,this._overlay=null,this._indoorModel=o,this._topologyMarkers=[],this.tipLabel=null,this.arrowMarkers=[]}var a=e("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoRoadNetComponent/PanoRoadNetComponent.js"),i=e("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoPoiClickComponent/PanoPoiClickComponent.js"),r=e("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoLocatorComponent/PanoLocatorComponent.js"),s=e("common:widget/pano/base/service.js"),d=e("common:widget/pano/base/util.js"),p=e("common:widget/ui/mapUtil/mapUtil.js"),l=(e("common:widget/ui/Animation/Animation.js"),[{stroke:6,color:"#3a6bdb",opacity:.65},{stroke:6,color:"#3a6bdb",opacity:.95},{stroke:6,color:"#78bc5f",opacity:.95},{stroke:5,color:"#3a6bdb",opacity:.65},{stroke:6,color:"#3a6bdb",opacity:.5},{stroke:4,color:"#78bc5f",opacity:.5},{stroke:6,color:"#688DE1",opacity:.95,strokeStyle:"dashed"},{stroke:6,COLOR:"#575757",OPACITY:.95,STROKESTYLE:"DOTTED"}]);baidu.lang.inherits(n,baidu.lang.Class,"PanoMapComponent"),baidu.object.extend(n.prototype,{initialize:function(){try{this.eventHandlers={},this.initMapLayer(),this.initRoadNetLayer(),this.initPoiClickLayer(),this.initOverlay(),this.updateTopologyMarkers(),this.initScaleControl()}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoMapComponent.js",ln:95})}},updateTopologyMarkers:function(e){for(var t,o=this._map,n=this;this._topologyMarkers.length;)t=this._topologyMarkers.pop(),o.removeOverlay(t);if(!e){var a=this._indoorModel;if(a&&a.has2DMap()){var i=a.getTopologyPoints(),r="../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/panorama/indoor_marker_24_c5cb82c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/indoor_marker_24_c5cb82c.png*/,s=new BMap.Icon(r,new BMap.Size(16,16),{imageOffset:new BMap.Size(0,-30)});this._topologyMarkers=d.each(i,function(e){var t=new BMap.Marker(new BMap.Point(e.panox,e.panoy),{icon:s,title:e.name});return t.addEventListener("click",function(){n.dispatchEvent("pano_changed",{data:{panoId:e.id,panoType:"inter"}})}),o.addOverlay(t),t},!0)}}},initScaleControl:function(){var e=this._map,t=T('<div id="scale-controll-area"><a id="map-zoomout" title="放大一级" href="javascript:void(0)" class="fishbone_button"><span></span></a><div id="map-zoom-line"><div></div></div><a id="map-zoomin" href="javascript:void(0)" title="缩小一级" class="fishbone_button"><span></span></a></div>');this._fishBone=t[0],this.mapContainer.appendChild(this._fishBone);var o=T.g("map-zoomout"),n=T.g("map-zoomin");baidu.on(o,"click",function(t){baidu.event.preventDefault(t),baidu.event.stopPropagation(t);var o=e.getZoom();19>o&&e.zoomTo(o+1)}),baidu.on(o,"mouseenter",function(){baidu(o).addClass("hover")}),baidu.on(o,"mouseleave",function(){baidu(o).removeClass("hover")}),baidu.on(n,"click",function(t){baidu.event.preventDefault(t),baidu.event.stopPropagation(t);var o=e.getZoom();o>3&&e.zoomTo(o-1)}),baidu.on(n,"mouseenter",function(){baidu(n).addClass("hover")}),baidu.on(n,"mouseleave",function(){baidu(n).removeClass("hover")})},hideScaleControl:function(){this._fishBone.style.display="none"},showScaleControl:function(){this._fishBone.style.display="block"},initMapLayer:function(){var e=this,t=e._opts,o=(e._fishboneCtrl,T.dom.create("div",{id:"panoOverviewMap",style:"width:100%; height:100%; overflow: hidden; z-index: "+t.zIndex}));this.mapContainer.appendChild(o),t.parent.style.display="block";var n=e._map=new BMap.Map(o,{coordType:BMAP_COORD_MERCATOR,zoomLevelMin:3,mapType:BMAP_NORMAL_MAP,enableResizeOnCenter:!0,enableCanvas2dMap:!1});n.enableScrollWheelZoom(),n.enableInertialDragging(),n.disableContinuousZoom(),n.centerAndZoom(e.point,e.level||n.getZoom()),n.setDefaultCursor("pointer"),e.bindMapEvents()},drawLine:function(e,t){var o=this._map;void 0===t?t=l[0]:"number"==typeof t&&(t=l[t]);var n=new BMap.Polyline(e,t);o.addOverlay(n)},addMarkers:function(e){for(var t=0;t<e.length;t++)p.addDestPoi(e[t].point,e[t].text,e[t].type,void 0,this._map)},addSearchMarker:function(e,t,o){var n=new BMap.Point(e,t),a="../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-marker_f7456fc.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano-marker_f7456fc.gif*/,i=new BMap.Icon(a,new BMap.Size(18,18));this.removeSearchMarker(),this.searchMarker=new BMap.Marker(n,{icon:i,offset:new BMap.Size(0,-2),title:o}),this._map.addOverlay(this.searchMarker),this.searchMarker.setTop(!0,9999999)},removeSearchMarker:function(){this.searchMarker&&(this._map.removeOverlay(this.searchMarker),this.searchMarker=null)},initRoadNetLayer:function(){var e=this,t=e._map;e._roadnet=new a({context:e._opts.context,map:t}),e._roadnet.addEventListener("photo_tour_enter",function(t){e.dispatchEvent("photo_tour_enter",{data:t.data})}),e._roadnet.show()},initPoiClickLayer:function(){var e=this,t=e._map;e._poiClickLayer=new i({context:e._opts.context,map:t,callback:"panoPoiClick"}),e.bindPoiClickEvents()},removePoiClickLayer:function(){this._roadnet.removeLayer(),this._poiClickLayer.removeEventListener("click",this.eventHandlers.house_click)},initOverlay:function(){var e=this,t=e._map,o=e.point;e.prePos=o,e._overlay=new r({position:o}),t.addOverlay(e._overlay),t.setCenter(o),e._overlay.setDirection(e._opts.data.panoHeading),e.getCurCity(),e.bindOverlayEvents()},initPathLayer:function(){var e=this,t=e._map,o=window.currentComponent;if(o&&o.getOverlays){e.viewportPoints=[];var n,a=o.getOverlays(),i=a.routes;if(i)for(var r=0;r<i.length;r++)n=p.addRoute(i[r].points,i[r].type,void 0,t),e.viewportPoints=e.viewportPoints.concat(n.points);var s=a.drRoutes;if(s)for(var r=0;r<s.length;r++){n=p.addDrRoute(s[r].flag,s[r].obj,!1,t);for(var r=0;r<n.length;r++)e.viewportPoints=e.viewportPoints.concat(n[r].points)}var d=a.transMarkers;if(d)for(var r=0;r<d.length;r++)p.addTransPoi(d[r].point,d[r].type,d[r].text,t);var l=a.destMarkers;if(l)for(var r=0;r<l.length;r++)p.addDestPoi(l[r].point,l[r].text,l[r].type,void 0,t);var v=a.arrows;v&&(e.arrows=v,e.redrawArrow(),t.addEventListener("zoomend",function(){e.redrawArrow()},e.guid+"_zoomend"),t.addEventListener("moveend",function(){e.redrawArrow()},e.guid+"_moveend"));var c=a.tips;if(c)for(var r=0;r<c.length;r++)p.createTip(c[r].content,c[r].className,c[r].opts,t);var m=a.markers;if(m)for(var r=0;r<m.length;r++)t.addOverlay(new BMap.Marker(m[r].point,{icon:m[r].icon,title:m[r].title}))}},setMapClickHook:function(e){this._mapClickHook=e},bindMapEvents:function(){var e=this,t=e._map;e.eventHandlers.map_click=function(t){if("function"==typeof e._mapClickHook){var o=e._mapClickHook(t.point.lng,t.point.lat);if(o===!0)return}e._processMoving||e.getPanoInfo(t.point.lng,t.point.lat)},e.eventHandlers.map_typechange=function(t){t.mapType;e._roadnet&&e._roadnet.update()},e.eventHandlers.map_zoomstart=function(){e._centerPt=t.getCenter()},e.eventHandlers.map_zoomend=function(){t.setCenter(e._centerPt),e.dispatchEvent("level_changed",{data:{level:t.getZoom()}});var o=T.g("map-zoomout"),n=T.g("map-zoomin"),a=t.getZoom();baidu.dom.removeClass(o,"disabled"),baidu.dom.removeClass(n,"disabled"),3==a&&baidu.dom.addClass(n,"disabled"),19==a&&baidu.dom.addClass(o,"disabled"),e._isDrag=!1},e.eventHandlers.map_tilesloaded=function(){e.dispatchEvent("tiles_loaded")},e.eventHandlers.map_dragstart=function(){e._isDrag=!0},e.eventHandlers.map_dragend=function(){e._isDrag&&(e._isDrag=!1,window._pano_overviewmap_leaved&&(window._mouseleave_trigger_source="map",baidu("#panoMapOuterWapper").trigger("mouseleave")))},t.addEventListener("click",e.eventHandlers.map_click),t.addEventListener("maptypechange",e.eventHandlers.map_typechange),t.addEventListener("zoomstart",e.eventHandlers.map_zoomstart),t.addEventListener("zoomend",e.eventHandlers.map_zoomend),t.addEventListener("tilesloaded",e.eventHandlers.map_tilesloaded),baidu.on("panoOverviewMap","mousedown",e.eventHandlers.map_dragstart),baidu.on(document.body,"mouseup",e.eventHandlers.map_dragend),baidu.on("panoOverviewMap","mouseenter",function(){e.dispatchEvent("mouseenter")}),baidu.on("panoOverviewMap","mouseleave",function(){e.dispatchEvent("mouseleave")})},bindPoiClickEvents:function(){var e=this,t=e._poiClickLayer;e.eventHandlers.house_click=function(t){var o={panoIId:t.panoUid,panoType:"inter"};e.dispatchEvent("pano_changed",{data:o})},t.addEventListener("click",e.eventHandlers.house_click)},bindOverlayEvents:function(){var e=this,t=e._overlay;e.eventHandlers.overlay_rotate=function(t){e.setViewPov(t.angle)},e.eventHandlers.overlay_dragend=function(t){e.getPanoInfo(t.point.lng,t.point.lat)},t.addEventListener("oncircleclick",e.eventHandlers.overlay_rotate),t.addEventListener("onrotating",e.eventHandlers.overlay_rotate),t.addEventListener("onrotateend",e.eventHandlers.overlay_rotate),t.addEventListener("ondragend",e.eventHandlers.overlay_dragend)},removeOverlayEvents:function(){var e=this,t=e._overlay;t&&(t.removeEventListener("oncircleclick",e.eventHandlers.overlay_rotate),t.removeEventListener("onrotating",e.eventHandlers.overlay_rotate),t.removeEventListener("onrotateend",e.eventHandlers.overlay_rotate),t.removeEventListener("ondragend",e.eventHandlers.overlay_dragend),e.eventHandlers=null)},setViewPov:function(e){var t=this;if(t.tipLabel&&t.tipLabel.hide(),!isNaN(e)){var o={panoHeading:parseInt(e),panoPitch:0};t.dispatchEvent("pov_changed",{data:o})}},getPanoInfo:function(e,t){var o=this,n=o._map;o.tipLabel&&o.tipLabel.hide();var a=o._opts.context.panoContext.getPanoOptions();s.getStreetBriefByLocation({point:{lng:e,lat:t},level:n.getZoom(),mode:a.mode},function(n){if(0==n.error&&n.content&&n.content.id){var a=n.content.id,i=n.content.point,r=new BMap.Point(i.lng,i.lat);o.prePos=r;var s={panoId:a,panoType:o._opts.data.panoType};o.dispatchEvent("pano_changed",{data:s}),o.getCurCity(),addStat(STAT_CODE.STAT_PANORAMA,{item:Pano.PANO_TYPE_STREET,catalog:"map",func:"click",from:"overview-map"})}else o.showTip(new BMap.Point(e,t)),o.resetPos()},o)},getCurCity:function(e){var t=this,o=t._map,n=o.getBounds(),a=n.minX+","+n.minY+";"+n.maxX+","+n.maxY,i=o.getZoom(),r=(new Date).getTime();baidu.ajax("/?newmap=1&qt=ncent&ie=utf-8&b="+a+"&l="+i+"&t="+r,{dataType:"json",success:function(o){o&&o.content&&o.current_city&&t.setCurCity(o.current_city,e)},error:function(){}})},setCurCity:function(e,t){this._currentCity={cityId:e.code,cityName:e.name},t&&t(this._currentCity)},getCurrentCity:function(e){this._currentCity?e(this._currentCity):this.getCurCity(e)},setOverlayPos:function(e){var t=this;t._processMoving?t._processQueue=e:(t._processMoving=!0,t.eventHandlers.map_movestart=function(){t._processMoving&&(t._map.disableScrollWheelZoom(),t._map.disableDragging())},t.eventHandlers.map_moving=function(){t._processMoving&&t._overlay.setPosition(t._map.getCenter())},t.eventHandlers.map_moveend=function(){t._processMoving&&(t._processMoving=!1,t._overlay.setPosition(t.prePos),t._map.setCenter(t.prePos),t._map.enableScrollWheelZoom(),t._map.enableDragging(),t._map.removeEventListener(t.eventHandlers.map_movestart),t._map.removeEventListener(t.eventHandlers.map_moving),t._map.removeEventListener(t.eventHandlers.map_moveend),t._processQueue&&(t._processMoving=!0,t._map.panTo(t._processQueue),t._processQueue=null))},t._map.addEventListener("movestart",t.eventHandlers.map_movestart),t._map.addEventListener("moving",t.eventHandlers.map_moving),t._map.addEventListener("moveend",t.eventHandlers.map_moveend),t._map.panTo(e))},showTip:function(e){var t=this;if(t.tipLabel)t.tipLabel.setPoint(e),t.tipLabel.show(),t.delayHide();else{var o={point:e,offset:new BMap.Size(0,0)};t.tipLabel=new BMap.Label("<div style='text-align:center;margin-top:5px;'>此处无全景</div ><div style='color:#4869a5;' >请点击蓝色路网</div>",o),t.tipLabel.setStyle({backgroundColor:"#fff",borderColor:"#b1b1b1",borderWidth:"1px",fontSize:"12px",height:"50px",lineHeight:"20px",fontFamily:"微软雅黑"}),t._map.addOverlay(t.tipLabel),t.delayHide()}},delayHide:function(){var e=this;e.tipTimer&&window.clearTimeout(e.tipTimer),e.tipTimer=window.setTimeout(function(){e.tipLabel&&e.tipLabel.hide()},2e3)},resetPos:function(){var e=this;e.prePos&&e._overlay&&(e._overlay.setPosition(e.prePos),e._map.panTo(e.prePos))},update:function(e,t){var o=this;t=t||o.level,e&&t&&o._map.centerAndZoom(e,t)},redrawArrow:function(){for(var e=this._map,t=this.arrows;this.arrowMarkers.length;)e.removeOverlay(this.arrowMarkers.pop());for(var o=0;o<t.length;o++)this.arrowMarkers=this.arrowMarkers.concat(p.addArrow(t[o].split(";"),e))},destroyAll:function(){this.mapContainer.removeChild(this._fishBone);var e=baidu.g("panoOverviewMap");e&&e.parentNode&&e.parentNode.removeChild(e),baidu.un(document.body,"mouseup",this.eventHandlers.map_dragend)},event_povChanged:function(e){var t=this,o=t._overlay;o.setDirection(e)},event_panoChanged:function(e,t){var o,n=this._overlay,a=e.panoHeading||e.heading;o=e.panoMCPoint?new BMap.Point(e.panoMCPoint.x,e.panoMCPoint.y):e.panoPoint?e.panoPoint:new BMap.Point(e.x,e.y),this.prePos=o,this.setOverlayPos(o),n.setDirection(a),this.panoMode=e.mode||this.panoMode,!t||this._indoorModel&&this._indoorModel.equal(t)||(this._indoorModel=t,this.updateTopologyMarkers())},event_floorChanged:function(){this.updateTopologyMarkers(!0)},event_exitIndoor:function(){this.updateTopologyMarkers(!0),this._indoorModel=null},getLevel:function(){return this._map.getZoom()},getBounds:function(){return this._map.getBounds()},getCenter:function(){return this._map.getCenter()},getCenterPointInfo:function(){var e=this;return{panoPoint:e._overlay.getPosition(),panoHeading:e._overlay.getDirection()}},setCenter:function(){var e=this,t=e._overlay;if(t){var o=t.getPosition();t.setOffset(),e._map.panTo(o),e._map.setCenter(o)}},setZoom:function(e){this._map.zoomTo(e)}}),o.exports=n});
;define("common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorOverlayComponent/PanoIndoorOverlayComponent.js",function(e,t,n){function o(e){this._position={x:e.x,y:e.y},this._angle=this._direction=e.angle||190,this._dom=e.dom,this._zIndex=e.zIndex,this._moving=!1,this._arrowDirection="-168px -72px",this._rotating=!1;var t=baidu.dom.getPosition(this._dom);this._domTop=t.top,this._domLeft=t.left,this._opts={enableDragging:!0,anchor:{width:-52,height:-52}},this.DIV_ROTATE_DIRECTION=[[0,-19,-64],[22.5,-203,-59],[45,-391,-59],[67.5,-581,-58],[90,-778,-55],[112.5,-979,-50],[135,-1178,-55],[157.5,-1387,-51],[180,-1611,-60],[202.5,-1821,-61],[225,-2030,-65],[247.5,-2243,-73],[270,-2457,-62],[292.5,-2685,-65],[315,-2901,-70],[337.5,-3120,-70]],this.initialize()}baidu.lang.inherits(o,baidu.lang.Class,"PanoIndoorOverlayComponent"),baidu.object.extend(o.prototype,{initialize:function(){try{var e=this,t=e._container=document.createElement("div"),n=document.createElement("div"),o="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/panorama/pano_markers_1f7469f.png)";e._div=t,e._arrow=n,e._bgu=o,e._setDefCursor(),baidu.extend(t.style,{position:"absolute",zIndex:e._zIndex,backgroundRepeat:"no-repeat",cursor:"pointer",backgroundPosition:"-560px -36px",height:"104px",width:"104px"}),baidu(t).addClass("pano-fan"),baidu.extend(n.style,{position:"absolute",backgroundRepeat:"no-repeat",cursor:"pointer",backgroundPosition:"0 0",height:"24px",width:"24px",left:"34px",marginTop:"32px"}),baidu(n).addClass("pano-overlay-ie"),t.appendChild(n),e._dom.appendChild(t),e.draw(),e.setDirection(e._direction)}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorOverlayComponent/PanoIndoorOverlayComponent.js",ln:102})}},draw:function(){var e=this._opts.anchor,t=this._position;void 0==t.x&&(t.x=0),void 0==t.y&&(t.y=0),this._container.style.left=t.x+e.width+"px",this._container.style.top=t.y+e.height+"px"},enableDragging:function(){this._opts.enableDragging=!0},disableDragging:function(){this._opts.enableDragging=!1},getPosition:function(){return this._position},setPosition:function(e){this._position=e,this.draw()},getDirection:function(){return this._direction},setDirection:function(e){if(!isNaN(e)){var t=this._direction=e;this._getRotateDirection(t)}},remove:function(){me._dispatchEvent(this,"onremove"),this._container&&_purge(this._container),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container)},_setDefCursor:function(){T.browser.firefox?(this.defaultCursor="-moz-grab",this.draggingCursor="-moz-grabbing"):T.browser.chrome||T.browser.safari?(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur) 8 8, default",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur) 8 8, default"):(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur)",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur)")},_getRotateDirection:function(e){if(!isNaN(e)){var t=this.DIV_ROTATE_DIRECTION,n=0,o=e-31.75,i=t.length;if(o>t[i-1][0])this._div.style.backgroundPosition=t[i-1][1]+"px "+d[i-1][2]+"px";else for(var n=0;i>n;n++)if(o<t[n][0]){this._div.style.backgroundPosition=t[n][1]+"px "+t[n][2]+"px";break}}},_getMoveDirection:function(e,t){if(!isNaN(e)&&!isNaN(t)){var n=-1,o=e-this.preX;return this.preX>5&&0>o?n=0:this.preX>5&&o>0&&(n=1),this.preX=e,this.preY=t,n}},_setEventDispath:function(){function e(e){var e=window.event||e,t=e.pageX||e.clientX||0,n=e.pageY||e.clientY||0,o={x:t,y:n};return{point:o}}var t=this,n=t._container,o=t._arrow,i=t._dom,a=(t._angle,!1),r=!1,s=null;o.onmousedown=function(a){var u=e(a);return o.setCapture?(baidu.on(o,"onmousemove",d),baidu.on(o,"onmouseup",p)):(baidu.on(i,"onmousemove",d),baidu.on(i,"onmouseup",p)),t._opts.enableDragging?(s=u.point,t._dispatchEvent(t,"ondragstart",{point:t._position}),r=!0,o.style.cursor=t.draggingCursor,baidu(n).removeClass("pano-overlay-ie"),o.setCapture&&o.setCapture(),i.style.MozUserSelect="none",i.style.KhtmlUserSelect="none",i.style.WebkitUserSelect="none",i.unselectable="on",i.onselectstart=function(){return!1},void t._stopAndPrevent(a)):void t._stopAndPrevent(a)},n.onmousedown=function(e){i.style.MozUserSelect="none",i.style.KhtmlUserSelect="none",i.style.WebkitUserSelect="none",i.unselectable="on",i.onselectstart=function(){return!1},t._stopAndPrevent(e)};var p=function(u){e(u);return o.releaseCapture?(baidu.un(o,"onmousemove",d),baidu.un(o,"onmouseup",p)):(baidu.un(i,"onmousemove",d),baidu.un(i,"onmouseup",p)),t._opts.enableDragging?(o.releaseCapture&&o.releaseCapture(),o.style.backgroundPosition=t._arrowDirection,baidu(n).addClass("pano-overlay-ie"),o.style.cursor="pointer",clearInterval(t._viewtypetimer),t._dispatchEvent(t,"ondragend",{point:t._position}),r=!1,a=!1,s=null,i.style.MozUserSelect="",i.style.KhtmlUserSelect="",i.style.WebkitUserSelect="",i.unselectable="off",i.onselectstart=function(){},void t._stopAndPrevent(u)):void t._stopAndPrevent(u)},d=function(n){if(t._opts.enableDragging&&r){var o=e(n),i=t._position,a=o.point.x-s.x+i.x,p=o.point.y-s.y+i.y;s=o.point,t._position={x:a,y:p},t.draw(),t._dispatchEvent(t,"ondragging",{point:t._position}),t._stopAndPrevent(n)}}},_dispatchEvent:function(e,t,n){0!=t.indexOf("on")&&(t="on"+t);var o=new baidu.lang.Event(t);if(n)for(var i in n)o[i]=n[i];e.dispatchEvent(o)},_purge:function(e){if(e){var t=e.attributes,n="";if(t)for(var o=0,i=t.length;i>o;o++)n=t[o].name,"function"==typeof e[n]&&(e[n]=null);var a=e.childnodes;if(a)for(var o=0,i=a.length;i>o;o++)me._purge(e.childnodes[o])}},_stopAndPrevent:function(e){var e=window.event||e;baidu.event.preventDefault(e),baidu.event.stopPropagation(e)}}),n.exports=o});
;define("common:widget/pano/module/PanoOverviewModule/FloorComponent/FloorComponent.js",function(e,o,t){var n=e("common:widget/ui/Animation/Animation.js"),i=e("common:widget/pano/component/TableView/TableView.js"),a=e("common:widget/pano/base/util.js");e.loadCss({content:".floor-container{position:absolute;height:20px;background-color:#252525;filter:alpha(opacity=90);background-color:rgba(37,37,37,.9)}#pano-floor-wrapper .floor-container{top:3px}.floor-container .tableview-wapper{left:20px}.floor-container .tableview-la,.floor-container .tableview-ra{position:absolute;width:30px;text-align:center}.floor-container .tableview-ra .tableview-bg,.floor-container .tableview-la .tableview-bg{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/floor_10cc722.png);background-repeat:no-repeat}.floor-container .tableview-ra .tableview-bg{background-position:-24px -1px}.floor-container .tableview-ra:hover .tableview-bg{background-position:-36px -1px}.floor-container .tableview-la .tableview-bg{background-position:-10px -1px}.floor-container .tableview-la:hover .tableview-bg{background-position:2px -1px}.floor-container .tableview-ra.tableview-ra-disabled,.floor-container .tableview-la.tableview-la-disabled{display:none}.floor-number{line-height:20px;color:#abb0b2;padding:0 12px;text-align:center;text-decoration:none;cursor:pointer;border-right:1px solid #3c3e42}.floor-container .selected-item .floor-number,.floor-number:hover{color:#3af}.floor-container .tableview-li{height:20px}.floor-number.first{border-left:0}.floor-number.last{border-right:0}.floor-container .tableview-selected-border{display:none}"});var r='<a i="{$i}"class="floor-number {$class}" href="javascript:void(0);">{$text}</a>',l=function(e,o){var t=o.getFloorInfo(),n=o.has2DMap(),l=o.hasPlanMap(),s=this.container=document.createElement("div");e.appendChild(s),s.className="floor-container",this._floorIndex=0,this._data=o,this._position={left:0,top:0};var c=this.tableView=new i(s,{viewWidth:304,viewHeight:20,isHorizontal:!0,isFullSize:n||l?!1:!0,margin:"0"});a.each(t,function(e,o){var n="";n=e.realFloor>0?r.replace("{$text}",e.realFloor+"F"):r.replace("{$text}",e.realFloor.toString().replace("-","B")),n=n.replace("{$i}",o).replace("{$class}",0==o?"first":o==t.length-1?"last":""),c.addItemContent(n)});var p=this;c.addEventListener("click",function(e){e.index!==p._floorIndex&&p.dispatchEvent("item_click",{index:e.index})}),c.resize(),baidu.event.on(s,"mouseleave",function(e){for(var o=e.relatedTarget;o;){if("pano-overview-wrapper"==o.id)return;if(o==document.body)break;o=o.parentNode}p.dispatchEvent("fold_overview")})};baidu.lang.inherits(l,baidu.lang.Class),T.object.extend(l.prototype,{setFloorIndex:function(e){this._floorIndex=e,this.tableView.setSelectIndex(this._floorIndex)},getFloorIndex:function(){return this._floorIndex},getData:function(){return this._data},destroy:function(){this._data=null,this._floorIndex=null,this.container.parentNode.removeChild(this.container),this.container=null,this.tableView.destroy()},setPosition:function(e,o,t){var i=this.container;if(t){var a=this._position.left,r=this._position.top,l=e-a,s=o-r,c=new n.Animation,p={duration:400,fps:40,delay:n.Animation.INFINITE,transition:n.Transitions.easeOutQuad,finish:function(){},render:function(e){try{i.style.left=a+l*e+"px",i.style.top=r+s*e+"px"}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoOverviewModule/FloorComponent/FloorComponent.js",ln:116})}}};c.build(p),c.start()}else i.style.left=e+"px",i.style.top=o+"px";this._position={left:e,top:o}}}),t.exports=l});
;define("common:widget/pano/module/PanoOverviewModule/CatalogComponent/CatalogComponent.js",function(t,e,i){var o=t("common:widget/ui/Animation/Animation.js"),n=t("common:widget/pano/component/TableView/TableView.js"),a=t("common:widget/pano/base/util.js");t.loadCss({content:".catalog-container{position:absolute;top:-23px;left:-2px;height:25px;background-color:#252525;filter:alpha(opacity=90);background-color:rgba(37,37,37,.9)}#pano-floor-wrapper .catalog-container{top:-2px}.catalog-text{line-height:25px;color:#666;padding:0 12px;text-align:center;text-decoration:none;cursor:pointer;border-left:1px solid #3c3e42;border-right:1px solid #3c3e42}.catalog-container .selected-item .catalog-text,.catalog-text:hover{color:#fff}.catalog-container .tableview-li{height:25px}.catalog-text.first{border-left:0}.catalog-text.last{border-right:0}.catalog-container .tableview-selected-border{display:none}"});var l='<a i="{$i}" class="catalog-text {$class}" href="javascript:void(0);">{$text}</a>',r=function(t,e){var i=e.has2DMap(),o=e.hasPlanMap(),r=e.getCatalogList(),s=this.container=document.createElement("div");t.appendChild(s),s.className="catalog-container",this._index=0,this._data=e;var c=this.tableView=new n(s,{viewWidth:304,viewHeight:25,isHorizontal:!0,isFullSize:i||o?!1:!0,margin:"0"});a.each(r,function(t,e){var i=l.replace("{$i}",e).replace("{$text}",t.label).replace("{$class}",0==e?"first":e==r.length-1?"last":"");c.addItemContent(i)});var d=this;c.addEventListener("click",function(t){t.index!==d._index&&d.dispatchEvent("item_click",{index:t.index})}),c.resize(),baidu.event.on(s,"mouseleave",function(t){for(var e=t.relatedTarget;e;){if("pano-overview-wrapper"==e.id)return;if(e==document.body)break;e=e.parentNode}d.dispatchEvent("fold_overview")})};baidu.lang.inherits(r,baidu.lang.Class),T.object.extend(r.prototype,{setSelectIndex:function(t){this._index=t,this.tableView.setSelectIndex(this._index)},getSelectIndex:function(){return this._index},getData:function(){return this._data},destroy:function(){this._data=null,this._floorIndex=null,this.container.parentNode.removeChild(this.container),this.container=null,this.tableView.destroy()},setPosition:function(t,e,i){var n=this.container;if(i){var a=this._position.left,l=this._position.top,r=t-a,s=e-l,c=new o.Animation,d={duration:400,fps:40,delay:o.Animation.INFINITE,transition:o.Transitions.easeOutQuad,finish:function(){},render:function(t){try{n.style.left=a+r*t+"px",n.style.top=l+s*t+"px"}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoOverviewModule/CatalogComponent/CatalogComponent.js",ln:109})}}};c.build(d),c.start()}else n.style.left=t+"px",n.style.top=e+"px";this._position={left:t,top:e}}}),i.exports=r});
;define("common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorPlanComponent.js",function(t,o,e){function i(t,o){T.lang.Class.call(this),this.mapContainer=t,this.opts=o||{}}var n=t("common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorOverlayComponent/PanoIndoorOverlayComponent.js"),r=t("common:widget/ui/util/util.js");baidu.lang.inherits(i,baidu.lang.Class,"PanoIndoorPlanComponent"),baidu.object.extend(i.prototype,{initialize:function(){try{this.isOpen=!1,this.tileSign={},this.viewport=null,this.VIEWPORTLT={x:0,y:0},this.panoMarker=null,this.mapDragging=!1,this.indoorInfo=null,this.tileWrap=null,this.tileLayer=null,this.markerLayer=null;var t=this.opts.context.panoContext.getPanoUrlConfig();this.udtVersion=t.UDT_VERSION||"20130819",this.tileUrl=t.PANO_SERVICE_URL+"?udt="+this.udtVersion+"&qt=tdata",this.markers=[],this.EVENT={},this.indoorInfo=this.adjustIndoorData(this.opts.data),this.opts.parent.style.display="block",this.createDomElements(),this.createOverlay(),this.initIndoorView(),this.initScaleControl(),this.bindDomEvent()}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorPlanComponent.js",ln:73})}},createDomElements:function(){var t=this,o=t.opts;return t.indoorViewContainer=T.dom.create("div",{id:"panoIndoorMap",style:"position:relative;width:100%; height:100%; background-color: #fff; overflow: hidden; z-index: "+o.zIndex}),t.tileWrap=T.dom.create("div",{id:"tileWrap",style:"position: absolute; left: 0; top: 0; width: 512px; height: 256px; color: green;"}),t.tileLayer=T.dom.create("div",{style:"position:absolute;top:0;left:0;right:0;bottom:0;z-index:11"}),t.markerLayer=T.dom.create("div",{style:"position:absolute;top:0;left:0;right:0;bottom:0;z-index:12"}),t.tileWrap.appendChild(t.tileLayer),t.tileWrap.appendChild(t.markerLayer),this.indoorViewContainer.appendChild(t.tileWrap),this.mapContainer&&this.mapContainer.appendChild(t.indoorViewContainer),t.viewport=t.indoorViewContainer,!0},createOverlay:function(){var t=this,o=t.opts,e=o.data.currentPoint?o.data.currentPoint:{x:o.data.x,y:o.data.y};t.overlay=new n({type:"indoorOverlay",position:e,dom:t.indoorViewContainer,zIndex:o.zIndex})},checkIndoorInfo:function(t){var o=this;return o.indoorInfo=o.adjustIndoorData(t.data),!!o.indoorInfo},renderView:function(t){try{var o=baidu.g("panoIndoorMap"),e=o.clientWidth,i=o.clientHeight,n={x:-t.x,y:-t.y},r={x:n.x+e,y:n.y+i};t.x>0&&(n.x=0,r.x=parseInt(this.tileWrap.style.width)),t.y>0&&(n.y=0,r.y=parseInt(this.tileWrap.style.height));var a=this._filterTile(n,r,{mw:this.indoorInfo.width,mh:this.indoorInfo.height,tw:this.indoorInfo.tileWidth,th:this.indoorInfo.tileHeight});this.addTileLayer({dom:this.tileLayer,area:a,tile:{width:this.indoorInfo.tileWidth,height:this.indoorInfo.tileHeight}})}catch(s){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorPlanComponent.js",ln:185})}},adjustIndoorData:function(t){this._getDefZoom(t.width,t.height,512,512);t.defZoom=t.zoomLevel>1?2:1,t.tileWidth=256,t.tileHeight=256;var o=Math.pow(2,t.defZoom-1);t.width=t.width/o,t.height=t.height/o,t.currZoom=t.defZoom;for(var e=0,i=t.points.length;i>e;e++)t.points[e].x/=o,t.points[e].y/=o;t.currPoint={};var n=t.currentPid||t.uid;if(t.points.length)for(var e=0;e<t.points.length;e++)if(t.points[e].id===n){t.currPoint.x=t.points[e].x,t.currPoint.y=t.points[e].y;break}return t.uid&&t.currPoint.x&&t.currPoint.y||(t.currPoint.x=t.points[0].x,t.currPoint.y=t.points[0].y),t},initIndoorView:function(){this.tileSign={},this.markers=[],this.markerLayer.innerHTML="",this.tileLayer.innerHTML="";var t=this.adjustCenter(this.indoorInfo.currPoint);this.tileWrap.style.width=this.indoorInfo.width+"px",this.tileWrap.style.height=this.indoorInfo.height+"px",this.renderView({x:t.left,y:t.top}),this.addMarkers()},initScaleControl:function(){var t=this,o=T('<div id="scale-controll-area"><a id="map-zoomout" title="放大一级" href="javascript:void(0)" class="fishbone_button"><span></span></a><div id="map-zoom-line"><div></div></div><a id="map-zoomin" href="javascript:void(0)" title="缩小一级" class="fishbone_button"><span></span></a></div>');this._fishBone=o[0],this.indoorViewContainer.appendChild(this._fishBone);var e=T.g("map-zoomout"),i=T.g("map-zoomin");baidu.on(e,"click",function(o){baidu.event.preventDefault(o),baidu.event.stopPropagation(o),t.indoorInfo.currZoom>1&&t.zoom(1,{x:t.viewport.offsetWidth/2,y:t.viewport.offsetHeight/2})}),baidu.on(i,"click",function(o){baidu.event.preventDefault(o),baidu.event.stopPropagation(o),t.indoorInfo.currZoom<t.indoorInfo.zoomLevel&&t.zoom(-1,{x:t.viewport.offsetWidth/2,y:t.viewport.offsetHeight/2})})},bindDomEvent:function(){this._bindMouseDragEvent(),this._bindMouseWheelEvent(),this._bindClickEvent()},removeEvents:function(){var t=this;t.EVENT&&(t.overlay.removeEventListener("ondragend",t.EVENT._cameraDragEnd),T(t.indoorViewContainer).off("mousedown",t.EVENT._mouseDown),T(t.indoorViewContainer).off("mousemove",t.EVENT._mouseMove),T(t.indoorViewContainer).off("mouseup",t.EVENT._mouseUp),T(t.indoorViewContainer).off("mouseleave",t.EVENT._mouseOut),T(document.body).off("mouseup",t.EVENT._bodymouseUp),T.un(t.viewport,T.browser.firefox?"DOMMouseScroll":"onmousewheel"),T(t.viewport).off("click",t.EVENT._clickPoint),t.EVENT=null)},_bindMouseDragEvent:function(){function t(t){MS_POS.x=t.pageX,MS_POS.y=t.pageY,r.preventDefault(t)}window.MS_POS={initX:0,initX:0,y:0,MOUSEDOWN:!1,DRAG:!1};var o=(this.tileWrap,this);o.EVENT._mouseDown=function(e){this.style.cursor="url('http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur'), move",MS_POS.MOUSEDOWN=!0,t(e),MS_POS.initX=e.pageX,MS_POS.initY=e.pageY,o._isDrag=!0},o.EVENT._mouseMove=function(e){MS_POS.MOUSEDOWN&&(this.style.cursor="url('http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur')",MS_POS.DRAG=!0,o._drag({x:e.pageX-MS_POS.x,y:e.pageY-MS_POS.y}),t(e))},o.EVENT._mouseUp=function(e){this.style.cursor="pointer",MS_POS.DRAG&&Math.abs(e.pageX-MS_POS.initX)<3&&Math.abs(e.pageY-MS_POS.initY)<3&&(MS_POS.DRAG=!1),MS_POS.MOUSEDOWN=!1,t(e),o.renderView({x:parseInt(o.tileWrap.style.left),y:parseInt(o.tileWrap.style.top)})},o.EVENT._bodymouseUp=function(){o._isDrag&&(o._isDrag=!1,window._pano_overviewmap_leaved&&(window._mouseleave_trigger_source="map",baidu("#panoMapOuterWapper").trigger("mouseleave")))},o.EVENT._mouseOut=function(e){MS_POS.MOUSEDOWN&&(MS_POS.MOUSEDOWN=!1,MS_POS.DRAG=!1,t(e),o.renderView({x:parseInt(o.tileWrap.style.left),y:parseInt(o.tileWrap.style.top)}))},o.EVENT._cameraDragEnd=function(t){o.EVENT._setCameraPos(t.point.x-parseInt(o.tileWrap.style.left),t.point.y-parseInt(o.tileWrap.style.top))},o.overlay.addEventListener("ondragend",o.EVENT._cameraDragEnd),T.on(this.indoorViewContainer,"mousedown",o.EVENT._mouseDown),T.on(this.indoorViewContainer,"mousemove",o.EVENT._mouseMove),T.on(this.indoorViewContainer,"mouseup",o.EVENT._mouseUp),T.on(document.body,"mouseup",o.EVENT._bodymouseUp),T.on(this.indoorViewContainer,"mouseleave",o.EVENT._mouseOut)},_bindMouseWheelEvent:function(){var t=this,o=T.browser.firefox?"DOMMouseScroll":"onmousewheel";t.EVENT._zoomMouseWheel=function(o){r.stopBubble(o);var e=T(this).offset(),i=-o.detail/3||o.wheelDelta/120,n=o.pageX-e.left,a=o.pageY-e.top;t.zoom(i,{x:n,y:a})},T.on(this.viewport,o,t.EVENT._zoomMouseWheel)},_bindClickEvent:function(){var t=this;t.EVENT._clickPoint=function(o){if(MS_POS.DRAG)return void(MS_POS.DRAG=!1);var e=T(t.tileWrap).offset(),i=o.pageX-e.left,n=o.pageY-e.top;t.EVENT._setCameraPos(i,n),t.renderView({x:parseInt(t.tileWrap.style.left),y:parseInt(t.tileWrap.style.top)})},t.EVENT._setCameraPos=function(o,e){if(t.markers.length){for(var i,n,r=0,a=0,s=0;s<t.markers.length;s++)n=t.markers[s],i=Math.pow(Math.abs(n.x-o),2)+Math.pow(Math.abs(n.y-e),2),0===s?a=i:a>i&&(a=i,r=s);t._clickMarker(t.markers[r])}},t.EVENT._zoomIn=function(o){r.stopBubble(o),t.zoom(1,{x:t.viewport.offsetWidth/2,y:t.viewport.offsetHeight/2})},t.EVENT._zoomOut=function(o){r.stopBubble(o),t.zoom(-1,{x:t.viewport.offsetWidth/2,y:t.viewport.offsetHeight/2})},t.EVENT._zoomInMouseMove=function(){1!=t.indoorInfo.currZoom&&(this.style.backgroundPosition="-31px 0")},t.EVENT._zoomOutMouseMove=function(){t.indoorInfo.currZoom!=t.indoorInfo.zoomLevel&&(this.style.backgroundPosition="0 -25px")},t.EVENT._zoomInMouseLeave=function(){1!=t.indoorInfo.currZoom&&(this.style.backgroundPosition="0 0")},t.EVENT._zoomOutMouseLeave=function(){t.indoorInfo.currZoom!=t.indoorInfo.zoomLevel&&(this.style.backgroundPosition="-31px -25px")},T.on(this.viewport,"click",t.EVENT._clickPoint)},_drag:function(t){var o,e,i=parseInt(this.tileWrap.style.left),n=parseInt(this.tileWrap.style.top),r=this.viewport.offsetWidth,a=this.viewport.offsetHeight,s=r-parseInt(this.tileWrap.style.width),d=a-parseInt(this.tileWrap.style.height),l=i,p=n;i=i+t.x>0?0:i+t.x,n=n+t.y>0?0:n+t.y,i=i>s?i:s,n=n>d?n:d,this.tileWrap.style.left=i+"px",this.tileWrap.style.top=n+"px",this._checkAdjustTileWrap(r,a,this.tileWrap),o=s>0?0:i-l,e=d>0?0:n-p;var h={x:this.overlay.getPosition().x+o,y:this.overlay.getPosition().y+e};this.overlay.setPosition(h)},_checkAdjustTileWrap:function(t,o,e){var i=parseInt(e.style.left),n=parseInt(e.style.top),r=parseInt(e.style.width),a=parseInt(e.style.height);return t>r&&(i=(t-r)/2),o>a&&(n=(o-a)/2),e.style.left=i+"px",e.style.top=n+"px",!0},adjustCenter:function(t){var o,e,i=this.opts.parent,n=i.offsetWidth,r=i.offsetHeight,a=this.indoorInfo.width,s=this.indoorInfo.height,d=this.tileWrap;return e=r>=s?(r-s)/2:t.y<=r/2?0:s-t.y<r/2?r-s:r/2-t.y,d.style.top=e+"px",o=n>=a?(n-a)/2:t.x<=n/2?0:a-t.x<n/2?n-a:n/2-t.x,d.style.left=o+"px",{left:o,top:e}},addTileLayer:function(t){var o,e,i=(t.dom,t.area),n=(t.tile.height,t.tile.width,t.tile),r=t.dom,a=null,s=this;s._totalTileImg=(i.maxCol+1-i.minCol)*(i.maxRow+1-i.minRow),s._tileImgLoaded=0;for(var d=i.minCol;d<=i.maxCol;d++)for(var l=i.minRow;l<=i.maxRow;l++)this.tileSign[d+"_"+l]||(this.tileSign[d+"_"+l]=!0,e=n.width*d,o=n.height*l,a=T.dom.create("img",{src:this.tileUrl+"&iid="+this.indoorInfo.innerId+"&f="+this.indoorInfo.realFloor+"&l="+this.indoorInfo.currZoom+"&pos="+d+"_"+l,style:"position: absolute; top: "+o+"px; left:"+e+"px; width: 256px; height: 256px; display: block;"}),a.complete?s._tileImgLoadHandler():a.onload=function(){s._tileImgLoadHandler()},r.appendChild(a))},_tileImgLoadHandler:function(){var t=this;t._tileImgLoaded++,t._tileImgLoaded==t._totalTileImg&&(t.dispatchEvent("tiles_loaded"),t.opts.parent.style.visibility="visible")},_filterTile:function(t,o,e){var i=e.tw,n=e.th,r=o.x-t.x>e.mw?t.x+e.mw:o.x,a=o.y-t.y>e.mh?t.y+e.mh:o.y,s=Math.floor(t.y/i),d=Math.floor(t.x/i),l=Math.ceil(a/n)-1,p=Math.ceil(r/i)-1;return{minRow:s,minCol:d,maxRow:l,maxCol:p}},_getDefZoom:function(t,o,e,i){var n=1,r=e+512,a=i+512;if(r>=t||a>=o)n=1;else{for(;t>=r&&o>=a;)t/=2,o/=2,n++;n--}return n},zoom:function(t,o){if(this._zoomData(t)){var e=this.viewport.offsetWidth,i=this.viewport.offsetHeight,n=this.indoorInfo.width,r=this.indoorInfo.height,a=parseInt(this.tileWrap.style.left),s=parseInt(this.tileWrap.style.top),d=o.x-(o.x-a)*Math.pow(2,t),l=o.y-(o.y-s)*Math.pow(2,t);this.tileSign={},this.markerLayer.innerHTML="",this.tileLayer.innerHTML="",this.tileWrap.style.width=this.indoorInfo.width+"px",this.tileWrap.style.height=this.indoorInfo.height+"px",d=d>0?0:d,l=l>0?0:l,d=e>n+d?e-n:d,l=i>r+l?i-r:l,d=e>n?(e-n)/2:d,l=i>r?(i-r)/2:l,this.tileWrap.style.left=d+"px",this.tileWrap.style.top=l+"px",this.renderView({x:d,y:l}),this.addMarkers()}},_zoomData:function(t){var o=this.indoorInfo.zoomLevel,e=this.indoorInfo.currZoom,i=this.indoorInfo;if(0>t&&e===o||t>0&&1===e)return!1;if(t>0){i.currZoom-=1,i.width*=2,i.height*=2;for(var n in i.points)i.points[n].x*=2,i.points[n].y*=2;i.currPoint.x*=2,i.currPoint.y*=2}else{i.currZoom+=1,i.width/=2,i.height/=2;for(var n in i.points)i.points[n].x/=2,i.points[n].y/=2;i.currPoint.x/=2,i.currPoint.y/=2}var r=T.g("map-zoomout"),a=T.g("map-zoomin");return baidu.dom.removeClass(a,"disabled"),baidu.dom.removeClass(r,"disabled"),1==i.currZoom?baidu.dom.addClass(r,"disabled"):i.currZoom==o&&baidu.dom.addClass(a,"disabled"),!0},addMarkers:function(){var t,o,e,i,n=[[10,10,0,-46],[16,16,0,-30],[30,30,0,0]],r=this.indoorInfo.zoomLevel-this.indoorInfo.currZoom,a=this.indoorInfo.currPoint,s=Math.floor((this.indoorInfo.zoomLevel+1)/3),d=this.indoorInfo.zoomLevel-2*s;s>r&&(i=0),r>=s&&s+d>r&&(i=1),r>=s+d&&(i=2);var l="../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/panorama/indoor_marker_24_c5cb82c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/indoor_marker_24_c5cb82c.png*/,p="../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/panorama/indoor_marker_8_2851109.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/indoor_marker_8_2851109.png*/;this.markers=[];var h={x:a.x+parseInt(this.tileWrap.style.left),y:a.y+parseInt(this.tileWrap.style.top)};this.overlay.setPosition(h),this.overlay.setDirection(a.defaultAngle);for(var u=0;u<this.indoorInfo.points.length;u++)o=this.indoorInfo.points[u],e=n[i],t={dom:T.dom.create("div",{"data-id":o.id,title:o.name,style:"position:absolute; width:"+e[0]+"px; height:"+e[1]+"px;top:"+(o.y-e[1]/2)+"px;left:"+(o.x-e[0]/2)+"px;background:url("+l+") no-repeat "+e[2]+"px "+e[3]+"px; _background:url("+p+") no-repeat  "+e[2]+"px "+e[3]+"px;"}),id:o.id,x:o.x,y:o.y},0==o.pin&&(t.dom.style.display="none"),this.markers.push(t),this.markerLayer.appendChild(t.dom)},redraw:function(){var t=this.indoorInfo.currPoint;if(this.adjustCenter(t),this.overlay){var o={x:t.x+this.tileWrap.offsetLeft,y:t.y+this.tileWrap.offsetTop};this.overlay.setPosition(o),t.heading&&this.overlay.setDirection(t.heading)}this.renderView({x:parseInt(this.tileWrap.style.left),y:parseInt(this.tileWrap.style.top)})},_clickMarker:function(t){this.setCenter(t),this.dispatchEvent("pano_changed",{data:{panoId:t.id,panoType:"inter"}})},event_povChanged:function(t){this.overlay.setDirection(t)},event_indoorIdChanged:function(t){var o=this,e=t.data.id=t.data.pid;for(var i in o.markers)o.markers[i].id===e&&(t.data.x=o.markers[i].x,t.data.y=o.markers[i].y);this.setCenter(t.data)},event_exitIndoor:function(){this.removeEvents()},destroyAll:function(){this.indoorViewContainer.removeChild(this._fishBone);var t=baidu.g("panoIndoorMap");t&&t.parentNode&&t.parentNode.removeChild(t)},getCurrentCity:function(t){var o=this;if(o._currentCity)return void t(o._currentCity);var e=o.opts.data,i=(new Date).getTime(),n=e.x-1+","+(e.y-1)+";"+(e.x+1)+","+(e.y+1);baidu.ajax("/?newmap=1&qt=ncent&ie=utf-8&b="+n+"&l=16&t="+i,{dataType:"json",success:function(e){if(e&&e.content&&e.current_city){var i=e.current_city;o._currentCity={cityId:i.code,cityName:i.name},t&&t(o._currentCity)}},error:function(){}})},getBounds:function(){},setCenter:function(t){t&&(this.indoorInfo.currPoint=t),this.redraw()},getInnerId:function(){return this.opts.data.innerId},getLevel:function(){return void 0}}),e.exports=i});
;define("common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",function(e,t,o){var a=e("common:widget/pano/module/PanoOverviewModule/PanoMapComponent/PanoMapComponent.js"),n=e("common:widget/pano/module/PanoOverviewModule/FloorComponent/FloorComponent.js"),i=e("common:widget/pano/module/PanoOverviewModule/CatalogComponent/CatalogComponent.js"),r=e("common:widget/pano/module/PanoOverviewModule/PanoIndoorPlanComponent/PanoIndoorPlanComponent.js"),s=e("common:widget/pano/base/ModuleClass.js"),p=e("common:widget/pano/module/PanoModule/FlashRender/FlashUtil.js"),d=(e("common:widget/pano/base/service.js"),e("common:widget/pano/base/util.js")),l=(e("common:widget/pano/model/IndoorData.js"),e("common:widget/ui/Animation/Animation.js")),h={none:0,overview:1,plan:2};e.loadCss({content:'#panoOvFramePinBg{position:absolute;right:0;top:0;width:20px;height:20px;overflow:hidden;background-color:#252525;-ms-filter:"alpha(Opacity=90)";filter:alpha(opacity=90);-moz-opacity:.9;-khtml-opacity:.9;opacity:.9;display:none}.panoOvFramePin{position:absolute;right:2px;top:2px;width:18px;height:18px;overflow:hidden;display:none;cursor:pointer}.panoOvFramePin_lock{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/map_fishbone2_da6749c.png);background-repeat:no-repeat;background-position:-49px -69px}.panoOvFramePin_lock:hover{background-position:-75px -69px}.panoOvFramePin_locked{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/map_fishbone2_da6749c.png);background-repeat:no-repeat;background-position:3px -69px}.panoOvFramePin_locked:hover{background-position:-23px -69px}#panoOvMarkerPosition{position:absolute;left:0;width:300px;height:106px;overflow:hidden}.overview-back-btn{height:20px;line-height:20px;width:300px;position:absolute;bottom:0;cursor:pointer;text-align:center;border-top:0;border-bottom:0;display:block;text-decoration:none;-webkit-transition:color 300ms,background-color 300ms;background-color:#252525;background-color:rgba(37,37,37,.5);filter:alpha(opacity=60);_filter:alpha(opacity=60);color:#ebf0f5}.panoOvFrameMask{position:absolute;left:0;bottom:20px;width:100%;height:100%}#scale-controll-area{display:none;position:absolute;right:2px;bottom:22px;z-index:100019;font-size:0;border-radius:2px;background-color:#252525;background-color:rgba(37,37,37,.5);filter:alpha(opacity=60);_filter:alpha(opacity=60)}#scale-controll-area:hover{background-color:#252525;background-color:rgba(37,37,37,.8);filter:alpha(opacity=80);_filter:alpha(opacity=80)}.fishbone_button{_background:#535458;width:18px;height:18px;display:inline-block;cursor:pointer;overflow:hidden;position:relative}.fishbone_button span{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/map_fishbone2_da6749c.png);background-repeat:no-repeat;width:18px;height:18px;display:inline-block;cursor:pointer;overflow:hidden;position:relative}#map-zoomout{border-radius:2px 2px 0 0}#map-zoomout.fishbone_button span{background-position:-36px 4px}#map-zoomout.fishbone_button.hover span{background-position:-16px 4px}#map-zoomout.fishbone_button:hover span{background-position:-16px 4px}#map-zoomout.fishbone_button.disabled span,#map-zoomout.fishbone_button.disabled:hover span{background-position:4px 4px}#map-zoom-line{background-color:rgba(37,37,37,.5);_background-color:#252525;filter:alpha(opacity=50);_filter:alpha(opacity=50)}#map-zoom-line div{height:1px;font-size:1px;line-height:1px;margin:0 auto;width:12px;background:#a8a8a8;_background-color:#a8a8a8}#map-zoomin{border-radius:0 0 2px 2px}#map-zoomin.fishbone_button span{background-position:-36px -15px}#map-zoomin.fishbone_button.hover span{background-position:-16px -15px}#map-zoomin.fishbone_button:hover span{background-position:-16px -15px}#map-zoomin.fishbone_button.disabled span,#map-zoomin.fishbone_button.disabled:hover span{background-position:4px -15px}.pano-fan{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_fan_direction_1db0df5.png)!important;_background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_fan_direction_8_3d9034f.png)}#panoMapOuterWapper .overview-back-btn:hover{background-color:rgba(37,37,37,.8);filter:alpha(opacity=80);_filter:alpha(opacity=80);color:#3af}#panoMapOuterWapper:hover #scale-controll-area{display:block}'});var m=106,c=function(e,t){var o=e.x-4,a=e.y;return o>=t.minX&&o<=t.maxX&&a>=t.minY&&a<=t.maxY?!0:!1},u=function(e,t,o,a){var n=(t.maxX-t.minX)/o,i=(t.maxY-t.minY)/a;return{x:(e.x-t.minX)/n,y:a-(e.y-t.minY)/i}},v=function(e,t){var o={x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2},a=180*Math.atan(Math.abs((e.x-o.x)/(e.y-o.y)))/Math.PI;return e.x>=o.x&&e.y<=o.y&&(a=180-a),e.x<=o.x&&e.y<=o.y&&(a=180+a),e.x<=o.x&&e.y>=o.y&&(a=360-a),a},_=s.extend("PanoOverviewModule",{constructor:function(){this._map=null,this._opts=null,this._currentPanoType=null,this._mapType=h.none,this._mapCache={markers:null,points:null},this._state="enable",this._searchMarker={}},isAsync:function(){return!0},initialize:function(e){try{var t=this;this._opts=e;var o=t._opts.data;t.animationStart=!1,t.animation=new l.Animation,t.initOutFrame(),t.bindOutFrameEvent(),o&&t.create(o.panoType,t._opts)}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",ln:121})}},initOutFrame:function(){var e=this._opts,t=T.dom.create("div",{id:"panoOvFramePin","class":"panoOvFramePin",title:"固定",style:"z-index: "+e.zIndex+21}),o=T.dom.create("div",{id:"panoOvFramePinBg",style:"z-index: "+e.zIndex+20}),a=T.dom.create("div",{id:"panoOvMarkerPosition",style:"z-index: 0"}),n=T.dom.create("a",{id:"overviewBackBtn",className:"overview-back-btn",style:"z-index: 2"});n.href="javascript:void(0);",n.innerHTML="返回地图";var i=T.dom.create("div",{id:"panoMapOuterWapper",style:"position:absolute;height:100%;width:100%;z-index:"+e.zIndex+10}),r=T.dom.create("div",{id:"panoOverMapWapper",style:"position:absolute;height:100%;width:100%;z-index:1;"});i.appendChild(t),i.appendChild(o),r.appendChild(a),i.appendChild(n),i.appendChild(r),e.parent&&e.parent.appendChild(i),this.createPositionFlash(a)},drawLine:function(e,t){return this._map instanceof a?(this._mapCache.points=e,this._mapCache.drawLineOptions=t,this._map.drawLine(e,t)):!1},addMarkers:function(e){return this._map instanceof a?(this._mapCache.markers=e,this._map.addMarkers(e)):!1},addSearchMarker:function(e,t,o){return this._map instanceof a?(this._map.addSearchMarker(e,t,o),void(this._searchMarker={x:e,y:t,name:o})):!1},removeSearchMarker:function(){this._map instanceof a&&(this._map.removeSearchMarker(),this._searchMarker=null)},initTrafficLayer:function(){return this._map instanceof a?this._map.initPathLayer():!1},removeMapClickLayer:function(){return this._map instanceof a?this._map.removePoiClickLayer():!1},create:function(e,t){var o=this;o._currentPanoType=e||"inter";var n="street"==e,i=this._opts.indoorModel;if(this._floorComponent){var s=this._floorComponent.getData();i&&i.equal(s)||(this._floorComponent.destroy(),this._floorComponent=null)}if(this._catalogComponent){var s=this._catalogComponent.getData();i&&i.equal(s)||(this._catalogComponent.destroy(),this._catalogComponent=null)}var p=null,d=!1,l=baidu.g("panoOverMapWapper");if(n)p=new a(l,t),this._mapType=h.overview;else{var m=i.has2DMap(),c=i.hasPlanMap();if(c)this._mapType=h.plan,t.data=i.getCurrentFloorData(),p=new r(l,t);else if(m){this._mapType=h.overview;var u=(t.data.panoHeading,i.get2DMapData());u.currentPoint=t.data.currentPoint,u.panoHeading=t.data.currentPoint.heading,t.data=u,p=new a(l,t,i)}else d=!0;i&&this._createPolymerizationComponent(i,d)}if(p){if(this.dispatchEvent("layout_changed",{display:!0}),this._map=p,this.bindCommonEvent(),this._map.initialize(),n){this._mapCache.points&&this._map.drawLine(this._mapCache.points,this._mapCache.drawLineOptions),this._mapCache.markers&&this._map.addMarkers(this._mapCache.markers);var v=o._searchMarker;v.name&&o.addSearchMarker(v.x,v.y,v.name)}}else this.dispatchEvent("layout_changed",{display:!1}),setTimeout(function(){o.ready()},0)},destroyMap:function(){this._map&&(this.clearMapListener(),this._map.destroyAll(),this._map=void 0,this._mapType=h.none)},createPositionFlash:function(e){var t="../swf/pano_whole/MarkerAnimation_299ef9e.swf"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/swf/pano_whole/MarkerAnimation_299ef9e.swf*/;p.create({id:"markerAnimation-0",width:"300",height:"300",allowscriptaccess:"always",wmode:"transparent",quality:"high",url:t,menu:"false",ver:"10",errorMessage:"您未安装Flash Player播放器或者版本过低"},e);var o=this;o.flashSize={width:300,height:m},setTimeout(function(){o.posFlash=p.getSwf("markerAnimation-0")},500)},_reset:function(){var e=this;e.locked=!1,e._isExpand=!1,e._opts.parent.style.visibility="hidden",e._opts.parent.style.height=m+"px";var t=baidu.g("panoOvFramePin"),o=baidu.g("panoOvFramePinBg"),a=baidu.g("panoOvMarkerPosition");t.style.display="none",o.style.display="none",baidu.dom.removeClass(t,"panoOvFramePin_lock"),baidu.dom.removeClass(t,"panoOvFramePin_locked"),t.setAttribute("title","锁定"),a.style.zIndex=0},bindCommonEvent:function(){var e=this,t=this._map;this.clearMapListener(),t.addEventListener("pov_changed",function(t){e.dispatchEvent("pov_changed",{data:t.data})}),t.addEventListener("pano_changed",function(t){e.dispatchEvent("pano_changed",{data:t.data})}),t.addEventListener("photo_tour_enter",function(t){e.dispatchEvent("photo_tour_enter",{data:{tourId:t.data}})}),t.addEventListener("layout_changed",function(t){e.dispatchEvent("layout_changed",{display:t.data.display})}),t.addEventListener("level_changed",function(t){e._opts.level=t.data.level}),t.addEventListener("tiles_loaded",function(){e._opts.parent.style.visibility="visible",e.ready()}),t.addEventListener("mouseenter",function(){e.dispatchEvent("map_mouseenter")}),t.addEventListener("mouseleave",function(){e.dispatchEvent("map_mouseleave")})},clearMapListener:function(){if(this._map){var e=this._map;e.removeEventListener("pov_changed"),e.removeEventListener("pano_changed"),e.removeEventListener("layout_changed"),e.removeEventListener("level_changed"),e.removeEventListener("tiles_loaded")}},fold:function(){if(this._map&&this._isExpand===!0){var e=this,t=e._opts.parent,o=baidu.g("panoOvFramePin"),a=baidu.g("panoOvFramePinBg");o.style.display="none",a.style.display="none",this.animationStart=!0;var n=300-m;this._isExpand=!1,this.flashSize={width:300,height:m},this.animation.build({fps:60,transition:l.Transitions.linear,duration:200,render:function(e){try{t.style.height=300-n*e+"px"}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",ln:483})}},finish:function(){e.animationStart=!1,e._map.setCenter()}}),this.setPolymerizationComponentPosition(void 0,!1)}},expand:function(){if(this._map&&this._isExpand===!1){var e=this,t=300-m;this.animationStart=!0;var o=e._opts.parent,a=baidu.g("panoOvFramePin"),n=baidu.g("panoOvFramePinBg");a.style.display="block",n.style.display="block",this.flashSize={width:300,height:300},this.animation.build({fps:60,transition:l.Transitions.linear,duration:200,render:function(e){try{o.style.height=m+t*e+"px"}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",ln:517})}},finish:function(){e.animationStart=!1,e._map.setCenter(),e._isExpand=!0}}),this.setPolymerizationComponentPosition(void 0,!0)}},bindOutFrameEvent:function(){function e(){o.setPolymerizationComponentPosition(void 0,!0),o.animationStart=!0,o.animation.build({fps:60,transition:l.Transitions.linear,duration:200,render:function(e){try{a.style.height=m+p*e+"px"}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",ln:552})}},finish:function(){o.animationStart=!1,o._map.setCenter(),o._isExpand=!0,"leave"==o.mousePosition&&(o.shrinkTimeout=setTimeout(function(){t()},200))}})}function t(){o.setPolymerizationComponentPosition(void 0,!1),o.animationStart=!0,o.animation.build({fps:60,transition:l.Transitions.linear,duration:200,render:function(e){try{a.style.height=300-p*e+"px"}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",ln:576})}},finish:function(){o.animationStart=!1,o._map.setCenter(),o._isExpand=!1,"enter"==o.mousePosition&&(o._isExpandTimeout=setTimeout(function(){e()},200))}})}var o=this,a=o._opts.parent,n=(baidu.g("panoIndoorMap"),baidu.g("panoOvFramePin")),i=baidu.g("panoOvFramePinBg"),r=baidu.g("overviewBackBtn"),s=(baidu.g("panoOverMapWapper"),baidu.g("panoMapOuterWapper")),p=300-m;baidu.on(s,"mouseenter",function(){window._pano_overviewmap_leaved=!1,o._leaveHandler&&clearTimeout(o._leaveHandler),o.mousePosition="enter",o.locked||(n.style.display="block",i.style.display="block",baidu.dom.addClass(n,"panoOvFramePin_lock")),clearTimeout(o.shrinkTimeout),o._isExpand||o.animationStart||(o._isExpandTimeout=setTimeout(function(){e()},300))}),baidu.on(s,"mouseleave",function(e){function a(){for(var a=e.relatedTarget;a;){if("floor-container"==a.className)return;if(a==document.body)break;a=a.parentNode}if(o.mousePosition="leave",!o.locked){n.style.display="none",i.style.display="none",baidu.dom.removeClass(n,"panoOvFramePin_lock");var r=baidu.g("panoOvMarkerPosition");r.style.height=m+"px",o.flashSize={width:300,height:m}}clearTimeout(o._isExpandTimeout),o.locked||o._isExpand&&!o.animationStart&&(o.shrinkTimeout=setTimeout(function(){t()},300))}window._pano_overviewmap_leaved=!0,o._map&&!o._map._isDrag&&("map"==window._mouseleave_trigger_source?(window._mouseleave_trigger_source=null,o._leaveHandler=setTimeout(function(){a()},2e3)):a())}),baidu.on(n,"click",function(){o.locked?o.unlock():o.lock()}),baidu.on(r,"click",function(){o.dispatchEvent("close_pano"),addStat(STAT_CODE.STAT_PANORAMA,{catalog:"overview-return-click"})})},lock:function(){if(!this.locked){var e=baidu.g("panoOvFramePin");this.locked=!0,baidu.dom.addClass(e,"panoOvFramePin_locked"),e.setAttribute("title","解锁");var t=baidu.g("panoOvMarkerPosition");t.style.height="300px",this.flashSize={width:300,height:300},addStat(STAT_CODE.STAT_PANORAMA,{catalog:"eagle-eye-stick"})}},unlock:function(){if(this.locked){this.locked=!1;var e=baidu.g("panoOvFramePin");baidu.dom.removeClass(e,"panoOvFramePin_locked"),e.setAttribute("title","锁定"),addStat(STAT_CODE.STAT_PANORAMA,{catalog:"eagle-eye-stick"})}},isLocked:function(){return this.locked},isExpand:function(){return this._isExpand},event_panoChanged:function(e){var t=this,o=t._map,a=t._opts,n=e.data.panoType||"inter";if(t._currentPanoType!=n)this.destroyMap(),t._reset(),a.data=e.data,t.create(n,a);else{if(!o)return;o.event_panoChanged&&o.event_panoChanged(e.data)}},setPolymerizationComponentPosition:function(e,t){void 0!==e&&(this._isToolBarVisibility=e),void 0!==t&&(this._isOverviewExpand=t);var o=this._floorComponent||this._catalogComponent;o&&(this._mapType===h.none||(this._isToolBarVisibility?this._isOverviewExpand?o.setPosition(-2,-20,!0):o.setPosition(-2,-39,!0):o.setPosition(-2,-20,!0)))},_createPolymerizationComponent:function(e,t){var o=e.getCatalogList();o.length>0?this._createCatalogComponent(e,t):this._createFloorComponent(e,t),this.setPolymerizationComponentPosition(void 0,!1)},_createCatalogComponent:function(e,t){if(!this._catalogComponent){var o;if(t){if(o=document.getElementById("pano-floor-wrapper"),!o){var a=this.floorWrapper=document.createElement("div");a.id="pano-floor-wrapper",T.g("pano-funcarea").appendChild(a),d.setOpacity(a,0),o=a}o.style.visibility="visible"}else o=document.getElementById("pano-overview-wrapper");var n=this._catalogComponent=new i(o,e),r=this;n.addEventListener("item_click",function(t,o){var a=e.getCatalogList(),n=a[o.index],i=n.points[0].pid;r.dispatchEvent("pano_changed",{data:{panoId:i,panoType:"inter"}}),addStat(STAT_CODE.STAT_PANORAMA,{item:Pano.PANO_TYPE_INDOOR,catalog:"catalog-switch"})}),n.addEventListener("fold_overview",function(){r.isLocked()||r.fold()});var s=e.getCurrentPointData(),p=s.pid;this.updateCatalog(p)}},_createFloorComponent:function(e,t){var o=e.getFloorInfo();if(!this._floorComponent&&o.length>1){var a;if(t){if(a=document.getElementById("pano-floor-wrapper"),!a){var i=this.floorWrapper=document.createElement("div");i.id="pano-floor-wrapper",T.g("pano-funcarea").appendChild(i),d.setOpacity(i,0),a=i}a.style.visibility="visible"}else a=document.getElementById("pano-overview-wrapper");var r=this._floorComponent=new n(a,e),s=this;r.addEventListener("item_click",function(e,t){var a=o[t.index],n=a.startid;s.dispatchEvent("pano_changed",{data:{panoId:n,panoType:"inter"}}),addStat(STAT_CODE.STAT_PANORAMA,{item:Pano.PANO_TYPE_INDOOR,catalog:"floor-switch"})}),r.addEventListener("fold_overview",function(){s.isLocked()||s.fold()}),r.setFloorIndex(e.getCurrentFloor())}},event_indoorEnter:function(e){var t=this,o=this._opts,a=this._opts.indoorModel=e.indoorModel,n=a.has2DMap();t._mapType===h.overview&&n?(t._map.event_panoChanged(e.data,a),t._map.setZoom(16),a&&this._createPolymerizationComponent(a)):(o.data=e.data,t.destroyMap(),t._reset(),t._opts.data=a.getCurrentFloorData(),t.create("inter",o))},event_floorChanged:function(e){var t=this._opts;if(t.indoorModel&&this._floorComponent&&this._floorComponent.setFloorIndex(e.data.floor-1),this._mapType===h.overview&&t.indoorModel){this._map.updateTopologyMarkers();var o=t.indoorModel.getCurrentPointData();return void this._map.event_panoChanged(o)}this.destroyMap(),t.data=e.data,this.create("inter",t)},event_showPosition:function(e,t){var o=this;if(this._mapType===h.overview){var a=this._map;o.posFlash&&o.posFlash.setSize&&o.posFlash.setSize(o.flashSize.width,o.flashSize.height);var n={x:e,y:t},i=a.getBounds();if(c(n,i)){var r=u(n,i,o.flashSize.width,o.flashSize.height);o.posFlash.showShiningCircle&&o.posFlash.showShiningCircle(r.x,r.y)}else{var s=v(n,i);o.posFlash.showShiningArrow&&o.posFlash.showShiningArrow(s)}var p=baidu.g("panoOvMarkerPosition");p.style.zIndex=o._opts.zIndex+9}},event_hidePosition:function(){var e=this;if(this._mapType===h.overview){e.posFlash&&e.posFlash.hide();var t=baidu.g("panoOvMarkerPosition");t.style.zIndex=0}},_adaptData:function(e){function t(e){for(var t=[],o=0,a=e.length;a>o;o++){var n=e[o],i={defaultAngle:0,id:n.PID,name:n.name,x:n.X/100,y:n.Y/100};t.push(i)}return t}var o=this._opts.data,a=e.floorsData,n={defZoom:o.defZoom,floor:e.floor,hasImage:o.hasImage,height:1024,width:1024,innerId:o.innerId,pid:o.pid,points:t(a.Points),poiuid:o.poiuid,uid:e.panoId,x:a.LTpoint.X/100,y:a.LTpoint.Y/100,zoomLevel:o.zoomLevel};return n},event_indoorIdChanged:function(e){if(this._map){var t=this._map;this._mapType===h.overview?t.event_panoChanged(e.data):t.event_indoorIdChanged(e)}},updateCatalog:function(e){var t=this._opts.indoorModel;if(t&&this._catalogComponent){var o=t.getCatalogList(),a=null;d.each(o,function(t,o){return null!==a?!0:void d.each(t.points,function(t){return e===t.pid?(a=o,!0):void 0})}),this._catalogComponent.setSelectIndex(a)}},event_exitIndoor:function(e){if(this._floorComponent&&this._floorComponent.destroy(),this._catalogComponent&&this._catalogComponent.destroy(),this._floorComponent=null,this._catalogComponent=null,this._map){var t=this._map;t.event_exitIndoor&&t.event_exitIndoor(e)}},event_povChanged:function(e){if(this._map){var t=this._map;t.event_povChanged&&t.event_povChanged(e.data.panoHeading,e.data.panoPitch)}},event_disable:function(){this._state="disable";var e=this._opts,t=T.dom.create("div",{id:"panoOvFrameMask","class":"panoOvFrameMask",style:"z-index: "+e.zIndex+20});T.g("panoMapOuterWapper").appendChild(t),this._map.hideScaleControl&&this._map.hideScaleControl()},event_enable:function(){this._state="enable";var e=T.g("panoOvFrameMask");e&&T.g("panoMapOuterWapper").removeChild(e),this._map.showScaleControl&&this._map.showScaleControl()},getLevel:function(){return this._map&&this._map.getLevel?this._map.getLevel():16},getInnerId:function(){var e=this._opts;return e.indoorModel&&e.indoorModel.hasIndoorData()?e.indoorModel.getIID():this._map&&this._map.getInnerId?this._map.getInnerId():"inter"==this._currentPanoType?this._opts.data.innerId:void 0},getPoint:function(){return this._map?this._map.getCenter?this._map.getCenter():null:void 0},getCurrentPointInfo:function(){return this._map?this._map.getCenterPointInfo?this._map.getCenterPointInfo():null:void 0},getCurrentCity:function(e){if(!this._map){var t=this._opts.data;return void d.getCurrentCityByArea(t.x-1,t.y-1,t.x+1,t.y+1,function(t){var o=t.current_city;e({cityId:o.code,cityName:o.name})})}return this._map.getCurrentCity?this._map.getCurrentCity(e):null},_move:function(e,t){var o=document.getElementById("pano-overview-wrapper"),a=t-e,n=new l.Animation,i={duration:400,fps:40,delay:l.Animation.INFINITE,transition:l.Transitions.easeOutQuad,finish:function(){},render:function(t){try{o.style.bottom=e+a*t+"px"}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js",ln:1201})}}};n.build(i),n.start()},show:function(){var e=document.getElementById("pano-overview-wrapper"),t=parseInt(e.style.bottom),o=20;this._move(t,o)},hide:function(){var e=document.getElementById("pano-overview-wrapper"),t=20,o=-e.clientHeight-10;this._move(t,o)},dispose:function(){var e=this._opts.parent;e&&(e.innerHTML="",e.style.display="none"),this.clearMapListener()},getSupportEvents:function(){return["pov_changed","pano_changed","layout_changed","level_changed","close_pano","photo_tour_enter"]}});o.exports=_});
;define("common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),Animation=require("common:widget/ui/Animation/Animation.js"),config=require("common:widget/ui/config/config.js");require.loadCss({content:".pano_timeline_wrapper{position:relative;width:147px;height:108px;margin-left:4px;border:1px solid #3D4145;font-size:0}.pano_timeline_wrapper img{cursor:pointer;border:0}.pano_timeline_wrapper .photo-desc{position:absolute;bottom:0;left:0;width:147px;height:24px;padding-top:25px;text-align:center;font-size:12px;color:#abb0b2;z-index:3;cursor:pointer;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/album-title-bg_eeddd16.png) left bottom repeat-x;_background:#000;_padding:0;_height:25px;_line-height:25px;_filter:alpha(opacity=75)}"});var TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_timeline_wrapper">    <img width="147" height="108" src="',"undefined"==typeof timelineData.pano3DImage?"":timelineData.pano3DImage,'">    <div class="photo-desc">        <span title="',"undefined"==typeof timelineData.timePointName?"":timelineData.timePointName,'">',"undefined"==typeof timelineData.timePointName?"":timelineData.timePointName,"</span>    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],panoTimelineModuleContainer=null,panoData=null,TIMEPOINT_NAME={day:"日景",night:"夜景"},convertTimelineData=function(e){for(var n=[],i=0,a=e.length;a>i;i++){var o={},t=e[i].data;o.pano3DImage=util.getImage3DUrl(config.urlConfig.PANO_3DIMAGE_URL,t.panoId,t.panoHeading,t.panoPitch,147,109),o.panoData={panoId:e[i].data.panoId,panoHeading:e[i].data.panoHeading,panoPitch:e[i].data.panoPitch},o.timePointName=TIMEPOINT_NAME[e[i].name],n.push(o)}return n},PanoTimelineModule=ModuleClass.extend("PanoTimelineModule",{initialize:function(e){try{panoTimelineModuleContainer=e;var n=this;T(panoTimelineModuleContainer).on("click",function(){panoData&&(panoData.keepPov=!0,n.dispatchEvent("pano_changed",{data:panoData}),addStat(STAT_CODE.STAT_PANORAMA,{item:"panotimeline-click"}))})}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js",ln:64})}},getSupportEvents:function(){return["pano_changed"]},dispose:function(){panoTimelineModuleContainer.innerHTML=""},update:function(e){var n=T.isArray(e)&&e.length>0,i=void 0,a="";n&&""==panoTimelineModuleContainer.innerHTML?i=!0:n||""==panoTimelineModuleContainer.innerHTML||(i=!1),n&&(e=convertTimelineData(e),panoData=e[0].panoData,a=TEMPLATE({timelineData:e[0]}));var o=new Animation.Animation;if(void 0!==i)i===!0?(panoTimelineModuleContainer.innerHTML=a,o.build({fps:60,duration:300,render:function(e){try{util.setOpacity(panoTimelineModuleContainer,e)}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js",ln:112})}},finish:function(){}})):o.build({fps:60,duration:300,render:function(e){try{e=1-e,util.setOpacity(panoTimelineModuleContainer,e)}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js",ln:127})}},finish:function(){panoTimelineModuleContainer.innerHTML=""}});else if(n){var t=panoTimelineModuleContainer.cloneNode(!0);t.style.position="absolute",t.style.top="0",panoTimelineModuleContainer.parentNode.appendChild(t),o.build({fps:60,duration:300,render:function(e){try{e=1-e,util.setOpacity(t,e)}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js",ln:148})}},finish:function(){t.parentNode.removeChild(t)}}),panoTimelineModuleContainer.innerHTML=a}}});module.exports=PanoTimelineModule});
;define("common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),Animation=require("common:widget/ui/Animation/Animation.js"),config=require("common:widget/ui/config/config.js");require.loadCss({content:'.pano_timethrough_wrapper{position:relative;width:198px;height:108px;margin:0 1px 0 3px;border:1px transparent solid;font-size:12px;font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif}.pano_timethrough_wrapper img{cursor:pointer;border:0;position:absolute;top:0;left:0;z-index:2;background-color:#000}.pano_timethrough_wrapper .photo-mask{z-index:3;position:absolute;bottom:0;left:0;width:100%;height:100%;text-align:center;font-size:12px;color:#fff;z-index:3;cursor:pointer;background-color:#000;filter:alpha(opacity=65);background-color:rgba(0,0,0,.65);text-decoration:none}.pano_timethrough_wrapper .photo-mask .icon{display:block;background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/timelineicon-8-black_db6cdc5.png);width:32px;margin:0 auto;height:100%;background-repeat:no-repeat;background-position:0 center}.pano_timethrough_wrapper .photo-mask:hover .icon{background-position:-32px center;color:#3af}.pano_timethrough_wrapper .photo-mask .time-text{position:absolute;width:100%;text-align:center;top:72px;left:0}.pano_timethrough_wrapper .photo-mask:hover .time-text{color:#34a4f4}.pano_timethrough_wrapper .timethrough-list-container{width:100%;position:absolute;top:0;background-color:#252525;opacity:.9;_background-color:gray;*background-color:gray;text-align:center;z-index:1;overflow:hidden}.pano_timethrough_wrapper .timethrough-list-container .line{border-bottom:1px solid #393c40;margin:0 auto;width:95%;font-size:0;height:0}.pano_timethrough_wrapper .timethrough-list-container .item{height:50px;line-height:50px;color:#b5b9c5;display:block;text-decoration:none;cursor:pointer}.pano_timethrough_wrapper .timethrough-list-container .selected{color:#34a4f4}.pano_timethrough_wrapper .timethrough-list-container .item:hover{background-color:gray}'});var TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_timethrough_wrapper">    '),_template_fun_array.push(isLatest?'        <a class="photo-mask">    ':'        <a class="photo-mask">    '),_template_fun_array.push('        <div class="icon"></div>        <div class="time-text">',"undefined"==typeof label?"":label,'</div>    </a>    <img id="timeThroughThumb" style="background-color:#2b2e31;" width="198" height="108" src="',"undefined"==typeof currectImage?"":currectImage,'" onerror="this.src=&#39;',"undefined"==typeof error_src?"":error_src,'&#39;;">    <div class="timethrough-list-container">        ',"undefined"==typeof throughListHtml?"":throughListHtml,"    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],IMG_ERROR_URL="../images/blank.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/blank.gif*/,panoTimelineModuleContainer=null,panoData=null,TIME_THROUGH_DATA_EXAMPLE=[{ID:"01011700001306272100190835F",IsCurrent:1,Time:"day",TimeDir:"",TimeLine:"201402",Year:"2014"},{ID:"01011700001306100916155955B",IsCurrent:0,Time:"day",TimeDir:"obsolete",TimeLine:"201306",Year:"2013"}],convertTimelineData=function(){},PanoTimelineModule=ModuleClass.extend("PanoTimelineModule",{initialize:function(t){try{this.container=t;var e=this;this.listStatus=-2,this.isMouseInRange=0;var i=0;T(t).on("click",function(t){var i=t.target?t.target.getAttribute("data-pid"):null;i&&(e.dispatchEvent("pano_changed",{data:{panoId:i,keepPov:!0}}),addStat(STAT_CODE.STAT_PANORAMA,{item:"panotimethrough-click"}),e.hide(!0),e.isMouseInRange=0)}).on("mouseenter",function(){e.isMouseInRange=1,clearTimeout(i),i=setTimeout(function(){e._fireAction()},200)}).on("mouseleave",function(){e.isMouseInRange=0,clearTimeout(i),i=setTimeout(function(){e._fireAction()},300)})}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",ln:78})}},_fireAction:function(){this.isMouseInRange?this.show():this.hide()},show:function(){if(-2===this.listStatus){var t=this;this.listStatus=1;var e=T(".timethrough-list-container",this.container),i=e.outerHeight(),o=new Animation.Animation,n={duration:400,fps:40,delay:Animation.Animation.INFINITE,transition:Animation.Transitions.easeOutQuad,render:function(t){try{e.css("top",-t*i+"px")}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",ln:102})}},finish:function(){t.listStatus=2,t._fireAction()}};o.build(n),o.start()}},hide:function(t){if(2===this.listStatus){var e=this;this.listStatus=-1;var i=T(".timethrough-list-container",this.container),o=i.outerHeight();if(t===!0)return i.css("top","0px"),void(this.listStatus=-2);var n=new Animation.Animation,a={duration:400,fps:40,delay:Animation.Animation.INFINITE,transition:Animation.Transitions.easeOutQuad,render:function(t){try{i.css("top",(t-1)*o+"px")}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",ln:133})}},finish:function(){e.listStatus=-2,e._fireAction()}};n.build(a),n.start()}},empty:function(){this.container.innerHTML="",this.container.style.display="none"},update:function(t){var e=0;this.container.style.display="block",t.sort(function(t,e){var i,o,n;return i=t.TimeLine,o=i.substr(0,4),n=i.substr(4,2),a_time=new Date(o,n),i=e.TimeLine,o=i.substr(0,4),n=i.substr(4,2),b_time=new Date(o,n),a_time>b_time?1:-1});var i="",o=0,n=util.each(t,function(t){var n="item",a=t.TimeLine,r=a.substr(0,4),s=a.substr(4,2),u=r+"年"+(parseInt(s)?s+"月":"");return 1===t.IsCurrent&&(e=t.ID,i=u,o=t.dir,n="item selected"),'<a data-pid="'+t.ID+'" class="'+n+'">'+u+"</a>"},!0),a=util.getImage3DUrl(config.urlConfig.PANO_3DIMAGE_URL,e,o,0,198,108),r=1===t[t.length-1].IsCurrent,s={currectImage:a,label:r?"时光机":i,throughListHtml:n.join('<div class="line"></div>'),isLatest:r,error_src:IMG_ERROR_URL},u=document.getElementById("timeThroughThumb");if(u){var c=u.src;s.currentImage=c;var m=new Image;m.onload=function(){var t=document.getElementById("timeThroughThumb");t.src=this.src},m.src=a}var l=TEMPLATE(s);this.container.innerHTML=l,this.isMouseInRange&&this.show()},getSupportEvents:function(){return["pano_changed"]},dispose:function(){panoTimelineModuleContainer.innerHTML=""}});module.exports=PanoTimelineModule});
;define("common:widget/pano/module/PanoGuideModule/AlbumModule/AlbumModule.js",function(e,t,a){var n=e("common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js"),i=e("common:widget/pano/base/ModuleClass.js"),o=(e("common:widget/pano/base/service.js"),e("common:widget/pano/base/util.js")),d=198,s=108,c=i.extend("AlbumModule",{initialize:function(e,t,a){try{this.options={albumImageDomain:t},this._maxWidth=document.body.clientWidth,this.container=e;var i=this.album=new n(e,d,s,{zIndex:a.zIndex||1}),o=this;this_AlbumEventHandlers={},i.addEventListener("click",function(e,t){var a=t.index,n=o.data[a];if(9==n.type&&addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-ugc-entrance-click"}),n&&n.data){switch(n=n.data,i.setSelectIndex(a),n.type){case 2:n.source="PanoStreet",o.dispatchEvent("animate_pano_changed",{data:n});break;case 21:n.source="InterPoi",o.dispatchEvent("inter_poi_changed",{data:n});break;case 7:o.dispatchEvent("photo_tour_enter",{data:n});break;case 8:o.dispatchEvent("pano_topic_enter",{data:n});break;case 4:n.source="PanoStreet",o.dispatchEvent("animate_pano_changed",{data:n});break;case 3:o.dispatchEvent("pano_changed",{data:n});break;case 1:case 5:case 6:o.dispatchEvent("pano_changed",{data:n});break;case 10:case 9:o.dispatchEvent("video_enter",{data:n})}o.dispatchEvent("hide_position"),addStat(STAT_CODE.STAT_PANORAMA,{item:"guide_album_click",type:n.type})}}),i.addEventListener("mouseenter",function(e,t){var a=t.index;i.fitImage(a);var n=o.data[a];n&&n.data&&(n=n.data,o.dispatchEvent("show_position",{data:{x:n.x,y:n.y}}))}),i.addEventListener("mouseleave",function(){o.dispatchEvent("hide_position")}),i.addEventListener("show_position",function(e){o.dispatchEvent("show_position",{data:e.data})}),i.addEventListener("hide_position",function(){o.dispatchEvent("hide_position")}),i.addEventListener("floor_changed",function(e){o.dispatchEvent("layout_changed",{data:e.data})})}catch(c){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:c.message||c.description,path:"common:widget/pano/module/PanoGuideModule/AlbumModule/AlbumModule.js",ln:145})}},update:function(e){var t=this.options.albumImageDomain;this.data=e;var a=o.each(e,function(e){var a={};if(e.photoUrl)a.src=e.photoUrl;else{var n=e.data;if(!n)return;var i=n.panoPitch+(1==n.type?0:6);a.src=o.getImage3DUrl(t,n.panoId,n.panoHeading,i,d,s)}return a.name=e.name,a.icon="i-poi-"+e.type,a},!0);this.album.resize(),this.album.update(a)},setSelectPano:function(e){var t=e,a=void 0;return o.some(this.data,function(e,n){return e.data.panoId+"_"+e.data.uid==t?(a=n,!0):!1}),void 0!==a?(this.setSelectIndex(a),!0):!1},unselect:function(){this.album.unselect()},setSelectIndex:function(e){this.album.setSelectIndex(e)},scrollTo:function(e){this.album.scrollTo(e)},getSelectIndex:function(){return this.album.getSelectIndex()},getSelectItem:function(){var e=this.album.getSelectIndex();if(void 0===e||!this.data[e])return null;var t=this.data[e].data,a=this.album.getCurrentLiPosition(e);return a.x=a.x+this.container.offsetLeft,{name:this.data[e].name,data:t,pos:{x:a.x,y:a.y}}},ignoreMouseEvent:function(e){this.album.ignoreMouseEvent(e)},event_layoutChanged:function(e){this.album&&this.album.resize(e)},dispose:function(){this.album&&this.album.dispose()}});a.exports=c});
;define("common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),Animation=require("common:widget/ui/Animation/Animation.js"),config=require("common:widget/ui/config/config.js");require.loadCss({content:".guide_topic_wrapper{position:relative;width:147px;height:108px;margin-left:4px;border:1px solid #3D4145;font-size:0}.guide_topic_wrapper img{cursor:pointer;border:0}.guide_topic_wrapper .photo-desc{position:absolute;bottom:0;left:0;width:147px;height:24px;padding-top:25px;text-align:center;font-size:12px;color:#abb0b2;z-index:3;cursor:pointer;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/album-title-bg_eeddd16.png) left bottom repeat-x;_background:#000;_padding:0;_height:25px;_line-height:25px;_filter:alpha(opacity=75)}"});var TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="guide_topic_wrapper"><a href="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof topicData.link?"":topicData.link,'" target="_blank" title="',"undefined"==typeof topicData.topicName?"":topicData.topicName,'专题">    <img width="147" height="108" title="',"undefined"==typeof topicData.topicName?"":topicData.topicName,'专题" alt="',"undefined"==typeof topicData.topicName?"":topicData.topicName,'专题" src="',"undefined"==typeof topicData.pano3DImage?"":topicData.pano3DImage,'">    <div class="photo-desc">        <span title="',"undefined"==typeof topicData.topicName?"":topicData.topicName,'">',"undefined"==typeof topicData.topicName?"":topicData.topicName,"</span>    </div></a></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],panoTopicModuleContainer=null,panoData=null,TIMEPOINT_NAME={day:"日景",night:"夜景"},convertTopicData=function(o){for(var e=[],a=0,i=o.length;i>a;a++){var t={},n=o[a].data;t.pano3DImage=util.getImage3DUrl(config.urlConfig.PANO_3DIMAGE_URL,n.panoId,n.panoHeading,n.panoPitch,147,109),t.panoData={panoId:o[a].data.panoId,panoHeading:o[a].data.panoHeading,panoPitch:o[a].data.panoPitch},t.topicName=o[a].name,e.push(t)}return e},PanoTopicModule=ModuleClass.extend("PanoTopicModule",{initialize:function(o){try{panoTopicModuleContainer=o;var e=this;T(panoTopicModuleContainer).on("click",function(){panoData&&(e.dispatchEvent("show_topic",{data:panoData}),addStat(STAT_CODE.STAT_PANORAMA,{item:"panoTopic-click"}))})}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js",ln:63})}},getSupportEvents:function(){return["show_topic"]},dispose:function(){panoTopicModuleContainer.innerHTML=""},empty:function(){panoTopicModuleContainer.innerHTML=""},update:function(o){var e=T.isArray(o)&&o.length>0,a=void 0,i="";e&&""==panoTopicModuleContainer.innerHTML?a=!0:e||""==panoTopicModuleContainer.innerHTML||(a=!1),e&&(o=convertTopicData(o),o=o[0],o.link=config.urlConfig.PANO_HOME_URL+"/panotopic?topicPid="+o.panoData.panoId,i=TEMPLATE({topicData:o}));var t=new Animation.Animation;if(void 0!==a)a===!0?(panoTopicModuleContainer.innerHTML=i,t.build({fps:60,duration:300,render:function(o){try{util.setOpacity(panoTopicModuleContainer,o)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js",ln:115})}},finish:function(){}})):t.build({fps:60,duration:300,render:function(o){try{o=1-o,util.setOpacity(panoTopicModuleContainer,o)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js",ln:130})}},finish:function(){panoTopicModuleContainer.innerHTML=""}});else if(e){var n=panoTopicModuleContainer.cloneNode(!0);n.style.position="absolute",n.style.top="0",panoTopicModuleContainer.parentNode.appendChild(n),t.build({fps:60,duration:300,render:function(o){try{o=1-o,util.setOpacity(n,o)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js",ln:151})}},finish:function(){n.parentNode.removeChild(n)}}),panoTopicModuleContainer.innerHTML=i}}});module.exports=PanoTopicModule});
;define("common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",function(e,t,n){var a=e("common:widget/ui/Animation/Animation.js"),i=e("common:widget/pano/module/PanoGuideModule/AlbumModule/AlbumModule.js"),o=e("common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js"),d=e("common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js"),l=e("common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js"),s=e("common:widget/pano/base/ModuleClass.js"),u=e("common:widget/pano/base/service.js"),p=e("common:widget/pano/base/util.js"),c=300,r=null,h=null,m=null,g=s.extend("PanoGuideModule",{constructor:function(){this.container=null,this._data=null,this._display=!1,this._maxWidth=document.body.clientWidth,this._displayStatus={timeline:!1,album:!1,topic:!1}},initialize:function(e,t){try{var n=this,a=this.container=document.createElement("div");this.container.style.height="130px",e&&e.appendChild(a);var s=this.timeLineWapper=document.createElement("div");s.className="pano-func-item",s.style.zIndex="2",a.appendChild(s),h=new o,h.initialize(s),h.addEventListener("pano_changed",function(e){n.dispatchEvent("pano_changed",{data:e.data})});var c=this.topicWapper=document.createElement("div");c.className="pano-func-item",c.style.zIndex="2",a.appendChild(c),m=new l,m.initialize(c);var g=this.timeThroughWapper=document.createElement("div");g.className="pano-func-item",g.style.zIndex="2",g.style.width="200px",g.innerHTML="timeline",a.appendChild(g);var f=this.timethroughModule=new d;f.initialize(g),f.addEventListener("pano_changed",function(e){n.dispatchEvent("pano_changed",{data:e.data})});var y=this.albumWapper=document.createElement("div");y.className="pano-func-item",y.style.zIndex="1",a.appendChild(y),r=new i,r.initialize(y,t.albumImageDomain,{zIndex:t.zIndex});var _=function(e,t){n.dispatchEvent(e.type,t)};p.each(["animate_pano_changed","pano_changed","inter_poi_changed","floor_changed","show_position","hide_position","photo_tour_enter","video_enter"],function(e){r.addEventListener(e,_)});var v=t.data.panoId,M=t.data.panoType;v&&u.getGuideData(v,function(e){n.render(e,M,!0,v,null,t.timeThroughData)})}catch(x){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:x.message||x.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:124})}},getContainer:function(){return this.container},isAsync:function(){return!0},render:function(e,t,n,a,i,o){try{var d=T.isArray(e.content)&&e.content.length>0,l=T.isArray(e.panoTimelineData)&&e.panoTimelineData.length>0,s=d?e.content:null,u=l?e.panoTimelineData:null;if("street"===t){var c={photoUrl:"../images/pano_whole/upload_pano2_01a9410.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/upload_pano2_01a9410.png*/,name:"",type:9};s?s.push(c):s=[c]}if(n&&s)if("inter"===t)if(e.catalogData){var g=e.catalogData.exit.length>0?[e.catalogData.exit[0]]:[],f=null;for(var y in e.catalogData){if(null!==f)break;p.each(e.catalogData[y],function(e){return a===e.data.panoId?(f=y,!0):void 0})}g=g.concat(e.catalogData[f]),r.update(g)}else{var _=void 0!==i?i+1:void 0,g=p.each(s,function(e){try{if(2===e.type&&(e.data.type=21,e.type=21),3===e.type||1===e.type||5===e.type||6===e.type||21===e.type)return e.data.panoId===a&&(_=e.data.floor),e}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:214})}},!0);void 0!==_&&(g=p.each(g,function(e){try{if(3===e.type||21===e.type||6===e.type||e.data.floor===_||0==e.data.floor)return e}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:226})}},!0)),r.update(g)}else r.update(s);h.update(u);var v=o&&o.length>1;v?this.timethroughModule.update(o):this.timethroughModule.empty();var M=e.topicData&&e.topicData.length>0;M?m.update(e.topicData):m.empty(),this._displayStatus.timeline&&!u||!this._displayStatus.timeline&&!u,this._displayStatus.album=!!s,this._displayStatus.timeline=!!u,this._displayStatus.topic=!!M,this._displayStatus.timeThrough=v,this._display=!!(s||u||M),this.dispatchEvent("layout_changed",{display:this._display}),this.ready()}catch(x){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:x.message||x.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:273})}},resize:function(e){var t=this._maxWidth,n=this._displayStatus,i=this.albumWapper,o=this.timeLineWapper,d=this.topicWapper,l=this.timeThroughWapper,s=parseInt(i.style.left||0),u=document.body.clientWidth-t,p=u,h=0,m=0;n.timeline&&(m=o.clientWidth,o.style.left=u+"px",p+=m,h+=m),n.topic&&(m=d.clientWidth,d.style.left=u+h+"px",p+=m,h+=m),n.timeThrough&&(m=l.clientWidth,l.style.left=u+h+"px",p+=m,h+=m),r.event_layoutChanged(t-m);var g=p-s;if(!e&&Math.abs(g)>10){r.ignoreMouseEvent(!0);var f=new a.Animation;f.build({fps:60,transition:a.Transitions.easeOutQuad,duration:Math.abs(g)/c*1e3,render:function(e){try{i.style.left=s+e*g+"px"}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:349})}},finish:function(){i.style.left=p+"px",r.setSelectIndex(r.getSelectIndex()),r.ignoreMouseEvent(!1)}})}else i.style.left=p+"px",r.ignoreMouseEvent(!1)},getSelectAlbumItem:function(){return r?r.getSelectItem():null},update:function(e,t,n,a,i,o){if(this.container.parentNode){var d=this,l=i===this.getName(),s=!0;l&&"inter"!==n&&"street"===a&&(s=!1);var c="inter"===a;u.getGuideData(e,function(n){d.render(n,a,s,e,t,o),c?n&&n.content.length>0&&p.each(n.content,function(t){t.data.panoId==e&&r.setSelectPano(e+"_"+t.data.uid)}):l||(r.unselect(),r.scrollTo(0))})}},event_layoutChanged:function(e,t){e&&(this._maxWidth=e,this.resize(t))},dispose:function(){r.dispose(),r=null,h.dispose(),h=null,m.dispose(),m=null},getSupportEvents:function(){return["animate_pano_changed","pano_changed","inter_poi_changed","layout_changed","floor_changed","show_position","hide_position","photo_tour_enter","video_enter"]}});n.exports=g});
;define("common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",function(require,exports,module){var util=require("common:widget/pano/base/util.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),Animation=require("common:widget/ui/Animation/Animation.js"),LAYER_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="pano-container">    <div id="pano-photo-wrapper"></div>    <div id="pano-flash-wrapper"></div>    <div id="pano-expand-wrapper">        <div id="pano-ui-layer" class="pano-ui-layer"></div>        <ul id="pano-header">            <li id="pano-indoor—poi-wrapper"></li>            <li style="width: 50px;height: 50px;display: inline-block;"></li>        </ul>        <ul id="pano-sidebar">            <li id="pano-fold-btn" class="pano_fold_forbid">                                <span class="pano_button" title="折叠功能区"><span></span></span>            </li>                    </ul>        <div id="pano-overview-wrapper"></div>        <div id="pano-footer">            <ul id="pano-funcarea"  isinit=\'1\' class="clearfix pano_funcarea_hide">            </ul>            <div id="pano-tips">            </div>                        <div id="pano-fold-msk" class="transparent-msk"></div>        </div>    </div>    <div id="pano-msg"></div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];require.loadCss({content:"#pano-container{position:absolute;overflow:hidden;top:0;left:0;width:100%;height:100%;background-color:#eee;z-index:100001;min-width:960px;visibility:hidden}#pano-photo-wrapper{position:absolute;width:100%;height:100%;z-index:1;background-color:#000}#pano-flash-wrapper{position:absolute;overflow:hidden;top:0;right:0;width:100%;height:100%;background-color:#fff;z-index:100001}#pano-msg{width:100%;display:none;height:100%;position:absolute;top:0;left:0;z-index:200000;_background:url(/newmap/static/common/images/transparent.gif)}#pano-header{position:absolute;top:20px;left:103px;z-index:100010}#pano-header li{float:left;display:inline-block}#pano-sidebar{position:absolute;right:12px;width:40px;z-index:100010;line-height:0;bottom:20px}.pano_unfold_func{font-size:0}#pano-footer{position:absolute;width:100%;bottom:0;z-index:100005}#pano-footer .pano-func-item{position:absolute;padding-top:18px;height:110px}#pano-funcarea{padding-left:0;width:100%;height:130px;font-size:0;position:absolute}.transparent-msk{position:absolute;width:100%;z-index:-999;background-color:#252525;opacity:.9;filter:alpha(opacity=90)}#pano-footer .transparent-msk{left:0;height:150px}.pano_unfold_func{font-size:12px}.pano_funcarea_hide{}#pano-tips{display:inline-block;right:0;text-align:right;overflow:hidden;line-height:20px;font-size:12px;color:#797979;position:absolute;bottom:0;z-index:100009}#pano-tips span{font-size:12px}#pano-overview-wrapper{position:absolute;left:10px;bottom:23px;width:300px;height:106px;z-index:100010;visibility:hidden;border:2px solid #3D4145}#pano-overview-holder{width:300px;margin-right:10px}.pano-ui-layer{width:0;height:0;position:absolute;left:0;top:0;z-index:100011}#pano-floor-wrapper{position:absolute;left:0;top:-23px;width:304px;height:36px;visibility:hidden;overflow:visible}"});var layeroutResizeTimer=null,isUserHideAlbum=!1,PanoLayoutManager=ModuleClass.extend("PanoLayoutManager",{constructor:function(){},initialize:function(e,o){try{this._moduleHash=e,this._funcAreaModulesStateHash={},this._container=o,this._panoContainer=null,this.render(o),this._addLayoutEventListeners()}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:33})}},render:function(e){try{var o=LAYER_TEMPLATE();this._panoContainer=T(o)[0],T(e).append(this._panoContainer)}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:38})}},getModuleContainer:function(e){switch(e){case"PanoRoot":return T.g("pano-container");case"PanoModule":return T.g("pano-flash-wrapper");case"PhotoTour":return T.g("pano-photo-wrapper");case"PanoOverviewModule":return T.g("pano-overview-wrapper");case"PanoGuideModule":return T.g("pano-funcarea");case"PanoIndoorPoiModule":return T.g("pano-indoor—poi-wrapper");case"PanoToolModule":return T.g("pano-sidebar");case"PanoCopyrightModule":return T.g("pano-tips");case"PanoMessageBoxModule":return T.g("pano-msg");case"ui-layer":return T.g("pano-ui-layer");default:return null}},resetFuncAreaModule:function(e){if(!this.funcAreaModule||e.getName()!==this.funcAreaModule.getName()){for(var o=T.g("pano-funcarea");o.lastChild;)o.removeChild(o.lastChild);if(e&&e.getContainer){this.funcAreaModule=e;var a=e.getContainer();return void o.appendChild(a)}}},restoreFuncAreaDoms:function(e){var o=T.g("pano-funcarea");util.each(e,function(e){o.appendChild(e)})},_addLayoutEventListeners:function(){var e=this;T.on(T.g("pano-fold-btn"),"click",function(){if(addStat(STAT_CODE.STAT_PANORAMA,{item:"funcarea-fold-click"}),!T("#pano-fold-btn").hasClass("pano_fold_forbid")){var o=T("#pano-funcarea"),a=o.hasClass("pano_funcarea_hide");isUserHideAlbum=a?!1:!0,e._toggleFoldArea()}}),T.on(T.g("pano-footer"),"mousedown",function(e){e.preventDefault()}),e._windowResizeHandler=function(){if(!document.webkitIsFullScreen&&!document.msFullscreenElement){var e=T.g("pano-container"),o=document.body.offsetWidth,a=document.body.scrollHeight;e.style.width=960>o?"960px":o+"px",e.style.height=480>a?"480px":a+"px"}},T.on(window,"onresize",e._windowResizeHandler)},show:function(){this._toggleFoldArea(!0)},hide:function(){this._toggleFoldArea(!1)},_toggleFoldArea:function(e,o){var a=T("#pano-fold-btn .pano_button"),n=T("#pano-funcarea"),i=T("#pano-floor-wrapper"),t=T("#pano-sidebar"),r=T("#pano-cprt-msk"),s=T("#pano-fold-msk"),d=T("#pano-overview-wrapper"),l=n.hasClass("pano_funcarea_hide");if(e===!0&&!l||e===!1&&l)return void(i.length>0&&(util.setOpacity(i[0],1),i.css("visibility","visible")));var p=new Animation.Animation,u={duration:400,fps:40,delay:Animation.Animation.INFINITE,transition:Animation.Transitions.easeOutQuad,finish:function(){},render:function(){try{}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:180})}}},c=(T("#pano-footer"),parseInt(n.css("height"))),h=20,f=n.children();util.each(f,function(e){"pano-floor-wrapper"!=e.id&&util.setOpacity(e,0)});var m,g;e===!0||void 0===e&&l?(n.removeClass("pano_funcarea_hide"),t.addClass("pano_unfold_sidebar"),a.attr("title","折叠功能区"),m=c,s.css("visibility","visible"),u.render=function(e){try{t.css("bottom",h+e*m+"px"),n.css("bottom",h+(e-1)*m+"px"),s.css("bottom",h+(e-1)*m-20+"px"),r.css({opacity:1-e-.1,filter:"alpha(opacity=0)"}),o||d.css("bottom",10+13*e+"px"),util.each(f,function(o){util.setOpacity(o,e)})}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:227})}},i&&i.css("visibility","visible"),this._moduleHash.PanoOverviewModule&&this._moduleHash.PanoOverviewModule.setPolymerizationComponentPosition(!0)):(n.addClass("pano_funcarea_hide"),t.removeClass("pano_unfold_sidebar"),a.attr("title","展开功能区"),g=c+h,m=g-h,u.render=function(e){try{t.css("bottom",g-e*m+"px"),n.css("bottom",-e*c+"px"),s.css("bottom",-e*c+"px"),r.css({opacity:e-.1,filter:"alpha(opacity=90)"}),o||d.css("bottom",23-13*e+"px"),util.each(f,function(o){"pano-floor-wrapper"!==o.id&&util.setOpacity(o,1-e)})}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:263})}},u.finish=function(){s.css("visibility","hidden"),i&&i.css("visibility","hidden"),util.each(f,function(e){util.setOpacity(e,1)})},this._moduleHash.PanoOverviewModule&&this._moduleHash.PanoOverviewModule.setPolymerizationComponentPosition(!1)),p.build(u),p.start()},_updateLayout:function(e,o){var a=!o;a?(T("#pano-fold-btn").addClass("pano_fold_forbid"),T("#pano-sidebar").removeClass("pano_unfold_sidebar"),T("#pano-sidebar").css("bottom","20px"),isUserHideAlbum&&T("#pano-overview-wrapper").css("bottom","10px")):(T("#pano-fold-btn").removeClass("pano_fold_forbid"),o&&!isUserHideAlbum&&o&&this._toggleFoldArea(!0),isUserHideAlbum&&T("#pano-overview-wrapper").css("bottom","10px"),T("#pano-funcarea").hasClass("pano_funcarea_hide")||(T("#pano-sidebar").css("bottom","150px"),T("#pano-sidebar").addClass("pano_unfold_sidebar")))},event_layoutChanged:function(e,o){layeroutResizeTimer&&clearTimeout(layeroutResizeTimer);var a=this;this._funcAreaModulesStateHash[e+"_changed"]=this._funcAreaModulesStateHash[e]!=o,this._funcAreaModulesStateHash[e]=o,layeroutResizeTimer=setTimeout(function(){{var e=a._funcAreaModulesStateHash,o=T("#pano-funcarea"),n=a.funcAreaModule||a._moduleHash.PanoGuideModule,i=e.PanoOverviewModule,t=e.PanoGuideModule||e.TrafficModule,r=e.PanoGuideModule_changed||e.TrafficModule_changed;e.TrafficModule_changed}i&&t?(o.addClass("pano_has_overview"),n&&n.event_layoutChanged(document.body.clientWidth-315,e.PanoGuideModule_changed),!isUserHideAlbum&&r&&a._toggleFoldArea(!0,!0)):i&&!t?(o.removeClass("pano_has_overview"),a._toggleFoldArea(!1,!0)):!i&&t?(n&&n.event_layoutChanged(document.body.clientWidth,e.PanoGuideModule_changed),a._toggleFoldArea(!0)):i||t||(o.removeClass("pano_has_overview"),a._toggleFoldArea(!1)),a._updateLayout(i,t)},50)},event_layoutToggle:function(e,o){var a=this,n=o?"block":"none";if("TrafficModule"==e){var i=a.getModuleContainer(e);i&&(i.style.display=n),T.g("pano-ui-layer").style.display=n}else{var i=a.getModuleContainer(e);i&&(i.style.display=n)}},dispose:function(){layeroutResizeTimer&&clearTimeout(layeroutResizeTimer),this._container.removeChild(this._panoContainer),T.un(window,"onresize",this._windowResizeHandler)}});module.exports=PanoLayoutManager});
;define("common:widget/pano/module/PanoCopyrightModule/PanoCopyrightModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),service=require("common:widget/pano/base/service.js");require.loadCss({content:"#pano-copyright{margin-right:30px;font-weight:900}#pano-copyright span{margin-left:7px}#pano-copyright a{text-decoration:none;color:#797979}#pano-copyright a:hover{color:#3af}#pano-tips .transparent-msk{top:0;left:0;height:20px;opacity:0;filter:alpha(opacity=0)}"});var COPYRIGHT_TPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="pano-copyright">    <span>',"undefined"==typeof panoData.panoCopyright.roadName?"":panoData.panoCopyright.roadName,'</span>    <span>|</span>    <span><a target="_blank" id="pano-feedback" href="../../../../../map.baidu.com/pano/feedback/index.html-panoid=',.htm"/*tpa=http://map.baidu.com/pano/feedback/index.html?panoid=',*/undefined"==typeof panoData.panoId?"":panoData.panoId,"&pitch=","undefined"==typeof panoData.panoPitch?"":panoData.panoPitch,"&roll=","undefined"==typeof panoData.panoHeading?"":panoData.panoHeading,'" style="display:inline;">问题反馈</a></span>    <span>|</span>    '),panoData.panoCopyright.provider&&panoData.panoCopyright.provider.name&&(_template_fun_array.push("        <span>Data ©</span>        "http://webmap1.map.bdstatic.com/newmap/static/common/pkg/),panoData.panoCopyright.provider.url?_template_fun_array.push('        <span><a target="_blank" href="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoData.panoCopyright.provider.url?"":panoData.panoCopyright.provider.url,'" style="display:inline;">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoData.panoCopyright.provider.name?"":panoData.panoCopyright.provider.name,"</a></span>        "):_template_fun_array.push("        <span>","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoData.panoCopyright.provider.name?"":panoData.panoCopyright.provider.name,"</span>        "),_template_fun_array.push("    ")),_template_fun_array.push('    <span class="upload-pano"><a id="pano-upload-link" class="upload" target="_blank" href="http://pai.baidu.com/">上传全景图片</a></span>    <span>|</span>    <span>',"undefined"==typeof panoData.panoCopyright.admission?"":panoData.panoCopyright.admission,"</span>        <span>拍摄日期：","undefined"==typeof panoData.panoCopyright.photoDate?"":panoData.panoCopyright.photoDate,'</span></div><div id="pano-cprt-msk" class="transparent-msk"></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],PanoCopyrightModule=ModuleClass.extend("PanoCopyrightModule",{constructor:function(){},initialize:function(){try{var a=service.getCopyRightData();this._copyRightDataDefferd=a,this.roadName=""}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoCopyrightModule/PanoCopyrightModule.js",ln:23})}},render:function(a,n){try{this.roadName=n.panoCopyright.roadName;var o=this;this._copyRightDataDefferd.then(function(e){var t=n.panoCopyright.dataProviderIndex,p=o.getProviderFromIndex(t,e);!T.trim(p.name)&&n.panoCopyright.username&&n.panoCopyright.userid&&(p.url="http://pai.baidu.com/?qt=lensman&uid="+n.panoCopyright.userid+"&type=lensman"),n.panoCopyright.provider={name:T.trim(p.name+n.panoCopyright.username),url:T.trim(p.url)},11==t&&(n.panoCopyright.admission="");var r=COPYRIGHT_TPL({panoData:n});a.innerHTML=r,T("#pano-funcarea").hasClass("pano_funcarea_hide")&&T("#pano-cprt-msk").css("opacity","0.9"),T.on(T.g("pano-feedback"),"click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-feedback-click"})}),T.on(T.g("pano-upload-link"),"click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-ugc-entrance-click"})})})}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoCopyrightModule/PanoCopyrightModule.js",ln:70})}},getProviderFromIndex:function(a,n){for(var o=n.length-1;o>=0;o--)if(n[o].id==a)return n[o];return{name:"",url:"",id:""}},getCurrentRoad:function(){return this.roadName}});module.exports=PanoCopyrightModule});
;define("common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),Animation=require("common:widget/ui/Animation/Animation.js"),service=require("common:widget/pano/base/service.js"),util=require("common:widget/pano/base/util.js");require.loadCss({content:"#pano-classify-wrapper{position:absolute;right:45px;top:0;height:40px;width:176px;overflow:hidden;z-index:100010}.pano-classify-panel{position:relative;left:176px;height:40px;width:176px;color:#fff;font-size:12px;*background-color:#252525;_background-color:#252525;border-radius:2px;font-size:12px;background-position:0 -3px}#pano-classify-wrapper .transparent-msk{left:0;top:0;height:40px;border-radius:2px;background-color:#252525;opacity:.9;filter:alpha(opacity=90)}.classify_splite_line{display:inline-block;height:18px;width:1px;font-size:1px;line-height:1px;vertical-align:top;margin-top:12px;margin-left:7px;background-color:#3c3e42;_background-color:#3c3e42;background-color:#222\\9}.pano-classify-panel li{float:left;display:inline-block;height:34px;width:35px}.pano-classify-panel li a{display:inline-block;width:48px;height:40px}.pano-classify-panel li a{display:inline-block;margin-top:7px;height:26px;width:27px;overflow:hidden;background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/classification_search_icons2_f908cb3.png);background-repeat:no-repeat}.pano_classify_hotel{background-position:3px -1px}.pano_classify_hotel:hover{background-position:3px -26px}.pano_classify_select .pano_classify_hotel,.pano_classify_select .pano_classify_hotel:hover{background-position:3px -100px}.pano_classify_restaurant{background-position:-49px -2px}.pano_classify_restaurant:hover{background-position:-49px -27px}.pano_classify_select .pano_classify_restaurant,.pano_classify_select .pano_classify_restaurant:hover{background-position:-49px -101px}.pano_classify_movie{background-position:-155px -51px}.pano_classify_movie:hover{background-position:-155px -24px}.pano_classify_select .pano_classify_movie,.pano_classify_select .pano_classify_station:hover{background-position:-162px -97px}.pano_classify_station{background-position:-24px -1px}.pano_classify_station:hover{background-position:-24px -26px}.pano_classify_select .pano_classify_station,.pano_classify_select .pano_classify_station:hover{background-position:-24px -100px}.pano_classify_indoor{background-position:-75px -1px}.pano_classify_indoor:hover{background-position:-75px -26px}.pano_classify_select .pano_classify_indoor,.pano_classify_select .pano_classify_indoor:hover{background-position:-75px -100px}.pano-classify-panel li:last-child a{border-radius:0 4px 4px 0}.pano-classify-panel li:first-child a{border-radius:4px 0 0 4px}"});var getClassifySearchWrapper=function(){var classifySearchTmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="pano-classify-wrapper"><ul class="clearfix pano-classify-panel"><li data-index="1"><a href="javascript:void(0);" title="检索周边酒店" class="pano_classify_hotel"></a><span class="classify_splite_line"></span></li><li data-index="2"><a href="javascript:void(0);" title="检索周边餐饮" class="pano_classify_restaurant"></a><span class="classify_splite_line"></span></li><li data-index="3"><a href="javascript:void(0);" title="检索周边电影院" class="pano_classify_movie"></a><span class="classify_splite_line"></span></li><li data-index="4"><a href="javascript:void(0);" title="检索周边公交站" class="pano_classify_station"></a><span class="classify_splite_line"></span></li><li data-index="5"><a href="javascript:void(0);" title="检索周边内景" class="pano_classify_indoor"></a></li><div class="transparent-msk"></div></ul></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];return function(){var a=classifySearchTmpl({});return T(a)[0]}}(),classifySearchWrapper=null,classifySearchContainer=null,selectedClassifySearchType=void 0,classifySearchBtn=null,classifySearchBtnVisible=!1,panoContext=null,_classifySearchPanelVisible=!1,_displayAnimate=function(){var a=40,e=400,s=Animation.Transitions["ease-out"],i=new Animation.Animation,n=174,l=0,o="left";return function(t,r){var c=T(classifySearchWrapper).find(".pano-classify-panel")[0];if(void 0===r)_classifySearchPanelVisible=!_classifySearchPanelVisible;else{if(_classifySearchPanelVisible===r)return;_classifySearchPanelVisible=r}_classifySearchPanelVisible&&(classifySearchWrapper.style.display="block");var p=_classifySearchPanelVisible?n:l,f=_classifySearchPanelVisible?l:n;i.build({fps:a,transition:s,duration:e,render:function(a){try{c.style[o]=p+(f-p)*a+"px"}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js",ln:61})}},finish:function(){t(),!_classifySearchPanelVisible&&(classifySearchWrapper.style.display="none")}})}}(),ClassifySearchModule=ModuleClass.extend("ClassifySearchModule",{initialize:function(a,e,s){try{classifySearchBtnVisible=!0,classifySearchContainer=a,panoContext=s,classifySearchWrapper=getClassifySearchWrapper(),classifySearchContainer.appendChild(classifySearchWrapper),classifySearchBtn=e,this.open(),this.bindFoldExpandEvent(),this.bindEvents()}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js",ln:87})}},bindFoldExpandEvent:function(){var a=this,e=null,s=800,i=function(){e&&clearTimeout(e),a.open()},n=function(){e&&clearTimeout(e),e=setTimeout(function(){a.close()},s)};T.on(classifySearchWrapper,"mouseenter",i),T.on(classifySearchWrapper,"mouseleave",n),T.on(classifySearchBtn,"mouseenter",i),T.on(classifySearchBtn,"mouseleave",n)},toggle:function(a){_displayAnimate(function(){},a)},open:function(){this.toggle(!0)},close:function(){this.toggle(!1)},bindEvents:function(){var a=this;T(classifySearchWrapper).on("click",function(e){for(var s=e.target;"LI"!==s.nodeName&&s!==classifySearchWrapper;)s=s.parentNode;if("LI"===s.nodeName){var i=s.getAttribute("data-index");i!==selectedClassifySearchType?(T(classifySearchWrapper).find(".pano_classify_select").attr("class",""),T(s).attr("class","pano_classify_select")):(T(classifySearchWrapper).find(".pano_classify_select").attr("class",""),i=void 0),selectedClassifySearchType=i,a._updateClassifySearchMarkers(selectedClassifySearchType),T(classifySearchBtn).attr("class","classify_icon_"+selectedClassifySearchType),addStat(STAT_CODE.STAT_PANORAMA,{item:"classifysearchpanel-click"})}baidu.event.preventDefault(e)})},updateClassifySearch:function(){void 0!==selectedClassifySearchType&&this._updateClassifySearchMarkers(selectedClassifySearchType)},_updateClassifySearchMarkers:function(a){this._removeClassifySearchMarkers();var e=panoContext.getPanoOptions(),s=this;void 0!==a&&e&&service.getClassifySearchData(e.panoMCPoint.x,e.panoMCPoint.y,a,function(a){return function(e){var i=panoContext.getPanoOptions();i.panoId===a&&e&&e.length>0&&s._addClassifySearchMarkers(e.slice(0,10))}}(e.panoId))},_addClassifySearchMarkers:function(a){var e=this;e._markerIds=[],util.each(a,function(a){a.markerId=util.getUniqueId("MARKER_"),e._markerIds.push(a.markerId)}),this.dispatchEvent("add_markers",a)},_removeClassifySearchMarkers:function(){this._markerIds&&this._markerIds.length&&(this.dispatchEvent("remove_markers",this._markerIds),this._markerIds=null)},dispose:function(){classifySearchContainer.removeChild(classifySearchWrapper),classifySearchWrapper=null,classifySearchContainer=null,selectedClassifySearchType=void 0,classifySearchBtn=null,classifySearchBtnVisible=!1,T.un(document.body,"mousedown",window.pano_classify_global_click_handler),window.pano_classify_global_click_handler=null},getSupportEvents:function(){return["add_markers","remove_markers"]}});module.exports=ClassifySearchModule});
;define("common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",function(require,exports,module){var Animation=require("common:widget/ui/Animation/Animation.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),ScrollView=require("common:widget/pano/component/ScrollView/ScrollView.js"),DELAY_FOLD_TIME=200,travelPoiTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_popup">    <div class="travel_base_content">        '),data.lvyou.scope_grade&&_template_fun_array.push('            <p class="travel_grade">                ',"undefined"==typeof data.lvyou.scope_grade?"":data.lvyou.scope_grade,"景区            </p>        "),_template_fun_array.push("                "),data.lvyou.entrance_price&&data.lvyou.shop_hours&&(_template_fun_array.push('            <div class="travel_info_list clearfix">                '),data.lvyou.scope_type&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_type"></i></dt>                        <dd><span>景区类别：</span>',"undefined"==typeof data.lvyou.scope_type?"":data.lvyou.scope_type,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.entrance_price&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_entrance_price"></i></dt>                        <dd><span>门票价格：</span>',"undefined"==typeof data.lvyou.entrance_price?"":data.lvyou.entrance_price,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.shop_hours&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_shop_hours"></i></dt>                        <dd><span>开放时间：</span>',"undefined"==typeof data.lvyou.shop_hours?"":data.lvyou.shop_hours,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.base.address&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_addr"></i></dt>                        <dd><span>地址：</span>',"undefined"==typeof data.base.address?"":data.base.address,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.base.phone&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_phone"></i></dt>                        <dd><span>电话：</span>',"undefined"==typeof data.base.phone?"":data.base.phone,"</dd>                    </dl>                "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("    </div>    "),data.lvyou.entrance_price&&data.lvyou.shop_hours&&(data.lvyou.sug_time||data.lvyou.best_time)&&_template_fun_array.push('        <div class="travel_content_line"></div>    '),_template_fun_array.push("    "),(data.lvyou.sug_time||data.lvyou.best_time)&&(_template_fun_array.push('        <div class="travel_more_content">            <div class="travel_info_list clearfix">                '),data.lvyou.sug_time&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_sub_time"></i></dt>                        <dd><span>建议游玩时间：</span>',"undefined"==typeof data.lvyou.sug_time?"":data.lvyou.sug_time,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.best_time&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_best_time"></i></dt>                        <dd><span>最佳旅游季节：</span>',"undefined"==typeof data.lvyou.best_time?"":data.lvyou.best_time,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.url&&_template_fun_array.push('                    <p class="travel_more"><a href="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof data.lvyou.url?"":data.lvyou.url,'" title="前往百度旅游查看详细信息" target="_blank">更多&gt;&gt;</a></p>                '),_template_fun_array.push("            </div>        </div>    ")),_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],indoorPoiTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<div class="pano_popup"><div class="pano_poi_header clearfix"><p href="javascript:void(0);" class="title">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof data.base.name?"":data.base.name,"</p>"),data.film&&_template_fun_array.push('<a href="',"undefined"==typeof data.film.url_all?"":data.film.url_all,'" class="detail_link gray" target="_blank">详情>></a>'),_template_fun_array.push(""),data.hotel&&_template_fun_array.push('<a href="',"undefined"==typeof data.hotel.url_all?"":data.hotel.url_all,'" class="detail_link gray" target="_blank">详情>></a>'),_template_fun_array.push('</div><div class="content_line"></div><ul class="pano_poi_content clearfix">'),data.base.address&&_template_fun_array.push('<li class="clearfix">                <span class="pano_poi_icon pano_poi_icon_addr"></span><span class="type_name">地址：</span><span class="type_cont">',"undefined"==typeof data.base.address?"":data.base.address,"</span></li>"),_template_fun_array.push(""),data.base.phone&&_template_fun_array.push('<li class="clearfix last">                <span class="pano_poi_icon pano_poi_icon_phone"></span><span class="type_name">电话：</span><span class="type_cont">',"undefined"==typeof data.base.phone?"":data.base.phone,"</span></li>"),_template_fun_array.push("</ul>    "),data.film&&data.film.book_list&&0!==data.film.book_list.length){_template_fun_array.push('<div class="content_line"></div><div class="pano_movie_info"><ul class="movie_book clearfix">');for(var i=0;i<data.film.book_list.length&&2>i;i++)_template_fun_array.push('<li class="clearfix">       <span class="span1" title="美国队长2">',"undefined"==typeof data.film.book_list[i].movie_name?"":data.film.book_list[i].movie_name,'</span><span class="span2 gray">',"undefined"==typeof data.film.book_list[i].movie_type?"":data.film.book_list[i].movie_type,'</span><span class="span3 blue">¥',"undefined"==typeof data.film.book_list[i].price?"":data.film.book_list[i].price,'起</span><span class="span3"><a href="',"undefined"==typeof data.film.book_list[i].book_url?"":data.film.book_list[i].book_url,'" class="movie_book_btn" target="_blank">在线订座</a></span></li>');_template_fun_array.push('</ul><div class="clearfix"><a href="',"undefined"==typeof data.film.url_all?"":data.film.url_all,'" class="book_link" target="_blank">更多电影>></a></div></div>')}if(_template_fun_array.push(""),data.hotel&&data.hotel.book_list&&0!==data.hotel.book_list.length){_template_fun_array.push('<div class="content_line"></div><div class="pano_hotel_info"><ul class="hotel_book clearfix">');for(var j=0;j<data.hotel.book_list.length&&2>j;j++)_template_fun_array.push('<li class="clearfix">        <span class="span1">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof data.hotel.book_list[j].desc?"":data.hotel.book_list[j].desc,'</span><span class="span2 orange">¥',"undefined"==typeof data.hotel.book_list[j].price?"":data.hotel.book_list[j].price,'起</span><span class="span3"><a href="',"undefined"==typeof data.hotel.book_list[j].book_url?"":data.hotel.book_list[j].book_url,'" class="hotel_book_btn" target="_blank">预订&gt;&gt;</a></span>    </li>');_template_fun_array.push('</ul><div class="clearfix"><a class="book_link" href="',"undefined"==typeof data.hotel.url_all?"":data.hotel.url_all,'" target="_blank">更多房型和日期&gt;&gt;</a></div></div>')}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],panoIndoorPoiModuleTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="indoor_poi_detail_container">    <h3 class="indoor_poi_title">        <dl class="clearfix">            <dt><i class="indoor_poi_icon indoor_poi_name"></i></dt>            <dd>',"undefined"==typeof name?"":name,'</dd>        </dl>    </h3>    <div class="poi_container_wrapper">        <div class="poi_content_wrapper">            <div class="pop_scroller_wrapper">            </div>        </div>    </div>    </div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];require.loadCss({content:".indoor_poi_detail_container{color:#fff;font-size:12px;z-index:100101}.indoor_poi_title{height:40px;width:268px;font-size:12px;line-height:40px;font-weight:400;padding:0 16px;background-color:rgba(37,37,37,.9);background-color:#252525\\9;filter:alpha(opacity=90)\\9;_filter:alpha(opacity=100);border-radius:2px 2px 0 0;color:#abb0b2}.indoor_poi_title dt{float:left;*padding-top:10px}.indoor_poi_title dd{padding-left:5px;cursor:pointer}.indoor_poi_title dd:hover{color:#3af}.indoor_poi_icon{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_0dc7001.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_8_5876649.png);margin-top:-2px;width:14px;height:14px;display:inline-block;vertical-align:middle;margin-right:7px}.indoor_poi_name{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_efd2360.png);_background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_8_f96e26d.png);width:18px;height:18px;background-position:0 0}.poi_container_wrapper{width:300px;overflow:hidden;position:relative;border-top:1px solid #53565d}.poi_content_wrapper{position:absolute;top:-9999px;width:100%;padding:6px 0;overflow:hidden;background-color:rgba(37,37,37,.9);background-color:#252525\\9;filter:alpha(opacity=90)\\9;_filter:alpha(opacity=100);border-radius:0 0 2px 2px}.pop_scroller_wrapper{overflow:hidden}.travel_base_content{padding:8px 14px 0}.travel_more_content{padding:0 14px}.travel_content_line{width:300px;height:1px;margin-bottom:16px;font-size:0;line-height:0;background:#53565d;background:#53565d\\9}.travel_info_list dl{margin-bottom:16px}.travel_info_list dd{padding-left:5px;width:245px}.travel_info_list span{color:#FFF}.travel_info_list dt,.travel_info_list dd{display:inline-block;margin:0;float:left}.travel_grade{display:inline-block;width:74px;height:20px;margin-bottom:16px;text-align:center;color:#000;background:#ffde00;line-height:20px;font-size:12px}.travel_type{background-position:0 0}.travel_entrance_price{background-position:-14px 0}.travel_shop_hours{background-position:-28px 0}.travel_addr{background-position:-42px 0}.travel_phone{background-position:-56px -1px}.travel_sub_time{background-position:-70px 0}.travel_best_time{background-position:-70px 0}.travel_more{float:right}.travel_more a{color:gray;text-decoration:none}.poi_container_wrapper .scrollbar-y,.poi_container_wrapper .scrollbar-y-thumb-prev,.poi_container_wrapper .scrollbar-y-thumb-next,.poi_container_wrapper .scrollbar-y-prev,.poi_container_wrapper .scrollbar-y-next{background-image:none}.poi_container_wrapper .scrollbar-y-prev,.poi_container_wrapper .scrollbar-y-next{width:14px}.poi_container_wrapper .tangram-scrollbar-slider{margin:0 auto;border-radius:20px;background-color:#292c2f;opacity:.95;width:6px}.poi_container_wrapper .scrollbar-y-thumb-btn{margin:0 auto;width:4px;background:#B3B9C3;opacity:.3;border-radius:10px}"});var PanoIndoorPoiModule=ModuleClass.extend("PanoIndoorPoiModule",{_renderTravelPoiInfo:function(a){try{return travelPoiTemplate({data:a})}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:20})}},_renderNormalPoiInfo:function(a){try{return indoorPoiTemplate({data:a})}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:25})}},initialize:function(a,e,t,o){try{this._container=a,this._events=null,this._isMouseEntered=!1,this._hasPanoPlan=t,this._animateStateEnum={FOLDING:1,EXPANDING:2,STATIC:3},this._animateState=this._animateStateEnum.STATIC,this.render(e,t,o)}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:42})}},render:function(a,e,t){try{var o=this,n=o._container;o._isMouseEntered=!1,o._hasPanoPlan=e,o._currentUid=t,o._data=a,o._animateState=this._animateStateEnum.STATIC;var i=panoIndoorPoiModuleTemplate({name:a.base.name}),r=T(i),l=r.find(".pop_scroller_wrapper"),_=null;_=a.lvyou?this._renderTravelPoiInfo(a):this._renderNormalPoiInfo(a),l.append(T(_)),n.innerHTML="",T(n).append(r),n.style.display="block",this._appendScroller(),setTimeout(function(){o._isMouseEntered||(o._expand(),setTimeout(function(){o._isMouseEntered||o._fold()},2e3))},500),this.bindEvents(),T.on(T(".travel_more")[0],"click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"travel-link-click"})}),addStat(STAT_CODE.STAT_PANORAMA,{catalog:"poi-detail",item:Pano.PANO_TYPE_INDOOR,from:a.base.type}),this.dispatch(t)}catch(s){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:102})}},event_poi_change:function(a,e){this.render(a.indoorPoi,this._hasPanoPlan,e)},dispatch:function(a){this.dispatchEvent("poi_change",{uid:a})},bindEvents:function(){{var a=this,e=T(".indoor_poi_title")[0],t=T(".poi_content_wrapper")[0];T(".indoor_poi_detail_container")[0]}a._events={},a._tagMouseIn="",a._events.titleMouseEnter=function(){a._isMouseEntered=!0,a._tagMouseIn="title",a._expand()},a._events.titleMouseLeave=function(){"title"==a._tagMouseIn&&(a._tagMouseIn=""),setTimeout(function(){"content"!=a._tagMouseIn&&"title"!=a._tagMouseIn&&a._fold()},DELAY_FOLD_TIME)},a._events.contMouseEnter=function(){a._isMouseEntered=!0,a._tagMouseIn="content"},a._events.contMouseLeave=function(){"content"==a._tagMouseIn&&(a._tagMouseIn=""),setTimeout(function(){"title"!=a._tagMouseIn&&"content"!=a._tagMouseIn&&a._fold()},DELAY_FOLD_TIME)},T.on(e,"mouseenter",a._events.titleMouseEnter),T.on(e,"mouseleave",a._events.titleMouseLeave),T.on(t,"mouseenter",a._events.contMouseEnter),T.on(t,"mouseleave",a._events.contMouseLeave),T(".indoor_poi_detail_container .movie_book_btn").on("click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookmovie-click",type:"inter"})}),T(".indoor_poi_detail_container .hotel_book_btn").on("click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookhotel-click",type:"inter"})})},getCurrentUid:function(){return this._currentUid},getCurrentUid:function(){return this._currentUid},getPoiData:function(){return this._data},_removeEvents:function(){if(this._events){var a=T(".travel_title")[0],e=T(".poi_content_wrapper")[0];T.un(a,"mouseenter",this._events.titleMouseEnter),T.un(a,"mouseleave",this._events.titleMouseLeave),T.un(e,"mouseenter",this._events.contMouseEnter),T.un(e,"mouseleave",this._events.contMouseLeave)}},dispose:function(){this._removeEvents(),this._container.innerHTML="",this._animation&&(this._animation.cancel(),this._animation=null)},show:function(){this._container.style.display="block"},hide:function(){this._container.style.display="none"},_expand:function(){var a=T(".poi_container_wrapper")[0],e=T(".poi_content_wrapper")[0],t=T(".indoor_poi_title")[0];if(a&&e&&this._animateState!=this._animateStateEnum.EXPANDING){this._animateState=this._animateStateEnum.EXPANDING;var o=e.offsetHeight;a.style.height=o+32+"px";var n=e.offsetTop;-o>n&&(n=-o),this._animation&&this._animation.cancel(),a.style.borderTop="1px solid #53565d",t.style.borderRadius="2px 2px 0 0",e.style.top=n+"px",this._slideAnimate(e,n,0)}},_fold:function(){var a=T(".poi_container_wrapper")[0],e=T(".poi_content_wrapper")[0],t=T(".indoor_poi_title")[0];if(a&&e&&this._animateState!=this._animateStateEnum.FOLDING){this._animateState=this._animateStateEnum.FOLDING;var o=e.offsetHeight,n=e.offsetTop;this._animation&&this._animation.cancel(),this._slideAnimate(e,n,-(o+32),function(){a.style.borderTop="0",t.style.borderRadius="2px"})}},_slideAnimate:function(a,e,t,o){var n=a.offsetTop,i=this,e=+e,t=+t;n!==t&&(this._animation||(this._animation=new Animation.Animation),this._animation.build({fps:60,transition:Animation.Transitions.easeInQuad,duration:350,render:function(o){try{a.style.top=e+o*(t-e)+"px"}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:317})}},finish:function(){!!o&&o(),e>t&&T(".poi_container_wrapper")[0]&&(T(".poi_container_wrapper")[0].style.height=0),i._animateState=i._animateStateEnum.STATIC}}))},_appendScroller:function(){var a=T(".pop_scroller_wrapper")[0],e=a.offsetHeight,t=this._getMaxContentHeight();e>t?(a.style.height=t+"px",this.scrollPanel=new ScrollView(a,{overflow:"overflow-y",autoUpdate:!1}),this.scrollPanel.update()):a.style.height=e},_getMaxContentHeight:function(){var a=document.body.offsetHeight,e=70,t=this._hasPanoPlan?335:135,o=32,n=0;return a>768&&(a=768),n=a-e-t-o,n>0?n:0},getShareParam:function(){var a=this.getCurrentUid();return{uid:a}},getSupportEvents:function(){return["poi_change"]}});module.exports=PanoIndoorPoiModule});
;define("common:widget/pano/module/PoiInfoPanelModule/PoiInfoPanelModule.js",function(require,exports,module){var FoldPanelComponent=require("common:widget/pano/component/FoldPanelComponent/FoldPanelComponent.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),PanoPoi=require("common:widget/pano/model/PanoPoi.js");require.loadCss({content:".list-title-bar{position:absolute;top:20px;left:103px;font-size:12px;line-height:40px;height:40px;width:87px;background-color:#252525;background-color:rgba(37,37,37,.9);filter:alpha(opacity=90);border-radius:2px 0 0 2px;color:#c5cbd6}.list-title-bar .v-line{position:absolute;right:0;top:10px;height:20px;width:1px;background-color:#53565c}.list_title_text{text-indent:42px;display:block;line-height:40px;text-decoration:none;color:#c5cbd6;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon2_d6ba4ea.png) no-repeat 9px 8px;_background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon_8_2_9ebc767.png) no-repeat;_background-position:9px 8px}.list_title_text:hover{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon2_hover_9b65ccc.png) no-repeat 9px 7px;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon_8_2_hover_951b39a.png) no-repeat;_background-position:9px 7px;color:#3af}.busline_title_icon,.busline_title_icon:hover{overflow:hidden;width:87px;white-space:nowrap;text-overflow:ellipsis;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/busline-icon2_36fa0ae.png) no-repeat 10px 6px;_background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/busline-icon-ie6_d8bc65f.png)}.busline_title_icon:hover{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/busline-icon2_hover_5813c0b.png) no-repeat 12px 6px!important}.info-title-bar,.info-title-bar-nolist{position:absolute;top:20px;font-size:12px;line-height:40px;height:40px;width:193px;padding:0 10px;background-color:#252525;background-color:rgba(37,37,37,.9);_background-color:#252525;*background-color:#252525;filter:alpha(opacity=90);_filter:alpha(opacity=90);border-radius:0 2px 2px 0;color:#c5cbd6}.info-title-bar{left:190px}.info-title-bar p{_margin-top:10px}.info-title-bar-nolist{left:103px;width:280px;border-radius:2px}.poi_title_text{_margin-top:10px;width:95%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer}.poi_title_text:hover{color:#3af}.poi_default_icon{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_efd2360.png);*background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_8_f96e26d.png);width:18px;height:18px;background-position:0 0;margin-top:-2px;margin-right:7px;display:inline-block;vertical-align:middle}.info-title-bar dt,.info-title-bar dd{display:inline-block;margin:0;float:left}.info-title-bar dt{*margin-top:7px}.pano_popup_title{margin:0 auto;width:260px;height:35px;color:#c5cbd5;font-size:14px;line-height:35px;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.pano_popup_title span{color:#eaae00}.pano_popup{width:300px;font-size:12px;color:#939799}.pano_popup a{text-decoration:none;color:#c5cbd6}.pano_popup .content_line{margin:14px;height:1px;font-size:0;line-height:0;background:#3c3c42}.pano_poi_header{margin:9px 14px 0}.pano_poi_header .indoor_view_icon{float:left;margin-top:-3px}.pano_poi_header .detail_link{color:#71557b;float:right}.pano_poi_header .detail_link:hover{color:#33a9ff}.pano_poi_header .title{float:left;width:210px;margin-right:6px;font-size:12px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#d3d8db}.pano_poi_content{margin-bottom:6px}.pano_poi_content li{margin:0 14px 10px}.pano_poi_content li.last{margin-bottom:0}.pano_poi_content li span{float:left}.pano_poi_content .type_cont{width:206px}.pano_popup .book_link{float:right;color:#7a7c80;margin-bottom:10px}.pano_popup .book_link:hover{color:#3af}.movie_newest{font-size:12px}.movie_newest a span{display:inline-block;width:48px;padding:5px 8px;vertical-align:middle;background:#9bcb66;color:#fff}.movie_book .span1{display:inline-block;width:104px;vertical-align:middle;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.movie_book .span2,.movie_book .span3{display:inline-block;width:48px;*margin-left:-3px}.movie_newest a em{color:red;font-style:normal}.pano_popup .gray{color:#71757b}.pano_popup .blue{color:#40acff}.pano_popup .orange{color:#ee6919}.pano_hotel_info li,.pano_movie_info li{margin-bottom:14px;line-height:20px}.pano_hotel_info,.pano_movie_info{margin:0 14px}.hotel_book .span1{display:inline-block;width:140px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.hotel_book .span2{display:inline-block;width:60px;overflow:hidden}.movie_book_btn{display:inline-block;height:20px;line-height:20px;text-align:center;text-decoration:none;font-size:12px;color:#caac00!important;_overflow:hidden;zoom:1;width:60px}.hotel_book_btn{display:inline-block;vertical-align:top;width:60px;height:20px;line-height:20px;font-size:12px;color:#caac00!important;text-align:center;text-decoration:none;_overflow:hidden;zoom:1}.pano_poi_icon{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_0dc7001.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_8_5876649.png);margin-top:1px;margin-right:5px;width:14px;height:14px;display:inline-block;vertical-align:middle}.pano_poi_icon_addr{background-position:-42px 0}.pano_poi_icon_phone{background-position:-56px -1px}.pano_popup .bottom_line{margin:12px 14px 0;font-size:0;line-height:0;height:1px;background:#3c3c42;_background:#222}.pano_poi_footer li{height:35px;text-align:center;cursor:pointer;font-size:12px}.pano_poi_footer .indoor_view{padding-top:9px;display:block}.pano_poi_footer .indoor_view:hover{color:#3af}.pano_poi_footer .detail_indoor_view_icon{display:inline-block;width:27px;height:29px;vertical-align:middle;margin-right:10px;margin-top:-4px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/classification_search_icons2_f908cb3.png) no-repeat;background-position:-75px 0;_background-position:-75px 0}.pano_poi_footer .indoor_view:hover .detail_indoor_view_icon{background-position:-75px -25px}.pano_popup h4.pano_poi_list_header{margin-bottom:18px;text-align:center;font-size:14px;font-weight:400;letter-spacing:3px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.pano_poi_list_content .list_item{position:relative;z-index:0;overflow:hidden;padding:14px 10px;vertical-align:middle}.pano_poi_list_content .list_item_line{position:absolute;top:0;left:18px;width:272px;height:1px;font-size:0;line-height:0;border:0;background:#3c3c42;_background:#222}.pano_poi_list_content .list_item_icon{float:left;width:30px}.list_item_content{float:left;cursor:pointer}.list_item_content .pano_poi_name{width:180px;margin-bottom:12px;font-weight:400;font-size:12px;color:#c5cbd5;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.pano_info_name{float:left;width:37px;color:#71757b}.pano_poi_addr{margin-bottom:7px}.pano_info_cont{float:left;width:170px;color:#71757b}.list_item_bg{position:absolute;z-index:-1;left:0;top:1px;width:999px;height:999px;background:transparent}.list_item_hover .list_item_bg{background-color:#4d4e4e;opacity:.8;filter:alpha(opacity=80);_filter:alpha(opacity=100)}.pano_entrance{position:absolute;top:10px;right:16px;width:58px;overflow:hidden}.street_view_icon,.indoor_view_icon{float:right;width:24px;height:26px}.street_view_icon{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_detail_d5cec92.png) no-repeat}.indoor_view_icon{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/classification_search_icons2_f908cb3.png) no-repeat;background-position:-78px -4px;_background-position:-80px 0}.list_item_hover .indoor_view_icon{background-position:-78px -4px}.street_view_icon{background-position:0 -32px}.pano_entrance_split_line{height:12px;width:1px;float:right;font-size:0;margin:4px 5px 4px 2px;background:#53565c;_background:#222}.indoor_view_icon_hover,.pano_poi_header .indoor_view_icon:hover{background-position:-78px -29px}.pano_poi_list_page{margin-top:5px;text-align:center}.pano_poi_list_page span{display:inline-block;margin:0 4px;color:#d3d8db;padding:0 5px}.pano_poi_list_page a{display:inline-block;line-height:20px;padding:0 5px;text-decoration:none;color:#939799}.pano_poi_list_page a:hover{color:#d3d8db}.list_item_icon span{display:inline-block;width:19px;height:29px;margin-left:5px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/markers_new_37c4817.png) no-repeat;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/markers_new_ie6_429ba35.png) no-repeat}.list_item_icon span.no_1{background-position:0 0}.list_item_hover span.no_1{background-position:0 -32px}.list_item_icon span.no_2{background-position:-24px 0}.list_item_hover span.no_2{background-position:-24px -32px}.list_item_icon span.no_3{background-position:-47px 0}.list_item_hover span.no_3{background-position:-47px -32px}.list_item_icon span.no_4{background-position:-69px 0}.list_item_hover span.no_4{background-position:-69px -32px}.list_item_icon span.no_5{background-position:-93px 0}.list_item_hover span.no_5{background-position:-93px -32px}.list_item_icon span.no_6{background-position:-117px 0}.list_item_hover span.no_6{background-position:-117px -32px}.list_item_icon span.no_7{background-position:-141px 0}.list_item_hover span.no_7{background-position:-141px -32px}.list_item_icon span.no_8{background-position:-164px 0}.list_item_hover span.no_8{background-position:-164px -32px}.list_item_icon span.no_9{background-position:-188px 0}.list_item_hover span.no_9{background-position:-188px -32px}.list_item_icon span.no_10{background-position:-211px 0}.list_item_hover span.no_10{background-position:-211px -32px}.pano_poi_list_content .list_item.busline_station{padding:5px 10px}.busline_station .pano_poi_name{line-height:25px;margin-bottom:0;margin-left:10px}"});var POI_DETAIL_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push(""),panoPoi.tour)_template_fun_array.push('        <div class="pano_popup">        <div class="pano_poi_header clearfix">            <p href="javascript:void(0);" class="title">                ',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.tour.name?"":panoPoi.tour.name,'            </p>        </div><div class="bottom_line"></div><div class="pano_poi_footer"><ul><li data-action="tour" data-tourid="',"undefined"==typeof panoPoi.tour.tourid?"":panoPoi.tour.tourid,'"><a data-action="tour" data-tourid="',"undefined"==typeof panoPoi.tour.tourid?"":panoPoi.tour.tourid,'" href="javascript:void(0);" class="indoor_view"><span as-parent="1" class="detail_indoor_view_icon"></span>进入内景</a></li></ul></div>    </div>');else{if(_template_fun_array.push('    <div class="pano_popup">        <div class="pano_poi_header clearfix">            <p href="javascript:void(0);" class="title">                ',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.poi.name?"":panoPoi.poi.name,'            </p>            <a href="javascript:void(0);" class="detail_link gray" target="_blank" data-action="detail">详情>></a>        </div>        <div class="content_line"></div>        <ul class="pano_poi_content">            '),panoPoi.poi.addr&&(_template_fun_array.push('                <li class="clearfix">                                        '),_template_fun_array.push(1===panoPoi.poi.poi_type||3===panoPoi.poi.poi_type?'                        <span class="type_name">车次：</span>                    ':'                        <span class="type_name">地址：</span>                    '),_template_fun_array.push('                    <span class="type_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.poi.addr?"":panoPoi.poi.addr,"</span>                </li>            ")),_template_fun_array.push("            "),panoPoi.poi.tel&&_template_fun_array.push('                <li class="clearfix last">                                        <span class="type_name">电话：</span>                    <span class="type_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.poi.tel?"":panoPoi.poi.tel,"</span>                </li>            "),_template_fun_array.push("        </ul>        "),panoPoi.movie){_template_fun_array.push('            <div class="content_line"></div>            <div class="pano_movie_info">                <div class="movie_newest">                    '),panoPoi.poi.movie_count&&_template_fun_array.push('                        <a href="javascript:void(0);">                            <span>实时影讯<i class="arrow"></i></span>                            目前                            <em>',"undefined"==typeof panoPoi.poi.movie_count?"":panoPoi.poi.movie_count,"</em>                            部影片                            <em>正在上映!</em>                        </a>                    "),_template_fun_array.push('                </div>                <ul class="movie_book">                    ');for(var i=0;i<panoPoi.movie.length;i++)_template_fun_array.push('                        <li class="clearfix">                            <span class="span1" title="美国队长2">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.movie[i].name?"":panoPoi.movie[i].name,'</span>                            <span class="span2 gray">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.movie[i].type?"":panoPoi.movie[i].type,'</span>                            <span class="span3 orange">¥',"undefined"==typeof panoPoi.movie[i].price?"":panoPoi.movie[i].price,'起</span>                            <span class="span3">                                <a href="javascript:void(0);" class="movie_book_btn" data-action="bookMovie" data-mid="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.movie[i].id?"":panoPoi.movie[i].id,'" target="_blank">在线订座</a>                            </span>                        </li>                    ');_template_fun_array.push('                </ul>                <div class="clearfix">                    <a href="javascript:void(0)" class="book_link" target="_blank" data-action="moreMovie">更多电影>></a>                </div>            </div>        ')}if(_template_fun_array.push("        "),panoPoi.hotel){_template_fun_array.push('            <div class="content_line"></div>            <div class="pano_hotel_info">                <ul class="hotel_book">                    ');for(var j=0;j<panoPoi.hotel.length;j++)_template_fun_array.push('                        <li class="clearfix">                            <span class="span1">',"undefined"==typeof panoPoi.hotel[j].roomTypeName?"":panoPoi.hotel[j].roomTypeName,'</span>                            <span class="span2 orange">¥',"undefined"==typeof panoPoi.hotel[j].price?"":panoPoi.hotel[j].price,'起</span>                            <span class="span3">                                <a href="javascript:void(0);" class="hotel_book_btn" target="_blank" data-action="bookHotel" data-rid="',"undefined"==typeof panoPoi.hotel[j].roomId?"":panoPoi.hotel[j].roomId,'">                                    预订>>                                </a>                            </span>                        </li>                    ');_template_fun_array.push('                </ul>                <div class="clearfix">                    <a class="book_link" href="javascript:void(0);" data-action="detail" target="_blank">更多房型和日期&gt;&gt;</a>                </div>            </div>        ')}_template_fun_array.push("        "),panoPoi.pano&&panoPoi.pano.iid&&_template_fun_array.push('            <div class="bottom_line"></div>            <div class="pano_poi_footer">                <ul>                    <li data-action="indoor" data-iid="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.pano.iid?"":panoPoi.pano.iid,'">                        <a data-action="indoor" data-iid="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoi.pano.iid?"":panoPoi.pano.iid,'" href="javascript:void(0);" class="indoor_view"><span as-parent="1" class="detail_indoor_view_icon"></span>进入内景</a>                    </li>                </ul>            </div>        '),_template_fun_array.push("    </div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],POI_LIST_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_popup"><div class="pano_poi_list_content"><ul>');for(var i=0,len=panoPoiList.content.length;len>i;i++)_template_fun_array.push('<li data-action="goToPoi" data-index="',"undefined"==typeof i?"":i,'" class="list_item clearfix"><a class="list_item_bg"></a>'),0!=i&&_template_fun_array.push('<div class="list_item_line"></div>'),_template_fun_array.push('<a href="javascript:void(0);" class="list_item_icon"><span class="no_',"undefined"==typeof(i+1)?"":i+1,'"></span></a><div class="list_item_content"><h4 class="pano_poi_name">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoiList.content[i].poi.name?"":panoPoiList.content[i].poi.name,'</h4><ul class="pano_poi_detail">'),panoPoiList.content[i].poi.addr&&_template_fun_array.push('<li class="clearfix pano_poi_addr"><span class="pano_info_name">地址：</span><span class="pano_info_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoiList.content[i].poi.addr?"":panoPoiList.content[i].poi.addr,"</span></li>"),_template_fun_array.push(""),panoPoiList.content[i].poi.tel&&_template_fun_array.push('<li class="clearfix pano_poi_tel"><span class="pano_info_name">电话：</span><span class="pano_info_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==typeof panoPoiList.content[i].poi.tel?"":panoPoiList.content[i].poi.tel,"</span></li>"),_template_fun_array.push('</ul><div class="pano_entrance">'),panoPoiList.content[i].poi.hasIndoor&&_template_fun_array.push('<a data-action="showIndoor" data-index="',"undefined"==typeof i?"":i,'" href="javascript:void(0);" class="indoor_view_icon"></a><span class="pano_entrance_split_line"></span>'),_template_fun_array.push(""),panoPoiList.content[i].poi.sid&&_template_fun_array.push('<span class="street_view_icon"></span>'),_template_fun_array.push("</div></div></li>");if(_template_fun_array.push("</ul></div>"),panoPoiList.pageInfo){_template_fun_array.push('<div class="pano_poi_list_page"><p>'),panoPoiList.pageInfo.hasHome&&_template_fun_array.push('<span class="home"><a data-action="home_page" href="javascript:void(0);">首页</a></span>'),_template_fun_array.push(""),panoPoiList.pageInfo.hasPrev&&_template_fun_array.push('<span class="pre"><a data-action="prev_page" href="javascript:void(0);">&lt;上一页</a></span>'),_template_fun_array.push("");for(var i=0,len=panoPoiList.pageInfo.text.length;len>i;i++)_template_fun_array.push(""),panoPoiList.pageInfo.text[i]==panoPoiList.pageInfo.index?_template_fun_array.push(' <span class="curPage">',"undefined"==typeof panoPoiList.pageInfo.text[i]?"":panoPoiList.pageInfo.text[i],"</span>"):_template_fun_array.push('<span><a data-action="pn" href="javascript:void(0);">',"undefined"==typeof panoPoiList.pageInfo.text[i]?"":panoPoiList.pageInfo.text[i],"</a></span>"),_template_fun_array.push("");_template_fun_array.push(""),panoPoiList.pageInfo.hasNext&&_template_fun_array.push('<span class="next"><a data-action="next_page" href="javascript:void(0);">下一页&gt;</a></span>'),_template_fun_array.push("</p></div>")}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],BUSLINE_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_popup"><div class="pano_poi_list_content"><ul>');for(var i=0,len=poiList.length;len>i;i++)_template_fun_array.push('<li data-action="goToBusStation" data-index="',"undefined"==typeof i?"":i,'" class="list_item busline_station clearfix"><a class="list_item_bg"></a>'),0!=i&&_template_fun_array.push('<div class="list_item_line"></div>'),_template_fun_array.push('<div class="list_item_content"><h4 class="pano_poi_name">',"undefined"==typeof poiList[i].stationName?"":poiList[i].stationName,'</h4><div class="pano_entrance">'),poiList[i].pano&&poiList[i].pano.pid&&_template_fun_array.push('<span class="street_view_icon"></span>'),_template_fun_array.push("</div></div></li>");_template_fun_array.push("</ul></div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],VIEW_HEADER=59,VIEW_FOOTER=150,CONTEN_PADDING=12,BUFFER=32,fitForIndex=function(i,o,a,t,e){var n=t;if(o>=n&&n+e>=a)return void 0;if(n>o)return o;if(a>n+e){var p=o-(e-(a-o));return p}},getPanelMaxHeight=function(){var i=document.body.offsetHeight-VIEW_HEADER-VIEW_FOOTER-CONTEN_PADDING-BUFFER;return Math.max(i,50)},gotoDetailPage=function(i){var o=i.getAttribute("data-action");if(!o){var a=i.getAttribute("as-parent");if(!a)return;i=i.parentNode,o=i.getAttribute("data-action")}var t=this._data.poi;switch(o){case"indoor":var e=i.getAttribute("data-iid");this.dispatchEvent("pano_changed",{data:{source:"PoiInfoPanelModule",panoIId:e}}),addStat(STAT_CODE.STAT_PANORAMA,{item:"poidetail-indoorview-click"});break;case"detail":3===t.poi.poi_type?util.showDetail(t.poi.uid,t.poi.poi_type,t.poi.city,"",""):util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,"Page");break;case"bookMovie":var n=i.getAttribute("data-mid");util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,"movie_book","",n),addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookmovie-click",type:"street"});break;case"moreMovie":util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,"movie_more");break;case"bookHotel":var p=i.getAttribute("data-rid"),s="";p&&(s=baidu.url.jsonToQuery({roomId:p})),util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,t.poi.src,"",s),addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookhotel-click",type:"street"})}},listPanelAction=function(i,o){for(var a=(this._data.poi,this._data.list.content),t=this._data.list.pageInfo,e=!1;!e&&i&&i!==o;){var n=i.getAttribute("data-action");switch(n){case"goToPoi":case"goToBusStation":var p=i.getAttribute("data-index"),s=a[p];this.setSelect(p);var r=this;s.extend(PanoPoi.TYPE.pano).then(function(){s.pano.belonging?r.dispatchEvent("inter_poi_changed",{data:{source:"PoiInfoPanelModule",panoId:s.pano.pid,uid:s.poi.uid,pid:s.pano.pid,poiType:2,panoHeading:s.pano.dir,panoPitch:s.pano.pitch,x:s.pano.x,y:s.pano.y,panoX:s.pano.panox,panoY:s.pano.panoy}}):r.dispatchEvent("animate_pano_changed",{data:{source:"PoiInfoPanelModule",panoId:s.pano.pid,uid:s.poi.uid,pid:s.pano.pid,poiType:2,panoHeading:s.pano.dir,panoPitch:s.pano.pitch,x:s.pano.x,y:s.pano.y,panoX:s.pano.panox,panoY:s.pano.panoy}}),r.foldList(),setTimeout(function(){r.dispatchEvent("hide_position")},100)});break;case"showIndoor":var p=i.getAttribute("data-index"),s=a[p],r=this;s.extend(PanoPoi.TYPE.pano).then(function(){r.dispatchEvent("pano_changed",{data:{source:"PoiInfoPanelModule",panoIId:s.pano.iid}})}),e=!0,addStat(STAT_CODE.STAT_PANORAMA,{item:"poilist-indoorview-click"});break;case"pn":var l=parseInt(i.innerHTML);l--,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0;break;case"home_page":l=0,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0;break;case"prev_page":var l=t.index-1;l--,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0;break;case"next_page":var l=t.index-1;l++,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0}i=i.parentNode}},PoiInfoPanelModule=ModuleClass.extend("PoiInfoPanelModule",{initialize:function(i,o,a,t,e,n,p){try{this._busLineCityCode=n,this._busLineUid=e,this._panoContext=o,this._data={poi:void 0,list:void 0,listUrl:void 0},this._saveData={poi:void 0,list:void 0,listUrl:void 0},this.parentDom=parentDom=document.createElement("div");var s=document.createElement("div"),r=this.listButton=document.createElement("div");r.className="list-title-bar",s.appendChild(r);var l=this.infoButton=document.createElement("div");l.className="info-title-bar",s.appendChild(l);var _=document.createElement("div"),d=this.infoPanel=new FoldPanelComponent(l,_,{align:"right"});d.setPosition(103,VIEW_HEADER);var c=this.listPanel=new FoldPanelComponent(r,_,{align:"left"});c.setPosition(103,VIEW_HEADER),parentDom.appendChild(s),parentDom.appendChild(_),i.appendChild(parentDom),t||this.hide();var u=this;T.on(r,"mouseenter",function(){d.fold(!0)}),T.on(l,"mouseenter",function(){c.fold(!0);var i=u._data.poi;if(i){var o=i.poi?i.poi.x:i.pano.x,a=i.poi?i.poi.y:i.pano.y;u.dispatchEvent("show_position",{data:{x:o,y:a}})}}),T.on(l,"mouseleave",function(){u.dispatchEvent("hide_position")}),d.addEventListener("click",function(i){gotoDetailPage.call(u,i.target,_),i.preventDefault()}),c.addEventListener("click",function(i){listPanelAction.call(u,i.target,_)});var h={},m=function(i,o){return o?(f&&h[o]&&clearTimeout(h[o]),void(h[o]=setTimeout(function(){o!==f&&T(i).removeClass("list_item_hover")},5))):void T(i).removeClass("list_item_hover")};c.addEventListener("mouseout",function(i){for(var o=i.target;o&&o!==_;){var a=o.getAttribute("data-action");if("showIndoor"===a&&T(o).removeClass("indoor_view_icon_hover"),"goToPoi"===a||"goToBusStation"===a){m(o,f),f=void 0;break}o=o.parentNode}});var f=void 0;c.addEventListener("mouseover",function(i){for(var o=i.target,a=!1;o&&o!==_;){var t=o.getAttribute("data-action");if("showIndoor"===t&&(T(o).addClass("indoor_view_icon_hover"),a=!0),"goToPoi"===t||"goToBusStation"===t){var e=o.getAttribute("data-index");if(e!==f){var n=u._data.list.content[e];n.extend(PanoPoi.TYPE.poi).then(function(){u.dispatchEvent("show_position",{data:{x:n.poi.x,y:n.poi.y}})}),f=e}T(o).hasClass("list_item_hover")||T(o).addClass("list_item_hover");var p=o.offsetTop,s=fitForIndex(e,p,p+o.clientHeight,this.getScrollValue(),this.getViewSize().height);void 0!==s&&this.scrollTo(s),a&&T(o).removeClass("list_item_hover");break}o=o.parentNode}}),c.addEventListener("mouseleave",function(){f=void 0,u.dispatchEvent("hide_position")});var v=void 0,g=!1,x=!1,b=!1,P=function(){clearTimeout(v),setTimeout(function(){var i=g||x;i!==b&&(b=i,u.dispatchEvent("status_changed",{isExpand:b}))},200)};if(c.addEventListener("before_expand",function(){g=!0,P()}),d.addEventListener("before_expand",function(){x=!0,P()}),c.addEventListener("before_fold",function(){g=!1,P()}),d.addEventListener("before_fold",function(){x=!1,P()}),this.$shareParam){var w=this.$shareParam.uid,y=(this.$shareParam.url,this._panoContext.getMarkerUidInBestPano());this.$shareParam.busLineUid&&(this._busLineUid=this.$shareParam.busLineUid),y?this.setData(y,!0,!0,y,null,!0):this.setData(w,!0,!0)}else a&&t&&this.setData(a,!0,!0,a,p,!0)}catch(k){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:k.message||k.description,path:"common:widget/pano/module/PoiInfoPanelModule/PoiInfoPanelModule.js",ln:505})}},foldAllPanel:function(){return this.foldDetail().foldList(),this},foldDetail:function(){return this.infoPanel.fold(),this},expandDetail:function(i){this.infoPanel.expand(i)},foldList:function(){return this.listPanel.fold(),this},freeze:function(){return this.infoPanel.ignoreMouseEvent(!0),this.listPanel.ignoreMouseEvent(!0),this},unfreeze:function(){return this.infoPanel.ignoreMouseEvent(!1),this.listPanel.ignoreMouseEvent(!1),this},setData:function(i,o,a,t,e){var n,p,s=i instanceof PanoPoi?i:new PanoPoi(i);void 0===e&&(e=!0),o&&(n=this._busLineUid?this.updateBusLineListInfo(this._busLineUid,this._busLineCityCode):this.updatePoiListInfo()),p=this.updatePoiDetailInfo(s);var r=[];p&&r.push(p),n&&r.push(n);var l=T.when.apply(T,r),_=this;return l.then(function(){if(_._data.list){var o="";o=_._data.list.buslineName?'<a class="list_title_text busline_title_icon" href="javascript:void(0);">'+_._data.list.buslineName+'</a><div class="v-line"></div>':'<a class="list_title_text" href="javascript:void(0);">列表</a><div class="v-line"></div>',_.listPanel.setTitle(o)}else _.infoButton.className="info-title-bar-nolist",_.infoPanel.setAlign("top");var n=document.createElement("p");if(n.innerHTML='<i class="poi_default_icon"></i>'+s.poi.name,n.className="poi_title_text",_.infoPanel.setTitle(n),s.getUid()===t&&_.savePoiInfo(),_.unfreeze(),_.listPanel.fold(!0),e&&_.infoPanel.expand(2500),a&&_._data.list){var p=void 0;util.each(_._data.list.content,function(o,a){return o.getUid()===i?(p=a,!0):void 0})}})},updatePoiDetailInfo:function(i){var o=this;this._data.poi=i;var a=i.extend(PanoPoi.TYPE.pano,PanoPoi.TYPE.poi).then(function(){return"hotel"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==i.poi.src?i.extend(PanoPoi.TYPE.hotel):"life"http://webmap1.map.bdstatic.com/newmap/static/common/pkg/==i.poi.src?i.extend(PanoPoi.TYPE.movie):void 0});return a.then(function(){var a=POI_DETAIL_TEMPLATE({panoPoi:i});o.infoPanel.setContent(a,getPanelMaxHeight()),o.infoPanel.fold(!0),o.dispatchEvent("poi_change",{uid:i.getUid(),x:i.pano.x,y:i.pano.y})})},setDetailContent:function(i,o){if(i){var a=document.createElement("p");a.innerHTML='<i class="poi_default_icon"></i>'+i,a.className="poi_title_text",this.infoPanel.setTitle(a)}var t=POI_DETAIL_TEMPLATE({panoPoi:o});this.infoPanel.setContent(t,getPanelMaxHeight())},restorePoiInfo:function(){function i(i){for(var o=0,a=i.length;a>o;o++)for(var t in PanoPoi.prototype)i[o][t]=PanoPoi.prototype[t]}this._data=baidu.object.clone(this._saveData),this._data&&this._data.poi&&i([this._data.poi]),this._data&&this._data.list&&this._data.list.content&&i(this._data.list.content),this.infoPanel.restore(),this._data.poi||!this._data.list||this._data.list.content||this.hide()},savePoiInfo:function(){this._saveData=baidu.object.clone(this._data),this._saveData||(this._saveData={poi:void 0,list:void 0,listUrl:void 0}),this.infoPanel.save()},updatePoiListInfo:function(i,o){var a=this,t=o?util.getSearchResultFromUrl(i):util.getSearchResultFromPCMap(i);if(!t)return null;var e=t.then(function(i,o){if(i.content&&!(i.content.length<=1)){var t=PanoPoi.initWithPoiSearchResult(i);a._data.list=t,a._data.listUrl=o;var e=POI_LIST_TEMPLATE({panoPoiList:t});a.listPanel.setContent(e,getPanelMaxHeight())}});return e},updateBusLineListInfo:function(i,o){var a=new PanoPoi(i,o),t=this,e=a.extend(PanoPoi.TYPE.busline).then(function(){var i=PanoPoi.initWithBuslineResult(a.busline);t._data.list=i;var o=BUSLINE_TEMPLATE({poiList:i.content}),e=a.busline.buslineFullName.split("(")[1].split(")")[0],n='<p class="pano_popup_title">'+a.busline.buslineName+"(<span>"+e+"</span>)</p>";t.listPanel.setContentHeader(n),t.listPanel.setContent(o,getPanelMaxHeight())});return e},setSelect:function(i){if(this._data.list){var o=this._data.list.content[i];if(o){var a=this;PanoPoi.prototype.extend.call(o,PanoPoi.TYPE.poi,PanoPoi.TYPE.pano).then(function(){panoPoiIndex=void 0!==o.pano.index?o.pano.index:i;var t={poiuid:o.poi.uid,pid:o.pano.pid,panoIId:o.pano.iid,name:o.poi.name,poiType:o.pano.belonging?"interPoi":"poi",index:panoPoiIndex,heading:o.pano.dir,pitch:o.pano.pitch,x:o.pano.x,y:o.pano.y,px:o.pano.panox,py:o.pano.panoy,rank:o.pano.rank||100,catalog:o.pano.catalog};a._removePoiSearchMarker(),a._addPoiSearchMarker([t])})}}},_addPoiSearchMarker:function(i){var o=this;o._markerIds=[],util.each(i,function(i){i.markerId=util.getUniqueId("MARKER_"),o._markerIds.push(i.markerId)}),this.dispatchEvent("add_markers",i),this.dispatchEvent("poi_search_marker_changed",i)},_removePoiSearchMarker:function(){this._markerIds&&this._markerIds.length&&(this.dispatchEvent("remove_markers",this._markerIds),this._markerIds=null)},show:function(){return this.parentDom.style.visibility="visible",this
},hide:function(){return this.parentDom.style.visibility="hidden",this},getShareParam:function(){if(!this._data.poi)return null;var i=this._panoContext.getPanoOptions(),o=i.panoId,a=this._data.poi.pano.pid;if(o!==a)return null;var t=this._data.poi.getUid(),e={uid:t};return this._busLineUid&&(e.busLineUid=this._busLineUid),e},getDetailPanoPoi:function(){return this._data.poi},dispose:function(){this.infoPanel.dispose(),this._busLineUid=void 0,this._busLineCityCode=void 0;var i=this.parentDom;i.innerHTML="",i.parentNode.removeChild(i)},getSupportEvents:function(){return["pano_changed","animate_pano_changed","show_position","hide_position","poi_search_marker_changed","remove_markers","add_markers","status_changed","inter_poi_changed","add_search_marker","poi_change"]}});module.exports=PoiInfoPanelModule});
;define("common:widget/pano/module/PanoActivityModule/PanoActivityModule.js",function(t,i,o){var n=t("common:widget/pano/base/ModuleClass.js"),e=t("common:widget/pano/base/service.js"),a=n.extend("PanoActivityModule",{initialize:function(t){try{this._panoContext=t,this._createActivityIcon();var i=e.getActivityPano(),o=this;i.then(function(t){o._activityPanoList=t,o.updateActivityIcon()})}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoActivityModule/PanoActivityModule.js",ln:21})}},_createActivityIcon:function(){var t=T.dom.create("div",{id:"panoActivityIcon","class":"panoActivityIcon"});T.g("pano-expand-wrapper").appendChild(t);var i=this;T.on(t,"click",function(){var t=i._panoContext.getPanoOptions(),o=t.panoId;i._showLottery(o)}),this._activityIcon=t},updateActivityIcon:function(){for(var t=this._panoContext,i=t.getPanoOptions(),o=i.panoId,n=this._activityPanoList.length-1;n>=0;n--)if(this._activityPanoList[n].panoId===o)return void this._show();this._hide()},_show:function(){this._activityIcon.style.display="block"},_hide:function(){this._activityIcon.style.display="none"},dispose:function(){this._panoContext=null,this._activityIcon.parentNode.removeChild(this._activityIcon),this._activityIcon=null,this._activityPanoList=null},_showLottery:function(t){var i=T.dom.create("iframe");i.id="panoActivity",i.setAttribute("allowTransparency","true"),i.className="pano_lottery",i.style.height=document.body.scrollHeight+"px",i.src="http://map.baidu.com/zt/qjyzn/pcLottery.html#"+t,document.body.appendChild(i)}});window.hideLottery=function(){var t=document.getElementById("panoActivity");document.body.removeChild(t)},o.exports=a});
;define("common:widget/pano/eventImplements.js",function(o,e,a){var n,t,r,i,d,l=o("common:widget/pano/base/MapContext.js"),u=o("common:widget/pano/base/PanoContext.js"),s=o("common:widget/pano/module/PanoShareModule/PanoShareModule.js"),p=(o("common:widget/pano/base/service.js"),o("common:widget/pano/module/PanoModule/PanoModule.js")),g=o("common:widget/pano/module/PanoToolModule/PanoToolModule.js"),P=o("common:widget/pano/module/PanoOverviewModule/PanoOverviewModule.js"),M=o("common:widget/pano/module/PanoGuideModule/PanoGuideModule.js"),c=o("common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js"),f=o("common:widget/pano/module/PanoCopyrightModule/PanoCopyrightModule.js"),v=o("common:widget/pano/module/PoiInfoPanelModule/PoiInfoPanelModule.js"),h=o("common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js"),m=(o("common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js"),o("common:widget/ui/indexUtil/IndexUtil.js"),o("common:widget/pano/model/PanoPoi.js")),y=o("common:widget/pano/base/util.js"),_=o("common:widget/pano/module/PanoLoading/PanoLoading.js"),C=o("common:widget/pano/Transition/Transition.js"),w=o("common:widget/pano/module/PanoShareModule/PanoShareUtil.js"),x=o("common:widget/com/componentManager.js"),I=null,b=1e4,S=function(e,a,n){Z.root.isEnterFromShareLink()&&(a=16);var t=e.currentPoint?new BMap.Point(e.currentPoint.x,e.currentPoint.y):new BMap.Point(e.panoMCPoint.x,e.panoMCPoint.y),r=m.getInstaceByPanoId(e.panoId);r&&(e.uid=r.getUid());var i=Z.root.getModule("PanoIndoorPoiModule");i&&"inter"==e.panoType&&(e.uid=i.getCurrentUid()),window.panoExitMarker?(window.panoExitMarker.show(e,t,a),n&&window.panoExitMarker.set("from",n)):o.async("common:widget/pano/module/PanoExitMarker/PanoExitMarker.js",function(o){var r=new o;r.initialize(e,t,a),window.panoExitMarker=r,n&&window.panoExitMarker.set("from",n)})},k=function(o,e){var a=Z.root.getModule("TrafficModule");L(),n.getCurrentCity(function(t){if(t)if(t.cityId!=n.getPCMapCity().cityId)x.go("cur&wd="+encodeURIComponent(t.cityName),{cinfo:{isFromPano:!0},onload:function(){S(o,e)}});else if(a){var r=null;a.isNav()?r="nav":a.isBus()?r="bus":a.isWalk()&&(r="walk"),S(o,e,r)}else S(o,e)})},O=!1,E=0,V=null,N=null,j=null,U={},A=function(o){U[o.type]?(o.source=U[o.type],U[o.type]=null):o.source="PanoModule"},R=function(o){var e=Z.root.getModule("PanoCopyrightModule"),a=r.getModuleContainer("PanoCopyrightModule");o.panoCopyright&&e&&("inter"===o.panoType?(e.render(a,o),B({uid:null,x:o.panoMCPoint.x,y:o.panoMCPoint.y})):n.getCurrentCity(function(n){n&&(o.panoCopyright.roadName=n.cityName+o.panoCopyright.roadName),e.render(a,o),B({uid:null,x:o.panoMCPoint.x,y:o.panoMCPoint.y})}))},B=function(o){function e(o,e){var a=T.g(o);e||!a?setTimeout(function(){a=T.g(o),a&&a.setAttribute("href",i)},1e3):a.setAttribute("href",i)}if(!o.uid){var a=Z.root.getModule("PanoModule").getPanoOptions();if("inter"==a.panoType){var n=Z.root.getModule("PanoIndoorPoiModule");n&&(o.uid=n.getCurrentUid())}else{var n=Z.root.getModule("PoiInfoPanelModule");if(n){var t=n.getDetailPanoPoi();t&&(o.uid=t.uid)}}}var r={uid:o.uid||"",location:o.x+","+o.y,from:"pcmap"},i=y.getUgcUploadUrl(r);e("pano-upload-link"),e("ugc-upload-item",!0),e("tool-ugc-upload")},D=function(){if(j!=location.hash){if("synchronise"==d)return void(d=null);var o=y.parseUrlParam(location.hash);if(o&&o.panoid&&o.panotype){var e=y.revertStreetView(o);e.panoShareParam&&(e.panoShareParam=decodeURIComponent(e.panoShareParam)),Z.showPano(null,e)}}},L=function(){function o(){var o=Z.root.getModule("PanoModule"),e=Z.root.getModule("PanoOverviewModule"),a={},t=[];if(o&&o.getPanoOptions()){a.data=o.getPanoOptions()||{},e&&(a.iid=e.getInnerId()),a.shareParam=Z.root.getShareParam(),a.level=n.getLevel();var r=w.prepareShareParam(a);for(var i in r)null!=r[i]&&t.push(i+"="+r[i]);j=t.join("&");var l=window.location;if("#"+j!=l.hash)if(d="synchronise",y.isSupportPushStatus()){var u="?"+j;history.replaceState({},0,u)}else l.hash=j}else y.isSupportPushStatus()&&history.replaceState({},0,location.pathname)}N&&clearTimeout(N),N=setTimeout(function(){o()},500)},F={_mask:null,_timouter:null,_init:function(){if(!this._mask){var o=this._mask=document.createElement("div");o.style.cssText=["top:0","left:0","position:absolute","width:100%","height:100%","background-color:black","filter:alpha(opacity=0)","opacity:0","z-index:200001"].join(";")}},dispose:function(){this._mask.parentNode.removeChild(this._mask),this._mask=null},show:function(){this._mask||F._init();var o=document.getElementById("pano-container");o.appendChild(this._mask),this._timouter=setTimeout(function(){F.hide()},8e3)},hide:function(){this._mask&&(null!==this._timouter&&clearTimeout(this._timouter),this._mask.parentNode&&this._mask.parentNode.removeChild(this._mask))}},z=void 0,G=void 0,H=!1,Y=void 0,W=[],Z={_initialize:function(){try{var o=Z.root.getModule();n=new l(o),t=new u(o),y.offHashChange(),y.onHashChange(D)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/eventImplements.js",ln:355})}},showPano:function(o,e){var a=e.panoType;if(z=e.uid||e.poiUid,e.playRouteVideo&&(E=1),e.research===!0){var i=e.searchParam.uid,d=(e.searchParam.index,new m(i));return void d.extend(m.TYPE.pano).then(function(){var o=d.pano,n=void 0,t=e.searchParam.index;n=[{poiuid:i,pid:o.pid,panoIId:o.iid,poiType:o.belonging?"interPoi":"poi",name:o.name,index:void 0!==t?t:-1,heading:o.dir,pitch:o.pitch,x:o.x,y:o.y,px:o.panox,py:o.panoy,rank:o.rank||100,catalog:o.catalog}],o.belonging&&(G=i),Z.showPano(null,{panoMarkers:n,panoId:"street"==a?o.pid:o.belonging?o.pid:void 0,panoIId:"inter"==a?o.iid:void 0,uid:i,panoType:a,point:new BMap.Point(o.x/100,o.y/100),panoHeading:"inter"===a?void 0:o.dir,panoPitch:o.pitch})})}e.panoShareParam&&e.panoShareParam.PanoIndoorPoiModule&&"inter"==e.panoType&&(G=e.panoShareParam.PanoIndoorPoiModule.uid),r||(r=new c,r.initialize(Z.root.getModule(),document.body));var l=r.getModuleContainer("PanoModule"),u=t.getPanoUrlConfig(),s=[{module:p,args:[l,u,n]}],g=e.from;("nav"===g||"bus"===g||"walk"===g||"buswalk"===g||"share"===g)&&s.push({module:"TrafficModule",args:[g,e.panoShareParam,null,r.getModuleContainer("ui-layer"),[e],E]}),e.panoShareParam&&e.panoShareParam.VideoPlayer&&(Y=e.panoShareParam.VideoPlayer),e.panoShareParam&&e.panoShareParam.VideoPlayer&&y.isSupportVideo()&&s.push({module:"VideoPlayer",args:[e.panoShareParam.VideoPlayer]});var P=Z.root.bootstrap(s);P.then(function(){var o=Z.root.getModule("TrafficModule");if("share"!==g&&o&&o.isEnable()){var a=o.getClosestPoint(e.panoId,e.point.lat,e.point.lng);a&&(e.panoId=a.pid,e.point.lat=a.y,e.point.lng=a.x,e.panoHeading=a.dir),e.panoMarkers=[]}Z.root.getModule("PanoModule").showPano(e),r.getModuleContainer("PanoRoot").style.visibility="visible"})},closePano:function(){Z.root.shutdown(),r.getModuleContainer("PanoModule").innerHTML="",r.getModuleContainer("PanoRoot").style.visibility="hidden",r.dispose(),r=null,z=null,G=null,y.stopClock("panoVideoPlayTime"),location.hash="",y.offHashChange()},"PanoModule:pov_changed":function(o){A(o);var e=Z.root.getModule("PanoOverviewModule");e&&e.event_povChanged(o),L()},"PanoModule:zoom_changed":function(o){A(o);var e=Z.root.getModule("PanoToolModule");e&&e.updateFishBone(o.data),L()},"PanoModule:visible_changed":function(o){if(0==o.data.visible){var e=n.getOverviewLevel();o.data.panoOptions&&k(o.data.panoOptions,e),Z.closePano(),I=void 0,E=0}},"PanoModule:indoor_enter":function(o){var e,a=o.data.hasImage,t=!1;G?(e=G,G=null,H=!0,t=!0):e=o.data.poiuid;var i=new m(e);i.extend(m.TYPE.indoorPoi,m.TYPE.pano).then(function(){if(i.indoorPoi){var o=Z.root.getModule("PanoModule"),n=o.getPanoOptions();if(!n||"street"!==n.panoType){Z.root.safeCall("PoiInfoPanelModule","hide");var t=Z.root.getModule("PanoIndoorPoiModule");t?t.event_poi_change(i,e):Z.root.bootstrap({module:"PanoIndoorPoiModule",args:[r.getModuleContainer("PanoIndoorPoiModule"),i.indoorPoi,a,e]})}}}),Z.root.safeCall("PanoOverviewModule","event_indoorEnter",[o]),Z.root.safeCall("PanoToolModule","setClassifySearchVisible",[!1]);var d=Z.root.getModule("PanoGuideModule"),l=Z.root.getModule("TrafficModule"),u=Z.root.getModule("PanoOverviewModule");l&&d&&(l.setHeaderVisible(!1),r.resetFuncAreaModule(d),u&&u.floorWrapper&&r.restoreFuncAreaDoms([u.floorWrapper])),n.getCurrentCity(function(o){addStat(STAT_CODE.STAT_PANORAMA,{item:"indoorview-enter",cityname:o.cityName})})},indoor_exit:function(o,e){U.pano_changed=null,Z.root.shutdown("PanoIndoorPoiModule");var a=e.pano_change_dispatcher,n=Z.root.getModule("PoiInfoPanelModule");if("returnButton"==a)n&&(n.show(),n.expandDetail(2e3),i=e.data.uid);else if("PanoOverviewModule"!=a||z){var t=new m(e.data.uid);t.extend(m.TYPE.pano).then(function(){n&&(i=e.data.uid,z?H?(n.setData(t,!0,!0,I||i,!0),H=!1):n.setData(t,!0,!0,I||z,!0):n.setData(t,!1,!1,I,!0),n.show())})}else n.hide();var d=Z.root.getModule("PanoGuideModule"),l=Z.root.getModule("TrafficModule");l&&d&&l.isEnable()?(l.setHeaderVisible(!0),r.resetFuncAreaModule(l)):Z.root.safeCall("PanoToolModule","setClassifySearchVisible",[!0]),Z.root.safeCall("PanoOverviewModule","event_exitIndoor",[o])},"PanoModule:indoor_plan_id_changed":function(o){var e=Z.root.getModule("PanoOverviewModule");e&&e.event_indoorIdChanged(o)},"PanoModule:indoor_floor_changed":function(o){var e=Z.root.getModule("PanoOverviewModule");e&&e.event_floorChanged(o)},after_pano_changed:function(o,e){var a=Z.root.getModule("PanoModule"),n=a.getPanoCopyright(),t=a.getPanoTimeline();if(n){n.roadName}A(o),Z.root.shutdown("PanoMessageBox"),R(e.data);var r=e.pano_change_dispatcher,i=Z.root.getModule("PanoOverviewModule");if(i)if("inter"!==e.data.panoType){i.event_panoChanged(o);var d=Z.root.getModule("TrafficModule");d&&!d.isNav()&&i.initTrafficLayer()}else i.updateCatalog(e.data.panoId);var l=Z.root.getModule("PanoGuideModule");if(l&&("InterPoi"!=r||"inter"==e.data.panoType&&"street"==e.last_data.panoType)&&l.update(o.data.panoId,o.data.floor,e.last_data.panoType,e.data.panoType,r,t),"inter"==e.data.panoType&&"InterPoi"!=r){Z.root.safeCall("PoiInfoPanelModule","hide");var u=Z.root.getModule("PanoIndoorPoiModule");if(u){var s=Z.root.getModule("PanoModule"),p=s.getPanoIndoorData();if(u.getCurrentUid()!=p.poiuid){var g=new m(p.poiuid);g.extend(m.TYPE.indoorPoi).then(function(){u.event_poi_change(g,p.poiuid)})}}}Z.root.safeCall("TrafficModule","event_panoChanged",[o.data.panoId]),Z.root.safeCall("ClassifySearchModule","updateClassifySearch"),L()},deselect_poi:function(){return i?void(i=null):void Z.root.safeCall("PoiInfoPanelModule","restorePoiInfo")},"PanoModule:pano_error":function(o){var e="",a="";switch(o.data){case"IO_ERROR":e="网络异常，请重新加载!",a="error";break;case"NO_PANO":e="抱歉, 该地方没有全景";break;case"OUTOF_RANGE":e="您已超出导航路线",a="alert";break;default:e="抱歉错误了，请重新加载!",a="error"}F.hide(),Z.root.bootstrap({module:"PanoMessageBox",args:[{container:r.getModuleContainer("PanoMessageBoxModule"),data:{info:e,funtype:a}}]})},"PanoModule:pano_player_error":function(){var o="抱歉错误了，请重新加载",e="error";F.hide(),Z.root.bootstrap({module:"PanoMessageBox",args:[{container:r.getModuleContainer("PanoMessageBoxModule"),data:{info:o,funtype:e}}]})},after_go_to_poi:function(o,e){if(A(o),e.id){var a=e.id,n=new m(a);n.extend(m.TYPE.pano,m.TYPE.indoorPoi).then(function(){var o=Z.root.getModule("PanoGuideModule").getSelectAlbumItem(),e=Z.root.getModule("PanoModule").getPanoOptions();if(o&&o.data.uid===a&&"inter"!=e.panoType?Z.root.getModule("PanoModule").drawLineToPoint(o.data.uid,o.pos.x,o.pos.y,n.pano.x,n.pano.y,n.pano.rank,function(){F.hide()}):F.hide(),"inter"==e.panoType){var t=Z.root.getModule("PanoIndoorPoiModule");t&&t.event_poi_change(n,a)}else{var r=Z.root.getModule("PoiInfoPanelModule");r&&(r.setData(n,z?!0:!1,!0,I,!0),r.show())}L()})}else F.hide()},once_tiles_complete:function(){C.close();var o=Z.root.getModule("PanoModule"),e=o.getPanoOptions(),a=o.getPanoIndoorData(),i=o.getPanoTimeline();e&&(e.panoCopyright=o.getPanoCopyright());var d="street"===e.panoType,l=y.createTask({timeout:1e4});!d&&a&&(a.currentPid=e.panoId);var u=function(){return Z.root.bootstrap({module:P,args:[{context:{mapContext:n,panoContext:t},parent:r.getModuleContainer("PanoOverviewModule"),isStreet:d,data:d?e:a,indoorModel:o.getIndoorModel(),zIndex:b+10,level:Z.root.isEnterFromShareLink()?16:window.map.getZoom()}]})},s=function(){Z.root.bootstrap({module:f,args:[]});var o=new T.Deferred;return"inter"===e.panoType?(Z.root.getModule("PanoCopyrightModule").render(r.getModuleContainer("PanoCopyrightModule"),e),o.resolve()):n.getCurrentCity(function(a){a&&(e.panoCopyright.roadName=a.cityName+e.panoCopyright.roadName),Z.root.getModule("PanoCopyrightModule")&&Z.root.getModule("PanoCopyrightModule").render(r.getModuleContainer("PanoCopyrightModule"),e),o.resolve()}),o};if(1==E)return l.add(u).add(s).start().then(function(){var o=Z.root.getModule("PanoOverviewModule");o&&o.event_disable(),o.initTrafficLayer()}),void T("#pano-return-btn em").text("退出");var p,c,h=function(){return Z.root.bootstrap({module:g,args:[r.getModuleContainer("PanoToolModule")]})},m=function(){return Z.root.bootstrap({module:M,args:[r.getModuleContainer("PanoGuideModule"),{albumImageDomain:t.getPanoUrlConfig().PANO_3DIMAGE_URL,data:e,zIndex:b+10,timeThroughData:i}]})},w=n.getPCMapCity().cityId,x=y.getBusLineInfoFromPCMap(e.panoMCPoint.x,e.panoMCPoint.y),I=!0;x&&(p=x.buslineUid,c=x.closestBusStationUid),z||(I=!1,z=c);var S=function(){Z.root.bootstrap({module:v,args:[r.getModuleContainer("ui-layer"),t,z,d,p,w,I]})},k=Z.root.getModule("TrafficModule");if(k&&k.isEnable()){var O=Z.root.getModule("PanoModule"),V=k.getRoutParam();V&&O.setRoutParam(baidu.json.stringify(V)),O.enableShareMarker(!1),l.add(u).add(s).add(h).add(function(){k.show();var o=Z.root.getModule("PanoOverviewModule");if(k.isBus()||k.isWalk())o.initTrafficLayer();else if(k.isNav()){var e=k.getRoutPoints();o.drawLine(e,3),e=k.getMarkers(),o.addMarkers(e)}d&&r.resetFuncAreaModule(k)}),l.add(d?function(){k.setHeaderVisible(!0),Z.root.bootstrap({module:M,args:[null,{albumImageDomain:t.getPanoUrlConfig().PANO_3DIMAGE_URL,data:{},zIndex:b+10}]})}:function(){return k.setHeaderVisible(!1),m()})}else l.add(u).add(s).add(h).add(m).add(S).add(function(){d&&Z.root.safeCall("PanoToolModule","setClassifySearchVisible",[!0])});if(void 0!==Y){if(y.isSupportVideo()){var N=Y;l.add(function(){Z.root.bootstrap({module:"VideoPlayer",args:[N]})})}else l.add(function(){Z.root.bootstrap({module:"PanoMessageBox",args:[{container:r.getModuleContainer("PanoMessageBoxModule"),data:{info:"您的浏览器版本过低或无法兼容，暂不支持此功能。",funtype:"alert"}}]})});Y=void 0}var j=l.start();j.then(function(){if(W&&W.length>0){var o=W[0],a=Z.root.getModule("PanoOverviewModule");a&&a.addSearchMarker(o.x,o.y,o.name),W=null}var n=z,t=Z.root.getModule("PanoIndoorPoiModule");"inter"==e.panoType&&t&&(n=t.getCurrentUid()),n&&B({uid:n,x:e.panoMCPoint.x,y:e.panoMCPoint.y}),L()}),_.removeMask()},pov_changed:function(o){"PanoModule"!=o.target.getName()&&(Z.root.getModule("PanoModule").setPov(o.data),L())},pano_changed:function(o){"PanoModule"!=o.target.getName()&&(U.pano_changed=o.data.source,o.data.eventSource="external",Z.root.getModule("PanoModule").showPano(o.data,null,o.from),Z.root.safeCall("PoiInfoPanelModule","foldAllPanel"))},inter_poi_changed:function(o){"PoiInfoPanelModule"==o.data.source&&(G=o.data.uid);var e=new m(o.data.uid);e.extend(m.TYPE.indoorPoi).then(function(){var a=Z.root.getModule("PanoIndoorPoiModule");a&&a.event_poi_change(e,o.data.uid)}),U.pano_changed=o.data.source,o.data.eventSource="external",Z.root.getModule("PanoModule").showPano(o.data,null,"InterPoi")},photo_tour_enter:function(e){o.async("common:widget/pano/PhotoTour/PhotoTourMain.js",function(o){var a=new o(e.data.tourId);a.addEventListener("dispose",function(){Z.photo_tour_exit(),a=null})}),r.hide(),Z.root.safeCall("PoiInfoPanelModule","hide"),Z.root.safeCall("PanoOverviewModule","hide"),Z.root.safeCall("PanoToolModule","setItemsEnable",[[!1,!0,!1,!1]]),Z.root.getModule("PanoModule").setVisibility(!1)},photo_tour_exit:function(){Z.root.getModule("PanoModule").setVisibility(!0),r.show(),Z.root.safeCall("PanoToolModule","setItemsEnable",[[!0,!0,!0,!0]]),Z.root.safeCall("PoiInfoPanelModule","show"),Z.root.safeCall("PanoOverviewModule","show")},animate_pano_changed:function(o){var e=Z.root.getModule("PanoModule"),a=e.getPanoOptions();"street"==a.panoType?o.data.source="PanoStreet":(o.from="PanoInterPoi",o.data.source="PanoInterPoi"),U.pano_changed=o.data.source,U.after_go_to_poi=o.data.source,o.data.eventSource="external",F.show();var n=Z.root.getModule("PoiInfoPanelModule");if(n){var t=n.getDetailPanoPoi();t&&t.getUid()==o.data.uid||n.foldDetail()}e.showPano(o.data,!0,o.from)},zoom_changed:function(o){"PanoModule"!=o.target.getName()&&(o.data.eventSource="external",Z.root.getModule("PanoModule").setZoom(o.data))},layout_changed:function(o,e){r.event_layoutChanged(o.target.getName(),e.display)},floor_changed:function(o){"PanoModule"!=o.target.getName()&&(U.pano_changed=o.data.source,o.data.eventSource="external",Z.root.getModule("PanoModule").showPano(o.data,null,o.from))},close_pano:function(){Z.root.getModule("PanoModule").closePano()},show_position:function(o){var e=Z.root.getModule("PanoOverviewModule");e&&e.event_showPosition(o.data.x,o.data.y)},hide_position:function(){var o=Z.root.getModule("PanoOverviewModule");o&&o.event_hidePosition()},interface_ready:function(){if(1==E){var o=Z.root.getModule("TrafficModule"),e=o.getSteps();y.getRouteVideoParamFromPCMap(e).then(function(o){Z.root.getModule("PanoModule").playRouteVideo(E,o)})}},play_routeVideo:function(){E=2;var o=Z.root.getModule("PanoOverviewModule");o&&(V=o.getCurrentPointInfo(),V.panoType="street");var e=Z.root.getModule("TrafficModule"),a=e.getSteps();y.getRouteVideoParamFromPCMap(a).then(function(o){Z.root.getModule("PanoModule").playRouteVideo(E,o),r.event_layoutChanged("PanoGuideModule",!1),r.event_layoutChanged("TrafficModule",!1),r.event_layoutToggle("PanoToolModule",!1),r.event_layoutToggle("TrafficModule",!1),r.event_layoutToggle("RouteVideoModule",!1);var e=Z.root.getModule("PanoOverviewModule");e&&e.event_disable(),T("#pano-return-btn em").text("退出")})},routeVideo_exit:function(){function o(){r.event_layoutToggle("TrafficModule",!0),r.event_layoutToggle("PanoToolModule",!0),r.event_layoutChanged("TrafficModule",!0);var o=Z.root.getModule("PanoOverviewModule");o&&(o.event_panoChanged({data:V}),o&&o.event_enable())}E=0,T("#pano-return-btn em").text("返回"),Z.root.getModule("PanoModule").closeRouteVideo(),setTimeout(o,800)},routeVideo_pano_changed:function(o){var e=Z.root.getModule("PanoOverviewModule");e&&e.event_panoChanged(o)},tool_share_pano:function(o){var e=Z.root.getModule("PanoShareModule");if(!e){var a=Z.root.getShareParam();Z.root.bootstrap({module:s,args:[{context:{mapContext:n,panoContext:t},parent:r.getModuleContainer("PanoToolModule"),data:o.data,zIndex:b+10,shareParam:a}]})}addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-share-click"})},classify_search_panel_visible:function(o){var e=Z.root.getModule("ClassifySearchModule"),a=o.data;e||Z.root.bootstrap({module:h,args:[r.getModuleContainer("PanoToolModule"),a,t]})},remove_markers:function(o,e){Z.root.getModule("PanoModule").removeMarkers(e)},poi_change:function(o,e){var a=Z.root.getModule("PanoModule").getPanoOptions();if(a){var n=e.getUid?e.getUid():e.uid,t=e.pano?e.pano.x:a.panoMCPoint.x,r=e.pano?e.pano.y:a.panoMCPoint.y,i={uid:n,x:t,y:r};B(i)}},add_markers:function(o,e){Z.root.getModule("PanoModule").addMarkers(e)},add_search_marker:function(o){if(o.markers&&o.markers.length>0){var e=Z.root.getModule("PanoOverviewModule");if(e){var a=o.markers[0];e.addSearchMarker(a.x,a.y,a.name)}else W=o.markers}},remove_search_marker:function(){var o=Z.root.getModule("PanoOverviewModule");o&&o.removeSearchMarker()},poi_search_marker_changed:function(o,e){Z.root.getModule("PanoModule").removePanoModuleMarker(),I=e[0].poiuid;var a=e[0],n=Z.root.getModule("PanoOverviewModule");n&&n.addSearchMarker(a.x,a.y,a.name)},"PoiInfoPanelModule:status_changed":function(o,e){var a=e.isExpand,n=Z.root.getModule("PanoOverviewModule");if(n)if(a===!0&&n.isLocked())O=!0,n.unlock(),n.fold();else if(a===!1&&!n.isExpand())return},clear_marker:function(){Z.root.getModule("PanoModule").clearMarker()},dispose:function(o){Z.root.shutdown(o.target)},video_enter:function(o){var e=o.data;if(y.isSupportVideo()){var a=Z.root.getModule("VideoPlayer");a?a.play(e.uid):(Z.root.bootstrap({module:"VideoPlayer",args:[e.uid]}),L())}else Z.root.bootstrap({module:"PanoMessageBox",args:[{container:r.getModuleContainer("PanoMessageBoxModule"),data:{info:"您的浏览器版本过低或无法兼容，暂不支持此功能。",funtype:"alert"}}]})},"PanoShareModule:dispose":function(){Z.root.safeCall("VideoPlayer","onShareClose")},"VideoPlayer:dispose":function(){L()},share_video:function(o,e){var a=Z.root.getModule("PanoShareModule");if(!a){var r=Z.root.getShareParam();Z.root.bootstrap({module:s,args:[{context:{mapContext:n,panoContext:t},parent:e.container,data:o.data,zIndex:b+10,shareParam:r,sharePanelClassName:e.sharePanelClassName}]})}}};a.exports=Z});