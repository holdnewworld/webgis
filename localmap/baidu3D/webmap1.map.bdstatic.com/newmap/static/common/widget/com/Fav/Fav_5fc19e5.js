define("common:widget/com/Fav/Fav.js",function(require,exports,module){function judge_CN(a,t){for(var e=charPYStr,n=0;n<(a.length>t.length?a.length:t.length);n++)if(a.charAt(n)!=t.charAt(n))return e.indexOf(a.charAt(n))>e.indexOf(t.charAt(n))?1:-1;return 0}function sortByChinese(opts){return opts=opts||{},sortMod?function(a,t){var e=a.data.name||a.data.pathname,n=t.data.name||t.data.pathname;return e.localeCompare(n)}:function(obj_a,obj_b){var flag,a=(obj_a.data.name||obj_a.data.pathname)[0],b=(obj_b.data.name||obj_b.data.pathname)[0];return/^(\+|-)?\d+($|\.\d+$)/.test(a)&&/^(\+|-)?\d+($|\.\d+$)/.test(b)?(a=eval(a),b=eval(b),flag=a>b?1:b>a?-1:0):(a=a.toString(),b=b.toString(),flag=a.charCodeAt(0)>=19968&&b.charCodeAt(0)>=19968?judge_CN(a,b):a>b?1:b>a?-1:0),flag}}function sortData(a,t){switch(t){case 1:return a.sort(function(a,t){var e=a.create_time||" ",n=t.create_time||" ";return n.localeCompare(e)});case 2:return sortByChinese?a.sort(sortByChinese()):a}return a}function _defText(){try{var a=[];a.push(0==UserMgr.userState.isOnline?'<div class="fav_tip_box"><p>收藏内容可同步到云端，电脑、手机、平板随时都能查看啦！现在就<a  href="https://passport.baidu.com/v2/?login&tpl=ma" id="loginFav" >登录</a>试试看~<br /></p></div>':'<div class="fav_tip_box"><p>您还没有收藏呢。</p><p>现在收藏内容可同步保存到云端，电脑、手机、平板随时都能查看哟！<br /></p></div>'),a.push("<div class=\"fav_helpBg01\"><div>点击小星星收藏地点,自动保存云端！<a href=\"javascript:void(0);\" onclick=\"addStat('poilistnormal.poi.favouritebtn');PcToMobile.open('IMG', '收藏栏');\">百度手机地图</a>还能收藏路线噢~</div></div>"),a.push('<div class="fav_helpBg02"><div>登录后，不论电脑还是手机，随时随地查看收藏，毫无鸭梨！</div></div>'),BoxContainer.setTitle("收藏夹"),BoxContainer.setContent(a.join(""))}catch(t){}baidu("#loginFav").on("click",function(a){UserMgr.login(),a.preventDefault()})}function setTabItem(a){var t=a.dom.parentNode,e=a.dom.tagName,n=t.getElementsByTagName(e);baidu.dom.hasClass(a.dom,"on")||(baidu.rc(n[setTabItem[a.mid]],"on"),baidu.ac(a.dom,"on"),t.className=a.mid+a.num,setTabItem[a.mid]=a.num,a.nameSpace[a.mid](a))}function Fav(a){window.FavInst=this,BaseComponent.call(this,a),this.type="",this.infoError=0,this.curIndex=-1,this.favPostArr=[],this.pageSize=10,this.current_tab_index=0,this.currentPageIndex=1}var componentManager=require("common:widget/com/componentManager.js"),util=require("common:widget/ui/util/util.js"),UserMgr=require("common:widget/ui/userMgr/userMgr.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),SyncMgr=require("common:widget/ui/SyncMgr/SyncMgr.js"),BaseComponent=require("common:widget/com/BaseComponent.js"),charPYStr=require("common:widget/com/Fav/FavSortPY.js"),sortMod="百度".localeCompare("地图")>1?0:1;T.lang.inherits(Fav,BaseComponent,"Fav"),T.object.extend(Fav.prototype,{render:function(){try{var a=this,t=".favSign{margin-top:10px;padding:0}.fav-sort-tab{width:315px;margin:5px 0;height:21px;line-height:21px;overflow:hidden}.fav-sort-tab a,.fav-sort-tab span{float:right;padding:0 1px 0 6px}.fav-sort-tab span{color:#999}.fav-list-time{height:12px;line-height:12px;padding-left:23px;left:0;color:#B6B4B4;position:absolute;bottom:2px;width:220px}.fav-sort-tab a{cursor:pointer}.fav-sort-tab a.active{color:#000;text-decoration:none;cursor:default}.favSign li p.fav_ico_nav{background-position:6px -108px}.favSign li p.fav_ico_bus{background-position:7px -129px}.favSign li p.fav_ico_walk{background-position:6px -151px}.favSign li p.fav_ico_train{background-position:6px -173px}.favSign li p.fav_ico_plane{background-position:6px -195px}.favSign ul{margin-top:3px;width:315px}.favSign li{height:39px;line-height:39px;position:relative;overflow:hidden;border-bottom:1px solid #e5e5e5;+margin-top:-3px}.favSign li p,.favSign li div.inputCell{font-size:12px;width:260px;_width:255px;color:#68C;cursor:pointer;overflow:hidden;padding-left:23px;height:27px;line-height:27px;overflow-x:hidden;white-space:nowrap;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/sign_1_0b3302e.gif) no-repeat 7px -87px}.favSign li span{padding-right:3px;display:none;height:39px;position:absolute;top:0;right:0}.favSign li.over{background-color:#F2F2F2}.favSign li:hover{background-color:#F2F2F2}.favSign li:hover span{display:block}.favSign li a.favDelBg{display:inline-block;width:12px;height:39px;text-decoration:none;vertical-align:-2px;_vertical-align:-4px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/popup_close_15d2283.gif) no-repeat 0 50%}.favSign .hide{display:none}.favSignBt{text-align:center;padding:5px 0}.favSignBt span{margin:0 5px;cursor:pointer;display:inline-block;width:65px;height:25px;line-height:25px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/bt_7c7d163.png) no-repeat left top}.favSign .userSignTip{width:148px;position:absolute;top:20px;left:18px;z-index:1}.fav_pageBtn{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/bt_7c7d163.png) no-repeat left top;color:#4D4D4D;cursor:pointer}.fav_pageBtn_over{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/bt_7c7d163.png) no-repeat left -29px;color:#4D4D4D;cursor:pointer}.fav_pageBtn_down{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/bt_7c7d163.png) no-repeat left -58px;color:#4D4D4D;cursor:pointer}.page-disable{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/bt_7c7d163.png) no-repeat left top;color:#d3d3d3}.fav_tip_box p{line-height:20px;padding-left:5px}.fav_helpBg01{margin-top:10px;height:146px;width:282px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/fav_description_01_9d783c2.png) no-repeat left top}.fav_helpBg01 div{padding:18px 120px 0 32px;line-height:20px;color:#999}.fav_helpBg02{height:214px;width:282px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/fav_des_02_5d6fbf2.png) no-repeat left top}.fav_helpBg02 div{padding:0 10px 0 32px;line-height:20px;color:#999}.page-footer{height:30px;margin:15px auto;text-align:center}.page-footer span{display:inline-block;text-align:center;cursor:pointer;line-height:25px;width:65px;height:25px;margin:0 8px}#J_favTab span{display:block;float:left;cursor:pointer;text-align:center;width:105px;height:22px;padding-top:5px}#J_favTab{width:315px;height:27px;overflow:hidden;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/favtab_cc35a8d.gif) no-repeat}#J_favTab span.on{cursor:default}.favTab0 span.on{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/favtab_cc35a8d.gif) no-repeat 0 -27px}.favTab1 span.on{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/favtab_cc35a8d.gif) no-repeat -105px -27px}.favTab2 span.on{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/favtab_cc35a8d.gif) no-repeat -210px -27px}.favSign li p.fav_ico_pano{margin:0 0 0 2px;display:block;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_bg_new_3569ebd.gif) no-repeat scroll -85px -25px transparent}.toolsContent a{text-decoration:none;cursor:pointer}";return require.loadCss({content:t,name:"Fav"}),SyncMgr.checkFav(function(){a.goPage()},this),""}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Fav/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/Fav/Fav.js",ln:168})}},reset:function(){this.infoError=0,this.curIndex=-1},getDTypeByTabIndex:function(a){var t={0:"",1:"0",2:"1"};return t[a]},favTab:function(a){this.current_tab_index=a.num,a.update?(this.type=this.getDTypeByTabIndex(a.num),this.goPage()):"sort"!=a.from},sortList:function(a){this.sortType=a,this.goPage(this.currentPageIndex||1,10,{from:"sort"})},setFavPostData:function(a,t){if(0==this.current_tab_index&&(!a||0==a.length))return void this.showDefText();t=t||{};var e=[];e.push(['<div class="favSign" id="JfavSign"><div id="J_favTab">','<span id="fffs0" data-num="0" >全部</span>','<span id="fffs1" data-num="1" >地点</span>','<span id="fffs2" data-num="2" >路线</span>',"</div>",'<div class="fav-sort-tab">','<a id="fav_sort_by_time" onclick="FavInst.sortList(1)">按时间排序</a>',"<span>|</span>",'<a id="fav_sort_by_char" onclick="FavInst.sortList(2)">按首字母排序</a>',"</div>","<ul>"].join("")),e.push(this.getListHtml(a)),e.push("</ul></div>"),e.push("<div id='pageFooter' class='page-footer'></div>"),BoxContainer.setTitle("收藏夹"),BoxContainer.setContent(e.join("")),setTabItem({dom:T.g("fffs"+this.current_tab_index),num:this.current_tab_index,mid:"favTab",from:t.from,update:!1,nameSpace:FavInst}),1==this.sortType?T.ac(T.g("fav_sort_by_time"),"active"):T.ac(T.g("fav_sort_by_char"),"active"),this._bindFavListEvent()},_bindFavListEvent:function(){if(T.browser.ie&&6==T.browser.ie)for(var a=T.G("JfavSign"),t=a.getElementsByTagName("li"),e=0;e<t.length;e++)T.on(t[e],"mouseover",function(){T.ac(this,"over"),this.getElementsByTagName("span")[0].style.display="block"}),T.on(t[e],"mouseout",function(){T.rc(this,"over"),this.getElementsByTagName("span")[0].style.display="none"});baidu("#J_favTab").delegate("span","click",function(){var a=parseInt(baidu(this).data("num"));setTabItem({dom:this,num:a,mid:"favTab",nameSpace:FavInst,update:!0})})},getListHtml:function(a){for(var t=[],e=0,n=a.length;n>e;e++){var i=a[e],o=parseInt(i.type,10),s=i.data,r=this.getPageBeforeIndex(e),p=i.create_time?i.create_time.split(" ")[0]:"",c="",d="",g="";switch(o){case 0:d=s.name;break;case 1:switch(d=s.pathname,s.pathtype){case 0:g="fav_ico_nav";break;case 1:switch(s.transkind){case 0:g="fav_ico_train";break;case 1:g="fav_ico_plane";break;default:g="fav_ico_bus"}break;case 2:g="fav_ico_walk"}}d=T.string.encodeHTML(T.trim(d)),c=T.string.subByte(T.string.encodeHTML(d),40,"...");var m=["<li>",'<p title="'+d+'" class="'+g+'" onclick="FavInst.showItem('+o+","+r+')">'+c+"</p>",'<div class="fav-list-time">'+p+"</div>","<span>",'<a class="favDelBg" title="删除" href="javascript:void(0);" onclick="SyncMgr.deleteFavByIndex('+r+')" ></a> ',"</span>","</li>"];t.push(m.join(""))}return t.join("")},showItem:function(a,t){switch(a){case 0:this.showFavPoi(t,{stat:1});break;case 1:this.showTrans(t)}},showFavPoi:function(a,t){t&&t.stat&&(t.openWindow=1);var e=SyncMgr.converToOriginal(this.pagedata[a].data),n=SyncMgr.createMark(e,{from:"fav"});return map.setCenter(n.getPoint()),n.show(),t&&!t.openWindow?!1:(SyncMgr.openInfoWnd(n,{data:e}),window.PanoMap&&window.PanoMap.isOpen&&PanoMap.hide(),n)},showTrans:function(a){var t=this.pagedata[a].data,e=2,n=2,i=t.curcityid,o=t.pagenumber||0,s=t.wp,r={},p="",c="",d="",g="",m="",l="",h="",f="",v="",u=t.sfavnode,b=t.efavnode,x=u.cityid,_=b.cityid,w=u.uid,T=b.uid,y=encodeURIComponent(u.name),k=encodeURIComponent(b.name),S=t.trafType||0;switch(t.pathtype){case 0:case 5:var B=SyncMgr.pk_dict[t.pathtype];l="nav",m=B[t.plankind].lk;break;case 1:case 6:case 7:if(l="bt",isNaN(parseInt(t.transkind,10))){var B=SyncMgr.pk_dict[t.pathtype];m=B[t.plankind].lk,4==m&&(m=0,v="[0,2,4,7,5,8,9,10,11]",S=1),r={_index:(t.busidx||0)+",1,1",trafType:S}}else f=SyncMgr.pk_dict[9][t.plankind].lk,h=t.transkind,r={_index:(t.busidx||0)+",1,1"};break;case 2:l="walk"}if(u.geoptx&&(e=1,d=u.geoptx+","+u.geopty),u.uid&&0==u.type&&(e=0),b.geoptx&&(n=1,g=b.geoptx+","+b.geopty),b.uid&&0==b.type&&(n=0),s&&s.length>2){for(var F=1;F<s.length-1;F++)p+="1$$$$"+s[F].p+"$$$$+to:",c+="0 +to:";n=1}_=c?c+_:_;var I={c:i,sn:e+"$$"+w+"$$"+d+"$$"+y+"$$$$$$",en:p+n+"$$"+T+"$$"+g+"$$"+k+"$$$$$$",sy:m,f:v,pn:o,csy:f,cty:h};x&&(I.sc=x,I.ec=_),("bt"==l||"bse"==l)&&(I.exptype=t.exptype||"dep",I.exptime=t.exptime||"",I.version=5),s&&s.length>2&&(I.drag=1);var M=l+"&"+util.jsonToQuery(I);componentManager.go(M,{cinfo:r})},goPage:function(a,t,e){e=e||{};var n=SyncMgr.getData(this.type);this.pagedata=sortData(n,this.sortType);var i=[],o=this.pagedata,t=t||this.pageSize,s=o.length,r=Math.ceil(s/t),p=a||1,a=p>r?r:p,c=(a-1)*t,d=c+t;this.currentPageIndex=a;var g=o.slice(c,d>s?s:d);this.setFavPostData(g,e),t>=s||(i.push("<span "),i.push(1==a?'class="page-disable">':'class="fav_pageBtn" onmouseup="this.className=\'fav_pageBtnt_over\'"  onmousedown="this.className=\'fav_pageBtn_down\'" onmouseout="this.className=\'fav_pageBtn\'" onmouseover="this.className=\'fav_pageBtn_over\'" onclick="FavInst.goPage('+(a-1)+","+t+')">'),i.push("上一页</span>"),i.push("<span "),i.push(a==r?'class="page-disable">':'class="fav_pageBtn" onmouseup="this.className=\'fav_pageBtnt_over\'"  onmousedown="this.className=\'fav_pageBtn_down\'" onmouseout="this.className=\'fav_pageBtn\'" onmouseover="this.className=\'fav_pageBtn_over\'" onclick="FavInst.goPage('+(a+1)+","+t+')">'),i.push("下一页</span>"),T.G("pageFooter").innerHTML=i.join(""))},showDefText:function(){this.defTextTimer&&window.clearInterval(this.defTextTimer),UserMgr&&UserMgr.userState?_defText():this.defTextTimer=window.setInterval(function(){UserMgr&&UserMgr.userState&&(_defText(),window.clearInterval(this.defTextTimer))},100)},getPageBeforeIndex:function(a){var t=this.currentPageIndex;return 1==t?a:(t-1)*this.pageSize+a}}),module.exports=Fav});