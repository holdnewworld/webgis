define("common:widget/ui/IndoorOverlay/IndoorOverlay.js",function(t,e,o){function i(t){this._position={x:t.x,y:t.y},this._angle=this._direction=t.angle||190,this._dom=t.dom,this._zIndex=t.zIndex,this._moving=!1,this._arrowDirection="-168px -72px",this._rotating=!1;var e=baidu.dom.getPosition(this._dom);this._domTop=e.top,this._domLeft=e.left,this._opts={enableDragging:!0,anchor:{width:-40,height:-18}},this.DIV_ROTATE_DIRECTION=[[0,-1200],[22.5,-1120],[45,-1040],[67.5,-960],[90,-880],[112.5,-800],[135,-720],[157.5,-640],[180,-560],[202.5,-480],[225,-400],[247.5,-320],[270,-240],[292.5,-160],[315,-80],[337.5,-0]],this.ARROW_ROTATE_DIRECTION=[[0,-360],[22.5,-336],[45,-312],[67.5,-288],[90,-264],[112.5,-240],[135,-216],[157.5,-192],[180,-168],[202.5,-144],[225,-120],[247.5,-96],[270,-72],[292.5,-48],[315,-24],[337.5,-0]],this.initialize()}function n(t,e,o){0!=e.indexOf("on")&&(e="on"+e);var i=new baidu.lang.Event(e);if(o)for(var n in o)i[n]=o[n];t.dispatchEvent(i)}function r(t){if(t){var e=t.attributes,o="";if(e)for(var i=0,n=e.length;n>i;i++)o=e[i].name,"function"==typeof t[o]&&(t[o]=null);var a=t.childnodes;if(a)for(var i=0,n=a.length;n>i;i++)r(t.childnodes[i])}}function a(t){var t=window.event||t;baidu.event.preventDefault(t),baidu.event.stopPropagation(t)}baidu.lang.inherits(i,baidu.lang.Class,"IndoorOverlay"),i.prototype.initialize=function(){try{var t=this,e=t._container=document.createElement("div"),o=document.createElement("div"),i="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/panorama/pano_markers_1f7469f.png)";t._div=e,t._arrow=o,t._bgu=i,t._setDefCursor(),baidu.extend(e.style,{position:"absolute",zIndex:t._zIndex,backgroundRepeat:"no-repeat",cursor:"pointer",backgroundPosition:"-560px -36px",height:"36px",width:"80px"}),baidu(e).addClass("pano-overlay-ie"),baidu.extend(o.style,{position:"absolute",backgroundRepeat:"no-repeat",cursor:"pointer",backgroundPosition:"-168px -72px",height:"42px",width:"24px",left:"27px",marginTop:"-18px"}),baidu(o).addClass("pano-overlay-ie"),e.appendChild(o),t._dom.appendChild(e),t._setEventDispath(),t.draw(),t.setDirection(t._direction)}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/ui/IndoorOverlay/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/ui/IndoorOverlay/IndoorOverlay.js",ln:148})}},i.prototype.draw=function(){var t=this._opts.anchor,e=this._position;this._container.style.left=e.x+t.width+"px",this._container.style.top=e.y+t.height+"px"},i.prototype.enableDragging=function(){this._opts.enableDragging=!0},i.prototype.disableDragging=function(){this._opts.enableDragging=!1},i.prototype.getPosition=function(){return this._position},i.prototype.setPosition=function(t){this._position=t,this.draw()},i.prototype.getDirection=function(){return this._direction},i.prototype.setDirection=function(t){if(!isNaN(t)){var e=this._direction=t;this._getRotateDirection(e)}},i.prototype.remove=function(){n(this,"onremove"),this._container&&r(this._container),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container)},i.prototype._setDefCursor=function(){T.browser.firefox?(this.defaultCursor="-moz-grab",this.draggingCursor="-moz-grabbing"):T.browser.chrome||T.browser.safari?(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur) 8 8, default",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur) 8 8, default"):(this.defaultCursor="url(http://webmap0.map.bdstatic.com/newmap/static/common/images/api/openhand.cur)",this.draggingCursor="url(http://webmap1.map.bdstatic.com/newmap/static/common/images/api/closedhand.cur)")},i.prototype._getRotateDirection=function(t){if(!isNaN(t)){var e=this.DIV_ROTATE_DIRECTION,o=this.ARROW_ROTATE_DIRECTION,i=0,n=t-31.75,r=o.length;if(n>e[r-1][0])this._div.style.backgroundPosition=e[r-1][1]+"px 0",this._arrow.style.backgroundPosition=this._arrowDirection=o[r-1][1]+"px -72px";else for(var i=0;r>i;i++)if(n<e[i][0]){this._div.style.backgroundPosition=e[i][1]+"px -36px",this._arrow.style.backgroundPosition=this._arrowDirection=o[i][1]+"px -72px";break}}},i.prototype._getMoveDirection=function(t,e){if(!isNaN(t)&&!isNaN(e)){var o=-1,i=t-this.preX;return this.preX>5&&0>i?o=0:this.preX>5&&i>0&&(o=1),this.preX=t,this.preY=e,o}},i.prototype._setEventDispath=function(){function t(t){var t=window.event||t,e=t.pageX||t.clientX||0,o=t.pageY||t.clientY||0,i={x:e,y:o};return{point:i}}var e=this,o=e._container,i=e._arrow,r=e._dom,s=(e._angle,!1),p=!1,u=null;i.onmousedown=function(s){var l=t(s);return i.setCapture?(baidu.on(i,"onmousemove",d),baidu.on(i,"onmouseup",c)):(baidu.on(r,"onmousemove",d),baidu.on(r,"onmouseup",c)),e._opts.enableDragging?(u=l.point,n(e,"ondragstart",{point:e._position}),p=!0,i.style.cursor=e.draggingCursor,baidu(o).removeClass("pano-overlay-ie"),i.setCapture&&i.setCapture(),r.style.MozUserSelect="none",r.style.KhtmlUserSelect="none",r.style.WebkitUserSelect="none",r.unselectable="on",r.onselectstart=function(){return!1},void a(s)):void a(s)},o.onmousedown=function(t){r.style.MozUserSelect="none",r.style.KhtmlUserSelect="none",r.style.WebkitUserSelect="none",r.unselectable="on",r.onselectstart=function(){return!1},a(t)};var c=function(l){t(l);return i.releaseCapture?(baidu.un(i,"onmousemove",d),baidu.un(i,"onmouseup",c)):(baidu.un(r,"onmousemove",d),baidu.un(r,"onmouseup",c)),e._opts.enableDragging?(i.releaseCapture&&i.releaseCapture(),i.style.backgroundPosition=e._arrowDirection,baidu(o).addClass("pano-overlay-ie"),i.style.cursor="pointer",clearInterval(e._viewtypetimer),n(e,"ondragend",{point:e._position}),p=!1,s=!1,u=null,r.style.MozUserSelect="",r.style.KhtmlUserSelect="",r.style.WebkitUserSelect="",r.unselectable="off",r.onselectstart=function(){},void a(l)):void a(l)},d=function(o){if(e._opts.enableDragging&&p){var r=t(o),s=e._position,c=r.point.x-u.x+s.x,d=r.point.y-u.y+s.y;switch(u=r.point,e._position={x:c,y:d},e._getMoveDirection(c,d)){case-1:i.style.backgroundPosition="-168px -72px";break;case 0:i.style.backgroundPosition="-408px -72px";break;case 1:i.style.backgroundPosition="-432px -72px";break;default:i.style.backgroundPosition="-168px -72px"}e.draw(),n(e,"ondragging",{point:e._position}),a(o)}}},o.exports=i});