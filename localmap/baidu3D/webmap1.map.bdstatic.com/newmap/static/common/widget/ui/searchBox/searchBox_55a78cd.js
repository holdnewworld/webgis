define("common:widget/ui/searchBox/searchBox.js",function(e,n,t){function o(){var e=w,n=function(e){e.keyCode<49&&!t["_"+e.keyCode]||(this._wd2=null)},t={_8:1,_32:1,_46:1};T.on(T.g("PoiSearch"),"keydown",n),T.on(T.g("BusSearchSta"),"keydown",n),T.on(T.g("BusSearchEnd"),"keydown",n),T.on(T.g("DriveSearchSta"),"keydown",n),T.on(T.g("DriveSearchEnd"),"keydown",n);var o=function(){var e=T.getAttr(this,"_from"),n="input_"+e,t="input_"+e+"_focus",o=this.value;window.temp.headSearchBoxFocus=this,baidu(this).removeClass(n),0==o.length?baidu(this).addClass(t):(baidu(this).removeClass(n),baidu(this).removeClass(t))},r=function(){var e=T.getAttr(this,"_from"),n="input_"+e,t="input_"+e+"_focus",o=this.value;delete window.temp.headSearchBoxFocus,T.rc(this,t),0==o.length?T.ac(this,n):(T.rc(this,n),T.rc(this,t))},i=function(e){if(window.temp.headSearchBoxFocus){var n=window.temp.headSearchBoxFocus,t=T.getAttr(n,"_from"),o="input_"+t,a="input_"+t+"_focus",r=n.value;n&&"value"==e.propertyName&&(T.rc(n,o),0==r.length?T.ac(n,a):(T.rc(n,o),T.rc(n,a)))}},c=function(){var e=T.getAttr(this,"_from"),n=this.value,t="input_"+e,o="input_"+e+"_focus";T.rc(this,t),0==n.length?T.ac(this,o):(T.rc(this,t),T.rc(this,o))};T.on(T.g("BusSearchSta"),"focus",o),T.on(T.g("BusSearchEnd"),"focus",o),T.on(T.g("DriveSearchSta"),"focus",o),T.on(T.g("DriveSearchEnd"),"focus",o),T.on(T.g("BusSearchSta"),"blur",r),T.on(T.g("BusSearchEnd"),"blur",r),T.on(T.g("DriveSearchSta"),"blur",r),T.on(T.g("DriveSearchEnd"),"blur",r),T.on(T.g("BusSearchSta"),"keyup",o),T.on(T.g("BusSearchEnd"),"keyup",o),T.on(T.g("DriveSearchSta"),"keyup",o),T.on(T.g("DriveSearchEnd"),"keyup",o),T.browser.ie&&document.attachEvent?(T.g("BusSearchSta").attachEvent("onpropertychange",i),T.g("BusSearchEnd").attachEvent("onpropertychange",i),T.g("DriveSearchSta").attachEvent("onpropertychange",i),T.g("DriveSearchEnd").attachEvent("onpropertychange",i)):(T.on(T.g("BusSearchSta"),"input",c),T.on(T.g("BusSearchEnd"),"input",c),T.on(T.g("DriveSearchSta"),"input",c),T.on(T.g("DriveSearchEnd"),"input",c)),T.on(T.g("busReturnIcon"),"mouseover",function(){var e=window.currentComponent._className;this.title="BusTrans"==e||"CBusTrans"==e||"NavTrans"==e?"查看返程":"切换起终点",T.ac(this,"return_icon_on")}),T.on(T.g("busReturnIcon"),"mouseout",function(){T.rc(this,"return_icon_on")}),(T.browser.chrome||T.browser.safari)&&T.on(T.g("busReturnIcon"),"mousedown",function(e){baidu.event.preventDefault(e)}),T.on(T.g("busReturnIcon"),"click",function(){s(),addStat("indexheader.searchbox.exchangeterminals",null,{da_src_bk:"bus"});{var n=document.fmbus,t=n.word_from.value,o=n.word_to.value,a=window.currentComponent._className;n.word_to._fromPoiSearch}e.notShowSuggest.run();var r=f.get("BusTrans"),i=f.get("CBusTrans"),c=f.get("NavWalk");if(r&&"BusTrans"==a&&T.g("BusSearchSta").value==r.start.wd&&T.g("BusSearchEnd").value==r.end.wd||i&&"CBusTrans"==a&&!i.noResult&&T.g("BusSearchSta").value==i.start.wd&&T.g("BusSearchEnd").value==i.end.wd||c&&"NavWalk"==a&&T.g("BusSearchSta").value==c.start.wd&&T.g("BusSearchEnd").value==c.end.wd)"BusTrans"==a?r.returnBus():"CBusTrans"==a?i._back():c.returnDr();else{var u=T.g("BusSearchSta")._wd2?T.trim(T.g("BusSearchSta")._wd2):"",d=T.g("BusSearchEnd")._wd2?T.trim(T.g("BusSearchEnd")._wd2):"";e.setValue("BusSearchSta",o),T.g("BusSearchSta")._wd2=d,e.setValue("BusSearchEnd",t),T.g("BusSearchEnd")._wd2=u,("BusTrans"==a||"CBusTrans"==a||"SelAddr"==a||"BusAddr"==a||"RouteAddr"==a)&&e.qSearch(document.fmbus,"bt")}""==T.g("BusSearchSta").value?T.g("BusSearchSta").focus():""==T.g("BusSearchEnd").value&&T.g("BusSearchEnd").focus()}),T.on(T.g("navReturnIcon"),"mouseover",function(){var e=window.currentComponent._className;this.title="BusTrans"==e||"CBusTrans"==e||"NavTrans"==e?"查看返程":"切换起终点",T.ac(this,"return_icon_on")}),T.on(T.g("navReturnIcon"),"mouseout",function(){T.rc(this,"return_icon_on")}),(T.browser.chrome||T.browser.safari)&&T.on(T.g("navReturnIcon"),"mousedown",function(e){S.preventDefault(e)}),T.on(T.g("navReturnIcon"),"click",function(){s(),addStat("indexheader.searchbox.exchangeterminals",null,{da_src_bk:"nav"});{var n=document.fmnav,t=n.word_from.value,o=n.word_to.value,a=window.currentComponent._className;n.word_to._fromPoiSearch}e.notShowSuggest.run();var r=f.get("NavTrans");if(r&&"NavTrans"==a&&r.total&&T.g("DriveSearchSta").value==r.start.wd&&T.g("DriveSearchEnd").value==r.end.wd)r.returnDr();else{var i=T.g("DriveSearchSta")._wd2?T.trim(T.g("DriveSearchSta")._wd2):"",c=T.g("DriveSearchEnd")._wd2?T.trim(T.g("DriveSearchEnd")._wd2):"";e.setValue("DriveSearchSta",o),T.g("DriveSearchSta")._wd2=c,e.setValue("DriveSearchEnd",t),T.g("DriveSearchEnd")._wd2=i,("NavTrans"==a||"SelAddr"==a||"NavAddr"==a||"RouteAddr"==a)&&e.qSearch(document.fmnav,"nav")}""==T.g("DriveSearchSta").value?T.g("DriveSearchSta").focus():""==T.g("DriveSearchEnd").value&&T.g("DriveSearchEnd").focus()}),a()}function a(){var e=w;baidu(".search_box form").on("submit",function(n){var t=baidu(this).data("type")||"";e.qSearch(this,t,"",{from:"button",da_src:"searchBox.button"}),n.preventDefault()}),baidu("http://webmap1.map.bdstatic.com/newmap/static/common/widget/ui/searchBox/.search_box form .tab").delegate("li","click",function(){var n=parseInt(baidu(this).data("tab"));switch(n){case 1:e.setSwitchTab(1,"","",{from:"button"}),addStat("indexheader.searchbox.searchboxtabs");break;case 2:e.setSwitchTab(2,"","",{from:"button"}),addStat("indexheader.searchbox.searchboxtabbt");break;case 3:e.setSwitchTab(3,"","",{from:"button"}),addStat("indexheader.searchbox.searchboxtabnav")}}),baidu("span.smp_poi_btn").on("click",function(e){baidu(this).hasClass("clearBase")||g.openList("PoiSearch",e)}),baidu("span.smp_navs_btn").on("click",function(e){var n=baidu(this).data("type");"bt"==n?g.openList("BusSearchSta",e):"nav"==n&&g.openList("DriveSearchSta",e)}),baidu("span.smp_nave_btn").on("click",function(e){var n=baidu(this).data("type");"bt"==n?g.openList("BusSearchEnd",e):"nav"==n&&g.openList("DriveSearchEnd",e)})}function r(e,n,t,o,a){var r="pcmappg.unknown";if(a&&a.da_src&&(r="pcmappg."+a.da_src),e.word.value=S.filtQuery(e.word.value),""==e.word.value)return e.word.focus(),!1;var i=l.cityCode||1,c=o||T.g("PoiSearch")&&T.g("PoiSearch")._wd2||"",s=c?1:0;T.g("PoiSearch")&&(T.g("PoiSearch")._wd2=null),window.GRControll&&(window.GRControll.openedMarker=null);var u={cinfo:{from:"searchBox"},dom:T.g("MapInfo")},d=map.getBounds();f.go("s&da_src="+r+"&wd="+encodeURIComponent(e.word.value)+"&c="+i+"&src=0&wd2="+encodeURIComponent(c)+"&sug="+s+"&l="+map.zoomLevel+"&b=("+d.minX+","+d.minY+";"+d.maxX+","+d.maxY+")&from=webmap",u),window.isPrint||p.clearInit()}function i(e,n,t,o,a,r){var i=(f.get("RouteAddr")||{},w),c=l.cityCode||1,s=2,u=2,d="",h="",g="",v="",p="",_="",b={},B=c,I=c,$=T.string.trim(e.word_from.value),E=T.string.trim(e.word_to.value),C="",x="";switch(n){case"bt":C="BusSearchSta",x="BusSearchEnd",g="bt";break;case"nav":C="DriveSearchSta",x="DriveSearchEnd",g="nav"}if(i.setValue(C,S.filtQuery($)),i.setValue(x,S.filtQuery(E)),""==$)return e.word_from.focus(),!1;if(""==E)return e.word_to.focus(),!1;T.g(C)&&(v=T.g(C)._wd2||"",T.g(C)._wd2=null),T.g(x)&&(p=T.g(x)._wd2||"",T.g(x)._wd2=null);var y,D=v?1:0,k=p?1:0,R=i.inputInfo[C],V=i.inputInfo[x],P=R&&R.point&&R.note==$,G=V&&V.point&&V.note==E;if(P&&G||!P&&!G){P&&G?(s=1,u=1,d=R.point,h=V.point,c=R.ccode||c,B=R.ccode||c,I=V.ccode||c):(i.inputInfo[C]={},i.inputInfo[x]={});var N=encodeURIComponent($),j=encodeURIComponent(v),A=encodeURIComponent(E),Q=encodeURIComponent(p);y={c:c,sn:s+"$$$$"+d+"$$"+N+"$$"+D+"$$"+j+"$$",en:u+"$$$$"+h+"$$"+A+"$$"+k+"$$"+Q+"$$",sc:B,ec:I,pn:0,rn:5}}else if(P||G)if(("button"!=t||"bt"==g)&&(g="bt"==g?"bse":"nse"),"bse"==g||"nse"==g){var U,M,q,L,F,O="";P?(U=R.point,M=R.note,q=E,L="sn",F=1,c=R.ccode||c,i.inputInfo[x]={},O=p):G&&(U=V.point,M=V.note,q=$,L="en",F=0,c=G.ccode||c,i.inputInfo[C]={},O=v);var y={c:c,t:F,poiType:"0",isSingle:"true",ptx:U.split(",")[0],pty:U.split(",")[1],wd:encodeURIComponent(q),name:encodeURIComponent(M),wd2:encodeURIComponent(O)};y[L]="1$$$$"+U+"$$"+encodeURIComponent(M)+"$$$$$$",_=g+"&"+S.jsonToQuery(y),b={cinfo:{q:_,c:c,t:0,isSingle:!0,kwn:{name:M,pt:S.getPoiPoint(U),poiType:0}}}}else{var s=2,u=2,d="",h="",B=c,I=c;P?(d=R.point,s=1,B=R.ccode||c,i.inputInfo[x]={}):G&&(h=V.point,u=1,I=G.ccode||c,i.inputInfo[C]={});var N=encodeURIComponent($),j=encodeURIComponent(v),A=encodeURIComponent(E),Q=encodeURIComponent(p);y={c:c,sn:s+"$$$$"+d+"$$"+N+"$$"+D+"$$"+j+"$$",en:u+"$$$$"+h+"$$"+A+"$$"+k+"$$"+Q+"$$",sc:B,ec:I,pn:0,rn:5}}if(y.en&&a.support()&&a.getSearchableTpCount()>0){{f.get("NavTrans")}y.en=a.getQueryParam(function(){})+y.en,y.ec=a.getCityCode()+y.ec,y.drag=1,b.cinfo=b.cinfo?b.cinfo:{},b.cinfo.fromBdyx=!0}("bt"==g||"bse"==g)&&(y.exptype="dep",y.exptime=m.getBusExpTime(),y.version=5),_=g+"&da_src=pcmappg."+r+"&"+S.jsonToQuery(y),f.go(_,b)}function c(e){var n=w,t=window.currentComponent&&window.currentComponent._className;if(2==e){if("NavTrans"==t){var o=f.get("NavTrans");if(o&&T.g("DriveSearchSta").value==o.start.wd&&T.g("DriveSearchEnd").value==o.end.wd)return void f.go(o.busQueryString,{cinfo:{switchTab:!0},dom:T.g("MapInfo")});n.qSearch(document.fmbus,"bt")}}else if(T.g("supBus").innerHTML="","BusTrans"==t){var a=f.get("BusTrans");if(a&&a.start&&T.g("BusSearchSta").value==a.start.wd&&T.g("BusSearchEnd").value==a.end.wd)return void f.go(a.getNavQuery()+(window.navTimeCache?"&time_index="+window.navTimeCache.timeIndex+"&day="+window.navTimeCache.day:"&time_index=-1&day=-1"),{dom:T.g("MapInfo")});n.qSearch(document.fmnav,"nav")}else if("CBusTrans"==t){var r=f.get("CBusTrans");if(r&&T.g("BusSearchSta").value==r.start.wd&&T.g("BusSearchEnd").value==r.end.wd)return void f.go(r.navQueryString+(window.navTimeCache?"&time_index="+window.navTimeCache.timeIndex+"&day="+window.navTimeCache.day:"&time_index=-1&day=-1"),{dom:T.g("MapInfo")});n.qSearch(document.fmnav,"nav")}("SelAddr"==t||"BusAddr"==t||"NavAddr"==t||"RouteAddr"==t)&&(2==e?n.qSearch(document.fmbus,"bt"):n.qSearch(document.fmnav,"nav"))}function s(){var e=w,n=T.object.extend({},e.inputInfo.BusSearchSta),t=T.object.extend({},e.inputInfo.BusSearchEnd),o=T.object.extend({},e.inputInfo.DriveSearchSta),a=T.object.extend({},e.inputInfo.DriveSearchEnd);e.inputInfo.BusSearchSta=t,e.inputInfo.BusSearchEnd=n,e.inputInfo.DriveSearchSta=a,e.inputInfo.DriveSearchEnd=o}function u(e){var n=w,t=n.inputInfo.BusSearchSta,o=n.inputInfo.BusSearchEnd,a=n.inputInfo.DriveSearchSta,r=n.inputInfo.DriveSearchEnd;2==e?(!t.point&&a.point&&(n.inputInfo.BusSearchSta=T.object.extend({},a)),!o.point&&r.point&&(n.inputInfo.BusSearchEnd=T.object.extend({},r))):3==e&&(!a.point&&t.point&&(n.inputInfo.DriveSearchSta=T.object.extend({},t)),!r.point&&o.point&&(n.inputInfo.DriveSearchEnd=T.object.extend({},o)))}function d(){var n=w,t=4,o=8;T.browser.ie&&(t=3),7==T.browser.ie&&(o=7),e.async("common:widget/ui/MapSuggest/MapSuggest.js",function(e){n.poiSSG=new e({inputid:"PoiSearch",closeTip:1,formName:"fmwd",_sq:!0,offset1:[-o,0]},function(e,t){t?n.qSearch(document.fmwd,"loc",e,{da_src:"http://webmap1.map.bdstatic.com/newmap/static/common/widget/ui/searchBox/searchBox.sugg"}):T.g("PoiSearch")&&(T.g("PoiSearch")._wd2=e)},function(){this.closeSuggestion.showTip(T.g("PoiSearch"))}),n.busSSG1=new e({inputid:"BusSearchSta",closeTip:1,qType:2,cityid:"modelConfig.cityCode",offset1:[-t,0]},function(e){T.g("BusSearchSta")&&(T.g("BusSearchSta")._wd2=e)},function(){this.closeSuggestion.showTip(T.g("BusSearchSta"))}),n.busSSG2=new e({inputid:"BusSearchEnd",closeTip:1,qType:2,cityid:"modelConfig.cityCode",offset1:[-t,0]},function(e){T.g("BusSearchEnd")&&(T.g("BusSearchEnd")._wd2=e)},function(){this.closeSuggestion.showTip(T.g("BusSearchEnd"))}),n.driveSSG1=new e({inputid:"DriveSearchSta",closeTip:1,offset1:[-t,0]},function(e){T.g("DriveSearchSta")&&(T.g("DriveSearchSta")._wd2=e)},function(){this.closeSuggestion.showTip(T.g("DriveSearchSta"))}),n.driveSSG2=new e({inputid:"DriveSearchEnd",closeTip:1,offset1:[-t,0]},function(e){T.g("DriveSearchEnd")&&(T.g("DriveSearchEnd")._wd2=e)},function(){this.closeSuggestion.showTip(T.g("DriveSearchEnd"))}),n.poiSSG.setValue(""),n.busSSG1.setValue(""),n.busSSG2.setValue(""),n.driveSSG1.setValue(""),n.driveSSG2.setValue("")})}var h=e("common:widget/ui/config/config.js"),S=e("common:widget/ui/util/util.js"),f=e("common:widget/com/componentManager.js"),g=(e("common:widget/ui/mapInfo/mapInfo.js"),e("common:widget/ui/setMyPlace/SetMyPlaceMgr.js")),v=e("common:widget/ui/BoxContainer/BoxContainer.js"),p=e("common:widget/ui/ClearBase/ClearBase.js"),m=e("common:widget/ui/indexUtil/IndexUtil.js"),l=h.modelConfig,w={_ByClickTab:!0,_curSelIndex:1,inputInfo:{BusSearchSta:{},BusSearchEnd:{},DriveSearchSta:{},DriveSearchEnd:{},iw_ssn:{},iw_esn:{}},notShowSuggest:{state:0,timer:null,run:function(){var e=this;e.state=1,e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.state=0},300)}},init:function(){o()},suggest:function(){T.g("PoiSearch").value="",this.setValue("BusSearchSta",""),this.setValue("BusSearchEnd",""),this.setValue("DriveSearchSta",""),this.setValue("DriveSearchEnd",""),d()},setValue:function(e,n,t){var o=T.g(e);if(n=T.trim(n),o){var a=T.dom.getAttr(o,"_from"),r="input_"+a,i="input_"+a+"_focus";o._fromPoiSearch&&(o._fromPoiSearch=null),o.value=n,n.length>0?(T.rc(o,r),T.rc(o,i)):T.ac(o,r),"sug"==t||o.blur()}},parseShare:function(e){var n=e.split("&"),t=n[0],o={},a={},r=0,i=0;if("bt"==t||"bse"==t||"nse"==t||"nav"==t){for(var c=0,s=n.length;s>c;c++){if(n[c].indexOf("sn=1")>=0){var u=n[c].split("$$");o={note:u[3],point:u[2]}}if(n[c].indexOf("en=1")>=0){var d=n[c].split("to:"),h=d[d.length-1].split("$$");a={note:h[3],point:h[2]}}n[c].indexOf("sc=")>=0&&(r=n[c].split("=")[1]),n[c].indexOf("ec=")>=0&&(i=n[c].split("=")[1].split("to:"),i=i[i.length-1])}("bt"==t||"bse"==t)&&(o.note&&o.point&&(r&&(o.ccode=r),this.inputInfo.BusSearchSta=o),a.note&&a.point&&(i&&(a.ccode=i),this.inputInfo.BusSearchEnd=a)),("nse"==t||"nav"==t)&&(o.note&&o.point&&(r&&(o.ccode=r),this.inputInfo.DriveSearchSta=o),a.note&&a.point&&(i&&(a.ccode=i),this.inputInfo.DriveSearchEnd=a))}},qSearch:function(n,t,o,a){a=a||{};var c=a.from||"",s=window.currentComponent&&window.currentComponent._className;"loc"==t?r(n,c,s,o,a):e.async("common:widget/ui/throughpoint/Throughpoint.js",function(e){i(n,t,c,s,e,a.da_src||"unknown")}),window.PanoMap&&window.PanoMap.isOpen&&window.PanoMap.hide(),v&&v.resetStatus()},setSwitchTab:function(n,t,o,a){if(!(window.isPrint||1>n||n>3)){a=a||{},u(n),e.async("common:widget/ui/throughpoint/Throughpoint.js",function(e){e.onSwitchTab(n,a)});var r=this,i=(a.from||"",window.currentComponent&&window.currentComponent._className,this._curSelIndex);if(1==n&&null!=t&&""!=t&&(T.g("PoiSearch").value=t,r.poiSSG&&r.poiSSG.setValue(t)),i!=n){this._curSelIndex=n;for(var s=1;3>=s;s++)T.g("tab"+s).className="",T.g("form"+s).style.display="none";if(T.g("tab"+n).className="on",T.g("form"+n).style.display="block",1==n)try{T.g("form1").word.focus()}catch(d){}else T.g("form"+n).word_to.focus(),T.g("form"+n).word_from.focus();if(1!=n){if(1!=i){var h=T.trim(T.g("form"+i).word_from.value),S=T.trim(T.g("form"+i).word_to.value);this.setQValue(S,2,1),this.setQValue(h,2,0),this.setQValue(S,3,1),this.setQValue(h,3,0)}var f=T.trim(T.g("form1").word.value),g=T.trim(T.g("form"+n).word_to.value);""==g&&""!=f&&(this.setQValue(f,n,1),T.g("form"+n).word_to._fromPoiSearch=!0),c(n)}}}},setQValue:function(e,n,t){e||(e=""),n||(n=1),1>n||n>3||(1==n?this.poiSSG?this.poiSSG.setValue(e):T.g("form1").word.value=e:2==n?0==t?this.busSSG1&&this.busSSG1.setValue(e):1==t&&this.busSSG2&&this.busSSG2.setValue(e):0==t?this.driveSSG1&&this.driveSSG1.setValue(e):1==t&&this.driveSSG2&&this.driveSSG2.setValue(e))},setQFocus:function(e,n){e||(e=1),1>e||e>3||(1==e?T.g("form1").word.focus():2==e?0==n?T.g("form2").word_from.focus():1==n&&T.g("form2").word_to.focus():0==n?T.g("form3").word_from.focus():1==n&&T.g("form3").word_to.focus())}};t.exports=w});