define("common:widget/ui/StreetViewLayer/StreetViewLayer.js",function(e,t,i){function a(e){baidu.lang.Class.call(this),this._map=e.map||map,this.PANO_URL=d.PANO_ROAD_LAYER,this.udtVersion=s.UDT_VERSION||"20130929",this.visible=!1,this.layerId=""}var o=(window.Pano=window.Pano||{},e("common:widget/ui/config/config.js")),n=e("common:widget/ui/PanoUtil/PanoUtil.js"),r=e("common:widget/pano/PanoInterface/PanoInterface.js"),s=o.mapVersion,d=o.urlConfig;baidu.lang.inherits(a,baidu.lang.Class,"StreetViewLayer"),baidu.object.extend(a.prototype,{show:function(){this.addLayer(),this.dispatchEvent("onshow",{visible:!0})},hide:function(){this.removeLayer(),this.dispatchEvent("onhide",{visible:!1})},getVisible:function(){return this.visible},addLayer:function(){if(this._map&&!this._map.getTileLayer(this.layerId)){var e=this,t=!0,i=256,a=this._map.getMapType()==BMAP_NORMAL_MAP?"il":"sl";this.tilelayer=new BMap.TileLayer({transparentPng:t}),this.tilelayer.zIndex=1,this.tilelayer.getTilesUrl=function(t,o){var n=BMap.MapType[this.getMapType()];if("object"!=typeof n||!t||0>o)return null;var r=Math.pow(2,18-o)*i,s=parseInt(t.lng/r),d=parseInt(t.lat/r),h=e.PANO_URL+"/tile/?udt="+e.udtVersion+"&qt=tile&styles="+a+"&x="+s+"&y="+d+"&z="+o;return T.browser.ie&&T.browser.ie<=6&&(h+="&color_dep=32"),h},this._map.addTileLayer(this.tilelayer),this.layerId=this.tilelayer.getMapType(),this.visible=!0,window.isPhotoTourSupported&&this.addPhotoTourLayer()}},addPhotoTourLayer:function(){var e={uid:"d270a38b230b50fced74f8f7",bound:{xmin:12958063,ymin:4826872,ymax:4826984,xmax:12958159},name:"故宫照片游",catalog:"street_1",type:"street",icon:{y:4826928,x:12958111}},t=new BMap.Marker(new BMap.Point(e.icon.x,e.icon.y),{icon:new BMap.Icon("../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/phototour_indoor_icon_59074d3.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/phototour_indoor_icon_59074d3.png*/,new BMap.Size(24,28),{offset:new BMap.Size(10,12),infoWindowOffset:new BMap.Size(5,0)}),zIndexFixed:!0,baseZIndex:3e6});this._photoMarker=t,t.addEventListener("mouseover",function(){n.panoMarker.enableIndoorOverlay(new BMap.Point(e.icon.x,e.icon.y),e.uid,e.name)}),t.addEventListener("mouseout",function(){n.panoMarker.disableIndoorOverlay()}),t.addEventListener("click",function(t){r.showPhotoTour(e.uid),T.event.stopPropagation(t.domEvent)}),this._map.addOverlay(t)},removePhotoTourLayer:function(){this._photoMarker&&(this._map.removeOverlay(this._photoMarker),this._photoMarker=null)},removeLayer:function(){var e=this._map.getTileLayer(this.layerId);e&&(this._map.removeTileLayer(e),this.layerId=""),this.visible=!1,this.removePhotoTourLayer()},getLayerId:function(){return this.layerId},update:function(){this.removeLayer(),this.addLayer()}}),i.exports=a});