!function(){function dJ(e,t){this._size=e,this._cache=[],this._totalGetTimes=0,this._totalHitTimes=0,this._options={clearCallback:null,removeOldCallback:null},t=t||{};for(var i in t)t.hasOwnProperty(i)&&(this._options[i]=t[i])}function T(){}function bN(e,t){if("string"==typeof e&&(e=document.getElementById(e)),cB.call(this),this.container=e,this.width=e.clientWidth,this.height=e.clientHeight,this.offsetX=0,this.offsetY=0,this._setStyle(e),e.unselectable="on",e.innerHTML="",e.appendChild(this.render()),this._initDate=new Date,this.platform=e.children[0],this.maskLayer=this.platform.children[0],this._panes={},this.centerPoint=new eM.Point(0,0),this.zoomLevel=0,this._heading=0,this._tilt=0,this._bounds=new cm,this.lastLevel=0,this._lock=!1,this._enableTiltZoom=7,this._enableHeadingZoom=7,this.defaultZoomLevel=null,this.defaultCenter=null,this.currentOperation=co.idle,this._setConfig(t),this._initMapRenderType(),this._animationInfo={},this._animationInfoUnstopable={},this._displayOptions={showText:!0,showOverlay:!0,showLayers:!0,isFlat:!1},this.suspendLoad=!1,this._customTileLabels=[],"webgl"===this._renderType?(WorkerMgr.init(this),x.extend(this,bM.prototype),this.jobScheduler=new dL(this),this.benchmark=new M,this._setupWebGLMap(),this.deviceInfo={hardwareInfo:{renderer:"",vendor:""},platformInfo:window.detect.parse(navigator.userAgent)},ay.ifSupportWebGL._renderer&&(this.deviceInfo.hardwareInfo.renderer=ay.ifSupportWebGL._renderer,this.deviceInfo.hardwareInfo.vendor=ay.ifSupportWebGL._vendor)):x.extend(this,T.prototype),ba[this.config.mapType]||(this.config.mapType=BMAP_NORMAL_MAP),this.config.mapType!==BMAP_EARTH_MAP||this.config.enableEarth||this.forceEnableEarth()===!1&&(this.config.mapType=BMAP_NORMAL_MAP),this.mapType=this.config.mapType,this.preMapType=null,this.config.enableEarth){var i=this.maskLayer.style;i.opacity=0,i.background="#000",setTimeout(function(){i.WebkitTransition=i.transition="opacity .6s"},100)}this._isHybridShow=this.config.showStreetLayer,this.temp={operating:!1,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:!1,I:function(e){return x.I(e)},curSpots:[],curSpotsArray:[],curAreaSpot:null,spotsGuid:1,registerIndex:-1,hoverOnSpot:null,isStdCtrlBusy:!1},window.InstanceCore=this.temp.I,this.platform.style.cursor=this.config.defaultCursor,this._bind();for(var n=0;n<eM._register.length;n++)eM._register[n](this);this.temp.registerIndex=n;var a=this;"webgl"===this._renderType?cz.load("oppcgl",function(){a._asyncRegister()}):cz.load("oppc",function(){a._asyncRegister()}),"B_EARTH_MAP"===this.config.mapType&&(eM.Earth?a._syncAndChangeMapType("B_EARTH_MAP"):cz.load("earth",function(){}))}function a0(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n}function l(e){var t={duration:1e3,fps:30,delay:0,transition:bl.linear,dropLastAnimation:!1};if(e)for(var i in e)t[i]=e[i];if(e.beginTime&&(this._beginTime=e.beginTime),this._callbacks=[],this._options=t,t.delay){var n=this;setTimeout(function(){n._doStart()},t.delay)}else this._doStart()}function bQ(e){return e.style}function bX(e){if(x.Browser.ie>0)e.unselectable="on",e.selectstart=function(){return!1},e.onmousedown=function(e){return e.preventDefault(),!1};else{var t=bQ(e);t.MozUserSelect="none",t.WebkitUserSelect="none",e.addEventListener("mousedown",function(e){e.preventDefault()},!1)}}function eF(e){return e&&e.parentNode&&11!=e.parentNode.nodeType}function cg(e,t){return e.insertAdjacentHTML("beforeEnd",t),e.lastChild}function eY(e,t){var i=document.createElement("div");i.innerHTML=t;var n=i.childNodes[0];return e.parentNode.insertBefore(n,e)}function g(e){e=e||window.event,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function a2(e){return e=e||window.event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function bP(e){return g(e),a2(e)}function dI(){var e=document.documentElement,t=document.body;return e&&(e.scrollTop||e.scrollLeft)?[e.scrollTop,e.scrollLeft]:t?[t.scrollTop,t.scrollLeft]:[0,0]}function dw(e){if(e){e.onload=e.onerror=null;var t,i,n,a=e.attributes;if(a)for(i=a.length,t=0;i>t;t+=1)n=a[t].name,"function"==typeof e[n]&&(e[n]=null);if(a=e.children)for(i=a.length,t=0;i>t;t+=1)dw(e.children[t])}}function aT(e,t,i){var n=t.lng-i.lng,a=t.lat-i.lat;if(0==n)return Math.abs(e.lng-t.lng);if(0==a)return Math.abs(e.lat-t.lat);var o=a/n,r=t.lat-o*t.lng;return Math.abs(o*e.lng-e.lat+r)/Math.sqrt(o*o+1)}function ex(e,t){return e&&t?Math.round(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))):void 0}function aY(e,t){return e&&t?Math.round(Math.sqrt(Math.pow(e.lng-t.lng,2)+Math.pow(e.lat-t.lat,2))):0}function bI(e,t){var i=Math.round((e.x+t.x)/2),n=Math.round((e.y+t.y)/2);return new cG(i,n)}function eJ(e,t){var i=[];t=t||function(e){return e};for(var n in e)i.push(n+"="+t(e[n]));return i.join("&")}function H(e,t,i){var n=document.createElement(e);i&&(n=document.createElementNS(i,e)),t=t||{};for(var a in t){var o={"for":"htmlFor","class":"cssClass"}[a]||a;if("style"!=a)if("class"!=a)if(n.setAttribute)n.setAttribute(o,t[a]);else try{n[o]=t[a]}catch(n){}else x.ac(n,t[a]);else n.style.cssText=t[a]}return n}function dS(e){return e.currentStyle?e.currentStyle:e.ownerDocument&&e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):void 0}function a3(e){return"function"==typeof e}function eB(e){var t,i,n,a,o,r="",s="",l="",h=0,c=/[^A-Za-z0-9\+\/\=]/g;if(!e||c.exec(e))return e;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=eN.indexOf(e.charAt(h++)),a=eN.indexOf(e.charAt(h++)),o=eN.indexOf(e.charAt(h++)),l=eN.indexOf(e.charAt(h++)),t=n<<2|a>>4,i=(15&a)<<4|o>>2,s=(3&o)<<6|l,r+=String.fromCharCode(t),64!=o&&(r+=String.fromCharCode(i)),64!=l&&(r+=String.fromCharCode(s)),t=i=s="",n=a=o=l="";while(h<e.length);return r}function dX(){return aK()||cQ()}function aK(){var e=navigator.userAgent;return e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1?!0:!1}function cQ(){var e=navigator.userAgent;return e.indexOf("Android")>-1?!0:!1}function ch(e){return e*Math.PI/180}function bR(e){return e/Math.PI*180}function cj(e,t){var i=Math.pow(10,t);if("number"==typeof e)return Math.round(e*i)/i;for(var n=0;n<e.length;n++)e[n]=cj(e[n],t);return e}function dE(e,t,i){return t>e?e=t:e>i&&(e=i),e}function dT(e,t){for(;0>e;)e+=t;return e%t}function cx(e,t){return e>=0&&t>=0||0>e&&0>t}function av(e){if(e._gl)return e._gl;var t={alpha:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,stencil:!1},i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);return e._gl=i,i}function cV(e,t){for(var i=0;i<t.length;i++)x.on(e,t[i],g)}function e7(e,t,i){t[i]=e.getUniformLocation(t,i)}function dc(e,t,i,n,a){var o="";switch(a){case"mat4":return void e.uniformMatrix4fv(t[i],!1,n);case"v3":o="uniform3fv";break;case"f":o="uniform1f";break;case"i":o="uniform1i"}if(""===o)throw"error";e[o](t[i],n)}function D(e,t){for(;0>e;)e+=360;e%=360;var i=t.width,n=t.height,a=i,o=n;if(90>e)var r=Math.sin(ch(e))*i,s=Math.sin(ch(e))*n,l=Math.cos(ch(e))*i,h=Math.cos(ch(e))*n,a=Math.ceil(l+s),o=Math.ceil(r+h);else if(180>e)var e=e-90,r=Math.sin(ch(e))*i,s=Math.sin(ch(e))*n,l=Math.cos(ch(e))*i,h=Math.cos(ch(e))*n,a=Math.ceil(r+h),o=Math.ceil(l+s);else if(270>e)var e=e-180,r=Math.sin(ch(e))*i,s=Math.sin(ch(e))*n,l=Math.cos(ch(e))*i,h=Math.cos(ch(e))*n,a=Math.ceil(l+s),o=Math.ceil(r+h);else var e=e-270,r=Math.sin(ch(e))*i,s=Math.sin(ch(e))*n,l=Math.cos(ch(e))*i,h=Math.cos(ch(e))*n,a=Math.ceil(r+h),o=Math.ceil(l+s);var c=a-i,d=o-n;return[0-c/2,0-d/2,i+c/2,n+d/2]}function eo(e){return e.toDataURL()==eo._blankData?!0:!1}function eh(e,t,i){var n=[i.lng-e.lng,i.lat-e.lat],a=[t.lng-e.lng,t.lat-e.lat];return n[0]*a[1]-n[1]*a[0]}function bh(e,t,i){var n,a,o,r;return e.lng<t.lng?(n=e.lng,o=t.lng):(n=t.lng,o=e.lng),e.lat<t.lat?(a=e.lat,r=t.lat):(a=t.lat,r=e.lat),i.lng<n||i.lng>o||i.lat<a||i.lat>r?!1:!0}function ej(e,t,i,n){var a=eh(i,n,e),o=eh(i,n,t),r=eh(e,t,i),s=eh(e,t,n);return 0>a*o&&0>r*s?!0:0===a&&bh(i,n,e)?!0:0===o&&bh(i,n,t)?!0:0===r&&bh(e,t,i)?!0:0===s&&bh(e,t,n)?!0:!1}function eW(e,t){var i=t.parentNode;i.lastChild==t?i.appendChild(e):i.insertBefore(e,t.nextSibling)}function eZ(e,t){if(0==t)return e;var i=0,n=0;if(!e)throw"异常";if(0===e.length)return[];for(var a=1,o=e.length-1;o>a;a++){var r=aT(e[a],e[0],e[e.length-1]);r>i&&(n=a,i=r)}var s=[];if(i>=t){for(var l=e.slice(0,n),h=e.slice(n,e.length),c=eZ(l,t),d=eZ(h,t),a=0,o=c.length;o>a;a++)s.push(c[a]);for(var a=0,o=d.length;o>a;a++)s.push(d[a])}else s.push(e[0]),s.push(e[e.length-1]);return s}function cR(e){return Math.log2?Math.log2(e):Math.log(e)/Math.LN2}function aH(e,t,i){return Math.min(i,Math.max(t,e))}function by(e,t){if(!t)return e;var i=t[0],n=t[1],a=t[2],o=t[3],r=[],s=[];return r[0]=o*e[0]+a*e[2],r[1]=e[1],r[2]=-a*e[0]+o*e[2],s[0]=r[0],s[1]=n*r[1]-i*r[2],s[2]=i*r[1]+n*r[2],s}function aN(e){var t=(e-Date.UTC(2e3,0,1,12))/864e5/36525,i=(d3.utcDay.floor(e)-e)/864e5*360-180;return[i-I(t)*y,el(t)*y]}function I(e){var t=dY(e),i=ci(e),n=R(e),a=Math.tan(dW(e)/2);return a*=a,a*Math.sin(2*n)-2*t*Math.sin(i)+4*t*a*Math.sin(i)*Math.cos(2*n)-.5*a*a*Math.sin(4*n)-1.25*t*t*Math.sin(2*i)}function el(e){return Math.asin(Math.sin(dW(e))*Math.sin(eA(e)))}function eA(e){return aB(e)-(.00569+.00478*Math.sin((125.04-1934.136*e)*ai))*ai}function aB(e){return R(e)+ck(e)}function ci(e){return(357.52911+e*(35999.05029-1537e-7*e))*ai}function R(e){var t=(280.46646+e*(36000.76983+3032e-7*e))%360;return(0>t?t+360:t)/180*Math.PI}function ck(e){var t=ci(e);return(Math.sin(t)*(1.914602-e*(.004817+14e-6*e))+Math.sin(t+t)*(.019993-101e-6*e)+289e-6*Math.sin(t+t+t))*ai}function dW(e){return dl(e)+.00256*Math.cos((125.04-1934.136*e)*ai)*ai}function dl(e){return(23+(26+(21.448-e*(46.815+e*(59e-5-.001813*e)))/60)/60)*ai}function dY(e){return.016708634-e*(42037e-9+1.267e-7*e)}function aw(){return window.devicePixelRatio||1}function ab(e){var t,i,n;return e>=0?(n=65536*Math.floor(e/65536),t=n,i=e-n):(n=65536*Math.floor(-e/65536),t=-n,i=e+n),[t,i]}function A(e){return e.lng>=0&&e.lat>=0?new eR(e.lng-1e7,e.lat-6e6):e.lng>=0&&e.lat<0?new eR(e.lng-1e7,e.lat+6e6):e.lng<0&&e.lat>=0?new eR(e.lng+1e7,e.lat-6e6):e.lng<0&&e.lat<0?new eR(e.lng+1e7,e.lat+6e6):void 0}function aV(e,t,i){var n="mouseWheel";return x.Platform.macintosh&&(!isNaN(e)&&(10>e||120!==e)&&t%1===0&&5>t&&(n="padScroll"),x.Browser.firefox&&t%1===0&&5>t&&0===i&&(n="padScroll")),x.Browser.safari&&12===e&&(n="mouseWheel"),n}function bT(e,t){for(var i=e[0],n=e[1],a=!1,o=0,r=t.length-2;o<t.length;o+=2){var s=t[o],l=t[o+1],h=t[r],c=t[r+1],d=l>n!=c>n&&(h-s)*(n-l)/(c-l)+s>i;d&&(a=!a),r=o}return a}function bv(e,t,i,n){return n=n||.4,e>i?e=Math.pow(e-i+1,n)+i-1:t>e&&(e=t-Math.pow(t-e+1,n)+1),e}function d8(e){for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i)<<1,a=n.toString(2),o=a.length,r=a;8>o&&(r="00000000"+a,r=r.substr(a.length,8)),t+=r}for(var s=5-t.length%5,l=[],i=0;s>i;i++)l[i]="0";t=l.join("")+t;for(var h=[],i=0;i<t.length/5;i++){var n=t.substr(5*i,5),c=parseInt(n,2)+50;h.push(String.fromCharCode(c))}return h.join("")+s.toString()}function aa(e,t){var i=eM.TVC||window.TVC;return i&&i[e]&&i[e][t]&&i[e][t].version&&i[e][t].updateDate||(i=df.tvc),{ver:i[e][t].version,udt:i[e][t].updateDate}}function dB(){var e=eM.MSV||window.MSV;return e&&e.mapstyle&&e.mapstyle.updateDate&&e.mapstyle.version||(e=df.msv),{ver:e.mapstyle.version,udt:e.mapstyle.updateDate}}function cL(e,t){for(var i=e.slice(0),n=0;n<i.length;n++)i[n]+=t;return i}function aM(e){au||(e.fire(new az("onloadtile")),au=setTimeout(function(){au=null},1e3))}function db(){return bn("//map.baidu.com")||bn("//maps.baidu.com")||bn("//ditu.baidu.com")?!0:!1}function bn(e){var t=window.location,i=document.createElement("a");return i.href=e,i.hostname===t.hostname&&i.port===t.port&&i.protocol===t.protocol}function cz(){}function M(){this._timeData={}}function d9(e){this._elemType=e,this._objCollection={}}function bz(){}function bU(e,t){this._name=e,this._baseZoom=18,this._opts={tileSize:256},x.extend(this._opts,t||{})}function b4(e){return e=e.toLowerCase(),O.indexOf(e)>=0?!0:e.indexOf("mobile")>=0?!0:!1}function dD(e){e=e.toLowerCase();for(var t=0;t<bk.length;t++)if(e.indexOf(bk[t])>=0)return!0;return!1}function cr(e){return e?b4(e)?!1:dD(e)?!0:!1:!1}function da(e,t){this._size=e,this._curSize=0,this._cache={},this._least=null,this._most=null,this._options={clearCallback:null,removeOldCallback:null},t=t||{};for(var i in t)this._options[i]=t[i];this._getDataTimes=0,this._hitTimes=0}function ax(){this._map=null,this._container,this._type="control",this.blockInfoWindow=!0,this._visible=!0}function cf(e){ax.call(this),e=e||{},this._opts={printable:!1},x.extend(this._opts,e),this._copyrightCollection=[],this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new cy(5,2),this.setAnchor(e.anchor),this._canShow=!0,this.sateMapStyle=!1,this.blockInfoWindow=!1,this._asyncLoadCode()}function eH(e){ax.call(this),e=e||{},this._opts={printable:!1},this._opts=x.extend(x.extend(this._opts,{unit:"metric"}),e),this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new cy(81,18),this.setAnchor(e.anchor),this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5280,u1:"英尺",u2:"英里"}},this.sateMapStyle=!1,this._units[this._opts.unit]||(this._opts.unit="metric"),this._scaleText=null,this._numberArray={},this._asyncLoadCode()}function b2(e){ax.call(this),e=e||{},this._opts={printable:!1},x.extend(this._opts,e),this.controlHeight=[{width:65,height:227,zoomHeight:227,zoomWidth:37,sliderHeight:180},{width:65,height:47,zoomHeight:this._opts.forceNew===!0?56:47,zoomWidth:37,sliderHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0},{width:26,height:47,zoomHeight:47,zoomWidth:6,sliderHeight:0},{width:56,height:47,zoomHeight:47,zoomWidth:37,sliderHeight:180}],this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new cy(10,10),this.setAnchor(e.anchor),this.setType(e.type),this._maxTotalZoomLv=19,this._minZoomLevel=-1,this._maxZoomLevel=-1,this._totalZoomLv=-1,this._sliderInterval=10,this._sliderHeight=180,this._minBarY=1,this._maxBarY=-1,this._curBarY=-1,this._zoomDom=null,this._zoomBtnDom=null,this._sliderDom=null,this._sliderBaseDom=null,this._cZIndex="1100",this._asyncLoadCode()}function aP(e){ax.call(this),e=e||{},this._opts={printable:!1},this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new cy(10,10),this.setAnchor(e.anchor),this._opts=x.extend(x.extend(this._opts,{offset:this.defaultOffset,enableSwitch:!0}),e);var t=this;cz.load("control",function(){t._asyncDraw()})}function ek(e,t){this._map=e,this._indoorInfo=t,this._visible=!0,this._adjustVisible=!0,this._isMobile=dX(),this._sizeConfig={FLOOR_BTN_HEIGHT:this._isMobile?35:26,SWITCH_ARROW_HEIGHT:this._isMobile?20:15},this._init()}function c6(e){this._map=e,e._navigationCtrl=this,this._firstAnimation=!0,this._init()}function e0(e,t){this._map=e,this._target=e;var i=e.temp.originMapType||e.mapType;"B_EARTH_MAP"===i&&e._earth&&(this._target=e._earth),this._outContainer=t||e.getContainer(),this._imgRatio=aw()>=1.5?2:1,this._imgPath=df.imgPath+"earth-navi-control-pc4"+(2===this._imgRatio?"-2x.png":".png"),this._enabled=!0;var n=this;this._setHeadingOptions={callback:function(){n._target.setLock(!1)}},this._init()}function cM(e,t){this._map=e,this._target=e;var i=e.temp.originMapType||e.mapType;"B_EARTH_MAP"===i&&e._earth&&(this._target=e._earth),this._outContainer=t||e.getContainer(),this._imgRatio=aw()>=1.5?2:1,this._imgPath=df.imgPath+"gl-navi-control-pc4"+(2===this._imgRatio?"-2x.png":".png"),this._enabled=!0;var n=this;this._setTiltOptions={callback:function(){n._target.setLock(!1)}},this._init()}function bg(e){cB.call(this),this._opts={container:null,cursor:"default"},this._opts=x.extend(this._opts,e),this._type="contextmenu",this._map=null,this._container,this._left=0,this._top=0,this._items=[],this._rItems=[],this._dividers=[],this._enable=!0,this.curPixel=null,this.curPoint=null,this._isOpen=!1;var t=this;cz.load("menu",function(){t._draw()})}function dA(e,t,i){if(e&&t&&"function"==typeof t){cB.call(this),this._opts={width:100,id:""},i=i||{},this._opts.width=1*i.width?i.width:100,this._opts.id=i.id?i.id:"",this._text=e+"",this._callback=t,this._map=null,this._type="menuitem",this._contextmenu=null,this._container=null,this._enabled=!0;var n=this;cz.load("menu",function(){n._draw()})}}function cm(e,t,i,n){this.setValues(e,t,i,n)}function eR(e,t){isNaN(e)&&(e=eB(e),e=isNaN(e)?0:e),"string"==typeof e&&(e=parseFloat(e)),isNaN(t)&&(t=eB(t),t=isNaN(t)?0:t),"string"==typeof t&&(t=parseFloat(t)),this.lng=e,this.lat=t}function cI(){}function bK(e,t){for(-90>e?e=-90:e>90&&(e=90);-180>t;)t+=360;for(;t>180;)t-=360;this.lat=e||0,this.lng=t||0}function cT(e,t){e&&!t&&(t=e),this._sw=this._ne=null,this._swLng=this._swLat=null,this._neLng=this._neLat=null,e&&(this._sw=new bK(e.lat,e.lng),this._ne=new bK(t.lat,t.lng),this._swLng=e.lng,this._swLat=e.lat,this._neLng=t.lng,this._neLat=t.lat)}function aF(){this._type="overlay"}function bC(){x.BaseClass.call(this),aF.call(this),this._visible=!0,this._visibleInternal=!0,this.infoWindow=null,this._dblclickTime=0}function c8(e){this.map=e,this._overlays={},this._overlayArray=[],this._customOverlays=[],e._overlays=this._overlays,e._overlayArray=this._overlayArray,e._customOverlays=this._customOverlays,this._zoomingOrMoving=!1,this._init()}function s(e){bC.call(this),this._config={strokeColor:"#3a6bdb",strokeWeight:5,strokeOpacity:.65,strokeStyle:"solid",strokeLineCap:"round",strokeLineJoin:"round",enableMassClear:!0,getParseTolerance:null,getParseCacheIndex:null,enableParse:!0,enableEditing:!1,mouseOverTolerance:15,geodesic:!1,clip:!0},this.setConfig(e),this._config.strokeWeight<=0&&(this._config.strokeWeight=5),(this._config.strokeOpacity<0||this._config.strokeOpacity>1)&&(this._config.strokeOpacity=.65),(this._config.fillOpacity<0||this._config.fillOpacity>1)&&(this._config.fillOpacity=.65),"solid"!==this._config.strokeStyle&&"dashed"!==this._config.strokeStyle&&"dotted"!==this._config.strokeStyle&&(this._config.strokeStyle="solid"),this.domElement=null,this._bounds=new eM.Bounds(0,0,0,0),this.points=[],this.greatCirclePoints=[],this._parseCache=[],this._holesCache=[],this._parseCacheGL=[],this._parseCacheGLRaw=[],this._areaCacheGL=[],this._strokeStyleInfoForGL=[[]],this._fillStyleInfoForGL="",this.vertexMarkers=[],this._temp={}}function eE(e,t,i){if(e&&t){this.imageUrl=null,this.imageDom=null,"string"==typeof e?this.imageUrl=e:(this.imageDom=e,this.imageDom.id||(this.imageDom.id=eM.getGUID("icon_dom_"))),this.size=t;var n=new cy(Math.floor(t.width/2),Math.floor(t.height/2)),a={offset:n,imageOffset:new cy(0,0)};i=i||{};for(var o in i)a[o]=i[o];i.anchor&&(a.offset=i.anchor),this.anchor=this.offset=a.offset,this.imageOffset=a.imageOffset,this.infoWindowOffset=i.infoWindowOffset||this.offset,this.printImageUrl=i.printImageUrl||"",this.imageSize=i.imageSize,this.srcSetObject={},this.setImageSrcset(i.srcSet)}}function U(e,t){x.BaseClass.call(this),this.content=e,this.map=null,this._config={width:0,height:0,maxWidth:600,offset:new cy(0,0),title:"",maxContent:"",enableMaximize:!1,enableAutoPan:!0,enableCloseOnClick:!0,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:!1,onClosing:function(){return!0}},this.setConfig(t),0!=this._config.width&&(this._config.width<220&&(this._config.width=220),this._config.width>730&&(this._config.width=730)),0!=this._config.height&&(this._config.height<60&&(this._config.height=60),this._config.height>650&&(this._config.height=650)),0!=this._config.maxWidth&&(this._config.maxWidth<220&&(this._config.maxWidth=220),this._config.maxWidth>730&&(this._config.maxWidth=730)),this.isWinMax=!1,this.IMG_PATH=df.imgPath,this.overlay=null;var i=this;cz.load("infowindow",function(){i._draw()})}function af(e,t){bC.call(this),this.content=e,this.map=null,this.domElement=null,this._config={width:0,offset:new cy(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",fontSize:"12px",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:!0},t=t||{},this.setConfig(t),this._config.width<0&&(this._config.width=0),this.point=this._config.point;var i=this;cz.load("marker",function(){i._draw()})}function b0(e,t){bC.call(this),t=t||{},this.point=e,this.latLng=cI.convertMC2LL(e),this._rotation=0,this.map=null,this._animation=null,this.domElement=null,this.iconDom=null,this.infoWindowDom=null,this.siblingElement=null,this.textureCoord=null,this.textureCoordGLMap=null,this.collisionDetectionFailed=!1,this._config={offset:new cy(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:!0,zIndexFixed:!1,isTop:!1,enableMassClear:!0,enableDragging:!1,raiseOnDrag:!1,restrictDraggingArea:!1,startAnimation:"",enableCollisionDetection:!1,rank:0,enableDraggingMap:!1},this.setConfig(t),t.icon||(this._config.icon=new eE(df.imgPath+"marker_red.png",new cy(23,25),{offset:new cy(10,25),infoWindowOffset:new cy(10,0)})),this._isDragging=!1;var i=this;cz.load("marker",function(){i._draw()})}function a(e,t){s.call(this,t),this.setPoints(e);var i=this;cz.load("poly",function(){i._draw()})}function dt(e,t){s.call(this,t),this._normalizedBounds=new cm,this.setPoints(e);var i=this;cz.load("poly",function(){i._draw()})}function aj(e,t){s.call(this,t),t=t||{},this._config.fillOpacity="number"==typeof t.fillOpacity?t.fillOpacity:.65,dE(this._config.fillOpacity,0,1),this._config.fillColor=""===t.fillColor?"":t.fillColor?t.fillColor:"#fff",this._parseFillCacheWebGL=[],this.setPoints(e,t);var i=this;cz.load("poly",function(){i._draw()})}function d0(e,t,i){this.point=e,this.radius=Math.abs(t),aj.call(this,[],i)}function e1(e,t){x.BaseClass.call(this),this.content=e,this.map=null,this._config={width:0,height:0,maxWidth:600,offset:new cy(0,0),title:"",maxContent:"",enableMaximize:!1,enableAutoPan:!0,enableCloseOnClick:!0,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:!1,onClosing:function(){return!0}},this.setConfig(t),this._config.width<50&&(this._config.width=50),this._config.width>730&&(this._config.width=730),0!=this._config.height&&(this._config.height<50&&(this._config.height=50),this._config.height>650&&(this._config.height=650)),0!==this._config.maxWidth&&(this._config.maxWidth<50&&(this._config.maxWidth=50),this._config.maxWidth>730&&(this._config.maxWidth=730)),this.isWinMax=!1,this.IMG_PATH=df.imgPath,this.overlay=null;var i=this;cz.load("simpleInfowindow",function(){i._draw()})}function cG(e,t){e=isNaN(e)?0:e,t=isNaN(t)?0:t,this.x=e,this.y=t}function cy(e,t){this.width=parseFloat(e)||0,this.height=parseFloat(t)||0}function a1(e,t,i,n,a){this.mgr=e,this.position=i,this._cbks=[],this.name=e.getTileName(n,a),this.info=n,this._transparentPng=a.isTransparentPng();var o=H("img");bX(o),o.galleryImg=!1;var r=o.style;r.position="absolute",r.width=e.tileSize+"px",r.height=e.tileSize+"px",r.left=i[0]+"px",r.top=i[1]+"px",this.img=o,this.src=t,L&&0===i._offsetX&&(r.opacity=0,r.willChange="opacity");var s=this;this.img.onload=function(e){if(s.mgr){var t=s.mgr,n=t.bufferTiles;t.bufferNumber>0&&(n[s.name]=s,n.push(s.name));for(var o=n.length-t.bufferNumber,r=0;o>0&&r<n.length;r++){var h=n[r];if(!t.mapTiles[h]){if(n[h]){n[h].mgr=null;var c=n[h].img;c.parentNode&&(dw(c),c.parentNode.removeChild(c)),c=null,n[h].img=null,n[h]=null,delete n[h]}n.splice(r,1),r--,o--}}s.loaded=!0,t.imgNumber++,eF(s.img)||a.tilesDiv&&a.tilesDiv.appendChild(s.img);var e=new az("onimagechange");e.action="show",e.tile=s.name,t.map.dispatchEvent(e),L&&0===i._offsetX&&new l({fps:10,duration:300,render:function(e){s.img&&s.img.style&&(s.img.style.opacity=1*e)},finish:function(){s.img&&s.img.style&&(delete s.img.style.opacity,s.img.style.willChange="auto")}}),s._callCbks()}},this.img.onerror=function(){if(s.error=!0,s._callCbks(),s.mgr){var e=(s.mgr,ba[a.mapType]);e.errorUrl&&(s.img.src=e.errorUrl),eF(s.img)||a.tilesDiv&&a.tilesDiv.appendChild(s.img)}},o=null;var h=new az("onimagebefore");h.tile=s.name,e.map.dispatchEvent(h)}function dm(e){this.tileLayers=[],this.map=e,this.bufferNumber=300,this.mapTiles=[],this.bufferTiles=[],this.config=ba[this.map.mapType],this.errorUrl=this.config.errorUrl,this.tileSize=this.config.tileSize,this.baseUnits=this.config.baseUnits,this.baseZoomLevel=this.config.zoomLevelBase,this.tileURLs=this.config.tileUrls,this.imgNumber=0,this.numLoading=0,this.temp={}}function bA(e){this.opts=e||{},this.copyright=this.opts.copyright||{},this.transparentPng=this.opts.transparentPng||!1,this.png8=this.opts.png8||!1,this.baseLayer=this.opts.baseLayer||!1,this.dataType=this.opts.dataType||1,this.isFlat=this.opts.isFlat===!1?!1:!0,this.showLabel=this.opts.showLabel===!1?!1:!0;var t=this.opts.tileTypeName||"web";this.tileType=bz.getInstance(t),this.clipTile=this.opts.clipTile||!1,this._type="tilelayer";var i=dX()?128:256;this.cacheSize=this.opts.cacheSize||i;var n=this;this.tileCache=new da(this.cacheSize,{clearCallback:function(e){n._removeIndoorData(e)}}),this.scaler=aw()>=1.5?2:1,this.normalUdt=aa("ditu","normal").udt,this.numLoading=0,this.useThumbData=!1,this.baseLayer&&(this.useThumbData=!0),this.customLayer="boolean"==typeof this.opts.customLayer?this.opts.customLayer:!0}function bL(e,t,i){this.bounds=e,this.content=t,this.mapType=i}function Q(e){this._map=e,this._tileMgr=e.tileMgr,this._animationDiv=null,this._preAnimationDiv=null,this._animation=null,this._baseLayerDiv=null,this._transformStyleName=ay.ifSupportCSS3("transform",!0),this._transformOriginStyleName=ay.ifSupportCSS3("transformOrigin",!0),this._preZoomTimes=1,this._preRenderTick=1,this._enableCanvas2dMap=!("canvas"!==e.getRenderType()),this._isIE9=!(9!==x.Browser.ie);var t=this;e.addEventListener("maptypechange",function(){t.hide()}),e.addEventListener("load",function(){t.hide()})}function c(e){this._initVars(e),this._initColorCanvas(),this._bindEvent(e)}function cA(e){this._initVars(e)}function P(e){this._map=e,this._initCanvas(),this._initVars(),this._bindEvent(),this._tileType=bz.getInstance("na")}function ap(e){this._canvas2dMapMgr=e;this.ratio=e._map.config.ratio;this._featureStyle=null,this._map=e._map;{var t=dB();"udt="+t.udt+"&v="+t.ver}this.sizeRatio=this.ratio>1?2:1,this._binaryCache={},this._iconCache={},this._initColorCanvas()}function et(e){this.initVars(e)}function bM(){}function dL(e){this._jobQueue=[],this._idleOnlyJobQueue=[];var t=this;this.isIdle=!0,e.on("updateframe",function(e){var i=12-e.frameTime;i=1>i?1:i,t.isIdle=!1,t.idleWorkTimer&&(clearInterval(t.idleWorkTimer),t.idleWorkTimer=null),t.runJobs(i)}),this._idleWorkerTicker=function(e){return function(){e.isIdle&&(e.runJobs(),e.runIdleOnlyJobs())}}(this),e.on("mapglidle",function(){t.isIdle=!0,t.runJobs(),t.runIdleOnlyJobs(),t.idleWorkTimer=setInterval(t._idleWorkerTicker,dL.MAX_IDLE_TIME)})}function r(){this._ratio=aw(),this._iconCache={},this._drawingCanvasPool=[],this._drawingCanvasHeight=4096}function bm(e,t,i){var n=e.bds;if(!n)return!1;var a,o=e.tracer;if(o){bB[o]||(a=o.toString(2),a.length<8&&(a=new Array(8-a.length+1).join("0")+a),bB[o]=a),a=bB[o];var r=bU.mapZoomStartZoomMapping[t];return"1"===a[t-r]}var s=e.displayRange;return i>=s[0]&&i<=s[1]?!0:!1}function bW(e,t){this.map=e.map,this.layer=e,t=t||[],this.allLabels=[],this._spotData=[],this._strategyInfo=null,this.RANK1=1e6,this.RANK2=2e6,this.RANK3=3e6,this.RANK4=4e6,this.RANK5=5e6,this._useRound=!1,this._mapIsMoving=!1,this._onMapIdleCallback=t.onMapIdleCallback,this.map.temp.isPermitSpotOver=!0,this.currentSelectedLabel=null,this.map._labelProcessor=this,this.iconCache={},this.fixedLabelData=[],this.lineLabelData=[],this.highlightLabelData=[],this._iconLoadTimer=null,this._labelTextCanvas=null,"canvas"===this.map.config.textRenderType&&(this._labelTextCanvas=this.map.tileMgr.getLabelTextCanvas()),this.bind()}function dO(e){this._map=e,this.virtualTile={custom:!0,label:{fixedLabel:[],indoorLabel:[],lineLabel:[],textureHeights:[],status:"ready"},tileInfo:{col:0,row:0,zoom:0,useZoom:0,loopOffsetX:0},status:"ready"},this.virtualTile.label.tileInfo=this.virtualTile.tileInfo,this.init()}function cZ(e){var t=null;try{b5.inMapHost?(t=new Worker(e),t.onerror=function(i){i.preventDefault(),t=p(e)}):t=p(e)}catch(i){t=p(e)}return t}function p(e){var t=null;try{var i;try{i=new Blob(['importScripts("'+e+'");'],{type:"application/javascript"})}catch(n){var a=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);a.append('importScripts("'+e+'");'),i=a.getBlob("application/javascript")}var o=window.URL||window.webkitURL,r=o.createObjectURL(i);t=new Worker(r)}catch(s){}return t}function cn(e){this.tileLayers=[],this.map=e;var t=this.config=ba[this.map.mapType];this.errorUrl=t.errorUrl,this.tileSize=t.tileSize,this.baseUnits=t.baseUnits,this.baseZoomLevel=t.zoomLevelBase,this.tileURLs=t.tileUrls,this.tilesInfoCache={},this.loadDelay=10,this._labelTextCanvas=null}function am(e){this._indoorData={},this._map=e,this.currentUid=null,this.currentFloor=null,this._indoorControl=null,this.enterMethod=null,this.showMask=!1,this._isMobile=dX(),this._autoEnterZoom=19,this._isMobile&&(this._autoEnterZoom=17),this._init(e),window._indoorMgr=this}function ce(e){e.container.appendChild(this.render()),this.bind(e)}function dV(e){cB.call(this),e&&(this._opts={},this._map=e,this._maxLat=84.6,this._minLat=-80.6,this._maxLatMC=cI.convertLL2MC(new bK(this._maxLat,0)).lat,this._minLatMC=cI.convertLL2MC(new bK(this._minLat,0)).lat)}function es(e,t){dV.call(this,e),t=t||{},this._opts=x.extend(x.extend(this._opts||{},{autoClear:!1,tips:"测距",followText:"单击确定起点，双击结束绘制",unit:"metric",showResult:!0,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:df.distCursor,styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:!0}),t),this._opts.showResult===!1&&("undefined"==typeof t.tips&&(this._opts.tips="绘制折线"),t.cursor||(this._opts.cursor="crosshair")),this._opts.lineStroke<=0&&(this._opts.lineStroke=2),this._opts.opacity>1?this._opts.opacity=1:this._opts.opacity<0&&(this._opts.opacity=0),"solid"!==this._opts.lineStyle&&"dashed"!==this._opts.lineStyle&&(this._opts.lineStyle="solid"),this._checked=!1,this._drawing=null,this.followTitle=null,this._totalDis={},this._points=[],this._paths=[],this._dots=[],this._segDistance=[],this._overlays=[],this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}},this._units[this._opts.unit]||(this._opts.unit="metric"),this._dLineColor="#ff6319",this._dLineStroke=3,this._dOpacity=.8,this._dLineStyle="solid",this._dCursor=df.distCursor,this._opts.showResult&&(this._opts.followText="单击确定起点"),this._followTextM="单击确定地点，双击结束",this._sectionMarkerTip="单击可删除此点，拖拽可调整位置",this._movingTimerId=null,this.text=this._opts.showResult?"测距":"绘线",this._isOpen=!1;var i=this;cz.load("tools",function(){i._draw()})}function bq(){var e=3,t=256,i=Math.pow(2,18-e)*t,n=2,a=(n+1)*i,o=cI.convertLL2MC(new eR(180,0)),r=o.lng,s=a-r,l=-3,h=l*i,c=cI.convertLL2MC(new eR(-180,0)),d=c.lng,u=d-h;this._validPixels=r/Math.pow(2,18-e),this._mc180X=r,this._mcM180X=d,this._loopOffset=s+u,this._mcTSpan=r-d,this._spaceDistance=s,this._mSpaceDistance=u}var x=x||{version:"20150702",emptyFn:function(){}};if(function(){x._log=[];var e=0,t={};x.BaseClass=function(e){t[this.hashCode=e||x.BaseClass.guid()]=this},x.BaseClass.guid=function(){return"mz_"+(e++).toString(36)},x.BaseClass.create=function(){var e=new x.BaseClass;return e.decontrol(),e};x.instance=x.I=function(e){return t[e]};x.BaseClass.prototype.dispose=function(){this.hashCode&&delete t[this.hashCode];for(var e in this)"function"!=typeof this[e]&&delete this[e]},x.BaseClass.prototype.getHashCode=function(){return this.hashCode||(t[this.hashCode=x.BaseClass.guid()]=this),this.hashCode},x.BaseClass.prototype.decontrol=function(){delete t[this.hashCode]},x.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"
},x.BaseClass.prototype._wlog=function(e,t){var i=x._log;i.length>100&&(i.reverse().length=50,i.reverse()),i[i.length]="["+e+"]["+(this._className||"Object")+" "+this.hashCode+"] "+t}}(),Function.prototype.inherits=function(e,t){var i,n,a=this.prototype,o=function(){};o.prototype=e.prototype,n=this.prototype=new o,"string"==typeof t&&(n._className=t);for(i in a)n[i]=a[i];return this.prototype.constructor=a.constructor,a=o=null,n},x.BaseEvent=function(e,t){this.type=e,this.returnValue=!0,this.target=t||null,this.currentTarget=this.srcElement=null,this.cancelBubble=!1,this.domEvent=null},x.BaseClass.prototype.on=x.BaseClass.prototype.addEventListener=function(e,t,i){if("function"!=typeof t)return this._wlog("error","addEventListener:"+t+" is not a function");this._listeners||(this._listeners={});var n,a=this._listeners;"string"==typeof i&&i&&(/[^\w\-]/.test(i)?this._wlog("warning","nonstandard key:"+i):(t.hashCode=i,n=i)),0!=e.indexOf("on")&&(e="on"+e),"object"!=typeof a[e]&&(a[e]={}),n=n||x.BaseClass.guid(),t.hashCode=n,a[e][n]&&this._wlog("warning","repeat key:"+n),a[e][n]=t},x.BaseClass.prototype.off=x.BaseClass.prototype.removeEventListener=function(e,t){if("function"==typeof t)t=t.hashCode;else if("string"!=typeof t)return;this._listeners||(this._listeners={}),0!=e.indexOf("on")&&(e="on"+e);var i=this._listeners;i[e]&&i[e][t]&&delete i[e][t]},x.BaseClass.prototype.fire=x.BaseClass.prototype.dispatchEvent=function(e){this._listeners||(this._listeners={});var t,i=this._listeners,n=e.type;if(e.target=e.srcElement=e.target||e.srcElement||this,e.currentTarget=this,"function"==typeof this[n]&&this[n](e),"object"==typeof i[n])for(t in i[n])"function"==typeof i[n][t]&&i[n][t].call(this,e);return e.returnValue},x.BaseEvent.prototype.inherit=function(e){var t=this;return this.domEvent=e=window.event||e,t.clientX=e.clientX||e.pageX,t.clientY=e.clientY||e.pageY,t.offsetX=e.offsetX||e.layerX,t.offsetY=e.offsetY||e.layerY,t.screenX=e.screenX,t.screenY=e.screenY,t.ctrlKey=e.ctrlKey||e.metaKey,t.shiftKey=e.shiftKey,t.altKey=e.altKey,t},x.Browser=function(){var e=navigator.userAgent,t=0,i=0,n=0,a=0,o=0,r=0,s=0,l=0,h=0,c=0;"object"==typeof window.opera&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(e)?n=parseFloat(RegExp.$2):/OPR(\/(\d+)(\..?)?)/.test(e)?n=parseInt(RegExp.$2,10):/Edge\/((\d+)\.\d+)/.test(e)?t=parseInt(RegExp.$2,10):/MSIE (\d+(\.\d+)?)/.test(e)?i=parseFloat(RegExp.$1):e.indexOf("Trident")>-1&&/rv:(\d+(\.\d+)?)/.test(e)?i=parseInt(RegExp.$1,10):/Firefox(\s|\/)(\d+(\.\d+)?)/.test(e)?o=parseFloat(RegExp.$2):"Netscape"===navigator.vendor&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(e)?s=parseFloat(RegExp.$2):e.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(e)&&(a=parseFloat(RegExp.$1)),e.indexOf("Trident")>-1&&/Trident\/(\d+(\.\d+)?)/.test(e)?l=parseInt(RegExp.$1,10):!i&&!t&&e.indexOf("Gecko")>-1&&-1===e.indexOf("KHTML")&&/rv\:(\d+(\.\d+)?)/.test(e)?h=parseFloat(RegExp.$1):!t&&/chrome\/(\d+(\.\d+)?)/i.test(e)?r=parseFloat(RegExp.$1):!t&&/AppleWebKit\/(\d+(\.\d+)?)/.test(e)&&(c=parseInt(RegExp.$1,10));var d={edge:t,ie:i,firefox:o,netscape:s,opera:n,safari:a,chrome:r,gecko:h,trident:l,webkit:c};return d}(),window.FeBrowser=x.Browser,x.Dom={},x.Dom.createDom=function(e,t){x.isIE&&t&&t.name&&(e="<"+e+' name="'+x.String.escapeHTML(t.name)+'">');var i=document.createElement(e);return t&&x.Dom.setProperties(i,t),i},x.Dom.getOffset=function(e){var t=x.Dom.getOwnerDocument(e),i=x.isGecko>0&&t.getBoxObjectFor&&"absolute"==x.Dom.getStyle(e,"position")&&(""===e.style.top||""===e.style.left),n={left:0,top:0},a=x.isIE&&!x.isStrict?t.body:t.documentElement;if(e==a)return n;var o,r=null;if(e.getBoundingClientRect)o=e.getBoundingClientRect(),n.left=o.left+Math.max(t.documentElement.scrollLeft,t.body.scrollLeft),n.top=o.top+Math.max(t.documentElement.scrollTop,t.body.scrollTop),n.left-=t.documentElement.clientLeft,n.top-=t.documentElement.clientTop,x.isIE&&!x.isStrict&&(n.left-=2,n.top-=2);else if(t.getBoxObjectFor&&!i){o=t.getBoxObjectFor(e);var s=t.getBoxObjectFor(a);n.left=o.screenX-s.screenX,n.top=o.screenY-s.screenY}else{r=e;do{if(n.left+=r.offsetLeft,n.top+=r.offsetTop,x.isWebkit>0&&"fixed"==x.Dom.getStyle(r,"position")){n.left+=t.body.scrollLeft,n.top+=t.body.scrollTop;break}r=r.offsetParent}while(r&&r!=e);for((x.isOpera>0||x.isWebkit>0&&"absolute"==x.Dom.getStyle(e,"position"))&&(n.top-=t.body.offsetTop),r=e.offsetParent;r&&r!=t.body;)n.left-=r.scrollLeft,x.isOpera&&"TR"==r.tagName||(n.top-=r.scrollTop),r=r.offsetParent}return n},x.Dom.getOwnerDocument=function(e){return 9==e.nodeType?e:e.ownerDocument||e.document},x.Dom.setProperties=function(e,t){x.each(t,function(t,i){x.Dom._setProperty(e,i,t)})},x.Dom._setProperty=function(e,t,i){"style"==t?e.style.cssText=i:"class"==t?e.className=i:"for"==t?e.htmlFor=i:t in x.Dom._DIRECT_ATTRIBUTE_MAP?e.setAttribute(x.Dom._DIRECT_ATTRIBUTE_MAP[t],i):e[t]=i},x.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"},x.G=function(){for(var e=[],t=arguments.length-1;t>-1;t--){var i=arguments[t];e[t]=null,"object"==typeof i&&i&&i.dom?e[t]=i.dom:"object"==typeof i&&i&&i.tagName||i==window||i==document?e[t]=i:"string"==typeof i&&(i=document.getElementById(i))&&(e[t]=i)}return e.length<2?e[0]:e},x.ac=function(e,t){(e=this.G(e))&&(t=this.trim(t),new RegExp("(^| )"+t.replace(/(\W)/g,"\\$1")+"( |$)").test(e.className)||(e.className=e.className.split(/\s+/).concat(t).join(" ")))},x.addClassName=x.ac,x.each=function(e,t){if("function"!=typeof t)return e;if(e)if(void 0===e.length)for(var i in e)t.call(e[i],e[i],i);else for(var n=0,a=e.length;a>n;n++)t.call(e[n],e[n],n);return e},x.extend=function(e,t){if(e&&t&&"object"==typeof t){for(var i in t)e[i]=t[i];for(var n,a=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],o=0;o<a.length;o++)n=a[o],Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},x.hide=function(){x.each(arguments,function(e){(e=x.G(e))&&(e.style.display="none")})},x.inherit=function(e,t,i){var n=e.prototype,a=function(){};a.prototype=t.prototype;var o=e.prototype=new a;"string"==typeof i&&(o._className=i);for(var r in n)o[r]=n[r];return e.prototype.constructor=n.constructor,n=null,o},x.isIE=0,function(){navigator.userAgent.indexOf("MSIE")>0&&!window.opera&&(/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent),x.isIE=parseFloat(RegExp.$1))}(),x.rc=function(e,t){if(e=this.G(e)){t=this.trim(t);var i=e.className.replace(new RegExp("(^| +)"+t.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");e.className!=i&&(e.className=i)}},x.removeClassName=x.rc,x.show=function(){this.each(arguments,function(e){(e=x.G(e))&&(e.style.display="")})},x.trim=function(e){return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")},"undefined"!=typeof HTMLElement&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera)try{HTMLElement.prototype.__defineGetter__("children",function(){for(var e,t=[],i=0,n=0,a=this.childNodes.length;a>n;n++)e=this.childNodes[n],1==e.nodeType&&(t[i++]=e,e.name&&(t[e.name]||(t[e.name]=[]),t[e.name][t[e.name].length]=e),e.id&&(t[e.id]=e));return t})}catch(ei){}"undefined"==typeof HTMLElement||window.opera||!HTMLElement.prototype||HTMLElement.prototype.insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(e,t){var i=this.ownerDocument.createRange();switch(i.setStartBefore(this),i=i.createContextualFragment(t),e){case"beforeBegin":this.parentNode.insertBefore(i,this);break;case"afterBegin":this.insertBefore(i,this.firstChild);break;case"beforeEnd":this.appendChild(i);break;case"afterEnd":this.nextSibling?this.parentNode.insertBefore(i,this.nextSibling):this.parentNode.appendChild(i)}}),"undefined"==typeof HTMLElement||window.opera||(HTMLElement.prototype.contains=function(e){if(e==this)return!0;for(;e=e.parentNode;)if(e==this)return!0;return!1}),x.Browser.ie||"undefined"==typeof Event||window.opera||(Event.prototype.__defineSetter__("returnValue",function(e){return e||this.preventDefault(),e}),Event.prototype.__defineSetter__("cancelBubble",function(e){return e&&this.stopPropagation(),e})),x.each=function(e,t){if(a3(t))for(var i=0,n=e.length;n>i&&t.call(e,e[i],i)!==!1;i++);return e},x.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var ec in x.Platform)x.Platform.hasOwnProperty(ec)&&(x.Platform[ec]=new RegExp(ec,"i").test(window.navigator.userAgent)?1:0);"undefined"==typeof x.Dom&&(x.Dom={}),x.Dom.getComputedStyle=function(e,t){var i,n=9==e.nodeType?e:e.ownerDocument||e.document;if(n.defaultView&&n.defaultView.getComputedStyle){if(i=n.defaultView.getComputedStyle(e,null))return i[t]||i.getPropertyValue(t)}else if(e.currentStyle)return e.currentStyle[t]||"";return""};var az=x.BaseEvent,cB=x.BaseClass;cB.prototype.toString=function(){return this._className||""},x.on=function(e,t,i){return(e=x.G(e))?(t=t.replace(/^on/,""),e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i),e):e},x.un=function(e,t,i){return(e=x.G(e))?(t=t.replace(/^on/,""),e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i),e):e},x.hc=function(e,t){if(!e||!e.className||"string"!=typeof e.className)return!1;var i=-1;try{i=e.className==t||e.className.search(new RegExp("(\\s|^)"+t+"(\\s|$)"))}catch(n){return!1}return i>-1};var c7={imgPath:"//webmap0.bdimg.com/image/api/",tileDomain:["https://ss0.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv","https://ss1.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv","https://ss2.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv","https://ss3.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv"],optDomain:"http://10.120.25.45:8017",rasterTilePath:"/tile/",vectorTilePath:"/pvd/",originTilePath:["https://pcor.baidu.com"],iconSetPath:"https://ss0.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv/sty/map_icons2x/",getMapStyleFiles:function(){var e=dB(),t="udt="+e.udt+"&v="+e.ver,i="https://ss0.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv/sty/";return[i+"icons_2x.js?"+t,i+"fs.js?"+t,i+"indoor_fs.js?"+t]},tvc:{ditu:{normal:{version:"088",updateDate:"20180105"},satellite:{version:"009",updateDate:"20180105"},normalTraffic:{version:"081",updateDate:"20180105"},satelliteTraffic:{version:"083",updateDate:"20180105"},mapJS:{version:"104",updateDate:"20180105"},satelliteStreet:{version:"083",updateDate:"20180105"},panoClick:{version:"1033",updateDate:"20180108"},panoUdt:{version:"20180108",updateDate:"20180108"},panoSwfAPI:{version:"20150123",updateDate:"20150123"},panoSwfPlace:{version:"20141112",updateDate:"20141112"},earthVector:{version:"001",updateDate:"20180105"}}},msv:{mapstyle:{updateDate:"20190108",version:"001"}}},df=c7,at="ruler.cur";x.Browser.ie||x.Browser.edge?x.extend(df,{distCursor:"url("+df.imgPath+at+"),crosshair",defaultCursor:"url("+df.imgPath+"openhand.cur),default",draggingCursor:"url("+df.imgPath+"closedhand.cur),move"}):x.Browser.firefox?x.extend(df,{distCursor:"url("+df.imgPath+at+"),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"}):x.Browser.chrome||x.Browser.safari?(x.extend(df,{distCursor:"url("+df.imgPath+at+") 2 6,crosshair",defaultCursor:"url("+df.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+df.imgPath+"closedhand.cur) 8 8,move"}),x.Platform.macintosh&&(df.defaultCursor="-webkit-grab",df.draggingCursor="-webkit-grabbing")):x.extend(df,{distCursor:"url("+df.imgPath+at+"),crosshair",defaultCursor:"url("+df.imgPath+"openhand.cur),default",draggingCursor:"url("+df.imgPath+"closedhand.cur),move"});var eM=eM||{version:"3.0",_register:[],register:function(e){this._register[this._register.length]=e},guid:1,getGUID:function(e){return(e||"")+eM.guid++}};dJ.prototype.setData=function(e,t){var i=this._cache,n=this._size;0!==n&&(i.length>n&&this._removeOld(),i[e]||i.push(t),i[e]=t,t._key_=e)},dJ.prototype.getHitRate=function(){return Math.round(this._totalHitTimes/this._totalGetTimes*1e3)/1e3},dJ.prototype.getData=function(e){var t=this._cache[e];return t&&this._totalHitTimes++,this._totalGetTimes++,t},dJ.prototype.removeData=function(e){this._options.clearCallback&&this._options.clearCallback(this._cache[e]);for(var t=this._cache,i=t[e],n=0,a=t.length;a>n;n++)if(t[n]===i){t.splice(n,1);break}delete t[e]},dJ.prototype._removeOld=function(){for(var e=this._cache,t=Math.round(.6*this._size),i=0;t>i;i++){var n=e[i]._key_;this._options.clearCallback&&this._options.clearCallback(e[n]),delete e[n]}e.splice(0,t),this._options.removeOldCallback&&this._options.removeOldCallback()},dJ.prototype.clear=function(){for(var e=this._cache,t=0,i=e.length;i>t;t++){var n=e[t]._key_;this._options.clearCallback&&this._options.clearCallback(e[n]),delete e[n]}this._cache=e=[]},dJ.prototype.forEach=function(e){for(var t=this._cache,i=0,n=t.length;n>i;i++){var a=t[i]._key_;e(t[a])}},dJ.prototype.getBatch=function(e){for(var t=[],i=0,n=e.length;n>i;i++)this.getData(e[i])&&(t[t.length]=this.getData(e[i]));return t},dJ.prototype.clearExcept=function(e){for(var t=this._cache,i=t.length,n=i-1;n>=0;n--){var a=this._cache[n]._key_;e[a]||(t.splice(n,1),this._options.clearCallback&&this._options.clearCallback(t[a]),delete t[a])}},dJ.prototype.getDataCount=function(){return this._cache.length},x.extend(T.prototype,{centerAndZoom:function(e,t,i){function n(){a._earth=new eM.Earth(a,{showRealSunlight:a.config.showRealSunlight,showMilkyway:a.config.showMilkyway,earthBackground:a.config.earthBackground}),a._proxyEarthEvents(),a._changeEarthMapType(BMAP_EARTH_MAP),x.extend(a,eM.EarthView.prototype),!a._navigationCtrl&&a.config.showControls&&(a._navigationCtrl=new eM.NavigationControl3D(a)),delete a.temp.originMapType}var a=this;if(e||t){e=e||this.centerPoint,t=t||this.zoomLevel,t=this._getProperZoom(t).zoom,this.mapType===BMAP_EARTH_MAP&&(this._earth||(this.mapType=BMAP_NORMAL_MAP,this.temp.originMapType=BMAP_EARTH_MAP,cz.load("earth",function(){window.FeatureStyle?n():eL.load(df.getMapStyleFiles(),function(){n()})}))),this.lastLevel=this.zoomLevel||t,this.zoomLevel=t;var o=new az("onload");if(o.point=e,o.zoom=t,this.centerPoint=this.restrictCenter(new eR(e.lng,e.lat)),this.centerPoint.zoom&&(this.zoomLevel=this.centerPoint.zoom),this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel,this.defaultCenter=this.defaultCenter||this.centerPoint,!this.loaded&&this.temp.originMapType!==BMAP_EARTH_MAP){var r=this.config.defaultMaxBounds,s=new bL(r,"baidu",this.mapType),l=new bA({mapType:this.mapType,copyright:s,customLayer:!1,baseLayer:!0,tileTypeName:"web"});l._isInnerLayer=!0,this.addTileLayer(l),this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===!0&&this._addHybirdMap()}this.dispatchEvent(o),this.loaded=!0,i=i||{},i.callback&&i.callback()}},_setPlatformPosition:function(e,t,i){if(i=i||{},0!==e||0!==t||i.point){isNaN(i.initMapOffsetX)&&(i.initMapOffsetX=this.offsetX),isNaN(i.initMapOffsetY)&&(i.initMapOffsetY=this.offsetY);var n=e+i.initMapOffsetX,a=t+i.initMapOffsetY;if(i.point){var o=this.restrictCenter(i.point);o.equals(this.centerPoint)||(this.centerPoint=o.clone(),this.fire(new az("oncenter_changed")))}else{var r=this.offsetX-n,s=this.offsetY-a,l=this.getZoomUnits(),h=this.centerPoint.lng,c=this.centerPoint.lat,d=new eR(h,c);this.centerPoint=this.restrictCenter(new eR(d.lng+r*l,d.lat-s*l),l),this.fire(new az("oncenter_changed")),this.zoomLevel<10&&(n=this.offsetX-(this.centerPoint.lng-d.lng)/l,a=this.offsetY+(this.centerPoint.lat-d.lat)/l)}n=Math.round(n),a=Math.round(a),this.offsetX=n,this.offsetY=a;var u=this.platform.style;u.left=n+"px",u.top=a+"px",this.maskLayer.style.left=-n+"px",this.maskLayer.style.top=-a+"px",i.dispatchEvent!==!1&&this.dispatchEvent(new az("onmoving"))}},zoomTo:function(e,t){if("number"==typeof e){var i=ba[this.mapType];if(i){var n=e;if(e=this._getProperZoom(e).zoom,e===this.zoomLevel){var a=new az("onzoomexceeded");return a.targetZoom=n,void this.dispatchEvent(a)}if(this.lastLevel=this.zoomLevel,t)this.temp._cPoint=t,this.temp._cPixel=this.pointToPixel(t);else if(this.getInfoWindow()){var o=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixel(o),this.temp._cPoint=o}if(this.config.zoomCenter&&(t=this.config.zoomCenter,this.temp._cPoint=t,this.temp._cPixel=this.pointToPixel(t)),t||this.temp.infoWin&&this.temp.infoWin.isOpen()){var r=this.temp._cPoint,s=this.temp._cPixel,l=this.getZoomUnits(e),h=new eR(r.lng+l*(this.width/2-s.x),r.lat-l*(this.height/2-s.y));this.centerPoint=this.restrictCenter(h,l,e),this.centerPoint.zoom&&(e=this.centerPoint.zoom)}this.dispatchEvent(new az("onzoomstart")),this.dispatchEvent(new az("onzoomstartcode")),e!==this.zoomLevel&&(this.zoomLevel=e)}}},deepZoomMedia:function(e){var t=this;t.temp.isStdCtrlBusy||(t.temp.isStdCtrlBusy=!0,t.deepZoomTo(t.zoomLevel+e),setTimeout(function(){t.temp.isStdCtrlBusy=!1},400))},deepZoomTo:function(e){var t=e-this.zoomLevel,i=this._getProperZoom(e);if(i.exceeded){var n=new az("onzoomexceeded");return n.targetZoom=e,void this.dispatchEvent(n)}var a=new cG(this.width/2,this.height/2);this.lastLevel=this.zoomLevel,this.getInfoWindow()&&(a=this.pointToPixel(this.getInfoWindow().getPoint(),{zoom:this.lastLevel}));var o=this.deepZoom||new aR(this),r=t>0?1:-1;o.zoomMap(a,t,r)},flyTo:function(e,t){if(t===this.zoomLevel)return void this.panTo(e);var i=this._getProperZoom(t);if(i.exceeded){var n=new az("onzoomexceeded");return n.targetZoom=t,void this.dispatchEvent(n)}var a=t-this.zoomLevel,o=new cG(this.width/2,this.height/2),r=this.pointToPixel(e),s=new cy(r.x-o.x,r.y-o.y);if(this.lastLevel=this.zoomLevel,Math.abs(a)>=4||Math.abs(s.width)>this.width||Math.abs(s.height)>this.height)return void this.centerAndZoom(e,t);var l=this.deepZoom||new aR(this),h=a>0?1:-1;l.zoomMap(r,a,h,s)},panTo:function(e,t){if(t=t||{},!e||e.equals(this.centerPoint))return void(t.callback&&t.callback());var i=this.pointToPixel(e),n=Math.round(this.width/2),a=Math.round(this.height/2);Math.abs(n-i.x)>this.width||Math.abs(a-i.y)>this.height||t.noAnimation===!0?(this._panTo(n-i.x,a-i.y,e),t.callback&&t.callback()):this._panBy(n-i.x,a-i.y,t)},_panTo:function(e,t,i){var n=this.temp;n.operating!==!0&&(n.dragAni&&(n.dragAni.stop(),n.dragAni=null,this.dispatchEvent(new az("onmoveend"))),this.dispatchEvent(new az("onmovestart")),this._setPlatformPosition(e,t,{point:i}),this.dispatchEvent(new az("onmoveend")))},panBy:function(e,t,i){i=i||{},e=Math.round(e)||0,t=Math.round(t)||0,Math.abs(e)<=this.width&&Math.abs(t)<=this.height&&i.noAnimation!==!0?this._panBy(e,t,i):(this._panTo(e,t),i.callback&&i.callback())},_panBy:function(e,t,i){if(this.temp.operating!==!0){i=i||{},this.dispatchEvent(new az("onmovestart"));var n=this,a=n.temp;a.pl=n.offsetX,a.pt=n.offsetY,a.tlPan&&a.tlPan.cancel(),a.dragAni&&(a.dragAni.stop(),a.dragAni=null,this.dispatchEvent(new az("onmoveend"))),a.tlPan=new l({fps:i.fps||n.config.fps,duration:i.duration||n.config.actionDuration,transition:i.transition||bl.easeInOutQuad,render:function(i){this.terminative=n.temp.operating,n.temp.operating||n._setPlatformPosition(Math.ceil(e*i),Math.ceil(t*i),{initMapOffsetX:a.pl,initMapOffsetY:a.pt})},finish:function(){n.dispatchEvent(new az("onmoveend")),n.temp.tlPan=!1,n.temp.stopArrow===!0&&(n.temp.stopArrow=!1,0!==n.temp.arrow&&n._arrow()),i.callback&&i.callback()}})}},getCenter:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},setTilt:function(){},getTilt:function(){return this._tilt},setHeading:function(){},getHeading:function(){return this._heading},restrictCenter:function(e,t,i){this.isRestrict=!1,t=t||this.getZoomUnits(),i=i||this.zoomLevel;var n=this.pixelToPoint(new cG(0,0),{center:e,zoom:i}),a=this.pixelToPoint(new cG(0,this.height),{center:e,zoom:i});if(this.zoomLevel<5&&n.lat>bN.MAX_LAT&&a.lat<bN.MIN_LAT){this.isRestrict=!0;var o,r=bN.MAX_LAT-e.lat,s=e.lat-bN.MIN_LAT;o=s>r?r/(this.height/2):s/(this.height/2);var l=18-cR(o);return this.zoomLevel=Math.ceil(l),e.zoom=Math.ceil(l),e}return n.lat>bN.MAX_LAT?(this.isRestrict=!0,e.lat=bN.MAX_LAT-this.height/2*t):a.lat<bN.MIN_LAT&&(this.isRestrict=!0,e.lat=bN.MIN_LAT+this.height/2*t),e}}),bN.MAX_TILT=87,bN.MAX_DRAG_TILT=73,bN.MAX_DRAG_TILT_L2=50,bN.MIN_TILT=0,bN.MAX_LAT=19431424,bN.MIN_LAT=-16023552,bN.WORLD_SIZE_MC_HALF=20037726.372307256,bN.WORLD_SIZE_MC=2*bN.WORLD_SIZE_MC_HALF,bN.RIGHT_EDGE_POINT=new eR(bN.WORLD_SIZE_MC_HALF,0),bN.LEFT_EDGE_POINT=new eR(-bN.WORLD_SIZE_MC_HALF,0),bN.inherits(cB,"Map"),x.extend(bN.prototype,{render:function(){var e=H("div",{id:"platform"}),t=e.style;t.overflow="visible",t.position="absolute",t.zIndex=5,t.top=t.left="0px";var i=H("div",{id:"mask","class":"BMap_mask"}),n=i.style;return n.position="absolute",n.top=n.left="0px",n.zIndex="9",n.overflow="hidden",n.WebkitUserSelect="none",n.width=this.width+"px",n.height=this.height+"px",e.appendChild(i),e},_initMapRenderType:function(){var e=this.config.forceRenderType;if("dom"===e)return void(this._renderType="dom");if("canvas"===e){if(ay.isModernBrowser)return void(this._renderType="canvas")}else if("webgl"===e&&ay.ifSupportWebGL())return void(this._renderType="webgl");return ay.ifSupportWebGL()&&ay.ifEnableWebGLMap()?void(this._renderType="webgl"):ay.isModernBrowser&&ay.ifEnableCanvas2dMap()?void(this._renderType="canvas"):void(this._renderType="dom")},_setConfig:function(e){e=e||{},this.config={bottomOffset:0,clickInterval:200,enableDragging:!0,enableKeyboard:!1,enableDblclickZoom:!0,enableContinuousZoom:!0,enableWheelZoom:!0,enablePinchZoom:!0,fixCenterWhenPinch:!1,enableAutoResize:!0,zoomCenter:null,fps:60,zoomerDuration:240,actionDuration:450,defaultCursor:df.defaultCursor,draggingCursor:df.draggingCursor,coordType:BMAP_COORD_MERCATOR,mapType:BMAP_NORMAL_MAP,restrictBounds:!1,drawer:BMAP_SYS_DRAWER,enableInertialDragging:!0,drawMargin:500,drawMarginGL:500,enableFulltimeSpotClick:!1,enableResizeOnCenter:!1,isModernBrowser:ay.isModernBrowser,forceRenderType:"",textRenderType:dX()?"canvas":"image",ratio:aw(),enableEarth:ay.ifEnableEarth(),defaultMaxBounds:new cm(-21364736,-10616832,23855104,15859712),showControls:!0,showRealSunlight:!0,showMilkyway:!0,earthBackground:null,showStreetLayer:!0,minZoom:null,maxZoom:null};for(var t in e)e.hasOwnProperty(t)&&(this.config[t]=e[t])},getMinZoom:function(){var e;if(e=ba[this.mapType][this._renderType]?ba[this.mapType][this._renderType].minZoom:ba[this.mapType].minZoom,null!==this.config.minZoom&&this.config.minZoom>=e&&(e=this.config.minZoom),"B_EARTH_MAP"===this.mapType)return e;for(var t=this.getSize(),i=this.worldSize(e);i<t.width;)e++,i=this.worldSize(e);return e},getMaxZoom:function(){var e;return e=ba[this.mapType][this._renderType]?ba[this.mapType][this._renderType].maxZoom:ba[this.mapType].maxZoom,null!==this.config.maxZoom&&this.config.maxZoom<=e&&(e=this.config.maxZoom),e},_drawFrame:function(){this._webglMapScene._painter.draw()},_setupWebGLMap:function(){var e=this;cz.load("mapgl",function(){e._asyncRegister()})},_setStyle:function(e){var t=e.style;t.overflow="hidden","absolute"!==dS(e).position&&(t.position="relative"),t.backgroundImage="url("+df.imgPath+"bg.png)",t.textAlign="left",t.touchAction=t.MSTouchAction="none"},_bind:function(){var e=this;e._watchSize="webgl"!==e._renderType?function(){var t=e.getContainerSize();if(e.width!==t.width||e.height!==t.height){var i=(t.width-e.width)/2,n=(t.height-e.height)/2,a=e.getZoomUnits(),o=e.centerPoint;o&&!e.config.enableResizeOnCenter&&(e.centerPoint=new eR(o.lng+i*a,o.lat-n*a)),e.maskLayer.style.width=(e.width=t.width)+"px",e.maskLayer.style.height=(e.height=t.height)+"px";var r=new az("onresize");r.size=t,e.dispatchEvent(r),e.fire(new az("onsize_changed"));var s=parseInt(e.platform.style.left,10)||0,l=parseInt(e.platform.style.top,10)||0;"undefined"===e.currentOperation||e.currentOperation===co.idle||e.offsetX===s&&e.offsetY===l||e._setPlatformPosition(s,l)}}:function(){var t=e.getContainerSize();if(e.width!==t.width||e.height!==t.height){var i=e.getSize();e.maskLayer.style.width=(e.width=t.width)+"px",e.maskLayer.style.height=(e.height=t.height)+"px",aw()!==e.config.ratio&&(e.config.ratio=aw());var n=new az("onresize");n.size=t,e.dispatchEvent(n);var a=new az("onsize_changed");a.size=t,a.oldSize=i,e.fire(a)}},e.config.enableAutoResize&&(e.temp.autoResizeTimer=setInterval(e._watchSize,16)),this.on("size_changed",function(){var t=e.getMinZoom();e.zoomLevel<t&&e.zoomTo(t,null,{noAnimation:!0})})},addControl:function(e){e&&a3(e._i)&&(e._i(this),this.dispatchEvent(new az("onaddcontrol",e)))},removeControl:function(e){e&&a3(e.remove)&&(e.remove(),this.dispatchEvent(new az("onremovecontrol",e)))},addContextMenu:function(e){e&&(e.initialize(this),this.dispatchEvent(new az("onaddcontextmenu",e)))},removeContextMenu:function(e){e&&(this.dispatchEvent(new az("onremovecontextmenu",e)),e.remove())},addOverlay:function(e){if(e&&a3(e._i)){var t=new az("onbeforeaddoverlay",e);t.overlay=e,this.dispatchEvent(t),e._i(this),t=new az("onaddoverlay",e),t.overlay=e,this.dispatchEvent(t)}},removeOverlay:function(e){if(e&&a3(e.remove)){var t=new az("onremoveoverlay",e);t.overlay=e,e.remove(),this.dispatchEvent(t)}},clearOverlays:function(){this.dispatchEvent(new az("onclearoverlays"))},addTileLayer:function(e){if(e){for(var t=0,i=this.tileMgr.tileLayers.length;i>t;t++){var n=this.tileMgr.tileLayers[t];if(n===e||n.getMapType()===e.getMapType())return}e.initialize(this),this.dispatchEvent(new az("onaddtilelayer",e))}},removeTileLayer:function(e){e&&(e.remove(),this.dispatchEvent(new az("onremovetilelayer",e)))},getTileLayer:function(e){return this.tileMgr?this.tileMgr.getTileLayer(e):null},setMapType:function(e){var t=this;if(this.mapType!==e&&!this._mapTypeChanging&&!(e===BMAP_EARTH_MAP&&!this.config.enableEarth||this._earth&&this._earth.getLock()))if(this._mapTypeChanging=!0,this.preMapType=this.mapType,this._boundsInPreMapType=this.getBounds(),this.preMapType===BMAP_SATELLITE_MAP&&(this._preStreetLayerShow=this._isHybridShow),e===BMAP_EARTH_MAP){if(!eM.Earth)return void cz.load("earth",function(){t._syncAndChangeMapType(e)});t._syncAndChangeMapType(e)}else this.preMapType!==BMAP_EARTH_MAP?(this._changeFlatMapType(e),this._mapTypeChanging=!1):this._setMapTypeStatus(e,function(i,n){var a=t._earth.getEarthCanvas();t._changeFlatMapType(e,this.preMapType),t._mapTypeChangAni&&t._mapTypeChangAni.stop(),t._mapTypeChangAni=ds.start({el:a,style:"opacity",startValue:1,endValue:0,duration:200,callback:function(){t._mapTypeChangAni=null,t._mapTypeChanging=!1}}),i=cI.convertLL2MC(i),"webgl"===t._renderType?(x.extend(t,bM.prototype),t.setCenter(i,{noAnimation:!0}),t.zoomTo(n,null,{noAnimation:!0})):(x.extend(t,T.prototype),t.centerAndZoom(i,n))})},_changeFlatMapType:function(e){if(e&&ba[e]){var t=this.preMapType;this.mapType=e;var i=this.getTileLayer(t);if(i&&this.removeTileLayer(i),t!==BMAP_EARTH_MAP||"webgl"!==this._renderType||this.baseLayerAdded!==!0){var n=new cm(-21364736,-10616832,23855104,15859712),a=new bL(n,"baidu",e),o="webgl"===this._renderType?2:1,r=new bA({mapType:e,copyright:a,dataType:o,customLayer:!1,baseLayer:!0,tileTypeName:"na"});r._isInnerLayer=!0,this.addTileLayer(r),"webgl"!==this._renderType||this.baseLayerAdded||(this.baseLayerAdded=!0)}t===BMAP_SATELLITE_MAP?(this._preStreetLayerShow=this._isHybridShow,this._removeHybirdMap()):e===BMAP_SATELLITE_MAP&&(this._preStreetLayerShow===!0||"undefined"==typeof this._preStreetLayerShow)&&this._addHybirdMap();for(var s=this.tileMgr.tileLayers,l=0,h=s.length;h>l;l++){var c=s[l],d=c.tilesDiv;d&&(c._isInnerLayer||"hidden"!==d.style.visibility||(d.style.visibility=""))}var u=new az("onmaptypechange");u.zoomLevel=this.zoomLevel,u.mapType=e,u.exMapType=t,this.dispatchEvent(u)}},showStreetLayer:function(e){e?this._addHybirdMap():this._removeHybirdMap()},hideStreetLayer:function(e){this._hideStreetLayerOptions=e,this._removeHybirdMap(e)},_addHybirdMap:function(){if(this._isHybridShow=!0,"B_EARTH_MAP"===this.mapType)return void(this._earth&&this._earth.showStreetLayer());if(this._hybridTileLayer){this.addTileLayer(this._hybridTileLayer);var e=new az("onstreetlayer_show");return void this.dispatchEvent(e)}var t=new cm(-21364736,-10616832,23855104,15859712),i=new bL(t,"",BMAP_HYBRID_MAP),n=new bA({copyright:i,transparentPng:!0,tileTypeName:"web"});n._isInnerLayer=!0;var a=this.isCanvasMap();n.getTilesUrl=function(e,t){var i=ba.B_STREET_MAP,n=aa("ditu","satelliteStreet"),o=n.ver,r=n.udt,s=i.tileUrls[Math.abs(e.x+e.y)%i.tileUrls.length]+"?qt=vtile&x="+(e.x+"").replace(/-/gi,"M")+"&y="+(e.y+"").replace(/-/gi,"M")+"&z="+t+"&styles=sl&v="+o+"&udt="+r+"$scaler="+aw()+"&showtext="+(a?0:1);return s},this._isHybridShow=!0,this.addTileLayer(n),this._hybridTileLayer=n;var e=new az("onstreetlayer_show");this.dispatchEvent(e)},_removeHybirdMap:function(e){if(this._isHybridShow=!1,"B_EARTH_MAP"===this.mapType)return void(this._earth&&this._earth.hideStreetLayer(e));if(this._hybridTileLayer){this.removeTileLayer(this._hybridTileLayer);var t=new az("onstreetlayer_hide");this.dispatchEvent(t)}},isStreetLayerShow:function(){return this._isHybridShow},getTileId:function(e,t){var i=ba[this.mapType];if("object"!=typeof i)return null;var n=i.baseUnits*Math.pow(2,i.zoomLevelBase-t),a=parseInt(e.lng/n,10),o=parseInt(e.lat/n,10);return{row:a,column:o,level:t}},reset:function(){this.centerAndZoom(this.defaultCenter,this.defaultZoomLevel,!0)},setOptions:function(e){e=e||{};for(var t in e)e.hasOwnProperty(t)&&(this.config[t]=e[t])},enableDragging:function(){this.config.enableDragging=!0},disableDragging:function(){this.config.enableDragging=!1},enableInertialDragging:function(){this.config.enableInertialDragging=!0},disableInertialDragging:function(){this.config.enableInertialDragging=!1},enableScrollWheelZoom:function(){this.config.enableWheelZoom=!0},disableScrollWheelZoom:function(){this.config.enableWheelZoom=!1},enableContinuousZoom:function(){this.config.enableContinuousZoom=!0},disableContinuousZoom:function(){this.config.enableContinuousZoom=!1},enableResizeOnCenter:function(){this.config.enableResizeOnCenter=!0},disableResizeOnCenter:function(){this.config.enableResizeOnCenter=!1},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=!0},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=!1},enableKeyboard:function(){this.config.enableKeyboard=!0},disableKeyboard:function(){this.config.enableKeyboard=!1},getSize:function(){return new cy(this.width,this.height)},enablePinchToZoom:function(){this.config.enablePinchZoom=!0},disablePinchToZoom:function(){this.config.enablePinchZoom=!1},enableAutoResize:function(){this.config.enableAutoResize=!0,this._watchSize(),this.temp.autoResizeTimer||(this.temp.autoResizeTimer=setInterval(this._watchSize,1e3))},disableAutoResize:function(){this.config.enableAutoResize=!1,this.temp.autoResizeTimer&&(clearInterval(this.temp.autoResizeTimer),this.temp.autoResizeTimer=null)},checkResize:function(){this._watchSize()},getContainerSize:function(){return new cy(this.container.clientWidth,this.container.clientHeight)},_getProperZoom:function(e){e||(e=this.zoomLevel);var t=this.getMinZoom(),i=this.getMaxZoom(),n=!1;return t>e&&(n=!0,e=t),e>i&&(n=!0,e=i),"webgl"!==this._renderType&&(e=Math.round(e)),{zoom:e,exceeded:n}},getContainer:function(){return this.container},getZoomUnits:function(e){if(this.mapType===BMAP_EARTH_MAP)return Math.pow(2,18-this._earth.getImageZoom());var t=ba[this.mapType];if("object"!=typeof t)return null;var i=e||this.zoomLevel;return Math.pow(2,t.zoomLevelBase-i)},pointToPixel:function(e,t){if(e){if(t=t||{},this.mapType===BMAP_EARTH_MAP){var i;e._llPt||(i=cI.convertMC2LL(e),e._llPt=i),i=e._llPt;var n=null,a=null;if("number"==typeof t.zoom){var o=this._earth,r=o._getEarthZoomByImgZoom(t.zoom);3>=r&&(n=o._generateTmpPMatrix(r)),a=o._generateTmpMVMatrix(o.getCenter(),r)}var s=this._earth.fromLatLngToPixel(i,{useRound:!1,isCalcOnBack:!0,matrixInfo:{modelViewMatrix:a,projectionMatrix:n}});return s}if(this._heading%360===0&&0===this._tilt||!this._webglMapCamera){var l=this.getZoomUnits(t.zoom),h=t.center||this.centerPoint,c=this.width/2,d=this.height/2,u=(e.lng-h.lng)/l+c,f=(h.lat-e.lat)/l+d;
return t.useRound!==!1&&(u=Math.round(u),f=Math.round(f)),new cG(u,f)}var p=this._webglMapCamera.fromMCToScreenPixel(e.lng,e.lat,t);return t.useRound===!1?p:(p.x=Math.round(p.x),p.y=Math.round(p.y),p)}},pixelToPoint:function(e,t){if(e){if(t=t||{},this.mapType===BMAP_EARTH_MAP){if("number"==typeof t.zoom){var i=this._earth,n=null,a=null,o=i._getEarthZoomByImgZoom(t.zoom);3>=o&&(n=i._generateTmpPMatrix(o)),a=i._generateTmpMVMatrix(i.getCenter(),o)}var r=this._earth.fromPixelToLatLng(e,{matrixInfo:{modelViewMatrix:a,projectionMatrix:n}});return null===r?null:cI.convertLL2MC(r)}if((this._heading%360!==0||this._tilt>0)&&this._webglMapCamera)return this._webglMapCamera.fromScreenPixelToMC(e.x,e.y,t);var s=t.center||this.centerPoint,l=this.getZoomUnits(t.zoom),h=s.lng+l*(e.x-this.width/2),c=s.lat-l*(e.y-this.height/2);return new eR(h,c)}},pointToOverlayPixel:function(e,t,i,n){var a=this.pointToPixel(e,{zoom:t,center:i,forLabel:!0,frustumTest:!0});if(a){if(n){var o=this.getSize(),r=this.worldSize(t);if(a.x>o.width)for(;a.x>o.width;)a.x-=r;else if(a.x<0)for(;a.x<0;)a.x+=r}return"webgl"===this._renderType?a:(a.x-=this.offsetX,a.y-=this.offsetY,a)}},overlayPixelToPoint:function(e,t){if(e){var i=new cG(e.x,e.y);return"webgl"!==this._renderType&&(i.x+=this.offsetX,i.y+=this.offsetY),this.pixelToPoint(i,{zoom:t})}},lnglatToMercator:function(e,t){var i=new eR(e,t),n=cI.convertLL2MC(i);return[n.lng,n.lat]},mercatorToLnglat:function(e,t){if(isNaN(e)||isNaN(t))return[];e=parseFloat(e),t=parseFloat(t);var i=new eR(e,t),n=cI.convertMC2LL(i);return[n.lng,n.lat]},getBounds:function(e){if(this.mapType===BMAP_EARTH_MAP){var t=this._earth.getCustomBounds();if(!t)return this.config.defaultMaxBounds;var i=t.getSouthWest(),n=t.getNorthEast();i.lng>n.lng&&(n.lng=180);var a=cI.convertLL2MC(i),o=cI.convertLL2MC(n),r=this.config.defaultMaxBounds,s=Math.max(a.lng,r.minX),l=Math.max(a.lat,r.minY),h=Math.min(o.lng,r.maxX),c=Math.min(o.lat,r.maxY),d=new cm(s,l,h,c);return d.pointBottomLeft=new eR(s,l),d.pointBottomRight=new eR(h,l),d.pointTopLeft=new eR(s,c),d.pointTopRight=new eR(h,c),d}e=e||{};var u=e.margins||[0,0,0,0],f=this.pixelToPoint({x:u[3],y:this.height-u[2]},e),p=this.pixelToPoint({x:this.width-u[1],y:u[0]},e),m="number"==typeof e.heading?e.heading:this._heading%360,g="number"==typeof e.tilt?e.tilt:this._tilt,_=this._webglMapCamera;if(0===m&&0===g||!_)return this._bounds.setValues(f.lng,f.lat,p.lng,p.lat),this._bounds.pointBottomLeft=f,this._bounds.pointBottomRight=new eR(p.lng,f.lat),this._bounds.pointTopRight=p,this._bounds.pointTopLeft=new eR(f.lng,p.lat),this._bounds;var v=this.pixelToPoint({x:u[3],y:u[0]},e),b=(this.pixelToPoint({x:u[3],y:u[0]},e),_.getPosition()),y=Math.sqrt(Math.pow(v.lng-b[0],2)+Math.pow(v.lat-b[1],2)),x=this.getZoomUnits(),w=y/x,M=_._frustumSideLen,T=_._fovy;if(w>M||T/2>90-g){var L=_._fovyRadian,C=Math.tan(L/2),P=this.getSize(),A=(P.width/P.height*C,[v.lng-b[0],v.lat-b[1]]);T/2>90-g&&(A[0]=-A[0],A[1]=-A[1]);var S=M*x,I=[A[0]/y*S+b[0],A[1]/y*S+b[1]],D=[p.lng-b[0],p.lat-b[1]];T/2>90-g&&(D[0]=-D[0],D[1]=-D[1]);var z=[D[0]/y*S+b[0],D[1]/y*S+b[1]];v.lng=I[0],v.lat=I[1],p.lng=z[0],p.lat=z[1]}for(var k=this.pixelToPoint({x:this.width-u[1],y:this.height-u[2]},e),E=[f,p,v,k],O=E[0].lng,B=E[0].lat,R=E[0].lng,N=E[0].lat,Z=1;4>Z;Z++)E[Z].lng<O&&(O=E[Z].lng),E[Z].lng>R&&(R=E[Z].lng),E[Z].lat<B&&(B=E[Z].lat),E[Z].lat>N&&(N=E[Z].lat);return this._bounds.setValues(O,B,R,N),this._bounds.pointTopLeft=v,this._bounds.pointTopRight=p,this._bounds.pointBottomRight=k,this._bounds.pointBottomLeft=f,this._bounds},isLoaded:function(){return!!this.loaded},_getBestLevel:function(e,t){var i=0;"webgl"===this._renderType&&(i=100);var n=t.margins||[10,10,10,10],a=t.zoomFactor||0,o=n[1]+n[3],r=n[0]+n[2],s=this.getMinZoom(),l=this.getMaxZoom(),h=(e.maxX-e.minX)/(this.width-o-i),c=(e.maxY-e.minY)/(this.height-r-i),d=18-cR(Math.max(h,c));return d+=a,s>d&&(d=s),d>l&&(d=l),"webgl"!==this._renderType&&(d=Math.floor(d)),d},getViewport:function(e,t){if(this.mapType===BMAP_EARTH_MAP){e=e||[];for(var i=[],n=0;n<e.length;n++)e[n]&&i.push(cI.convertMC2LL(e[n]));var a=this._earth.getViewport(i,t),o=a.center,r=a.zoom,s=cI.convertLL2MC(o);return{center:s,zoom:r}}var l={center:this.getCenter(),zoom:this.getZoom()};if(!e||0===e.length)return l;t=t||{};var h;if(e instanceof cm)h=e;else{var c=e;h=new cm;for(var n=c.length-1;n>=0;n--)h.extend(c[n]);if(h.isEmpty())return l}var d=h.getCenter(),u=this._getBestLevel(h,t);if(t.margins){var f=t.margins,p=(f[1]-f[3])/2,m=(f[0]-f[2])/2,g=this.getZoomUnits(u);d.lng=d.lng+g*p,d.lat=d.lat+g*m}return{center:d,zoom:u}},setViewport:function(e,t){if(this.mapType===BMAP_EARTH_MAP){var i;if(e&&e.center){var n=cI.convertMC2LL(e.center),a=this._earth._getEarthZoomByImgZoom(e.zoom,n);i={center:n,zoom:a}}else{i=[];for(var o=0;o<e.length;o++){var r=cI.convertMC2LL(e[o]);i[o]=new bK(r.lat,r.lng)}}return void this._earth.setViewport(i,t)}var s;return s=e&&e.center?e:this.getViewport(e,t),t=t||{},"webgl"===this._renderType?void this.centerAndZoom(s.center,s.zoom,t):void(s.zoom===this.zoomLevel&&t.enableAnimation!==!1?this.panTo(s.center,{duration:200,callback:t.callback}):this.centerAndZoom(s.center,s.zoom,t))},addSpots:function(e,t){if(e&&0!==e.length){t=t||{};var i=t.zIndex||0,n="undefined"==typeof t.enableMultiResponse?!0:!!t.enableMultiResponse;this.spotsPool=this.spotsPool||{};var a="sp"+this.temp.spotsGuid++;this.spotsPool[a]={spots:e.slice(0),zIndex:i,enableMultiResponse:n};var o=this;return cz.load("hotspot",function(){o._asyncRegister()}),a}},getSpots:function(e){return this.spotsPool[e]&&this.spotsPool[e].spots||[]},removeSpots:function(e){e&&this.spotsPool[e]&&delete this.spotsPool[e]},clearSpots:function(){delete this.spotsPool},setBounds:function(e){ba[this.mapType].bounds=new cm(e.minX,e.minY,e.maxX,e.maxY)},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){return this.temp.infoWin&&this.temp.infoWin.isOpen()?this.temp.infoWin:null},getDistance:function(e,t){if(e&&t){if(this.mapType===BMAP_EARTH_MAP){var i=cI.convertMC2LL(e),n=cI.convertMC2LL(t);return this._earth.getDistance(i,n)}var a=cI.getDistanceByMC(e,t);return a}},getOverlays:function(){var e=[],t=this._overlays,i=this._customOverlays;if(t)for(var n in t)t[n]instanceof bC&&e.push(t[n]);if(i)for(var n=0,a=i.length;a>n;n++)e.push(i[n]);return e},getMapType:function(){return this.mapType},_asyncRegister:function(){for(var e=this.temp.registerIndex;e<eM._register.length;e++)eM._register[e](this);this.temp.registerIndex=e},setDefaultCursor:function(e){this.config.defaultCursor=e,this.platform&&(this.platform.style.cursor=this.config.defaultCursor)},getDefaultCursor:function(){return this.config.defaultCursor},setDraggingCursor:function(e){this.config.draggingCursor=e},getDraggingCursor:function(){return this.config.draggingCursor},_syncAndChangeMapType:function(e){var t=this;"webgl"===t._renderType&&t.getTilt()>bN.MAX_DRAG_TILT_L2?t.setTilt(bN.MAX_DRAG_TILT_L2,{callback:function(){t._changeEarthMapType(e)}}):t._changeEarthMapType(e)},_changeEarthMapType:function(e){var t=this,i=t.tileMgr.tileLayers;this._mapTypeChangAni&&this._mapTypeChangAni.stop();var n;if(this._earth&&(n=this._earth.getEarthCanvas()),this._earth||(this.maskLayer.style.opacity=1,this.maskLayer.style.zIndex=999,this.maskLayer.style.background="#000"),this._mapTypeChangAni=new l({duration:400,render:function(e){t._earth&&(n.style.opacity=e)},finish:function(){function n(){var i=t.getZoom()-2,n=t.getCenter(),a=cI.convertMC2LL(n);t._earth=new eM.Earth(t,{center:a,zoom:i,showRealSunlight:t.config.showRealSunlight,showMilkyway:t.config.showMilkyway,earthBackground:t.config.earthBackground}),t._proxyEarthEvents();var o=t.mapType;t.mapType=e;var r=new az("onmaptypechange");r.zoomLevel=this.zoomLevel,r.mapType=e,r.exMapType=o,t.dispatchEvent(r),t._setMapTypeStatus(e),x.extend(t,eM.EarthView.prototype),!t._navigationCtrl&&t.config.showControls&&(t._navigationCtrl=new eM.NavigationControl3D(t))}for(var a=i.length-1,o=a;o>=0;o--){var r=i[o].tilesDiv;r&&(r.style.visibility="hidden"),i[o]._isInnerLayer&&"webgl"!==t._renderType&&t.removeTileLayer(i[o])}t._mapTypeChangAni=null,t._mapTypeChanging=!1,t._earth||(window.FeatureStyle?n():eL.load(df.getMapStyleFiles(),function(){n()})),1===parseInt(t.maskLayer.style.opacity,10)&&setTimeout(function(){t.maskLayer.style.zIndex=9,t.maskLayer.style.opacity=0},1e3)}}),this._earth){var a=this.mapType;this.mapType=e;var o=new az("onmaptypechange");o.zoomLevel=this.zoomLevel,o.mapType=e,o.exMapType=a,this.dispatchEvent(o),t._setMapTypeStatus(e),x.extend(t,eM.EarthView.prototype)}},_setMapTypeStatus:function(e){var t=arguments[1];if(e===BMAP_EARTH_MAP){var i=this._earth.getEarthCanvas();i&&(i.style.display="");var n={noAnimation:!0};this._earth.setCenter(cI.convertMC2LL(this.centerPoint),n),this._earth.setImageZoom(this.zoomLevel,n),this._earth.setTilt(this.getTilt(),n),this._earth.setHeading(this.getHeading(),n)}else if(this.preMapType===BMAP_EARTH_MAP&&this._earth){var a=this._earth,o=a.getMapZoom(),r=a._imageRawZoom||o,s=r-o,l=a.getCenter();if("webgl"===this._renderType)return this._tilt=a.getTilt(),this.zoomLevel>7?(this._heading=a.getHeading(),void(t&&t(l,o))):void(0!==a.getHeading()?(a.setTilt(this.getTilt()),a.setHeading(this.getHeading(),{callback:function(){t&&t(l,o)}})):t&&t(l,o));if(.1>s&&0===a.getTilt()&&0===a.getHeading())return void(t&&t(l,o));a.setTilt(0),a.setHeading(0),a.setZoom(a.getZoom()-s,{callback:function(){t&&t(l,o)}})}},_proxyEarthEvents:function(){function e(e){t.fire(e)}var t=this,i=this._earth;i.on("tilesload",function(e){t.fire(e)}),i.on("centerandzoom",function(){t.dispatchEvent(new az("onmoveend")),t.dispatchEvent(new az("onzoomend"))});for(var n=["zoomstart","zoomend","tilesload","sunlighttime_change","sunlighttime_clear","centerandzoom","animation_start","animation_stop","movestart","moveend","moving","dragstart","dragend","dragging"],a=0;a<n.length;a++)i.on(n[a],e)},forceEnableEarth:function(){return this.config.forceEnableEarth=!0,this.config.enableEarth=ay.ifEnableEarth(!0),this.dispatchEvent(new az("forceenableearth")),this.config.enableEarth},setLock:function(e){this.mapType===BMAP_EARTH_MAP&&this._earth.setLock(e),this._lock=e},getLock:function(){return this.mapType===BMAP_EARTH_MAP?this._earth.getLock():this._lock},getEarth:function(){return this._earth},isSupportEarth:function(){return this.config.enableEarth},isCanvasMap:function(){return!("canvas"!==this._renderType||"B_EARTH_MAP"===this.getMapType())},getCanvasMapCoordByUid:function(e){if("webgl"===this._renderType){for(var t=this.tileMgr.tileLayers,i=0;i<t.length;i++)if(t[i].labelProcessor)return t[i].labelProcessor.getLabelByUid(e,"");return null}var n=this.canvas2dMapMgr._labelClick,a=n.findLabelByUid(e);return a?new eR(a.iconPos.geoX,a.iconPos.geoY):null},loadBizData:function(e){var t=new az("onloadbizdata");t.data=e,this.dispatchEvent(t)},unloadBizData:function(){var e=new az("onunloadbizdata");this.dispatchEvent(e)},zoomIn:function(e){this.zoomTo(this.zoomLevel+1,e)},zoomOut:function(e){this.zoomTo(this.zoomLevel-1,e)},setCenter:function(e,t){this.panTo(e,t)},getRenderType:function(){return this._renderType},getSolarInfo:function(e){e=e||this._initDate;var t=aN(e),i=cI.convertLL2MC(new eR(t[0],t[1])),n=i.latLng,a=eM.Projection.convertMC2LL(this.centerPoint),o=e.getUTCHours(),r=o+24*a.lng/360,s=r-12,l=60*s*.25,h=Math.asin(Math.sin(ch(a.lat))*Math.sin(ch(n.lat))+Math.cos(ch(a.lat))*Math.cos(ch(n.lat))*Math.cos(ch(l))),c=Math.asin(Math.sin(ch(l))*Math.cos(ch(n.lat))/Math.cos(h)),d="north";return a.lat<n.lat&&(d="south"),{zenith:i,solarAltitude:h,solarAzimuth:c,centerPosition:d,position:i}},setDisplayOptions:function(e){if(e){for(var t in this._displayOptions)this._displayOptions.hasOwnProperty(t)&&"boolean"==typeof e[t]&&(this._displayOptions[t]=e[t]);this.fire(new az("ondisplayoptions_changed")),this.fire(new az("onrefresh"))}},getHorizonPosY:function(e){if(!e||!this._webglMapCamera)return null;var t=this._webglMapCamera.fromMCToScreenPixel(e.lng,e.lat,{heading:0});return t.y},getIndoorInfo:function(){return this._indoorMgr?this._indoorMgr.getData():void 0},showIndoor:function(e,t){var i=new az("onindoor_status_changed");i.uid=e,i.floor=t,this.fire(i)},addAreaSpot:function(e,t){if(e&&0!==e.length){t=t||{},this.areaSpots=this.areaSpots||{};var i=t.id||"sp"+this.temp.spotsGuid++;return this.areaSpots[i]={spot:e,userData:t.userData},i}},getAreaSpot:function(e){return this.areaSpots&&this.areaSpots[e]?this.areaSpots[e]:null},removeAreaSpot:function(e){e&&this.areaSpots[e]&&delete this.areaSpots[e]},clearAreaSpots:function(){this.areaSpots={}},resetSpotStatus:function(){this.fire(new az("onspot_status_reset"))},hightlightSpotByUid:function(e,t){var i=new az("onspot_highlight");i.uid=e,i.tilePosStr=t,this.fire(i)},setZoom:function(e,t){this.zoomTo(e,null,t)},getCurrentMaxTilt:function(){return"B_EARTH_MAP"===this.mapType?bN.MAX_DRAG_TILT_L2:this.zoomLevel>=19?bN.MAX_DRAG_TILT:this.zoomLevel<=18?bN.MAX_DRAG_TILT_L2:(bN.MAX_DRAG_TILT-bN.MAX_DRAG_TILT_L2)*(this.zoomLevel-18)+bN.MAX_DRAG_TILT_L2},worldSize:function(e){var t=e||this.zoomLevel;return bN.WORLD_SIZE_MC/Math.pow(2,18-t)},setTrafficOn:function(){this.addTileLayer(trafficLayer)},setTrafficOff:function(){this.removeTileLayer(trafficLayer)},showOverlayContainer:function(){this.setDisplayOptions({showOverlay:!0})},hideOverlayContainer:function(){this.setDisplayOptions({showOverlay:!1})},addLabelsToMapTile:function(e){for(var t=0;t<e.length;t++)"undefined"==typeof e[t].type&&(e[t].type="fixed"),"number"!=typeof e[t].rank&&(e[t].rank=5e4),e[t].pt=e[t].position,e[t].custom=!0,e[t].processedInZoom=0,this._customTileLabels.push(e[t]);this.dispatchEvent(new az("onadd_tile_labels"))},removeLabelsFromMapTile:function(e){for(var t=0;t<e.length;t++)for(var i=0;i<this._customTileLabels.length;i++)this._customTileLabels[i].uid===e[t]&&this._customTileLabels.splice(i,1);this.dispatchEvent(new az("onremove_tile_labels"))},clearLabels:function(){this._customTileLabels.length=0,this.dispatchEvent(new az("onclear_labels"))}}),window.BMAP_NORMAL_MAP="B_NORMAL_MAP",window.BMAP_SATELLITE_MAP="B_SATELLITE_MAP",window.BMAP_HYBRID_MAP="B_STREET_MAP",window.BMAP_EARTH_MAP="B_EARTH_MAP",window.BMAP_COORD_MERCATOR=1,window.BMAP_SYS_DRAWER=0,window.BMAP_SVG_DRAWER=1,window.BMAP_VML_DRAWER=2,window.BMAP_CANVAS_DRAWER=3,a0.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},a0.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},a0.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},a0.prototype.solveCurveX=function(e,t){"undefined"==typeof t&&(t=1e-6);var i,n,a,o,r;for(a=e,r=0;8>r;r++){if(o=this.sampleCurveX(a)-e,Math.abs(o)<t)return a;var s=this.sampleCurveDerivativeX(a);if(Math.abs(s)<1e-6)break;a-=o/s}if(i=0,n=1,a=e,i>a)return i;if(a>n)return n;for(;n>i;){if(o=this.sampleCurveX(a),Math.abs(o-e)<t)return a;e>o?i=a:n=a,a=.5*(n-i)+i}return a},a0.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var bl={};l.INFINITE="INFINITE",l.prototype._doStart=function(){if(window.requestAnimationFrame){var e=this;e._timer=window.requestAnimationFrame(function(t){e._loop(t)})}else this._beginTime=(new Date).getTime(),this._endTime=this._options.duration===l.INFINITE?null:this._beginTime+this._options.duration,this._loop()},l.prototype._loop=function(e){var t=this;if(e=e||(new Date).getTime(),this._beginTime||(this._beginTime=e),this._endTime||"number"!=typeof this._options.duration||(this._endTime=this._beginTime+this._options.duration),null!==t._endTime&&e>=t._endTime){t._options.dropLastAnimation===!1&&t._options.render(t._options.transition(1),1,e),"function"==typeof t._options.finish&&t._options.finish(e);for(var i=0,n=t._callbacks.length;n>i;i++)t._callbacks[i]()}else{var a;"number"==typeof t._options.duration?(a=(e-t._beginTime)/t._options.duration,t.schedule=t._options.transition(a)):(a=e-t._beginTime,t.schedule=0),t._options.render(t.schedule,a,e),t.terminative||(t._timer=window.requestAnimationFrame?requestAnimationFrame(function(e){t._loop(e)}):setTimeout(function(){t._loop()},1e3/t._options.fps))}},l.prototype.stop=function(e,t){this.terminative=!0,this._timer&&(window.cancelAnimationFrame?cancelAnimationFrame(this._timer):clearTimeout(this._timer),this._timer=null,"function"==typeof this._options.onStop&&this._options.onStop(t)),e&&(this._endTime=this._beginTime,this._loop())},l.prototype.cancel=function(){this.stop()},l.prototype.append=function(e){return this._callbacks.push(e),this},bl={_p1:1,_p2:1.525,linear:function(e){return e},reverse:function(e){return 1-e},easeInQuad:function(e){return e*e},easeInCubic:function(e){return Math.pow(e,3)},easeInBiquad:function(e){return Math.pow(e,4)},easeInBack:function(e){return e*e*((bl._p1+1)*e-bl._p1)},easeOutQuad:function(e){return-(e*(e-2))},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeOutBiquad:function(e){return 1-Math.pow(e-1,4)},easeOutBack:function(e){return(e-=1)*e*((bl._p1+1)*e+bl._p1)+1},easeInOutQuad:function(e){return.5>e?e*e*2:-2*(e-2)*e-1},easeInOutCubic:function(e){return.5>e?4*Math.pow(e,3):4*Math.pow(e-1,3)+1},easeInOutBiquad:function(e){return.5>e?8*Math.pow(e,4):1-8*Math.pow(e-1,4)},easeInOutSine:function(e){return(1-Math.cos(Math.PI*e))/2}},bl.ease=function(){var e=new a0(.4,0,.6,1);return function(t){return e.solve(t)}}(),bl["ease-in"]=bl.easeInQuad,bl["ease-out"]=bl.easeOutQuad;var ds={start:function(e){var t=e.el,i=e.style,n=e.startValue,a=e.endValue,o=e.duration||1400,r=e.transition||bl.linear,s=e.callback,h=a-n,c=e.unit||"";return new l({fps:60,duration:o,transition:r,render:function(e){t.style[i]=n+h*e+c},finish:function(){s&&s()}})}},cO=void 0,bH={is64Bit:function(){return/Windows/.test(navigator.userAgent)?/Win64; x64/.test(navigator.userAgent)?!0:/WOW64/.test(navigator.userAgent)?!0:!1:!0},canUseWebAssembly:function(e){if(void 0!==cO)return void(e&&e(cO));if(window.WebAssembly&&this.is64Bit())if(aK()){var t=new Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);WebAssembly.instantiate(t).then(function(){cO=!0,e&&e(cO)},function(){cO=!1,e&&e(cO)})}else cO=!0,e&&e(cO);else cO=!1,e&&e(cO)}},b5={};eM.Utils=b5;var eN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";!function(e){e||(e=window.BMap={}),e.Utils||(e.Utils={});var t=e.Utils;t.format=function(){function e(e,t,i){var n=i[+t];return"function"==typeof n?n(t):n}function t(e,t,i){var n=t,a=[],o=t.split(":");2===o.length&&(n=o[0],a.push(o[1]));var r=typeof i[n];return"function"===r?i[n].apply(void 0,a):"undefined"===r?e:String(i[n])}return function(i,n){var a=n.splice?e:t,o=i.splice?i.join(""):i;return o.replace(/{([a-zA-Z0-9_$:.]+)}/g,function(e,t){return a(e,t,n)})}}();t.ErrorMonitor=function(){},bH.canUseWebAssembly(function(e){t.canUseWebAssembly=e})}(eM);var ai=Math.PI/180,y=180/Math.PI,dC=null;dC=window.performance&&window.performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return(new Date).getTime()};var au=null;b5.inMapHost=db(),"boolean"==typeof window._inMapHost&&(b5.inMapHost=window._inMapHost),x.extend(cz,{Request:{INITIAL:-1,WAITING:0,LOADED:1,COMPLETED:2},Dependency:{poly:["marker"],infowindow:["marker"],simpleInfowindow:["marker"],hotspot:["poly"],tools:["marker","poly"],mapgl:["glcommon","poly"],earth:["glcommon"]},MD5Mapping:{control:"d2jvoi",marker:"nmgugk",poly:"rzta4p",infowindow:"pjyr2s",simpleInfowindow:"zdervn",hotspot:"vbccik",menu:"svhfb2",tools:"3j3p5j",oppc:"fm4zdg",oppcgl:"mopbyg",mapgl:"augbp4",markeranimation:"5bxwpf",earth:"w4g42u",glcommon:"uju4qc"},Config:{baseUrl:(b5.inMapHost?"":"https://map.baidu.com")+"/?qt=getjsmods&v=1.1&sample=newui",jsModPath:(b5.inMapHost?"":"https://map.baidu.com")+"/res/newui/",timeout:5e3},delayFlag:!1,Module:{modules:{},modulesNeedToLoad:[]},_getMd5ModsStr:function(e){for(var t=[],i=0,n=e.length;n>i;i++){var a=e[i],o=this.MD5Mapping[a],r="$"+a+"$";o!==r&&t.push(a+"_"+o)}return t.join(",")},load:function(e,t,i){function n(t){var i=o.getModuleInfo(e);if(i.status!==o.Request.COMPLETED&&window.map){var n=new az("onmod_timeout");n.timeout=t/1e3,n.moduleName=e,window.map.fire(n)}}var a=this.getModuleInfo(e);if(a.status===this.Request.COMPLETED)i===!0&&t();else{if(a.status===this.Request.INITIAL){this.combine(e),this.addToLoadQueue(e);var o=this;o.delayFlag===!1&&(o.delayFlag=!0,setTimeout(function(){var e=o.Config.baseUrl+"&mod="+o._getMd5ModsStr(o.Module.modulesNeedToLoad);eL.load(e),o.Module.modulesNeedToLoad.length=0,o.delayFlag=!1},1)),a.status=this.Request.WAITING,setTimeout(n,this.Config.timeout,this.Config.timeout),setTimeout(n,2*this.Config.timeout,2*this.Config.timeout)}a.callbacks.push(t)}},combine:function(e){if(e&&this.Dependency[e])for(var t=this.Dependency[e],i=0;i<t.length;i++)this.combine(t[i]),this.Module.modules[t[i]]||this.addToLoadQueue(t[i])},addToLoadQueue:function(e){var t=this.getModuleInfo(e);t.status===this.Request.INITIAL&&(t.status=this.Request.WAITING,this.Module.modulesNeedToLoad.push(e))},run:function(e8,e9){var fd=this.getModuleInfo(e8),fg=this.Dependency[e8];if(fg)for(var fb=0;fb<fg.length;fb++){var fc=this.getModuleInfo(fg[fb]);if(fc.status!==this.Request.COMPLETED)return void fc.modsNeedToRun.push({name:e8,code:e9})}try{eval(e9)}catch(fe){return}fd.status=this.Request.COMPLETED;for(var fb=0,fa=fd.callbacks.length;fa>fb;fb++)fd.callbacks[fb]();for(fd.callbacks.length=0,fb=0;fb<fd.modsNeedToRun.length;fb++){var ff=fd.modsNeedToRun[fb];this.run(ff.name,ff.code)}fd.modsNeedToRun.length=0},getModuleInfo:function(e){var t;return this.Module.modules[e]||(this.Module.modules[e]={status:this.Request.INITIAL,callbacks:[],modsNeedToRun:[]}),t=this.Module.modules[e]}}),window._jsload=function(e,t){var i=cz.getModuleInfo(e);if(i.status=cz.Request.LOADED,""!==t)cz.run(e,t);else{if(window.map){var n=new az("ongetmodules_fail");n.moduleName=e,window.map.fire(n)}var a=document.createElement("script"),o=cz.MD5Mapping[e];a.src=cz.Config.jsModPath+e+"_"+o+".js",document.getElementsByTagName("head")[0].appendChild(a)}};var dk;dk="undefined"!=typeof window?window:self,M.prototype.mark=function(e){this._timeData[e]=this._getTime()},M.prototype.getMark=function(e){return this._timeData[e]},M.prototype.getTime=function(e,t){return parseFloat((this._timeData[t]-this._timeData[e]).toFixed(2))},M.prototype.print=function(){},M.prototype.clear=function(){this._timeData={}},M.prototype._getTime=dk.performance&&dk.performance.now?function(){return performance.now()}:function(){return Date.now()},!function(e,t){t(e.d3=e.d3||{})}(window,function(e){function t(e,i,n,r){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.ceil=function(t){return e(t=new Date(t-1)),i(t,1),e(t),t},s.round=function(e){var t=s(e),i=s.ceil(e);return i-e>e-t?t:i},s.offset=function(e,t){return i(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,n,a){var o=[];if(t=s.ceil(t),a=null==a?1:Math.floor(a),!(n>t&&a>0))return o;do o.push(new Date(+t));while(i(t,a),e(t),n>t);return o},s.filter=function(n){return t(function(t){for(;e(t),!n(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;i(e,1),!n(e););})},n&&(s.count=function(t,i){return a.setTime(+t),o.setTime(+i),e(a),e(o),Math.floor(n(a,o))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(r?function(t){return r(t)%e===0}:function(t){return s.count(0,t)%e===0}):s:null}),s}function i(e){return t(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*h)/u})}function n(e){return t(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/u})}var a=new Date,o=new Date,r=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});r.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,i){t.setTime(+t+i*e)},function(t,i){return(i-t)/e}):r:null};var s=r.range,l=1e3,h=6e4,c=36e5,d=864e5,u=6048e5,f=t(function(e){e.setTime(Math.floor(e/l)*l)},function(e,t){e.setTime(+e+t*l)},function(e,t){return(t-e)/l},function(e){return e.getUTCSeconds()}),p=f.range,m=t(function(e){e.setTime(Math.floor(e/h)*h)},function(e,t){e.setTime(+e+t*h)},function(e,t){return(t-e)/h},function(e){return e.getMinutes()}),g=m.range,_=t(function(e){var t=e.getTimezoneOffset()*h%c;0>t&&(t+=c),e.setTime(Math.floor((+e-t)/c)*c+t)},function(e,t){e.setTime(+e+t*c)},function(e,t){return(t-e)/c},function(e){return e.getHours()}),v=_.range,b=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*h)/d},function(e){return e.getDate()-1}),y=b.range,x=i(0),w=i(1),M=i(2),T=i(3),L=i(4),C=i(5),P=i(6),A=x.range,S=w.range,I=M.range,D=T.range,z=L.range,k=C.range,E=P.range,O=t(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),B=O.range,R=t(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});R.every=function(e){return isFinite(e=Math.floor(e))&&e>0?t(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,i){t.setFullYear(t.getFullYear()+i*e)}):null};var N=R.range,Z=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*h)},function(e,t){return(t-e)/h},function(e){return e.getUTCMinutes()}),H=Z.range,W=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*c)},function(e,t){return(t-e)/c},function(e){return e.getUTCHours()}),X=W.range,F=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/d},function(e){return e.getUTCDate()-1}),U=F.range,Y=n(0),G=n(1),V=n(2),j=n(3),q=n(4),K=n(5),$=n(6),J=Y.range,Q=G.range,et=V.range,tt=j.range,it=q.range,nt=K.range,at=$.range,ot=t(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),rt=ot.range,st=t(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});st.every=function(e){return isFinite(e=Math.floor(e))&&e>0?t(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,i){t.setUTCFullYear(t.getUTCFullYear()+i*e)}):null};var lt=st.range;e.timeInterval=t,e.timeMillisecond=r,e.timeMilliseconds=s,e.utcMillisecond=r,e.utcMilliseconds=s,e.timeSecond=f,e.timeSeconds=p,e.utcSecond=f,e.utcSeconds=p,e.timeMinute=m,e.timeMinutes=g,e.timeHour=_,e.timeHours=v,e.timeDay=b,e.timeDays=y,e.timeWeek=x,e.timeWeeks=A,e.timeSunday=x,e.timeSundays=A,e.timeMonday=w,e.timeMondays=S,e.timeTuesday=M,e.timeTuesdays=I,e.timeWednesday=T,e.timeWednesdays=D,e.timeThursday=L,e.timeThursdays=z,e.timeFriday=C,e.timeFridays=k,e.timeSaturday=P,e.timeSaturdays=E,e.timeMonth=O,e.timeMonths=B,e.timeYear=R,e.timeYears=N,e.utcMinute=Z,e.utcMinutes=H,e.utcHour=W,e.utcHours=X,e.utcDay=F,e.utcDays=U,e.utcWeek=Y,e.utcWeeks=J,e.utcSunday=Y,e.utcSundays=J,e.utcMonday=G,e.utcMondays=Q,e.utcTuesday=V,e.utcTuesdays=et,e.utcWednesday=j,e.utcWednesdays=tt,e.utcThursday=q,e.utcThursdays=it,e.utcFriday=K,e.utcFridays=nt,e.utcSaturday=$,e.utcSaturdays=at,e.utcMonth=ot,e.utcMonths=rt,e.utcYear=st,e.utcYears=lt,Object.defineProperty(e,"__esModule",{value:!0})}),d9.prototype.get=function(){var e=null;for(var t in this._objCollection)if(this._objCollection[t]&&this._objCollection[t]._free===!0)return this._objCollection[t]._free=!1,this._objCollection[t];return e=H(this._elemType),t=eM.getGUID("obj_pool_"),this._objCollection[t]=e,e},d9.prototype.free=function(e){e&&(e._free=!0,"img"===e.tagName.toLowerCase()&&(e.src="",e.crossOrigin=null,e.onload=e.onerror=null))},d9.prototype.clear=function(){for(var e in this._objCollection)this._objCollection[e]&&"img"===this._objCollection[e].tagName.toLowerCase&&(this._objCollection[e].onload=this._objCollection[e].onerror=null);this._objCollection={}};var eL=function(e){function t(t,i,n){var a=H("script",{src:t,type:"text/javascript",charset:"utf-8"});a.addEventListener?(a.addEventListener("load",function(e){var t=e.target;t.parentNode.removeChild(t),i&&i()},!1),a.addEventListener("error",function(){n&&n(null)},!1)):a.attachEvent&&a.attachEvent("onreadystatechange",function(){var e=window.event.srcElement;!e||"loaded"!==e.readyState&&"complete"!==e.readyState||e.parentNode.removeChild(e),i&&i()}),e.getElementsByTagName("head")[0].appendChild(a)}return{load:function(e,i,n){if("string"==typeof e)t(e,i,n);else if(e.length>0)for(var a=e.length,o=0;a>o;o++)t(e[o],function(){a--,0===a&&i&&i()})}}}(window.document);bz.instances={},bz.getInstance=function(e,t){if(bz.instances[e])return bz.instances[e];var i=new bU(e,t);return bz.instances[e]=i,i},bU.mapZoomBaseIndex=[0,0,0,8,7,7,6,6,5,5,4,3,3,3,2,2,1,1,0,0,0,0],bU.baseScaleZoom=[19,17,15,12,10,9,7,5,3],bU.baseScaleZoomMercatorSize=[512,2048,4096,32768,65536,262144,1048576,4194304,8388608],bU.mapZoomBaseZoomMapping=[0,0,0,3,5,5,7,7,9,9,10,12,12,12,15,15,17,17,19,19,19,19],bU.mapZoomStartZoomMapping=[0,0,0,3,4,4,6,6,8,8,10,11,11,11,14,14,16,16,18,18,18,18],bU.baseScaleTileSize=[1024,1024,512,512,256,512,512,512,256],bU.mapZoomTileSize=[0,0,0,256,256,512,256,512,256,512,256,256,512,1024,256,512,512,1024,512,1024,2048,4096],bU.baseZoomInfo={3:[3],5:[4,5],7:[6,7],9:[8,9],10:[10],12:[11,12,13],15:[14,15],17:[16,17],19:[18,19,20,21]},bU.prototype={getName:function(){return this._name},getTileSize:function(e){return e=Math.floor(e),3>e&&(e=3),"na"===this._name?bU.mapZoomTileSize[e]:this._opts.tileSize},getBaseTileSize:function(e){if(e=Math.floor(e),"na"===this._name){var t=bU.mapZoomBaseZoomMapping[e];return bU.mapZoomTileSize[t]}return this._opts.tileSize},getDataZoom:function(e){return e=Math.floor(e),"na"===this._name?bU.mapZoomBaseZoomMapping[e]:e},getZoomUnits:function(e){return Math.pow(2,this._baseZoom-e)},getMercatorSize:function(e,t){if("na"===this._name){e=Math.floor(e);var i=bU.mapZoomBaseIndex[e];return bU.baseScaleZoomMercatorSize[i]}return this._opts.tileSize*this.getZoomUnits(t)},getBaseZoom:function(){return this._baseZoom},getParentTile:function(e,t,i,n,a){if("na"===this._name){var o=bU.baseZoomInfo[i];if(n--,o.indexOf(n)>-1)return{col:e,row:t,zoom:i,useZoom:n};var r=bU.mapZoomBaseIndex[i],s=bU.baseScaleZoom[r+1];if(!s)return null;var l=this.getFactorByZooms(s,i),h=bU.baseZoomInfo[s];return{col:Math.floor(e/l),row:Math.floor(t/l),zoom:s,useZoom:h[h.length-1]}}return a>i-1?null:{col:Math.floor(e/2),row:Math.floor(t/2),zoom:i-1,useZoom:i-1}},getChildTiles:function(e,t,i,n,a,o){if("na"===this._name){var r=bU.baseZoomInfo[i];if(n+=o,r.indexOf(n)>-1)return[{col:e,row:t,zoom:i,useZoom:n}];for(var s=0,l=i;o>s;){var h=bU.mapZoomBaseIndex[l],c=bU.baseScaleZoom[h-1];if(!c)return null;var d=bU.baseZoomInfo[c];if(d[o-1]){for(var u=[],f=this.getFactorByZooms(i,c),p=e*f,m=t*f,g=0;f>g;g++)for(var _=p+g,v=0;f>v;v++){var b=m+v;u.push({col:_,row:b,zoom:c,useZoom:d[o-1]})}return u}s+=d.length,o===d.length&&(l=c)}return null}var u=[];if(i+o>a)return null;for(var f=Math.pow(2,o),p=e*f,m=t*f,c=i+o,u=[],g=0;2>g;g++)for(var _=p+g,v=0;2>v;v++){var b=m+v;
u.push({col:_,row:b,zoom:c,useZoom:c})}return u},getFactorByZooms:function(e,t){var i=bU.mapZoomBaseIndex[e],n=bU.mapZoomBaseIndex[t],a=bU.baseScaleZoomMercatorSize[i],o=bU.baseScaleZoomMercatorSize[n];return a/o}};var ay={},O=["swiftshader","microsoft basic render driver"],bk=["intel","nvidia","amd","apple","geforce"];ay.ifEnableEarth=function(e){var t=ay.ifEnableEarth;return e||"boolean"!=typeof t._enable?ay.ifSupportWebGL()?(t._enable=!0,!0):(t._enable=!1,!1):t._enable},ay.ifEnableWebGLMap=function(e){var t=ay.ifEnableWebGLMap;return e||"boolean"!=typeof t._enable?ay.ifSupportWebGL()?b5.inMapHost?(t._enable=!0,!0):window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder?(t._enable=!0,!0):(t._enable=!1,!1):(t._enable=!1,!1):t._enable},ay.params={},ay.ifSupportWebGL=function(){var e=ay.ifSupportWebGL;if("boolean"==typeof e._supportWebGL)return e._supportWebGL;if(!window.WebGLRenderingContext)return e._supportWebGL=!1,!1;var t=document.createElement("canvas");t.width=300,t.height=150;var i=null,n={alpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!1};try{i=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}catch(a){e._supportWebGL=!1}if(null===i)e._supportWebGL=!1;else{e._supportWebGL=!0;var o=i.getExtension("WEBGL_debug_renderer_info");if(o){var r=i.getParameter(o.UNMASKED_RENDERER_WEBGL);cr(r)===!0&&(e._supportWebGL=!0);var s=i.getParameter(o.UNMASKED_VENDOR_WEBGL);e._renderer=r,e._vendor=s}!o&&x.Browser.firefox&&(e._supportWebGL=!0),!o&&x.Platform.macintosh&&(e._supportWebGL=!0),(i.drawingBufferWidth!==t.width||i.drawingBufferHeight!==t.height)&&(e._supportWebGL=!1),i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<4&&(e._supportWebGL=!1);var l=i.getParameter(i.MAX_TEXTURE_SIZE);ay.params.maxTextureSize=l,4096>l&&(e._supportWebGL=!1);var h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);8>h&&(e._supportWebGL=!1),(!i.getShaderPrecisionFormat||i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision<23)&&(e._supportWebGL=!1)}return e._supportWebGL},ay.ifSupportCanvas2d=function(){var e=ay.ifSupportCanvas2d;if("boolean"==typeof e.supportCanvas2d)return e.supportCanvas2d;var t=document.createElement("canvas"),i=null;try{i=t.getContext("2d")}catch(n){e.supportCanvas2d=!1}return e.supportCanvas2d=null===i?!1:!0,e.supportCanvas2d},ay.ifEnableCanvas2dMap=function(){var e=navigator.userAgent,t=0,i=0,n=0;if(/macintosh/gi.test(e)){var a=0;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(a=parseInt(RegExp.$1||RegExp.$2,10)),a>0?!1:!0}if(/windows nt (\d+\.\d)/gi.test(e)&&(i=parseFloat(RegExp.$1),i>=6.1)){if(/chrome\/(\d+\.\d)/i.test(e)&&(t=parseFloat(RegExp.$1),t>=31))return!0;if(/MSIE (\d+(\.\d+)?)/.test(e)&&(n=parseFloat(RegExp.$1),n>=10))return!0;if(/Firefox/.test(e))return!0;if(/rv:11.0/gi.test(e))return!0;if(/edge/gi.test(e))return!0}return!1},ay.ifSupportCSS3=function(e,t){var i=document.createElement("div"),n="Webkit Moz O ms".split(" "),a=n.length,o="",r=i.style;e in r&&(o=e),e=e.replace(/^[a-z]/,function(e){return e.toUpperCase()});for(;a--;){var s=n[a]+e;if(s in r){o=s;break}}return t?o:o.length>0?!0:!1},ay.isModernBrowser=ay.ifSupportCanvas2d()&&ay.ifSupportCSS3("transform"),da.prototype.setData=function(e,t){var i=this._cache,n=this._size;if(0!==n){var a=this._curSize;a===n&&this._removeOld();var o;if(i[e]){if(o=i[e],o.data=t,this._most===o)return;o.older&&(o.older.newer=o.newer),o.newer&&(o.newer.older=o.older),this._least===o&&(this._least=o.newer)}else o={key:e,data:t,older:null,newwer:null},i[e]=o,null===this._least&&(this._least=o),null===this._most&&(this._most=o),this._curSize++;this._most&&this._most!==o&&(this._most.newer=o,o.older=this._most,this._most=o,o.newer=null)}},da.prototype.getData=function(e){var t=this._cache[e];if(this._getDataTimes++,t){this._hitTimes++;var i=t.data;return this._most===t?i:(t.older&&(t.older.newer=t.newer),t.newer&&(t.newer.older=t.older),this._least===t&&(this._least=t.newer),this._most.newer=t,t.older=this._most,t.newer=null,this._most=t,i)}return null},da.prototype.getAllData=function(){return this._cache},da.prototype.getHitRate=function(){return this._hitTimes/this._getDataTimes},da.prototype.removeData=function(e){var t=this._cache,i=t[e];i&&(this._options.clearCallback&&this._options.clearCallback(i.data,i.key),i.older&&(i.older.newer=i.newer),i.newer&&(i.newer.older=i.older),this._least===i&&(this._least=i.newer),this._most===i&&(this._most=i.older),delete t[e],this._curSize--)},da.prototype._removeOld=function(){for(var e=this._cache,t=Math.round(.6*this._size),i=0;this._least&&t>i;){var n=this._least;this._least=n.newer,n.newer&&(n.newer.older=null),this._options.clearCallback&&this._options.clearCallback(n.data,n.key),delete e[n.key],i++}this._curSize-=i,this._options.removeOldCallback&&this._options.removeOldCallback()},da.prototype.clear=function(){var e=(this._cache,this._least);if(this._options.clearCallback)for(;e;)this._options.clearCallback(e.data,e.key),e=e.newer;this._least=this._most=null,this._cache={},this._curSize=0},da.prototype.forEach=function(e){for(var t=this._least;t;)e(t.data),t=t.newer},da.prototype.clearExcept=function(e){for(var t=this._cache,i=this._least;i;)e[i.key]||(this._options.clearCallback&&this._options.clearCallback(i.data,i.key),i.older&&(i.older.newer=i.newer),i.newer&&(i.newer.older=i.older),this._least===i&&(this._least=i.newer),this._most===i&&(this._most=i.older),delete t[i.key],this._curSize--),i=i.newer},ax.inherits(cB,"Control"),x.extend(ax.prototype,{initialize:function(e){return this._map=e,this._container?(this._opts&&this._opts.container?this._opts.container.appendChild(this._container):e.container.appendChild(this._container),this._container):void 0},_i:function(e){!this._container&&this.initialize&&a3(this.initialize)&&(this._container=this.initialize(e)),this._opts=this._opts||{printable:!1},this._setStyle(),this._setPosition(),this._container&&(this._container._jsobj=this)},_setStyle:function(){var e=this._container;if(e){var t=e.style;t.position="absolute",t.zIndex=this._cZIndex||"10",t.MozUserSelect="none",this._opts.printable||x.ac(e,"BMap_noprint"),x.on(e,"contextmenu",bP)}},remove:function(){this._map=null,this._container&&(this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container._jsobj=null,this._container=null)},_render:function(){return this._container=this._opts&&this._opts.container?cg(this._opts.container,'<div unselectable="on"></div>'):cg(this._map.container,'<div unselectable="on"></div>'),this._visible===!1&&(this._container.style.display="none"),this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(e){(this.anchorFixed||"number"!=typeof e||isNaN(e)||BMAP_ANCHOR_TOP_LEFT>e||e>BMAP_ANCHOR_BOTTOM_RIGHT)&&(e=this.defaultAnchor),this._opts.offset=this._opts.offset||this.defaultOffset;var t=this._opts.anchor;if(this._opts.anchor=e,this._container){var i=this._container,n=this._opts.offset.width,a=this._opts.offset.height;switch(i.style.left=i.style.top=i.style.right=i.style.bottom="auto",e){case BMAP_ANCHOR_TOP_LEFT:i.style.top=a+"px",i.style.left=n+"px";break;case BMAP_ANCHOR_TOP_RIGHT:i.style.top=a+"px",i.style.right=n+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:i.style.bottom=a+"px",i.style.left=n+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:i.style.bottom=a+"px",i.style.right=n+"px"}var o=["TL","TR","BL","BR"];x.rc(this._container,"anchor"+o[t]),x.ac(this._container,"anchor"+o[e])}},getAnchor:function(){return this._opts.anchor},setOffset:function(e){e&&(this._opts=this._opts||{},this._opts.offset=new cy(e.width,e.height),this._container&&this.setAnchor(this._opts.anchor))},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){this._visible!==!0&&(this._visible=!0,this._container&&(this._container.style.display=""),this.dispatchEvent(new az("onshow")))},hide:function(){this._visible!==!1&&(this._visible=!1,this._container&&(this._container.style.display="none"),this.dispatchEvent(new az("onhide")))},isPrintable:function(){return!!this._opts.printable},isVisible:function(){return this._container||this._map?!!this._visible:!1}}),window.BMAP_ANCHOR_TOP_LEFT=0,window.BMAP_ANCHOR_TOP_RIGHT=1,window.BMAP_ANCHOR_BOTTOM_LEFT=2,window.BMAP_ANCHOR_BOTTOM_RIGHT=3,cf.inherits(ax,"CopyrightControl"),x.extend(cf.prototype,{initialize:function(e){return this._map=e,this._container},addCopyright:function(e){var t={minZoom:0,bounds:null,content:"",mapType:""};for(var i in e)t[i]=e[i];if(this._map){var n=t.minZoom;(-1===n||n<this._map.getMinZoom()||n>this._map.getMaxZoom())&&(t.minZoom=this._map.getMinZoom()),""===t.mapType||ba[t.mapType]||(t.mapType=BMAP_NORMAL_MAP)}var a=this.getCopyright(e.id);if(a)for(var o in t)a[o]=t[o];else this._copyrightCollection.push(t)},getCopyright:function(e){for(var t=0,i=this._copyrightCollection.length;i>t;t++)if(this._copyrightCollection[t].id===e)return this._copyrightCollection[t]},_asyncLoadCode:function(){var e=this;cz.load("control",function(){e._asyncDraw()})},addSateMapStyle:function(){this.sateMapStyle=!0,this._container&&x.ac(this._container,"BMap_cpyCtrl_w")},removeSateMapStyle:function(){this.sateMapStyle=!1,this._container&&x.rc(this._container,"BMap_cpyCtrl_w")}}),window.BMAP_UNIT_METRIC="metric",window.BMAP_UNIT_IMPERIAL="us",eH.inherits(ax,"ScaleControl"),x.extend(eH.prototype,{initialize:function(e){return this._map=e,this._container},setUnit:function(e){this._opts.unit=this._units[e]&&this._units[e].name||this._opts.unit},getUnit:function(){return this._opts.unit},_asyncLoadCode:function(){var e=this;cz.load("control",function(){e._asyncDraw()})},addSateMapStyle:function(){this.sateMapStyle=!0;var e=this._container;e&&x.ac(e.children[0],"dark")},removeSateMapStyle:function(){this.sateMapStyle=!1;var e=this._container;e&&x.rc(e.children[0],"dark")}}),window.BMAP_NAVIGATION_CONTROL_LARGE=0,window.BMAP_NAVIGATION_CONTROL_SMALL=1,window.BMAP_NAVIGATION_CONTROL_PAN=2,window.BMAP_NAVIGATION_CONTROL_ZOOM=3,window.BMAP_NAVIGATION_CONTROL_ANIM=4,b2.inherits(ax,"NavigationControl"),x.extend(b2.prototype,{initialize:function(e){return this._map=e,this._container},setType:function(e){this._opts.type="number"==typeof e&&e>=BMAP_NAVIGATION_CONTROL_LARGE&&BMAP_NAVIGATION_CONTROL_ANIM>=e?e:BMAP_NAVIGATION_CONTROL_LARGE},getType:function(){return this._opts.type},_asyncLoadCode:function(){var e=this;cz.load("control",function(){e._asyncDraw()})}}),aP.inherits(ax,"MapTypeControl"),x.extend(aP.prototype,{initialize:function(e){return this._map=e,this._container},showStreetLayer:function(e){this._map.showStreetLayer(e)}}),ek.prototype._init=function(){this._render(),this._bindDom(),this._bind(),this._adjustDisplayHeight();var e=new az("onindoor_bar_show");e.uid=this._indoorInfo.uid,this._map.dispatchEvent(e)},ek.prototype._render=function(){if(this._indoorInfo){var e=this._isMobile,t=this._div=H("div");x.ac(t,"floor-select-container"),e&&x.ac(t,"mobile"),e&&x.ac(t,"all-border-radius");var i=this._btnTop=H("button");x.ac(i,"floor-switch-top"),x.ac(i,"top-border-radius");var n=H("div");x.ac(n,"floor-switch-top-icon"),i.appendChild(n);var a=this._btnBottom=H("button"),o=H("div");x.ac(o,"floor-switch-bottom-icon"),a.appendChild(o),x.ac(a,"floor-switch-bottom"),x.ac(a,"bottom-border-radius");var r=this._floorsContainer=H("div");x.ac(r,"floors-container"),r.appendChild(this._createFloorsDom()),this._div.appendChild(i),this._div.appendChild(r),this._div.appendChild(a);var s=0;if(""===this._btnTop.style.display&&(s=2*this._sizeConfig.SWITCH_ARROW_HEIGHT),this._div.style.height=parseInt(this._floorsContainer.style.height,10)+s+"px",this._map.getContainer().appendChild(this._div),!e){var l=this;setTimeout(function(){l._div.style.right="20px"},20)}}},ek.prototype._createFloorsDom=function(){if(this._indoorInfo){for(var e=this._ol=H("ol"),t=this._indoorInfo.currentFloor,i=this._indoorInfo.floors.length-1;i>=0;i--){var n=this._indoorInfo.floors[i].floorName,a=H("li"),o=H("button");x.ac(o,"btn-select-floor"),i===t&&x.ac(o,"selected"),o.setAttribute("data-floor",i),o.innerHTML=n,a.appendChild(o),e.appendChild(a)}return e}},ek.prototype._updateUI=function(){return this._ol?(this._ol=null,this._ol=this._createFloorsDom(),this._floorsContainer.innerHTML="",this._floorsContainer.appendChild(this._ol),void this._adjustDisplayHeight()):(this._render(),this._bind(),void this._adjustDisplayHeight())},ek.prototype._bindDom=function(){var e=this;x.on(this._floorsContainer,"click",function(t){var i=t.target||t.srcElement;if("button"===i.tagName.toLowerCase()){e._map.showIndoor(e._indoorInfo.uid,parseInt(i.getAttribute("data-floor"),10));var n=new az("onindoor_bar_click");n.uid=e._indoorInfo.uid,e._map.dispatchEvent(n)}}),x.on(this._floorsContainer,"mouseover",function(e){var t=e.target;"button"===t.tagName.toLowerCase()&&x.ac(t,"hover")}),x.on(this._floorsContainer,"mouseout",function(e){var t=e.target;"button"===t.tagName.toLowerCase()&&x.rc(t,"hover")}),x.on(this._floorsContainer,"touchstart",function(e){var t=e.target;"button"===t.tagName.toLowerCase()&&x.ac(t,"onmousedown")}),x.on(this._floorsContainer,"touchend",function(e){var t=e.target;"button"===t.tagName.toLowerCase()&&x.rc(t,"onmousedown")}),x.on(this._btnTop,"mouseover",function(){this._disable||x.ac(this,"hover")}),x.on(this._btnTop,"mouseout",function(){x.rc(this,"hover")}),x.on(this._btnBottom,"mouseover",function(){this._disable||x.ac(this,"hover")}),x.on(this._btnBottom,"mouseout",function(){x.rc(this,"hover")}),x.on(this._btnTop,"touchstart",function(){this.className.indexOf("disable")>-1||x.ac(this,"onmousedown")}),x.on(this._btnTop,"touchend",function(){x.rc(this,"onmousedown")}),x.on(this._btnBottom,"touchstart",function(){this.className.indexOf("disable")>-1||x.ac(this,"onmousedown")}),x.on(this._btnBottom,"touchend",function(){x.rc(this,"onmousedown")}),x.on(this._btnTop,"click",function(){e._setBarSliderTop(parseInt(e._ol.style.top,10)+26)}),x.on(this._btnBottom,"click",function(){e._setBarSliderTop(parseInt(e._ol.style.top,10)-26)}),x.on(this._div,"mousemove",g),x.on(this._div,"wheel",bP),x.on(this._div,"mousewheel",bP),this._map.addEventListener("resize",function(){e._adjustDisplayHeight()})},ek.prototype._adjustDisplayHeight=function(){if(this._indoorInfo){var e=this._map.getSize().height,t=this._sizeConfig.FLOOR_BTN_HEIGHT,i=e-291-100;this._isMobile&&(i=e-12-108-this._map.config.bottomOffset);var n=this._indoorInfo.floors.length,a=n*t,o=n,r=0,s=this._floorsContainer.children[0];for(a>i?(this._showArrow=!0,x.rc(s.children[0].children[0],"top-border-radius"),x.rc(s.children[n-1].children[0],"bottom-border-radius")):(this._showArrow=!1,x.ac(s.children[0].children[0],"top-border-radius"),x.ac(s.children[n-1].children[0],"bottom-border-radius"));a>i&&0!==o;)o--,r=2*this._sizeConfig.SWITCH_ARROW_HEIGHT,a=o*t+r;this._currentDisplayHeight=a,this._setAdjustVisbile(3>o?!1:!0),this._floorsContainer.style.height=o*t+"px";var l=this._indoorInfo.currentFloor;this._div.style.height=parseInt(this._floorsContainer.style.height,10)+r+"px";var h=-(n-(l+Math.round(o/2)))*t;this._setBarSliderTop(h),n>o?(x.show(this._btnTop),x.show(this._btnBottom)):(x.hide(this._btnTop),x.hide(this._btnBottom),this._setBarSliderTop(0)),this._isMobile&&(this._div.style.bottom=108+this._map.config.bottomOffset+"px")}},ek.prototype._setBarSliderTop=function(e){var t=26,i=this._indoorInfo.floors.length,n=i*t;this._currentDisplayHeight&&(n=this._showArrow?this._currentDisplayHeight-30:this._currentDisplayHeight),n-e>=i*t?(e=n-i*t,x.ac(this._btnBottom,"disable"),x.rc(this._btnBottom,"hover"),this._btnBottom._disable=!0):(x.rc(this._btnBottom,"disable"),this._btnBottom._disable=!1),e>=0?(e=0,x.ac(this._btnTop,"disable"),x.rc(this._btnTop,"hover"),this._btnTop._disable=!0):(x.rc(this._btnTop,"disable"),this._btnTop._disable=!1),this._ol.style.top=e+"px"},ek.prototype._setAdjustVisbile=function(e){this._adjustVisible!==e&&(this._adjustVisible=e,this._div.style.right=e&&this._visible?"20px":"-30px")},ek.prototype._bind=function(){var e=this._map,t=this;e.on("indoor_status_changed",function(e){if(t._visible!==!1){var i=t._ol,n=e.uid;if(n)for(var a=e.floor,o=0;o<i.children.length;o++){var r=i.children[o].children[0];parseInt(r.getAttribute("data-floor"),10)===a?x.ac(r,"selected"):x.rc(r,"selected")}}}),e.on("zoomend",function(){t._setAdjustVisbile(this.getZoom()<17?!1:!0)})},ek.prototype.setInfo=function(e){this._indoorInfo&&this._indoorInfo.uid===e.uid||(this._indoorInfo=e,this._updateUI())},ek.prototype.show=function(){if(this._visible!==!0){this._visible=!0,this._isMobile?this._div.style.display="":this._div.style.right="20px";var e=new az("onindoor_bar_show");e.uid=this._indoorInfo.uid,this._map.dispatchEvent(e)}},ek.prototype.hide=function(){this._visible!==!1&&(this._visible=!1,this._isMobile?this._div.style.display="none":this._div.style.right="-30px")},x.extend(c6.prototype,{_init:function(){this._createDom(),this._bindDom(),this._bind(),dX()||(this._headingControl=new e0(this._map,this._div)),this._tiltControl=new cM(this._map,this._div),this._render();var e=this._map.getMapType(),t=this;"B_EARTH_MAP"===e||"webgl"===this._map._renderType?(t._div.style.opacity="1",t._div.style.visibility="visible"):(t._div.style.opacity="0",t._div.style.visibility="hidden")},_createDom:function(){var e=this._div=H("div"),t=e.style;t.position="absolute",t.zIndex=5,t.width="52px",t.height="82px",t.right="-3px",t.bottom="79px",t.opacity="0",t.visibility="hidden",t.WebkitTransition=t.transition="opacity .3s ease-out,visibility .3s ease-out"},_render:function(){var e=document.getElementById("map-operate");e?e.appendChild(this._div):this._map.getContainer().appendChild(this._div)},_bindDom:function(){this._div.addEventListener("mousemove",g)},_bind:function(){if("webgl"!==this._map._renderType){var e=this;this._map.on("maptypechange",function(){"B_EARTH_MAP"===this.mapType?e._firstAnimation?(e._firstAnimation=!1,setTimeout(function(){e._div.style.opacity="1",e._div.style.visibility="visible"},300)):(e._div.style.opacity="1",e._div.style.visibility="visible"):(e._div.style.opacity="0",e._div.style.visibility="hidden")})}}}),x.extend(e0.prototype,{_init:function(){this._createDom(),this._render(),this._bindDom(),this._bind(),this._updateUI(),this._checkEnable()},_checkEnable:function(){this._target.getZoom()>=this._target._enableHeadingZoom?this.enable():this.disable()},_createDom:function(){var e=this._div=H("div"),t=e.style;t.position="absolute",t.zIndex=5,t.top="0",t.left="0",t.width="52px",t.height="54px",t.background="url("+this._imgPath+") no-repeat",t.backgroundSize="266px auto",this._rotateCCW=this._createButton(),this._rotateCCW.title="逆时针转动",t=this._rotateCCW.style,t.left="2px",t.top="5px",t.zIndex="1",t.width="15px",t.height="42px",t.backgroundPosition="-75px -5px",this._rotateCW=this._createButton(),this._rotateCW.title="顺时针转动",t=this._rotateCW.style,t.right="2px",t.top="5px",t.zIndex="1",t.width="15px",t.height="42px",t.backgroundPosition="-75px -5px",t.WebkitTransform=t.transform="scaleX(-1)",this._compass=this._createButton(),this._compass.title="恢复正北方向",t=this._compass.style,t.left="19px",t.top="4px",t.width="14px",t.height="44px",t.backgroundPosition="-56px -4px",t.WebkitTransform=t.transform="rotate(0deg)",this._div.appendChild(this._rotateCCW),this._div.appendChild(this._compass),this._div.appendChild(this._rotateCW),this._domRendered=!0},_createButton:function(){var e=H("button"),t=e.style;return t.position="absolute",t.outline="none",t.border="none",t.background="url("+this._imgPath+") no-repeat",t.backgroundSize="266px auto",t.cursor="pointer",e},_render:function(){this._outContainer.appendChild(this._div)},enable:function(){this._enabled=!0,this._domRendered&&(this._rotateCCW.style.cursor="pointer",this._rotateCCW.style.opacity=1,this._rotateCW.style.cursor="pointer",this._rotateCW.style.opacity=1,this._compass.style.cursor="pointer",this._compass.style.opacity=1)},disable:function(){this._enabled=!1,this._domRendered&&(this._rotateCCW.style.cursor="",this._rotateCCW.style.opacity=.4,this._rotateCW.style.cursor="",this._rotateCW.style.opacity=.4,this._compass.style.cursor="",this._compass.style.opacity=.4)},_bindDom:function(){cV(this._div,["mousedown","click","dblclick"]);var e=this._map,t=this;this._rotateCW.addEventListener("click",function(){t._isOperating||t._enabled===!1||t._target.getLock()||(360===t._target.getHeading()&&t._target.setHeading(0),t._target.setLock(!0),t._target.setHeading(t._target.getHeading()+90,t._setHeadingOptions),e.fire(new az("onrotatecwclick")))},!1),this._rotateCCW.addEventListener("click",function(){t._isOperating||t._enabled===!1||t._target.getLock()||(-360===t._target.getHeading()&&t._target.setHeading(0),t._target.setLock(!0),t._target.setHeading(t._target.getHeading()-90,t._setHeadingOptions),e.fire(new az("onrotateccwclick")))},!1),this._rotateCW.addEventListener("mouseover",function(){t._enabled!==!1&&(this.style.backgroundPosition="-89px -5px")},!1),this._rotateCW.addEventListener("mouseout",function(){t._enabled!==!1&&(this.style.backgroundPosition="-75px -5px")},!1),this._rotateCCW.addEventListener("mouseover",function(){t._enabled!==!1&&(this.style.backgroundPosition="-89px -5px")},!1),this._rotateCCW.addEventListener("mouseout",function(){t._enabled!==!1&&(this.style.backgroundPosition="-75px -5px")},!1),this._compass.addEventListener("click",function(){if(!t._isOperating&&t._enabled!==!1&&!t._target.getLock()){t._target.setLock(!0);var i=!1;0!==t._target.getTilt()&&(i=!0,t._target.setTilt(0,t._setHeadingOptions)),t._target.getHeading()%360!==0&&(i=!0,t._target.resetHeading(t._setHeadingOptions)),i||t._target.setLock(!1),e.fire(new az("oncompassclick"))}},!1)},_bind:function(){var e=this;this._bindTarget(this._target),"webgl"===this._map._renderType&&this._map.addEventListener("maptypechange",function(){e._target="B_EARTH_MAP"===this.mapType?e._map._earth:e._map,e._bindTarget(e._target),e._checkEnable()})},_bindTarget:function(e){if(!(e===this._map&&this._mapBinded||e===this._map._earth&&this._earthBinded)){var t=this;e.addEventListener("heading_changed",function(){t._updateUI()}),e.addEventListener("animation_start",function(){t._isOperating=!0}),e.addEventListener("animation_end",function(){t._isOperating=!1}),e.on("load",function(){t._checkEnable()}),e.on("zoom_changed",function(){t._checkEnable()}),e===this._map?this._mapBinded=!0:this._earthBinded=!0}},_updateUI:function(){var e=this._target.getHeading(),t=this._compass.style;t.WebkitTransform=t.transform="rotate("+e+"deg)"},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}}),x.extend(cM.prototype,{_init:function(){this._createDom(),this._render(),this._bindDom(),this._bind(),this._checkEnable()},_checkEnable:function(){this._target.getZoom()>=this._target._enableTiltZoom?this.enable():this.disable()},_createDom:function(){var e=this._div=H("button");e.title="倾斜";var t=e.style;t.position="absolute",t.zIndex=5,t.outline="none",t.border="none",t.cursor="pointer",t.width="26px",t.height="26px",t.top="56px",t.right="13px",t.background="url("+this._imgPath+") no-repeat #fff",t.backgroundSize="266px auto",t.backgroundPosition="-110px 1px",t.boxShadow="1px 2px 1px rgba(0, 0, 0, 0.15)"},enable:function(){this._enabled=!0,this._div&&(this._div.style.cursor="pointer"),this._updateUI()},disable:function(){this._enabled=!1,this._div&&(this._div.style.cursor=""),this._updateUI()},_render:function(){this._outContainer.appendChild(this._div)},_bindDom:function(){var e=this;this._div.addEventListener("mousedown",function(t){if(e._enabled&&!e._target.getLock()){var i,n=e._target.getTilt();i=n===e._map.getCurrentMaxTilt()?"out":0===n?"in":e._preTrend?e._preTrend:"in",e._curTrend=i,e._clickTimer=setTimeout(function(){e._map.fire(new az("ontiltmsdown")),e._tiltAni=new l({duration:9999999,render:function(){n=e._target.getTilt(),"in"===i&&n<e._map.getCurrentMaxTilt()?e._target.setTilt(n+1,{noAnimation:!0}):"out"===i&&n>0&&e._target.setTilt(n-1,{noAnimation:!0})},finish:function(){e._tiltAni=null}}),e._clickTimer=null},200),t.stopPropagation()}},!1),this._div.addEventListener("mouseup",function(){e._enabled&&(e._tiltAni&&e._tiltAni.stop(),e._preTrend=e._curTrend)},!1),this._div.addEventListener("click",function(t){if(e._enabled&&e._clickTimer&&!e._target.getLock()){clearTimeout(e._clickTimer),e._map.fire(new az("ontiltclick"));var i=e._target.getTilt();e._target.setLock(!0),t.stopPropagation();var n=e._map.getCurrentMaxTilt();"in"===e._curTrend?e._target.setTilt(n,e._setTiltOptions):"out"===e._curTrend?e._target.setTilt(0,e._setTiltOptions):n>i?e._target.setTilt(n,e._setTiltOptions):e._target.setTilt(0,e._setTiltOptions)}},!1),this._div.addEventListener("mouseover",function(){e._enabled&&(e._mouseOver=!0,e._updateUI())},!1),this._div.addEventListener("mouseout",function(){e._enabled&&(e._mouseOver=!1,e._updateUI())},!1),cV(this._div,["mousedown","click","dblclick"])},_bind:function(){{var e=this;this._map}this._bindTarget(this._target),"webgl"===this._map._renderType&&this._map.addEventListener("maptypechange",function(){e._target="B_EARTH_MAP"===this.mapType?e._map._earth:e._map,e._bindTarget(e._target),e._checkEnable()})},_bindTarget:function(e){if(!(e===this._map&&this._mapBinded||e===this._map._earth&&this._earthBinded)){var t=this;e.on("load",function(){t._checkEnable()}),e.on("zoom_changed",function(){t._checkEnable()}),e.on("tilt_changed",function(){t._updateUI()}),e===this._map?this._mapBinded=!0:this._earthBinded=!0}},_updateUI:function(){var e=this._target.getTilt(),t=0,i=0,n=0;e>0&&(t=78),this._mouseOver&&(n=52),this._enabled===!1&&(i=26,n=0,t=0);var a="-"+(110+t+i+n)+"px 1px";this._div&&(this._div.style.backgroundPosition=a),this._enabled?e>0?this._div&&(this._div.title="恢复"):this._div&&(this._div.title="倾斜"):this._div&&(this._div.title="请放大地图后操作")},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}}),bg.inherits(cB,"ContextMenu"),x.extend(bg.prototype,{initialize:function(e){this._map=e},remove:function(){this._map=null},addItem:function(e,t){if(e&&"menuitem"==e._type&&""!=e._text&&!(e._width<=0)){for(var i=0,n=this._items.length;n>i;i++)if(this._items[i]===e)return;(void 0===t||t>this._items.length-1)&&(t=-1),e._insertIndex=t,-1===t?(this._items.push(e),this._rItems.push(e)):(this._items.splice(t,0,e),this._rItems.splice(t,0,e))}},removeItem:function(e){if(e&&"menuitem"==e._type){for(var t=0,i=this._items.length;i>t;t++)this._items[t]===e&&(this._items[t].remove(),this._items.splice(t,1),delete e._insertIndex,i--);for(var t=0,i=this._rItems.length;i>t;t++)this._rItems[t]===e&&(this._rItems[t].remove(),this._rItems.splice(t,1),delete e._insertIndex,i--)}},addSeparator:function(e){(void 0===e||e>this._items.length-1)&&(e=-1);var t={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null}),-1===e?this._items.push(t):this._items.splice(e,0,t)},removeSeparator:function(e){if(this._dividers[e]){for(var t=0,i=this._items.length;i>t;t++)this._items[t]&&"divider"==this._items[t]._type&&this._items[t]._dIndex==e&&(this._items.splice(t,1),i--),this._items[t]&&"divider"==this._items[t]._type&&this._items[t]._dIndex>e&&this._items[t]._dIndex--;this._dividers.splice(e,1)}},getDom:function(){return this._container},show:function(){1!=this._isOpen&&(this._isOpen=!0)},hide:function(){0!=this._isOpen&&(this._isOpen=!1)},setCursor:function(e){e&&(this._opts.cursor=e)},getItem:function(e){return this._rItems[e]},enable:function(){this._enable=!0},disable:function(){this._enable=!1}}),dA.inherits(cB,"MenuItem"),x.extend(dA.prototype,{initialize:function(e,t){this._map=e,this._contextmenu=t},remove:function(){this._contextmenu=null,this._map=null},setText:function(e){e&&(this._text=e+"")},getDom:function(){return this._container},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1}}),x.extend(cm.prototype,{setValues:function(e,t,i,n){this.minX=e||null,this.minY=t||null,this.maxX=i||null,this.maxY=n||null},isEmpty:function(){var e="number";return typeof this.minX!==e||typeof this.minY!==e||typeof this.maxX!==e||typeof this.maxY!==e},equals:function(e){return e?this.minX===e.minX&&this.minY===e.minY&&this.maxX===e.maxX&&this.maxY===e.maxY:void 0},containsBounds:function(e){return e?e.minX>this.minX&&e.maxX<this.maxX&&e.minY>this.minY&&e.maxY<this.maxY:void 0},getCenter:function(){return new eR((this.minX+this.maxX)/2,(this.minY+this.maxY)/2)},intersects:function(e){if(e){if(Math.max(e.minX,e.maxX)<Math.min(this.minX,this.maxX)||Math.min(e.minX,e.maxX)>Math.max(this.minX,this.maxX)||Math.max(e.minY,e.maxY)<Math.min(this.minY,this.maxY)||Math.min(e.minY,e.maxY)>Math.max(this.minY,this.maxY))return null;var t=Math.max(this.minX,e.minX),i=Math.min(this.maxX,e.maxX),n=Math.max(this.minY,e.minY),a=Math.min(this.maxY,e.maxY);return new cm(t,n,i,a)}},containsPoint:function(e){return e?e.lng>=this.minX&&e.lng<=this.maxX&&e.lat>=this.minY&&e.lat<=this.maxY:void 0},extend:function(e){if(e){var t=e.lng,i=e.lat;(!this.minX||this.minX>t)&&(this.minX=t),(!this.maxX||this.maxX<t)&&(this.maxX=t),(!this.minY||this.minY>i)&&(this.minY=i),(!this.maxY||this.maxY<i)&&(this.maxY=i)}},getMin:function(){return new eR(this.minX,this.minY)},getMax:function(){return new eR(this.maxX,this.maxY)},getSouthWest:function(){return this.getMin()},getNorthEast:function(){return this.getMax()},div:function(e){return(this.maxX-this.minX)*(this.maxY-this.minY)/((e.maxX-e.minX)*(e.maxY-e.minY))},toString:function(){return"Bounds"}});var cv=eR.prototype;cv.equals=function(e){if(!e)return!1;var t=Math.abs(this.lat-e.lat),i=Math.abs(this.lng-e.lng),n=1e-8;return n>t&&n>i?!0:!1},cv.clone=function(){return new eR(this.lng,this.lat)},cv.add=function(e){return new eR(this.lng+e.lng,this.lat+e.lat)},cv.sub=function(e){return new eR(this.lng-e.lng,this.lat-e.lat)},cv.mult=function(e){return new eR(this.lng*e,this.lat*e)},cv.div=function(e){return new eR(this.lng/e,this.lat/e)},cv.mag=function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)},cv.toString=function(){return"Point"},x.extend(cI,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[86,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(e,t){if(!e||!t)return 0;
var i,n,a,o;return(e=this.convertMC2LL(e))?(i=ch(e.lng),n=ch(e.lat),(t=this.convertMC2LL(t))?(a=ch(t.lng),o=ch(t.lat),this.getDistance(i,a,n,o)):0):0},getDistanceByLL:function(e,t){if(!e||!t)return 0;e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-80,84),t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-80,84);var i,n,a,o;return i=ch(e.lng),a=ch(e.lat),n=ch(t.lng),o=ch(t.lat),this.getDistance(i,n,a,o)},convertMC2LL:function(e){if(null===e)return e;if(!e)return new eR(0,0);var t,i;t=new eR(Math.abs(e.lng),Math.abs(e.lat));for(var n=0;n<this.MCBAND.length;n++)if(t.lat>=this.MCBAND[n]){i=this.MC2LL[n];break}var a=this.convertor(e,i);return new bK(a.lat,a.lng)},convertLL2MC:function(e){if(!e)return new eR(0,0);var t=e.lat,i=e.lng;i=this.getLoop(e.lng,-180,180),t=dE(t,-85,85);for(var n,a=0;a<this.LLBAND.length;a++)if(t>=this.LLBAND[a]){n=this.LL2MC[a];break}if(!n)for(a=0;a<this.LLBAND.length;a++)if(t<=-this.LLBAND[a]){n=this.LL2MC[a];break}var o=new eR(i,t),r=this.convertor(o,n),s=new eR(r.lng,r.lat);return s.latLng=e.clone(),s},convertor:function(e,t){if(e&&t){var i=t[0]+t[1]*Math.abs(e.lng),n=Math.abs(e.lat)/t[9],a=t[2]+t[3]*n+t[4]*n*n+t[5]*n*n*n+t[6]*n*n*n*n+t[7]*n*n*n*n*n+t[8]*n*n*n*n*n*n;return i*=e.lng<0?-1:1,a*=e.lat<0?-1:1,new eR(i,a)}},getDistance:function(e,t,i,n){return this.EARTHRADIUS*Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(t-e))},getRange:function(e,t,i){return null!=t&&(e=Math.max(e,t)),null!=i&&(e=Math.min(e,i)),e},getLoop:function(e,t,i){for(;e>i;)e-=i-t;for(;t>e;)e+=i-t;return e}}),x.extend(bK.prototype,{equals:function(e){return this.lat===e.lat&&this.lng===e.lng},clone:function(){return new bK(this.lat,this.lng)},getLngSpan:function(e){var t=this.lng,i=Math.abs(e-t);return i>180&&(i=360-i),i},sub:function(e){return new bK(this.lat-e.lat,this.lng-e.lng)},toString:function(){return this.lat+", "+this.lng}}),x.extend(cT.prototype,{isEmpty:function(){return!this._sw||!this._ne},equals:function(e){return this.isEmpty()?!1:this.getSouthWest().equals(e.getSouthWest())&&this.getNorthEast().equals(e.getNorthEast())},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},containsBounds:function(e){return this.isEmpty()||e.isEmpty()?!1:e._swLng>this._swLng&&e._neLng<this._neLng&&e._swLat>this._swLat&&e._neLat<this._neLat},getCenter:function(){return this.isEmpty()?null:new bK((this._swLat+this._neLat)/2,(this._swLng+this._neLng)/2)},intersects:function(e){if(Math.max(e._swLng,e._neLng)<Math.min(this._swLng,this._neLng)||Math.min(e._swLng,e._neLng)>Math.max(this._swLng,this._neLng)||Math.max(e._swLat,e._neLat)<Math.min(this._swLat,this._neLat)||Math.min(e._swLat,e._neLat)>Math.max(this._swLat,this._neLat))return!1;var t=Math.max(this._swLng,e._swLng),i=Math.min(this._neLng,e._neLng),n=Math.max(this._swLat,e._swLat),a=Math.min(this._neLat,e._neLat);return this._sw=new bK(n,t),this._ne=new bK(a,i),this._swLng=t,this._swLat=n,this._neLng=i,this._neLat=a,!0},containsPoint:function(e){return this.isEmpty()?!1:e.lng>=this._swLng&&e.lng<=this._neLng&&e.lat>=this._swLat&&e.lat<=this._neLat},extend:function(e){var t=e.lng,i=e.lat;this._sw||(this._sw=new bK(0,0)),this._ne||(this._ne=new bK(0,0)),(!this._swLng||this._swLng>t)&&(this._sw.lng=this._swLng=t),(!this._neLng||this._neLng<t)&&(this._ne.lng=this._neLng=t),(!this._swLat||this._swLat>i)&&(this._sw.lat=this._swLat=i),(!this._neLat||this._neLat<i)&&(this._ne.lat=this._neLat=i)},toSpan:function(){return this.isEmpty()?new bK(0,0):new bK(Math.abs(this._neLat-this._swLat),Math.abs(this._neLng-this._swLng))},union:function(e){if(e.isEmpty())return!1;var t=e.getSouthWest(),i=e.getNorthEast();return this._swLat>t.lat&&(this._swLat=t.lat),this._swLng>t.lng&&(this._swLng=t.lng),this._neLat<i.lat&&(this._neLat=i.lat),this._neLng<i.lng&&(this._neLng=i.lng),this._sw=new bK(this._swLat,this._swLng),this._ne=new bK(this._neLat,this._neLng),!0},toString:function(){return this._swLat+", "+this._swLng+", "+this._neLat+", "+this._neLng}});var co={idle:0,freeze:1,zooming:2,dragging:3,moving:4,readyToDrag:5,readyToPinch:6,pinching:7,stdMapCtrlDrag:8,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,arrowOpCodes:{37:1,38:2,39:4,40:8}},cF={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:!1,show:function(e){this._map||(this._map=e),this.inUse=!0,this._maskElement||this._createMask(e),this._maskElement.style.display="block"},_createMask:function(e){if(this._map||(this._map=e),this._map){var t=this._maskElement=cg(this._map.container,this._html);x.on(t,"mouseup",function(e){2==e.button&&bP(e)}),x.on(t,"contextmenu",bP),t.style.display="none"}},getDrawPoint:function(e,t,i){e=window.event||e;var n=e.offsetX||e.layerX||0,a=parseInt(e.offsetY)||parseInt(e.layerY)||0,o=e.target||e.srcElement;if(o!=cF.getDom(this._map)&&1==t)for(;o&&o!=this._map.container;)0==o.clientWidth&&0==o.clientHeight&&o.offsetParent&&"td"==o.offsetParent.nodeName.toLowerCase()||(n+=o.offsetLeft,a+=o.offsetTop),o=o.offsetParent;return o!=cF.getDom(this._map)&&o!=this._map.container||"undefined"==typeof n||"undefined"==typeof a||isNaN(n)||isNaN(a)?void 0:(i&&(n+=i.x,a+=i.y),this._map.pixelToPoint(new cG(n,a)))},hide:function(){this._map&&(this.inUse=!1,this._maskElement&&(this._maskElement.style.display="none"))},getDom:function(e){return this._maskElement||this._createMask(e),this._maskElement},setCursor:function(e){this._cursor=e||"default",this._maskElement&&(this._maskElement.style.cursor=this._cursor)}};aF.inherits(x.BaseClass,"Overlay"),aF.getZIndex=function(e,t){return(e=1*e)?(t&&(e=cI.convertMC2LL(new eM.Point(0,e)).lat),-1e5*e<<1):0},x.extend(aF.prototype,{_i:function(e){!this.domElement&&a3(this.initialize)&&(this.domElement=this.initialize(e),this.domElement&&(this.domElement.style.WebkitUserSelect="none")),this.draw()},initialize:function(){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){this.domElement&&this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=null,this.dispatchEvent(new az("onremove"))},hide:function(){x.hide(this.domElement)},show:function(){x.show(this.domElement)},dispose:function(){x.BaseClass.prototype.decontrol.call(this)}}),bC.inherits(aF,"OverlayInternal"),x.extend(bC.prototype,{initialize:function(e){return this.map=e,x.BaseClass.call(this,this.hashCode),null},draw:function(){},remove:function(){this.map=null,this.decontrol(),aF.prototype.remove.call(this)},hide:function(){this._visible=!1},show:function(){this._visible=!0},getDom:function(){return this.domElement},getContainer:function(){return this.domElement},setClassName:function(){},setConfig:function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this._config[t]=e[t])},getPoint:function(e,t){if(!e)return this.point;var i=t?t.width:0,n=t?t.height:0;if(this.map){var a=this.map.pointToPixel(this.point);return this._config&&this._config.offset?(a.x=a.x+this._config.offset.width+i,a.y=a.y+this._config.offset.height+n):(a.x=a.x+i,a.y=a.y+n),this.map.pixelToPoint(a)}},setZIndex:function(e){this.zIndex=e},isVisible:function(){return this.domElement?!!this._visible:!1},enableMassClear:function(){this._config.enableMassClear=!0},disableMassClear:function(){this._config.enableMassClear=!1},showInternal:function(){this._visibleInternal=!0},hideInternal:function(){this._visibleInternal=!1}}),c8.prototype._init=function(){"webgl"!==this.map._renderType?this._createOverlayContainers():this._createWebGLOverlayContainers(),this._bind()},c8.prototype._createOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200),e.temp.overlayDivEx=e.overlayDivEx=this._createOverlayDiv(e.platform,50),e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800),e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700),e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600),e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500),e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400),e._panes.mapPane=e.isCanvasMap()?this._createOverlayDiv(e.temp.overlayDivEx,50):this._createOverlayDiv(e.temp.overlayDiv,200)},c8.prototype._createWebGLOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200),e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800),e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700),e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600),e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500),e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400)},c8.prototype._createOverlayDiv=function(e,t){var i=H("div"),n=i.style;return n.position="absolute",n.top=n.left=n.width=n.height="0",n.zIndex=t,e.appendChild(i),i},c8.prototype._bind=function(){function e(e){a.draw(e)}function t(){("B_EARTH_MAP"===this.getMapType()||"webgl"===this._renderType)&&a._zoomingOrMoving===!1&&(this._panes.markerMouseTarget.style.display="none",a._zoomingOrMoving=!0)}function i(e){if(("B_EARTH_MAP"===this.getMapType()||"webgl"===this._renderType)&&a._zoomingOrMoving===!0){this._panes.markerMouseTarget.style.display="",a._zoomingOrMoving=!1;for(var t=0;t<a._overlayArray.length;t++){var i=a._overlayArray[t];i instanceof b0==!0&&i.draw(e)}}}var n=this.map,a=this;"webgl"!==n._renderType?(n.addEventListener("load",e),n.addEventListener("moveend",e),n.addEventListener("resize",e),n.addEventListener("zoomend",e),n.addEventListener("zooming",e)):n.on("update",e),n.addEventListener("zoomend",function(){"B_EARTH_MAP"===this.mapType&&(this._earth.getZoom()<this._earth.zoomForNight+1?(this.temp.overlayDiv.style.display="none",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display="none")):"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw()))}),n.addEventListener("oncenterandzoom",function(e){a.draw(e),"B_EARTH_MAP"===this.mapType&&(this._earth.getZoom()<this._earth.zoomForNight+1?(this.temp.overlayDiv.style.display="none",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display="none")):"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw()))}),n.addEventListener("maptypechange",function(e){"B_EARTH_MAP"===this.mapType?(this._panes.mapPane&&(this._panes.mapPane.style.display="none"),this._earth.getZoom()<this._earth.zoomForNight+1?(this.temp.overlayDiv.style.display="none",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display="none")):"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw()),this._panes.markerPane&&(this._panes.markerPane.style.display="none")):(this._panes.mapPane&&(this._panes.mapPane.style.display=""),this._panes.markerPane&&(this._panes.markerPane.style.display=""),"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw())),a.draw(e)}),n.on("earthstatuschange",function(e){a.draw(e)}),n.addEventListener("addoverlay",function(e){var t=e.target;if(t instanceof bC)a._overlays[t.hashCode]||(a._overlays[t.hashCode]=t,a._overlayArray.push(t));else{for(var i=!1,n=0,o=a._customOverlays.length;o>n;n++)if(a._customOverlays[n]===t){i=!0;break}i||a._customOverlays.push(t)}}),n.addEventListener("removeoverlay",function(e){var t=e.target;if(t instanceof bC){delete a._overlays[t.hashCode];for(var i=0;i<a._overlayArray.length;i++)if(a._overlayArray[i]===t){a._overlayArray.splice(i,1);break}}else for(var i=0,n=a._customOverlays.length;n>i;i++)if(a._customOverlays[i]===t){a._customOverlays.splice(i,1);break}}),n.addEventListener("clearoverlays",function(){this.closeInfoWindow(),this.closeSimpleInfoWindow();for(var e in a._overlays)a._overlays[e]._config.enableMassClear&&this.removeOverlay(a._overlays[e]);for(var t=a._customOverlays.length-1;t>0;t--)a._customOverlays[t].enableMassClear!==!1&&(this.removeOverlay(a._customOverlays[t]),a._customOverlays.splice(t,1))}),n.addEventListener("infowindowopen",function(){var e=this.infoWindow;e&&(x.hide(e.popDom),x.hide(e.shadowDom))}),n.addEventListener("movestart",t),n.addEventListener("moveend",i),n.addEventListener("zoomstart",t),n.addEventListener("zoomend",i),n.addEventListener("animation_start",t),n.addEventListener("animation_end",i),n.addEventListener("displayoptions_changed",function(){this.temp.overlayDiv.style.display=this._displayOptions.showOverlay===!1?"none":""})},c8.prototype.draw=function(e){if(e=e||{},"B_EARTH_MAP"===this.map.getMapType())for(var t=0;t<this._overlayArray.length;t++){var i=this._overlayArray[t];i instanceof s!=!0&&(this._zoomingOrMoving&&i instanceof b0==!0||i.draw(e))}else for(var t=0,n=this._overlayArray.length;n>t;t++){var i=this._overlayArray[t];this._zoomingOrMoving&&i instanceof b0==!0||i.draw(e)}if(x.each(this._customOverlays,function(t){t.draw(e)}),this.map.temp.infoWin&&this.map.temp.infoWin.setPosition(e.center,e.zoom),"B_EARTH_MAP"!==this.map.getMapType()&&"webgl"!==this.map._renderType&&eM.DrawerSelector){var a=eM.DrawerSelector.getDrawer(this.map);a.setPalette()}},eM.register(function(e){e._overlayMgr=new c8(e)}),s.JOININDEX={miter:0,round:1,bevel:2},s.CAPINDEX={round:0,butt:1,square:2},s.inherits(bC,"Graph"),s.getGraphPoints=function(e){var t=[];if(!e||0===e.length)return t;if("string"==typeof e){var i=e.split(";");x.each(i,function(e){var i=e.split(",");t.push(new eR(i[0],i[1]))})}return e.constructor===Array&&e.length>0&&(t=e),t},s.parseTolerance={0:[.09,.005,1e-4,1e-5],1:[9e3,500,20,1]},x.extend(s.prototype,{initialize:function(e){return this.map=e,null},draw:function(){},setPoints:function(e){this._clearCache(),this.points=s.getGraphPoints(e).slice(0),this._calcBounds()},_calcBounds:function(){if(this.points){var e=this;e._bounds=new cm,this.hasMultipleParts?x.each(this.points,function(t){x.each(t,function(t){e._bounds.extend(t)})}):x.each(this.points,function(t){e._bounds.extend(t)})}},getPoints:function(){return this.points},setPointAt:function(e,t){t&&this.points[e]&&(this._clearCache(),this.points[e]=new eR(t.lng,t.lat),this._calcBounds())},setStrokeColor:function(e){this._config.strokeColor=e},getStrokeColor:function(){return this._config.strokeColor},setStrokeLineCap:function(e){this._config.strokeLineCap=e},getStrokeLineCap:function(){return this._config.strokeLineCap},setStrokeLineJoin:function(e){this._config.strokeLineJoin=e},getStrokeLineJoin:function(){return this._config.strokeLineJoin},setStrokeWeight:function(e){e>0&&(this._config.strokeWeight=e)},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(e){!e||e>1||0>e||(this._config.strokeOpacity=e)},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(e){e>1||0>e||(this._config.fillOpacity=e)},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(e){("solid"===e||"dashed"===e||"dotted"===e)&&(this._config.strokeStyle=e)},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(e){this._config.fillColor=e||""},getFillColor:function(){return this._config.fillColor},getBounds:function(){return this._bounds},remove:function(){this.map&&this.map.removeEventListener("onmousemove",this._graphMouseEvent),bC.prototype.remove.call(this),this._clearCache();var e=new az("onlineupdate");e.action="remove",e.overlay=this,this.fire(e)},enableEditing:function(){this._config.enableEditing=!0},disableEditing:function(){this._config.enableEditing=!1},getParsedPoints:function(){var e=this._simplification(this.points);return this.hasMultipleParts?e:[e]},_simplification:function(e){var t,i=this.map,n=this.getParseCacheIndex(i.getZoom());if(this._parseCache[n])t=this._parseCache[n];else{var a=e;this.greatCirclePoints.length>0&&(a=this.greatCirclePoints);var o=this.getParseTolerance(i.getZoom(),i.config.coordType);if(this.hasMultipleParts)for(var r=[],s=0;s<a.length;s++){var l=eZ(a[s],o);r.push(l)}else var r=eZ(a,o);t=this._parseCache[n]=r}return t},_clearCache:function(){this._parseCache.length=0,this._parseCacheGL.length=0,this._parseCacheGLRaw.length=0,this._areaCacheGL.length=0}}),x.Browser.ie&&document.namespaces&&!document.namespaces.olv&&document.namespaces.add("olv","urn:schemas-microsoft-com:vml");var e6=eE.prototype;e6.setImageUrl=function(e){e&&(this.imageUrl=e,this._renderData=null)},eE.prototype.getCurrentImageUrl=function(){return window.devicePixelRatio>1&&this.srcSetObject["2x"]?this.srcSetObject["2x"]:this.imageUrl},e6.setPrintImageUrl=function(e){e&&(this.printImageUrl=e)},e6.setSize=function(e){e&&(this.size=new cy(e.width,e.height),this._renderData=null)},e6.setOffset=function(e){e&&(this.anchor=this.offset=new cy(e.width,e.height),this._renderData=null)},e6.setAnchor=function(e){this.setOffset(e)},e6.setImageOffset=function(e){e&&(this.imageOffset=new cy(e.width,e.height),this._renderData=null)},e6.setInfoWindowOffset=function(e){e&&(this.infoWindowOffset=new cy(e.width,e.height))},e6.setImageSize=function(e){e&&(this.imageSize=new cy(e.width,e.height))},e6.setImageSrcset=function(e){var t="";if(e){for(var i in e)e.hasOwnProperty(i)&&(this.srcSetObject[i]=e[i],t=e[i]+" "+i+",");this.srcSet=t}},e6.toString=function(){return"Icon"},e6.generateRenderData=function(){var e=this.offset,t=this.size,i=(this.imageOffset,[]);return i.push(-e.width,e.height-t.height,0),i.push(t.width-e.width,e.height-t.height,0),i.push(t.width-e.width,e.height,0),i.push(-e.width,e.height-t.height,0),i.push(t.width-e.width,e.height,0),i.push(-e.width,e.height,0),{vertex:i}},e6.getRenderData=function(){return this._renderData||(this._renderData=this.generateRenderData()),this._renderData},U.inherits(x.BaseClass,"InfoWindow"),x.extend(U.prototype,{setWidth:function(e){e=1*e,!e&&0!=e||isNaN(e)||0>e||(0!=e&&(220>e&&(e=220),e>730&&(e=730)),this._config.width=e)},setHeight:function(e){e=1*e,!e&&0!=e||isNaN(e)||0>e||(0!=e&&(60>e&&(e=60),e>650&&(e=650)),this._config.height=e)},setMaxWidth:function(e){e=1*e,!e&&0!=e||isNaN(e)||0>e||(0!=e&&(220>e&&(e=220),e>730&&(e=730)),this._config.maxWidth=e)},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=!0},disableAutoPan:function(){this._config.enableAutoPan=!1},enableCloseOnClick:function(){this._config.enableCloseOnClick=!0},disableCloseOnClick:function(){this._config.enableCloseOnClick=!1},enableMaximize:function(){this._config.enableMaximize=!0},disableMaximize:function(){this._config.enableMaximize=!1},show:function(){this._visible=!0},hide:function(){this._visible=!1},close:function(){this.hide()},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=!0},restore:function(){this.isWinMax=!1},setConfig:function(e){if(e)for(var t in e)typeof this._config[t]==typeof e[t]&&(this._config[t]=e[t])},isVisible:function(){return this.isOpen()},isOpen:function(){return!1},getPoint:function(){return this.overlay&&this.overlay.getPoint?this.overlay.getPoint():void 0},getOffset:function(){return this._config.offset},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},toString:function(){return"InfoWindow"}}),bN.prototype.openInfoWindow=function(e,t){if(e&&"InfoWindow"==e.toString()&&t&&"Point"==t.toString()){var i=this.temp;if(i.marker)i.marker.setPoint(t);else{var n=new eE(df.imgPath+"blank.gif",{width:1,height:1});i.marker=new b0(t,{icon:n,width:1,height:1,offset:new cy(0,0),infoWindowOffset:new cy(0,0),clickable:!1}),i.marker._fromMap=1}this.addOverlay(i.marker),i.marker.show(),i.marker.openInfoWindow(e)}},bN.prototype.closeInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;e&&e.overlay&&e.overlay.closeInfoWindow()},bC.prototype.openInfoWindow=function(e){this.map&&(this.map.closeInfoWindow(),e._visible=!0,this.map.temp._infoWin=e,e.overlay=this,x.BaseClass.call(e,e.hashCode))},bC.prototype.closeInfoWindow=function(){this.map&&this.map.temp._infoWin&&(this.map.temp._infoWin._visible=!1,this.map.temp._infoWin.decontrol(),this.map.temp._infoWin=null)},af.inherits(bC,"Label"),x.extend(af.prototype,{setPoint:function(e){e&&"Point"===e.toString()&&!this.getMarker()&&(this.point=this._config.point=new eR(e.lng,e.lat))},setContent:function(e){this.content=e},setOpacity:function(e){e>=0&&1>=e&&(this._config.opacity=e)},setOffset:function(e){e&&"Size"===e.toString()&&(this._config.offset=new cy(e.width,e.height))},getOffset:function(){return this._config.offset},setStyle:function(e){e=e||{},this._config.styles=x.extend(this._config.styles,e)},setStyles:function(e){this.setStyle(e)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setMarker:function(e){this._marker&&this._marker!==e&&(this._marker._config.label=null),this._marker=e,this.point=this._config.point=e?e.getPoint():null},getMarker:function(){return this._marker||null}}),window.BMAP_ANIMATION_DROP=1,window.BMAP_ANIMATION_BOUNCE=2,b0.TOP_ZINDEX=aF.getZIndex(-90)+1e6,b0.DRAG_ZINDEX=b0.TOP_ZINDEX+1e6,b0._injectMethond=function(e){x.extend(b0.prototype,e)},b0.inherits(bC,"Marker"),x.extend(b0.prototype,{setIcon:function(e){e&&(this._config.icon=e,this.textureCoord=this.textureCoordGLMap=null)},getIcon:function(){return this._config.icon},setLabel:function(e){e&&(this._config.label=e,e._config.enableMassClear=this._config.enableMassClear,e.setPoint(this.point))},getLabel:function(){return this._config.label},enableDragging:function(){this._config.enableDragging=!0},disableDragging:function(){this._config.enableDragging=!1},setPoint:function(e){e&&(this.point=this._config.point=new eR(e.lng,e.lat),this.latLng=cI.convertMC2LL(e))},setTop:function(e,t){this._config.isTop=!!e,e&&(this._addi=t||0)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setOffset:function(e){e&&(this._config.offset=e)},getOffset:function(){return this._config.offset},setAnimation:function(e){this._animation=e},setRank:function(e){this._config.rank=e},getRank:function(){return this._config.rank},setRotation:function(e){for(;0>e;)e+=360;this._rotation=e%360;var t=new az("onstatus_change");t.overlay=this,t.action="setRotation",this.fire(t)},getRotation:function(){return this._rotation}}),a.inherits(s,"Polyline"),dt.inherits(a,"PolylineMultipart"),x.extend(dt.prototype,{setPoints:function(e){e&&(this._clearCache(),this.points=this._unifyArgs(e),this._calcBounds())},_unifyArgs:function(e){var t=[],i=[];return e.constructor===Array?e[0].constructor===eR?i.push(e):i=e:"string"==typeof e&&i.push(e),x.each(i,function(e){t.push(s.getGraphPoints(e))}),t},setPointAt:function(e,t,i){i=i||0,t&&this.points[i]&&this.points[i][e]&&(this._clearCache(),this.points[i][e]=new eR(t.lng,t.lat),this._calcBounds())},getBounds:function(e){return e?this._normalizedBounds:this._bounds},_calcBounds:function(){if(this.points){var e=this;e._bounds.setValues(null,null,null,null),e.greatCirclePoints&&e.greatCirclePoints.length>0?x.each(e.greatCirclePoints,function(t){e._bounds.extend(t)}):x.each(e.points,function(t){x.each(t,function(t){e._bounds.extend(t)})}),e._normalizedBounds.setValues(e._bounds.minX,e._bounds.minY,e._bounds.maxX,e._bounds.maxY),(e._normalizedBounds.minX<-bN.WORLD_SIZE_MC_HALF||e._normalizedBounds.maxX>bN.WORLD_SIZE_MC_HALF)&&(e._normalizedBounds.minX=-bN.WORLD_SIZE_MC_HALF,e._normalizedBounds.maxX=bN.WORLD_SIZE_MC_HALF)}}}),aj.inherits(s,"Polygon"),x.extend(aj.prototype,{setPoints:function(e){var t=[];if("string"==typeof e||e[0]instanceof eR||this instanceof d0||0===e.length){var i=this._processSinglePointArray(e);this._userPoints=i.userPoints,t=i.innerPoints,this.hasMultipleParts=!1}else{this._userPoints=[];for(var n=0;n<e.length;n++){var a=this._processSinglePointArray(e[n]);this._userPoints.push(a.userPoints),t.push(a.innerPoints)}this.hasMultipleParts=!0}s.prototype.setPoints.call(this,t)},_processSinglePointArray:function(e){var t=s.getGraphPoints(e).slice(0);return innerPoints=t.slice(0),innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])&&innerPoints.push(new eR(innerPoints[0].lng,innerPoints[0].lat)),{userPoints:t,innerPoints:innerPoints}},setPointAt:function(e,t){this._userPoints[e]&&(this._userPoints[e]=new eR(t.lng,t.lat),this.points[e]=new eR(t.lng,t.lat),0!==e||this.points[0].equals(this.points[this.points.length-1])||(this.points[this.points.length-1]=new eR(t.lng,t.lat)),this._calcBounds())},getPoints:function(){var e=this._userPoints;return 0===e.length&&(e=this.points),e}}),d0.parseTolerance={0:[.01,1e-4,1e-5,4e-6],1:[1e3,10,1,.4]},d0.inherits(aj,"Circle"),x.extend(d0.prototype,{initialize:function(e){return this.map=e,this.points=this._getPerimeterPoints(this.point,this.radius),this._calcBounds(),null},getPoint:function(){return this.point},getCenter:function(){return this.point},setPoint:function(e){e&&(this.point=e)},setCenter:function(e,t){this.setPoint(e,t)},getRadius:function(){return this.radius},setRadius:function(e){this.radius=Math.abs(e)},_getPerimeterPoints:function(e,t){if(!e||!t||!this.map)return[];var i=(this.map,e.lng),n=e.lat,a=cI.convertMC2LL(e);i=a.lng,n=a.lat;for(var o=[],r=t/6370996.81,s=Math.PI/180*n,l=Math.PI/180*i,h=0;360>h;h+=9){var c=Math.PI/180*h,d=Math.asin(Math.sin(s)*Math.cos(r)+Math.cos(s)*Math.sin(r)*Math.cos(c)),u=Math.atan2(Math.sin(c)*Math.sin(r)*Math.cos(s),Math.cos(r)-Math.sin(s)*Math.sin(d)),f=(l-u+Math.PI)%(2*Math.PI)-Math.PI,p=new bK(d*(180/Math.PI),f*(180/Math.PI));o.push(cI.convertLL2MC(p))}var m=o[0];return o.push(new eR(m.lng,m.lat)),this._radiusMercator=m?Math.sqrt(Math.pow(m.lng-this.point.lng,2)+Math.pow(m.lat-this.point.lat,2)):this.radius,o}});var aO={};e1.inherits(x.BaseClass,"SimpleInfoWindow"),x.extend(e1.prototype,{setWidth:function(e){e=1*e,!e&&0!=e||isNaN(e)||0>e||(0!=e&&(50>e&&(e=50),e>730&&(e=730)),this._config.width=e)},setHeight:function(e){e=1*e,e-=10,!e&&0!=e||isNaN(e)||0>e||(0!=e&&(50>e&&(e=50),e>650&&(e=650)),this._config.height=e)},setMaxWidth:function(e){e=1*e,!e&&0!=e||isNaN(e)||0>e||(0!=e&&(50>e&&(e=50),e>730&&(e=730)),this._config.maxWidth=e)},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=!0},disableAutoPan:function(){this._config.enableAutoPan=!1},enableCloseOnClick:function(){this._config.enableCloseOnClick=!0},disableCloseOnClick:function(){this._config.enableCloseOnClick=!1},enableMaximize:function(){this._config.enableMaximize=!0},disableMaximize:function(){this._config.enableMaximize=!1},show:function(){this._visible=!0},hide:function(){this._visible=!1},close:function(){this.hide()},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=!0},restore:function(){this.isWinMax=!1},setConfig:function(e){if(e)for(var t in e)typeof this._config[t]==typeof e[t]&&(this._config[t]=e[t])},isVisible:function(){return this.isOpen()},isOpen:function(){return!1},getPoint:function(){return this.overlay&&this.overlay.getPoint?this.overlay.getPoint():void 0},getOffset:function(){return this._config.offset},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},toString:function(){return"SimpleInfoWindow"}}),bN.prototype.openSimpleInfoWindow=function(e,t){if(e&&"SimpleInfoWindow"==e.toString()&&t&&"Point"==t.toString()){var i=this.temp;if(i.marker)i.marker.setPoint(t);else{var n=new eE(df.imgPath+"blank.gif",{width:1,height:1});i.marker=new b0(t,{icon:n,width:1,height:1,offset:new cy(0,0),infoWindowOffset:new cy(0,0),clickable:!1}),i.marker._fromMap=1}this.addOverlay(i.marker),i.marker.show(),i.marker.openSimpleInfoWindow(e)}},bN.prototype.closeSimpleInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;e&&e.overlay&&e.overlay.closeSimpleInfoWindow()},bC.prototype.openSimpleInfoWindow=function(e){this.map&&(this.map.closeSimpleInfoWindow(),e._visible=!0,this.map.temp._infoWin=e,e.overlay=this,x.BaseClass.call(e,e.hashCode))},bC.prototype.closeSimpleInfoWindow=function(){this.map&&this.map.temp._infoWin&&(this.map.temp._infoWin._visible=!1,this.map.temp._infoWin.decontrol(),this.map.temp._infoWin=null)},cG.prototype.equals=function(e){return e?e.x==this.x&&e.y==this.y:!1},cG.prototype.clone=function(){return new cG(this.x,this.y)},cG.prototype.toString=function(){return"Pixel"},cy.prototype.equals=function(e){return!(!e||this.width!=e.width||this.height!=e.height)},cy.prototype.toString=function(){return"Size"};var aU={B_NORMAL_MAP:{tileUrls:cL(df.tileDomain,df.rasterTilePath),vectorTileUrls:cL(df.tileDomain,df.vectorTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:df.imgPath+"bg.png",bounds:new cm(-21364736,-11708041.66,23855104,12474104.17),imgExtend:"png"},B_SATELLITE_MAP:{tileUrls:["https://ss0.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv/starpic/?qt=satepc&","https://ss1.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv/starpic/?qt=satepc&","https://ss2.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv/starpic/?qt=satepc&","https://ss3.bdstatic.com/8bo_dTSlR1gBo1vgoIiO_jowehsv/starpic/?qt=satepc&"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:df.imgPath+"bg.png",bounds:new cm(-21364736,-10616832,23855104,15859712),imgExtend:"png"},B_STREET_MAP:{tileUrls:cL(df.tileDomain,df.rasterTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:df.imgPath+"bg.png",bounds:new cm(-21364736,-10616832,23855104,15859712),imgExtend:"png"},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:df.imgPath+"blank.gif",bounds:new cm(-21364736,-10616832,23855104,15859712),imgExtend:"png"},B_EARTH_MAP:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:df.imgPath+"blank.gif",bounds:new cm(-21364736,-10616832,23855104,15859712),imgExtend:"png"}},ba=aU;a1.prototype._addLoadCbk=function(e){this._cbks.push(e)},a1.prototype._load=function(){this.img.src=FeBrowser.ie<=6&&FeBrowser.ie>0&&this._transparentPng?df.imgPath+"blank.gif":this.src},a1.prototype._callCbks=function(){for(var e=this,t=0;t<e._cbks.length;t++)e._cbks[t]();e._cbks.length=0};var L=!x.Browser.ie||x.Browser.ie>8;eM.register(function(e){if("webgl"!==e._renderType){var t=e.tileMgr=new dm(e);e.addEventListener("mousewheel",function(e){t.mouseWheel(e)}),e.addEventListener("dblclick",function(e){t.dblClick(e)}),e.addEventListener("rightdblclick",function(e){t.dblClick(e)}),e.addEventListener("minuspress",function(e){t.keypress(e)}),e.addEventListener("pluspress",function(e){t.keypress(e)}),e.addEventListener("load",function(){this.mapType!==BMAP_EARTH_MAP&&t.loadTiles()}),e.addEventListener("zoomstartcode",function(e){this.mapType!==BMAP_EARTH_MAP&&t._zoom(e)}),e.addEventListener("moving",function(){this.mapType!==BMAP_EARTH_MAP&&t.moveGridTiles()}),e.addEventListener("resize",function(e){this.mapType!==BMAP_EARTH_MAP&&t.resizeMap(e)}),e.addEventListener("addtilelayer",function(e){t.addTileLayer(e)
}),e.addEventListener("removetilelayer",function(e){t.removeTileLayer(e)})}}),x.extend(dm.prototype,{addTileLayer:function(e){var t=this,i=e.target;t.tileLayers.push(i),t.map.loaded&&t.moveGridTiles()},removeTileLayer:function(e){var t=this,i=e.target,n=i.mapType,a=t.mapTiles,o=t.bufferTiles;for(var r in o){var s=r.split("-")[1];s==n&&delete o[r]}for(var r in a){var s=r.split("-")[1];s==n&&delete a[r]}t.zoomsDiv&&t.zoomsDiv.parentNode&&(t.zoomsDiv.parentNode.removeChild(t.zoomsDiv),t.zoomsDiv.innerHTML="");var l=t.map;if(l.deepZoom){var h=l.deepZoom.preDeepZoomDiv;h&&h.parentNode&&h.parentNode.removeChild(h)}for(var c=0,d=t.tileLayers.length;d>c;c++)i==t.tileLayers[c]&&t.tileLayers.splice(c,1);t.moveGridTiles()},hideDeepZoomDiv:function(){var e=this,t=e.map;if(t.deepZoom){var i=t.deepZoom.preDeepZoomDiv;i&&"none"!=i.style.display&&(i.style.display="none")}},getTileLayer:function(e){for(var t=this,i=0,n=t.tileLayers.length;n>i;i++)if(tilelayer=t.tileLayers[i],tilelayer.mapType==e)return tilelayer;return null},_zoom:function(){var e=this;e.zoomsDiv&&"none"!=e.zoomsDiv.style.display&&(e.zoomsDiv.style.display="none"),e.hideDeepZoomDiv(),setTimeout(function(){e.moveGridTiles(),e.map.dispatchEvent(new az("onzoomend"))},10)},resizeMap:function(){this.loaded=!1,this.moveGridTiles()},_checkTilesLoaded:function(){this.numLoading--;var e=this;0==this.numLoading&&(this._checkLoadedTimer&&(clearTimeout(this._checkLoadedTimer),this._checkLoadedTimer=null),this._checkLoadedTimer=setTimeout(function(){0==e.numLoading&&e.map.dispatchEvent(new az("ontilesloaded")),e._checkLoadedTimer=null},80))},getTileName:function(e,t){var i=t.mapType,n="TILE-"+i+"-"+e[0]+"-"+e[1]+"-"+e[2];return n},hideTile:function(e,t){var i=e.img;eF(i)&&(e.loaded&&this.imgNumber--,i.parentNode&&(dw(i),i.parentNode.removeChild(i)));var n=new az("onimagechange");n.tile=this.getTileName(e.info,t),n.action="hide",delete this.mapTiles[e.name],e.loaded||(dw(i),e._callCbks(),i=null,e.img=null,e.mgr=null),this.map.dispatchEvent(n)},loadTiles:function(){var e=this;if(x.Browser.ie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(t){}this.zoomsDiv&&"none"!=this.zoomsDiv.style.display&&(this.zoomsDiv.style.display="none"),e.hideDeepZoomDiv(),e.moveGridTiles()},getCell:function(e,t){var i=this.baseUnits*Math.pow(2,this.baseZoomLevel-t),n=parseInt(e.lng/i),a=parseInt(e.lat/i);return[n,a,i*(n+.5),i*(a+.5)]},moveGridTiles:function(){var e=this.map,t=e.getMapType(),i=this.tileLayers.length,n=e.centerPoint;t!==BMAP_SATELLITE_MAP&&(n=cu.calcLoopCenterPoint(n));for(var a=e.width,o=e.getZoomUnits(),r=o*a,s=n.lng-r/2,l=n.lng+r/2,h=cu.isAddWidth(s,l),c=0;i>c;c++){var d=this.tileLayers[c];(d.baseLayer||1==i)&&(this.tilesDiv=d.tilesDiv);for(var u=ba[d.mapType],f=e.zoomLevel,p=e.getZoomUnits(e.zoomLevel),m=u.baseUnits*Math.pow(2,u.zoomLevelBase-f),g=Math.floor(n.lng/m),_=Math.floor(n.lat/m),v=u.tileSize,b=[g,_,(n.lng-g*m)/m*v,(n.lat-_*m)/m*v],y=h?e.width/2*1.5:e.width/2,x=b[0]-Math.ceil((y-b[2])/v),w=b[1]-Math.ceil((e.height/2-b[3])/v),M=b[0]+Math.ceil((y+b[2])/v),T=b[1]+Math.ceil((e.height/2+b[3])/v),L=[],C=x;M>C;C++)for(var P=w;T>P;P++){L.push([C,P]);var A="id_"+C+"_"+P+"_"+f;L[A]=!0}d.mapType!==BMAP_SATELLITE_MAP&&(L=cu.calcLoopTiles(L,f)),L.sort(function(e){return function(t,i){return.4*Math.abs(t[0]-e[0])+.6*Math.abs(t[1]-e[1])-(.4*Math.abs(i[0]-e[0])+.6*Math.abs(i[1]-e[1]))}}([b[0],b[1]]));var S=this.mapTiles,I=-n.lng/p,D=n.lat/p,z=[Math.round(I),Math.round(D)];for(var k in S){var E=S[k],O=E.info;if(O){var A="id_"+O[0]+"_"+O[1]+"_"+O[2];L[A]||this.hideTile(E,d)}}var B=-e.offsetX+e.width/2,R=-e.offsetY+e.height/2;d.tilesDiv.style.left=Math.round(I+B)-z[0]+"px",d.tilesDiv.style.top=Math.round(D+R)-z[1]+"px",this.numLoading+=L.length;for(var C=0,N=L.length;N>C;C++)this.showTile([L[C][0],L[C][1],e.zoomLevel],z,d,C)}},showTile:function(e,t,i){this.centerPos=t;var n=ba[i.mapType],a=this.getTileName(e,i),o=e[0]*n.tileSize+t[0],r=(-1-e[1])*n.tileSize+t[1],s=[o,r],l=null;if(i.mapType!==BMAP_SATELLITE_MAP){l=cu.calcLoopParam(e[0],e[2]);var h=l.offsetX;s[0]+=h,s._offsetX=h}var c=this,d=this.mapTiles[a];if(d)return d.img.style.left=s[0]+"px",d.img.style.top=s[1]+"px",void(d.loaded?this._checkTilesLoaded():d._addLoadCbk(function(){c._checkTilesLoaded()}));if(d=this.bufferTiles[a]){this.imgNumber++,i.tilesDiv.insertBefore(d.img,i.tilesDiv.lastChild),this.mapTiles[a]=d,d.img.style.left=s[0]+"px",d.img.style.top=s[1]+"px",d.loaded?this._checkTilesLoaded():d._addLoadCbk(function(){c._checkTilesLoaded()});var u=new az("onimagechange");u.action="cache",u.tile=this.getTileName(e,i),this.map.dispatchEvent(u)}else{var f=new cG(e[0],e[1]);l&&(f.x=l.col);var p=i.getTilesUrl(f,e[2]);d=new a1(this,p,s,e,i),d._addLoadCbk(function(){c._checkTilesLoaded()}),d._load(),this.mapTiles[a]=d,aM(this.map)}},mouseWheel:function(e){var t=this.map;if(t.config.enableWheelZoom){var i=t.zoomLevel+(e.trend===!0?1:-1),n=t._getProperZoom(i);if(n.exceeded){var a=new az("onzoomexceeded");return a.targetZoom=i,void t.dispatchEvent(a)}t.dispatchEvent(new az("onzoomstart")),t.lastLevel=t.zoomLevel,t.zoomLevel=n.zoom;var o=e.pixel,r=t.pixelToPoint(o,{zoom:t.lastLevel}),s=t.getZoomUnits(t.zoomLevel);t.centerPoint=new eR(r.lng+s*(t.width/2-o.x),r.lat-s*(t.height/2-o.y)),this.zoom(o)}},dblClick:function(e){var t=this.map;if(t.config.enableDblclickZoom&&"B_EARTH_MAP"!==t.mapType&&t.currentOperation!==co.dragging){var i=e.pixel,n=t.pixelToPoint(i),a=1,o=i;"onrightdblclick"==e.type&&(a=-1);var r=t.zoomLevel+a,s=t._getProperZoom(r);if(s.exceeded){var l=new az("onzoomexceeded");l.targetZoom=r,t.dispatchEvent(l)}else{t.dispatchEvent(new az("onzoomstart"));var h=t.deepZoom;if(h)h.zoomMap(o,a,a);else{t.lastLevel=t.zoomLevel,t.zoomLevel=s.zoom;var c=t.getZoomUnits(t.zoomLevel);t.centerPoint=new eR(n.lng+c*(t.width/2-i.x),n.lat-c*(t.height/2-i.y)),this.zoom(i)}}}},keypress:function(e){var t=this.map;if(t.getMapType()!==BMAP_EARTH_MAP){if(!t.config.enableContinuousZoom)return void("onpluspress"==e.type?t.zoomIn():t.zoomOut());if(!this._zTimeLine){var i=t.deepZoom;if(i){var n="onpluspress"==e.type?1:-1;t.deepZoomMedia(n)}else{var a=t.zoomLevel+("onpluspress"==e.type?1:-1),o=t._getProperZoom(a);if(o.exceeded){var r=new az("onzoomexceeded");return r.targetZoom=a,void t.dispatchEvent(r)}t.dispatchEvent(new az("onzoomstart"));var s=new cG(t.width/2,t.height/2);if(t.lastLevel=t.zoomLevel,t.zoomLevel=o.zoom,t.getInfoWindow()){s=t.pointToPixel(t.getInfoWindow().getPoint(),{zoom:t.lastLevel});var l=t.pixelToPoint(s,{zoom:t.lastLevel}),h=t.getZoomUnits(t.zoomLevel);t.centerPoint=new eR(l.lng+h*(t.width/2-s.x),l.lat-h*(t.height/2-s.y))}this.zoom(s)}}}}}),bA.inherits(cB,"TileLayer"),x.extend(bA.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(e,t){var i=ba[this.mapType];if("object"!=typeof i)return null;var n=e.x,a=e.y;if(this.mapType!==BMAP_SATELLITE_MAP)var a=cu.calcLoopParam(a,t).col;var o="";if(this.opts.tileUrlTemplate)o=this.opts.tileUrlTemplate,o=o.replace(/\{X\}/,a),o=o.replace(/\{Y\}/,n),o=o.replace(/\{Z\}/,t);else{if(this.mapType==BMAP_NORMAL_MAP){var r=this.isCanvasMap?0:1,s=i.tileUrls[Math.abs(a+n)%i.tileUrls.length];window.offLineIPAddress&&(s=window.offLineIPAddress+"tile5/"),o=s+"?qt=vtile&x="+n+"&y="+a+"&z="+t+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&showtext="+r,o=o.replace(/-(\d+)/gi,"M$1")}if(this.mapType==BMAP_SATELLITE_MAP){var l=aa("ditu","satellite"),h=l.ver,c=l.udt;o=i.tileUrls[Math.abs(a+n)%i.tileUrls.length]+"u=x="+n+";y="+a+";z="+t+";v="+h+";type=sate&fm=46&udt="+c,o=o.replace(/-(\d+)/gi,"M$1")}}return o},initialize:function(e){if(this.map=e,"webgl"===e._renderType){var t=null;this.customLayer!==!1&&(t=this.getTilesUrl),x.extend(this,dN),this.labelProcessor=new bW(this),this.callbackDataQueue=[],t&&(this.getTilesUrl=t);var i=this;e.on("indoor_data_refresh",function(e){i.baseLayer&&i._refreshIndoorData(e.uid,e.floor)}),e.on("custom_labels_ready",function(e){i.baseLayer&&i._doWorkAfterLabelImageLoad(e.virtualTile,e.labelCanvas,null,e.imgKey)}),e.on("glmoduleloaded",function(){i.baseLayer&&i.updateAllIconsTextureCoords()})}e.temp.layerZIndex||(e.temp.layerZIndex=0),this.zIndex=this.zIndex||0,this.baseLayer&&(this.zIndex=0),e.temp.layid||(e.temp.layid=0),this.opts.mapType?this.mapType=this.opts.mapType:(this.mapType="BMAP_CUSTOM_LAYER_"+e.temp.layid,e.temp.layid++);var n=ba[this.mapType];if(n||(ba[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minZoom:3,maxZoom:19,minDataZoom:3,maxDataZoom:19,zoomLevelBase:18,errorUrl:df.imgPath+"/blank.gif",bounds:new cm(-21364736,-10616832,23855104,15859712),imgExtend:"png"}),"webgl"!==e._renderType){var a=cg(e.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');a.style.display="",a.style.left=Math.ceil(-e.offsetX+e.width/2)+"px",a.style.top=Math.ceil(-e.offsetY+e.height/2)+"px",this.tilesDiv=a}this.isCanvasMap=e.isCanvasMap(),this.lastZoom=e.getZoom()},remove:function(){this.tilesDiv&&this.tilesDiv.parentNode&&(this.tilesDiv.innerHTML="",this.tilesDiv.parentNode.removeChild(this.tilesDiv)),delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},setZIndex:function(e){this.zIndex=e,this.tilesDiv&&(this.tilesDiv.style.zIndex=e)}}),bL.inherits(cB,"Copyright");var ea={get:function(e){return ea.singleton||(ea.singleton=new Q(e)),ea.singleton}};x.extend(Q.prototype,{prepareLayer:function(){var e=this._map,t=this._tileMgr;this._canvas2dMapMgr=e.canvas2dMapMgr;var i=this._baseLayerDiv=t.tilesDiv;if(!this._animationDiv){var n=this._preAnimationDiv;n&&(n.parentNode&&n.parentNode.removeChild(n),this._preAnimationDiv=null),this._preAnimationDiv=this._animationDiv=i.cloneNode(!0),e.platform.insertBefore(this._animationDiv,e.platform.firstChild)}this.show()},prepareAniParam:function(){var e=this._animationDiv;if(e){var t,i=e.children.length;this._zoomAniInfo=[];for(var n=i-1;n>-1;n--){var a={};t=e.children[n].style,a.top=parseInt(t.top,10),a.left=parseInt(t.left,10),this._zoomAniInfo[n]=a}}},prepareLabelLayer:function(){var e=this._map;if(this._enableCanvas2dMap&&e.canvas2dMapMgr){this.touchZoomLabelCanvas&&this.touchZoomLabelCanvas.parentNode.removeChild(this.touchZoomLabelCanvas);var t=e.canvas2dMapMgr._labelCanvas;this.touchZoomLabelCanvas=t.cloneNode(!1);var i=this.touchZoomLabelCanvas.getContext("2d");i.drawImage(t,0,0),e.platform.insertBefore(this.touchZoomLabelCanvas,e.platform.firstChild);var n=parseInt(t.style.left,10),a=parseInt(t.style.top,10);this.touchZoomLabelCanvas.style.zIndex=9,this.touchZoomLabelCanvas.style[this._transformOriginStyleName]=this._fixPosition.x-(e.offsetX+n)+"px "+(this._fixPosition.y-(e.offsetY+a))+"px",t.style.visibility="hidden"}},show:function(){this._animationDiv&&(this._animationDiv.style.visibility="")},showLabel:function(){var e=this._map;if(this._enableCanvas2dMap&&e.canvas2dMapMgr){var t=e.canvas2dMapMgr._labelCanvas;t&&(t.style.visibility=""),this.touchZoomLabelCanvas&&(this.touchZoomLabelCanvas.style.zIndex=-2,this.touchZoomLabelCanvas.style.visibility="hidden")}},hide:function(){this._animationDiv&&(this._animationDiv.style.visibility="hidden"),this._preAnimationDiv&&(this._preAnimationDiv.style.visibility="hidden")},hideNonAnimationLayers:function(){var e=this._map;"dom"===e.getRenderType()&&(e.overlayDiv&&(e.overlayDiv.style.visibility="hidden"),e.overlayDivEx&&(e.overlayDivEx.style.visibility="hidden"));for(var t,i=e.tileMgr.tileLayers,n=0,a=i.length;a>n;n++)t=i[n],t.tilesDiv.style.visibility="hidden"},showNonAnimationLayers:function(){var e=this._map;"dom"===e.getRenderType()&&(e.overlayDiv&&(e.overlayDiv.style.visibility=""),e.overlayDivEx&&(e.overlayDivEx.style.visibility=""));for(var t,i=e.tileMgr.tileLayers,n=0,a=i.length;a>n;n++)t=i[n],t.tilesDiv.style.visibility=""},setFixPosition:function(e){this._fixPosition=e},setZoom:function(e,t){var i=this._fixPosition,n=this._map,a=this._baseLayerDiv,o={x:i.x-parseInt(a.style.left,10)-n.offsetX,y:i.y-parseInt(a.style.top,10)-n.offsetY},r=this._animationDiv;if(r){for(var s,l,h,c=r.children.length,d=this._transformStyleName,u=(this._transformOriginStyleName,this),f=c-1;f>-1;f--){var p=this._zoomAniInfo[f];s=r.children[f].style;var m=p.left-o.x,g=p.top-o.y;p.dx=m*e-m,p.dy=g*e-g,p.preDx=m-m,p.preDy=g-g,l=p.preDx+(p.dx-p.preDx),h=p.preDy+(p.dy-p.preDy)+t,s.left=p.left+l+"px",s.top=p.top+h+"px",s.width=s.height=256*e+"px"}if(this._enableCanvas2dMap){var _=u._isIE9?"translate(0px, "+t+"px) scale("+e+")":"translate3d(0px, "+t+"px, 0) scale("+e+")";this.touchZoomLabelCanvas.style[d]=_}}},setZoomFinish:function(){this._animationDiv=null},startAnimation:function(e){this.prepareLayer(),this.hideNonAnimationLayers();var t=this._map;this.touchZoomLabelCanvas&&(this.touchZoomLabelCanvas.style.display="none"),e=e||{};var i=e.zoomCount||0,n=e.fixPosition,a=(e.fixMCPosition,e.pixOffset);this._zoomCount=i;for(var o=t.getZoom(),r=o+i,s=t.config.enableContinuousZoom,h=.5,c=5,d=Math.pow(2,i),u=this._baseLayerDiv,f={x:n.x-parseInt(u.style.left,10)-t.offsetX,y:n.y-parseInt(u.style.top,10)-t.offsetY},p=this._animationDiv,m=p.children.length,g=this._preZoomTimes,_=[],v=(this._transformStyleName,this._transformOriginStyleName,m-1);v>-1;v--){var b={},y=p.children[v].style;b.top=parseInt(y.top,10),b.left=parseInt(y.left,10);var x=b.left-f.x,w=b.top-f.y;b.dx=x*d-x,b.dy=w*d-w,b.preDx=x*g-x,b.preDy=w*g-w,_[v]=b}var M,T,L,C=this;return this._zoomAni=new l({fps:60,duration:s?500:1,transition:function(e){return e=e*c/(2*h),c*e-h*e*e},render:function(s){s=4*s*h/(c*c),M=g+s*(d-g);var l=o+cR(M),u=null,f=0,m=0;if(e.onAnimationBeforeLooping){var v=e.onAnimationBeforeLooping(s,l);u=v.loopingCenter,f=v.yDiff,m=v.totalYDiff}for(var b=_.length-1;b>-1;b--){var y=_[b];if(p.children[b]){var x=p.children[b].style;T=y.preDx+(y.dx-y.preDx)*s-a.width*s,L=y.preDy+(y.dy-y.preDy)*s-a.height*s+f,x.left=y.left+T+"px",x.top=y.top+L+"px",x.height=x.width=256*M+"px"}}var w=a.width*s,P=a.height*s;t.isRestrict?C._enableCanvas2dMap&&C._canvas2dMapMgr.clearLabel():C._enableCanvas2dMap&&C._canvas2dMapMgr.drawLabel(M,n,o,r,i,s,w,P,m,f),C._preZoomTimes=M,C._preRenderTick=s,e.onAnimationLooping&&e.onAnimationLooping(s,l,u)},finish:function(){C._preZoomTimes=1,C._zoomAni=null,C._animationDiv=null,e.onAnimationFinish&&e.onAnimationFinish(),C.showNonAnimationLayers()}}),this._zoomAni},stopAnimation:function(){this._zoomAni&&(this._zoomAni.stop(),this._zoomAni=null)}}),x.extend(c.prototype,{_initVars:function(e){this._map=e._map,this._canvas2dMapMgr=e,this._labelCtx=e._labelCtx,this.ratio=this._map.config.ratio,this.sizeRatio=this.ratio>1?2:1,this.RANK1=1e6,this.RANK2=2e6,this.RANK3=3e6,this.RANK4=4e6,this.RANK5=5e6},_initColorCanvas:function(){var e=256,t=H("canvas"),i=t.style;i.width=e+"px",i.height=e+"px",t.width=e,t.height=e,this._colorCvsSize=e,this._colorCvs=t,this._colorCtx=t.getContext("2d")},getLabelImageData:function(e){var t=e.textImg,i=e.textPos,n=this.ratio,a=this.sizeRatio/n,o=this._colorCtx,r=this._colorCvsSize;o.clearRect(0,0,r,r);for(var s=0,l=0,h=0,c=0;c<i.length;c++)i[c].width>s&&(s=i[c].width,l=c,h=i[c].drawX);s/=a;for(var d=0,c=0,u=i.length;u>c;c++){var f,p=i[c];f=c===l?0:p.drawX-h,o.drawImage(t,p.srcX,p.srcY,p.width,p.height,f,d,p.width/a,p.height/a),p.width/a>s&&(s=p.width/a),d+=p.height/a+2*n}var m=o.getImageData(0,0,s,d),g=o.getImageData(0,0,s,d);return[m,g]},_bindEvent:function(e){var t=this,i=e._map;i.addEventListener("onspotmouseover",function(e){if(this.isCanvasMap()&&this.temp.isPermitSpotOver&&e.spots.length>0){var i=e.spots[0].userdata.uid,n=e.spots[0].userdata.name,a=t.findLabelByUid(i,n);a&&t._toHighLightColor(a)}}),i.addEventListener("onspotmouseout",function(e){if(this.isCanvasMap()&&this.temp.isPermitSpotOver&&e.spots.length>0){var i=e.spots[0].userdata.uid,n=e.spots[0].userdata.name,a=t.findLabelByUid(i,n);a&&t._toDefaultColor(a)}}),i.addEventListener("onspotclick",function(e){if(this.isCanvasMap()&&this.temp.isPermitSpotOver)if(e.spots&&e.spots.length>0){var i=e.spots[0].userdata.uid,n=e.spots[0].userdata.name,a=t.findLabelByUid(i,n);a&&t._changeBaseMapState(a)}else t._recoverNormalState()}),i.on("spot_status_reset",function(){t._recoverNormalState()}),i.on("spot_highlight",function(e){var i=t.findLabelByUid(e.uid);i&&t._changeBaseMapState(i)})},_getTextBound:function(e){if(!e.textPos)return null;for(var t=this.ratio,i=this.sizeRatio/t,n=e.textPos,a=e.baseDrawX,o=e.baseDrawY,r=a*t+(n[0].drawX-a)/i,s=o*t+(n[0].drawY-o)/i,l=r+n[0].width/i,h=s+n[0].height/i,c=0,d=n.length;d>c;c++){var u=n[c],f=a*t+(u.drawX-a)/i;r>f&&(r=f);var p=o*t+(u.drawY-o)/i;s>p&&(s=p),f+u.width>l&&(l=f+u.width),p+u.height>h&&(h=p+u.height)}return[r,s,l,h]},_toHighLightColor:function(e){if(!e._tempRank||e._tempRank!=this.RANK5){var t=this._getTextBound(e);if(t){var i=Math.round(t[0]),n=Math.round(t[1]),a=this.getLabelImageData(e),o=a[0],r=a[1],s=this._canvas2dMapMgr.getFilterImageData(o,this.RANK5);e._oldImgData=r,this._labelCtx.putImageData(s,i,n)}}},_toDefaultColor:function(e){if((!e._tempRank||e._tempRank!=this.RANK5)&&e._oldImgData){var t=(this.sizeRatio,this._getTextBound(e));if(!t)return;this._labelCtx.putImageData(e._oldImgData,Math.round(t[0]),Math.round(t[1])),e._oldImgData=null}},_changeBaseMapState:function(e){var t=this._canvas2dMapMgr,i=e.guid,n=e.guidExt,a={guid:i,name:e.name,guidExt:n};t._labelStrategy.setStrategyInfo(a),t._loadData()},_recoverNormalState:function(){var e=this._canvas2dMapMgr;e._labelStrategy.setStrategyInfo(null),e._loadData()},findLabelByUid:function(e,t){for(var i=this._canvas2dMapMgr,n=i._computedLabel,a=0,o=n.length;o>a;a++){var r=n[a];if(i.isClickableLabel(r)){if(e&&r.guid===e)return r;if(t&&r.name===t)return r}}return null}}),x.extend(cA.prototype,{_initVars:function(e){this._map=e._map,this._canvas2dMapMgr=e,this.ratio=this._map.config.ratio,this._strategyInfo=null,this.RANK1=1e6,this.RANK2=2e6,this.RANK3=3e6,this.RANK4=4e6,this.RANK5=5e6},setStrategyInfo:function(e){this._strategyInfo=e},preComputeLabel:function(e,t,i,n,a,o){var r=[],s=e._centerX,l=e._centerY,h=n*a,c=this.ratio,d=this._map.getZoom(),u=0;5===d&&(u=4),8===d&&(u=-6),e.sort(function(e,t){return e.x*e.y<t.x*t.y?-1:1});for(var f=0,p=e.length;p>f;f++)for(var m=e[f],g=m.x,_=m.y,v=m.z,b=cu.calcLoopParam(g,v).offsetX,y=g*h,x=(_+1)*h,w=(y-s)/n+t/2+b,M=(l-x)/n+i/2,T=0,L=m.length;L>T;T++){var C=m[T],P=void 0,A=void 0,S=void 0,I=void 0,D=C.baseDrawX=w+C.baseX,z=C.baseDrawY=M+C.baseY;if("fixed"==C.type){var k=C.iconPos,E=C.textPos,O=C.textImg;if(k&&(k.drawX=w+k.destX,k.drawY=M+k.destY,P=k.drawX,A=k.drawY,S=k.drawX+k.width,I=k.drawY+k.height),E&&O)for(var B=0;B<E.length;B++){var R=E[B];R.drawX=w+R.destX,R.drawY=M+R.destY,P?(R.drawX<P&&(P=R.drawX),R.drawY<A&&(A=R.drawY),R.drawX+R.width>S&&(S=R.drawX+R.width),R.drawY+R.height>I&&(I=R.drawY+R.height)):(P=R.drawX,A=R.drawY,S=R.drawX+R.width,I=R.drawY+R.height)}}else C.tileX=w,C.tileY=M,P=w+C.minXOriginal,A=M+C.minYOriginal,S=w+C.maxXOriginal,I=M+C.maxYOriginal;if(void 0!=P){var N=D+(P-D)/c,Z=z+(A-z)/c,H=D+(S-D)/c,W=z+(I-z)/c;C.minX=N,C.minY=Z,C.maxX=H,C.maxY=W;var X=(N+H)/2,F=(Z+W)/2,U=s+(X-t/2)*n,Y=l+(i/2-F)*n;C.geoX=U,C.geoY=Y,r.push(C)}}if(o){for(var f=0,p=o.length;p>f;f++){var G=o[f],V=G[0],j=G[1],k=V.iconPos,q=k.geoX,K=k.geoY,D=(q-s)/n+t/2,z=(l-K)/n+i/2,P=D+k.destX,A=z+k.destY,S=P+k.width,I=A+k.height;V.textPos=V.textPos||V._textPos;var E=V.textPos,$=E[0],J=D+$.destX,Q=z+$.destY;if(A>Q&&(A=Q),J+$.width>S&&(S=J+$.width),Q+$.height>I&&(I=Q+$.height),2===E.length){var et=E[1],tt=D+et.destX,it=z+et.destY;A>it&&(A=it),tt+et.width>S&&(S=tt+et.width),it+et.height>I&&(I=it+et.height)}V._tempBounds=[P,A,S,I];var k=j.iconPos,q=k.geoX,K=k.geoY,D=(q-s)/n+t/2,z=(l-K)/n+i/2,P=D+k.destX,A=z+k.destY,S=P+k.width,I=A+k.height;j.textPos=j.textPos||j._textPos;var E=j.textPos,$=E[0],J=D+$.destX,Q=z+$.destY;if(P>J&&(P=J),A>Q&&(A=Q),Q+$.height>I&&(I=Q+$.height),2===E.length){var et=E[1],tt=D+et.destX,it=z+et.destY;P>tt&&(P=tt),A>it&&(A=it),it+et.height>I&&(I=it+et.height)}j._tempBounds=[P,A,S,I]}for(var f=0,p=o.length;p>f;f++){var G=o[f],V=G[0],j=G[1];0===f&&j.textPos&&(j._textPos=j.textPos,delete j.textPos);var nt=V;!V.textPos&&j.textPos&&(nt=j);var at=nt._tempBounds;for(T=f+1;p>T;T++){var ot=o[T],rt=ot[0],st=ot[1],lt=0,ht=rt._tempBounds;at[2]<ht[0]||at[0]>ht[2]||at[3]<ht[1]||at[1]>ht[3]||(lt++,rt.textPos&&(rt._textPos=rt.textPos,delete rt.textPos));var ht=st._tempBounds;at[2]<ht[0]||at[0]>ht[2]||at[3]<ht[1]||at[1]>ht[3]||(lt++,st.textPos&&(st._textPos=st.textPos,delete st.textPos)),lt>=2&&nt.textPos&&(nt._textPos=nt.textPos,delete nt.textPos)}}for(var f=0,p=o.length;p>f;f++){var G=o[f],V=G[0],j=G[1],ct=V;!V.textPos&&j.textPos&&(ct=j);var k=ct.iconPos,q=k.geoX,K=k.geoY,D=ct.baseDrawX=(q-s)/n+t/2,z=ct.baseDrawY=(l-K)/n+i/2;k.drawX=D+k.destX,k.drawY=z+k.destY;var P=k.drawX,A=k.drawY,S=k.drawX+k.width,I=k.drawY+k.height,E=ct.textPos;if(E){var $=E[0];if($.drawX=D+$.destX,$.drawY=z+$.destY,$.drawX<P&&(P=$.drawX),$.drawY<A&&(A=$.drawY),$.drawX+$.width>S&&(S=$.drawX+$.width),$.drawY+$.height>I&&(I=$.drawY+$.height),2===E.length){var et=E[1];et.drawX=D+et.destX,et.drawY=z+et.destY,et.drawX<P&&(P=et.drawX),et.drawY<A&&(A=et.drawY),et.drawX+et.width>S&&(S=et.drawX+et.width),et.drawY+et.height>I&&(I=et.drawY+et.height)}}var N=D+(P-D)/c,Z=z+(A-z)/c,H=D+(S-D)/c,W=z+(I-z)/c;ct.minX=N,ct.minY=Z,ct.maxX=H,ct.maxY=W;var dt=(N+H)/2,ut=(Z+W)/2,ft=s+(dt-t/2)*n,pt=l+(i/2-ut)*n;ct.geoX=ft,ct.geoY=pt,r.push(ct)}}var mt=this._strategyInfo;if(mt)for(var gt=mt.guid,_t=mt.name,vt=mt.guidExt,f=0,p=r.length;p>f;f++){var bt=r[f];delete bt._tempRank,this._canvas2dMapMgr.isClickableLabel(bt)&&(1!==vt||bt.guidExt)&&(gt&&gt===bt.guid||_t&&_t===bt.name)&&(bt._tempRank=this.RANK5)}else for(var f=0,p=r.length;p>f;f++){var bt=r[f];"line"!=bt.type&&bt.iconPos&&delete bt._tempRank}r.sort(function(e,t){var i=e._tempRank?e._tempRank:e.rank,n=t._tempRank?t._tempRank:t.rank;return i===n?e.baseX-t.baseX:n-i});for(var f=0,p=r.length;p>f;f++){var nt=r[f];for(nt.isDel=!1,nt.isFadeout=!1,nt._schedule=0,nt._isIgnore=!1,nt.arrIntersectIndex=[],T=f+1;p>T;T++){var yt=r[T];nt.maxX-u<yt.minX||nt.minX>yt.maxX-u||nt.maxY-u<yt.minY||nt.minY>yt.maxY-u||nt.arrIntersectIndex.push(T)}}for(var f=0,p=r.length;p>f;f++){var bt=r[f];if(0==bt.isDel)for(var xt=bt.arrIntersectIndex,T=0,L=xt.length;L>T;T++){var wt=r[xt[T]];wt.isDel=!0,1===wt.guidExt&&(wt.isDel=!1)}}return r}}),eM.register(function(e){"canvas"===e.getRenderType()&&(window.FeatureStyle?e.canvas2dMapMgr=new P(e):eL.load(df.getMapStyleFiles(),function(){e.canvas2dMapMgr=new P(e),e.canvas2dMapMgr._loadData()}))}),x.extend(P.prototype,{_initCanvas:function(){var e=this._map,t=e.getSize(),i=t.width,n=t.height,a=e.platform,o=H("canvas"),r=o.style,s=this.ratio=e.config.ratio;this._width=i,this._height=n,r.cssText="position: absolute;left:0;top:0;width:"+i+"px;height:"+n+"px;z-index:100;",o.width=i*s,o.height=n*s,this._labelCanvas=o,this._labelCtx=o.getContext("2d"),a.appendChild(o)},_initVars:function(){var e=aa("ditu","normal");this._udt=e.udt,this._version=e.ver,this._labelDataUrls=ba.B_NORMAL_MAP.vectorTileUrls,this._style=FeatureStyle,this._labelCount=0,this._vectorDrawLib=new ap(this),this._cache={maxNum:500,delNum:50,arrCache:[]},this._computedLabel=null,this._spotData=null,this._labelStrategy=new cA(this),this._labelClick=new c(this),this._biz=new et(this),this._map.temp.isPermitSpotOver=!0,this.labelStyleParam="pl",this._map.getMapType()===BMAP_SATELLITE_MAP&&(this.labelStyleParam="sl"),this.statRequestCount=0,this.statResponseCount=0},_resizeHandler:function(){var e=this,t=e._map,i=t.getSize(),n=i.width,a=i.height,o=this.ratio,r=this._labelCanvas,s=r.style;s.width=n+"px",s.height=a+"px",r.width=n*o,r.height=a*o,e._width=n,e._height=a;var l=!0;e._loadData(l)},_bindEvent:function(){var e=this,t=e._map;t.addEventListener("load",function(){e.clearLabel(),e._loadData()}),t.addEventListener("zoomend",function(t){t.notClearLabel||e.clearLabel(),e._loadData()}),t.addEventListener("moveend",function(){e._loadData()}),t.addEventListener("resize",function(t){e._resizeHandler(t)}),t.addEventListener("maptypechange",function(t){t.mapType===BMAP_EARTH_MAP?e.hideLabelCanvas():(e.showLabelCanvas(),t.mapType===BMAP_NORMAL_MAP?e.labelStyleParam="pl":t.mapType===BMAP_SATELLITE_MAP&&(e.labelStyleParam="sl"),e._loadData())}),t.addEventListener("streetlayer_show",function(){this.isCanvasMap()&&e.showLabelCanvas()}),t.addEventListener("streetlayer_hide",function(){this.isCanvasMap()&&e.hideLabelCanvas()}),t.addEventListener("loadbizdata",function(t){var i=t.data;e._biz.proecessBizData(i,function(){e.updateLabel()})}),t.addEventListener("unloadbizdata",function(){e._biz.clearBizData(),e.updateLabel()}),e.isDrawText=!1,setTimeout(function(){e.isDrawText||t.dispatchEvent(new az("onmapwhitescreen"))},1e4)},getStyle:function(){return this._style},_getZoomUnits:function(e){return Math.pow(2,18-e)},_createCacheForm:function(e,t,i,n){var a=this,o=a._cache,r=o.arrCache,s=this._getLabelId(e,t,i,n),l={id:s,updateLabelCounter:0};return r.push(l),r[s]=l,l},_getLabelId:function(e,t,i,n){return"_"+e+"_"+t+"_"+i+"_"+n+"_"+this.labelStyleParam},_getCache:function(e,t,i,n){return this._cache.arrCache[this._getLabelId(e,t,i,n)]},_setCacheValue:function(e,t,i,n,a){var o=this,r=o._cache,s=r.arrCache,l=r.maxNum,h=r.delNum,c=this._getLabelId(e,t,i,n),d=s[c];if(a&&(d.lb=a),s.length>l){for(var u=s.splice(0,h),f=0,p=u.length;p>f;f++){var m=u[f],g=m.id;s[g].lb&&(s[g].lb=null),s[g]=null,delete s[g]}u=null}},_loadData:function(e){var t=this._map;if(t.isCanvasMap()){var i=t.getCenter(),n=cu.calcLoopCenterPoint(i),a=this._tileType,o=this._width/2,r=this._height,s=t.getZoom(),l=a.getDataZoom(s),h=t.getZoomUnits(s),c=h*o,d=n.lng-c,u=n.lng+c,f=cu.isAddWidth(d,u);o=f?1.5*o:o;var p=a.getTileSize(s),m=a.getMercatorSize(s,l),g=Math.floor(n.lng/m),_=Math.floor(n.lat/m),v=[g,_,(n.lng-g*m)/m*p,(n.lat-_*m)/m*p],b=v[0]-Math.ceil((o-v[2])/p),y=v[1]-Math.ceil((r/2-v[3])/p),x=v[0]+Math.ceil((o+v[2])/p),w=v[1]+Math.ceil((r/2+v[3])/p);t.temp.isPermitSpotOver=!1;for(var M=[],T=b;x>T;T++)for(var L=y;w>L;L++){M.push([T,L,l]);var C="id_"+T+"_"+L+"_"+s;M[C]=!0}M._zoom=l,M=cu.calcLoopTiles(M,s),M.sort(function(e){return function(t,i){return.4*Math.abs(t[0]-e[0])+.6*Math.abs(t[1]-e[1])-(.4*Math.abs(i[0]-e[0])+.6*Math.abs(i[1]-e[1]))}}([v[0],v[1]]));var P=this._cache.arrCache;this._curViewLabels=[];var A="viewKey_"+Math.floor(i.lng)+"_"+Math.floor(i.lat)+"_"+s;this.statRequestCount=0,this.statResponseCount=0,this._labelCount+=M.length;for(var S=s,T=0,I=M.length;I>T;T++){var g=M[T][0],_=M[T][1],D=M[T][2],z=this._getLabelId(g,_,D,S),k=P[z];k||(k=this._createCacheForm(g,_,D,S)),"undefined"==typeof k.lb?(k.lb=null,this._loadLabelData(g,_,D,S,p,A),this.statRequestCount++):k.lb?(this._curViewLabels.push(k.lb),this._labelCount--):(e&&this._loadLabelData(g,_,D,S,p,A),k.updateLabelCounter++)}0===this._labelCount&&this.updateLabel();var E=this;E.errorTimer&&clearTimeout(E.errorTimer),E.errorTimer=setTimeout(function(){0!==E._labelCount&&(E._labelCount=0,E.updateLabel());var e=new az("onloaddatatimeout"),t=0,i=0,n=0,a=0;E.statRequestCount===E.statResponseCount?t=1:i=1,1===i&&(a=E.statRequestCount-E.statResponseCount,n=E.statResponseCount),e.noTimeoutCount=t,e.timeoutCount=i,e.timeoutNoLoaded=a,e.timeoutLoaded=n,E._map.dispatchEvent(e)},500)}},clearLabel:function(){var e=this._width,t=this._height,i=this.ratio;this._labelCtx.clearRect(0,0,e*i,t*i)},updateLabel:function(){var e=this._map,t=e.getCenter(),i=this._width,n=this._height,a=e.getZoom(),o=this._tileType.getTileSize(a),r=this._getZoomUnits(a),s=this._labelCtx;this._labelCanvas.style.left=-e.offsetX+"px",this._labelCanvas.style.top=-e.offsetY+"px";var l=this._curViewLabels;l._centerX=t.lng,l._centerY=t.lat;var h=this._biz.bizLabels;this._computedLabel=this._labelStrategy.preComputeLabel(l,i,n,r,o,h),this._computedLabel._zoom=a,this.clearLabel(),this._vectorDrawLib.drawIconAndText(s,this._computedLabel,a),this._addSpotData(),e.temp.isPermitSpotOver=!0,l.length>0&&(this.isDrawText=!0)},_loadLabelData:function(e,t,i,n,a,o){var r=e.toString(),s=t.toString(),l="cbk_"+r.replace("-","_")+"_"+s.replace("-","__")+"_"+Math.floor(i),h="BMap."+l,c=this._labelDataUrls,d=Math.abs(e+t)%c.length,u=c[d];window.offLineIPAddress&&(u=window.offLineIPAddress+"pvd/");var f=this.labelStyleParam,p="?qt=vtile",m="x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}&textonly=1&textimg=1&scaler={scaler}&fn="+h,g=cu.calcLoopParam(e,i).col,_=this.ratio>1?2:1,v=m.replace(/{x}/,g).replace(/{y}/,t).replace(/{z}/,Math.floor(i)).replace(/{styles}/,f).replace(/{udt}/,this._udt).replace(/{v}/,this._version).replace(/{scaler}/,_),b=u+p+"&param="+window.encodeURIComponent(d8(v)),y=this,x=y._map;eM[l]=function(r){y._vectorDrawLib.parseLabelData(r,e,t,i,n,a,function(a){var r=x.getCenter(),s=x.getZoom(),h="viewKey_"+Math.floor(r.lng)+"_"+Math.floor(r.lat)+"_"+s;y._labelCount--;var c=y._getCache(e,t,i,n).updateLabelCounter;y._labelCount-=c;var d=y._curViewLabels;if((h===o||y._labelCount<0&&s===i)&&d.push(a),h===o&&y.statResponseCount++,y._labelCount<=0){var u=(new Date).getTime();y.updateLabel();var f=(new Date).getTime(),p=new az("oncanvasmaploaded");p.drawTime=f-u,y.statResponseCount===y.statRequestCount&&(p.isAllLoadedDrawing=!0),x.dispatchEvent(p)}y._setCacheValue(e,t,i,n,a),delete eM[l]})},eL.load(b)},drawLabel:function(e,t,i,n,a,o,r,s,l,h){var c=this;if(c._computedLabel){if(c._computedLabel._zoom!==i)return void c.clearLabel();c._map.temp.isPermitSpotOver=!1,c.clearLabel(),c._vectorDrawLib.zoomingIconAndText(this._labelCtx,c._computedLabel,e,t,n,a,o,r,s,l,h)}},_addSpotData:function(){this._spotData=[];for(var e=this._map.getZoom(),t=0,i=this._computedLabel.length;i>t;t++){var n=this._computedLabel[t];if(this.isClickableLabel(n)&&!(1===n.guidExt&&n.startScale>e)){var a=[];a[0]=(n.minX-n.maxX)/2,a[1]=(n.minY-n.maxY)/2,a[2]=(n.maxX-n.minX)/2,a[3]=(n.maxY-n.minY)/2;var o=null;n.iconPos&&(o=new eR(n.iconPos.geoX,n.iconPos.geoY));var r=n.name?n.name.replace("\\\\","<br>"):"";n.iconPos&&n.iconPos.iconType.indexOf("ditie")>-1&&this._map.getZoom()>14&&(r="");var s={n:r,pt:new eR(n.geoX,n.geoY),userdata:{iconPoint:o,uid:n.guid,name:r,type:n.iconPos?n.iconPos.iconType:"",iconImg:n.iconImg,adver_log:n.adver_log||""},bd:a,tag:"MAP_SPOT_INFO"};this._spotData.push(s)}}var l=new az("onspotsdataready");l.spots=this._spotData,this._map._spotDataOnCanvas=this._spotData,this._map.dispatchEvent(l)},isClickableLabel:function(e){return e.isDel||!e.guid&&!e.name?!1:!0},getFilterImageData:function(e,t){for(var i=e.data,n=this._labelStrategy,t=parseInt(t),a=0,o=i.length;o>a;a+=4){var r=i[a],s=i[a+1],l=i[a+2],h=i[a+3];if(0!==h){var c=Math.round((r+s+l)/3),d=c-90;d=0>d?0:d,t===n.RANK5&&(i[a]=51+1.3*d,i[a+1]=133+.8*d,i[a+2]=255)}}return e},showLabelCanvas:function(){this._labelCanvas.style.visibility=""},hideLabelCanvas:function(){this._labelCanvas.style.visibility="hidden"}});var bc=5,cq=4,eP=3,dn=2,e2=1,cs=0,e4=3,eG=5,B={3:{start:3,base:3},4:{start:4,base:5},5:{start:4,base:5},6:{start:6,base:7},7:{start:6,base:7},8:{start:8,base:9},9:{start:8,base:9},10:{start:10,base:10},11:{start:11,base:12},12:{start:11,base:12},13:{start:11,base:12},14:{start:14,base:15},15:{start:14,base:15},16:{start:16,base:17},17:{start:16,base:17},18:{start:18,base:19},19:{start:18,base:19},20:{start:18,base:19},21:{start:18,base:19}};x.extend(ap.prototype,{_initColorCanvas:function(){var e=256,t=H("canvas"),i=t.style;i.width=e+"px",i.height=e+"px",t.width=e,t.height=e,this._colorCvs=t,this._colorCtx=t.getContext("2d")},parseLabelData:function(e,t,i,n,a,o,r){if(this._featureStyle||(this._featureStyle=this._canvas2dMapMgr.getStyle()),!e||!e[0])return void r([]);var s=this._map.getZoomUnits();this.loadTextPng(e,o,t,i,n,a,s,r)},loadTextPng:function(e,t,i,n,a,o,r,s){var l=this,h=e[5],c=this._map,d=(c.getZoom(),c.getSize()),u=(d.width,d.height,c.getCenter()),f=(u.lng,u.lat,i*t*r),p=(n+1)*t*r;if(h){var m=new Image;m.onload=function(){l.calcIconAndTextInfo(e,m,t,i,n,a,o,r,f,p,s),delete this.onload
},m.src=h}else setTimeout(function(){l.calcIconAndTextInfo(e,null,t,i,n,a,o,r,f,p,s)},1)},calcIconAndTextInfo:function(e,t,i,n,a,o,r,s,l,h,c){var d=this,u=(d._featureStyle,[]);u.x=n,u.y=a,u.z=o;var f=(d._canvas2dMapMgr,[]);if(e[0])for(var p=0;p<e[0].length;p++)e[0][p][0]===e4&&f.push(e[0][p]);for(var m=e[2]||[],p=0;p<f.length;p++)this._getFixedLabelInfo(f[p],t,r,s,i,l,h,u);var g=Math.pow(2,r-o);for(p=0;p<m.length;p++)this._getLineLabelInfo(m[p],t,o,r,s,i,l,h,g,u);c(u)},_getFixedLabelInfo:function(e,t,i,n,a,o,r,s){var l=e[1],h=this._map.getZoom(),c=this._featureStyle,d=i;9===d&&(d=8);for(var u=0;u<l.length;u++){var f=l[u],p=f[0],m=cH.getStyleFromCache(p,"point",d,c),g=cH.getStyleFromCache(p,"pointText",d,c);if(!(g&&0!==g.length||m&&0!==m.length)){if(5!==d)continue;var _=f[1];if(!_)continue;for(var v=0;v<_.length;v++){var b=_[v][4];if(b&&"北京"===b[7]){m=cH.getStyleFromCache(p,"point",6,c),g=cH.getStyleFromCache(p,"pointText",6,c);break}}}var _=f[1],y=null,x=1,w=0,M=0;m&&m[0]?(m=m[0],y=m.icon,x=m.zoom?m.zoom/100:1):m=null;for(var v=0;v<_.length;v++){var b=_[v][4];if(b){var T=b[2];if(this._isVisible(T,h)){var L=b[12];if(!(g&&g.length>0)||L){var C=Math.round(b[0]/100),P=Math.round(b[1]/100),A={lng:o+C,lat:r-(a*n-P)},S=C/n,I=a-P/n,D=b[7]||"",z=b[5],k={type:"fixed",name:D,textImg:t,rank:b[4],baseX:S,baseY:I,iconPos:null,textPos:null,guid:b[3]||"",tracer:T,direction:z,startScale:3};(z!==cq&&L||!L)&&null!==y&&(k.iconPos=this._getIconPosition(y,x,S,I,A),k.iconPos&&(w=k.iconPos.width,M=k.iconPos.height)),0===w&&(k.direction=cq),L&&(k.textPos=this._getTextDrawData(b,S,I,w,M)),(k.textPos||k.iconPos)&&s.push(k)}}}}}},_isVisible:function(e,t){var i;this._binaryCache[e]||(i=e.toString(2),i.length<8&&(i=new Array(8-i.length+1).join("0")+i),this._binaryCache[e]=i),i=this._binaryCache[e];var n=B[t].start;return"1"===i[t-n]},_getIconPosition:function(e,t,i,n,a){var o=window.iconSetInfo_high[e];if(o||e.charCodeAt(0)>=48&&e.charCodeAt(0)<=57&&(o=window.iconSetInfo_high["_"+e]),!o)return null;var r=o[0],s=o[1];return r*=t,s*=t,{srcX:0,srcY:0,destX:i-r/2,destY:n-s/2,width:r,height:s,geoX:a.lng,geoY:a.lat,mcPt:a,iconType:e}},_getTextDrawData:function(e,t,i,n,a){var o=e[5];"number"!=typeof o&&(o=0);var r=this.ratio,s=r/2;n*=s,a*=s;for(var l=e[12],h=l.length,c=0,d=0,u=[],f=0,p=0,m=0;h>m;m++)p+=Math.round(l[m][3]);for(var m=0;h>m;m++){var g=l[m],_=g[0],v=g[1],b=g[2],y=g[3],x=2*r,w=0;switch(0!==n&&(w=2*r),0===n&&(o=cq),o){case eP:var M=i-p/2-x*(h-1)/2;c=t-b-n/2-w,d=M+f+x*m;break;case e2:var M=i-p/2-x*(h-1)/2;c=t+n/2+w,d=M+f+x*m;break;case dn:var M=i-a/2-p-x*(h-1)-x;c=t-b/2,d=M+f+x*m;break;case cs:var M=i+a/2+x/2;c=t-b/2,d=M+f+x*m;break;case cq:var M=i-y/2-x*(h-1)/2;c=t-b/2,d=M+f+x*m}f+=y,b>0&&y>0&&u.push({srcX:_,srcY:v,destX:c,destY:d,width:b,height:y})}return u.length>0?u:null},_getLineLabelInfo:function(e,t,i,n,a,o,r,s,l,h){if(10===e.length){for(var c=(this.ratio,this.ratio),d=e[7].length,u=e[1],f=e[3],p=e[8],m=e[4],g=2,_=m.slice(0,g),v=g;v<m.length;v+=g)_[v]=_[v-g]+m[v],_[v+1]=_[v-(g-1)]+m[v+1];for(var v=g;v<m.length;v+=g)v%(f*g)!==0&&v%(f*g)!==1&&(_[v]=_[v-g]+m[v]/l,_[v+1]=_[v-(g-1)]+m[v+1]/l);for(var b=0;d>b;b++){var y=e[7][b];if(this._isVisible(y,n)){var x=e[6][b],w=b*f*g;m=_.slice(w,w+f*g);var M=[],T=void 0,L=void 0,C=void 0,P=void 0,p=e[9].slice(0);x&&p.reverse();for(var A,S,I=0;f>I;I++){var D,z,k=e[5][f*b+I],E=m[I*g]/100,O=m[I*g+1]/100,B=p[I],R=B[0],N=B[1],Z=B[2],H=B[3];0===I?(A=D=E/a,S=o-O/a,z=O/a):(D=E/a,z=O/a);var W=A+(D-A)*c-Z/2,X=S+(o-z-S)*c-H/2;void 0===T?(T=A-Z/2,L=S-H/2,C=T+Z,P=L+H):(T>W&&(T=W),L>X&&(L=X),W+Z>C&&(C=W+Z),X+H>P&&(P=X+H)),M.push({angle:k,srcX:R,srcY:N,destX:W,destY:X,width:Z,height:H})}var F={type:"line",textImg:t,rank:u,baseX:A,baseY:S,arrWordPos:M,minXOriginal:T,minYOriginal:L,maxXOriginal:C,maxYOriginal:P,text:""};h.push(F)}}}},alterColor:function(e,t,i){var n=this._colorCtx,a=this._canvas2dMapMgr;n.clearRect(0,0,e.width,e.height),n.drawImage(t,e.srcX,e.srcY,e.width,e.height,0,0,e.width,e.height);var o=n.getImageData(0,0,e.width,e.height),r=a.getFilterImageData(o,i);n.putImageData(r,0,0)},drawIconAndText:function(e,t,i){for(var n=this.ratio,a=this.sizeRatio/n,o=2/n,r=this,s=0,l=t.length;l>s;s++){var h=t[s];if(0==h.isDel){var c=h.baseDrawX,d=h.baseDrawY;if("fixed"==h.type){var u=h.iconPos,f=h.textPos,p=h.textImg,m=h.startScale;if(u&&i>=m){var g=this._iconCache[u.iconType];if(g)g.img?e.drawImage(g.img,0,0,g.img.width,g.img.height,Math.round(c*n+(u.drawX-c)/o),Math.round(d*n+(u.drawY-d)/o),u.width/o,u.height/o):g.drawLabels.push(h);else if(!g){this._iconCache[u.iconType]={img:null,drawLabels:[h]};var _=new Image;_._iconName=u.iconType,_.onload=function(){var t=r._iconCache[this._iconName];t.img=this,this.onload=null;for(var i=0;i<t.drawLabels.length;i++){var a=t.drawLabels[i],s=a.baseDrawX,l=a.baseDrawY,h=a.iconPos;e.drawImage(this,0,0,this.width,this.height,Math.round(s*n+(h.drawX-s)/o),Math.round(l*n+(h.drawY-l)/o),h.width/o,h.height/o)}t.drawPos=[]},_.src=df.iconSetPath+u.iconType+".png"}}if(f&&p&&i>=m)for(var v=0;v<f.length;v++){var b=f[v];h._tempRank?(this.alterColor(b,p,h._tempRank),e.drawImage(this._colorCvs,0,0,b.width,b.height,Math.round(c*n+(b.drawX-c)/a),Math.round(d*n+(b.drawY-d)/a),b.width/a,b.height/a)):e.drawImage(p,b.srcX,b.srcY,b.width,b.height,Math.round(c*n+(b.drawX-c)/a),Math.round(d*n+(b.drawY-d)/a),b.width/a,b.height/a)}}else for(var y=h.arrWordPos,p=h.textImg,x=h.tileX,w=h.tileY,M=0,T=y.length;T>M;M++){var L=y[M],C=Math.round(x+L.destX),P=Math.round(w+L.destY),A=L.angle;if(C=c*n+C-c,P=d*n+P-d,A>10&&350>A){e.save();var S=Math.round(C+L.width/2),I=Math.round(P+L.height/2);e.translate(S,I),e.rotate(-A/180*Math.PI),e.drawImage(p,L.srcX,L.srcY,L.width,L.height,-Math.round(L.width/2),-Math.round(L.height/2),L.width/a,L.height/a),e.restore()}else e.drawImage(p,L.srcX,L.srcY,L.width,L.height,C,P,L.width/a,L.height/a)}}}},isCollide:function(e,t,i,n,a,o,r){for(var s=0,l=o.length;l>s;s++){var h=o[s],c=1/Math.pow(2,r+1),d=c*h[3]/2,u=c*h[4]/2,f=h[0];if(f!=e&&!(t+n<h[1]-d||t>h[1]+h[3]+d||i+a<h[2]-u||i>h[2]+h[4]+u))return!0}return!1},zoomingIconAndText:function(e,t,i,n,a,o,r,s,l,h,c){var d=this.ratio,u=this.sizeRatio/d,f=2/d,p=n.x,m=n.y,g=2*d;0!==c&&(m+=h);var _=void 0,v=void 0,b=void 0,y=void 0,x=void 0,w=o>0?!0:!1;if(!w){_=[];var M=1-r}for(var T=0,L=t.length;L>T;T++){var C=t[T];if(0==C.isDel){var P=C.baseDrawX,A=C.baseDrawY;if(e.save(),e.translate(-s*d,-l*d),C.isFadeout){if(w||!(C._schedule<=r)||C._isIgnore){C._isIgnore=!0;continue}e.globalAlpha=M,C._schedule=r}if("fixed"==C.type){var S,I=C.iconPos,D=C.textPos,z=C.textImg,k=C.startScale,E=0;if(I&&(E=g),I&&!C.iconImg&&this._iconCache[I.iconType]&&(S=this._iconCache[I.iconType].img),I&&a>=k&&S&&(y=I.width,x=I.height,v=(p+(P-p)*i)*d-y/2/f,b=(m+(A-m)*i)*d-x/2/f+c,!w&&this.isCollide(T,v,b,y,x,_,o)&&(C.isFadeout=!0),e.drawImage(S,I.srcX,I.srcY,S.width,S.height,Math.round(v),Math.round(b),y/f,x/f),!w&&_.push([T,v,b,y,x])),D&&z&&a>=k){var O,B,R=0,N=0;I&&(R=I.width,N=I.height);for(var Z=D.length,H=0,W=0,X=0;Z>X;X++){var F=D[X];W+=F.height,H<F.width&&(H=F.width)}W+=(X-1)*g,!w&&this.isCollide(T,v,b,H,W,_,o)&&(C.isFadeout=!0);for(var U=0,X=0;Z>X;X++){var F=D[X];switch(C.direction){case eP:O=-(R/2/f+F.width+E),B=-W/2+U+g*X;break;case e2:O=R/2/f+E,B=-W/2+U+g*X;break;case dn:O=-F.width/2,B=-N/2/f-W+U-g*(X+1);break;case cs:O=-F.width/2,B=N/2/f+U+g*(X+1);break;case cq:O=-F.width/2,B=-W/2+U+g*X}U+=F.height,v=(p+(P-p)*i)*d+O/u,b=(m+(A-m)*i)*d+B/u,y=F.width,x=F.height,C._tempRank?(this.alterColor(F,z,C._tempRank),e.drawImage(this._colorCvs,0,0,y,x,Math.round(v),Math.round(b),y/u,x/u)):e.drawImage(z,F.srcX,F.srcY,y,x,Math.round(v),Math.round(b),y/u,x/u),!w&&_.push([T,v,b,y,x])}}}else for(var Y=C.arrWordPos,z=C.textImg,G=C.tileX,V=C.tileY,j=Y[0],q=Math.round(G+j.destX),K=Math.round(V+j.destY),$=0,J=Y.length;J>$;$++){var Q=Y[$],et=Math.round(G+Q.destX),tt=Math.round(V+Q.destY),it=Q.angle,nt=Math.round((p+(P-p)*i)*d-j.width/2+et-q),at=Math.round((m+(A-m)*i)*d-j.height/2+tt-K);if(v=nt,b=at,y=Q.width,x=Q.height,!w&&this.isCollide(T,v,b,y,x,_,o)&&(C.isFadeout=!0),it>10&&350>it){var ot=nt+Q.width/2,rt=at+Q.height/2,st=it/180*Math.PI,lt=Math.cos(st),ht=Math.sin(st),ct=lt,dt=lt,ut=ht,ft=-ht,pt=ot-ot*lt-rt*ht,mt=rt+ot*ht-rt*lt;e.save(),e.transform(ct,ft,ut,dt,pt,mt),e.drawImage(z,Q.srcX,Q.srcY,y,x,v,b,y/u,x/u),e.restore()}else e.drawImage(z,Q.srcX,Q.srcY,y,x,v,b,y/u,x/u);!w&&_.push([T,v,b,y,x])}e.restore()}}}}),x.extend(et.prototype,{initVars:function(e){this._map=e._map,this._canvas2dMapMgr=e,this.base64Prefix="data:image/png;base64,",this.bizData=null,this.objTextsPng=null,this.arrIconsPng=null,this.bizLabels=null},proecessBizData:function(e,t){var i=this;this.bizData=e,this.objTextsPng=null,this.arrIconsPng=null;var n=e.textsPng,a=e.iconsPng;if(n&&a){var o=new Image;o.onload=function(){i.objTextsPng=this,i.calcIconAndTextInfo(t),this.onload=null},o.src=this.base64Prefix+n;for(var r=a.length,s=[],l=0;r>l;l++){var h=a[l],c=new Image;!function(e){c.onload=function(){r--,s[e]=this,0===r&&(i.arrIconsPng=s,i.calcIconAndTextInfo(t)),this.onload=null}}(l),c.src=this.base64Prefix+h}}},calcIconAndTextInfo:function(e){if(this.objTextsPng&&this.arrIconsPng){for(var t=this.bizData,i=t.pois,n=[],a=0,o=i.length;o>a;a++){var r=i[a],s=this.arrIconsPng[r.iconPng],l=s.height/2,h={type:"fixed",name:"",textImg:this.objTextsPng,iconImg:s,rank:r.rank,iconPos:{srcX:0,srcY:0,destX:-s.width/2,destY:-l/2,width:s.width,height:l,geoX:r.x,geoY:r.y,iconType:"vectorCustom"},textPos:this.calcTextPos(r.pos,s),startScale:r.from<12?12:r.from,guid:r.guid,guidExt:1,adver_log:r.adver_log||""},c={type:"fixed",textDirLeft:"left",name:"",textImg:this.objTextsPng,iconImg:s,rank:r.rank,iconPos:{srcX:0,srcY:0,destX:-s.width/2,destY:-l/2,width:s.width,height:l,geoX:r.x,geoY:r.y,iconType:"vectorCustom"},textPos:this.calcTextPosLeft(r.pos,s),startScale:r.from<12?12:r.from,guid:r.guid,guidExt:1,adver_log:r.adver_log||""},d=[h,c];n.push(d)}this.bizLabels=n,e&&e()}},calcTextPos:function(e,t){var i=[],n=e.length/4,a=t.width/2;if(1===n){var o={srcX:e[0],srcY:e[1],destX:a,destY:-e[3]/2,width:e[2],height:e[3]};i.push(o)}else{var o={srcX:e[0],srcY:e[1],destX:a,destY:-e[3],width:e[2],height:e[3]},r={srcX:e[4],srcY:e[5],destX:a,destY:0,width:e[6],height:e[7]};i.push(o),i.push(r)}return i},calcTextPosLeft:function(e,t){var i=[],n=e.length/4,a=t.width/2;if(1===n){var o={srcX:e[0],srcY:e[1],destX:-a-e[2],destY:-e[3]/2,width:e[2],height:e[3]};i.push(o)}else{var o={srcX:e[0],srcY:e[1],destX:-a-e[2],destY:-e[3],width:e[2],height:e[3]},r={srcX:e[4],srcY:e[5],destX:-a-e[2],destY:0,width:e[6],height:e[7]};i.push(o),i.push(r)}return i},clearBizData:function(){this.bizData=null,this.bizLabels=null}}),x.extend(bM.prototype,{centerAndZoom:function(e,t,i){function n(){o._earth=new eM.Earth(o,{showRealSunlight:o.config.showRealSunlight,showMilkyway:o.config.showMilkyway,earthBackground:o.config.earthBackground}),o._proxyEarthEvents(),o._changeEarthMapType(BMAP_EARTH_MAP),x.extend(o,eM.EarthView.prototype),delete o.temp.originMapType}if(i=i||{},this.loaded||(this.firstTileLoad=!1),t=this._getProperZoom(t).zoom,i.noAnimation!==!0&&this.loaded){var a=this._ifUseAnimation(e,t);if(a)return void this.flyTo(e,t,i)}var o=this;if(e||t){e&&!e.equals(this.centerPoint)&&this.fire(new az("oncenter_changed")),t&&t!==this.zoomLevel&&this.fire(new az("onzoom_changed")),e=e||this.centerPoint,t=t||this.zoomLevel,t=this._getProperZoom(t).zoom,this.mapType===BMAP_EARTH_MAP&&(this._earth||(this.mapType=BMAP_NORMAL_MAP,this.temp.originMapType=BMAP_EARTH_MAP,cz.load("earth",function(){window.FeatureStyle?n():eL.load(df.getMapStyleFiles(),function(){n()})}))),this.lastLevel=this.zoomLevel||t,this.zoomLevel=t;var r=new az("onload");if(r.point=e,r.zoom=t,this.centerPoint=new eR(e.lng,e.lat),this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel,this.defaultCenter=this.defaultCenter||this.centerPoint,this.mapType!==BMAP_EARTH_MAP&&(this.centerPoint=this.restrictCenter(this.centerPoint)),!this.loaded&&this.temp.originMapType!==BMAP_EARTH_MAP){var s=this.config.defaultMaxBounds,l=new bL(s,"baidu",this.mapType),h=new bA({mapType:this.mapType,copyright:l,dataType:ef,customLayer:!1,baseLayer:!0,tileTypeName:"na"});h._isInnerLayer=!0,this.addTileLayer(h),this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===!0&&this._addHybirdMap(),this.baseLayerAdded=!0,this.on("zoom_changed",function(){if(0!==this._heading&&this.getZoom()<7){for(var e=this._heading;0>e;)e+=360;e%=360,0!==e&&o.setHeading(0,{unstopable:!0})}})}this.dispatchEvent(r),this.loaded=!0,i.callback&&i.callback()}},_ifUseAnimation:function(e,t){var i=this.getSize(),n={zoom:this.zoomLevel},a={zoom:t},o=this.pointToPixel(this.centerPoint),r=this.pointToPixel(e,n),s=this.pointToPixel(this.centerPoint,a),l=this.pointToPixel(e,a),h=Math.abs(o.x-r.x),c=Math.abs(o.y-r.y),d=Math.abs(s.x-l.x),u=Math.abs(s.y-l.y);return(h>i.width||c>i.height)&&(d>i.width||u>i.height)?!1:!0},_setPlatformPosition:function(e,t,i){if(i=i||{},0!==e||0!==t||i.point){isNaN(i.initMapOffsetX)&&(i.initMapOffsetX=this.offsetX),isNaN(i.initMapOffsetY)&&(i.initMapOffsetY=this.offsetY);var n=ch(this._heading);this._tilt>0&&(t/=Math.cos(ch(this._tilt)));var a=e*Math.cos(n)+t*Math.sin(n),o=-e*Math.sin(n)+t*Math.cos(n);if(a+=i.initMapOffsetX,o+=i.initMapOffsetY,i.point){var r=this.restrictCenter(i.point);r.equals(this.centerPoint)||(this.centerPoint=r.clone(),this.fire(new az("oncenter_changed")))}else{var s=this.offsetX-a,l=this.offsetY-o,h=this.centerPoint.lng,c=this.centerPoint.lat,d=new eR(h,c),u=this.getZoomUnits();this.centerPoint=this.restrictCenter(new eR(d.lng+s*u,d.lat-l*u),u),this.fire(new az("oncenter_changed"))}this.offsetX=a,this.offsetY=o,this.dispatchEvent(new az("onmoving"))}},restrictCenter:function(e,t){t=t||this.getZoomUnits();var i=this.pixelToPoint(new cG(0,0),{center:e}),n=this.pixelToPoint(new cG(0,this.height),{center:e});if(this.zoomLevel<5&&i.lat>bN.MAX_LAT&&n.lat<bN.MIN_LAT){var a,o=bN.MAX_LAT-e.lat,r=e.lat-bN.MIN_LAT;a=r>o?o/(this.height/2):r/(this.height/2);var s=18-cR(a);return this.zoomLevel=s,e}return i.lat>bN.MAX_LAT?e.lat=bN.MAX_LAT-this.height/2*t:n.lat<bN.MIN_LAT&&(e.lat=bN.MIN_LAT+this.height/2*t),e},zoomTo:function(e,t,i){var n=ba[this.mapType];if(n){var a=this._getProperZoom(e);if(e=a.zoom,this.zoomLevel!==e){this.lastLevel=this.zoomLevel,i=i||{},i.fireEvent!==!1&&this.dispatchEvent(new az("onzoomstart")),!t&&this.getInfoWindow()&&this.temp.infoWin&&this.temp.infoWin.isOpen()&&(t=this.getInfoWindow().getPoint());var o;t&&(o=this.pointToPixel(t));var r=this.pixelToPoint(o),s=this.centerPoint.clone();if(this.fixPoint=t,this.fixPixel=o,this.fixCenter=s,this.mousePosMCPoint=r,i.noAnimation){e=a.zoom,this.zoomLevel=e,this.fire(new az("onzoom_changed"));var l=this.getCurrentMaxTilt();if(this._tilt>l&&(this._tilt=l),t){if(this._heading%360!==0||this._tilt>0){var h=this._webglMapCamera.fromScreenPixelToMC(o.x,o.y,{center:s,zoom:this.zoomLevel});if(h){var c=h.sub(r),d=s.sub(c);this.centerPoint=this.restrictCenter(d)}}else{var u=this.getZoomUnits(),d=new eR(t.lng-u*(o.x-this.width/2),t.lat+u*(o.y-this.height/2));this.centerPoint=this.restrictCenter(d,u)}this.fire(new az("oncenter_changed"))}return void(i.fireEvent!==!1&&this.dispatchEvent(new az("onzoomend")))}this._animationInfo.zoom={current:this.zoomLevel,diff:e-this.zoomLevel,target:e};var f=this;i.fireEvent!==!1&&(i.callback=function(){f.dispatchEvent(new az("onzoomend"))});var p=this._tilt;return(this.fixPoint||p>bN.MAX_DRAG_TILT_L2)&&(i.renderCallback=function(){var e=f.getCurrentMaxTilt();f._tilt>e&&(f._tilt=e);f.fixPixel;if(f.fixPixel&&f.fixPoint){var t=f.fixPixel,i=f.fixPoint,n=f.fixCenter,a=f.mousePosMCPoint;if(f._heading%360!==0||f._tilt>0){var o=f._webglMapCamera.fromScreenPixelToMC(t.x,t.y,{center:n,zoom:f.zoomLevel,tilt:f._tilt});if(o){var r=o.sub(a),s=n.sub(r);f.centerPoint=f.restrictCenter(s)}}else{var l=t,h=f.getZoomUnits(),s=new eR(i.lng-h*(l.x-f.width/2),i.lat+h*(l.y-f.height/2));f.centerPoint=f.restrictCenter(s,h)}f.fire(new az("oncenter_changed"))}}),i.fromMouseWheel===!0?void this._startInfiniteZoomAnimation(i):void this._startAnimation(i)}}},deepZoomMedia:function(e){var t=this;t.temp.isStdCtrlBusy||(t.temp.isStdCtrlBusy=!0,t.deepZoomTo(t.zoomLevel+e),setTimeout(function(){t.temp.isStdCtrlBusy=!1},400))},deepZoomTo:function(e){this.zoomTo(e)},flyTo:function(e,t,i){function n(e){var t=(M*M-w*w+(e?-1:1)*L*L*T*T)/(2*(e?M:w)*L*T);return Math.log(Math.sqrt(t*t+1)-t)}function a(e){return(Math.exp(e)-Math.exp(-e))/2}function o(e){return(Math.exp(e)+Math.exp(-e))/2}function r(e){return a(e)/o(e)}if(i=i||{},!this.centerPoint.equals(e)||this.zoomLevel!==t||"number"==typeof i.heading||"number"==typeof i.tilt){var s=this.getHeading()%360,l=this.getTilt(),h=0,c=0,d=this.getBounds().containsPoint(e);"number"==typeof i.heading?h=i.heading:d&&(h=s),"number"==typeof i.tilt?c=i.tilt:d&&(c=l),this._heading=s;var u=h-s,f=c-l,p=this,m=this.zoomLevel,g=1.42,_=this.zoomScale(t-m),v=this.getZoomUnits(),b=this.centerPoint.div(v),y=e.div(v),x=(this.worldSize(),g),w=Math.max(this.width,this.height),M=w/_,T=y.sub(b).mag(),L=x*x,C=n(0),P=function(e){return o(C)/o(C+x*e)},A=function(e){return w*((o(C)*r(C+x*e)-a(C))/L)/T},S=(n(1)-C)/x;if(Math.abs(T)<1e-6||1/0===S||isNaN(S)){if(Math.abs(w-M)<1e-6)return this._animationInfo.zoom={current:this.zoomLevel,diff:t-this.zoomLevel},this._animationInfo.center={current:this.centerPoint,diff:e.sub(this.centerPoint)},this._animationInfo.heading={current:s,diff:h-s},this._animationInfo.tilt={current:l,diff:c-l},this.setLock(!0),void this._startAnimation({callback:function(e){p.setLock(!1),i.callback&&i.callback(e)},duration:i.duration});var I=w>M?-1:1;S=Math.abs(Math.log(M/w))/x,A=function(){return 0},P=function(e){return Math.exp(I*x*e)}}var D=1.7;.3>S?D=.8:S>5&&(D=(S-5)/2+D);var z=i.duration||1e3*S/D;if(isNaN(z)){var k={};for(var E in i)k[E]=i[E],k.noAnimation=!0;return void this.centerAndZoom(e,t,k)}this.fire(new az("onmovestart")),this.fire(new az("onzoomstart")),this.setLock(!0),this._startAnimation({duration:z,renderCallback:function(e){var t=e*S,i=A(t),n=m+p.scaleZoom(1/P(t));if(n<p.getMinZoom()&&(n=p.getMinZoom()),n>p.getMaxZoom()&&(n=p.getMaxZoom()),n!==p.zoomLevel&&(p.zoomLevel=n,p.fire(new az("onzoom_changed"))),p.centerPoint=b.add(y.sub(b).mult(i)).mult(v),p.fire(new az("oncenter_changed")),"number"==typeof h){var a=e/.7;a>1&&(a=1),p.setHeading(s+u*e,{noAnimation:!0})}"number"==typeof c&&p.setTilt(l+f*e,{noAnimation:!0})},callback:function(e,n){return p.setLock(!1),n&&n.stop===!0?(p.fire(new az("onmoveend")),p.fire(new az("onzoomend")),void(i.callback&&i.callback(e))):(t!==p.zoomLevel&&(p.zoomLevel=t,p.fire(new az("onzoom_changed"))),p.fire(new az("onmoveend")),p.fire(new az("onzoomend")),void(i.callback&&i.callback(e)))}})}},zoomScale:function(e){return Math.pow(2,e)},scaleZoom:function(e){return Math.log(e)/Math.LN2},panTo:function(e,t){if(t=t||{},!e||e.equals(this.centerPoint))return void(t.callback&&t.callback());var i=this.pointToPixel(e),n=Math.round(this.width/2),a=Math.round(this.height/2),o=this._ifUseAnimation(e,this.zoomLevel);return t.noAnimation===!0||o===!1?(this._panTo(n-i.x,a-i.y,e),void(t.callback&&t.callback())):void this.flyTo(e,this.zoomLevel,t)},_panTo:function(e,t,i){var n=this.temp;n.operating!==!0&&(n.dragAni&&(n.dragAni.stop(!1,{readyToMove:!0}),n.dragAni=null),this.dispatchEvent(new az("onmovestart")),this._setPlatformPosition(e,t,{point:i}),this.dispatchEvent(new az("onmoveend")))},panBy:function(e,t,i){e=Math.round(e)||0,t=Math.round(t)||0,i=i||{},Math.abs(e)<=this.width&&Math.abs(t)<=this.height&&i.noAnimation!==!0?this._panBy(e,t,i):(this._panTo(e,t,i.point),i.callback&&i.callback())},_panBy:function(e,t,i){if(this.temp.operating!==!0){i=i||{},this.dispatchEvent(new az("onmovestart"));var n=this,a=n.temp;a.pl=n.offsetX,a.pt=n.offsetY,a.tlPan&&a.tlPan.cancel(),a.dragAni&&(a.dragAni.stop(!1,{readyToMove:!0}),a.dragAni=null),a.tlPan=new l({fps:i.fps||n.config.fps,duration:i.duration||n.config.actionDuration,transition:i.transition||bl.easeInOutQuad,render:function(i){this.terminative=n.temp.operating,n.temp.operating||n._setPlatformPosition(e*i,t*i,{initMapOffsetX:a.pl,initMapOffsetY:a.pt})},finish:function(){n.dispatchEvent(new az("onmoveend")),n.temp.tlPan=!1,n.temp.stopArrow===!0&&(n.temp.stopArrow=!1,0!==n.temp.arrow&&n._arrow())}})}},_startAnimation:function(e){var t=this._animationInfo,i=this;e=e||{},i._ani&&i._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation}),i._infiniteAni&&(i._infiniteAni.stop(),i._infiniteAni=null);var n=e.duration||500,a=e.transition||bl.ease,o=new az("onanimation_start");this.fire(o),e.unstopable&&(t=this._animationInfoUnstopable);var r=new l({duration:n,transition:a,render:function(n,a){for(var o in t)if(t.hasOwnProperty(o)){var r=t[o].current,s=t[o].diff;i._setValueTick(o,r,s,n)}e.renderCallback&&e.renderCallback(n,a)},finish:function(t){i.fire(new az("onanimation_end")),e.unstopable?(i._animationInfoUnstopable={},i._unstopableAni=null):(i._ani=null,i._animationInfo={}),e.mapNeedCbk&&e.mapNeedCbk(),e.callback&&e.callback(t)},onStop:function(t){t=t||{},i.fire(new az("onanimation_end")),t.stopCurrentAnimation&&(i._animationInfo={}),i._ani=null,e.mapNeedCbk&&e.mapNeedCbk(),e.callback&&e.callback(null,{stop:!0})}});e.unstopable?i._unstopableAni=r:i._ani=r},_startInfiniteZoomAnimation:function(e){var t=this;t._ani&&t._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation}),t._infiniteAni||(this.fire(new az("onanimation_start")),t._infiniteAni=new l({duration:1e4,transition:bl.linear,render:function(){var i=t._animationInfo.zoom;return Math.abs(i.current-i.target)<.001?(t._setValue("zoom",i.target),void t._infiniteAni.stop()):(i.current+=.35*(i.target-i.current),t._setValue("zoom",i.current),void(e.renderCallback&&e.renderCallback()))},finish:function(){t._infiniteAni=null,t._animationInfo={},t.fire(new az("onanimation_end")),e.callback&&e.callback()},onStop:function(){t._infiniteAni=null,t._animationInfo={},t.fire(new az("onanimation_end")),e.callback&&e.callback()}}))},_setValue:function(e,t){if("zoom"===e){this._preZoomLevel=this.zoomLevel;var i=this._getProperZoom(t);return t=i.zoom,void(t!==this.zoomLevel&&(this.zoomLevel=t,5>t&&this.restrictCenter(this.centerPoint),this.fire(new az("on"+e+"_changed"))))}"center"===e&&(this.centerPoint=t),this["_"+e]=t,this.fire(new az("on"+e+"_changed"))},_setValueTick:function(e,t,i,n){if("center"===e){var a=new eR(t.lng+i.lng*n,t.lat+i.lat*n);return void this._setValue(e,a)}return"zoom"===e?void this._setValue(e,Math.pow(t,1-n)*Math.pow(t+i,n)):void this._setValue(e,t+i*n)},setHeading:function(e,t){if(t=t||{},e===this._heading)return void(t.callback&&t.callback());var i=dT(this._heading,360),n=dT(e,360);return n===i?(this._heading=e,void(t.callback&&t.callback())):t.noAnimation?(this._setValue("heading",e),void(t.callback&&t.callback())):(t.unstopable?this._animationInfoUnstopable.heading={current:this._heading,diff:e-this._heading}:this._animationInfo.heading={current:this._heading,diff:e-this._heading},void this._startAnimation(t))},resetHeading:function(e){for(var t=this._heading;0>t;)t+=360;t%=360,t>180&&(t-=360),this._heading=t,this.setHeading(0,e)},getHeading:function(){return this._heading},setTilt:function(e,t){return t=t||{},e===this._tilt?void(t.callback&&t.callback()):(e>bN.MAX_TILT&&(e=bN.MAX_TILT),t&&t.noAnimation?(this._setValue("tilt",e),void(t.callback&&t.callback())):(this._animationInfo.tilt={current:this._tilt,diff:e-this._tilt},void this._startAnimation(t)))},getTilt:function(){return this._tilt},getCenter:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},getCameraPosition:function(e){e=e||{};var t=e.center||this.centerPoint,i=e.zoom||this.zoomLevel,n="number"==typeof e.heading?e.heading:this._heading,a="number"==typeof e.tilt?e.tilt:this._tilt,o=this._webglMapCamera.generateMVMatrix(t,i,n,a),r=mat4.create(Float32Array);return mat4.invert(r,o),this._webglMapCamera.getPosition(r)}}),dL.MAX_IDLE_TIME=50,dL.MAX_FRAME_TIME=6,dL.prototype.runJobs=function(e){if(0!==this._jobQueue.length){var t=dC(),i=0;for(e=e||dL.MAX_FRAME_TIME;this._jobQueue.length&&e>i;){var n=this._jobQueue.shift();"invalid"!==n.state&&n.call(),i=dC()-t}}},dL.prototype.runIdleOnlyJobs=function(){if(0!==this._idleOnlyJobQueue.length)for(var e=dC(),t=0;this._idleOnlyJobQueue.length&&t<dL.MAX_IDLE_TIME;){var i=this._idleOnlyJobQueue.shift();"invalid"!==i.state&&i.call(),t=dC()-e}},dL.prototype.checkIdleRunning=function(){this.isIdle&&!this.idleWorkTimer&&(this.runJobs(),this.runIdleOnlyJobs(),this.idleWorkTimer=setInterval(this._idleWorkerTicker,50))},dL.prototype.addJob=function(e){this._jobQueue.push(e),this.checkIdleRunning()},dL.prototype.clearJobs=function(){this._jobQueue.length=0,this._idleOnlyJobQueue.length=0},dL.prototype.addIdleOnlyJob=function(e){this._idleOnlyJobQueue.push(e),this.checkIdleRunning()};var be={};!function(e){if(!t)var t=1e-6;if(!i)var i="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var a={},o=Math.PI/180;a.toRadian=function(e){return e*o};var r={};r.create=function(e){e=e||i;var t=new e(2);return t[0]=0,t[1]=0,t},r.clone=function(e,t){t=t||i;var n=new t(2);return n[0]=e[0],n[1]=e[1],n},r.fromValues=function(e,t,n){n=n||i;var a=new n(2);return a[0]=e,a[1]=t,a},r.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},r.set=function(e,t,i){return e[0]=t,e[1]=i,e},r.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},r.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e},r.sub=r.subtract,r.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e},r.mul=r.multiply,r.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e},r.div=r.divide,r.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},r.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},r.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},r.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e},r.distance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)},r.dist=r.distance,r.squaredDistance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n},r.sqrDist=r.squaredDistance,r.length=function(e){var t=e[0],i=e[1];return Math.sqrt(t*t+i*i)},r.len=r.length,r.squaredLength=function(e){var t=e[0],i=e[1];return t*t+i*i},r.sqrLen=r.squaredLength,r.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},r.normalize=function(e,t){var i=t[0],n=t[1],a=i*i+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a),e},r.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},r.cross=function(e,t,i){var n=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=n,e},r.lerp=function(e,t,i,n){var a=t[0],o=t[1];return e[0]=a+n*(i[0]-a),e[1]=o+n*(i[1]-o),e},r.random=function(e,t){t=t||1;var i=2*n()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},r.transformMat2=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[2]*a,e[1]=i[1]*n+i[3]*a,e},r.transformMat2d=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[2]*a+i[4],e[1]=i[1]*n+i[3]*a+i[5],e},r.transformMat3=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[3]*a+i[6],e[1]=i[1]*n+i[4]*a+i[7],e},r.transformMat4=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[4]*a+i[12],e[1]=i[1]*n+i[5]*a+i[13],e},r.rotate=function(e,t,i,n){var a=t[0]-i[0],o=t[1]-i[1],r=Math.sin(n),s=Math.cos(n);return e[0]=a*s-o*r+i[0],e[1]=a*r+o*s+i[1],e},r.forEach=function(){var e=r.create();return function(t,i,n,a,o,r){var s,l;for(i||(i=2),n||(n=0),l=a?Math.min(a*i+n,t.length):t.length,s=n;l>s;s+=i)e[0]=t[s],e[1]=t[s+1],o(e,e,r),t[s]=e[0],t[s+1]=e[1];return t}}(),r.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},e.vec2=r;var s={};s.create=function(e){e=e||i;var t=new e(3);return t[0]=0,t[1]=0,t[2]=0,t},s.clone=function(e,t){t=t||i;var n=new t(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},s.fromValues=function(e,t,n,a){a=a||i;var o=new a(3);return o[0]=e,o[1]=t,o[2]=n,o},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},s.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},s.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},s.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},s.sub=s.subtract,s.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e},s.mul=s.multiply,s.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},s.div=s.divide,s.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},s.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},s.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},s.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e},s.distance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(i*i+n*n+a*a)},s.dist=s.distance,s.squaredDistance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return i*i+n*n+a*a},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},s.normalize=function(e,t){var i=t[0],n=t[1],a=t[2],o=i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},s.cross=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=i[0],s=i[1],l=i[2];return e[0]=a*l-o*s,e[1]=o*r-n*l,e[2]=n*s-a*r,e},s.lerp=function(e,t,i,n){var a=t[0],o=t[1],r=t[2];return e[0]=a+n*(i[0]-a),e[1]=o+n*(i[1]-o),e[2]=r+n*(i[2]-r),e},s.random=function(e,t){t=t||1;var i=2*n()*Math.PI,a=2*n()-1,o=Math.sqrt(1-a*a)*t;return e[0]=Math.cos(i)*o,e[1]=Math.sin(i)*o,e[2]=a*t,e},s.transformMat4=function(e,t,i){var n=t[0],a=t[1],o=t[2];return e[0]=i[0]*n+i[4]*a+i[8]*o+i[12],e[1]=i[1]*n+i[5]*a+i[9]*o+i[13],e[2]=i[2]*n+i[6]*a+i[10]*o+i[14],e},s.transformMat3=function(e,t,i){var n=t[0],a=t[1],o=t[2];return e[0]=n*i[0]+a*i[3]+o*i[6],e[1]=n*i[1]+a*i[4]+o*i[7],e[2]=n*i[2]+a*i[5]+o*i[8],e},s.transformQuat=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=i[0],s=i[1],l=i[2],h=i[3],c=h*n+s*o-l*a,d=h*a+l*n-r*o,u=h*o+r*a-s*n,f=-r*n-s*a-l*o;return e[0]=c*h+f*-r+d*-l-u*-s,e[1]=d*h+f*-s+u*-r-c*-l,e[2]=u*h+f*-l+c*-s-d*-r,e},s.rotateX=function(e,t,i,n){var a=[],o=[];return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],o[0]=a[0],o[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),o[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},s.rotateY=function(e,t,i,n){var a=[],o=[];return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],o[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),o[1]=a[1],o[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},s.rotateZ=function(e,t,i,n){var a=[],o=[];return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],o[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),o[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),o[2]=a[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},s.forEach=function(){var e=s.create();return function(t,i,n,a,o,r){var s,l;for(i||(i=3),n||(n=0),l=a?Math.min(a*i+n,t.length):t.length,s=n;l>s;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,r),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),s.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},e.vec3=s;var l={};l.create=function(e){e=e||i;var t=new e(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},l.clone=function(e,t){t=t||i;var n=new t(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},l.fromValues=function(e,t,n,a,o){o=o||i;var r=new o(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=a,r},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},l.set=function(e,t,i,n,a){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e},l.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},l.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e},l.sub=l.subtract,l.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e
},l.mul=l.multiply,l.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e},l.div=l.divide,l.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},l.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},l.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},l.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},l.distance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(i*i+n*n+a*a+o*o)},l.dist=l.distance,l.squaredDistance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return i*i+n*n+a*a+o*o},l.sqrDist=l.squaredDistance,l.length=function(e){var t=e[0],i=e[1],n=e[2],a=e[3];return Math.sqrt(t*t+i*i+n*n+a*a)},l.len=l.length,l.squaredLength=function(e){var t=e[0],i=e[1],n=e[2],a=e[3];return t*t+i*i+n*n+a*a},l.sqrLen=l.squaredLength,l.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},l.normalize=function(e,t){var i=t[0],n=t[1],a=t[2],o=t[3],r=i*i+n*n+a*a+o*o;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r),e},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},l.lerp=function(e,t,i,n){var a=t[0],o=t[1],r=t[2],s=t[3];return e[0]=a+n*(i[0]-a),e[1]=o+n*(i[1]-o),e[2]=r+n*(i[2]-r),e[3]=s+n*(i[3]-s),e},l.random=function(e,t){return t=t||1,e[0]=n(),e[1]=n(),e[2]=n(),e[3]=n(),l.normalize(e,e),l.scale(e,e,t),e},l.transformMat4=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=t[3];return e[0]=i[0]*n+i[4]*a+i[8]*o+i[12]*r,e[1]=i[1]*n+i[5]*a+i[9]*o+i[13]*r,e[2]=i[2]*n+i[6]*a+i[10]*o+i[14]*r,e[3]=i[3]*n+i[7]*a+i[11]*o+i[15]*r,e},l.transformQuat=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=i[0],s=i[1],l=i[2],h=i[3],c=h*n+s*o-l*a,d=h*a+l*n-r*o,u=h*o+r*a-s*n,f=-r*n-s*a-l*o;return e[0]=c*h+f*-r+d*-l-u*-s,e[1]=d*h+f*-s+u*-r-c*-l,e[2]=u*h+f*-l+c*-s-d*-r,e},l.forEach=function(){var e=l.create();return function(t,i,n,a,o,r){var s,l;for(i||(i=4),n||(n=0),l=a?Math.min(a*i+n,t.length):t.length,s=n;l>s;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,r),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),l.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},e.vec4=l;var h={};h.create=function(e){e=e||i;var t=new e(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},h.clone=function(e,t){t=t||i;var n=new t(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},h.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},h.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},h.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},h.invert=function(e,t){var i=t[0],n=t[1],a=t[2],o=t[3],r=i*o-a*n;return r?(r=1/r,e[0]=o*r,e[1]=-n*r,e[2]=-a*r,e[3]=i*r,e):null},h.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},h.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},h.multiply=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=t[3],s=i[0],l=i[1],h=i[2],c=i[3];return e[0]=n*s+o*l,e[1]=a*s+r*l,e[2]=n*h+o*c,e[3]=a*h+r*c,e},h.mul=h.multiply,h.rotate=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=n*l+o*s,e[1]=a*l+r*s,e[2]=n*-s+o*l,e[3]=a*-s+r*l,e},h.scale=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=t[3],s=i[0],l=i[1];return e[0]=n*s,e[1]=a*s,e[2]=o*l,e[3]=r*l,e},h.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},h.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},h.LDU=function(e,t,i,n){return e[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-e[2]*i[1],[e,t,i]},e.mat2=h;var c={};c.create=function(e){e=e||i;var t=new e(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.clone=function(e){var t=new i(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],a=t[3],o=t[6],r=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=a,e[13]=r,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},c.invert=function(e,t){var i=t[0],n=t[1],a=t[2],o=t[3],r=t[4],s=t[5],l=t[6],h=t[7],c=t[8],d=t[9],u=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],v=i*s-n*r,b=i*l-a*r,y=i*h-o*r,x=n*l-a*s,w=n*h-o*s,M=a*h-o*l,T=c*m-d*p,L=c*g-u*p,C=c*_-f*p,P=d*g-u*m,A=d*_-f*m,S=u*_-f*g,I=v*S-b*A+y*P+x*C-w*L+M*T;return I?(I=1/I,e[0]=(s*S-l*A+h*P)*I,e[1]=(a*A-n*S-o*P)*I,e[2]=(m*M-g*w+_*x)*I,e[3]=(u*w-d*M-f*x)*I,e[4]=(l*C-r*S-h*L)*I,e[5]=(i*S-a*C+o*L)*I,e[6]=(g*y-p*M-_*b)*I,e[7]=(c*M-u*y+f*b)*I,e[8]=(r*A-s*C+h*T)*I,e[9]=(n*C-i*A-o*T)*I,e[10]=(p*w-m*y+_*v)*I,e[11]=(d*y-c*w-f*v)*I,e[12]=(s*L-r*P-l*T)*I,e[13]=(i*P-n*L+a*T)*I,e[14]=(m*b-p*x-g*v)*I,e[15]=(c*x-d*b+u*v)*I,e):null},c.adjoint=function(e,t){var i=t[0],n=t[1],a=t[2],o=t[3],r=t[4],s=t[5],l=t[6],h=t[7],c=t[8],d=t[9],u=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15];return e[0]=s*(u*_-f*g)-d*(l*_-h*g)+m*(l*f-h*u),e[1]=-(n*(u*_-f*g)-d*(a*_-o*g)+m*(a*f-o*u)),e[2]=n*(l*_-h*g)-s*(a*_-o*g)+m*(a*h-o*l),e[3]=-(n*(l*f-h*u)-s*(a*f-o*u)+d*(a*h-o*l)),e[4]=-(r*(u*_-f*g)-c*(l*_-h*g)+p*(l*f-h*u)),e[5]=i*(u*_-f*g)-c*(a*_-o*g)+p*(a*f-o*u),e[6]=-(i*(l*_-h*g)-r*(a*_-o*g)+p*(a*h-o*l)),e[7]=i*(l*f-h*u)-r*(a*f-o*u)+c*(a*h-o*l),e[8]=r*(d*_-f*m)-c*(s*_-h*m)+p*(s*f-h*d),e[9]=-(i*(d*_-f*m)-c*(n*_-o*m)+p*(n*f-o*d)),e[10]=i*(s*_-h*m)-r*(n*_-o*m)+p*(n*h-o*s),e[11]=-(i*(s*f-h*d)-r*(n*f-o*d)+c*(n*h-o*s)),e[12]=-(r*(d*g-u*m)-c*(s*g-l*m)+p*(s*u-l*d)),e[13]=i*(d*g-u*m)-c*(n*g-a*m)+p*(n*u-a*d),e[14]=-(i*(s*g-l*m)-r*(n*g-a*m)+p*(n*l-a*s)),e[15]=i*(s*u-l*d)-r*(n*u-a*d)+c*(n*l-a*s),e},c.determinant=function(e){var t=e[0],i=e[1],n=e[2],a=e[3],o=e[4],r=e[5],s=e[6],l=e[7],h=e[8],c=e[9],d=e[10],u=e[11],f=e[12],p=e[13],m=e[14],g=e[15],_=t*r-i*o,v=t*s-n*o,b=t*l-a*o,y=i*s-n*r,x=i*l-a*r,w=n*l-a*s,M=h*p-c*f,T=h*m-d*f,L=h*g-u*f,C=c*m-d*p,P=c*g-u*p,A=d*g-u*m;return _*A-v*P+b*C+y*L-x*T+w*M},c.multiply=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=t[3],s=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],v=t[15],b=i[0],y=i[1],x=i[2],w=i[3];return e[0]=b*n+y*s+x*d+w*m,e[1]=b*a+y*l+x*u+w*g,e[2]=b*o+y*h+x*f+w*_,e[3]=b*r+y*c+x*p+w*v,b=i[4],y=i[5],x=i[6],w=i[7],e[4]=b*n+y*s+x*d+w*m,e[5]=b*a+y*l+x*u+w*g,e[6]=b*o+y*h+x*f+w*_,e[7]=b*r+y*c+x*p+w*v,b=i[8],y=i[9],x=i[10],w=i[11],e[8]=b*n+y*s+x*d+w*m,e[9]=b*a+y*l+x*u+w*g,e[10]=b*o+y*h+x*f+w*_,e[11]=b*r+y*c+x*p+w*v,b=i[12],y=i[13],x=i[14],w=i[15],e[12]=b*n+y*s+x*d+w*m,e[13]=b*a+y*l+x*u+w*g,e[14]=b*o+y*h+x*f+w*_,e[15]=b*r+y*c+x*p+w*v,e},c.mul=c.multiply,c.translate=function(e,t,i){var n,a,o,r,s,l,h,c,d,u,f,p,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(n=t[0],a=t[1],o=t[2],r=t[3],s=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],f=t[10],p=t[11],e[0]=n,e[1]=a,e[2]=o,e[3]=r,e[4]=s,e[5]=l,e[6]=h,e[7]=c,e[8]=d,e[9]=u,e[10]=f,e[11]=p,e[12]=n*m+s*g+d*_+t[12],e[13]=a*m+l*g+u*_+t[13],e[14]=o*m+h*g+f*_+t[14],e[15]=r*m+c*g+p*_+t[15]),e},c.scale=function(e,t,i){var n=i[0],a=i[1],o=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.rotate=function(e,i,n,a){var o,r,s,l,h,c,d,u,f,p,m,g,_,v,b,y,x,w,M,T,L,C,P,A,S=a[0],I=a[1],D=a[2],z=Math.sqrt(S*S+I*I+D*D);return Math.abs(z)<t?null:(z=1/z,S*=z,I*=z,D*=z,o=Math.sin(n),r=Math.cos(n),s=1-r,l=i[0],h=i[1],c=i[2],d=i[3],u=i[4],f=i[5],p=i[6],m=i[7],g=i[8],_=i[9],v=i[10],b=i[11],y=S*S*s+r,x=I*S*s+D*o,w=D*S*s-I*o,M=S*I*s-D*o,T=I*I*s+r,L=D*I*s+S*o,C=S*D*s+I*o,P=I*D*s-S*o,A=D*D*s+r,e[0]=l*y+u*x+g*w,e[1]=h*y+f*x+_*w,e[2]=c*y+p*x+v*w,e[3]=d*y+m*x+b*w,e[4]=l*M+u*T+g*L,e[5]=h*M+f*T+_*L,e[6]=c*M+p*T+v*L,e[7]=d*M+m*T+b*L,e[8]=l*C+u*P+g*A,e[9]=h*C+f*P+_*A,e[10]=c*C+p*P+v*A,e[11]=d*C+m*P+b*A,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)},c.rotateX=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),o=t[4],r=t[5],s=t[6],l=t[7],h=t[8],c=t[9],d=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+h*n,e[5]=r*a+c*n,e[6]=s*a+d*n,e[7]=l*a+u*n,e[8]=h*a-o*n,e[9]=c*a-r*n,e[10]=d*a-s*n,e[11]=u*a-l*n,e},c.rotateY=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),o=t[0],r=t[1],s=t[2],l=t[3],h=t[8],c=t[9],d=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-h*n,e[1]=r*a-c*n,e[2]=s*a-d*n,e[3]=l*a-u*n,e[8]=o*n+h*a,e[9]=r*n+c*a,e[10]=s*n+d*a,e[11]=l*n+u*a,e},c.rotateZ=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),o=t[0],r=t[1],s=t[2],l=t[3],h=t[4],c=t[5],d=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+h*n,e[1]=r*a+c*n,e[2]=s*a+d*n,e[3]=l*a+u*n,e[4]=h*a-o*n,e[5]=c*a-r*n,e[6]=d*a-s*n,e[7]=u*a-l*n,e},c.fromRotationTranslation=function(e,t,i){var n=t[0],a=t[1],o=t[2],r=t[3],s=n+n,l=a+a,h=o+o,c=n*s,d=n*l,u=n*h,f=a*l,p=a*h,m=o*h,g=r*s,_=r*l,v=r*h;return e[0]=1-(f+m),e[1]=d+v,e[2]=u-_,e[3]=0,e[4]=d-v,e[5]=1-(c+m),e[6]=p+g,e[7]=0,e[8]=u+_,e[9]=p-g,e[10]=1-(c+f),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},c.fromQuat=function(e,t){var i=t[0],n=t[1],a=t[2],o=t[3],r=i+i,s=n+n,l=a+a,h=i*r,c=n*r,d=n*s,u=a*r,f=a*s,p=a*l,m=o*r,g=o*s,_=o*l;return e[0]=1-d-p,e[1]=c+_,e[2]=u-g,e[3]=0,e[4]=c-_,e[5]=1-h-p,e[6]=f+m,e[7]=0,e[8]=u+g,e[9]=f-m,e[10]=1-h-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.frustum=function(e,t,i,n,a,o,r){var s=1/(i-t),l=1/(a-n),h=1/(o-r);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(a+n)*l,e[10]=(r+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=r*o*2*h,e[15]=0,e},c.perspective=function(e,t,i,n,a){var o=1/Math.tan(t/2),r=1/(n-a);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+n)*r,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*n*r,e[15]=0,e},c.ortho=function(e,t,i,n,a,o,r){var s=1/(t-i),l=1/(n-a),h=1/(o-r);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+i)*s,e[13]=(a+n)*l,e[14]=(r+o)*h,e[15]=1,e},c.lookAt=function(e,i,n,a){var o,r,s,l,h,d,u,f,p,m,g=i[0],_=i[1],v=i[2],b=a[0],y=a[1],x=a[2],w=n[0],M=n[1],T=n[2];return Math.abs(g-w)<t&&Math.abs(_-M)<t&&Math.abs(v-T)<t?c.identity(e):(u=g-w,f=_-M,p=v-T,m=1/Math.sqrt(u*u+f*f+p*p),u*=m,f*=m,p*=m,o=y*p-x*f,r=x*u-b*p,s=b*f-y*u,m=Math.sqrt(o*o+r*r+s*s),m?(m=1/m,o*=m,r*=m,s*=m):(o=0,r=0,s=0),l=f*s-p*r,h=p*o-u*s,d=u*r-f*o,m=Math.sqrt(l*l+h*h+d*d),m?(m=1/m,l*=m,h*=m,d*=m):(l=0,h=0,d=0),e[0]=o,e[1]=l,e[2]=u,e[3]=0,e[4]=r,e[5]=h,e[6]=f,e[7]=0,e[8]=s,e[9]=d,e[10]=p,e[11]=0,e[12]=-(o*g+r*_+s*v),e[13]=-(l*g+h*_+d*v),e[14]=-(u*g+f*_+p*v),e[15]=1,e)},c.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},e.mat4=c}(window);var bS={result:{bkData:[],eleData:[[],[],[],[],[],[]],tileLabels:[]},createLayer:function(e,t){var i=this.result.bkData;t=t||{},i[e]||(i[e]=[[],[],[]]),i[e].dataType=t.dataType||2,i[e].png8=t.png8||!1,i[e].clipTile=t.clipTile||!1},removeLayer:function(e){var t=this.result.bkData;t[e]=null},getResult:function(){return this.result},setData:function(e,t,i){var n=this.result.bkData,a=n[t]?n[t][i]:null;if(a){for(var o=0;o<a.length;o++)if(a[o].key&&a[o].key===e.key)return void(a[o]=e);a.push(e)}},setLabelData:function(e){this.result.tileLabels=e},getLabelData:function(){return this.result.tileLabels},setOverlayData:function(e,t){this.result.eleData[t]&&(this.result.eleData[t]=e)},clearLabelOverlayData:function(){this.result.eleData[2]=[],this.result.eleData[3]=[],this.result.eleData[4]=[]},clearData:function(e){var t=this.result.bkData;if("number"==typeof e)return void(t[e]&&(t[e][0]=[],t[e][1]=[],t[e][2]=[]));for(var i=0;i<t.length;i++)t[i]&&(t[i][0]=[],t[i][1]=[],t[i][2]=[])},sortThumbData:function(e){var t=this.result.bkData,i=t[e];i&&i[0]&&i[0].length>0&&i[0].sort(function(e,t){return e.tileInfo.useZoom-t.tileInfo.useZoom})}},aA=bS;eM.FeatureMgr=aA,window.xxx=aA;var dq=function(){function e(e){return d[0]=e,u[0]}function t(t){var i=t[3]<<24|t[2]<<16|t[1]<<8|t[0],n=e(4278190079&i);return n}function i(e,t){var i;return i=t%2===0?[-e[1],e[0]]:[e[1],-e[0]]}function n(e,t,n){var a,o=i(e,t);return n===p?o:(a=4===t||5===t?[o[0]-e[0],o[1]-e[1]]:[o[0]+e[0],o[1]+e[1]],n===f&&vec2.normalize(a,a),a)}function a(e,t,i,n){var a=vec2.dot(e,t);if(i===g||i===m){if((0===n||1===n)&&a>0)return!0;if((2===n||3===n)&&0>a)return!0}return(0===n||1===n)&&0>a?!0:(2===n||3===n)&&a>0?!0:!1}function o(e,t,n){var a,o=i(e,t),r=e,s=n,l=[];vec2.normalize(l,[r[0]+s[0],r[1]+s[1]]);var h=vec2.dot(o,[-l[1],l[0]]);Math.abs(h)<.1&&(h=1);var c=1/h;a=[-l[1]*c,l[0]*c];var d=vec2.dot(e,a);return 0>d&&vec2.negate(a,a),{cos2:d,offset:a}}function r(e,t,n,o){var r,s,l,h=i(e,t);if(0===t||1===t?(r=n,s=e):(r=e,s=n),!r||!s)return h;var c=[r[0]+s[0],r[1]+s[1]];0===c[0]&&0===c[1]?vec2.normalize(c,s):vec2.normalize(c,c);var d=a(c,h,o,t);if(d)return h;var u=vec2.dot(h,[-c[1],c[0]]);Math.abs(u)<.1&&(u=1);var f=1/u;return l=[-c[1]*f,c[0]*f]}function s(e,t,i,n,a,o,r,s,c){var d,u=0,f=!1;d=void 0===c?a.length/_-1:a.length/v-1,l(t[0],e[0],n,i,4,r,s,void 0,a,c),d++,u++,l(t[0],e[0],n,i,5,r,s,void 0,a,c),d++,u++;for(var p=0;p<e.length;p++)l(t[p],e[p],n,i,0,r,s,e[p-1],a,c),h(o,++d,++u,f),l(t[p],e[p],n,i,1,r,s,e[p-1],a,c),h(o,++d,++u,f),l(t[p+1],e[p],n,i,2,r,s,e[p+1],a,c),h(o,++d,++u,f),l(t[p+1],e[p],n,i,3,r,s,e[p+1],a,c),h(o,++d,++u,f),i===m&&p!==e.length-1&&(l(t[p+1],e[p],n,i,8,r,s,e[p+1],a,c),h(o,++d,++u,f),f=f?!1:!0);l(t[t.length-1],e[e.length-1],n,i,6,r,s,void 0,a,c),h(o,++d,++u,f),l(t[t.length-1],e[e.length-1],n,i,7,r,s,void 0,a,c),h(o,++d,++u,f)}function l(e,t,i,a,s,l,h,c,d,u){var f,p=s%2===0?1:-1;if(4===s||5===s||6===s||7===s)f=n(t,s,i);else if(0===s||1===s||2===s||3===s)f=r(t,s,c,a);else if(8===s){var m=o(t,s,c);f=m.offset,vec2.normalize(f,f);var g=m.cos2;0>g&&(p=-p)}d[d.length]=10*e[0],d[d.length]=10*e[1],d[d.length]=f[0]*h*10,d[d.length]=f[1]*h*10,d[d.length]=l,d[d.length]=p,void 0!==u&&(d[d.length]=u)}function h(e,t,i,n){i%2===0?n?(e[e.length]=t-2,e[e.length]=t-1,e[e.length]=t):(e[e.length]=t-1,e[e.length]=t-2,e[e.length]=t):n?(e[e.length]=t-1,e[e.length]=t-2,e[e.length]=t):(e[e.length]=t-2,e[e.length]=t-1,e[e.length]=t)}var c=new Int8Array(4),d=new Int32Array(c.buffer,0,1),u=new Float32Array(c.buffer,0,1),f=0,p=1,m=1,g=2,_=6,v=7;return{getVertexCount:function(e,t){return t===m?5*e-2:4*e},overlayLine:function(e,i,n,a,o,r,l,h){for(var c=[],d=0;d<e.length;d++)if(d!==e.length-1){var u=[e[d+1][0]-e[d][0],e[d+1][1]-e[d][1]],f=[];0===u[0]&&0===u[1]?f=[0,0]:vec2.normalize(f,u),c[c.length]=[f[0],f[1]]}return s(c,e,i,n,a,o,t(r),l,h)},toSolidVertices:function(e,t){for(var i=new Float32Array(e.length/v*5),n=new Int16Array(i.buffer),a=0,o=0,r=0;r<e.length;r+=v)n[a]=~~e[r],n[a+1]=~~e[r+1],n[a+2]=~~e[r+2],n[a+3]=~~e[r+3],i[o+2]=e[r+4],n[a+6]=e[r+5],n[a+7]=t?t:0,n[a+8]=e[r+6],n[a+9]=0,a+=10,o+=5;return i}}}(),cU=1,ef=2,dN={drawIndex:0,devicePixelRatio:aw(),zoomState:1,curViewTilesInfo:null,iconSetImg:null,LAST_CALC_ZOOM:-1,LAST_LOAD_VECTOR_ZOOM_CHANGE:!1,lastCollisionTestTime:0,remove:function(){this.tileCache.clear()},initDrawData:function(){this.drawIndex=this.zIndex,aA.createLayer(this.drawIndex,{dataType:this.dataType,png8:this.png8,clipTile:this.clipTile})},destroyDrawData:function(){aA.removeLayer(this.drawIndex)},setZIndex:function(e){this.zIndex=e},getTileKey:function(e){return this.mapType+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+e.useZoom},getTileRenderDataKey:function(e){var t=e.col,i=e.zoom,n=e.baseTileSize;return t=cu.calcLoopParam(t,i,n).col,this.mapType+"_"+t+"_"+e.row+"_"+i+"_"+e.useZoom},getTileUnits:function(e){var t=this.map,i=ba[t.getMapType()],n=i.baseUnits*Math.pow(2,i.zoomLevelBase-e);return n},getTilesUrl:function(e,t,i){var n=e.x,a=e.y,o=aa("ditu","normal"),r=o.ver,s=o.udt;n=cu.calcLoopParam(n,t,i).col;var l=ba.B_NORMAL_MAP.vectorTileUrls,h=Math.abs(n+a)%l.length,c=l[h];window.offLineIPAddress&&(l=[window.offLineIPAddress+"pvd/"],c=l[0]);var d="x="+n+"&y="+a+"&z="+Math.floor(t),u=this.devicePixelRatio>1?"&scaler=2":"",f="&textimg=1";"canvas"===this.map.config.textRenderType&&(f="&textimg=0"),d+="&styles=pl"+f+u+"&v="+r+"&udt="+s+"&json=0";var p=c+"?qt=vtile&param="+window.encodeURIComponent(d8(d));return p},getRasterTilesUrl:function(e,t,i){var n=ba[this.map.mapType],a=n.tileUrls[Math.abs(t+e)%n.tileUrls.length]+"?qt=tile&x="+e+"&y="+t+"&z="+i+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p=1";return a=a.replace(/-(\d+)/gi,"M$1")},getZoomState:function(){var e=this.map,t=e.getZoom(),i=t-this.lastZoom;return i>0?this.zoomState=1:0>i&&(this.zoomState=-1),this.lastZoom=t,this.zoomState},releaseOutViewTileData:function(e){for(var t=WorkerMgr.releasePendingData(e),i=0,n=t.length;n>i;i++){var a=this.getTileKey(t[i]);this.tileCache.removeData(a)}},loadLayerData:function(e,t,i){this.hasZoomChange=i,this.curViewTilesInfo=e,this.releaseOutViewTileData(e);var n=this.getZoomState();this.dataType===ef?t?this.getVectorLayerDataFromCache(e,n):this.loadVectorLayerData(e):this.loadRasterLayerData(e,t)},getVectorLayerDataFromCache:function(e,t){if(this.map.temp.isPermitSpotOver=!1,this.tileLabels=[],this.baseLayer===!0){var i=this.map._customLabelMgr.virtualTile;i&&i.label&&this.tileLabels.push(i.label)}this.thumbCache={};for(var n=-1,a=0,o=e.length;o>a;a++){var r=e[a],s=r.col,l=r.row,h=r.zoom,c=s+"_"+l+"_"+h,d=r.useZoom;n=h;var u=this.getTileKey(r),f=this.tileCache.getData(u);if(f&&"ready"===f.status){if(eM.FeatureMgr.setData(f,this.drawIndex,2),f.label)if("ready"===f.label.status){if(f.label.tileInfo=f.tileInfo,this.tileLabels.push(f.label),f.label.textureSources&&f.label.textureSources[d]&&this.map._webglMapScene){var p=this.map._webglMapScene._painter;p._labelTextureAtlasOffset[c]||p._addToAsyncJob(f.label.textureSources[d])}}else"processing"!==f.label.status&&this.processLabelData(f)}else{var m={tileInfo:r,dataType:ef,key:u};eM.FeatureMgr.setData(m,this.drawIndex,2),this.useThumbData&&this.setThumbData(s,l,h,d,t)}}this.tileLabels.labelZoom=n,this.updateLabels(t);var g=this.map.getZoom(),_=Math.floor(g),v=g-_,b=Math.floor(this.LAST_CALC_ZOOM),y=this.LAST_CALC_ZOOM-b,x=!1;this.hasZoomChange?(Math.abs(g-this.LAST_CALC_ZOOM)>=.5?x=!0:.5>v&&y>=.5?x=!0:v>=.5&&.5>y&&(x=!0),x&&this.cacheDataCollideLabels(0),this.LAST_CALC_ZOOM=g):this.tileLabels.length>0&&this.cacheDataCollideLabels(30)},loadVectorLayerData:function(e){function t(e,n){var a=i.tileCache.getData(n);if(a){if(!e||e.error){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.tileKey+":"+e.message,path:"api.js",ln:1});var o=new az("ontileloaderror");return e=e||{},o.error=e.error||"",o.message=e.message||"",i.map.fire(o),a.status="init",a.reloadTimer=setTimeout(function(){a.retry<3?(a.retry++,a.status="loading",i.loadVectorTileData(e.tileInfo,t)):i.tileCache.removeData(n)},4e3),aA.clearData(i.drawIndex),i._checkTilesLoaded(),void i.getVectorLayerDataFromCache(i.curViewTilesInfo,i.getZoomState())}a.reloadTimer&&(clearTimeout(a.reloadTimer),a.reloadTimer=null),i.callbackDataQueue.push([e,n]),i.processDataTimer||(i.processDataTimer=setTimeout(function(){for(;i.callbackDataQueue.length>0;){var e=i.callbackDataQueue.shift();i.vectorTileDataCbk(e[0],e[1]),i._checkTilesLoaded()}aA.clearData(i.drawIndex),i.getVectorLayerDataFromCache(i.curViewTilesInfo,i.getZoomState()),i.processDataTimer=null},200))}}this.map.temp.isPermitSpotOver=!1;for(var i=this,n=0,a=e.length;a>n;n++){var o=e[n],r=(o.col,o.row,o.zoom,o.loopOffsetX,this.getTileKey(o)),s=this.tileCache.getData(r);if(s||(s={status:"init",tileInfo:o,dataType:ef,key:r,retry:0}),"ready"!==s.status&&"loading"!==s.status){this.numLoading++,s.status="loading",this.tileCache.setData(r,s);var l=this.getProcessedLabelZoom(o);l&&(o.processedLabelZooms=l),this.loadVectorTileData(o,t)}}},setThumbData:function(e,t,i,n,a){1===a?this._findParentZoomTile(e,t,i,n,8)===!1&&this._findChildZoomTile(e,t,i,n,3):-1===a&&this._findChildZoomTile(e,t,i,n,3)===!1&&this._findParentZoomTile(e,t,i,n,8),aA.sortThumbData(this.drawIndex)},_findParentZoomTile:function(e,t,i,n,a){for(var o=ba[this.getMapType()],r=o.minDataZoom,s=e,l=t,h=i,c=n,d=1;a>=d;d++){var u=this.tileType.getParentTile(s,l,h,c,r);if(null!==u){var f=this.getTileKey(u),p=this.tileCache.getData(f);if(p&&"ready"===p.status){if(this.thumbCache[f])continue;return eM.FeatureMgr.setData(p,this.drawIndex,0),this.thumbCache[f]=!0,!0}s=u.col,l=u.row,h=u.zoom,c=u.useZoom}}return!1},_findChildZoomTile:function(e,t,i,n,a){for(var o=ba[this.getMapType()],r=o.maxDataZoom,s=e,l=t,h=i,c=n,d=!0,u=1;a>=u;u++){var f=!1,p=this.tileType.getChildTiles(s,l,h,c,r,u);if(p){for(var m=0;m<p.length;m++){var g=this.getTileKey(p[m]),_=this.tileCache.getData(g);_&&"ready"===_.status?(this.thumbCache[g]||(eM.FeatureMgr.setData(_,this.drawIndex,1),this.thumbCache[g]=!0),f=!0):d=!1}if(f)break}}return d},loadVectorTileData:function(e,t){var i=e.col,n=e.row,a=e.zoom,o=e.baseTileSize,r=this.getTilesUrl(new cG(i,n),a,o),s=this.getTileKey(e);if(aM(this.map),!this.processData)return void WorkerMgr.loadTileData(r,e,s,t);var t="cbk"+s,l=this;eM[t]=function(i){var n=function(t){return function(){t.tileInfo=e;var i=l.processData(t);if(i.road){for(var n={tileInfo:e,renderData:{base:[]},status:"ready",key:s,mapType:l.mapType},a=[],o=[],r=0;r<i.road.length;r++){for(var h=i.road[r],c=0;c<h.length;c++){var d=h[c],u=[];a.length/7+d[0].length/2>65536&&(n.renderData.base.push({type:"line",data:[dq.toSolidVertices(a,4e3),new Uint16Array(o)]}),a=[],o=[]);for(var f=0;f<d[0].length;f+=2)u[u.length]=[d[0][f],d[0][f+1]];var p=d[3];dq.overlayLine(u,d[1],d[2],a,o,p,d[4],r+20)}n.renderData.base.push({type:"line",data:[dq.toSolidVertices(a,4e3),new Uint16Array(o)]})}l.tileCache.setData(s,n),aA.clearData(l.drawIndex),l.getVectorLayerDataFromCache(l.curViewTilesInfo,l.getZoomState()),l.map.dispatchEvent(new az("onrefresh"))}}}(i);l.map.jobScheduler.addJob(n),delete eM[t]},r+="&fn=BMap."+t,eL.load(r)},vectorTileDataCbk:function(e,t){var i=new az("ontileloaded");i.perfStat=e.perfStat||[];var n=this.map;n.fire(i);var a=e.tileInfo,o=a.col,r=a.row,s=a.zoom,l=a.baseTileSize,h=this.tileCache.getData(t);if(h){this.showLabel||(e.label=null),h.renderData=e;var c=cu.calcLoopParam(o,s,l),d=c.geoOffsetX;h.tileInfo.loopOffsetX=d,h.status="ready",h.mapType=this.mapType,this.tileCache.setData(t,h),h.label=e.label,e.label=null,e.indoorData&&n._indoorMgr.setData(e.indoorData);var u="id_"+o+"_"+r+"_"+s;if(!this.curViewTilesInfo[u])return void n.fire(new az("ontilenotinview"));this.processLabelData(h),e.indoorData&&n._indoorMgr.currentUid&&this._refreshIndoorData(n._indoorMgr.currentUid,n._indoorMgr.currentFloor);var f=new az("onrefresh");f.source="webgllayer",this.map.dispatchEvent(f)}},_refreshIndoorData:function(e,t){for(var i=this.map._indoorMgr.getIndoorData(e),n=i.tileKeys,a=Math.floor(this.map.getZoom()),o=0;o<n.length;o++){var r=n[o],s=this.tileCache.getData(r);if(s){var l=s.renderData;l.indoorBase=[],l.indoorBaseContour=[],l.indoorBorder3D=[],l.indoorArea3D=[],s.label.indoorLabel=[],this.labelProcessor.clearCollisionCache(s.label);for(var h in l.indoorData)if("tileInfo"!==h){var c=l.indoorData[h],d=c.defaultFloor;if(h===e&&(d=t,c.currentFloor=t),c.floors[d]){if(c.floors[d].base)for(var u=0;u<c.floors[d].base.length;u++)l.indoorBase.push(c.floors[d].base[u]);if(c.floors[d].contour)for(var u=0;u<c.floors[d].contour.length;u++)l.indoorBaseContour.push(c.floors[d].contour[u]);c.floors[d].indoorBorder3D&&l.indoorBorder3D.push(c.floors[d].indoorBorder3D),c.floors[d].area3D&&l.indoorArea3D.push(c.floors[d].area3D),c.floors[d].pois&&(s.label.indoorLabel=s.label.indoorLabel.concat(c.floors[d].pois))}}this.updateAllIconsTextureCoords(s);var f=this;this.labelProcessor.loadIconImages(s,function(e){f.updateAllIconsTextureCoords(e)});var p=r.split("_"),m=parseInt(p[p.length-1],10);m===a&&eM.FeatureMgr.setData(s,this.drawIndex,2)}}this.dataBackCollideLabels(),this.map.dispatchEvent(new az("onrefresh"))},_removeIndoorData:function(e){if(e.indoorData)for(var t in e.indoorData)"tileInfo"!==t&&this.map._indoorMgr.removeData(t,e.key)},getProcessedLabelZoom:function(e){var t=bU.baseZoomInfo[e.zoom];if(!t)return!1;for(var i=[],n=0;n<t.length;n++){var a=this.mapType+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+t[n],o=this.tileCache.getData(a);o&&"ready"===o.status&&o.label&&"ready"===o.label.status&&i.push(t[n])}return i.length?i:!1},getSameZoomDataFromCache:function(e){for(var t=bU.baseZoomInfo[e.zoom],i=0;i<t.length;i++){var n=this.mapType+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+t[i];if(e.useZoom!==t[i]){var a=this.tileCache.getData(n);if(a&&"ready"===a.status&&a.label&&"ready"===a.label.status)return a}}return!1},hasSameLabelData:function(e,t){for(var i=0;i<t.length;i++)if(t[i].key===e)return!0;return!1},getDataByFloorName:function(e,t){for(var i=0;i<e.length;i++)if(e[i].floorName===t)return e[i];return null},mergeIndoorLabelData:function(e,t){for(var i in e)if("tileInfo"!==i&&t[i])for(var n=e[i].floors,a=t[i].floors,o=0;o<n.length;o++){var r=n[o],s=r.floorName,l=this.getDataByFloorName(a,s);l&&(l.pois?(l.pois=l.pois.concat(r.pois),r.pois=l.pois):l.pois=r.pois)}},mergeSameZoomLabelData:function(e){var t=e.label;if(t){var i=e.tileInfo,n=this.getSameZoomDataFromCache(i);if(n){var a=n.label;if(a){for(var o=0;o<t.fixedLabel.length;o++)this.hasSameLabelData(t.fixedLabel[o].key,a.fixedLabel)||(a.hasNewData=!0,a.fixedLabel.push(t.fixedLabel[o]));for(var o=0;o<t.lineLabel.length;o++)this.hasSameLabelData(t.lineLabel[o].key,a.lineLabel)||(a.hasNewData=!0,a.lineLabel.push(t.lineLabel[o]));for(var o=0;o<t.indoorLabel.length;o++)this.hasSameLabelData(t.indoorLabel[o].key,a.indoorLabel)||(a.hasNewData=!0,a.indoorLabel.push(t.indoorLabel[o]));e.label=a,n.renderData.indoorData&&e.renderData.indoorData&&this.mergeIndoorLabelData(e.renderData.indoorData,n.renderData.indoorData)}}}},processLabelData:function(e){if(e.label&&"processing"!==e.label.status){e.label.status="processing";var t=this;if(t.updateAllIconsTextureCoords(e),this.labelProcessor.loadIconImages(e,function(e){t.updateAllIconsTextureCoords(e)}),"canvas"!==this.map.config.textRenderType){var i=e.label.textImgStr,n=e.label.indoorTextImgStr;this.labelProcessor.loadImgByStr(i,n,function(i,n){var a=e.label.textureHeight,o=e.label.indoorTextureHeight;e.label.textureHeight=void 0,e.label.indoorTextureHeight=void 0;var r=e.tileInfo;t.mergeSameZoomLabelData(e);var s=e.label;s.textImgStr="",s.indoorTextImgStr&&(s.indoorTextImgStr="");var l=r.col+"_"+r.row+"_"+r.zoom;s.textureHeights||(s.textureHeights=[]),s.textureHeights[r.useZoom]=a,s.indoorTextureHeights||(s.indoorTextureHeights=[]),s.indoorTextureHeights[r.useZoom]=o,t._doWorkAfterLabelImageLoad(e,i,n,l)})}else{this.labelProcessor.drawLabelsOnCanvas(e,function(i,n){var a=e.tileInfo;t.mergeSameZoomLabelData(e),i&&(e.label.textureHeights||(e.label.textureHeights=[]),e.label.textureHeights[a.useZoom]=i.height),n&&(e.label.indoorTextureHeights||(e.label.indoorTextureHeights=[]),e.label.indoorTextureHeights[a.useZoom]=n.height);var o=a.col+"_"+a.row+"_"+a.zoom+"_"+a.useZoom;t._doWorkAfterLabelImageLoad(e,i,n,o)})}}},_doWorkAfterLabelImageLoad:function(e,t,i,n){var a=this,o=e.label;if(o.tileInfo=e.tileInfo,o.status="ready",t||i){var r=o.tileInfo;if(t&&(t.id=n,o.textureSources||(o.textureSources=[]),o.textureSources[r.useZoom]=t),i&&(i.id=n+"_indoor",o.indoorTextureSources||(o.indoorTextureSources=[]),o.indoorTextureSources[r.useZoom]=i),a.map._webglMapScene){var s=a.map._webglMapScene._painter;t&&s._addToAsyncJob(o.textureSources[r.useZoom])}}e.custom!==!0&&a.tileLabels.push(o),a.collisionTimer||(a.collisionTimer=setTimeout(function(){a.dataBackCollideLabels(),a.collisionTimer=null},300))},_updateIconTextureCoords:function(e){if(e)for(var t=this.map,i=0;i<e.length;i++){var n=e[i];if(n.iconPos&&t._webglMapScene){var a=t._webglMapScene._painter;n.iconPos.texcoord=a._iconTextureAtlasCoords[n.iconPos.iconType]||null}}},updateAllIconsTextureCoords:function(e){if(e)e.label&&(this._updateIconTextureCoords(e.label.fixedLabel),this._updateIconTextureCoords(e.label.indoorLabel));else{var t=this.tileCache.getAllData();for(var i in t){var n=t[i].data;"ready"===n.status&&n.label&&(this._updateIconTextureCoords(n.label.fixedLabel),this._updateIconTextureCoords(n.label.indoorLabel))}}this.updateLabels(),this.map.dispatchEvent(new az("onrefresh"))},cacheDataCollideLabels:function(e){function t(){i.cacheLabelTimer=null;var e,t=i.map.getTilt(),n=i.map.getHeading()%360;if(0===i.tileLabels.length||1===i.tileLabels.length&&0===i.tileLabels[0].tileInfo.zoom)e=aA.getLabelData(),e.length>0&&(e=i.labelProcessor.collisionTest(e,-1));else{if(t||n)return this._collisionTimer&&(t&&Date.now()-i.lastCollisionTestTime>500?i.lastCollisionTestTime=Date.now():clearTimeout(this._collisionTimer)),void(this._collisionTimer=setTimeout(function(){e=i.labelProcessor.collisionTest(i.tileLabels),e&&aA.setLabelData(e),i.updateLabels(),i.map.dispatchEvent(new az("onrefresh")),i._collisionTimer=null},60));e=i.labelProcessor.getCachedLabels(i.tileLabels)}e&&aA.setLabelData(e),i.updateLabels(),i.map.dispatchEvent(new az("onrefresh"))}var i=this;if(e){if(i.cacheLabelTimer)return;i.cacheLabelTimer=setTimeout(function(){t()},e)}else clearTimeout(i.cacheLabelTimer),t()},dataBackCollideLabels:function(){var e=this;if(!e.tileLabels||0!==e.tileLabels.length){var t;e.labelProcessor.cacheLabelResult(e.tileLabels),t=e.labelProcessor.getCachedLabels(e.tileLabels),t&&aA.setLabelData(t),e.updateLabels(),e.map.dispatchEvent(new az("onrefresh")),dX()&&this.labelProcessor._refreshSpotData()}},updateLabels:function(){var e=this.map,t=aA.getLabelData();if(t.length>0){var i=e.getZoom();if(t.labelZoom-i<3){this.labelProcessor.updateLabels(t);var n=this.labelProcessor.fixDataFormat(t);aA.setOverlayData(n[0],2),aA.setOverlayData(n[1],3),aA.setOverlayData(n[2],4)}else aA.clearLabelOverlayData();e.temp.isPermitSpotOver=!1,this.labelProcessor.curSpotAdded=!1}},loadRasterLayerData:function(e,t){if(t)for(var i=0,n=e.length;n>i;i++){var a=e[i],o=this.getTileKey(a),r=this.tileCache.getData(o);r&&"ready"===r.status&&eM.FeatureMgr.setData(r,this.drawIndex,2)}else for(var i=0,n=e.length;n>i;i++){var a=e[i],o=this.getTileKey(a),r=this.tileCache.getData(o);if(!r){this.tileCache.setData(o,{});var s=this;this.loadRasterTileData(a,function(e,t){s.rasterTileDataCbk(e,t)})}}},loadRasterTileData:function(e,t){var i=e.col,n=e.row,a=e.zoom,o=this.getTilesUrl(new cG(i,n),a),r=this.getTileKey(e),s=this.loadTileImage(o,r,t);s.tileInfo=e},loadTileImage:function(e,t,i){var n=new Image;return n.crossOrigin="anonymous",n.onload=function(){i&&i(this,t)},n.onerror=function(){i&&i(null,t)
},n.src=e,n},rasterTileDataCbk:function(e,t){if(!e)return void this.tileCache.removeData(t);var i=e.tileInfo,n=i.col,a=i.row,o=i.zoom,r=this.tileCache.getData(t);if(r){var s=cu.calcLoopParam(n,o),l=s.geoOffsetX;e.tileInfo.loopOffsetX=l,r.textureSource=e,r.dataType=cU,r.tileInfo=i,r.renderData={vertexAll:[0,0,0,0,0,256,0,0,1,0,256,256,0,1,1,0,0,0,0,0,256,256,0,1,1,0,256,0,0,1]},r.status="ready",this.tileCache.setData(t,r);var h="id_"+n+"_"+a+"_"+o,c=!1;if(this.curViewTilesInfo[h]&&(r.dataType=cU,r.png8=this.png8||!1,eM.FeatureMgr.setData(r,this.drawIndex,2),c=!0),c){var d=new az("onrefresh");d.source="webgllayer",this.map.dispatchEvent(d)}}},_checkTilesLoaded:function(){this.numLoading--,this.map.firstTileLoad===!1&&(this.map.dispatchEvent(new az("onfirsttilesloaded")),this.map.firstTileLoad=!0);var e=this;0===this.numLoading&&(this._checkLoadedTimer&&(clearTimeout(this._checkLoadedTimer),this._checkLoadedTimer=null),this._checkLoadedTimer=setTimeout(function(){0===e.numLoading&&e.map.dispatchEvent(new az("ontilesloaded")),e._checkLoadedTimer=null},60))},isClickableLabel:function(e){return e.isDel?!1:e.zoom>9&&!e.guid?!1:e.zoom<=9&&!e.name&&!e.guid?!1:!0}},bc=5,cq=4,eP=3,dn=2,e2=1,cs=0;x.extend(r.prototype,{_loadIcons:function(e,t){var i=0,n=this;for(var a in e){i++;var o=new Image;o.id=a,o.crossOrigin="anonymous",o.onload=function(){n._iconCache[this.id].loaded=!0,i--,0===i&&t(),this.onload=null},o.onerror=function(){n._iconCache[this.id]=null,i--,0===i&&t(),this.onerror=null};var r=df.iconSetPath+a+".png";o.src=r,this._iconCache[a]={loaded:!1,image:o}}},_getEmptyDrawingCanvas:function(){for(var e=0;e<this._drawingCanvasPool.length;e++)if(this._drawingCanvasPool[e]._free===!0)return this._drawingCanvasPool[e]._free=!1,this._drawingCanvasPool[e];var t=this._createNewDrawingCanvas();return this._drawingCanvasPool.push(t),t._free=!1,t},_createNewDrawingCanvas:function(){var e=H("canvas");e.width=512,e.height=this._drawingCanvasHeight,e._free=!0,e._id=eM.getGUID();var t=e.getContext("2d");return t.textBaseline="bottom",t.lineJoin="round",e},drawLabelsOnCanvas:function(e,t){var i=e.label.fixedLabel.slice(0),n=e.label.lineLabel.slice(0),a=e.label.indoorLabel.slice(0);if(0===i.length&&0===n.length&&0===a.length)return void t();var o=function(e,t){return e.styleId-t.styleId};i.sort(o),n.sort(o),a.sort(o);var r={},s=this._getEmptyDrawingCanvas(),l=s.getContext("2d");l.clearRect(0,0,s.width,s.height);var h=0,c=null,d=0;if(i.length>0){for(;d<i.length&&!i[d].styleText[0];)d++;i[d]&&i[d].styleText[0]&&(c=i[d].styleText[0].fontSize+2*i[d].styleText[0].haloSize)}if(null===c&&a.length>0){for(d=0;d<a.length&&!a[d].styleText[0];)d++;a[d]&&a[d].styleText[0]&&(c=a[d].styleText[0].fontSize+2*a[d].styleText[0].haloSize)}if(null===c&&n.length>0){for(d=0;d<n.length&&!n[d].styleText[0];)d++;n[d]&&n[d].styleText[0]&&(c=n[d].styleText[0].fontSize+2*n[d].styleText[0].haloSize)}if(null===c||isNaN(c))return void t();for(var u=0,f=c,p={},m=0,g=[],_=0;_<i.length;_++){var v=i[_],b=v.name,y=v.styleText;if(b&&0!==y.length){var x=v.icon;if(!v.textOnIcon||this._iconCache[x]&&this._iconCache[x].loaded!==!1){var w=this._drawEachText(l,v,h,u,f,c,r);u=w.curX,f=w.curY,c=w.curLineHeight,h=w.styleId}else g.push(v),m++,p[x]||(p[x]=!0)}}var w=this._drawEachTypeOfLabels(l,a,h,u,f,c,r);h=w.curStyleId,u=w.curX,f=w.curY,c=w.curLineHeight;var w=this._drawEachTypeOfLabels(l,n,h,u,f,c,r);if(h=w.curStyleId,u=w.curX,f=w.curY,c=w.curLineHeight,m>0){var M=this;return void this._loadIcons(p,function(){w=M._drawEachTypeOfLabels(l,g,h,u,f,c,r),h=w.curStyleId,u=w.curX,f=w.curY,c=w.curLineHeight;var o=M._generateEachLabelCanvas(s,f,i,n,a,e);t(o[0],o[1])})}var T=this._generateEachLabelCanvas(s,f,i,n,a,e);t(T[0],T[1])},drawCustomLabelsOnCanvas:function(e,t){if(0===e.length)return void t();var i=0,n=e[0].style.fontSize+2*(e[0].style.haloSize||0)||0,a=n,o=this._getEmptyDrawingCanvas(),r=o.getContext("2d");r.clearRect(0,0,o.width,o.height);for(var s={},l=-1,h=0;h<e.length;h++)if(e[h].name){var c=this._drawEachText(r,e[h],l,i,n,a,s);i=c.curX,n=c.curY,a=c.curLineHeight,l=c.styleId}for(var d=n,u=this._copyToNewCanvas(o,d),h=0;h<e.length;h++)e[h].name||!e[h].style.iconSize?e[h].textSize&&(this._updateFixedLabelCoords(e[h],d),this._addFixedLabelBounds(e[h])):this._addFixedLabelBounds(e[h]);t(u)},_drawEachTypeOfLabels:function(e,t,i,n,a,o,r){for(var s=0;s<t.length;s++){var l=t[s],h=l.name,c=l.styleText;if(h&&0!==c.length){var d=this._drawEachText(e,l,i,n,a,o,r);if(n=d.curX,a=d.curY,o=d.curLineHeight,i=d.styleId,d.curY>this._drawingCanvasHeight)return{curX:n,curY:a,curLineHeight:o,curStyleId:i}}}return{curX:n,curY:a,curLineHeight:o,curStyleId:i}},_drawIndoorTextLabelOnCanvas:function(e){var t=this._getEmptyDrawingCanvas(),i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);var n,a=0,o=null,r=0,s={},l=[];for(var h in e)if("tileInfo"!==h)for(var c=e[h],d=c.defaultFloor,u=c.floors,f=0;f<u.length;f++)if(f!==d){var p=u[f];if(p.pois)for(var m=p.pois,g=0;g<m.length;g++)null===o&&m[g].styleText[0]&&(o=m[g].styleText[0].fontSize+2*m[g].styleText[0].haloSize,n=o),l.push(m[g])}if(null===o)return null;l.sort(function(e,t){return t.rank-e.rank||e.styleId-t.styleId});var _=this._drawEachTypeOfLabels(i,l,a,r,n,o,s);a=_.curStyleId,r=_.curX,n=_.curY,o=_.curLineHeight;var v=this._copyToNewCanvas(t,n);return v},_updateIndoorLabelsCoords:function(e,t){for(var i in e)if("tileInfo"!==i)for(var n=e[i],a=n.defaultFloor,o=n.floors,r=0;r<o.length;r++)if(r!==a){var s=o[r];if(s.pois)for(var l=s.pois,h=0;h<l.length;h++){var c=l[h];!c.name||c.textSize&&0!==c.textSize.length?(this._updateFixedLabelCoords(c,t),this._addFixedLabelBounds(c)):(l.splice(h,1),h--)}}},_generateEachLabelCanvas:function(e,t,i,n,a,o){var r=this._copyToNewCanvas(e,t),s=null;o.renderData.indoorData&&(s=this._drawIndoorTextLabelOnCanvas(o.renderData.indoorData),s&&this._updateIndoorLabelsCoords(o.renderData.indoorData,s.height));for(var l=0;l<i.length;l++)i[l].textSize&&(this._updateFixedLabelCoords(i[l],t),this._addFixedLabelBounds(i[l]));for(var l=0;l<a.length;l++)a[l].textSize&&(this._updateFixedLabelCoords(a[l],t),this._addFixedLabelBounds(a[l]));for(var l=0;l<n.length;l++)this._updateLineLabelCoords(n[l],t);return[r,s]},_copyToNewCanvas:function(e,t){if(0===t)return null;var i=H("canvas");i.width=e.width,i.height=t;var n=i.getContext("2d");return n.drawImage(e,0,0,512,t,0,0,512,t),i._id=e._id,e._free=!0,i},_drawEachText:function(e,t,i,n,a,o,r){var s=t.name,l=t.styleText?t.styleText[0]:t.style,h=l.fontSize,c=l.haloSize||0,d=l.fontRgba?"rgba("+l.fontRgba.join(",")+")":l.color,u=l.haloRgba?"rgba("+l.haloRgba.join(",")+")":l.strokeColor,f=t.styleId||0;c>2&&(c=2);var p=(this._ratio,[]),m=[],g=0;r&&!r[f]&&(r[f]={});var _=h+2*c,v=_;if(t.containDescendings&&(v+=4),0===c&&(v+=2),t.textOnIcon&&(v=Math.max(v,t.iconSize[1])),f!==i||v>o){if(i=f,e.font=h+"px sans-serif",v>o){var b=v-o;o+=b,a+=b}c>0&&(e.lineWidth=2*c,e.strokeStyle=u),e.fillStyle=d}if("line"===t.type){for(var y=s.split(""),x=0;x<y.length;x++){var w,M,T=y[x];if(r[f][T]){var L=r[f][T];w=L.displaySize,M=L.curWordPosition}else{var C=Math.ceil(e.measureText(T).width);n+C>512&&(n=0,a+=v,o=v);var P=n;c>0&&(C+=c,P-=Math.round(c/2),e.strokeText(T,n,a)),e.fillText(T,n,a);var A=[C,v];w=[Math.round(A[0]/2),Math.round(A[1]/2)],M=[P,a-v],r[f][T]={displaySize:w,curWordPosition:M,totalHeight:g},n+=C+2}p.push(w),m.push(M)}g=Math.round(p[0][1])}else if(r[f][s]){var L=r[f][s];p=L.textSize,m=L.labelImagePosition,g=L.totalHeight}else{var S=s.split("\\");if(S.length>1&&t.textOnIcon){for(var I=0,D=0,z=[],k=8,x=0;x<S.length;x++){var s=S[x],E=Math.ceil(e.measureText(s).width);E>I&&(I=E),z.push(Math.round(E/2)),D+=v}var O=I+2*k,B=D+2*k;n+O>512&&(n=0,a+=o),a+=D-v+2*k;var R=n,N=a-B,Z=Math.round(O/2),H=this._iconCache[t.icon].image;this.drawStretchedIcon(e,H,[R,N],k,I,D);for(var x=0;x<S.length;x++){var s=S[x],W=R+(Z-z[x]),X=N+4+(x+1)*v;e.fillText(s,W,X)}p.push([Math.round(O/2),Math.round(B/2)]),m.push([R,N]),n+=O,o=B,g=Math.round(B/2)}else for(var x=0;x<S.length;x++){var s=S[x],E=Math.ceil(e.measureText(s).width),O=E,F=0;if(t.textOnIcon&&(F=10,O+=2*F,519===t.styleId&&(O=t.iconSize[0],F=Math.round((O-E)/2))),n+O>512&&(n=0,a+=v,o=v),a>this._drawingCanvasHeight)return{curX:n,curY:a,curLineHeight:o,styleId:f};var R=n,N=a-v,U=n,Y=a;if(t.containDescendings&&(Y-=4),t.textOnIcon){var H=this._iconCache[t.icon].image,G=t.iconSize;519===t.styleId?e.drawImage(H,0,0,G[0],G[1],R,N,G[0],G[1]):this.draw3StretchedIcon(e,H,[R,N],F,E,G[1]),U+=F,t.iconSize[1]>_&&(Y-=(t.iconSize[1]-_)/2-1),O+=1}c>0&&(O+=c,R-=Math.round(c/2),e.strokeText(s,U,Y)),e.fillText(s,U,Y);var V=[O,v],w=[Math.round(V[0]/2),Math.round(V[1]/2)];p.push(w),m.push([R,N]),g+=Math.round(w[1]),n+=O}r[f][s]={textSize:p,labelImagePosition:m,totalHeight:g}}return t.textSize=p,t.labelImagePosition=m,t.totalHeight=g,{curX:n,curY:a,curLineHeight:o,styleId:f}},drawStretchedIcon:function(e,t,i,n,a,o){var r=i[0],s=i[1];e.drawImage(t,0,0,n,n,r,s,n,n),e.drawImage(t,n,0,1,n,r+n,s,a,n),e.drawImage(t,t.width-n,0,n,n,r+a+n,s,n,n),e.drawImage(t,0,n,n,1,r,s+n,n,o),e.drawImage(t,n,n,1,1,r+n,s+n,a,o),e.drawImage(t,t.width-n,n,n,1,r+a+n,s+n,n,o),e.drawImage(t,0,t.height-n,n,n,r,s+o+n,n,n),e.drawImage(t,n,t.height-n,1,n,r+n,s+o+n,a,n),e.drawImage(t,t.width-n,t.height-n,n,n,r+a+n,s+o+n,n,n)},draw3StretchedIcon:function(e,t,i,n,a){var o=i[0],r=i[1];e.drawImage(t,0,0,n,t.height,o,r,n,t.height),e.drawImage(t,n,0,1,t.height,o+n,r,a,t.height),e.drawImage(t,t.width-n,0,n,t.height,o+n+a,r,n,t.height)},_updateFixedLabelCoords:function(e,t){if(0!==t){var i=[],n=[],a=(this._ratio,0),o=e.totalHeight,r=e.textSize.length,s=e.direction;"number"!=typeof s&&(s=0);for(var l=0;r>l;l++){var h=e.labelImagePosition[l],c=e.textSize[l],d=h[0],u=h[1],f=c[0],p=c[1],m=0,g=0;"number"==typeof e.textMargin&&(g=e.textMargin);var _,v,b=0,y=0;switch(e.iconPos?(b=e.iconPos.width,y=e.iconPos.height):e.custom||(s=cq),s){case eP:var x=o/2-p+m*(r-1)/2;_=Math.round(-b/2-f-g),v=Math.round(x-a-m*l);break;case e2:var x=o/2-p+m*(r-1)/2;_=Math.round(b/2+g),v=Math.round(x-a-m*l);break;case dn:var x=y/2+o-p+m*r;_=Math.round(-f/2),v=Math.round(x-a-m*l);break;case cs:var x=-y/2-m-p;_=Math.round(-f/2),v=Math.round(x-a-m*l);break;case cq:var x=-o/2-m*(r-1)/2;_=Math.round(-f/2),v=Math.round(x-a-m*l)}a+=p;var w=_+f,M=v,T=w,L=M+p,C=_,P=L;i.push(_,v,w,M,T,L,_,v,T,L,C,P);var A=d/512,S=(t-u-2*p)/t,I=(d+2*f)/512,D=S,z=I,k=(t-u)/t,E=A,O=k;n.push(A,S,I,D,z,k,A,S,z,k,E,O)}e.textPos||(e.textPos={}),e.textPos.vertex=i,e.textPos.texcoord=n}},_addFixedLabelBounds:function(e){var t=1e3,i=1e3,n=-1e3,a=-1e3;if(e.iconPos)for(var o=e.iconPos.vertex,r=0,s=o.length;s>r;r+=2){var l=o[r],h=o[r+1];t>l&&(t=l),l>n&&(n=l),i>h&&(i=h),h>a&&(a=h)}if(e.custom&&e.style.iconSize&&!e.name){var c=e.style.iconSize,d=e.direction;switch(d){case cq:t=-Math.round(c[0]/2),i=-Math.round(c[1]/2),n=Math.round(c[0]/2),a=Math.round(c[1]/2);break;case dn:t=-Math.round(c[0]/2),i=0,n=Math.round(c[0]/2),a=c[1]}}if(e.textPos)for(var u=e.textPos.vertex,r=0,s=u.length;s>r;r+=2){var l=u[r],h=u[r+1];t>l&&(t=l),l>n&&(n=l),i>h&&(i=h),h>a&&(a=h)}e.bds=[t,i,n,a]},_updateLineLabelCoords:function(e,t){if(0!==t){var i=e.wordsInfo,n=e.wordCount,a=(this._ratio,e.labelImagePosition.slice(0));e.reverse&&a.reverse();for(var o=1e3,r=1e3,s=-1e3,l=-1e3,h=0;n>h;h++){var c=a[h],d=c[0],u=c[1],f=e.textSize[h],p=f[0],m=f[1],g=d/512,_=(t-u-2*m)/t,v=(d+2*p)/512,b=_,y=v,x=(t-u)/t,w=g,M=x;i[h].size=[p,m],i[h].texcoord=[g,_,v,b,y,x,g,_,y,x,w,M];var T=i[h].offset[0],L=i[h].offset[1],C=T-p/2,P=L+m/2,A=L-m/2,S=T+p/2;o>C&&(o=C),S>s&&(s=S),r>A&&(r=A),P>l&&(l=P)}e.bds=[o,r,s,l]}}});var bB={0:"00000000",16:"00010000",32:"00100000",48:"00110000",64:"01000000",96:"01100000"};x.extend(bW.prototype,{bind:function(){function e(){i._refreshSpotData()}var t=this.map,i=this;t.addEventListener("mapstatusbusy_inner",function(){i._useRound=!1,i._mapIsMoving=!0}),t.addEventListener("mapstatusidle_inner",function(){i._useRound=!0,i._mapIsMoving=!1}),t.addEventListener("onspotmouseover",function(e){if(this.temp.isPermitSpotOver&&e.spots.length>0){var t=e.spots[0].userdata.uid,n=e.spots[0].userdata.tilePosStr,a=i.getLabelByUid(t,n);a&&a.formatedData&&i._toHighlightColor(a.formatedData)}}),t.addEventListener("onspotmouseout",function(e){if(this.temp.isPermitSpotOver&&e.spots.length>0){var t=e.spots[0].userdata.uid,n=e.spots[0].userdata.tilePosStr,a=i.getLabelByUid(t,n);a&&a.formatedData&&i._toDefaultColor(a.formatedData)}}),t.addEventListener("spotclick",function(e){if(e.spots&&e.spots.length>0){if(e.spots[0].userdata.zoom<10)return;var t=e.spots[0].userdata.uid,n=e.spots[0].userdata.tilePosStr;!i.currentSelectedLabel||i.currentSelectedLabel.uid===t&&i.currentSelectedLabel.tilePosStr===n||i._recoverNormalState();var a=i.getLabelByUid(t,n);a&&i._changeBaseMapState(a)}else i._recoverNormalState()}),t.on("spot_status_reset",function(){i._recoverNormalState()}),t.on("spot_highlight",function(e){var t=i.getLabelByUid(e.uid,e.tilePosStr);t&&t.formatedData&&i._toHighlightColor(t.formatedData)}),t.addEventListener("mousemove",function(){i.curSpotAdded||this.currentOperation===co.idle&&i._mapIsMoving!==!0&&(i._refreshSpotData(),this.temp.isPermitSpotOver=!0,i.curSpotAdded=!0)}),dX()&&t.addEventListener("mapstatusidle_inner",e)},getLabelByUid:function(e,t){for(var i=aA.getResult().tileLabels,n=0;n<i.length;n++){for(var a=i[n].fixedLabel,o=0;o<a.length;o++)if(i[n].fixedLabel[o].guid===e&&i[n].fixedLabel[o].tilePosStr===t)return i[n].fixedLabel[o];for(var r=i[n].indoorLabel,o=0;o<r.length;o++)if(i[n].indoorLabel[o].guid===e&&i[n].indoorLabel[o].tilePosStr===t)return i[n].indoorLabel[o]}return null},getTileByLabelUid:function(e){for(var t=aA.getResult().tileLabels,i=0;i<t.length;i++){for(var n=t[i].fixedLabel,a=0;a<n.length;a++)if(t[i].fixedLabel[a].guid===e)return t[i];for(var o=t[i].indoorLabel,a=0;a<o.length;a++)if(t[i].indoorLabel[a].guid===e)return t[i]}return null},_toHighlightColor:function(e){if(!e.tempRank||e.tempRank!==this.RANK5){for(var t=aA.getResult().eleData[4]||[],i=!1,n=0;n<t.length;n++)if(t[n]===e||t[n].guid===e.guid&&t[n].tilePosStr===e.tilePosStr&&t[n].zoom===e.zoom){i=!0;break}i||(t.push(e),aA.setOverlayData(t,4),this.map.dispatchEvent(new az("onrefresh")))}},_toDefaultColor:function(e){if(!e.tempRank||e.tempRank!==this.RANK5){for(var t=aA.getResult().eleData[4]||[],i=0;i<t.length;i++)if(e===t[i]||e.guid===t[i].guid&&e.tilePosStr===t[i].tilePosStr&&e.zoom===t[i].zoom){t.splice(i,1);break}aA.setOverlayData(t,4),this.map.dispatchEvent(new az("onrefresh"))}},_changeBaseMapState:function(e){var t=e.guid,i=e.formatedData.guidExt,n={guid:t,tilePosStr:e.tilePosStr,guidExt:i};this._strategyInfo=n,this.currentSelectedLabel=e;var a=aA.getLabelData();a=this.collisionTest(a),this.updateLabels(a);var o=this.fixDataFormat(a);aA.setOverlayData(o[0],2),aA.setOverlayData(o[1],3),aA.setOverlayData(o[2],4);var r=this.getTileByLabelUid(t);this.currentSelectedLabel.tileInfo=r.tileInfo;var s=(r.tileInfo.zoom,this.layer.tileCache.getAllData());for(var l in s){var h=s[l].data;h.label&&this.clearCollisionCache(h.label)}this.map.dispatchEvent(new az("onrefresh"))},_recoverNormalState:function(){this._strategyInfo=null;var e=!1,t=aA.getLabelData();if(this.currentSelectedLabel){var i=this.currentSelectedLabel.guid;this.clearCollisionCache(this.getTileByLabelUid(i));var n=this.layer.tileCache.getAllData();for(var a in n){var o=n[a].data;o.label&&this.clearCollisionCache(o.label)}this.currentSelectedLabel.tempRank=null,this.currentSelectedLabel=null,e=!0}t=this.collisionTest(t),this.updateLabels(t);var r=this.fixDataFormat(t);aA.setOverlayData(r[0],2),aA.setOverlayData(r[1],3),aA.setOverlayData([],4),this.map.dispatchEvent(new az("onrefresh")),e&&(this.curSpotAdded=!1,this._refreshSpotData())},loadIconImages:function(e,t){for(var i=e.label,n=i.fixedLabel,a=i.indoorLabel,o=n.length+a.length,r=this,s=0,l=200,h=0;o>h;h++){var c;if(c=h<n.length?n[h]:a[h-n.length],c.iconPos){var d=c.iconPos.iconType;if(s++,this.iconCache[d])this.iconCache[d].loaded&&t(e);else{var u=new Image;u.id=d,u.crossOrigin="anonymous",u.onload=function(){r.iconCache[this.id].loaded=!0,r._addToIconTexture(this),null===r._iconLoadTimer&&(r._iconLoadTimer=setTimeout(function(){t(),r._iconLoadTimer=null},l)),this.onload=null},u.onerror=function(){r._iconLoadTimer||(r._iconLoadTimer=setTimeout(function(){t(),r._iconLoadTimer=null},l)),r.iconCache[this.id]=null,this.onerror=null};var f=df.iconSetPath+d+".png";u.src=f,this.iconCache[d]={loaded:!1,image:u}}}}return s},_addToIconTexture:function(e){if(this.map._webglMapScene){var t=this.map._webglMapScene._painter,i=t._iconTextureAtlas.addTexture(e);t._iconTextureAtlasOffset[e.id]=i;var n=0*e.width/1024+i.width,a=0*e.height/1024+i.height,o=e.width/1024+i.width,r=a,s=o,l=e.height/1024+i.height,h=n,c=l;t._iconTextureAtlasCoords[e.id]=[n,a,o,r,s,l,n,a,s,l,h,c]}},loadImgByStr:function(e,t,i){if(!e&&!t)return void(i&&i(null));var n=0,a=null,o=null;e&&(n++,a=new Image,a.onload=function(){n--,0===n&&i&&i(this,o),this.onload=null},a.src=e),t&&(n++,o=new Image,o.onload=function(){n--,0===n&&i&&i(a,this),this.onload=null},o.src=t)},collisionTest:function(e,t,i){if(!e)return[];var n=this.map,a=n.getHeading();a=this.calcLoopHeading(a);var o=n.height,r=this.allLabels;r.length=0,e.sort(function(e,t){var i=e.tileInfo,n=t.tileInfo;return i.col*i.row<n.col*n.row?-1:1});var s,l=(e.labelZoom,n.getTilt()),h=n.getZoom();s=i?i:this.getZoomStep();for(var c=0,d=e.length;d>c;c++){var u=e[c],f=u.tileInfo,p=f.zoom,m=f.loopOffsetX/Math.pow(2,18-p);if(a||l||!u.unnecessaryCollisionTest||!u.unnecessaryCollisionTest[i]){for(var g=u.fixedLabel||[],_=0,v=g.length;v>_;_++){var b=g[_];b.zoom=p,-1===t&&b.isDel||(bm(b,f.useZoom,h)?(this.calcCollisionBounds(b,s,m,o),r.push(b)):b.isDel=!0)}for(var y=u.indoorLabel||[],_=0,v=y.length;v>_;_++){var b=y[_];b.zoom=p,-1===t&&b.isDel||(bm(b,f.useZoom)?(this.calcCollisionBounds(b,s,m,o),r.push(b)):b.isDel=!0)}for(var x=u.lineLabel||[],_=0,v=x.length;v>_;_++){var b=x[_];if(-1!==t||!b.isDel)if(bm(b,f.useZoom)){var w=b.pt,M=n.pointToPixel(w,{zoom:s,useRound:this._useRound}),T=M.x+m,L=o-M.y,C=b.bds,P=C[0],A=C[1],S=C[2],I=C[3],D=P,z=A,k=S,E=I;a>=0&&45>a||a>=315&&360>a?(D=P,z=A,k=S,E=I):a>=45&&135>a?(D=A,z=-S,k=I,E=-P):a>=135&&225>a?(D=-S,z=-I,k=-P,E=-A):a>=225&&315>a&&(D=-I,z=P,k=-A,E=S),b._tempBds=[T+D,L+z,T+k,L+E],r.push(b)}else b.isDel=!0}}}var O=this._strategyInfo;if(O){for(var B=O.guid,R=O.guidExt,N=!1,c=0,d=r.length;d>c;c++){var Z=r[c];delete Z.tempRank,this.layer.isClickableLabel(Z)&&(1!==R||Z.guidExt)&&B===Z.guid&&O.tilePosStr===Z.tilePosStr&&(Z.tempRank=this.RANK5,N=!0)}if(!N&&this.currentSelectedLabel){this.currentSelectedLabel.tempRank=this.RANK5;var f=this.currentSelectedLabel.tileInfo,p=f.zoom,m=f.loopOffsetX/Math.pow(2,18-p);this.calcCollisionBounds(this.currentSelectedLabel,s,m,o),r.push(this.currentSelectedLabel)}}else for(var c=0,d=r.length;d>c;c++){var Z=r[c];"line"!==Z.type&&Z.iconPos&&delete Z.tempRank}r.sort(function(e,t){var i=e.tempRank?e.tempRank:e.rank,n=t.tempRank?t.tempRank:t.rank;return n-i||e.startZoom-t.startZoom||t.pt.lng-e.pt.lng||t.pt.lat-e.pt.lat});var H=0;l>0&&(H=6);var h=n.getZoom();h>=8&&9>h&&(H=8.5>h?6:3);var W=2;6>h&&h>=5&&(W=-1);for(var c=0,d=r.length;d>c;c++){var X=r[c],F=X._tempBds;for(X.isDel=!1,X._intersectIdx=[],_=c+1;d>_;_++){var U=r[_],Y=U._tempBds;F[2]+H+W<Y[0]-H||F[0]-H>Y[2]+H+W||F[3]+H+W<Y[1]-H||F[1]-H>Y[3]+H+W||X._intersectIdx.push(_)}}for(var c=0,d=r.length;d>c;c++){var Z=r[c];if(Z.isDel===!1)for(var G=Z._intersectIdx,_=0,v=G.length;v>_;_++)r[G[_]].isDel=!0}return e},calcCollisionBounds:function(e,t,i,n){var a=e.pt,o=this.map,r=o.pointToPixel(a,{zoom:t,useRound:this._useRound}),s=r.x+i,l=n-r.y,h=e.bds;e._tempBds=[s+h[0],l+h[1],s+h[2],l+h[3]]},getZoomStep:function(){var e=this.map.getZoom(),t=Math.floor(e),i=e-t>=.5?t+.5:t;return i},clearCollisionCache:function(e){e&&(e.cacheState=null,e.unnecessaryCollisionTest=null)},getCachedLabels:function(e){e=e||[];for(var t=this.getZoomStep(),i=!1,n=0;n<e.length;n++){var a=e[n];if(!a.cacheState||!a.cacheState[t]){i=!0;break}if(a.hasNewData){i=!0;break}}return i&&this.cacheLabelResult(e),e},cacheLabelResult:function(e){var t,i,n=this.getZoomStep(),a={};e=this.collisionTest(e,void 0,n);for(var o=0;o<e.length;o++){t=e[o],i=t.tileInfo;var r=i.col+","+i.row;a[r]=1}for(var s={},o=0;o<e.length;o++){t=e[o],t.cacheState||(t.cacheState={}),i=t.tileInfo;var l=i.col,h=i.row;if(r=l+","+h,"stable"!==t.cacheState[n]||(s[r]=1,t.hasNewData)){for(var c=0;c<t.fixedLabel.length;c++){var d=t.fixedLabel[c];d.cachedIsDel||(d.cachedIsDel={}),d.cachedIsDel[n]=d.isDel}for(var c=0;c<t.indoorLabel.length;c++){var d=t.indoorLabel[c];d.cachedIsDel||(d.cachedIsDel={}),d.cachedIsDel[n]=d.isDel}for(var c=0;c<t.lineLabel.length;c++){var d=t.lineLabel[c];d.cachedIsDel||(d.cachedIsDel={}),d.cachedIsDel[n]=d.isDel}a[l-1+","+(h-1)]&&a[l-1+","+h]&&a[l-1+","+(h+1)]&&a[l+","+(h-1)]&&a[l+","+(h+1)]&&a[l+1+","+(h-1)]&&a[l+1+","+h]&&a[l+1+","+(h+1)]?(t.cacheState[n]="stable",s[r]=1):t.cacheState[n]||(t.cacheState[n]="unstable")}}for(var o=0;o<e.length;o++){var t=e[o];i=t.tileInfo;var r=i.col+","+i.row,l=+i.col,h=+i.row;s[l-1+","+(h-1)]&&s[l-1+","+h]&&s[l-1+","+(h+1)]&&s[l+","+(h-1)]&&s[l+","+(h+1)]&&s[l+1+","+(h-1)]&&s[l+1+","+h]&&s[l+1+","+(h+1)]&&(t.unnecessaryCollisionTest||(t.unnecessaryCollisionTest={}),t.unnecessaryCollisionTest[n]=1)}e.hasNewData=!1},updateLabels:function(e){var t=this.map,i=t.getZoom(),n=t.getHeading();n=this.calcLoopHeading(n);for(var a=t.getTilt(),o=this.getZoomStep(),r=0,s=e.length;s>r;r++){var l=e[r],h=l.tileInfo,c=h.loopOffsetX||0;this.updateFixedLabel(l.fixedLabel,a,n,l,o,i,c),this.updateFixedLabel(l.indoorLabel,a,n,l,o,i,0),this.updateLineLabel(l.lineLabel,a,n,l,o)}},updateFixedLabel:function(e,t,i,n,a,o,r){1===e.length;for(var s=0,l=e.length;l>s;s++){var h=e[s];if(h.cachedIsDel&&(!t&&!i&&n.cacheState&&n.cacheState[a]&&(h.isDel=h.cachedIsDel[a]),h.startScale>o&&(h.isDel=!0),!h.isDel)){var c=h.pt,d=h.iconPos;if(d&&d.texcoord&&!d.rtVertex){d.rtVertex=[];var u=d.vertex,f=ab(c.lng),p=ab(c.lat);d.rtVertex=[f[0],p[0],f[1],p[1],0,u[0],u[1],0,0,d.texcoord[0],d.texcoord[1],f[0],p[0],f[1],p[1],0,u[2],u[3],0,0,d.texcoord[2],d.texcoord[3],f[0],p[0],f[1],p[1],0,u[4],u[5],0,0,d.texcoord[4],d.texcoord[5],f[0],p[0],f[1],p[1],0,u[6],u[7],0,0,d.texcoord[6],d.texcoord[7],f[0],p[0],f[1],p[1],0,u[8],u[9],0,0,d.texcoord[8],d.texcoord[9],f[0],p[0],f[1],p[1],0,u[10],u[11],0,0,d.texcoord[10],d.texcoord[11]]}var m=h.textPos;if(m&&!m.rtVertex){m.rtVertex=[];for(var u=m.vertex,g=m.rtVertex,f=ab(c.lng),p=ab(c.lat),_=ab(r),v=0,b=u.length;b>v;v+=12)g.push(f[0],p[0],f[1],p[1],0,u[v],u[v+1],_[0],_[1],m.texcoord[0],m.texcoord[1]),g.push(f[0],p[0],f[1],p[1],0,u[v+2],u[v+3],_[0],_[1],m.texcoord[2],m.texcoord[3]),g.push(f[0],p[0],f[1],p[1],0,u[v+4],u[v+5],_[0],_[1],m.texcoord[4],m.texcoord[5]),g.push(f[0],p[0],f[1],p[1],0,u[v+6],u[v+7],_[0],_[1],m.texcoord[6],m.texcoord[7]),g.push(f[0],p[0],f[1],p[1],0,u[v+8],u[v+9],_[0],_[1],m.texcoord[8],m.texcoord[9]),g.push(f[0],p[0],f[1],p[1],0,u[v+10],u[v+11],_[0],_[1],m.texcoord[10],m.texcoord[11])}}}},updateLineLabel:function(e,t,i,n,a){e=e||[];for(var o=this.map,r=o.getZoomUnits(),s=(vec2.create(),0),l=e.length;l>s;s++){var h=e[s];if(h.cachedIsDel&&(!t&&!i&&n.cacheState&&n.cacheState[a]&&(h.isDel=h.cachedIsDel[a]),!h.isDel)){var c=h.mcInTile,d=c.x,u=c.y,f=h.wordsInfo,p=h.labelAngle,m=!1,g=0;if(0!==i){{var _=f[0].angle,v=this.calcLoopHeading(_-i);this.calcLoopHeading(p-i)}v>45&&315>v&&(v>45&&135>=v?g=270:v>135&&225>=v?g=180:v>225&&315>v&&(g=90),p>225&&315>=p&&180>=g?m=!0:(p>=0&&45>=p||p>=315&&360>p)&&g>=180&&(m=!0))}for(var b=0,y=f.length;y>b;b++){var x=f[b],w=x.calcInfo,M=x.offset[0],T=x.offset[1],L=x.size[0],C=x.size[1],P=x.angle;if(w||(w={}),i!==w.mapHeading||r!==w.zoomUnits){if(w.mapHeading=i,w.zoomUnits=r,m){var A=f[y-1-b];M=A.offset[0],T=A.offset[1],P=A.angle}var S=d+M*r,I=u+T*r;w.rotationCenter={lng:S,lat:I},w.calcHeading=g,w.angle=P,w.offsetX=M,w.offsetY=T,x.calcInfo=w}x.rtVertex||(x.rtVertex=[]),x.rtVertex.length=0;var D=w.calcHeading+w.angle,z=w.rotationCenter;M=w.offsetX,T=w.offsetY;var k=Math.round(M-L/2),E=Math.round(M+L/2),O=Math.round(T+C/2),B=Math.round(T-C/2);x.rtVertex.push(d,u,x.z,k,B,z.lng,z.lat,D,x.texcoord[0],x.texcoord[1],d,u,x.z,E,B,z.lng,z.lat,D,x.texcoord[2],x.texcoord[3],d,u,x.z,E,O,z.lng,z.lat,D,x.texcoord[4],x.texcoord[5],d,u,x.z,k,B,z.lng,z.lat,D,x.texcoord[6],x.texcoord[7],d,u,x.z,E,O,z.lng,z.lat,D,x.texcoord[8],x.texcoord[9],d,u,x.z,k,O,z.lng,z.lat,D,x.texcoord[10],x.texcoord[11])}}}},calcLoopHeading:function(e){for(;e>=360;)e-=360;for(;0>e;)e+=360;return e},fixDataFormat:function(e){var t,i=this.fixedLabelData,n=this.lineLabelData,a=this.highlightLabelData,o=0,r=0,s=0;if(this.currentSelectedLabel){var l=this.getLabelByUid(this.currentSelectedLabel.guid,this.currentSelectedLabel.tilePosStr);(!l||l.isDel)&&(i[o]=this.currentSelectedLabel.formatedData,o++,a[s]=this.currentSelectedLabel.formatedData,s++)}for(var h=0;h<e.length;h++){var c=e[h],d=c.fixedLabel,u=c.indoorLabel,f=c.lineLabel;t=this.fixFixedLabelDataFormat(d,c,i,o,a,s),o=t[0],s=t[1],t=this.fixFixedLabelDataFormat(u,c,i,o,a,s,!0),o=t[0],s=t[1],n[r]={tileInfo:c.tileInfo,lineLabels:[]};for(var p=0;p<f.length;p++)if(!f[p].isDel){var m=f[p].wordsInfo;if(m)for(var g=0;g<m.length;g++)if(m[g].rtVertex){var _=m[g].formatedData;_||(_={textureSource:c.textureSources[f[p].processedInZoom],textureHeight:c.textureHeights[f[p].processedInZoom],renderData:{vertex:m[g].rtVertex,textureCoord:m[g].texcoord}},m[g].formatedData=_),n[r].lineLabels.push(_)}}r++}return i.length=o,n.length=r,a.length=s,[n,i,a]},fixFixedLabelDataFormat:function(e,t,i,n,a,o,r){for(var s=0;s<e.length;s++)if(!e[s].isDel){var l=e[s].textPos,h=e[s].iconPos,c=null;l&&l.rtVertex&&(e[s].formatedData?(c=e[s].formatedData,c.tempRank=e[s].tempRank):(c={guid:e[s].guid,guidExt:e[s].guidExt,tilePosStr:e[s].tilePosStr,zoom:e[s].zoom,tempRank:e[s].tempRank,textureSource:t.textureSources[e[s].processedInZoom],textureHeight:t.textureHeights[e[s].processedInZoom],renderData:{vertex:l.rtVertex,textureCoord:l.texcoord}},r&&e[s].onDefaultFloor===!1&&(c.textureSource=t.indoorTextureSources[e[s].processedInZoom],c.textureHeight=t.indoorTextureHeights[e[s].processedInZoom]),e[s].formatedData=c),this.currentSelectedLabel&&c.guid===this.currentSelectedLabel.guid&&c.tilePosStr===this.currentSelectedLabel.tilePosStr&&(a[o]=c,o++)),h&&h.rtVertex&&(c?c.iconRenderData||(c.iconRenderData={vertex:h.rtVertex,textureCoord:h.texcoord}):(c={guid:e[s].guid,guidExt:e[s].guidExt,zoom:e[s].zoom,tempRank:e[s].tempRank,iconRenderData:{vertex:h.rtVertex,textureCoord:h.texcoord}},e[s].formatedData=c)),i[n]=c,n++}return[n,o]},_refreshSpotData:function(){this._spotData.length=0;var e=this.map,t=Math.floor(e.getZoom()),i=aA.getLabelData();if(i)for(var n=0,a=i.length;a>n;n++)this._addFixedSpotData(i[n].fixedLabel,t),this._addFixedSpotData(i[n].indoorLabel,t);var o=this.currentSelectedLabel;o&&!this.getTileByLabelUid(o.guid,o.tilePosStr)&&this._spotData.push(this._getSpotDataFromLabel(this.currentSelectedLabel));var r=new az("onspotsdataready");r.spots=this._spotData,e._spotDataOnCanvas=this._spotData,e.dispatchEvent(r)},_addFixedSpotData:function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(this.layer.isClickableLabel(n)&&!(1===n.guidExt&&n.startScale>t)){var a=e[i].spot||this._getSpotDataFromLabel(e[i]);this._spotData.push(a)}}},_getSpotDataFromLabel:function(e){var t=this.map,i=e.bds.slice(0),n=null;e.iconPos&&(n=new eR(e.pt.lng,e.pt.lat));var a=e.name?e.name.replace("\\\\","<br>"):"";e.iconPos&&e.iconPos.iconType.indexOf("ditie")>-1&&t.getZoom()>14&&(a="");var o={n:a,pt:new eR(e.pt.lng,e.pt.lat),userdata:{iconPoint:n,uid:e.guid,name:a,type:e.iconPos?e.iconPos.iconType:"",rank:e.rank,zoom:e.zoom,tilePosStr:e.tilePosStr},bd:i,tag:"MAP_SPOT_INFO"};return e.spot=o,o},drawLabelsOnCanvas:function(e,t){this._labelTextCanvas.drawLabelsOnCanvas(e,t)}}),dO.prototype.init=function(){function e(){i.updateLabels()}var t=this._map,i=this;t.addEventListener("add_tile_labels",e),t.addEventListener("onremove_tile_labels",e),t.addEventListener("onclear_labels",e)},dO.prototype.updateLabels=function(){var e=this._map.tileMgr.getLabelTextCanvas(),t=this._map,i=this;e.drawCustomLabelsOnCanvas(t._customTileLabels,function(e){var n=i.virtualTile;e&&(n.label.textureHeights[0]=[e.height]),n.label.fixedLabel=t._customTileLabels;var a=new az("oncustom_labels_ready");a.virtualTile=n,a.labelCanvas=e,a.imgKey=eM.getGUID("custom_labels_"),t.dispatchEvent(a)})},eM.register(function(e){e._customLabelMgr=new dO(e)});var ao={dataProcessPool:[],init:function(e){var t=this;this.map=e,this.arrPendingData=[];var i=navigator.hardwareConcurrency||4;dX()&&i>2&&(i=2),this.arrWorker=[],this.ratio=aw(),this.wordSpaceRatio=this.ratio,this.textSizeRatio=this.ratio>1?2:1,bH.canUseWebAssembly(function(n){var a;a=n?(BMap.Utils.inMapHost?"":"https://map.baidu.com")+"/res/newui/worker_wasm_11lsox.js":(BMap.Utils.inMapHost?"":"https://map.baidu.com")+"/res/newui/worker_asm_qd15ln.js";for(var o=0;i>o;o++){var r=cZ(a);r.onmessage=function(i){if(i.data?this._cbk&&this._cbk(i.data,this._parsingTileKey):this._cbk&&this._cbk(null,this._parsingTileKey),this._isBusy=!1,this._cbk=null,this._parsingTileInfo=null,this._parsingTileKey=null,t.arrPendingData.length>0){var n=t.arrPendingData.shift(),a=n.cbk;t.loadTileData(n.url,n.tileInfo,n.tileKey,a)}var o=new az("onrefresh");o.source="workermgr",e.fire(o)},t.arrWorker.push(r)}})},getIdleWorker:function(){for(var e=0,t=this.arrWorker.length;t>e;e++){var i=this.arrWorker[e];if(!i._isBusy)return i._isBusy=!0,i}return null},releasePendingData:function(e){for(var t=[],i=this.arrPendingData,n=i.length-1;n>=0;n--){var a=i[n],o=a.tileInfo;if(e.tileTypeName===o.tileTypeName){var r="id_"+o.col+"_"+o.row+"_"+o.zoom;e[r]||(i.splice(n,1),t.push(o))}}return t},loadTileData:function(e,t,i,n){var a=this.getIdleWorker();if(a){a._cbk=n,a._parsingTileInfo=t,a._parsingTileKey=i;var o={action:"loadTileData",url:e,tileInfo:t,tileKey:i};a.isSendFS||(WorkerMgr.stringifiedFeatureStyle||(WorkerMgr.stringifiedFeatureStyle=JSON.stringify(FeatureStyle)),WorkerMgr.stringifiedIconSetInfo||(WorkerMgr.stringifiedIconSetInfo=JSON.stringify(iconSetInfo_high)),WorkerMgr.stringifiedIndoorStyle||(WorkerMgr.stringifiedIndoorStyle=JSON.stringify(indoorStyle)),o.featureStyle=WorkerMgr.stringifiedFeatureStyle,o.iconSetInfo=WorkerMgr.stringifiedIconSetInfo,o.indoorStyle=WorkerMgr.stringifiedIndoorStyle,o.iconInfo={wordSpaceRatio:this.wordSpaceRatio,textSizeRatio:this.textSizeRatio},a.isSendFS=!0),a.postMessage(o)}else{var r={url:e,tileInfo:t,tileKey:i,cbk:n};this.arrPendingData.push(r)}},collideTest:function(){}};window.WorkerMgr=ao,eM.register(function(e){if("webgl"===e._renderType){var t=e.tileMgr=new cn(e);e.addEventListener("addtilelayer",function(e){t.addWebGLLayer(e.target)}),e.addEventListener("removetilelayer",function(e){t.removeWebGLLayer(e.target)}),e.on("update",function(e){window.FeatureStyle&&t.loadLayersData({zoomChanged:e.changedStatus.onzoom_changed?!0:!1})})}}),x.extend(cn.prototype,{addWebGLLayer:function(e){if(this.tileLayers.push(e),e.initDrawData(),this.tileLayers.length>1)for(var t=1;t<this.tileLayers.length;t++)if(this.tileLayers[t].isFlat){this.map.setDisplayOptions({isFlat:!0});break}if(window.FeatureStyle)this.loadLayersData();else{var i=this;eL.load(df.getMapStyleFiles(),function(){i.loadLayersData()})}},removeWebGLLayer:function(e){for(var t=!1,i=0,n=this.tileLayers.length;n>i;i++)if(e===this.tileLayers[i]){t=!0,this.tileLayers.splice(i,1);break}if(t!==!1){if(e.destroyDrawData(),window.FeatureStyle&&this.loadLayersData(),1===this.tileLayers.length)this.map.setDisplayOptions({isFlat:!1});else{for(var a=!1,i=1;i<this.tileLayers.length;i++)if(this.tileLayers[i].isFlat){a=!0;break}this.map.setDisplayOptions({isFlat:a})}var o=new az("onrefresh");o.source="removewebgllayer",this.map.fire(o)}},getLabelTextCanvas:function(){return this._labelTextCanvas||(this._labelTextCanvas=new r),this._labelTextCanvas
},loadLayersData:function(e){if(!this.map.suspendLoad){var t=this;e=e||{};var i=!!e.zoomChanged,n=i===!0||this.map.getTilt()>50;n?this._loadLayersFromCache(i):this.syncLoadTimer||(this.syncLoadTimer=setTimeout(function(){t._loadLayersFromCache(i),t.syncLoadTimer=null},40)),this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){var e=t.tileLayers.length;t.tilesInfoCache={};for(var n=0;e>n;n++){var a=t.tileLayers[n],o=a.tileType,r=null;t.tilesInfoCache[o.getName()]?r=t.tilesInfoCache[o.getName()]:(r=t.calcTilesInfo(o),t.tilesInfoCache[o.getName()]=r),a.loadLayerData(r,!1,i)}t.timer=null},this.loadDelay),this.loadDelay=dX()&&i?200:80}},_loadLayersFromCache:function(e){eM.FeatureMgr.clearData();var t=this.tileLayers;t.sort(function(e,t){return e.zIndex-t.zIndex>0});var i=t.length;this.tilesInfoCache={};for(var n=0;i>n;n++){var a=t[n],o=a.tileType,r=null;this.tilesInfoCache[o.getName()]?r=this.tilesInfoCache[o.getName()]:(r=this.calcTilesInfo(o),this.tilesInfoCache[o.getName()]=r),a.loadLayerData(r,!0,e)}},calcTilesInfo:function(e){var t=this.map,i=t.getMapType(),n=ba[i],a=t.getZoom(),o=Math.floor(a),r=e.getDataZoom(a),s=e.getName();r=dE(r,n.minDataZoom,n.maxDataZoom);var l=o;"web"===e._name&&(l=r);var h,c,d,u,f=e.getTileSize(a),p=e.getBaseTileSize(a),m=(f*Math.pow(2,a-o),e.getMercatorSize(a,r)),g=t.getCenter();i!==BMAP_SATELLITE_MAP&&(g=cu.calcLoopCenterPoint(g));var _=Math.floor(g.lng/m),v=Math.floor(g.lat/m),b=t.getBounds(),y=0,x=0;if(b=cu.calcLoopMapBounds(b),b.maxX>cu._mc180X){var w=cu.getSpaceDistanceInPixel(r);y=Math.ceil(w/p)}if(b.minX<cu._mcM180X){var w=cu.getSpaceDistanceInPixel(r);x=Math.ceil(w/p)}var M=[Math.floor(b.minX/m)-x,Math.floor(b.minY/m)],T=[Math.floor(b.maxX/m)+y,Math.floor(b.maxY/m)];h=M[0],c=T[0]+1,d=M[1],u=T[1]+1;for(var L=[],C=h;c>C;C++)if(cu.isTileBlank(C,r,p)!==!0)for(var P=d;u>P;P++){var A={col:C,row:P,zoom:r,useZoom:l,tileTypeName:s,loopOffsetX:0,tileSize:f,baseTileSize:p,mercatorSize:m};L.push(A);var S="id_"+C+"_"+P+"_"+r;L[S]=!0}if(i!==BMAP_SATELLITE_MAP&&(L=cu.calcLoopTiles(L,r,p,m)),3===r)for(var I=0,D=L.length;D>I;I++){var C=L[I].col,P=L[I].row,z=cu.calcLoopParam(C,r),k=z.T,E=C>=0?C-k:C+k,O="id_"+E+"_"+P+"_"+r;if(!L[O]){var A={col:E,row:P,zoom:r,useZoom:l,loopOffsetX:0,tileSize:f,baseTileSize:p,mercatorSize:m};L.push(A),L[O]=!0}}if(this.map._tilt>0&&this.map.getZoom()>=5)for(var I=0;I<L.length;I++){var B=L[I],R=B.col,N=B.row,Z=[];Z.minX=R*m,Z.maxX=(R+1)*m,Z.minY=N*m,Z.maxY=(N+1)*m;var H=new eR(0,0);H.lng=(Z.minX+Z.maxX)/2,H.lat=(Z.minY+Z.maxY)/2;var W=t.pointToPixel(H);W.x>0&&W.x<this.map.width&&W.y>0&&W.y<this.map.height||Z.minX<g.lng&&Z.maxX>g.lng&&Z.minY<g.lat&&Z.maxY>g.lat||this.ifTileInMapBounds(Z,b,R,N)||(L.splice(I,1),I--)}return L.sort(function(e){return function(t,i){return.4*Math.abs(t.col-e[0])+.6*Math.abs(t.row-e[1])-(.4*Math.abs(i.col-e[0])+.6*Math.abs(i.row-e[1]))}}([_,v])),L.zoom=r,L.tileTypeName=s,L},getCurrentViewTilesInfo:function(e){var t=this.tilesInfoCache[e.getName()];return t?t:this.calcTilesInfo(e)},ifTileInMapBounds:function(e,t){for(var i=t.pointBottomLeft,n=t.pointTopRight,a=t.pointTopLeft,o=t.pointBottomRight,r=!1,s=new eR(e.minX,e.minY),l=new eR(e.maxX,e.maxY),h=new eR(l.lng,s.lat),c=new eR(s.lng,l.lat),d=[c,l,h,s],u=0,f=d.length;f>u;u++){var p=u+1;p===f&&(p=0);var m=u,g=ej(d[p],d[m],a,i);if(g){r=!0;break}if(g=ej(d[p],d[m],o,n)){r=!0;break}if(g=ej(d[p],d[m],n,a)){r=!0;break}if(g=ej(d[p],d[m],i,o)){r=!0;break}}return r},getTileLayer:function(e){for(var t=0,i=this.tileLayers.length;i>t;t++){var n=this.tileLayers[t];if(n.mapType===e)return n}return null}}),am.prototype._init=function(e){var t=this;e.on("indoor_status_changed",function(i){var n=i.uid,a=i.floor;if(null===n)n=t.currentUid,t._indoorData[n]&&(a=t._indoorData[n].defaultFloor),t._indoorControl&&t._indoorControl.hide(),t.currentUid=null,t.currentFloor=null,t.enterMethod=null;else if(t._indoorData[n]){var o=t._indoorData[n];a="number"==typeof a?a:o.defaultFloor,t._indoorControl?(t._indoorControl.setInfo(o),t._indoorControl.show()):t._indoorControl=new ek(e,o),t.currentUid=n,t.currentFloor=a}if(!t._indoorData||!t._indoorData[n]||t._indoorData[n].currentFloor===a)return void this.fire(new az("onrefresh"));var r=new az("onindoor_data_refresh");r.uid=n,r.floor=a,r.tileKey=t._indoorData[n].tileKey,t._indoorData[n].currentFloor=a,t.currentFloor=a,this.fire(r)}),e.on("spotclick",function(i){var n=null;return i.curAreaSpot&&this.areaSpots[i.curAreaSpot]&&(n=this.areaSpots[i.curAreaSpot].userData.uid),n===t.currentUid?void(i.curAreaSpot&&(t.enterMethod="byClick")):void(null===n?t.currentUid&&"byClick"===t.enterMethod&&(e.showIndoor(null),t.enterMethod=null):(t.enterMethod="byClick",t.currentUid&&e.showIndoor(t.currentUid,t._indoorData[t.currentUid].defaultFloor),e.showIndoor(n,t._indoorData[n].defaultFloor)))}),e.on("moveend",function(){this.getZoom()>=t._autoEnterZoom&&t._checkIndoorByMove()}),e.on("zoomend",function(){this.getZoom()>=t._autoEnterZoom?t._checkIndoorByMove():"byClick"!==t.enterMethod&&null!==t.currentUid&&this.showIndoor(null)})},am.prototype._checkIndoorByMove=function(){var e=this._map,t=e.getSize(),i={x:t.width/2,y:t.height/2},n=(Math.max(t.width,t.height),[]);for(var a in this._indoorData){var o=this._indoorData[a].center,r=e.pointToPixel(new eM.Point(o[0],o[1])),s=ex(i,r);n.push({uid:a,distance:s})}if(0!==n.length){n.sort(function(e,t){return e.distance-t.distance});for(var l=n[0],h=e.getCenter(),c=!1,d=0;d<this._indoorData[l.uid].contour.length;d++)if(bT([h.lng,h.lat],this._indoorData[l.uid].contour[d])){c=!0;break}if(c===!1&&"e96b44200baa3b4082288acc"===l.uid){var u=this._indoorData[l.uid].boundsMin,f=this._indoorData[l.uid].boundsMax;h.lng>u[0]&&h.lat>u[1]&&h.lng<f[0]&&h.lat<f[1]&&(c=!0)}c?"byClick"!==this.enterMethod&&(null!==this.currentUid&&this.currentUid!==l.uid&&this._map.showIndoor(this.currentUid,this._indoorData[this.currentUid].defaultFloor),this.currentUid!==l.uid&&this._map.showIndoor(l.uid,this._indoorData[l.uid].defaultFloor),this.enterMethod="byMove"):"byClick"!==this.enterMethod&&this._map.showIndoor(null)}},am.prototype.setData=function(e){if(null!==e){for(var t in e)if("tileInfo"!==t){var i=e[t].tileKey;if(this._indoorData[t])this._indoorData[t][i]||(this._indoorData[t].tileKeys.push(i),this._indoorData[t][i]=!0);else{this._indoorData[t]=e[t],this._indoorData[t].tileKeys=[e[t].tileKey],this._indoorData[t][i]=!0;for(var n=0;n<this._indoorData[t].contour.length;n++)this._map.addAreaSpot(this._indoorData[t].contour[n],{id:t+n,userData:{uid:t}})}}this._map.getZoom()>=this._autoEnterZoom&&this._checkIndoorByMove()}},am.prototype.removeData=function(e,t){if(this._indoorData[e]){for(var i=this._indoorData[e],n=0;n<i.tileKeys.length;n++)if(i.tileKeys[n]===t){i.tileKeys.splice(n,1);break}delete i[t],0===i.tileKeys.length&&delete this._indoorData[e]}},am.prototype.getIndoorData=function(e){return this._indoorData[e]||null},am.prototype.getData=function(){return this._indoorData},eM.register(function(e){e._indoorMgr=new am(e)});var cH=function(){function e(e,r,s,l){l=l||FS;var h=l[2];switch(r){case"point":h=h[0];break;case"pointText":h=h[1];break;case"line":h=h[3];break;case"polygon":h=h[4];break;case"polygon3d":h=h[5]}var c=s-1;"line"===r&&12===s&&(c=s);var d=l[1][c][0],u=[],f=d[e];if(f||("point"===r||"pointText"===r)&&(d=l[1][s][0],f=d[e]),!f)return u;for(var p=0;p<f.length;p++){var m=h[f[p]];if(m){switch(r){case"polygon":m=a(m,e);break;case"line":m=n(m,e);break;case"pointText":m=t(m,e);break;case"point":m=i(m,e);break;case"polygon3d":m=o(m,e)}u[u.length]=m}}return u}function t(e,t){return{sid:t,fontRgba:r(e[0]),haloRgba:r(e[1]),backRgba:r(e[2]),fontSize:e[3],haloSize:e[4],fontWeight:e[5],fontStyle:e[6],density:e[7]}}function i(e,t){return{sid:t,rank:e[0],ucflag:e[1],icon:e[2],iconType:e[3],nineGG:e[4],density:e[5],zoom:e[6]}}function n(e,t){return{sid:t,borderRgba:r(e[0]),fillRgba:r(e[1]),borderWidth:e[2],fillWidth:e[3],borderCap:e[4],fillCap:e[5],haveBorderLine:e[6],haveBorderTexture:e[7],haveFillTexture:e[8],isUseBorderRgba:e[9],isUseFillRgba:e[10],borderTexture:e[11],fillTexture:e[12],borderTextureType:e[13],fillTextureType:e[14],isRealWidth:e[15],haveArrow:e[16],needRound:e[17],realBorderWidth:e[18]}}function a(e,t){return{sid:t,fillRgba:r(e[0]),borderRgba:r(e[1]),borderWidth:e[2],borderTexture:e[3],borderTextureType:e[4],waterStyle:e[5],haloStyle:e[6],textureStyle:e[7],thickRgba:r(e[8])}}function o(e,t){return{sid:t,filter:e[0],ratio:e[1],haveBorder:e[2],borderWidth:e[3],borderRgba:r(e[4]),fillTop:r(e[5]),fillSide:r(e[6]),polyTexture:e[7]}}function r(e){var t=e;if(h[t])return h[t];e>>>=0;var i=255&e,n=e>>8&255,a=e>>16&255,o=e>>24&255;return h[t]=[i,n,a,o],h[t]}var s={},l={},h={};return{getStyleFromCache:function(t,i,n,a,o){var r=t+"-"+i+"-"+n;return o&&(r+="-indoor"),a?(l[r]||(l[r]=e(t,i,n,a)),l[r]):(s[r]||(s[r]=e(t,i,n,a)),s[r])}}}();eM.register(function(e){new ce(e)}),ce.prototype.render=function(){var e=document.createElement("div");e.className="click-ripple-container";var t=document.createElement("div");return t.className="click-ripple",e.appendChild(t),this._div=e,this._ripple=t,e},ce.prototype.bind=function(e){var t=this;e.addEventListener("spotclick",function(e){e.spots&&0!==e.spots.length&&(t._div.style.left=e.pixel.x+"px",t._div.style.top=e.pixel.y+"px",x.ac(t._ripple,"ripple-playing"))}),x.on(t._ripple,"transitionend",function(){x.rc(t._ripple,"ripple-playing")})},dV.inherits(cB,"ToolbarItem"),x.extend(dV.prototype,{open:function(){return 1==this._isOpen?!0:this._map._toolInUse?!1:(this._map._toolInUse=!0,this._isOpen=!0,!0)},close:function(){this._isOpen&&(this._map._toolInUse=!1,this._isOpen=!1)},_checkStr:function(e){return e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}}),es.inherits(dV,"PolylineTItem"),x.extend(es.prototype,{setLineColor:function(e){this._opts.lineColor=e},setLineStroke:function(e){Math.round(e)>0&&(this._opts.lineStroke=Math.round(e))},setOpacity:function(e){e>=0&&1>=e&&(this._opts.opacity=e)},setLineStyle:function(e){("solid"===e||"dashed"===e)&&(this._opts.lineStyle=e)},clear:function(){for(var e=0,t=this._overlays.length;t>e;e++)this._overlays[e]&&this._map.removeOverlay(this._overlays[e]);this._overlays.length=0;for(var e=0,t=this._dots.length;t>e;e++)this._dots[e]&&this._dots[e].parentNode&&this._dots[e].parentNode.removeChild(this._dots[e]);this._dots.length=0},setCursor:function(e){this._opts.showResult!==!0&&(this._opts.cursor=e)},getCursor:function(){if(this._opts.showResult===!0)return this._dCursor;var e=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);return null!==e?e[1]:this._opts.cursor},showResult:function(e){this._opts.showResult=!!e}}),function(e){Array.prototype.map||(Array.prototype.map=function(e,t){var i,n,a;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),r=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(i=t),n=new Array(r),a=0;r>a;){var s,l;a in o&&(s=o[a],l=e.call(i,s,a,o),n[a]=l),a++}return n});var t=e.detect=function(){var e=function(){},t={browser_parsers:[{regex:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",family_replacement:"Wii",manufacturer:"Nintendo"},{regex:"(SeaMonkey|Camino)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Camino",other:!0},{regex:"(Pale[Mm]oon)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Pale Moon (Firefox Variant)",other:!0},{regex:"(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)(pre)",family_replacment:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"Mobile.*(Firefox)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",family_replacement:"Firefox ($1)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",family_replacement:"Firefox ($1)"},{regex:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"MicroB",tablet:!0},{regex:"(MozillaDeveloperPreview)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?"},{regex:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)",family_replacement:"Flock",other:!0},{regex:"(RockMelt)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Rockmelt",other:!0},{regex:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",family_replacement:"Netscape"},{regex:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(MyIBrow)/(\\d+)\\.(\\d+)",family_replacement:"My Internet Browser",other:!0},{regex:"(Opera Tablet).*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera Tablet",tablet:!0},{regex:"(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)",family_replacement:"Opera Mobile"},{regex:"Opera Mobi",family_replacement:"Opera Mobile"},{regex:"(Opera Mini)/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera Mini)/att/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera)/9.80.*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(OPR)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(webOSBrowser)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(webOS)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(wOSBrowser).+TouchPad/(\\d+)\\.(\\d+)",family_replacement:"webOS TouchPad"},{regex:"(luakit)",family_replacement:"LuaKit",other:!0},{regex:"(Lightning)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)",family_replacement:"Lightning",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"rekonq",family_replacement:"Rekonq",other:!0},{regex:"(conkeror|Conkeror)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Conkeror",other:!0},{regex:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Konqueror",other:!0},{regex:"(WeTab)-Browser",family_replacement:"WeTab",other:!0},{regex:"(Comodo_Dragon)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Comodo Dragon",other:!0},{regex:"(YottaaMonitor)",family_replacement:"Yottaa Monitor",other:!0},{regex:"(Kindle)/(\\d+)\\.(\\d+)",family_replacement:"Kindle"},{regex:"(Symphony) (\\d+).(\\d+)",family_replacement:"Symphony",other:!0},{regex:"Minimo",family_replacement:"Minimo",other:!0},{regex:"(Edge)/(\\d+)\\.(\\d+)",family_replacement:"Edge"},{regex:"(CrMo)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile"},{regex:"(CriOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile iOS"},{regex:"(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile",family_replacement:"Chrome Mobile"},{regex:"(chromeframe)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Frame"},{regex:"(UC Browser)(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"UC Browser",other:!0},{regex:"(SLP Browser)/(\\d+)\\.(\\d+)",family_replacement:"Tizen Browser",other:!0},{regex:"(Epiphany)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"Epiphany",other:!0},{regex:"(SE 2\\.X) MetaSr (\\d+)\\.(\\d+)",family_replacement:"Sogou Explorer",other:!0},{regex:"(Pingdom.com_bot_version_)(\\d+)\\.(\\d+)",family_replacement:"PingdomBot",other:!0},{regex:"(facebookexternalhit)/(\\d+)\\.(\\d+)",family_replacement:"FacebookBot"},{regex:"(Twitterbot)/(\\d+)\\.(\\d+)",family_replacement:"TwitterBot"},{regex:"(AdobeAIR|Chromium|FireWeb|Jasmine|ANTGalio|Midori|Fresco|Lobo|PaleMoon|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|WebPilot|NetFront|Netfront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|ThunderBrowse|Iron|Iris|UP\\.Browser|Bunjaloo|Google Earth|Raven for Mac)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Bolt|Jasmine|IceCat|Skyfire|Midori|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|NetFront|Netfront|Konqueror|Googlebot|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca|Dolfin|BOLT|Minimo|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"},{regex:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(iCab|Lunascape|Opera|Android|Jasmine|Polaris|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?"},{regex:"(Android) Donut",v2_replacement:"2",v1_replacement:"1"},{regex:"(Android) Eclair",v2_replacement:"1",v1_replacement:"2"},{regex:"(Android) Froyo",v2_replacement:"2",v1_replacement:"2"},{regex:"(Android) Gingerbread",v2_replacement:"3",v1_replacement:"2"},{regex:"(Android) Honeycomb",v1_replacement:"3"},{regex:"(IEMobile)[ /](\\d+)\\.(\\d+)",family_replacement:"IE Mobile"},{regex:"(MSIE) (\\d+)\\.(\\d+).*XBLWP7",family_replacement:"IE Large Screen"},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{regex:"(Obigo)InternetBrowser",other:!0},{regex:"(Obigo)\\-Browser",other:!0},{regex:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",other:!0},{regex:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",family_replacement:"Maxthon",other:!0},{regex:"(Maxthon|MyIE2|Uzbl|Shiira)",v1_replacement:"0",other:!0},{regex:"(PLAYSTATION) (\\d+)",family_replacement:"PlayStation",manufacturer:"Sony"},{regex:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)",manufacturer:"Sony"},{regex:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(POLARIS)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(Embider)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Bon Echo",other:!0},{regex:"(iPod).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(AvantGo) (\\d+).(\\d+)",other:!0},{regex:"(Avant)",v1_replacement:"1",other:!0},{regex:"^(Nokia)",family_replacement:"Nokia Services (WAP) Browser",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(BrowserNG)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/5\\.0",v2_replacement:"0",v1_replacement:"7",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/(\\d+)\\.(\\d+)",family_replacement:"Nokia OSS Browser",manufacturer:"Nokia"},{regex:"(S40OviBrowser)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Nokia Series 40 Ovi Browser",manufacturer:"Nokia"},{regex:"(Nokia)[EN]?(\\d+)",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",tablet:!0,manufacturer:"Nokia"},{regex:"(Black[bB]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",manufacturer:"RIM"},{regex:"(Black[bB]erry)\\s?(\\d+)",family_replacement:"Blackberry",manufacturer:"RIM"},{regex:"(OmniWeb)/v(\\d+)\\.(\\d+)",other:!0},{regex:"(Blazer)/(\\d+)\\.(\\d+)",family_replacement:"Palm Blazer",manufacturer:"Palm"},{regex:"(Pre)/(\\d+)\\.(\\d+)",family_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Links) \\((\\d+)\\.(\\d+)",other:!0},{regex:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)",other:!0},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",other:!0,tablet:!0},{regex:"(AppleWebKit)/(\\d+)\\.?(\\d+)?\\+ .* Version/\\d+\\.\\d+.\\d+ Safari/",family_replacement:"WebKit Nightly"},{regex:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",family_replacement:"Safari"},{regex:"(Safari)/\\d+"},{regex:"(OLPC)/Update(\\d+)\\.(\\d+)",other:!0},{regex:"(OLPC)/Update()\\.(\\d+)",v1_replacement:"0",other:!0},{regex:"(SEMC\\-Browser)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Teleca)",family_replacement:"Teleca Browser",other:!0},{regex:"Trident(.*)rv.(\\d+)\\.(\\d+)",family_replacement:"IE"},{regex:"(MSIE) (\\d+)\\.(\\d+)",family_replacement:"IE"}],os_parsers:[{regex:"(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android) Donut",os_v2_replacement:"2",os_v1_replacement:"1"},{regex:"(Android) Eclair",os_v2_replacement:"1",os_v1_replacement:"2"},{regex:"(Android) Froyo",os_v2_replacement:"2",os_v1_replacement:"2"},{regex:"(Android) Gingerbread",os_v2_replacement:"3",os_v1_replacement:"2"},{regex:"(Android) Honeycomb",os_v1_replacement:"3"},{regex:"(Silk-Accelerated=[a-z]{4,5})",os_replacement:"Android"},{regex:"(Windows Phone 6\\.5)"},{regex:"(Windows (?:NT 5\\.2|NT 5\\.1))",os_replacement:"Windows XP"},{regex:"(XBLWP7)",os_replacement:"Windows Phone OS"},{regex:"(Windows NT 6\\.1)",os_replacement:"Windows 7"},{regex:"(Windows NT 6\\.0)",os_replacement:"Windows Vista"},{regex:"(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"},{regex:"(Windows NT 6\\.4|Windows NT 10\\.0)",os_replacement:"Windows 10"},{regex:"(Windows NT 6\\.2)",os_replacement:"Windows 8"},{regex:"(Windows Phone 8)",os_replacement:"Windows Phone 8"},{regex:"(Windows NT 5\\.0)",os_replacement:"Windows 2000"},{regex:"(Windows Phone OS) (\\d+)\\.(\\d+)"},{regex:"(Windows ?Mobile)",os_replacement:"Windows Mobile"},{regex:"(WinNT4.0)",os_replacement:"Windows NT 4.0"},{regex:"(Win98)",os_replacement:"Windows 98"},{regex:"(Tizen)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?",manufacturer:"Apple"},{regex:"(?:PPC|Intel) (Mac OS X)",manufacturer:"Apple"},{regex:"(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod); Opera",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPad); Opera",tablet:!0,manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(CrOS) [a-z0-9_]+ (\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"Chrome OS"},{regex:"(Debian)-(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Linux Mint)(?:/(\\d+))?",other:!0},{regex:"(Mandriva)(?: Linux)?/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Symbian[Oo][Ss])/(\\d+)\\.(\\d+)",os_replacement:"Symbian OS"},{regex:"(Symbian/3).+NokiaBrowser/7\\.3",os_replacement:"Symbian^3 Anna"},{regex:"(Symbian/3).+NokiaBrowser/7\\.4",os_replacement:"Symbian^3 Belle"},{regex:"(Symbian/3)",os_replacement:"Symbian^3"},{regex:"(Series 60|SymbOS|S60)",os_replacement:"Symbian OS"},{regex:"(MeeGo)",other:!0},{regex:"Symbian [Oo][Ss]",os_replacement:"Symbian OS"},{regex:"(Black[Bb]erry)[0-9a-z]+/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(Black[Bb]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(RIM Tablet OS) (\\d+)\\.(\\d+)\\.(\\d+)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Play[Bb]ook)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry)",os_replacement:"Blackberry OS",manufacturer:"RIM"},{regex:"(webOS|hpwOS)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"webOS"},{regex:"(SUSE|Fedora|Red Hat|PCLinuxOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)"},{regex:"(Windows|OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware)"},{regex:"(Linux|BSD)",other:!0}],mobile_os_families:["Windows Phone 6.5","Windows CE","Symbian OS"],device_parsers:[{regex:"HTC ([A-Z][a-z0-9]+) Build",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Z][a-z0-9 ]+) \\d+\\.\\d+\\.\\d+\\.\\d+",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_Touch_([A-Za-z0-9]+)",device_replacement:"HTC Touch ($1)",manufacturer:"HTC"},{regex:"USCCHTC(\\d+)",device_replacement:"HTC $1 (US Cellular)",manufacturer:"HTC"},{regex:"Sprint APA(9292)",device_replacement:"HTC $1 (Sprint)",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+ [A-Z])",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC-([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(ADR[A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(HTC)",manufacturer:"HTC"},{regex:"SonyEricsson([A-Za-z0-9]+)/",device_replacement:"Ericsson $1",other:!0,manufacturer:"Sony"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; WOWMobile (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\-update1\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; (.+) Build"},{regex:"NokiaN([0-9]+)",device_replacement:"Nokia N$1",manufacturer:"Nokia"},{regex:"Nokia([A-Za-z0-9\\v-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"NOKIA ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Nokia ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Lumia ([A-Za-z0-9\\-]+)",device_replacement:"Lumia $1",manufacturer:"Nokia"},{regex:"Symbian",device_replacement:"Nokia",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS",device_replacement:"Blackberry Playbook",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry [0-9]+);",manufacturer:"RIM"},{regex:"Black[Bb]erry([0-9]+)",device_replacement:"BlackBerry $1",manufacturer:"RIM"},{regex:"(Pre)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Pixi)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pixi",manufacturer:"Palm"},{regex:"(Touchpad)/(\\d+)\\.(\\d+)",device_replacement:"HP Touchpad",manufacturer:"HP"},{regex:"HPiPAQ([A-Za-z0-9]+)/(\\d+).(\\d+)",device_replacement:"HP iPAQ $1",manufacturer:"HP"},{regex:"Palm([A-Za-z0-9]+)",device_replacement:"Palm $1",manufacturer:"Palm"},{regex:"Treo([A-Za-z0-9]+)",device_replacement:"Palm Treo $1",manufacturer:"Palm"},{regex:"webOS.*(P160UNA)/(\\d+).(\\d+)",device_replacement:"HP Veer",manufacturer:"HP"},{regex:"(Kindle Fire)",manufacturer:"Amazon"},{regex:"(Kindle)",manufacturer:"Amazon"},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",device_replacement:"Kindle Fire",tablet:!0,manufacturer:"Amazon"},{regex:"(iPad) Simulator;",manufacturer:"Apple"},{regex:"(iPad);",manufacturer:"Apple"},{regex:"(iPod);",manufacturer:"Apple"},{regex:"(iPhone) Simulator;",manufacturer:"Apple"},{regex:"(iPhone);",manufacturer:"Apple"},{regex:"Nexus\\ ([A-Za-z0-9\\-]+)",device_replacement:"Nexus $1"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"Amoi\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"AMOI\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"Asus\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"ASUS\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"BIRD\\-([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD\\.([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD ([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"Dell ([A-Za-z0-9]+)",device_replacement:"Dell $1",manufacturer:"Dell"},{regex:"DoCoMo/2\\.0 ([A-Za-z0-9]+)",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\_W\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"vodafone([A-Za-z0-9]+)",device_replacement:"Huawei Vodafone $1",other:!0},{regex:"i\\-mate ([A-Za-z0-9]+)",device_replacement:"i-mate $1",other:!0},{regex:"Kyocera\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"KWC\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"Lenovo\\-([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Lenovo"},{regex:"Lenovo\\_([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Levovo"},{regex:"LG/([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE VX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG ([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE LG\\-AX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"(KIN)\\.One (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(KIN)\\.Two (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(Motorola)\\-([A-Za-z0-9]+)",manufacturer:"Motorola"},{regex:"MOTO\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"MOT\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"Philips([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"Philips ([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"SAMSUNG-([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"SAMSUNG\\; ([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"Softbank/1\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"Softbank/2\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"(hiptop|avantgo|plucker|xiino|blazer|elaine|up.browser|up.link|mmp|smartphone|midp|wap|vodafone|o2|pocket|mobile|pda)",device_replacement:"Generic Smartphone"},{regex:"^(1207|3gso|4thp|501i|502i|503i|504i|505i|506i|6310|6590|770s|802s|a wa|acer|acs\\-|airn|alav|asus|attw|au\\-m|aur |aus |abac|acoo|aiko|alco|alca|amoi|anex|anny|anyw|aptu|arch|argo|bell|bird|bw\\-n|bw\\-u|beck|benq|bilb|blac|c55/|cdm\\-|chtm|capi|comp|cond|craw|dall|dbte|dc\\-s|dica|ds\\-d|ds12|dait|devi|dmob|doco|dopo|el49|erk0|esl8|ez40|ez60|ez70|ezos|ezze|elai|emul|eric|ezwa|fake|fly\\-|fly\\_|g\\-mo|g1 u|g560|gf\\-5|grun|gene|go.w|good|grad|hcit|hd\\-m|hd\\-p|hd\\-t|hei\\-|hp i|hpip|hs\\-c|htc |htc\\-|htca|htcg)",device_replacement:"Generic Feature Phone"},{regex:"^(htcp|htcs|htct|htc\\_|haie|hita|huaw|hutc|i\\-20|i\\-go|i\\-ma|i230|iac|iac\\-|iac/|ig01|im1k|inno|iris|jata|java|kddi|kgt|kgt/|kpt |kwc\\-|klon|lexi|lg g|lg\\-a|lg\\-b|lg\\-c|lg\\-d|lg\\-f|lg\\-g|lg\\-k|lg\\-l|lg\\-m|lg\\-o|lg\\-p|lg\\-s|lg\\-t|lg\\-u|lg\\-w|lg/k|lg/l|lg/u|lg50|lg54|lge\\-|lge/|lynx|leno|m1\\-w|m3ga|m50/|maui|mc01|mc21|mcca|medi|meri|mio8|mioa|mo01|mo02|mode|modo|mot |mot\\-|mt50|mtp1|mtv |mate|maxo|merc|mits|mobi|motv|mozz|n100|n101|n102|n202|n203|n300|n302|n500|n502|n505|n700|n701|n710|nec\\-|nem\\-|newg|neon)",device_replacement:"Generic Feature Phone"},{regex:"^(netf|noki|nzph|o2 x|o2\\-x|opwv|owg1|opti|oran|ot\\-s|p800|pand|pg\\-1|pg\\-2|pg\\-3|pg\\-6|pg\\-8|pg\\-c|pg13|phil|pn\\-2|pt\\-g|palm|pana|pire|pock|pose|psio|qa\\-a|qc\\-2|qc\\-3|qc\\-5|qc\\-7|qc07|qc12|qc21|qc32|qc60|qci\\-|qwap|qtek|r380|r600|raks|rim9|rove|s55/|sage|sams|sc01|sch\\-|scp\\-|sdk/|se47|sec\\-|sec0|sec1|semc|sgh\\-|shar|sie\\-|sk\\-0|sl45|slid|smb3|smt5|sp01|sph\\-|spv |spv\\-|sy01|samm|sany|sava|scoo|send|siem|smar|smit|soft|sony|t\\-mo|t218|t250|t600|t610|t618|tcl\\-|tdg\\-|telm|tim\\-|ts70|tsm\\-|tsm3|tsm5|tx\\-9|tagt)",device_replacement:"Generic Feature Phone"},{regex:"^(talk|teli|topl|tosh|up.b|upg1|utst|v400|v750|veri|vk\\-v|vk40|vk50|vk52|vk53|vm40|vx98|virg|vite|voda|vulc|w3c |w3c\\-|wapj|wapp|wapu|wapm|wig |wapi|wapr|wapv|wapy|wapa|waps|wapt|winc|winw|wonu|x700|xda2|xdag|yas\\-|your|zte\\-|zeto|aste|audi|avan|blaz|brew|brvw|bumb|ccwa|cell|cldc|cmd\\-|dang|eml2|fetc|hipt|http|ibro|idea|ikom|ipaq|jbro|jemu|jigs|keji|kyoc|kyok|libw|m\\-cr|midp|mmef|moto|mwbp|mywa|newt|nok6|o2im|pant|pdxg|play|pluc|port|prox|rozo|sama|seri|smal|symb|treo|upsi|vx52|vx53|vx60|vx61|vx70|vx80|vx81|vx83|vx85|wap\\-|webc|whit|wmlb|xda\\-|xda\\_)",device_replacement:"Generic Feature Phone"},{regex:"(bot|borg|google(^tv)|yahoo|slurp|msnbot|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks)",device_replacement:"Spider"}],mobile_browser_families:["Firefox Mobile","Opera Mobile","Opera Mini","Mobile Safari","webOS","IE Mobile","Playstation Portable","Nokia","Blackberry","Palm","Silk","Android","Maemo","Obigo","Netfront","AvantGo","Teleca","SEMC-Browser","Bolt","Iris","UP.Browser","Symphony","Minimo","Bunjaloo","Jasmine","Dolfin","Polaris","BREW","Chrome Mobile","Chrome Mobile iOS","UC Browser","Tizen Browser"]};
e.parsers=["device_parsers","browser_parsers","os_parsers","mobile_os_families","mobile_browser_families"],e.types=["browser","os","device"],e.regexes=t||function(){var t={};return e.parsers.map(function(e){t[e]=[]}),t}(),e.families=function(){var t={};return e.types.map(function(e){t[e]=[]}),t}();var i=Array.prototype,n=(Object.prototype,Function.prototype,i.forEach),a=(i.indexOf,function(e,t){for(var i={},n=0;n<t.length&&!(i=t[n](e));n++);return i}),o=function(e,t){r(e,function(e){r(t,function(t){delete e[t]})})},r=forEach=function(e,t,i){if(null!=e)if(n&&e.forEach===n)e.forEach(t,i);else if(e.length===+e.length)for(var a=0,o=e.length;o>a;a++)t.call(i,e[a],a,e);else for(var r in e)_.has(e,r)&&t.call(i,e[r],r,e)},s=function(e){return!(!e||"undefined"==typeof e||null==e)},l=function(e){var t="";return e=e||{},s(e)&&s(e.major)&&(t+=e.major,s(e.minor)&&(t+="."+e.minor,s(e.patch)&&(t+="."+e.patch))),t},h=function(e){e=e||{};var t=l(e);return t&&(t=" "+t),e&&s(e.family)?e.family+t:""};return e.parse=function(t){var i=function(t){return e.regexes[t+"_parsers"].map(function(e){function i(t){var i=t.match(n);if(!i)return null;var r={};return r.family=(a?a.replace("$1",i[1]):i[1])||"other",r.major=parseInt(o?o:i[2])||null,r.minor=i[3]?parseInt(i[3]):null,r.patch=i[4]?parseInt(i[4]):null,r.tablet=e.tablet,r.man=e.manufacturer||null,r}var n=new RegExp(e.regex),a=e[("browser"===t?"family":t)+"_replacement"],o=e.major_version_replacement;return i})},n=function(){},r=i("browser"),c=i("os"),d=i("device"),u=new n;u.source=t,u.browser=a(t,r),s(u.browser)?(u.browser.name=h(u.browser),u.browser.version=l(u.browser)):u.browser={},u.os=a(t,c),s(u.os)?(u.os.name=h(u.os),u.os.version=l(u.os)):u.os={},u.device=a(t,d),s(u.device)?(u.device.name=h(u.device),u.device.version=l(u.device)):u.device={tablet:!1,family:"Other"};{var f={};e.regexes.mobile_browser_families.map(function(e){f[e]=!0}),e.regexes.mobile_os_families.map(function(e){f[e]=!0})}return u.device.type="Spider"===u.browser.family?"Spider":u.browser.tablet||u.os.tablet||u.device.tablet?"Tablet":f.hasOwnProperty(u.browser.family)?"Mobile":"Desktop",u.device.manufacturer=u.browser.man||u.os.man||u.device.man||null,o([u.browser,u.os,u.device],["tablet","man"]),u},e}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.detect=t):e.detect=t,"function"==typeof define&&define.amd&&define(function(){return t})}(window),bq.prototype={calcLoopParam:function(e,t,i){i=i||256;for(var n=0,a=3,o=6,r=o*Math.pow(2,t-a)*256/i,s=r/2-1,l=-r/2;e>s;)e-=r,n-=this._loopOffset;for(;l>e;)e+=r,n+=this._loopOffset;var h=n;return n=Math.round(n/Math.pow(2,18-t)),{offsetX:n,geoOffsetX:h,col:e,T:r,maxCol:s,minCol:l}},calcLoopCenterPoint:function(e){for(var t=e.lng;t>this._mc180X;)t-=this._mcTSpan;for(;t<this._mcM180X;)t+=this._mcTSpan;return e.lng=t,e},calcLoopMapBounds:function(e,t){for(var i=t||e.getCenter(),n=e.minX,a=e.maxX;i.lng>this._mc180X;)i.lng-=this._mcTSpan,n-=this._mcTSpan,a-=this._mcTSpan;for(;i.lng<this._mcM180X;)i.lng+=this._mcTSpan,n+=this._mcTSpan,a+=this._mcTSpan;return e.minX=n,e.maxX=a,e.pointBottomLeft&&(e.pointBottomLeft=this.calcLoopCenterPoint(e.pointBottomLeft),e.pointTopLeft=this.calcLoopCenterPoint(e.pointTopLeft),e.pointTopRight=this.calcLoopCenterPoint(e.pointTopRight),e.pointBottomRight=this.calcLoopCenterPoint(e.pointBottomRight)),e},calcLoopTiles:function(e,t,i,n){i=i||256;for(var a=n||Math.pow(2,18-t)*i,o=Math.floor(this._mc180X/a),r=Math.floor(this._mcM180X/a),s=Math.floor(this._loopOffset/a),l=[],h=0;h<e.length;h++){var c=e[h],d=c[0],u=c[1];if(d>=o){var f=d+s;if(this.isTileBlank(f,t,i)===!0)continue;var p="id_"+f+"_"+u+"_"+t;e[p]||(e[p]=!0,l.push([f,u,t,0]))}else if(r>=d){var f=d-s;if(this.isTileBlank(f,t,i)===!0)continue;var p="id_"+f+"_"+u+"_"+t;e[p]||(e[p]=!0,l.push([f,u,t,0]))}}for(var h=0,m=l.length;m>h;h++)e.push(l[h]);for(var h=e.length-1;h>=0;h--){var d=e[h][0];this.isTileBlank(d,t,i)&&e.splice(h,1)}return e},isTileBlank:function(e,t,i){for(var n=Math.pow(2,t-3),a=Math.round(this._validPixels*n),o=6*n*256/i;e>o/2-1;)e-=o;for(;-(o/2)>e;)e+=o;return e>0&&e*i>a?!0:0>e&&Math.abs((e+1)*i)>a?!0:!1},isAddWidth:function(e,t){return e<this._mcM180X||t>this._mc180X},getSpaceDistanceInPixel:function(e){var t=Math.round((this._spaceDistance+this._mSpaceDistance)/Math.pow(2,18-e));return t}};var cu=new bq;window.BMap=eM,eM.Map=bN,eM.MapType=ba,eM.Point=eR,eM.Pixel=cG,eM.Size=cy,eM.Bounds=cm,eM.TileLayer=bA,eM.Copyright=bL,eM.Projection=eM.Project=cI,eM.RenderTypeUtils=ay,eM.Overlay=aF,eM.Label=af,eM.Marker=b0,eM.Icon=eE,eM.Polyline=a,eM.PolylineMultipart=dt,eM.Polygon=aj,eM.InfoWindow=U,eM.SimpleInfoWindow=e1,eM.Circle=d0,eM.Control=ax,eM.NavigationControl=b2,eM.NavigationControl3D=c6,eM.CopyrightControl=cf,eM.ScaleControl=eH,eM.MapTypeControl=aP,eM.DistanceTool=es,eM.ContextMenu=bg,eM.MenuItem=dA,eM.OperationMask=cF,eM.Animation=l,eM.Transitions=bl,eM.Event=az}();
;!function(t,e){"use strict";t.returnExports=e()}(this,function(){var t,e=Array,r=e.prototype,n=Object,o=n.prototype,i=Function.prototype,a=String,u=a.prototype,l=Number,c=l.prototype,f=r.slice,s=r.splice,p=r.push,h=r.unshift,g=r.concat,y=i.call,d=Math.max,v=Math.min,m=o.toString,w="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,b=Function.prototype.toString,T=function(t){try{return b.call(t),!0}catch(e){return!1}},x="[object Function]",O="[object GeneratorFunction]";t=function(t){if("function"!=typeof t)return!1;if(w)return T(t);var e=m.call(t);return e===x||e===O};var S,j=RegExp.prototype.exec,E=function(t){try{return j.call(t),!0}catch(e){return!1}},I="[object RegExp]";S=function(t){return"object"!=typeof t?!1:w?E(t):m.call(t)===I};var D,k=String.prototype.valueOf,M=function(t){try{return k.call(t),!0}catch(e){return!1}},N="[object String]";D=function(t){return"string"==typeof t?!0:"object"!=typeof t?!1:w?M(t):m.call(t)===N};var F=function(t){var e,r=n.defineProperty&&function(){try{var t={};n.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(r){return!1}}();return e=r?function(t,e,r,o){!o&&e in t||n.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:r})}:function(t,e,r,n){!n&&e in t||(t[e]=r)},function(r,n,o){for(var i in n)t.call(n,i)&&e(r,i,n[i],o)}}(o.hasOwnProperty),R=function(t){var e=typeof t;return null===t||"object"!==e&&"function"!==e},$={ToInteger:function(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},ToPrimitive:function(e){var r,n,o;if(R(e))return e;if(n=e.valueOf,t(n)&&(r=n.call(e),R(r)))return r;if(o=e.toString,t(o)&&(r=o.call(e),R(r)))return r;throw new TypeError},ToObject:function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return n(t)},ToUint32:function(t){return t>>>0}},A=function(){};F(i,{bind:function(e){var r=this;if(!t(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,i=f.call(arguments,1),a=function(){if(this instanceof o){var t=r.apply(this,g.call(i,f.call(arguments)));return n(t)===t?t:this}return r.apply(e,g.call(i,f.call(arguments)))},u=d(0,r.length-i.length),l=[],c=0;u>c;c++)p.call(l,"$"+c);return o=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this, arguments); }")(a),r.prototype&&(A.prototype=r.prototype,o.prototype=new A,A.prototype=null),o}});var U=y.bind(o.hasOwnProperty),C=y.bind(o.toString),P=y.bind(u.slice),Z=y.bind(u.split),J=e.isArray||function(t){return"[object Array]"===C(t)},z=1!==[].unshift(0);F(r,{unshift:function(){return h.apply(this,arguments),this.length}},z),F(e,{isArray:J});var B=n("a"),G="a"!==B[0]||!(0 in B),H=function(t){var e=!0,r=!0;return t&&(t.call("foo",function(t,r,n){"object"!=typeof n&&(e=!1)}),t.call([1],function(){"use strict";r="string"==typeof this},"x")),!!t&&e&&r};F(r,{forEach:function(e){var r,n=$.ToObject(this),o=G&&D(this)?Z(this,""):n,i=-1,a=o.length>>>0;if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++i<a;)i in o&&("undefined"!=typeof r?e.call(r,o[i],i,n):e(o[i],i,n))}},!H(r.forEach)),F(r,{map:function(r){var n,o=$.ToObject(this),i=G&&D(this)?Z(this,""):o,a=i.length>>>0,u=e(a);if(arguments.length>1&&(n=arguments[1]),!t(r))throw new TypeError("Array.prototype.map callback must be a function");for(var l=0;a>l;l++)l in i&&(u[l]="undefined"!=typeof n?r.call(n,i[l],l,o):r(i[l],l,o));return u}},!H(r.map)),F(r,{filter:function(e){var r,n,o=$.ToObject(this),i=G&&D(this)?Z(this,""):o,a=i.length>>>0,u=[];if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;a>l;l++)l in i&&(r=i[l],("undefined"==typeof n?e(r,l,o):e.call(n,r,l,o))&&p.call(u,r));return u}},!H(r.filter)),F(r,{every:function(e){var r,n=$.ToObject(this),o=G&&D(this)?Z(this,""):n,i=o.length>>>0;if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.every callback must be a function");for(var a=0;i>a;a++)if(a in o&&!("undefined"==typeof r?e(o[a],a,n):e.call(r,o[a],a,n)))return!1;return!0}},!H(r.every)),F(r,{some:function(e){var r,n=$.ToObject(this),o=G&&D(this)?Z(this,""):n,i=o.length>>>0;if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.some callback must be a function");for(var a=0;i>a;a++)if(a in o&&("undefined"==typeof r?e(o[a],a,n):e.call(r,o[a],a,n)))return!0;return!1}},!H(r.some));var L=!1;r.reduce&&(L="object"==typeof r.reduce.call("es5",function(t,e,r,n){return n})),F(r,{reduce:function(e){var r=$.ToObject(this),n=G&&D(this)?Z(this,""):r,o=n.length>>>0;if(!t(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var i,a=0;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in n){i=n[a++];break}if(++a>=o)throw new TypeError("reduce of empty array with no initial value")}for(;o>a;a++)a in n&&(i=e(i,n[a],a,r));return i}},!L);var X=!1;r.reduceRight&&(X="object"==typeof r.reduceRight.call("es5",function(t,e,r,n){return n})),F(r,{reduceRight:function(e){var r=$.ToObject(this),n=G&&D(this)?Z(this,""):r,o=n.length>>>0;if(!t(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var i,a=o-1;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in n){i=n[a--];break}if(--a<0)throw new TypeError("reduceRight of empty array with no initial value")}if(0>a)return i;do a in n&&(i=e(i,n[a],a,r));while(a--);return i}},!X);var Y=r.indexOf&&-1!==[0,1].indexOf(1,2);F(r,{indexOf:function(t){var e=G&&D(this)?Z(this,""):$.ToObject(this),r=e.length>>>0;if(0===r)return-1;var n=0;for(arguments.length>1&&(n=$.ToInteger(arguments[1])),n=n>=0?n:d(0,r+n);r>n;n++)if(n in e&&e[n]===t)return n;return-1}},Y);var q=r.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);F(r,{lastIndexOf:function(t){var e=G&&D(this)?Z(this,""):$.ToObject(this),r=e.length>>>0;if(0===r)return-1;var n=r-1;for(arguments.length>1&&(n=v(n,$.ToInteger(arguments[1]))),n=n>=0?n:r-Math.abs(n);n>=0;n--)if(n in e&&t===e[n])return n;return-1}},q);var K=function(){var t=[1,2],e=t.splice();return 2===t.length&&J(e)&&0===e.length}();F(r,{splice:function(){return 0===arguments.length?[]:s.apply(this,arguments)}},!K);var Q=function(){var t={};return r.splice.call(t,0,0,1),1===t.length}();F(r,{splice:function(t,e){if(0===arguments.length)return[];var r=arguments;return this.length=d($.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof e&&(r=f.call(arguments),r.length<2?p.call(r,this.length-t):r[1]=$.ToInteger(e)),s.apply(this,r)}},!Q);var V=function(){var t=new e(1e5);return t[8]="x",t.splice(1,1),7===t.indexOf("x")}(),W=function(){var t=256,e=[];return e[t]="a",e.splice(t+1,0,"b"),"a"===e[t]}();F(r,{splice:function(t,e){for(var r,n=$.ToObject(this),o=[],i=$.ToUint32(n.length),u=$.ToInteger(t),l=0>u?d(i+u,0):v(u,i),c=v(d($.ToInteger(e),0),i-l),s=0;c>s;)r=a(l+s),U(n,r)&&(o[s]=n[r]),s+=1;var p,h=f.call(arguments,2),g=h.length;if(c>g){for(s=l;i-c>s;)r=a(s+c),p=a(s+g),U(n,r)?n[p]=n[r]:delete n[p],s+=1;for(s=i;s>i-c+g;)delete n[s-1],s-=1}else if(g>c)for(s=i-c;s>l;)r=a(s+c-1),p=a(s+g-1),U(n,r)?n[p]=n[r]:delete n[p],s-=1;s=l;for(var y=0;y<h.length;++y)n[s]=h[y],s+=1;return n.length=i-c+g,o}},!V||!W);var _=!{toString:null}.propertyIsEnumerable("toString"),te=function(){}.propertyIsEnumerable("prototype"),ee=!U("x","0"),re=function(t){var e=t.constructor;return e&&e.prototype===t},ne={$window:!0,$console:!0,$parent:!0,$self:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0},oe=function(){if("undefined"==typeof window)return!1;for(var t in window)try{!ne["$"+t]&&U(window,t)&&null!==window[t]&&"object"==typeof window[t]&&re(window[t])}catch(e){return!0}return!1}(),ie=function(t){if("undefined"==typeof window||!oe)return re(t);try{return re(t)}catch(e){return!1}},ae=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],ue=ae.length,le=function(t){return"[object Arguments]"===C(t)},ce=function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&!J(e)&&t(e.callee)},fe=le(arguments)?le:ce;F(n,{keys:function(e){var r=t(e),n=fe(e),o=null!==e&&"object"==typeof e,i=o&&D(e);if(!o&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var u=[],l=te&&r;if(i&&ee||n)for(var c=0;c<e.length;++c)p.call(u,a(c));if(!n)for(var f in e)l&&"prototype"===f||!U(e,f)||p.call(u,a(f));if(_)for(var s=ie(e),h=0;ue>h;h++){var g=ae[h];s&&"constructor"===g||!U(e,g)||p.call(u,g)}return u}});var se=n.keys&&function(){return 2===n.keys(arguments).length}(1,2),pe=n.keys&&function(){var t=n.keys(arguments);return 1!==arguments.length||1!==t.length||1!==t[0]}(1),he=n.keys;F(n,{keys:function(t){return he(fe(t)?f.call(t):t)}},!se||pe);var ge=-621987552e5,ye="-000001",de=Date.prototype.toISOString&&-1===new Date(ge).toISOString().indexOf(ye),ve=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString();F(Date.prototype,{toISOString:function(){var t,e,r,n,o;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(n=this.getUTCFullYear(),o=this.getUTCMonth(),n+=Math.floor(o/12),o=(o%12+12)%12,t=[o+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],n=(0>n?"-":n>9999?"+":"")+P("00000"+Math.abs(n),n>=0&&9999>=n?-4:-6),e=t.length;e--;)r=t[e],10>r&&(t[e]="0"+r);return n+"-"+f.call(t,0,2).join("-")+"T"+f.call(t,2).join(":")+"."+P("000"+this.getUTCMilliseconds(),-3)+"Z"}},de||ve);var me=function(){try{return Date.prototype.toJSON&&null===new Date(0/0).toJSON()&&-1!==new Date(ge).toJSON().indexOf(ye)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(t){return!1}}();me||(Date.prototype.toJSON=function(){var e=n(this),r=$.ToPrimitive(e);if("number"==typeof r&&!isFinite(r))return null;var o=e.toISOString;if(!t(o))throw new TypeError("toISOString property is not callable");return o.call(e)});var we=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),be=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),Te=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));(Te||be||!we)&&(Date=function(t){var e=function(r,n,o,i,u,l,c){var f,s=arguments.length;return f=this instanceof t?1===s&&a(r)===r?new t(e.parse(r)):s>=7?new t(r,n,o,i,u,l,c):s>=6?new t(r,n,o,i,u,l):s>=5?new t(r,n,o,i,u):s>=4?new t(r,n,o,i):s>=3?new t(r,n,o):s>=2?new t(r,n):s>=1?new t(r):new t:t.apply(this,arguments),R(f)||F(f,{constructor:e},!0),f},r=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),n=[0,31,59,90,120,151,181,212,243,273,304,334,365],o=function(t,e){var r=e>1?1:0;return n[e]+Math.floor((t-1969+r)/4)-Math.floor((t-1901+r)/100)+Math.floor((t-1601+r)/400)+365*(t-1970)},i=function(e){return l(new t(1970,0,1,0,0,0,e))};for(var u in t)U(t,u)&&(e[u]=t[u]);F(e,{now:t.now,UTC:t.UTC},!0),e.prototype=t.prototype,F(e.prototype,{constructor:e},!0);var c=function(e){var n=r.exec(e);if(n){var a,u=l(n[1]),c=l(n[2]||1)-1,f=l(n[3]||1)-1,s=l(n[4]||0),p=l(n[5]||0),h=l(n[6]||0),g=Math.floor(1e3*l(n[7]||0)),y=Boolean(n[4]&&!n[8]),d="-"===n[9]?1:-1,v=l(n[10]||0),m=l(n[11]||0);return(p>0||h>0||g>0?24:25)>s&&60>p&&60>h&&1e3>g&&c>-1&&12>c&&24>v&&60>m&&f>-1&&f<o(u,c+1)-o(u,c)&&(a=60*(24*(o(u,c)+f)+s+v*d),a=1e3*(60*(a+p+m*d)+h)+g,y&&(a=i(a)),a>=-864e13&&864e13>=a)?a:0/0}return t.parse.apply(this,arguments)};return F(e,{parse:c}),e}(Date)),Date.now||(Date.now=function(){return(new Date).getTime()});var xe=c.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==0xde0b6b3a7640080.toFixed(0)),Oe={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(t,e){for(var r=-1,n=e;++r<Oe.size;)n+=t*Oe.data[r],Oe.data[r]=n%Oe.base,n=Math.floor(n/Oe.base)},divide:function(t){for(var e=Oe.size,r=0;--e>=0;)r+=Oe.data[e],Oe.data[e]=Math.floor(r/t),r=r%t*Oe.base},numToString:function(){for(var t=Oe.size,e="";--t>=0;)if(""!==e||0===t||0!==Oe.data[t]){var r=a(Oe.data[t]);""===e?e=r:e+=P("0000000",0,7-r.length)+r}return e},pow:function $e(t,e,r){return 0===e?r:e%2===1?$e(t,e-1,r*t):$e(t*t,e/2,r)},log:function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}};F(c,{toFixed:function(t){var e,r,n,o,i,u,c,f;if(e=l(t),e=e!==e?0:Math.floor(e),0>e||e>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(r=l(this),r!==r)return"NaN";if(-1e21>=r||r>=1e21)return a(r);if(n="",0>r&&(n="-",r=-r),o="0",r>1e-21)if(i=Oe.log(r*Oe.pow(2,69,1))-69,u=0>i?r*Oe.pow(2,-i,1):r/Oe.pow(2,i,1),u*=4503599627370496,i=52-i,i>0){for(Oe.multiply(0,u),c=e;c>=7;)Oe.multiply(1e7,0),c-=7;for(Oe.multiply(Oe.pow(10,c,1),0),c=i-1;c>=23;)Oe.divide(1<<23),c-=23;Oe.divide(1<<c),Oe.multiply(1,1),Oe.divide(2),o=Oe.numToString()}else Oe.multiply(0,u),Oe.multiply(1<<-i,0),o=Oe.numToString()+P("0.00000000000000000000",2,2+e);return e>0?(f=o.length,o=e>=f?n+P("0.0000000000000000000",0,e-f+2)+o:n+P(o,0,f-e)+"."+P(o,f-e)):o=n+o,o}},xe),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t="undefined"==typeof/()??/.exec("")[1];u.split=function(e,r){var n=this;if("undefined"==typeof e&&0===r)return[];if(!S(e))return Z(this,e,r);var o,i,a,u,l=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),s=0,h=new RegExp(e.source,c+"g");n+="",t||(o=new RegExp("^"+h.source+"$(?!\\s)",c));var g="undefined"==typeof r?-1>>>0:$.ToUint32(r);for(i=h.exec(n);i&&(a=i.index+i[0].length,!(a>s&&(p.call(l,P(n,s,i.index)),!t&&i.length>1&&i[0].replace(o,function(){for(var t=1;t<arguments.length-2;t++)"undefined"==typeof arguments[t]&&(i[t]=void 0)}),i.length>1&&i.index<n.length&&p.apply(l,f.call(i,1)),u=i[0].length,s=a,l.length>=g)));)h.lastIndex===i.index&&h.lastIndex++,i=h.exec(n);return s===n.length?(u||!h.test(""))&&p.call(l,""):p.call(l,P(n,s)),l.length>g?P(l,0,g):l}}():"0".split(void 0,0).length&&(u.split=function(t,e){return"undefined"==typeof t&&0===e?[]:Z(this,t,e)});var Se=u.replace,je=function(){var t=[];return"x".replace(/x(.)?/g,function(e,r){p.call(t,r)}),1===t.length&&"undefined"==typeof t[0]}();je||(u.replace=function(e,r){var n=t(r),o=S(e)&&/\)[*?]/.test(e.source);if(n&&o){var i=function(t){var n=arguments.length,o=e.lastIndex;e.lastIndex=0;var i=e.exec(t)||[];return e.lastIndex=o,p.call(i,arguments[n-2],arguments[n-1]),r.apply(this,i)};return Se.call(this,e,i)}return Se.call(this,e,r)});var Ee=u.substr,Ie="".substr&&"b"!=="0b".substr(-1);F(u,{substr:function(t,e){var r=t;return 0>t&&(r=d(this.length+t,0)),Ee.call(this,r,e)}},Ie);var De="	\n\f\r   ᠎             　\u2028\u2029﻿",ke="​",Me="["+De+"]",Ne=new RegExp("^"+Me+Me+"*"),Fe=new RegExp(Me+Me+"*$"),Re=u.trim&&(De.trim()||!ke.trim());F(u,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return a(this).replace(Ne,"").replace(Fe,"")}},Re),(8!==parseInt(De+"08")||22!==parseInt(De+"0x16"))&&(parseInt=function(t){var e=/^0[xX]/;return function(r,n){var o=a(r).trim(),i=l(n)||(e.test(o)?16:10);return t(o,i)}}(parseInt))});
;(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function e(t){return"object"==typeof t&&null!==t}function r(t){U=t}function o(t){G=t}function i(){return function(){process.nextTick(f)}}function u(){return function(){N(f)}}function s(){var t=0,n=new Q(f),e=document.createTextNode("");return n.observe(e,{characterData:!0}),function(){e.data=t=++t%2}}function c(){var t=new MessageChannel;return t.port1.onmessage=f,function(){t.port2.postMessage(0)}}function a(){return function(){setTimeout(f,1)}}function f(){for(var t=0;B>t;t+=2){var n=X[t],e=X[t+1];n(e),X[t]=void 0,X[t+1]=void 0}B=0}function l(){try{var t=require,n=t("vertx");return N=n.runOnLoop||n.runOnContext,u()}catch(e){return a()}}function p(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(n){return nn.error=n,nn}}function d(t,n,e,r){try{t.call(n,e,r)}catch(o){return o}}function y(t,n,e){G(function(t){var r=!1,o=d(e,n,function(e){r||(r=!0,n!==e?g(t,e):A(t,e))},function(n){r||(r=!0,E(t,n))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,E(t,o))},t)}function m(t,n){n._state===$?A(t,n._result):n._state===tn?E(t,n._result):j(n,void 0,function(n){g(t,n)},function(n){E(t,n)})}function b(t,e){if(e.constructor===t.constructor)m(t,e);else{var r=v(e);r===nn?E(t,nn.error):void 0===r?A(t,e):n(r)?y(t,e,r):A(t,e)}}function g(n,e){n===e?E(n,_()):t(e)?b(n,e):A(n,e)}function w(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,n){t._state===Z&&(t._result=n,t._state=$,0!==t._subscribers.length&&G(S,t))}function E(t,n){t._state===Z&&(t._state=tn,t._result=n,G(w,t))}function j(t,n,e,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=n,o[i+$]=e,o[i+tn]=r,0===i&&t._state&&G(S,t)}function S(t){var n=t._subscribers,e=t._state;if(0!==n.length){for(var r,o,i=t._result,u=0;u<n.length;u+=3)r=n[u],o=n[u+e],r?x(e,r,o,i):o(i);t._subscribers.length=0}}function T(){this.error=null}function P(t,n){try{return t(n)}catch(e){return en.error=e,en}}function x(t,e,r,o){var i,u,s,c,a=n(r);if(a){if(i=P(r,o),i===en?(c=!0,u=i.error,i=null):s=!0,e===i)return void E(e,h())}else i=o,s=!0;e._state!==Z||(a&&s?g(e,i):c?E(e,u):t===$?A(e,i):t===tn&&E(e,i))}function C(t,n){try{n(function(n){g(t,n)},function(n){E(t,n)})}catch(e){E(t,e)}}function M(t,n){var e=this;e._instanceConstructor=t,e.promise=new t(p),e._validateInput(n)?(e._input=n,e.length=n.length,e._remaining=n.length,e._init(),0===e.length?A(e.promise,e._result):(e.length=e.length||0,e._enumerate(),0===e._remaining&&A(e.promise,e._result))):E(e.promise,e._validationError())}function O(t){return new rn(this,t).promise}function k(t){function n(t){g(o,t)}function e(t){E(o,t)}var r=this,o=new r(p);if(!z(t))return E(o,new TypeError("You must pass an array to race.")),o;for(var i=t.length,u=0;o._state===Z&&i>u;u++)j(r.resolve(t[u]),void 0,n,e);return o}function Y(t){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var e=new n(p);return g(e,t),e}function q(t){var n=this,e=new n(p);return E(e,t),e}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function I(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function D(t){this._id=an++,this._state=void 0,this._result=void 0,this._subscribers=[],p!==t&&(n(t)||F(),this instanceof D||I(),C(this,t))}function K(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(n){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;(!e||"[object Promise]"!==Object.prototype.toString.call(e.resolve())||e.cast)&&(t.Promise=fn)}var L;L=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var N,U,W,z=L,B=0,G=({}.toString,function(t,n){X[B]=t,X[B+1]=n,B+=2,2===B&&(U?U(f):W())}),H="undefined"!=typeof window?window:void 0,J=H||{},Q=J.MutationObserver||J.WebKitMutationObserver,R="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),V="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,X=new Array(1e3);W=R?i():Q?s():V?c():void 0===H&&"function"==typeof require?l():a();var Z=void 0,$=1,tn=2,nn=new T,en=new T;M.prototype._validateInput=function(t){return z(t)},M.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},M.prototype._init=function(){this._result=new Array(this.length)};var rn=M;M.prototype._enumerate=function(){for(var t=this,n=t.length,e=t.promise,r=t._input,o=0;e._state===Z&&n>o;o++)t._eachEntry(r[o],o)},M.prototype._eachEntry=function(t,n){var r=this,o=r._instanceConstructor;e(t)?t.constructor===o&&t._state!==Z?(t._onerror=null,r._settledAt(t._state,n,t._result)):r._willSettleAt(o.resolve(t),n):(r._remaining--,r._result[n]=t)},M.prototype._settledAt=function(t,n,e){var r=this,o=r.promise;o._state===Z&&(r._remaining--,t===tn?E(o,e):r._result[n]=e),0===r._remaining&&A(o,r._result)},M.prototype._willSettleAt=function(t,n){var e=this;j(t,void 0,function(t){e._settledAt($,n,t)},function(t){e._settledAt(tn,n,t)})};var on=O,un=k,sn=Y,cn=q,an=0,fn=D;D.all=on,D.race=un,D.resolve=sn,D.reject=cn,D._setScheduler=r,D._setAsap=o,D._asap=G,D.prototype={constructor:D,then:function(t,n){var e=this,r=e._state;if(r===$&&!t||r===tn&&!n)return this;var o=new this.constructor(p),i=e._result;if(r){var u=arguments[r-1];G(function(){x(r,o,u,i)})}else j(e,o,t,n);return o},"catch":function(t){return this.then(null,t)}};var ln=K,pn={Promise:fn,polyfill:ln};"function"==typeof define&&define.amd?define(function(){return pn}):"undefined"!=typeof module&&module.exports?module.exports=pn:"undefined"!=typeof this&&(this.ES6Promise=pn),ln()}).call(this);
;(function(){function n(n){function t(t,r,e,u,i,o){for(;i>=0&&o>i;i+=n){var a=u?u[i]:i;e=r(e,t[a],a,t)}return e}return function(r,e,u,i){e=b(e,i,4);var o=!k(r)&&m.keys(r),a=(o||r).length,c=n>0?0:a-1;return arguments.length<3&&(u=r[o?o[c]:c],c+=n),t(r,e,u,o,c,a)}}function t(n){return function(t,r,e){r=x(r,e);for(var u=O(t),i=n>0?0:u-1;i>=0&&u>i;i+=n)if(r(t[i],i,t))return i;return-1}}function r(n,t,r){return function(e,u,i){var o=0,a=O(e);if("number"==typeof i)n>0?o=i>=0?i:Math.max(i+a,o):a=i>=0?Math.min(i+1,a):i+a+1;else if(r&&i&&a)return i=r(e,u),e[i]===u?i:-1;if(u!==u)return i=t(l.call(e,o,a),m.isNaN),i>=0?i+o:-1;for(i=n>0?o:a-1;i>=0&&a>i;i+=n)if(e[i]===u)return i;return-1}}function e(n,t){var r=I.length,e=n.constructor,u=m.isFunction(e)&&e.prototype||a,i="constructor";for(m.has(n,i)&&!m.contains(t,i)&&t.push(i);r--;)i=I[r],i in n&&n[i]!==u[i]&&!m.contains(t,i)&&t.push(i)}var u=this,i=u._,o=Array.prototype,a=Object.prototype,c=Function.prototype,f=o.push,l=o.slice,s=a.toString,p=a.hasOwnProperty,h=Array.isArray,v=Object.keys,g=c.bind,y=Object.create,d=function(){},m=function(n){return n instanceof m?n:this instanceof m?void(this._wrapped=n):new m(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):u._=m,m.VERSION="1.8.3";var b=function(n,t,r){if(void 0===t)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}},x=function(n,t,r){return null==n?m.identity:m.isFunction(n)?b(n,t,r):m.isObject(n)?m.matcher(n):m.property(n)};m.iteratee=function(n,t){return x(n,t,1/0)};var _=function(n,t){return function(r){var e=arguments.length;if(2>e||null==r)return r;for(var u=1;e>u;u++)for(var i=arguments[u],o=n(i),a=o.length,c=0;a>c;c++){var f=o[c];t&&void 0!==r[f]||(r[f]=i[f])}return r}},j=function(n){if(!m.isObject(n))return{};if(y)return y(n);d.prototype=n;var t=new d;return d.prototype=null,t},w=function(n){return function(t){return null==t?void 0:t[n]}},A=Math.pow(2,53)-1,O=w("length"),k=function(n){var t=O(n);return"number"==typeof t&&t>=0&&A>=t};m.each=m.forEach=function(n,t,r){t=b(t,r);var e,u;if(k(n))for(e=0,u=n.length;u>e;e++)t(n[e],e,n);else{var i=m.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)}return n},m.map=m.collect=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=Array(u),o=0;u>o;o++){var a=e?e[o]:o;i[o]=t(n[a],a,n)}return i},m.reduce=m.foldl=m.inject=n(1),m.reduceRight=m.foldr=n(-1),m.find=m.detect=function(n,t,r){var e;return e=k(n)?m.findIndex(n,t,r):m.findKey(n,t,r),void 0!==e&&-1!==e?n[e]:void 0},m.filter=m.select=function(n,t,r){var e=[];return t=x(t,r),m.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e},m.reject=function(n,t,r){return m.filter(n,m.negate(x(t)),r)},m.every=m.all=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(!t(n[o],o,n))return!1}return!0},m.some=m.any=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(t(n[o],o,n))return!0}return!1},m.contains=m.includes=m.include=function(n,t,r,e){return k(n)||(n=m.values(n)),("number"!=typeof r||e)&&(r=0),m.indexOf(n,t,r)>=0},m.invoke=function(n,t){var r=l.call(arguments,2),e=m.isFunction(t);return m.map(n,function(n){var u=e?t:n[t];return null==u?u:u.apply(n,r)})},m.pluck=function(n,t){return m.map(n,m.property(t))},m.where=function(n,t){return m.filter(n,m.matcher(t))},m.findWhere=function(n,t){return m.find(n,m.matcher(t))},m.max=function(n,t,r){var e,u,i=-1/0,o=-1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++)e=n[a],e>i&&(i=e)}else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(u>o||u===-1/0&&i===-1/0)&&(i=n,o=u)});return i},m.min=function(n,t,r){var e,u,i=1/0,o=1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++)e=n[a],i>e&&(i=e)}else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(o>u||1/0===u&&1/0===i)&&(i=n,o=u)});return i},m.shuffle=function(n){for(var t,r=k(n)?n:m.values(n),e=r.length,u=Array(e),i=0;e>i;i++)t=m.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];return u},m.sample=function(n,t,r){return null==t||r?(k(n)||(n=m.values(n)),n[m.random(n.length-1)]):m.shuffle(n).slice(0,Math.max(0,t))},m.sortBy=function(n,t,r){return t=x(t,r),m.pluck(m.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||void 0===r)return 1;if(e>r||void 0===e)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=x(r,e),m.each(t,function(e,i){var o=r(e,i,t);n(u,e,o)}),u}};m.groupBy=F(function(n,t,r){m.has(n,r)?n[r].push(t):n[r]=[t]}),m.indexBy=F(function(n,t,r){n[r]=t}),m.countBy=F(function(n,t,r){m.has(n,r)?n[r]++:n[r]=1}),m.toArray=function(n){return n?m.isArray(n)?l.call(n):k(n)?m.map(n,m.identity):m.values(n):[]},m.size=function(n){return null==n?0:k(n)?n.length:m.keys(n).length},m.partition=function(n,t,r){t=x(t,r);var e=[],u=[];return m.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]},m.first=m.head=m.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:m.initial(n,n.length-t)},m.initial=function(n,t,r){return l.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},m.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:m.rest(n,Math.max(0,n.length-t))},m.rest=m.tail=m.drop=function(n,t,r){return l.call(n,null==t||r?1:t)},m.compact=function(n){return m.filter(n,m.identity)};var S=function(n,t,r,e){for(var u=[],i=0,o=e||0,a=O(n);a>o;o++){var c=n[o];if(k(c)&&(m.isArray(c)||m.isArguments(c))){t||(c=S(c,t,r));var f=0,l=c.length;for(u.length+=l;l>f;)u[i++]=c[f++]}else r||(u[i++]=c)}return u};m.flatten=function(n,t){return S(n,t,!1)},m.without=function(n){return m.difference(n,l.call(arguments,1))},m.uniq=m.unique=function(n,t,r,e){m.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=x(r,e));for(var u=[],i=[],o=0,a=O(n);a>o;o++){var c=n[o],f=r?r(c,o,n):c;t?(o&&i===f||u.push(c),i=f):r?m.contains(i,f)||(i.push(f),u.push(c)):m.contains(u,c)||u.push(c)}return u},m.union=function(){return m.uniq(S(arguments,!0,!0))},m.intersection=function(n){for(var t=[],r=arguments.length,e=0,u=O(n);u>e;e++){var i=n[e];if(!m.contains(t,i)){for(var o=1;r>o&&m.contains(arguments[o],i);o++);o===r&&t.push(i)}}return t},m.difference=function(n){var t=S(arguments,!0,!0,1);return m.filter(n,function(n){return!m.contains(t,n)})},m.zip=function(){return m.unzip(arguments)},m.unzip=function(n){for(var t=n&&m.max(n,O).length||0,r=Array(t),e=0;t>e;e++)r[e]=m.pluck(n,e);return r},m.object=function(n,t){for(var r={},e=0,u=O(n);u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},m.findIndex=t(1),m.findLastIndex=t(-1),m.sortedIndex=function(n,t,r,e){r=x(r,e,1);for(var u=r(t),i=0,o=O(n);o>i;){var a=Math.floor((i+o)/2);r(n[a])<u?i=a+1:o=a}return i},m.indexOf=r(1,m.findIndex,m.sortedIndex),m.lastIndexOf=r(-1,m.findLastIndex),m.range=function(n,t,r){null==t&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var E=function(n,t,r,e,u){if(!(e instanceof t))return n.apply(r,u);var i=j(n.prototype),o=n.apply(i,u);return m.isObject(o)?o:i};m.bind=function(n,t){if(g&&n.bind===g)return g.apply(n,l.call(arguments,1));if(!m.isFunction(n))throw new TypeError("Bind must be called on a function");var r=l.call(arguments,2),e=function(){return E(n,e,t,this,r.concat(l.call(arguments)))};return e},m.partial=function(n){var t=l.call(arguments,1),r=function(){for(var e=0,u=t.length,i=Array(u),o=0;u>o;o++)i[o]=t[o]===m?arguments[e++]:t[o];for(;e<arguments.length;)i.push(arguments[e++]);return E(n,r,this,this,i)};return r},m.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)r=arguments[t],n[r]=m.bind(n[r],n);return n},m.memoize=function(n,t){var r=function(e){var u=r.cache,i=""+(t?t.apply(this,arguments):e);return m.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return r.cache={},r},m.delay=function(n,t){var r=l.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},m.defer=m.partial(m.delay,m,1),m.throttle=function(n,t,r){var e,u,i,o=null,a=0;r||(r={});var c=function(){a=r.leading===!1?0:m.now(),o=null,i=n.apply(e,u),o||(e=u=null)};return function(){var f=m.now();a||r.leading!==!1||(a=f);var l=t-(f-a);return e=this,u=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),a=f,i=n.apply(e,u),o||(e=u=null)):o||r.trailing===!1||(o=setTimeout(c,l)),i}},m.debounce=function(n,t,r){var e,u,i,o,a,c=function(){var f=m.now()-o;t>f&&f>=0?e=setTimeout(c,t-f):(e=null,r||(a=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,o=m.now();var f=r&&!e;return e||(e=setTimeout(c,t)),f&&(a=n.apply(i,u),i=u=null),a}},m.wrap=function(n,t){return m.partial(t,n)},m.negate=function(n){return function(){return!n.apply(this,arguments)}},m.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);return e}},m.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},m.before=function(n,t){var r;return function(){return--n>0&&(r=t.apply(this,arguments)),1>=n&&(t=null),r}},m.once=m.partial(m.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.keys=function(n){if(!m.isObject(n))return[];if(v)return v(n);var t=[];for(var r in n)m.has(n,r)&&t.push(r);return M&&e(n,t),t},m.allKeys=function(n){if(!m.isObject(n))return[];var t=[];for(var r in n)t.push(r);return M&&e(n,t),t},m.values=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},m.mapObject=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=u.length,o={},a=0;i>a;a++)e=u[a],o[e]=t(n[e],e,n);return o},m.pairs=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},m.invert=function(n){for(var t={},r=m.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},m.functions=m.methods=function(n){var t=[];for(var r in n)m.isFunction(n[r])&&t.push(r);return t.sort()},m.extend=_(m.allKeys),m.extendOwn=m.assign=_(m.keys),m.findKey=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=0,o=u.length;o>i;i++)if(e=u[i],t(n[e],e,n))return e},m.pick=function(n,t,r){var e,u,i={},o=n;if(null==o)return i;m.isFunction(t)?(u=m.allKeys(o),e=b(t,r)):(u=S(arguments,!1,!1,1),e=function(n,t,r){return t in r},o=Object(o));for(var a=0,c=u.length;c>a;a++){var f=u[a],l=o[f];e(l,f,o)&&(i[f]=l)}return i},m.omit=function(n,t,r){if(m.isFunction(t))t=m.negate(t);else{var e=m.map(S(arguments,!1,!1,1),String);t=function(n,t){return!m.contains(e,t)}}return m.pick(n,t,r)},m.defaults=_(m.allKeys,!0),m.create=function(n,t){var r=j(n);return t&&m.extendOwn(r,t),r},m.clone=function(n){return m.isObject(n)?m.isArray(n)?n.slice():m.extend({},n):n},m.tap=function(n,t){return t(n),n},m.isMatch=function(n,t){var r=m.keys(t),e=r.length;if(null==n)return!e;for(var u=Object(n),i=0;e>i;i++){var o=r[i];if(t[o]!==u[o]||!(o in u))return!1}return!0};var N=function(n,t,r,e){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof m&&(n=n._wrapped),t instanceof m&&(t=t._wrapped);var u=s.call(n);if(u!==s.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof t)return!1;var o=n.constructor,a=t.constructor;if(o!==a&&!(m.isFunction(o)&&o instanceof o&&m.isFunction(a)&&a instanceof a)&&"constructor"in n&&"constructor"in t)return!1}r=r||[],e=e||[];for(var c=r.length;c--;)if(r[c]===n)return e[c]===t;if(r.push(n),e.push(t),i){if(c=n.length,c!==t.length)return!1;for(;c--;)if(!N(n[c],t[c],r,e))return!1}else{var f,l=m.keys(n);if(c=l.length,m.keys(t).length!==c)return!1;for(;c--;)if(f=l[c],!m.has(t,f)||!N(n[f],t[f],r,e))return!1}return r.pop(),e.pop(),!0};m.isEqual=function(n,t){return N(n,t)},m.isEmpty=function(n){return null==n?!0:k(n)&&(m.isArray(n)||m.isString(n)||m.isArguments(n))?0===n.length:0===m.keys(n).length},m.isElement=function(n){return!(!n||1!==n.nodeType)},m.isArray=h||function(n){return"[object Array]"===s.call(n)},m.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){m["is"+n]=function(t){return s.call(t)==="[object "+n+"]"}}),m.isArguments(arguments)||(m.isArguments=function(n){return m.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(m.isFunction=function(n){return"function"==typeof n||!1}),m.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},m.isNaN=function(n){return m.isNumber(n)&&n!==+n},m.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===s.call(n)},m.isNull=function(n){return null===n},m.isUndefined=function(n){return void 0===n},m.has=function(n,t){return null!=n&&p.call(n,t)},m.noConflict=function(){return u._=i,this},m.identity=function(n){return n},m.constant=function(n){return function(){return n}},m.noop=function(){},m.property=w,m.propertyOf=function(n){return null==n?function(){}:function(t){return n[t]}},m.matcher=m.matches=function(n){return n=m.extendOwn({},n),function(t){return m.isMatch(t,n)}},m.times=function(n,t,r){var e=Array(Math.max(0,n));t=b(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},m.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},m.now=Date.now||function(){return(new Date).getTime()};var B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},T=m.invert(B),R=function(n){var t=function(t){return n[t]},r="(?:"+m.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};m.escape=R(B),m.unescape=R(T),m.result=function(n,t,r){var e=null==n?void 0:n[t];return void 0===e&&(e=r),m.isFunction(e)?e.call(n):e};var q=0;m.uniqueId=function(n){var t=++q+"";return n?n+t:t},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\u2028|\u2029/g,L=function(n){return"\\"+z[n]};m.template=function(n,t,r){!t&&r&&(t=r),t=m.defaults({},t,m.templateSettings);var e=RegExp([(t.escape||K).source,(t.interpolate||K).source,(t.evaluate||K).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,o,a){return i+=n.slice(u,a).replace(D,L),u=a+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var o=new Function(t.variable||"obj","_",i)}catch(a){throw a.source=i,a}var c=function(n){return o.call(this,n,m)},f=t.variable||"obj";return c.source="function("+f+"){\n"+i+"}",c},m.chain=function(n){var t=m(n);return t._chain=!0,t};var P=function(n,t){return n._chain?m(t).chain():t};m.mixin=function(n){m.each(m.functions(n),function(t){var r=m[t]=n[t];m.prototype[t]=function(){var n=[this._wrapped];return f.apply(n,arguments),P(this,r.apply(m,n))}})},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];m.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],P(this,r)}}),m.each(["concat","join","slice"],function(n){var t=o[n];m.prototype[n]=function(){return P(this,t.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}).call(this);
;!function(e){var n=50,t=25,a={},l=[].slice,r={},o={},c=function(e,l,c,f){function i(){var e=+new Date;do{var a=s.shift();try{c&&c.call(f,a.type,a.data)}catch(l){}}while(s.length&&+new Date-e<n);s.length>0&&setTimeout(arguments.callee,t)}"string"!=typeof l&&(f=c,c=l,l="overall");var u=r[e];u||(u=r[e]={}),u[l]=u[l]||[],u[l].push({func:c,context:f||a});var h=o[e],s=[];if(h){if("overall"===l)for(var g in h)s=s.concat(h[g]);else h[l]&&h[l].length&&(s=h[l]);s.length&&i()}},f=function(e,n,t,l){var r=function(){return a.off(e,n,r),t.apply(l||a,arguments)};c(e,n,r,l)},i=function(e,a,c){if(r[e]&&r[e][a]&&r[e][a].length||r[e]&&r[e].overall){var f=r[e].overall,i=r[e][a]||[];f&&(i=f.concat(i));for(var u=[],h=i.length;h--;)u.push({handler:i[h],args:l.call(arguments,1)});!function(){var e=+new Date;do{var a=u.shift(),l=a.handler;l&&l.func&&l.func.apply(l.context,a.args)}while(u.length&&+new Date-e<n);u.length>0&&setTimeout(arguments.callee,t)}()}else{var s=o[e]||(o[e]={}),i=s[a]||(s[a]=[]);c&&i.push({type:a,data:c})}},u=function(e,n,t,l){if(l=l||a,r[e]&&r[e][n]&&r[e][n].length)for(var o,c=r[e][n],f=c.length;f--;)o=c[f],o.func===t&&o.context===l&&c.splice(f,1)};a.on=c,a.once=f,a.trigger=i,a.off=u,e.listener=e.listener||a}(window);
;!function(e){if(e){var t=document.location.search.match(/testDate\=([^\;]*)/);if(t&&t[1]){var a=t[1].split("-");e=new Date(parseInt(a[0],10),parseInt(a[1]-1,10),parseInt(a[2],10)),e/=1e3}var n={spring:{startTime:{year:2016,month:2,date:6},endTime:{year:2016,month:2,date:14}}},r="";for(var i in n){var m=n[i],s=new Date(m.startTime.year,m.startTime.month-1,m.startTime.date,0,0,0),d=new Date(m.endTime.year,m.endTime.month-1,m.endTime.date,23,59,59);if(s.getTime()<=1e3*e&&d.getTime()>=1e3*e){r=i;break}}var o=document.getElementById("left-panel");o.className=o&&r?"theme-festival-"+i:""}}(window.SYSTIME);
;!function(window){function geoToPoint(e){var t=e.split("|");if("1"===t[0]){var a=t[1].split(","),o=new BMap.Point(parseFloat(a[0]),parseFloat(a[1]));return o}var n=new BMap.Point(12957320,4825100);return n}function getParam(e){if(e.indexOf("?")>-1)var t=e.slice(e.indexOf("?")+1);else{if(!(e.indexOf("#")>-1))return;var t=e.slice(e.indexOf("#")+1)}if(""!=t){for(var a={},o=t.split("&"),n=0;n<o.length;n++){var i=o[n].split("=");if(i[1]){var r=i[1].indexOf("#");i[1]=r>-1?i[1].slice(0,r):i[1],a[i[0]]=i[1]}}return a}}function parseLocUrl(e){var t=e.substring(1).split(",");if(t.length<2)return null;var a={x:parseFloat(t[0]),y:parseFloat(t[1]),z:null,t:null,h:null};if(isNaN(a.x)||isNaN(a.y))return null;for(var o=2;o<t.length;o++){var n=t[o];if(n.indexOf("z")===n.length-1){var i=parseFloat(n);isNaN(i)||(a.z=i)}if(n.indexOf("h")===n.length-1){var r=parseFloat(n);isNaN(r)||(a.h=r)}if(n.indexOf("t")===n.length-1){var l=parseFloat(n);isNaN(l)||(a.t=l)}}return a}function parseMapStateUrl(e){var t=getParam("?"+e),a={};return t&&(!t.maptype||"B_EARTH_MAP"!==t.maptype&&"B_SATELLITE_MAP"!==t.maptype||(a.mapType=t.maptype),t.maplayer&&(a.mapLayer=decodeURIComponent(t.maplayer)),t.ccode&&(a.ccode=decodeURIComponent(t.ccode)),t.cname&&(a.cname=decodeURIComponent(t.cname)),t.index&&(a.index=parseInt(decodeURIComponent(t.index),10)),t.title&&(a.title=decodeURIComponent(t.title)),t.content&&(a.content=decodeURIComponent(t.content)),t.latlng&&(a.latlng=decodeURIComponent(t.latlng)),t.autoOpen&&(a.autoOpen=decodeURIComponent(t.autoOpen))),a}function getAppStateFromPath(){for(var e=location.pathname,t=e.match(/\/[^\/]*/g),a=-1,o={mapState:{}},n=0;n<t.length;n++){var i=t[n].substring(1);0===i.indexOf("@")?(o.loc=parseLocUrl(i),a=n):o.mapState=parseMapStateUrl(decodeURIComponent(i))}return o}function enableByRule(){var e=navigator.userAgent,t=0,a=0,o=0,n=0;if(/macintosh/gi.test(e))return!0;if(/windows nt (\d+\.\d)/gi.test(e)&&(a=parseFloat(RegExp.$1),a>=6.1)){if(/chrome\/(\d+\.\d)/i.test(e)&&(t=parseFloat(RegExp.$1),t>=31))return!0;if(/MSIE (\d+(\.\d+)?)/.test(e)&&(o=parseFloat(RegExp.$1),o>=10))return!0;if(/Firefox\/(\d+\.\d)/i.test(e)&&(n=parseFloat(RegExp.$1),n>40))return!0;if(/rv:11.0/gi.test(e))return!0;if(/edge/gi.test(e))return!0}return!1}function sendOpClickStat(e){var t="map";"B_EARTH_MAP"===map.getMapType()&&(t="earth");var a=map.getRenderType();addStat(t+"."+a+"."+e.type,"click",{da_e_name:"pcmapearth"}),e.opMethod&&addStat(t+"."+a+"."+e.type+"."+e.opMethod,"click",{da_e_name:"pcmapearth"})}function onEachTileLoad(e){var t=e.perfStat;if(4===t.length){var a;a=window.__newversion__?{z_webglmap_tile_net_binary:t[0],z_webglmap_tile_eval_binary:t[1],z_webglmap_tile_parse_binary:t[2],z_webglmap_tile_size_binary:t[3]}:{z_webglmap_tile_net:t[0],z_webglmap_tile_eval:t[1],z_webglmap_tile_parse:t[2],z_webglmap_tile_size:t[3]},alog("cus.fire","time",a)}}function addMapCtrls(e){window.stdMapCtrl=new BMap.NavigationControl({from:"MAP_INDEX",offset:new BMap.Size(1,0),type:BMAP_NAVIGATION_CONTROL_SMALL,anchor:BMAP_ANCHOR_BOTTOM_RIGHT,forceNew:!0,container:document.getElementById("map-operate")}),window.stdMapCtrl._cZIndex="10",e.addControl(window.stdMapCtrl);var t=document.getElementById("map-operate");(e.mapType===BMAP_EARTH_MAP||"webgl"===e._renderType)&&t&&(t.className="show-3d"),"webgl"!==e._renderType&&e.addEventListener("onmaptypechange",function(e){var a=e.mapType;a===BMAP_EARTH_MAP?t&&(t.className="show-3d"):t&&(t.className="")}),window.scaleCtrl=new BMap.ScaleControl({offset:new BMap.Size(112,26),printable:!0}),window.map.addControl(window.scaleCtrl)}var PanoLoading=require("pano:widget/module/PanoLoading/PanoLoading.js"),userAuth=require("common:widget/com/UserAuth/userAuth.js");window.isPrint=!1,window.BMAP_TYPE_HYBIRD="B_SATELLITE_STREET",BMap.PolylineTItem=BMap.DistanceTool,PanoLoading.createMask(getParam(location.href),location.href);var mapType=BMAP_NORMAL_MAP,param=getParam(location.href),appState=getAppStateFromPath();window._appStateFromUrl=appState,appState.mapState.mapType?mapType=appState.mapState.mapType:param&&(param.tn||param.mt)&&(mapType=param.tn||param.mt);var href=location.href,forceRenderType="";enableByRule()||(forceRenderType="dom"),/force=raster/i.test(href)&&(forceRenderType="dom"),/force=vector/i.test(href)&&(forceRenderType="canvas"),/force=webgl/i.test(href)&&(forceRenderType="webgl");var userRenderMode=null;window.localStorage&&window.localStorage.getItem&&(userRenderMode=window.localStorage.getItem("user-render-mode")),forceRenderType=userRenderMode||forceRenderType,BMap.RenderTypeUtils.ifEnableEarth()&&"B_SATELLITE_MAP"===mapType&&(mapType="B_EARTH_MAP");var map=window.map=new BMap.Map("MapHolder",{mapType:mapType,forceRenderType:forceRenderType,enableKeyboard:!0,enableWheelZoom:!0,enableContinuousZoom:!0}),COUNTRY_LEVEL=4,point=new BMap.Point(12957320,4825100),level=COUNTRY_LEVEL,code=1,cityType=[4,11,12,15],tilt=0,heading=0;if(null!=window._OLR&&(eval("var json ="+window._OLR.index),window._OLR.hot_city=json.hot_city,point=geoToPoint(json.content.geo),level=cityType[json.content.city_type],code=json.content.code),IPLOC&&IPLOC.ipLoc&&"success"===IPLOC.ipLoc.status&&IPLOC.ipLoc.content.radius<=2e3)var iplocSuccess=!0;var iplocOpts={};if(iplocSuccess===!0&&IPLOC.rgc&&IPLOC.rgc.result){iplocOpts.cityCode=IPLOC.rgc.result.cityCode,iplocOpts.cityName=IPLOC.rgc.result.addressComponent.city;var key="MCITY";if(new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(key)===!0){var reg=new RegExp("(^| )"+key+"=([^;]*)(;|$)"),regValue=reg.exec(document.cookie);if(regValue)var myCity=regValue[2]||null;"string"==typeof myCity&&(myCity=decodeURIComponent(myCity))}parseFloat(myCity)>0&&1!==code?(iplocOpts.cityCode===code&&(iplocOpts.status="show",iplocOpts.needCurReq=!1),iplocOpts.cityCode!==code&&(iplocOpts.status="showChageCity",iplocOpts.needCurReq=!1)):(iplocOpts.status="show",iplocOpts.needCurReq=!0)}if(appState.loc){var loc=appState.loc;point=new BMap.Point(loc.x,loc.y),level=loc.z||12,tilt=loc.t||0,heading=loc.h||0,map.isFromShare=!0,iplocOpts.needCurReq=!1}else{if("show"===iplocOpts.status&&IPLOC&&IPLOC.ipLoc&&IPLOC.ipLoc.content&&IPLOC.ipLoc.content.point){var ipLocPt=IPLOC.ipLoc.content.point;"number"==typeof ipLocPt.x&&"number"==typeof ipLocPt.y&&(point=new BMap.Point(ipLocPt.x,ipLocPt.y),level=15,iplocOpts.preventZoomMap=!0)}if(param&&param.c){var p=param.c.split(",");if(2===p.length){var lng=parseFloat(p[0]),lat=parseFloat(p[1]);"number"==typeof lng&&"number"==typeof lat&&(point=new BMap.Point(lng,lat),map.isFromShare=!0,iplocOpts.needCurReq=!1)}param.l&&"number"==typeof parseInt(param.l,10)&&(level=parseInt(param.l,10))}}window.corePerfMonitor&&map.addEventListener("tilesloaded",window.corePerfMonitor.onTilesLoaded),map.addEventListener("earthload",function(e){for(var t=e.earth,a=["rotatecwclick","rotateccwclick","compassclick","zoominclick","zoomoutclick","tiltmsdown","ontiltclick"],o=0;o<a.length;o++)t.on(a[o],sendOpClickStat);t.on("fpsdata_ready",function(e){var t={};t.z_fps=e.fps,t.z_fps_higher=e.fpsH,alog("cus.fire","time",t)}),t.on("earthtilesloaded",function(e){var a={};a.z_earth_init_time=e.initTime,a.z_earth_tilesload_time=e.loadTime,alog("cus.fire","time",a),t.off("earthtilesloaded",arguments.callee)}),t.on("layertilesload",function(e){var a={};a.z_earth_layerload_time=e.layersLoadTime,alog("cus.fire","time",a),t.off("layertilesload",arguments.callee)}),t.on("earthlabelloaded",function(e){var a={};a.z_earth_labelload_time=e.loadTime,alog("cus.fire","time",a),t.off("earthlabelloaded",arguments.callee)}),t.on("webglcontextlost",function(){alog("cus.fire","count","z_webgl_context_lost")}),t.on("webglcontextrestored",function(){alog("cus.fire","count","z_webgl_context_restored")}),t.on("onsatelayerloaderror",function(){alog("cus.fire","count","z_satelayer_load_error")}),t.on("onstreetlayerloaderror",function(){alog("cus.fire","count","z_streetlayer_load_error")})}),map.addEventListener("dragend",userAuth.sendUserOp),map.addEventListener("zoomend",userAuth.sendUserOp),map.on("loadtile",function(){userAuth.sendImage(1)}),setInterval(function(){userAuth.sendImage(2)},3e5);var fstStartTime=(new Date).getTime();if(map.isCanvasMap())map.on("canvasmaploaded",function(){var e=(new Date).getTime(),t={z_canvasmaptime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("canvasmaploaded",arguments.callee)}),map.on("tilesloaded",function(){var e=(new Date).getTime(),t={z_bkgrdtime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("tilesloaded",arguments.callee)}),map.on("loaddatatimeout",function(e){var t={};if(t.z_timeoutVSnotimeout=1===e.noTimeoutCount?"notimeout":"timeout",alog("cus.fire","dis",t),1===e.timeoutCount){var a={z_timeoutloaded:e.timeoutLoaded,z_timeoutnoloaded:e.timeoutNoLoaded};alog("cus.fire","time",a)}}),map.on("canvasmaploaded",function(e){e.isAllLoadedDrawing&&alog("cus.fire","time",{z_totaldrawtime:e.drawTime})}),map.on("mapwhitescreen",function(){alog("cus.fire","count","z_mapwhitescreen")}),alog("cus.fire","count","z_vectormapcount");else if("webgl"===map.getRenderType()){map.on("firsttilesloaded",function(){var e=(new Date).getTime();this._firstLoadTime=e-fstStartTime}),BMap.Utils.canUseWebAssembly?alog("cus.fire","count","z_webgl_wasm"):alog("cus.fire","count","z_webgl_asm"),map.on("tileloaded",onEachTileLoad),setTimeout(function(){map.off("tileloaded",onEachTileLoad)},5e3),map.on("tilesloaded",function(){var e,t=(new Date).getTime();e=window.__newversion__?{z_webglmapfirsttime_binary:this._firstLoadTime,z_webglmaptime_binary:t-fstStartTime}:{z_webglmapfirsttime:this._firstLoadTime,z_webglmaptime:t-fstStartTime},alog("cus.fire","time",e),map.removeEventListener("tilesloaded",arguments.callee)}),map.on("fpsdata_ready",function(e){var t={};window.__newversion__?(t.z_webglmap_fps_binary=e.fps,t.z_webglmap_fps_higher_binary=e.fpsH):(t.z_webglmap_fps=e.fps,t.z_webglmap_fps_higher=e.fpsH),alog("cus.fire","time",t)}),map.on("tileloaderror",function(e){var t=e.error||"unknown";alog("cus.fire","count","z_"+t+(window.__newversion__?"_binary":""))});for(var eventNames=["rotatecwclick","rotateccwclick","compassclick","zoominclick","zoomoutclick","tiltmsdown","ontiltclick"],i=0;i<eventNames.length;i++)map.on(eventNames[i],sendOpClickStat);map.addEventListener("indoor_bar_show",function(){addStat&&addStat("indoor_show","show")}),map.addEventListener("indoor_bar_click",function(){addStat("indoor_bar_click","show")})}else map.on("tilesloaded",function(){var e=(new Date).getTime(),t={z_tilemaptime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("tilesloaded",arguments.callee)}),alog("cus.fire","count","z_rastermapcount");tilt&&map.setTilt(tilt,{noAnimation:!0}),heading&&map.setHeading(heading,{noAnimation:!0}),map.centerAndZoom(point,level),addMapCtrls(map),map.on("getmodules_fail",function(){alog("cus.fire","count","z_getmodulesfail")}),map.on("mod_timeout",function(e){e&&10===e.timeout?alog("cus.fire","count","z_modtimeout_10"):e&&5===e.timeout&&alog("cus.fire","count","z_modtimeout")}),require.async(["common:widget/ui/tangram/tangram.js","common:widget/ui/stat/statCode.js","common:widget/ui/init/init.js","common:widget/ui/stat/CodeStat.js","common:widget/com/IpLocation/IpLocation.js"],function(e,t,a,o,n){var i=decodeURI(document.URL).match(/testIp\=([^\&]*)/);i&&i[1]&&(iplocOpts.ip=i[1]),n.init(map,window.IPLOC,iplocOpts),a.init()})}(window);
;!function(t){function e(t){this.opts=t||{}}var n={};e.prototype.render=function(){try{throw new Error("Widget must implement function render")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"common:static/js/util/widget.js",ln:16})}},e.prototype.renderComplete=function(){try{}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"common:static/js/util/widget.js",ln:19})}},e.prototype.setPageData=function(t){t=t||{},this._data_=t},n.extend=function(t){var n=function(t){t=t||{},e.call(this,t)};return T.inherits(n,e,"Child"),T.extend(n.prototype,t),n},t.Widget=n}(window);