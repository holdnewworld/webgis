define("common:widget/com/SharePanel/SharePanel.js",function(t,e,n){function i(t,e){var n=e-t+1;return Math.floor(Math.random()*n+t)}function o(t){p.call(this,t)}var a=(t("common:widget/com/componentManager.js"),t("common:widget/ui/util/util.js")),r=t("common:widget/ui/mapUtil/mapUtil.js"),s=t("common:widget/ui/toolShare/ToolShare.js"),p=t("common:widget/com/BaseComponent.js"),d=t("common:widget/ui/PanoUtil/PanoUtil.js"),c=t("common:widget/ui/config/config.js"),h=(c.mapConfig,c.modelConfig,t("common:widget/ui/mapShare/MapShare.js"));o.modelList={PoiSearch:1,BusTrans:1,LinesQuery:1,BusLines:1,NavTrans:1,CBusTrans:1,Detail:1},o.ImgHost="http://q/#random#.baidu.com/it/u=#value#&fm=43",o.getFixImgSrc=function(t){var e=null,n="";try{if(e=baidu.json.parse(a.getParam(decodeURIComponent(t)).data),!e||!e.key)return t;n=e.key}catch(r){return t}return o.ImgHost.replace(/#random#/gi,i(1,8)).replace(/#value#/,n)},T.lang.inherits(o,p,"SharePanel"),T.object.extend(o.prototype,{render:function(){try{var e="#userSignCtrl .share .shareL{padding:0 94px 0 2px;*padding-right:96px;overflow:hidden}#userSignCtrl .share .shareBt{width:92px;height:24px;position:absolute;top:3px;right:2px;_right:1px;-zoom:1}#userSignCtrl .share .shareBt span{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/iw_bg_c0a8cf8.png) no-repeat;width:44px;height:24px;cursor:pointer}#userSignCtrl .share input,#userSignCtrl .share img,#userSignCtrl .share #cpShareCon{float:left}#userSignCtrl .share .us_tex{width:99%;height:19px;line-height:19px;border:#ccc solid 1px;color:#333;_display:inline;text-indent:4px}#userSignCtrl .share #usSharMes{position:absolute;top:0;right:93px;width:50px;display:none;height:17px;line-height:17px;padding:2px;color:#b36b47;border:1px solid #E6A15C;background:#fffdf2}#userSignCtrl .share .us_but{}#userSignCtrl .share .us_copy{border:0;*margin-left:-2px}#userSignCtrl .share .shareBt .us_return{background-position:-300px -87px;top:150px;float:right;_display:inline;overflow:hidden}#userSignCtrl .share .shareBt .us_return_over{background-position:-348px -87px}#userSignCtrl .share .shareBt .us_return_down{background-position:-396px -87px}#userSignCtrl .share #cpShareCon{background-position:-156px -87px;margin-left:2px;position:relative;overflow:hidden;_display:inline}#userSignCtrl .share #cpShareCon.on{background-position:-204px -87px}#userSignCtrl .share #cpShareCon.down{background-position:-252px -87px}#userSignCtrl .share #cpShareCon object{position:absolute;top:0;left:0}#userSignCtrl #cpShareCon_{color:#c00;display:none;height:20px;left:-220px;line-height:18px;*line-height:20px;padding-left:2px;position:absolute;text-align:left;top:0;width:198px;background:#FAEDD4;*zoom:1;z-index:100000}.mapshare_container,.poishare_container,.streetview_container{padding:6px 0 0 6px;white-space:normal}.getLinkInput{border:#a6a6a6 solid 1px;width:282px;height:21px;line-height:21px;*margin-top:-1px}#getLinkBtnCon{position:absolute;right:6px;top:32px;width:48px;height:26px}#getLinkBtnCon span{display:block;width:48px;height:26px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/share_btn_d2d7adc.png) no-repeat 0 0;cursor:pointer}#getLinkBtnCon .on{background-position:0 -28px}#getLinkBtnCon .down{background-position:0 -56px}#getLinkF{position:absolute;right:60px;*right:58px;top:32px;border:1px solid #E6A15C;background:#FFFDF2;color:#B36B47;height:23px;line-height:23px;padding:0 5px}.bds_tools{_overflow-x:hidden;z-index:999999;font-size:12px;float:left;text-align:left!important;zoom:1;height:25px;width:158px;overflow:hidden;+margin-left:5px}.bds_tools a{text-decoration:none;cursor:pointer}.bds_tools a:hover{color:#333;opacity:.8;filter:alpha(opacity=80)}.bds_tools img{border:0;margin:0;padding:0;cursor:pointer}span.bds_more,.bds_tools a{font-family:Arial,Helvetica,sans-serif;height:16px;float:left;display:block;padding-top:6px;padding-bottom:3px;padding-left:22px}span.bds_more{padding-left:0;+padding-top:7px}span.bds_btn_arr{display:block;float:left;height:16px;padding-top:6px;padding-bottom:3px;padding-left:22px;cursor:pointer;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bdshare_d642b88.png) 0 -6px no-repeat}.bds_tools a{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bdshare_d642b88.png) no-repeat;cursor:pointer}.bds_qzone{background-position:0 -85px!important}.bds_tsina{background-position:0 -125px!important}.bds_baidu{background-position:0 -165px!important}.bds_renren{background-position:0 -205px!important}.bds_tqq{background-position:0 -245px!important}.bds_kaixin001{background-position:0 -285px!important}.bds_hi{background-position:0 -365px!important}.bds_douban{background-position:0 -405px!important}.bds_tsohu{background-position:0 -445px!important}.bds_msn{background-position:0 -485px!important}.bds_fx{background-position:0 -525px!important}#bdshare_iwshare{margin-left:3px}#bdshare_iwshare.bds_tools{height:24px;_margin-top:-3px}#bdshare_iwshare.bds_tools a{padding-bottom:2px;+padding-bottom:4px}#bds_btn_arr_iwshare{_margin-top:-3px}";t.loadCss({content:e,name:"SharePanel"});var n=this.cinfo;this.fromkey=n.from||"mapshare",this.data=n.data;var i='<div class="'+this.fromkey+'_container" id="'+this.fromkey+'_container"></div>';return i}catch(o){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/com/SharePanel/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/com/SharePanel/SharePanel.js",ln:83})}},initialize:function(){try{switch(this.fromkey){case"iwshare":this.initIwShare();break;case"mapshare":case"poishare":case"streetview":this.initMapShare(this.fromkey)}}catch(t){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/com/SharePanel/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/com/SharePanel/SharePanel.js",ln:98})}},initMapShare:function(){var t=this,e=T.g(this.fromkey+"_container"),n=a.beforeEndHTML(e,'<span id="getLinkF" style="display:none;">复制成功</span><div id="getLinkBtnCon"></div><input type="text" class="getLinkInput" id="linkText" value="正在获取...">'),i=T.g("getLinkBtnCon"),o="";o='<span id="getLinkBtnSpan"></span>',i.innerHTML=o,"mapshare"===this.fromkey||"streetview"===this.fromkey?h.getLink(function(e){n.value=t.shortUrl=e,setTimeout(function(){n.select()},50)}):s.getLink(this.cinfo.linkinfo,function(e){n.value=t.shortUrl=e,setTimeout(function(){n.select()},50)}),i.addEventListener("click",function(){{var t=document.getElementById("getLinkF");n.select()}try{document.execCommand("copy",!1,null)||(t.innerHTML="复制失败，请手动复制")}catch(e){t.innerHTML="复制失败，请手动复制"}t.style.display="inline-block",window.setTimeout(function(){t.style.display="none"},2e3)}),this.addBdShareHtml(e),this.bindMapShare()},initIwShare:function(){var t=this,e=T.g(this.fromkey+"_container"),n=['<div class="shareL" id="iwBoxShareInput"><input type="text" class="us_tex" id="shareInupt" value="正在获取..."/></div>'];n.push('<div class="shareBt"><span id="cpShareCon" style="display:none"></span>'),n.push('<span class="us_but us_return" onclick="_sign.reShare()" title="返回" onmouseover="this.className = \'us_but us_return us_return_over\'" onmouseout="this.className = \'us_but us_return\'" onmousedown="this.className = \'us_but us_return us_return_down\'" onmouseup="this.className = \'us_but us_return us_return_over\'"></span>'),n.push('<span class="userShareMess" id="usSharMes">复制成功</span>'),n.push('<span id="cpShareCon_"></span></div>'),e.innerHTML=n.join(""),window._iwUrlCbk=function(n){t.shortUrl=n,t.addBdShareHtml(e)}},addBdShareHtml:function(t){t&&(a.beforeEndHTML(t,this.getBdShareHtml()),this.bindBdShare())},getBdShareHtml:function(){var t=s.keyList,e=['<div id="bdshare_#fromkey#" class="bds_tools"><span class="bds_more">分享到：</span>'];for(var n in t){var i=t[n].title;e.push('<a _key="'+n+'" class="bds_'+n+'" title="'+i+'"></a>')}return e.push('</div><span class="bds_btn_arr" id="bds_btn_arr_#fromkey#" title="更多网站"></span>'),e.join("").replace(/#fromkey#/gi,this.fromkey)||""},getShareInfo:function(){var t="（分享自@百度地图）",e="【百度全景】",n="",i=this.cinfo;switch(this.fromkey){case"mapshare":var a=window.currentComponent._className,r=s.getMInfo(),p=o.modelList;t=p[a]&&r.text&&r.className==a?r.text+" "+this.shortUrl+" "+t:(i.shareText||"")+" "+this.shortUrl+" "+t;break;case"iwshare":var d=[];d.push(s.fixName(this.data.title)),d.push(this.data.addr),d.push(this.data.tel),t=d.join(" ")+t,n=this.data.point;break;case"streetview":t=(i.shareText||"")+" "+this.shortUrl+" "+e}return{text:t,point:n}},getSingleData:function(t){var e=0,n=17,i=map.width,o=map.height,a=r._getPicType().replace(/,6/gi,""),s=',"coord":[{"type":1,"geo":"'+t+'","scode":"df:11"}]',p='{"retype":'+e+',"src":"snap", "logo":"df:logo", "level":'+n+',"center":"'+t+'","height":'+o+',"width":'+i+',"coordtype":"M","pictype":"'+a+'"'+s;return map.mapType===BMAP_SATELLITE_MAP&&(p+=',"suffix" : "jpg"'),p+="}"},getSharePic:function(e,n){var i=this;n?i.sendCaptureReq(i.getSingleData(n),e):t.async("common:widget/com/Capture/Capture.js",function(t){i.sendCaptureReq(t._getReqData(0,{fullsize:1}),e)})},sendCaptureReq:function(t,e){baidu.ajax("/?newmap=1",{dataType:"json",type:"POST",contentType:"application/x-www-form-urlencoded",data:"qt=prev&ie=utf8&data="+encodeURIComponent(t),success:function(t){if(!t||!t.content||!t.result||1==!t.result.error)return void(e&&e());var n=o.getFixImgSrc(t.content.image_url);e&&e(n)},error:function(){e&&e()}})},bindBdShare:function(){{var t=this,e=T.G("bdshare_"+this.fromkey),n=T.G("bds_btn_arr_"+this.fromkey);e.getElementsByTagName("a")}n.onclick=function(){var t=178,i=120,o=15,a=0;!function r(){o>a&&(a++,e.style.width=Math.ceil(s.Tween(a,t,i,o))+"px",setTimeout(r,10))}(),n.style.display="none"},T.on(e,"click",function(e){var n=e.target||e.srcElement,i=n.getAttribute("_key");n&&i&&t.openLink(window.open("about:blank"),i)})},openLink:function(t,e){if(t){var n=this.getShareInfo(),i=n.text,o=n.point,r=this.shortUrl+"#bshare-"+e;"fx"==e&&(r=this.shortUrl),this.getSharePic(function(n){var o="";("qzone"==e||"tsohu"==e)&&(n="../../../../../../../map.baidu.com/image/logo-map.png"/*tpa=http://map.baidu.com/image/logo-map.png*/),d&&d.isOpen&&(n=d.getPanoShare3DImageUrl(),o=i),addStat("indextool.share."+e);var s={to:e,url:r,pic:n,title:i,type:"text",desc:o,comment:" ",key:""};"tsina"==e&&(s.key="3694297746"),"tqq"==e&&(s.key="801199301");var p="http://share.baidu.com/s?"+a.jsonToQuery(s,encodeURIComponent);"renren"==e&&(s={resourceUrl:r,pic:n,title:i,description:o,charset:"UTF-8"},p="http://widget.renren.com/dialog/share?"+a.jsonToQuery(s,encodeURIComponent));try{t.location.href=p,t.focus()}catch(c){}},o)}},bindMapShare:function(){if(s.showMessage=function(){s.showMessage.timer&&clearTimeout(s.showMessage.timer),T.g("getLinkF")&&(T.g("getLinkF").style.display="inline"),s.showMessage.timer=setTimeout(function(){T.g("getLinkF")&&(T.g("getLinkF").style.display="none")},1e3)},T.browser.ie){var t=T.G("getLinkBtnSpan"),e=T.G("linkText");t.onclick=function(){window.clipboardData&&(window.clipboardData.clearData(),window.clipboardData.setData("Text",e.value),s.showMessage())},t.onmousedown=function(t){t=t||window.event,1==t.button&&(this.className="down")},t.onmouseover=function(){this.className="on"},t.onmouseout=function(){this.className=""},t.onmouseup=function(){this.className="up"}}}}),window.BShare=s,n.exports=o});