define("common:widget/print/NavTransPrint/NavTransPrint.js",function(e,t,s){function n(){T.lang.Class.call(this),map.clearOverlays=function(){},this.driveBounds=[],this.drivePoints=[],this.popPoints=[],this.popPois=[],this.groupIndex=[],this.groupPoints=[],this.groupBounds=[],this.dragPoints=[],this.groupIndex=[],this.groupPoints=[],this.groupBounds=[]}var i=e("common:widget/ui/util/util.js"),o=e("common:widget/ui/mapUtil/mapUtil.js"),l=e("common:widget/ui/config/config.js"),r=(l.mapConfig,e("common:widget/ui/constant/Constant.js")),p=e("common:widget/print/printUtil/printUtil.js");T.extend(n.prototype,{initialize:function(e){try{var t=e.json;map.removeContextMenu(window.contextMenu),map.disableScrollWheelZoom();var s=t.content.kps,n=t.content.rss,i=this;this.sCity=t.result.start_city,this.eCity=t.result.end_city,this.eCity=this.eCity[this.eCity.length-1],this.appendImg(p.JS("MapHolder"),"dest_markers.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/dest_markers.png*/,"../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png*/),this.appendImg(p.JS("MapHolder"),"trans_icons.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/trans_icons.png*/,"../../../images/ie6_trans_icons_345d50b.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png*/);for(var l=0,r=s.length;r>l;l++){var d=s[l].rt,m=o.parse2Geo(n[l].g);3!=d&&(this.drivePoints.push(m.points),this.driveBounds.push(m.bound),this.popPoints.push({p:o.parse2Geo(s[l].pt).points,a:s[l].a}));var h=parseInt(n[l].d);0==l?(this.dragPoints.push(o.parse2Geo(s[l].pt).points),h>=2e4&&this.groupIndex.push(l)):l==r-1?(this.dragPoints.push(o.parse2Geo(s[l].pt).points),h>=2e4&&this.groupIndex.push(l)):3!=d?h>=2e4&&this.groupIndex.push(l):this.dragPoints.push(o.parse2Geo(s[l].pt).points)}p.fillTaxiDes(t),this.sgi=this.egi=-1,this.sCity.code!=this.eCity.code&&(this.groupIndex.length>0&&(this.sgi=this.groupIndex[0]-1),this.groupIndex.length>=1&&(this.egi=this.groupIndex[this.groupIndex.length-1]+1));var u=n.length-2;if(-1!=this.sgi)for(var l=0,c=n.length;c>l;l++)l>0&&l<this.sgi&&(this.groupPoints[0]||(this.groupPoints[0]=[]),this.groupPoints[0].push(this.drivePoints[l]),this.groupBounds[0]||(this.groupBounds[0]=[]),this.groupBounds[0].push(this.driveBounds[l]));if(-1!=this.egi){this.egi=-1!=this.sgi?this.egi+2:this.egi,this.egi=this.egi>u?u:this.egi;for(var l=0,c=n.length;c>l;l++)l>this.egi&&(this.groupPoints[1]||(this.groupPoints[1]=[]),this.groupBounds[1]||(this.groupBounds[1]=[]),-1==this.sgi?(this.groupPoints[1].push(this.drivePoints[l-1]),this.groupBounds[1].push(this.driveBounds[l-1])):(this.groupPoints[1].push(this.drivePoints[l-2]),this.groupBounds[1].push(this.driveBounds[l-2])))}for(var g=(p.JS("startInfo"),p.JS("endInfo"),t.result.start.wd),v=t.result.end.length,y=t.result.end[v-1].wd,N=p.JS("navDis"),f=p.JS("table_info0"),b=p.JS("busList"),S={},B=f.getElementsByTagName("li"),M=B.length,T=-1,C=0,E=null,w=(document.createDocumentFragment(),p.JS("searchValue")),J=p.JS("navStrategy").getElementsByTagName("div"),L="",P=0,_=J.length;_>P;P++)if(J[P].checked)switch(J[P].id){case"type0":L="最少时间";break;case"type1":L="最短路程";break;case"type2":L="不走高速";break;default:L="未知"}var D='<li class="starting"><div class="startingTitle"><strong>起点：</strong>'+g+'</div><div class="distance">共'+N.innerHTML+"</div></li>",I='<li class="starting"><div class="startingTitle"><strong>终点：</strong>'+y+"</div></li>",A="<li>起点：<strong>"+g+"</strong></li><li>终点：<strong>"+y+"</strong></li><li>距离：<strong>"+N.innerHTML+"</strong></li><li>方案：<strong>"+L+"</strong></li>";b.innerHTML=D;for(var l=0;M>l;l++)E=B[l],E.innerHTML?(T++,S[T]=E.innerHTML,S["s"+T]={},C=0):S["s"+T][C++]=E.innerHTML;for(var k=document.createElement("li"),H=null,x=null,R=document.createElement("ul"),O=null,j=document.createDocumentFragment(),G=document.createDocumentFragment(),F=0,T=0;M>F;F++){if(H=k.cloneNode(!0),a=F,"string"==typeof S[F]){var V=document.createElement("span"),U=document.createElement("div");H.className="singleLine",V.className="num",V.innerHTML=F+1,U.className="hd",U.innerHTML=S[F]+'<div class="openCloseButton" num="'+F+'"><span>展开地图</span></div>',H.appendChild(V),H.appendChild(U),H.innerHTML+='<div class="smallMap"><div class="firstMapBox" id="smallMapBox'+F+'"></div></div>',j.appendChild(H)}if(S["s"+F]&&S["s"+F][0]){O=R.cloneNode(!0),O.className="urbanRoutes";var Z=document.createElement("div"),X=0;for(var z in S["s"+F]){var Y=Z.cloneNode(!0);Y.className="hd",x=k.cloneNode(!0),Y.innerHTML=S["s"+F][z]+'<a class="openCloseSmallMap">展开地图</a>',x.appendChild(Y);var T=0==F?"0":"1";x.innerHTML+='<div class="bd"><div class="sSmallBox" id="sSmallMapBox'+T+"_"+X+'"></div></div>',G.appendChild(x),X++}O.appendChild(G),H.appendChild(O)}}b.appendChild(j),b.innerHTML+=I;for(var W=b.getElementsByTagName("br");W.length;)for(var W=b.getElementsByTagName("br"),q=0,K=W.length;K>q;q+=1)W[q]&&W[q].parentNode.removeChild(W[q]);for(var Q=b.getElementsByTagName("font"),$=0,et=Q.length;et>$;$++)Q[$]&&(Q[$].style.cssFloat?Q[$].style.cssFloat="none":Q[$].style.styleFloat="none",Q[$].style.marginLeft="6px");for(var tt=p.JS.getElementByClassName("close","busList"),st=0,nt=tt.length;nt>st;st++){var it='<a class="detailsOpen" href="">详情</a><a href="" class="displayDetailsMap" >显示详情地图</a>',at=tt[st].parentNode;tt[st].parentNode.removeChild(tt[st]),at.innerHTML+=it}w.innerHTML=A,p.JS("ulE").style.display="none",p.JS("resultTitle").innerHTML="具体路线:",p.JS("resultControl").style.display="",p.JS("remindMsg").innerHTML="百度提醒您：以上的路线信息仅供参考";for(var ot=p.JS.getElementByClassName("singleLine"),l=0,c=ot.length;c>l;l++){var lt=p.JS.getElementByClassName("detailsOpen",ot[l]),rt=p.JS.getElementByClassName("displayDetailsMap",ot[l]),pt=p.JS.getElementByClassName("smallMap",ot[l]),dt=p.JS.getElementByClassName("urbanRoutes",ot[l]),mt=p.JS.getElementByClassName("openCloseButton",ot[l]);ot[l].onmouseover=p.listH;var ht=this;ot[l].onmouseout=p.listNh,ot[l].setAttribute("openswith","true"),ot[l].onclick=function(e,t){return function(s){return"true"!==e.getAttribute("openswith")?!1:(t.onclick(s),void e.setAttribute("openswith","false"))}}(ot[l],mt[0]),mt.length&&!function(e,t){mt[0].onclick=function(s){var n=this,a=s||window.event,o=p.JS("textDisplay"),l=(p.JS("mapDisplay"),"smallMapBox"+this.getAttribute("num")),r=p.JS.getElementByClassName("smallMap","busList"),d=[];if("openCloseButton"===this.className){if(null===this.getAttribute("data-map")){var m=new BMap.Map(l,{coordType:BMAP_COORD_MERCATOR});m.centerAndZoom(new BMap.Point(12957320,4825100),12),mapType==BMAP_TYPE_DIMENSIONAL&&(m.setCurrentCity(paramExt.cc),m.setMapType(mapType)),m.addControl(new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_ZOOM})),ht.addDrvRoute(m),ht.addDrvPoi(m),this.mapBox=m,setTimeout(function(){n.mapBox&&ht.highRoute(m,t,-1)},80),this.setAttribute("data-map","ok"),e.setAttribute("data-map","ok"),setTimeout(function(){i.appendImg(p.JS(l),"dest_markers.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/dest_markers.png*/,"../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png*/),i.appendImg(p.JS(l),"trans_icons.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/trans_icons.png*/,"../../../images/ie6_trans_icons_345d50b.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png*/)},200)}e.style.display="block","LI"!==this.parentNode.NodeName?this.parentNode.parentNode.setAttribute("openswith","false"):this.parentNode.setAttribute("openswith","false"),this.innerHTML="<span class='putWway'>收起地图</span>",this.className="CloseButton","Selected"===o.className&&(o.className="",o.onclick=function(){return p.allSmallMapNone(),this.className="Selected",!1});for(var h=0,u=r.length;u>h;h++)"block"===r[h].style.display&&d.push(r[h]);d.length===u&&(p.JS("mapDisplay").className="Selected"),p.JS.stopBubbleEvent(a)}else{e.style.display="none","LI"!==this.parentNode.NodeName?(this.parentNode.parentNode.setAttribute("openswith","true"),this.parentNode.parentNode.className="singleLine"):(this.parentNode.setAttribute("openswith","true"),this.parentNode.className="singleLine"),this.className="openCloseButton",this.innerHTML="<span>展开地图</span>";for(var h=0,u=r.length;u>h;h++)"block"===r[h].style.display&&d.push(r[h]);0===d.length&&(o.className="Selected"),"Selected"===p.JS("mapDisplay").className&&(p.JS("mapDisplay").className=""),p.JS.stopBubbleEvent(a)}return p.JS.stopBubbleEvent(a),!1}}(pt[0],l),lt.length&&!function(e){lt[0].onclick=function(t){var s=t||window.event;return"detailsClose"===this.className?(this.nextSibling.style.display="none",e.style.display="none",this.className="detailsOpen",p.JS.stopBubbleEvent(s)):(this.nextSibling.style.display="inline",e.style.display="block",this.className="detailsClose",p.JS.stopBubbleEvent(s)),!1}}(dt[0],l),rt.length&&!function(e){rt[0].onclick=function(t){var s=p.JS.getElementByClassName("urbanRoutes",ot[e])[0],n=s.getElementsByTagName("li"),i=p.JS.getElementByClassName("bd",s),a=p.JS.getElementByClassName("openCloseSmallMap",s),o=t||window.event,l={type:o.type,target:o.target||o.srcElement,clientX:o.clientX};if("显示详情地图"===this.innerHTML){var r=0,d=n.length;setTimeout(function(){n[r].onclick(l),r++,d>r&&setTimeout(arguments.callee,100)},100),this.innerHTML="收起详情地图"}else{for(var m=0,h=i.length;h>m;m++)"block"===i[m].style.display&&(i[m].style.display="none");for(var u=0,c=n.length;c>u;u++)n[u].setAttribute("openswith","true");for(var g=0,v=a.length;v>g;g++)a[g].innerHTML="展开地图";this.innerHTML="显示详情地图"}return p.JS.stopBubbleEvent(o),!1}}(l)}for(var ut=p.JS.getElementByClassName("urbanRoutes"),l=0,c=ut.length;c>l;l++){ut[l].onclick=function(e){var t=e||window.event;p.JS.stopBubbleEvent(t)};for(var ct=p.JS("li",ut[l]),gt=0,r=ct.length;r>gt;gt++)!function(e,t){var s=p.JS.getElementByClassName("openCloseSmallMap",ct[t])[0];ct[t].setAttribute("openswith","true"),ct[t].onmouseover=function(){"smallHover"!==this.className&&(this.className="smallHover")},ct[t].onmouseout=function(e){var t=e||window.event;this.className="",p.JS.stopBubbleEvent(t)},ct[t].onclick=function(e,t){return function(s){return"true"!==e.getAttribute("openswith")?!1:(t.onclick(s),void e.setAttribute("openswith","false"))}}(ct[t],s),s&&!function(n){s.onclick=function(s){var i=s||window.event,a=this,o=p.JS.getElementByClassName("bd",n)[0],l=p.JS.getElementByClassName("hd",n)[0],r=p.JS.getElementByClassName("openCloseSmallMap",l)[0],d=p.JS.getElementByClassName("bd",ut[e]),m=[],h=ut[e].parentNode,u=p.JS.getElementByClassName("displayDetailsMap",h)[0];if(null===this.getAttribute("data-map")){var c="sSmallMapBox"+e+"_"+t,g=new BMap.Map(c,{coordType:BMAP_COORD_MERCATOR,enableCanvas2dMap:!1});g.centerAndZoom(new BMap.Point(12957320,4825100),12),mapType==BMAP_TYPE_DIMENSIONAL&&(g.setCurrentCity(paramExt.cc),g.setMapType(mapType)),g.addControl(new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_ZOOM})),ht.addDrvRoute(g,1),ht.addDrvPoi(g),a.mapBox=g,setTimeout(function(){a.mapBox&&(-1!=ht.sgi&&-1!=ht.egi?(0==e&&ht.highRoute(g,t,-1),1==e&&ht.highRoute(g,t+ht.egi-2,-1)):-1!=ht.sgi?ht.highRoute(g,t,-1):-1!=ht.egi&&ht.highRoute(g,t+ht.egi,-1),ht.appendImg(p.JS(c),"dest_markers.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/dest_markers.png*/,"../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png*/),ht.appendImg(p.JS(c),"trans_icons.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/trans_icons.png*/,"../../../../../../staitc/images/ie6_trans_icons.png"/*tpa=http://webmap2.map.bdstatic.com/staitc/images/ie6_trans_icons.png*/))},80),o.style.display="block",this.setAttribute("data-map","ok"),o.setAttribute("data-map","ok");for(var v=d.length,y=v;y--;)"block"===d[y].style.display&&m.push(d[y]);m.length===v&&"显示详情地图"===u.innerHTML&&(u.innerHTML="收起详情地图"),r.innerHTML="收起地图",this.parentNode.parentNode.setAttribute("openswith","false"),p.JS.stopBubbleEvent(i)}else if("none"===o.style.display){o.style.display="block",r.innerHTML="收起地图",this.parentNode.parentNode.setAttribute("openswith","false"),p.JS.stopBubbleEvent(i);for(var v=d.length,y=v;y--;)"block"===d[y].style.display&&m.push(d[y]);m.length===v&&"显示详情地图"===u.innerHTML&&(u.innerHTML="收起详情地图")}else o.style.display="none",this.parentNode.parentNode.setAttribute("openswith","true"),"收起详情地图"===u.innerHTML&&(u.innerHTML="显示详情地图"),r.innerHTML="展开地图",p.JS.stopBubbleEvent(i)}}(ct[t],t)}(l,gt)}p.JS("mapDisplay").onclick=function(e){if("Selected"!==this.className){this.className="Selected",p.JS("textDisplay").className="","none"===p.JS("busList").parentNode.style.display&&p.JS("lineControl").onclick();var t=p.JS.getElementByClassName("openCloseButton","busList");evt=e||window.event;var s={type:evt.type,target:evt.target||evt.srcElement,clientX:evt.clientX},n=0,i=t.length;setTimeout(function(){t[n].onclick(s),"ok"===t[n].getAttribute("data-map")&&n++,i>n&&setTimeout(arguments.callee,100)},100)}return!1}}catch(vt){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/print/NavTransPrint/exception.fire","catch",{msg:vt.message||vt.description,path:"common:widget/print/NavTransPrint/NavTransPrint.js",ln:604})}},addDrvRoute:function(e,t){for(var s=this.drivePoints,n=[],i=t?6:4,a=Math.pow(2,BMap.MapType[e.mapType].zoomLevelMax-e.zoomLevel-i),l=1,p=s.length;p-1>l;l++){var d=o.cutPoints(s[l],a);n.push(d)}o.addRoute(n.join(";"),r.ROUTE_TYPE_DRIVE,"",e)},addDrvPoi:function(e){for(var t=0,s=this.dragPoints.length;s>t;t++){var n=this.dragPoints[t];0==t?o.addDestPoi(n,"",r.DEST_START,"",e):t==s-1?o.addDestPoi(n,"",r.DEST_END,"",e):o.addDestPoi(n,"",r.DEST_MIDDLE,"",e)}},highRoute:function(e,t,s){var n=this.popPoints;if(-1!=s){if(0==s){var a=n[0].p.toString(),l=this.sgi-1,r=n[l].p.toString(),p=parseInt(n[0].a),d=parseInt(n[l].a);o.addDrvDirIcon(a,p,e),o.addDrvDirIcon(r,d,e)}else if(1==s){var a=n[this.egi-2].p.toString(),r=n[n.length-2].p.toString(),p=parseInt(n[this.egi-2].a),d=12;o.addDrvDirIcon(a,p,e),o.addDrvDirIcon(r,d,e)}var m=this.groupBounds[s],h=i.getBPoints(m);e.setViewport(h)}else{var a=n[t].p.toString(),r=n[t+1].p.toString(),p=parseInt(n[t].a),d=parseInt(n[t+1].a);t+1==this.popPoints.length-2&&(d=12);var m=(o.addDrvDirIcon(a,p,e),o.addDrvDirIcon(r,d,e),[this.driveBounds[t+1]]),h=i.getBPoints(m);e.setViewport(h)}},appendImg:function(e,t,s){var n=p.findAlphaImageLoader("div",e,t),i=document.createElement("img");if(i.className="ie6_print",i.src=s,n.length)for(var a=0,o=n.length;o>a;a++){var l=n[a],r=i.cloneNode(!0);l.className="noprint",r.style.top=l.style.top,r.style.left=l.style.left,l.parentNode.appendChild(r)}}}),s.exports=n});