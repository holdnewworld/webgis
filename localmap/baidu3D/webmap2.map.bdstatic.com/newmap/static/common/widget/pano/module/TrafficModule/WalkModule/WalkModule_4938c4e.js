define("common:widget/pano/module/TrafficModule/WalkModule/WalkModule.js",function(require,exports,module){var Animation=require("common:widget/ui/Animation/Animation.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),WalkRoute=require("common:widget/pano/model/WalkRoute.js"),service=require("common:widget/pano/base/service.js");require.loadCss({content:".walk-header-icon{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/walk-icon_5a0143a.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/walk-icon-8_09dfd2a.png)}#walk-tableview-container .traffic-image{height:105px}#walk-tableview-container .traffic-image-desc-wapper{height:105px}#walk-tableview-container .tableview-selected-border{height:101px}"});var ITEM_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="traffic-image-item">    <div class="traffic-image-wapper">        '),src?_template_fun_array.push('            <img class="traffic-image" src="',"undefined"==typeof src?"":src,'" onerror="this.src=&#39;',"undefined"==typeof error_src?"":error_src,'&#39;" />        '):_template_fun_array.push('            <img class="traffic-image" src="',"undefined"==typeof error_src?"":error_src,'" />        '),_template_fun_array.push('        <div class="traffic-image-desc-wapper">            <div class="traffic-image-desc-bg"></div>            <div class="traffic-image-desc">                <span class="traffic-image-desc-index">',"undefined"==typeof index?"":index,' ) </span>                <div class="traffic-image-desc-text">',"undefined"==typeof desc?"":desc,"</div>            </div>        </div>    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],IMG_ERROR_URL="../../../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/img_error_8d3eb72.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/img_error_8d3eb72.png*/,OVERVIEW_SIZE=315,SHOW_DESC_DELAY=400,SHOW_DESC_DURATION=150,privateMethod=function(){function e(){clearTimeout(i)}function t(e){var t=T(e).find(".traffic-image-desc-wapper"),a=t.attr("status");a>0||(-1==a&&r&&r.stop(),t.css("top","100%"),t.css("display","block"),t.attr("status","1"),n=new Animation.Animation,n.build({fps:60,transition:Animation.Transitions.easeOutQuad,duration:SHOW_DESC_DURATION,render:function(e){try{t.css("top",100*(1-e)+"%")}catch(a){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/TrafficModule/WalkModule/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/TrafficModule/WalkModule/WalkModule.js",ln:54})}},finish:function(){t.attr("status","2")}}))}function a(e){var t=T(e).find(".traffic-image-desc-wapper"),a=t.attr("status");if(!(0>a)){if(1==a)return n&&n.stop(),t.css("top","100%"),void t.attr("status","-2");r=new Animation.Animation,t.attr("status","-1"),r.build({fps:60,transition:Animation.Transitions.easeOutQuad,duration:SHOW_DESC_DURATION,render:function(e){try{t.css("top",100*e+"%")}catch(a){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/TrafficModule/WalkModule/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/TrafficModule/WalkModule/WalkModule.js",ln:82})}},finish:function(){t.attr("status","-2")}})}}var i=0,n=null,r=null,o={renderStepList:function(e){try{var t=e.steps,a=this.tableView,i=t.length;util.each(t,function(e,n){var r={index:n+1,src:"",error_src:IMG_ERROR_URL,desc:e.text};if(r.src=e.pid?util.getImage3DUrl(null,e.pid,e.dir,10,196,105):IMG_ERROR_URL,n!=i-1||e.pid!=t[i-2].pid){var o=ITEM_TEMPLATE(r);a.addItemContent(o)}}),a.resize()}catch(n){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/TrafficModule/WalkModule/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/TrafficModule/WalkModule/WalkModule.js",ln:115})}},mouseEnterHandler:function(a,n){var r=this.tableView.getSelectIndex();r!==n&&(e(),i=setTimeout(function(){t(a)},SHOW_DESC_DELAY)),this.tableView.fitImage(n);var o=this.route.getSchemeTransfer(),s=o.steps,d=s[n].point;d.x&&d.y&&this.dispatchEvent("show_position",{data:{x:d.x,y:d.y}})},mouseLeaveHandler:function(t,i){var n=this.tableView.getSelectIndex();n!==i&&(e(),a(t)),this.dispatchEvent("hide_position")},clickHandler:function(i){var n=this.tableView.getSelectIndex();if(i!==n){var r=this.tableView.getSelectItem();r&&(e(),a(r)),this.tableView.setSelectIndex(i),r=this.tableView.getSelectItem(),t(r);var o=this.route.getSchemeTransfer(),s=o.steps,d=s[i];this.dispatchEvent("hide_position"),this.dispatchEvent("pano_changed",{data:{source:this.getName(),panoHeading:d.dir,panoId:d.pid}})}},renderHeader:function(e,t,a){try{var i=t.wd+" > "+a.wd,n=document.createElement("div");n.className="traffic-header-bar",n.innerHTML=['<p class="traffic-header-wapper">','<i class="traffic-header-icon walk-header-icon"></i>','<span class="traffic-header-text" title="'+i+'">'+i+"</span>","</p>"].join(""),e.appendChild(n)}catch(r){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/TrafficModule/WalkModule/exception.fire","catch",{msg:r.message||r.description,path:"common:widget/pano/module/TrafficModule/WalkModule/WalkModule.js",ln:191})}},addMarkers:function(){var e=this.route.getStart(),t=this.route.getEnd(),a=util.each([e,t],function(e){var t={markerId:util.getUniqueId("MARKER_ST"),addr:e.name,catalog:e.poiType,heading:e.dir,name:e.name,pid:e.pid,pitch:0,poiuid:e.uid||"",px:1*e.panox,py:1*e.panoy,rank:0,x:1*(e.x||e.point.x),y:1*(e.y||e.point.y)};return t},!0);this.dispatchEvent("add_markers",a)}};return o}(),WalkModule=ModuleClass.extend("WalkModule",{initialize:function(e,t,a){try{if(!(window.currentComponent&&"NavWalk"===currentComponent.name||this.$shareParam))return;this.enterPanoData=a,this.headerContainer=t;var i=this;this.tableView=e,e.addEventListener("mouseenter",function(e,t){privateMethod.mouseEnterHandler.call(i,t.elem,t.index)}),e.addEventListener("mouseleave",function(e,t){privateMethod.mouseLeaveHandler.call(i,t.elem,t.index)}),e.addEventListener("click",function(e,t){privateMethod.clickHandler.call(i,t.index),addStat(STAT_CODE.STAT_PANORAMA,{item:"walkalbum-click"})});var n,r=void 0,o=this.route=new WalkRoute,i=this;o.fetch().then(function(){return o.getSchemeTransfer(0,0)}).then(function(e){privateMethod.renderStepList.call(i,e),i.fire("ready")}),this.$shareParam&&(r=this.$shareParam.index),this.walkParam=n}catch(s){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/TrafficModule/WalkModule/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/pano/module/TrafficModule/WalkModule/WalkModule.js",ln:260})}},getClosestPoint:function(){return null},getRoutParam:function(){return""},getRoutPoints:function(){return[]},getStartEndPoint:function(){var e=this.route.getStart(),t=this.route.getEnd();return e.type=0,t.type=1,{start:e,end:t}},getMarkers:function(){return[]},show:function(e){this.dispatchEvent("layout_changed",{display:!0});var t=this.getStartEndPoint();privateMethod.renderHeader.call(this,e,t.start,t.end),privateMethod.addMarkers.call(this)},dispose:function(){this.tableView.dispose(),this.tableView=null,this.route.dispose(),T.un(window,"resize",this._resizeHandler)},getShareParam:function(){var e=this.tableView.getSelectIndex();return{index:e}},event_panoChanged:function(e){if(this.route){var t=void 0,a=this.route.getSchemeTransfer(),i=this.tableView.getSelectIndex(),n=a.steps[i];if(!n||e!=n.pid)if(util.each(a.steps,function(a,i){return e==a.pid?(t=i,!0):void 0}),void 0!==t)privateMethod.clickHandler.call(this,t,!0);else{var r=this.tableView.getSelectItem(),o=this.tableView.getSelectIndex();this.tableView.setSelectIndex(null),privateMethod.mouseLeaveHandler.call(this,r,o)}}}});module.exports=WalkModule});