define("common:widget/pano/module/PanoModule/FlashRender/FlashWraper.js",function(e,n,o){function a(e,n,o){T.lang.Class.call(this),this._flashDom=null,this._flashContainer=n,this._jsForFlashEventHandlers=null,this.initialize(e,o)}{var i=e("common:widget/pano/module/PanoModule/FlashRender/FlashUtil.js");e("common:widget/pano/module/PanoModule/FlashRender/FlashInterface.js")}a.FLASH_LOAD_FILE="../../../../../swf/pano_whole/FullscreenPanoLoader_8aff741.swf"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/swf/pano_whole/FullscreenPanoLoader_8aff741.swf*/,a.FLASH_SCAPE_FILE="../../../../../swf/pano_whole/BDStreetScape_68a50a0.swf"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/swf/pano_whole/BDStreetScape_68a50a0.swf*/,T.lang.inherits(a,T.lang.Class,"PanoFlashWraper"),T.object.extend(a.prototype,{initialize:function(e,n){try{this._createFlash(e,this._flashContainer,n),this._decorateFlash(),this._flashDom=i.getSwf("PanoramaFlash"+this.guid)}catch(o){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoModule/FlashRender/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoModule/FlashRender/FlashWraper.js",ln:42})}},doAction:function(e,n){"closePano"==e&&this._dispose(),this._flashDom.doAction&&this._flashDom.doAction(e,n)},gotoPOI:function(e){var e={id:e.uid,pid:e.panoId,x:100*e.x,y:100*e.y,rank:e.rank,panox:100*e.panoX,panoy:100*e.panoY,dir:e.panoHeading,pitch:e.panoPitch,poiLinex:e.poiLinex,poiLiney:e.poiLiney,tourId:e.tourId};this._flashDom.doAction("gotoPOI",e)},drawLineToPoint:function(e,n,o,a,i,t,s){var h=function(e,n){this.removeEventListener("draw_line_complete",h),s(n.data)};this.addEventListener("draw_line_complete",h),this._flashDom.doAction("drawPOILine",{pointX:100*a,pointY:100*i,pointRank:t,startX:n,startY:o,id:e||""})},setRoutParam:function(e){this.set("routParams",e)},closePano:function(){this._dispose()},addMarkers:function(e){this._flashDom.doAction("addMarkers",e)},hideRegion:function(){this._flashDom.doAction("hideRegion")},removeMarkers:function(e){this._flashDom.doAction("removeMarkers",e)},getMarkerUidInBestPano:function(){return this._flashDom.get("markerUidInBestPano")},playRouteVideo:function(e){return this._flashDom.doAction("playPanoVideo",e)},closeRouteVideo:function(){return this._flashDom.doAction("closePanoVideo")},get:function(e){return this._flashDom.get(e)},set:function(e,n){if("panoOptions"==e){var o=this._getContainerSize(this._flashDom);if(n.keepPov===!0){var a=this._flashDom.get("panoOptions");n.panoHeading=a.panoHeading,n.panoPitch=a.panoPitch}n={panoType:n.panoType,id:n.panoId||n.panoIId,pid:n.panoId,iid:n.panoIId,poiuid:n.panoUId,heading:n.panoHeading,pitch:n.panoPitch,zoom:n.panoZoom,width:o.width,height:o.height}}this._flashDom&&this._flashDom.set&&this._flashDom.set(e,n)},_decorateFlash:function(){this._bindJSEvent()},_dispose:function(){this._takeOffDecorateFlash(),this._flashContainer=null},_takeOffDecorateFlash:function(){this._removeJSEvent()},_removeJSEvent:function(){baidu.un(this._flashContainer,T.browser.firefox?"DOMMouseScroll":"onmousewheel",this._jsForFlashEventHandlers.mouseWheelHandler),baidu.un(window,"onresize",this._jsForFlashEventHandlers.resizeHandler)},_bindJSEvent:function(){var e=this;e._jsForFlashEventHandlers={},e._jsForFlashEventHandlers.mouseWheelHandler=function(n){var o=-n.detail/3||n.wheelDelta/120,a=e.get("zoom")+o;e.set("zoom",a),n.preventDefault()},e._jsForFlashEventHandlers.resizeHandler=function(){var n=e._getContainerSize(e._flashContainer);e.set("size",{width:n.width,height:n.height})},baidu.on(e._flashContainer,T.browser.firefox?"DOMMouseScroll":"onmousewheel",e._jsForFlashEventHandlers.mouseWheelHandler),baidu.on(window,"onresize",e._jsForFlashEventHandlers.resizeHandler)},_createFlash:function(e,n,o){var t=this._getFlashVars(e,n,o);i.create({id:"PanoramaFlash"+this.guid,width:"100%",height:"100%",allowscriptaccess:"always",scale:"showall",wmode:"opaque",quality:"high",url:a.FLASH_LOAD_FILE,ver:"10",errorMessage:"您未安装Flash Player播放器或者版本过低",vars:t},n)},_getFlashVars:function(e,n,o){var i=this._getContainerSize(n),t="",s="";"undefined"!=typeof e.panoHeading&&(t=e.panoHeading),"undefined"!=typeof e.panoPitch&&(s=e.panoPitch);var h={pid:e.panoId||"",iid:e.panoIId||"",poiuid:e.panoPoiUid||"",panoType:e.panoType||"",heading:t,pitch:s,width:i.width,height:i.height,panoUrl:a.FLASH_SCAPE_FILE,domain:o.PANO_SERVICE_URL,panoTileUrl:o.PANO_TILE_URL,udtVersion:o.PANO_UDT_VERSION,jsInterfaceNamespace:"Pano.PanoFlashInterface",swfIndex:this.guid};return h},_getContainerSize:function(e){return{width:e.clientWidth,height:e.clientHeight}}}),o.exports=a});