define("common:widget/ui/transInfoWindow/transInfoWindow.js",function(n,t,i){function e(n,t,i){return n.replace(/[\u0100-\uffff]/g,"##").length>t?n=n.substring(0,parseInt(t/2)-1)+i:n}function o(n){if(n){var t=e(n,26,"..."),i=["<p class='iw_poi_title' title='"+n+"'>"+t];return i.push("<a id='trans_zoom_out' style='display:none' href='javascript:void(0)'>缩小</a>"),i.push("<a id='trans_zoom_in' href='javascript:void(0)'>放大</a></td>"),i.push("</p>"),i.join("")}}function a(n){var t=n.content,i=n.curIndex,o=n.total,a=n.nextInfo,s=["<div class='iw_poi_content'>"];if(t&&s.push("<div class='iw_trans_content'>"+t+"</div>"),s.push("<div id='trans_info_content'></div>"),s.push('<table width="99%" cols="2" class="iw_trans_nav"><tbody><tr>'),s.push('<td nowrap="nowrap" width="50%" align="left">'),s.push(0==i?'<span class="trans_disabled" >上一步</span>':'<a id="trans_prev" href="javascript:void(0)">上一步</a>'),s.push("</td>"),s.push('<td nowrap="nowrap" width="50%" align="right">'),i==o-1)s.push('<span class="trans_disabled" >下一步</span>');else{var d=e(a,25,"...");s.push('<a id="trans_next" href="javascript:void(0)">下一步</a>'),s.push('<span style="color:#6b6b6b" title="'+a+'">('+d+")</span>")}return s.push("</td></tr></tbody></table>"),s.join("")}function s(){var n=T.G("trans_zoom_in"),t=T.G("trans_zoom_out");n&&t&&(map.zoomLevel==BMap.MapType[map.mapType].zoomLevelMax?(n.style.display="none",t.style.display="inline"):(n.style.display="inline",t.style.display="none"))}function d(n,t){var i=t.curIndex,e=t.nextTransCbk,o=t.zoomTransCbk,a=t.obj;n.addEventListener("open",function(){n.removeEventListener("open",arguments.callee)}),n.addEventListener("open",function(){var n=T.G("trans_prev"),t=T.G("trans_next"),d=T.G("trans_zoom_in"),r=T.G("trans_zoom_out");n&&T.on(n,"click",function(){e&&"function"==typeof e&&e(i-1,a),addStat("schemeinfowin.blcheckbysteps.prestep")}),t&&T.on(t,"click",function(){e&&"function"==typeof e&&e(i+1,a),addStat("schemeinfowin.blcheckbysteps.nextstep")}),d&&r&&(T.on(d,"click",function(){o&&"function"==typeof o&&o(0,a),d.style.display="none",r.style.display="inline"}),T.on(r,"click",function(){o&&"function"==typeof o&&o(1,a),d.style.display="inline",d.style.display="none"})),s()}),map.addEventListener("zoomend",s),n.addEventListener("close",function(){map.removeEventListener("zoomend",s)})}function r(n,t,i){var e=T.g("lfsPanel");e.style.display=t?"block":"none",e.innerHTML=i?i:"",poiUidObj[iwuid].iw.redraw()}function l(n,t,i,e,o,a){var s,d,l,p=t.indexOf("_"),u=[];if(p>=0&&(s=t.split("_"),d=s[0],l=s[1]),poiUidObj[a].link){var f=poiUidObj[a].guid.split("_")[0];f!=d&&f!=l&&(T.rc(poiUidObj[a].link,"active"),T.ac(n,"active"),poiUidObj[a].link=n,poiUidObj[a].guid=t)}else T.ac(n,"active"),poiUidObj[a].link=n,poiUidObj[a].guid=t;var h="bsl&newmap=1&c="+o+"&uid="+(d?d:t)+"&ie=utf-8&t="+(new Date).getTime();c.fetch(h,function(n){var t=n.content[0];u.push("<dl tid='iwLineBox' class='lfs'><dt>"+t.name),p>=0&&u.push(" <a href='javascript:void(0)' onclick='getLFS(this, \""+l+"_"+d+'", "'+i+'", '+e+", "+o+', "'+a+"\");return false;'>返程</a>"),u.push('</dt><dd><table cellspacing="1" cellpadding="0" width="100%">'),t.startTime&&t.endTime?u.push("<tr><th>起点站首末班时间</th><td>"+t.startTime+" - "+t.endTime+"</td></tr>"):(t.startTime&&u.push("<tr><th>起点站首班时间</th><td>"+t.startTime+"</td></tr>"),t.endTime&&u.push("<tr><th>起点站末班时间</th><td>"+t.endTime+"</td></tr>")),t.maxPrice&&u.push("<tr><th>单程最高票价</th><td>"+(t.maxPrice/100).toFixed(2)+"元</td></tr>"),u.push("</table></dd></dl>"),r(i,!0,u.join(""))})}{var p=n("common:widget/ui/util/util.js"),c=n("common:widget/ui/searchData/searchData.js"),u=n("common:widget/ui/config/config.js"),f=u.modelConfig;u.mapConfig}window.getLFS=l,i.exports={poiUidObj:{},createTransInfoWnd:function(n){if(n.title){var t=n.title,i=(n.content,n.curIndex),e=n.total,s=(n.nextInfo,n.nextTransCbk,n.zoomTransCbk,n.obj,n.transUid),r=o(t),l=a(n),p=[0,-10];(0==i||i==e-1)&&(p[1]=-30);var c=new BMap.InfoWindow(l,{title:r,height:0,width:263,margin:[42,10,20,10]});return c._config.collisions=[[65,245],[233,39],[10,10],[10,10]],c._transUid=s,d(c,n),c}},transInfoWindow:function(n,t,i){var e={ccode:f.cityCode,showLine:!0},o=this,a=n.getPoint();if(i&&"object"==typeof i&&(e=T.extend(e,i)),t._transUid){var s=t._transUid;c.fetch("inf&uid="+s,function(i){if(i.content){var a=i.content.addr,d=i.content.tel,r=i.content.poiType,l=i.content.uid,p=i.content.blinfo;o.poiUidObj[s]={addr:a,tel:d,type:r,pid:l,blinfo:p,iw:t}}else o.poiUidObj[s]={addr:null,tel:null,type:null,pid:null,blinfo:null};o.setTransInfoWd(n,t,o.poiUidObj[s],e)})}else n.openInfoWindow(t);"BusTrans"==window.currentComponent._className&&(window.currentComponent.isOperated?p.isInBounds(a)||map.setCenter(a):map.centerAndZoom(a,17))},setTransInfoWd:function(n,t,i,e){var o=i.addr,a=i.tel,s=i.type,d=i.pid,r=i.blinfo,l=[];if(n.openInfoWindow(t),o&&""!=o)if(0==s)l.push("地址："+o+"<br/>");else if(e.showLine){l.push(1==s?"途经公交：":"途经地铁：");for(var c,u=p.formatBlinfo(r),f=0,h={},m=u.length;m>f;f++){var c=r[f].addr;h[c]||(l.push((0!=f?", ":"")+"<a class='stalink' href='javascript:void(0)' "),l.push("onclick='getLFS(this, \""+u[f].uid+'", "'+d+'", '+s+", "+e.ccode+', "'+t._transUid+"\")'>"),l.push(u[f].addr+"</a>"),h[c]=!0)}l.push('<span class="lfsPanel" id="lfsPanel"></span>')}a&&""!=a&&l.push("电话："+a+"<br/>"),l=l.join("");var v=T.g("trans_info_content");v&&(v.style.display="block",v.innerHTML=l,v.style.paddingBottom="5px"),t.redraw()}}});