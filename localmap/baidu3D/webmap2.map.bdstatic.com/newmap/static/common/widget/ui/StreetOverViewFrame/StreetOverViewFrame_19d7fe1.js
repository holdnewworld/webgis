define("common:widget/ui/StreetOverViewFrame/StreetOverViewFrame.js",function(e,t,i){function s(e,t){T.lang.Class.call(this),this.init(e,t)}var a=window.Pano=window.Pano||{};T.lang.inherits(s,T.lang.Class,"StreetOverViewFrame"),T.object.extend(s.prototype,{_addAttribute:function(e){for(var t in e)this[t]=e[t]},init:function(e,t){this._addAttribute({isOpen:!0,layoutType:0,frameWidget:{toggleBtn:null,sizeBtn:null,sv_l:null,sv_t:null,sv_r:null,sv_b:null},frameSize:{width:window.screen.width>1440?230:180,height:window.screen.width>1440?230:180,MIN_WIDTH:window.screen.width>1440?230:180,MIN_HEIGHT:window.screen.width>1440?230:180,ADSORB_LEFT:120,ADSORB_TOP:120,MAX_WIDTH:null,MAX_HEIGHT:null,MIN_LEFT_TOP:{x:null,y:null}},mapHolder:T.g(t.mapHolder),panoHolder:T.g(t.panoHolder),frameHolder:T.g(e),cursorLayer:null,mapHolderPos:{left:0,top:0},contentContainer:null,mousePos:{x:0,y:0}}),this.init_vars(),this._createOverFrame(),this._setStyle(),this.addEvents()},addEvents:function(){this.addDragEvent(),this.bindSizeEvents()},init_vars:function(){this.mapHolderPos=T.dom.getPosition(this.mapHolder)},_updateFrameSizeConstant:function(e,t,i){var s=t.clientWidth,o=t.clientHeight,r=this.getDomPosition(this.frameWidget.sizeBtn),h=a.PanoLayoutType;return e.MAX_WIDTH=s,e.MAX_HEIGHT=o,e.MIN_LEFT_TOP={x:i.left+s-e.MIN_WIDTH+this.mousePos.x-r.left,y:i.top+o-e.MIN_HEIGHT+this.mousePos.y-r.top},(this.layoutType==h.DEFAULT||this.layoutType==h.DEFINE)&&(e.MIN_LEFT_TOP.x-=10,e.MIN_LEFT_TOP.y-=10),e},WindowResize:function(){var e=this,t=e.getMapHolderStyle(),i=(e.getSize(),this.frameSize),s=a.PanoLayoutType,o=t.height-this.frameSize.ADSORB_TOP,r=t.width-this.frameSize.ADSORB_LEFT,h=i.width,n=i.height;switch(e.layoutType){case s.FULL_HORIZON:h=t.width,n=o;break;case s.FULL_VERTICAL:h=r,n=t.height;break;case s.SPLIT_HORIZON:h=t.width,n=o<i.height?o:i.height;break;case s.SPLIT_VERTICAL:h=r<i.width?r:i.width,n=t.height;break;case s.DEFINE:h=r-10<i.width?r-10:i.width,n=o-10<i.height?o-10:i.height}h=h<e.frameSize.MIN_WIDTH?e.frameSize.MIN_WIDTH:h,n=n<e.frameSize.MIN_HEIGHT?e.frameSize.MIN_HEIGHT:n,e.frameSize.width=h,e.frameSize.height=n,e._onWindowResize(),parseInt(this.frameHolder.style.width)<e.frameSize.MIN_WIDTH||e.adjustFrameSize({width:h,height:n})},addDragEvent:function(){var e,t,i,s,o,r,h,n,d,l=this;this.ThumbnailMapSizeBtnUp=function(){var e=l.getSize();l.frameSize.width=e.width,l.frameSize.height=e.height,l.frameHolder.releaseCapture?l.frameHolder.releaseCapture():window.captureEvents&&window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP),T.un(document,"mousemove",l.ThumbnailMapSizeBtnMove),T.un(document,"mouseup",l.ThumbnailMapSizeBtnUp),T.dom.remove(l.cursorLayer),l._onDragEnd()},this.ThumbnailMapSizeBtnMove=function(e){var t=e.pageX,a=e.pageY;if(a>d&&o>a)n>=t?(h=l.frameSize.height+l.mousePos.y-a,l.adjustFrameSize({width:l.frameSize.MAX_WIDTH,height:h}),l.layoutType=i.SPLIT_HORIZON,l.frameHolder.className="street_map_split",l._onAbsorb()):t>n&&s>t?(r=l.frameSize.width+l.mousePos.x-t,h=l.frameSize.height+l.mousePos.y-a,l.adjustFrameSize({width:r,height:h}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFINE,l.frameHolder.className="street_map_resize",l._onResize()):t>=s&&(h=l.frameSize.height+l.mousePos.y-a,l.adjustFrameSize({width:l.frameSize.MIN_WIDTH,height:h}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFINE,l.frameHolder.className="street_map_resize",l._onResize());else if(d>=a)if(n>=t){if(l.frameHolder.className="street_map_split",l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL)return;var u,m,p=l.getMapHolderStyle();l.layoutType==i.SPLIT_VERTICAL?(u=p.width-l.frameSize.ADSORB_LEFT,m=p.height,l._onEnterFull(u,m,i.SPLIT_VERTICAL),l.layoutType=i.FULL_VERTICAL):(u=p.width,m=p.height-l.frameSize.ADSORB_TOP,l._onEnterFull(u,m,i.SPLIT_HORIZON),l.layoutType=i.FULL_HORIZON),l.adjustFrameSize({width:u,height:m})}else t>n&&s>t?(r=l.frameSize.width+l.mousePos.x-t,l.adjustFrameSize({width:r,height:l.frameSize.MAX_HEIGHT}),l.layoutType=i.SPLIT_VERTICAL,l.frameHolder.className="street_map_split",l._onAbsorb()):t>=s&&(l.adjustFrameSize({width:l.frameSize.MIN_WIDTH,height:l.frameSize.MAX_HEIGHT}),l.layoutType=i.SPLIT_VERTICAL,l.frameHolder.className="street_map_split",l._onAbsorb());else a>=o&&(n>=t?(l.adjustFrameSize({width:l.frameSize.MAX_WIDTH,height:l.frameSize.MIN_HEIGHT}),l.layoutType=i.SPLIT_HORIZON,l.frameHolder.className="street_map_split",l._onAbsorb()):t>n&&s>t?(r=l.frameSize.width+l.mousePos.x-t,l.adjustFrameSize({width:r,height:l.frameSize.MIN_HEIGHT}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFINE,l.frameHolder.className="street_map_resize",l._onResize()):t>=s&&(l.adjustFrameSize({width:l.frameSize.MIN_WIDTH,height:l.frameSize.MIN_HEIGHT}),(l.layoutType==i.FULL_HORIZON||l.layoutType==i.FULL_VERTICAL||l.layoutType==i.SPLIT_HORIZON||l.layoutType==i.SPLIT_VERTICAL)&&(l.layoutType=i.DEFINE,l._onRetDefault()),l.layoutType=i.DEFAULT,l.frameHolder.className="street_map_resize",l._onMiniSize()))},this.ThumbnailMapSizeBtnDown=function(r){baidu.event.preventDefault(r),baidu.event.stopPropagation(r),l.mapHolderPos.left=T.dom.getPosition(l.mapHolder).left,l.mapHolderPos.top=T.dom.getPosition(l.mapHolder).top;var h=l.getSize();l.frameSize.width=h.width,l.frameSize.height=h.height,l.mousePos.x=r.clientX,l.mousePos.y=r.clientY,l.frameSize=l._updateFrameSizeConstant(l.frameSize,l.mapHolder,l.mapHolderPos),e=l.mapHolderPos,t=l.frameSize,i=a.PanoLayoutType,s=l.frameSize.MIN_LEFT_TOP.x,o=l.frameSize.MIN_LEFT_TOP.y,n=e.left+t.ADSORB_LEFT,d=e.top+t.ADSORB_TOP,l.cursorLayer=l.cursorLayer?l.cursorLayer:l._createDragMsk(),document.body.appendChild(l.cursorLayer),l.frameHolder.setCapture?l.frameHolder.setCapture():window.captureEvents&&window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP),T.on(document,"mousemove",l.ThumbnailMapSizeBtnMove),T.on(document,"mouseup",l.ThumbnailMapSizeBtnUp)},T.on(this.frameWidget.sizeBtn,"mousedown",this.ThumbnailMapSizeBtnDown)},removeTMEvents:function(){T.un(this.frameWidget.sizeBtn,"mousedown",this.ThumbnailMapSizeBtnDown),this.init_vars()},getDomPosition:function(e){var t=0,i=0;for(e=baidu.g(e);e!=document;e=e.parentNode)t+=e.offsetLeft,i+=e.offsetTop;return{left:t,top:i}},_createDragMsk:function(){if(this.cursorLayer)return this.cursorLayer;var e=T.dom.create("div");return baidu.setStyles(e,{width:"100%",height:"100%",cursor:"se-resize",overflow:"hidden",position:"absolute",top:"0px",left:"0px",background:"none",zIndex:1e8}),e},_createOverFrame:function(){this.frameHolder.className="street_map_resize";var e=T.dom.create("div");baidu.setStyles(e,{width:"100%",height:"100%",background:"none"}),this.contentContainer=T.dom.create("div"),baidu.setStyles(this.contentContainer,{width:"100%",height:"100%",background:"none"}),this.frameWidget.sv_l=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_l,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"0px 1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",left:"0px",top:"4px",width:"3px",zIndex:"39"}),this.frameWidget.sv_t=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_t,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",left:"0px",top:"0px",height:"3px",zIndex:"38"}),this.frameWidget.sv_r=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_r,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"0px 1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",right:"0px",top:"4px",width:"3px",zIndex:"39"}),this.frameWidget.sv_b=T.dom.create("div"),baidu.setStyles(this.frameWidget.sv_b,{position:"absolute",backgroundColor:"#F2F2F2",borderWidth:"1px",borderStyle:"solid",borderColor:"#CDCDCD",fontSize:"0px",right:"0px",bottom:"0px",height:"3px",zIndex:"38"}),this.frameWidget.toggleBtn=T.dom.create("div",{"class":"street_om_btn",title:"隐藏地图"}),this.frameWidget.leftTopBlock=T.dom.create("div",{"class":"street_sz_btn"}),this.frameWidget.sizeBtn=T.dom.create("div",{"class":"street_size_btn",title:"拖拽调整大小"}),e.appendChild(this.contentContainer),e.appendChild(this.frameWidget.sv_l),e.appendChild(this.frameWidget.sv_t),e.appendChild(this.frameWidget.sv_r),e.appendChild(this.frameWidget.sv_b),e.appendChild(this.frameWidget.leftTopBlock),e.appendChild(this.frameWidget.sizeBtn),e.appendChild(this.frameWidget.toggleBtn),this.frameHolder.appendChild(e),this.adjustFrameSize({width:this.frameSize.width,height:this.frameSize.height})},_setStyle:function(){{var e=this,t=this.frameWidget.toggleBtn,i=this.frameWidget.sizeBtn;this.getMapHolderStyle()}T.on(t,"click",function(t){T.rc(this,"om_hover"),T.rc(this,"om_c_hover"),e.setOverStatus(this,t)}),T.on(t,"mouseover",function(){e.isOpen?T.ac(this,"om_hover"):T.ac(this,"om_c_hover")}),T.on(t,"mouseout",function(){e.isOpen?T.rc(this,"om_hover"):T.rc(this,"om_c_hover")}),T.on(i,"mouseover",function(){T.ac(this,"sz_hover")}),T.on(i,"mouseout",function(){T.rc(this,"sz_hover")})},setOverStatus:function(e){{var t;this.getMapHolderStyle(),a.PanoLayoutType}this.isOpen?(this.isOpen=!1,this.frameSize.width=parseInt(this.frameHolder.style.width),this.frameSize.height=parseInt(this.frameHolder.style.height),this.adjustFrameSize({width:19,height:18}),this._onVisibleChange(),T.ac(e,"om_close"),T.rc(e,"om_hover"),this.frameWidget.toggleBtn.title="展开地图"):(this.isOpen=!0,t=this.getShowRealFrameSize(),this.adjustFrameSize(t),T.rc(e,"om_close"),T.rc(e,"om_c_hover"),this.frameWidget.toggleBtn.title="隐藏地图",this._onVisibleChange())},show:function(){this.addEvents();var e=this.getShowRealFrameSize();this.adjustFrameSize(e),this.frameHolder.style.display="block",this.frameWidget.toggleBtn.className="street_om_btn",this.isOpen=!0,this._onVisibleChange()},getShowRealFrameSize:function(){this.init_vars();var e=this.frameSize.width,t=this.frameSize.height,i=this.getMapHolderStyle(),s=a.PanoLayoutType;switch(this.layoutType){case s.SPLIT_HORIZON:e=i.width;break;case s.SPLIT_VERTICAL:t=i.height;break;case s.FULL_HORIZON:e=i.width,t=i.height-this.frameSize.ADSORB_TOP;break;case s.FULL_VERTICAL:e=i.width-this.frameSize.ADSORB_LEFT,t=i.height}return{width:e,height:t}},hide:function(){this.isOpen=!1,this.removeTMEvents(),this.removeSizeEvents(),this.frameHolder.style.display="none",T.rc(this.frameWidget.toggleBtn,"om_hover"),T.rc(this.frameWidget.toggleBtn,"om_c_hover"),this._onVisibleChange()},setVisible:function(e){this.isOpen=e,this._onVisibleChange(),this.frameHolder.style.display=e?"block":"none"},adjustFrameSize:function(e){if(null!=e.width){var t=e.width;this.frameHolder.style.width=t+"px",this.frameWidget.sv_t.style.width=(t-2>=0?t-2:0)+"px",this.frameWidget.sv_b.style.width=(t-2>=0?t-2:0)+"px"}if(null!=e.height){var i=e.height;this.frameHolder.style.height=i+"px",this.frameWidget.sv_l.style.height=(i-8>=0?i-8:0)+"px",this.frameWidget.sv_r.style.height=(i-8>=0?i-8:0)+"px",this.frameWidget.sizeBtn.style.height=this.layoutType==a.PanoLayoutType.SPLIT_VERTICAL||this.layoutType==a.PanoLayoutType.FULL_VERTICAL?"52px":"20px"}},getSize:function(){return{width:parseInt(this.frameHolder.style.width),height:parseInt(this.frameHolder.style.height)}},getMapHolderStyle:function(){return{width:this.mapHolder.clientWidth,height:this.mapHolder.clientHeight,marLeft:parseInt(""==this.mapHolder.style.marginLeft?350:this.mapHolder.style.marginLeft)}},setHolderSizeLarger:function(e){if(this.isOpen){var t=a.PanoLayoutType,i=e.width,s=e.height;switch(this.layoutType){case t.SPLIT_HORIZON:s=null;break;case t.SPLIT_VERTICAL:i=null;break;case t.FULL_HORIZON:s=e.height-this.frameSize.ADSORB_TOP;break;case t.FULL_VERTICAL:i=e.width-this.frameSize.ADSORB_LEFT;break;default:i=null,s=null}this.adjustFrameSize({width:i,height:s}),this.frameSize.width=i,this.frameSize.height=s}this._onHolderResize()},setHolderSizeSmaller:function(e){if(this.isOpen){var t=a.PanoLayoutType,i=e.width,s=e.height,o=this.getSize(),r=o.width,h=o.height,n=this.frameSize.ADSORB_TOP,d=this.frameSize.ADSORB_LEFT;switch(this.layoutType){case t.SPLIT_HORIZON:s=h>s-n?s-n:h;break;case t.SPLIT_VERTICAL:i=r>i-d?i-d:r;break;case t.DEFINE:case t.DEFAULT:i=r>i-10-d?i-10-d:r,s=h>s-10-n?s-10-n:h;break;case t.FULL_HORIZON:s-=n;break;case t.FULL_VERTICAL:i-=d}this.adjustFrameSize({width:i,height:s}),this.frameSize.width=i,this.frameSize.height=s}this._onHolderResize()},bindSizeEvents:function(){var t=e("common:widget/ui/fullScreen/fullScreen.js"),i=e("common:widget/ui/mapInfo/mapInfo.js"),s=this,a=this.guid;s.setSizeLargerFunc=function(e){var t=e.size;s.setHolderSizeLarger(t)},s.setSizeSmallerFunc=function(e){var t=e.size;s.setHolderSizeSmaller(t)},t.addEventListener("onFullScreen",s.setSizeLargerFunc,a+"_onFullScreen"),t.addEventListener("onExitFull",s.setSizeSmallerFunc,a+"_onExitFull"),i.addEventListener("onShowSide",s.setSizeSmallerFunc,a+"_onShowSide"),i.addEventListener("onHideSide",s.setSizeLargerFunc,a+"_onHideSide")},removeSizeEvents:function(){var t=e("common:widget/ui/fullScreen/fullScreen.js"),i=e("common:widget/ui/mapInfo/mapInfo.js"),s=this.guid;t.removeEventListener("onFullScreen",s+"_onFullScreen"),t.removeEventListener("onExitFull",s+"_onExitFull"),i.removeEventListener("onShowSide",s+"_onShowSide"),i.removeEventListener("onHideSide",s+"_onHideSide")},_onEnterFull:function(e,t){this.dispatchEvent("onEnterFull",{size:{width:e,height:t},layout:this.layoutType})},_onRetDefault:function(){var e=this.getSize();this.dispatchEvent("onRetDefault",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onResize:function(){var e=this.getSize(),t=this.isOpen?e.width:0,i=this.isOpen?e.height:0;this.dispatchEvent("onResize",{size:{width:t,height:i},layout:this.layoutType})},_onWindowResize:function(){var e=this.getSize(),t=this.isOpen?e.width:0,i=this.isOpen?e.height:0;this.dispatchEvent("onWindowResize",{size:{width:t,height:i},layout:this.layoutType})},_onHolderResize:function(){var e=this.getSize(),t=this.isOpen?e.width:0,i=this.isOpen?e.height:0;this.dispatchEvent("onHolderResize",{size:{width:t,height:i},layout:this.layoutType})},_onAbsorb:function(){var e=this.getSize();this.dispatchEvent("onAbsorb",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onDragEnd:function(){var e=this.getSize();this.dispatchEvent("onDragEnd",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onMiniSize:function(){var e=this.getSize();this.dispatchEvent("onMiniSize",{size:{width:e.width,height:e.height},layout:this.layoutType})},_onVisibleChange:function(){var e=this.getSize();this.dispatchEvent("onVisibleChange",{visible:this.isOpen,size:{width:e.width,height:e.height},layout:this.layoutType})}}),i.exports=s});