define("common:widget/print/BusTransPrint/BusTransPrint.js",function(e,t,s){function n(){T.lang.Class.call(this),this.lineType=[[0,2,3,4,5,6,7,9,10,11],[1,12,13,14],[8]],this.routePoints=[],this.transPoints=[],this.routeBounds=[],this.routeLines=[],this.busType=[]}var a=e("common:widget/ui/util/util.js"),o=e("common:widget/ui/mapUtil/mapUtil.js"),r=e("common:widget/ui/config/config.js"),l=(r.mapConfig,e("common:widget/ui/constant/Constant.js")),p=e("common:widget/print/printUtil/printUtil.js"),m=e("common:widget/ui/searchData/searchData.js");T.extend(n.prototype,{initialize:function(e){function t(){var t=(new Date).getTime(),s=e.navQueryString;s.indexOf("&sy=0")>=0&&(s=s.replace("&sy=0","&sy=1"));var n=e.navQueryString.indexOf("&sy="),a=n>-1?e.navQueryString.substr(n+4,1):1;a=0==a?1:a,m.fetch("nav&c=131&sy="+a+"&sn=1$$"+w+"$$"+B+"$$"+encodeURIComponent(S)+"$$$$$$&en=1$$"+M+"$$"+_+"$$"+encodeURIComponent(N)+"$$$$$&ie=utf-8&&t="+t,function(e){p.fillTaxiDes(e)})}try{var s=e.json,n=T.g("bd"),i=T.g("mapBox"),r=T.g("busDrivers"),l=T.g("remindMsg");if(n.insertBefore(r,i),n.insertBefore(l,i),map.removeContextMenu(window.contextMenu),map.disableScrollWheelZoom(),this.appendImg(p.JS("MapHolder"),"dest_markers.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/widget/print/BusTransPrint/dest_markers.png*/,"../../../images/ie6_dest_markers_9a7d50c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png*/),this.appendImg(p.JS("MapHolder"),"trans_icons.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/widget/print/BusTransPrint/trans_icons.png*/,"../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png*/),!p.JS("route_list"))return;for(var u=p.JS("route_list").getElementsByTagName("li"),c=0,d=u.length;d>c;c++)if(u[c].className.indexOf("on")>-1){{var g,h=s.content[c],f=u[c].getElementsByTagName("table")[0],y=[],b=document.createDocumentFragment(),v=p.JS("busList"),S=(p.JS("startInfo_"+c),p.JS("endInfo_"+c),s.result.start.wd),N=s.result.end.wd,B=s.result.start.pt,_=s.result.end.pt,w=s.result.start.uid,M=s.result.end.uid,J=p.JS("blInfo_"+c),C=(s.current_city.code,p.JS("searchValue"));p.JS("strategySel").getElementsByTagName("div")}switch(s.result.sy){case 0:g="较快捷";break;case 4:g="不坐地铁";break;case 2:g="少换乘";break;case 3:g="少步行";break;default:g="未知"}var E=p.JS("blDis_"+c).firstChild,P=1==E.nodeType?E.innerHTML:E.nodeValue,L='<li class="starting"><div class="startingTitle"><strong>起点：</strong>'+S+'</div><div class="distance">'+P+"</div></li>",A='<li class="starting"><div class="startingTitle"><strong>终点：</strong>'+N+"</div></li>",E=p.JS("blDis_"+c).firstChild,P=1==E.nodeType?E.innerHTML:E.nodeValue,k="<li><strong>起点：</strong>"+S+"</li><li><strong>终点：</strong>"+N+"</li><li><strong>路线：</strong>"+J.innerHTML.replace(/<span[^>]+class="?km"?[^>]*>.*?<\/span>/gi,"")+"("+g+")</li><li><strong>距离：</strong>"+P+"</li>";v.innerHTML=L;for(var $,D=0,R=f.rows;$=R[D];D++){for(var H,x=[],I=0,O=$.cells;H=O[I];I++)x.push(H.innerHTML);y.push(x)}for(var j=0,U=y.length;U>j;j++){var V=document.createElement("li"),Y=document.createElement("span"),G=document.createElement("div");V.className="singleLine",Y.className="num",Y.innerHTML=j+1,G.className="hd",G.innerHTML=y[j].join("")+'<div class="openCloseButton" num="'+j+'"><span>展开地图</span></div>',V.appendChild(Y),V.appendChild(G),V.innerHTML+='<div class="smallMap"><div class="firstMapBox" id="smallMapBox'+j+'"></div></div>',b.appendChild(V)}v.appendChild(b),v.innerHTML+=A;for(var Q=p.JS.getElementByClassName("step",v),W=p.JS.getElementByClassName("bysub",v),Z=p.JS.getElementByClassName("bybus",v),z=0,F=Q.length;F>z;z++)Q[z].innerHTML='<img src="../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"  />';for(var z=0,F=W.length;F>z;z++)W[z].innerHTML='<img src="../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"  />';for(var z=0,F=Z.length;F>z;z++)Z[z].innerHTML='<img src="../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"  />';C.innerHTML=k,p.JS("ulE").style.display="none";for(var K=v.getElementsByTagName("a"),q=0,X=K.length;X>q;q++)K[q].onclick=K[q].onmouseover=K[q].onmouseout=null;for(var et=h.lines[0],tt=h.stops[0],st=0,nt=tt.length;nt>st;st++){var at=tt[st],it=at.getOff,ot=at.getOn,rt=o.parse2Geo(it.geo),lt=o.parse2Geo(ot.geo),pt=at.walk;if(pt&&pt.geo){var mt=o.parse2Geo(pt.geo);if(st>0&&nt-1>st&&(ot.name!=it.name||pt.distance>=25)?this.routeBounds.push(a.getBPoints([mt.bound])):(0==st||st==nt-1)&&pt.distance>0&&this.routeBounds.push(a.getBPoints([mt.bound])),pt.distance>0){var ut=mt.points;0==st&&(ut+=";"+lt.points),st>0&&nt-1>st&&(ut=rt.points+";"+ut+";"+lt.points),st==nt-1&&(ut=rt.points+";"+ut),this.routePoints.push(st>0&&nt-1>st&&ot.name==it.name&&pt.distance<25?{points:ut,type:0,highlight:0}:{points:ut,type:0,highlight:1})}}var D=et[st];if(D&&"object"==typeof D){this.busType.push(D.type||0);var mt=o.parse2Geo(D.geo);this.routePoints.push({points:mt.points,type:1,highlight:1}),this.routeBounds.push(a.getBPoints([mt.bound]))}this.transPoints.push([rt.points,it.name]),this.transPoints.push([lt.points,ot.Name])}}baidu("#searchValue .hcard").remove(),p.JS("resultTitle").innerHTML="具体路线:",p.JS("resultControl").style.display="",p.JS("remindMsg").innerHTML="百度提醒您：以上的路线信息仅供参考";for(var ct=this,dt=p.JS.getElementByClassName("singleLine"),c=0,d=dt.length;d>c;c++){var gt=(p.JS.getElementByClassName("detailsOpen",dt[c]),p.JS.getElementByClassName("smallMap",dt[c])),ht=(p.JS.getElementByClassName("urbanRoutes",dt[c]),p.JS.getElementByClassName("openCloseButton",dt[c]));dt[c].onmouseover=p.listH,dt[c].onmouseout=p.listNh,dt[c].setAttribute("openswith","true"),dt[c].onclick=function(e,t){return function(s){return"true"!==e.getAttribute("openswith")?!1:(t.onclick(s),void e.setAttribute("openswith","false"))}}(dt[c],ht[0]),ht.length&&!function(e,t){ht[0].onclick=function(s){var n=s||window.event,a=this,i=p.JS("textDisplay"),r=(p.JS("mapDisplay"),"smallMapBox"+this.getAttribute("num"));if("openCloseButton"===this.className){if(null===this.getAttribute("data-map")){var l=new BMap.Map(r,{coordType:BMAP_COORD_MERCATOR,enableCanvas2dMap:!1}),m=new BMap.Point(12957320,4825100);l.centerAndZoom(m,12),mapType==BMAP_TYPE_DIMENSIONAL&&(l.setCurrentCity(paramExt.cc),l.setMapType(mapType)),l.addControl(new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_ZOOM})),this.busPoi||(this.busPoi=ct.addBusPoi(l)),this.busRoutes||(this.busRoutes=ct.addBusRoute(l)),this.mapBox=l,this.setAttribute("data-map","ok"),e.setAttribute("data-map","ok")}setTimeout(function(){a.mapBox&&(a.mapBox.setViewport(ct.routeBounds[t]),o.unSelectRoute(a.busRoutes[t]),o.selectRoute(a.busRoutes[t]))},100),setTimeout(function(){ct.appendImg(p.JS(r),"dest_markers.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/widget/print/BusTransPrint/dest_markers.png*/,"../../../images/ie6_dest_markers_9a7d50c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png*/),ct.appendImg(p.JS(r),"trans_icons.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/widget/print/BusTransPrint/trans_icons.png*/,"../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png*/)},200),e.style.display="block","LI"!==this.parentNode.NodeName?this.parentNode.parentNode.setAttribute("openswith","false"):this.parentNode.setAttribute("openswith","false"),this.innerHTML="<span class='putWway'>收起地图</span>",this.className="CloseButton","Selected"===i.className&&(i.className="",i.onclick=function(){p.allSmallMapNone(),this.className="Selected"});for(var u=p.JS.getElementByClassName("smallMap","busList"),c=[],d=u.length,g=0;d>g;g++)"block"===u[g].style.display&&c.push(u[g]);c.length===d&&(p.JS("mapDisplay").className="Selected"),p.JS.stopBubbleEvent(n)}else{e.style.display="none","LI"!==this.parentNode.NodeName?(this.parentNode.parentNode.setAttribute("openswith","true"),this.parentNode.parentNode.className="singleLine"):(this.parentNode.setAttribute("openswith","true"),this.parentNode.className="singleLine"),this.className="openCloseButton",this.innerHTML="<span>展开地图</span>";for(var u=p.JS.getElementByClassName("smallMap","busList"),c=[],g=0,d=u.length;d>g;g++)"block"===u[g].style.display&&c.push(u[g]);0===c.length&&(i.className="Selected"),"Selected"===p.JS("mapDisplay").className&&(p.JS("mapDisplay").className=""),p.JS.stopBubbleEvent(n)}return p.JS.stopBubbleEvent(n),!1}}(gt[0],c),p.JS("mapDisplay").onclick=function(){if("Selected"!==this.className){this.className="Selected",p.JS("textDisplay").className="";var e=p.JS.getElementByClassName("openCloseButton","busList");"none"===p.JS("busList").parentNode.style.display&&p.JS("lineControl").onclick();for(var t=0,s=e.length;s>t;t++)e[t].onclick(ft)}return!1}}t()}catch(ft){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/print/BusTransPrint/exception.fire","catch",{msg:ft.message||ft.description,path:"common:widget/print/BusTransPrint/BusTransPrint.js",ln:347})}},addBusPoi:function(e){for(var t=[],s=0,n=this.transPoints.length;n>s;s++){var a=null;if(0==s)a=o.addDestPoi(this.transPoints[s][0],"",l.DEST_START,"",e);else if(s==n-1)a=o.addDestPoi(this.transPoints[s][0],"",l.DEST_END,"",e);else if(s>0&&n-1>s){var i=-1;i=s%2?(s-1)/2:(s-2)/2;var r=this.returnLType(this.busType[i]),p=0;0==r?p=l.TRANS_TYPE_BUS:1==r?p=l.TRANS_TYPE_SUB:2==r&&(p=l.TRANS_TYPE_BUS),a=o.addTransPoi(this.transPoints[s][0].toString(),p,"",e)}t.push(a)}return t},addBusRoute:function(e){for(var t=[],s=0,n=this.routePoints.length;n>s;s++){var a=this.routePoints[s],i=a.type?l.ROUTE_TYPE_BUS:l.ROUTE_TYPE_WALK,r=o.addRoute(a.points.toString(),i,"",e);a.highlight&&t.push(r)}return t},returnLType:function(e){var t=this.lineType.length;for(i=0;t>i;i++){var s=this.lineType[i];for(j=0;j<s.length;j++){var n=s[j];if(n==e)return i}}},appendImg:function(e,t,s){var n=p.findAlphaImageLoader("div",e,t),a=document.createElement("img");if(a.className="ie6_print",a.src=s,n.length)for(var i=0,o=n.length;o>i;i++){var r=n[i],l=a.cloneNode(!0);r.className="noprint",l.style.top=r.style.top,l.style.left=r.style.left,r.parentNode.appendChild(l)}}}),s.exports=n});