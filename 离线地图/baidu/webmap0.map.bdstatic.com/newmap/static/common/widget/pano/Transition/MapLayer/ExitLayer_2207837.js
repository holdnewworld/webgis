define("common:widget/pano/Transition/MapLayer/ExitLayer.js",function(n){var t=n("common:widget/ui/Animation/Animation.js").Animation,i=n("common:widget/pano/Transition/MapLayer/Layer.js"),e=n("common:widget/pano/Transition/Util.js"),o=function(n,t,i,o,a,r){if(this.playToCenter=o,this.playToDir=a,this.onPlayEnd=r,this.enable===!1){var s=new T.Deferred;return setTimeout(function(){s.resolve()},0),s}this.id="exit";var d=window.map;n=n||d.getCenter(),i=i||d.getZoom();var l=document.body.clientWidth,u=document.body.clientHeight,c=e.screenPosToMapPos(l/2,u/2);c=new BMap.Pixel(c.x,c.y);var p=d.getZoomUnits(i),h=n.lng+p*(c.x-d.width/2),y=n.lat-p*(c.y-d.height/2),m=new BMap.Point(h,y),f=void 0;if(t){f=[0,0,0,0];var w=d.pointToPixel(t),v=e.mapPosToScreenPos(w.x,w.y),x=l/2,g=u/2;v.y<g?f[0]=g-v.y:f[2]=g-(u-v.y),v.x>x?f[1]=x-(l-v.x):f[3]=x-v.x}f=f.map(function(n){return Math.min(n,768)}),this.$constrctor.call(this,l,u,m,i,256,f),this.container.style.opacity=1,document.body.appendChild(this.container),this._play()},a=i.extend(o.prototype);return a.play=function(){},a._play=function(){var n=this.playToCenter,o=this.playToDir,a=this.context,r=document.body.clientWidth/2,s=document.body.clientHeight/2,d=520,l=500,u=r-n.x,c=s-n.y,p=d-20,h=i.options.rotateX,y=o?o:0;y>180&&(y-=360);var m=(new Date,this.width,this.height,this.container,this),f=(new t).build({duration:i.options.rotateDuration,fps:30,delay:t.INFINITE,transition:function(n){return n},finish:function(){a.transform(d,0,0,0,0,null,0,1),m.onPlayEnd()},render:function(n){n=1-n;var t=u*e.easeOut(n),i=c*e.easeOut(n),o=p*e.easeOut(n),r=h*e.easeIn(n),s=y*e.easeIn(n);a.transform(d,t,i,o,r,null,s,1)}}),w=(new t).build({duration:i.options.perspectiveDuration,fps:30,delay:t.INFINITE,transition:function(n){return n},finish:function(){},render:function(n){a.opacity(n),n=1-n;var t=d-l*n,i=l/d*t;a.transform(t,null,null,i)}});a.transform(d-l,u,c,l/d,h,null,y),w.add(f),w.start()},o});