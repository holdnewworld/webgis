define("common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",function(require,exports,module){var util=require("common:widget/pano/base/util.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),Animation=require("common:widget/ui/Animation/Animation.js"),LAYER_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="pano-container">    <div id="pano-photo-wrapper"></div>    <div id="pano-flash-wrapper"></div>    <div id="pano-expand-wrapper">        <div id="pano-ui-layer" class="pano-ui-layer"></div>        <ul id="pano-header">            <li id="pano-indoor—poi-wrapper"></li>            <li style="width: 50px;height: 50px;display: inline-block;"></li>        </ul>        <ul id="pano-sidebar">            <li id="pano-fold-btn" class="pano_fold_forbid">                                <span class="pano_button" title="折叠功能区"><span></span></span>            </li>                    </ul>        <div id="pano-overview-wrapper"></div>        <div id="pano-footer">            <ul id="pano-funcarea"  isinit=\'1\' class="clearfix pano_funcarea_hide">            </ul>            <div id="pano-tips">            </div>                        <div id="pano-fold-msk" class="transparent-msk"></div>        </div>    </div>    <div id="pano-msg"></div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];require.loadCss({content:"#pano-container{position:absolute;overflow:hidden;top:0;left:0;width:100%;height:100%;background-color:#eee;z-index:100001;min-width:960px;visibility:hidden}#pano-photo-wrapper{position:absolute;width:100%;height:100%;z-index:1;background-color:#000}#pano-flash-wrapper{position:absolute;overflow:hidden;top:0;right:0;width:100%;height:100%;background-color:#fff;z-index:100001}#pano-msg{width:100%;display:none;height:100%;position:absolute;top:0;left:0;z-index:200000;_background:url(/newmap/static/common/images/transparent.gif)}#pano-header{position:absolute;top:20px;left:103px;z-index:100010}#pano-header li{float:left;display:inline-block}#pano-sidebar{position:absolute;right:12px;width:40px;z-index:100010;line-height:0;bottom:20px}.pano_unfold_func{font-size:0}#pano-footer{position:absolute;width:100%;bottom:0;z-index:100005}#pano-footer .pano-func-item{position:absolute;padding-top:18px;height:110px}#pano-funcarea{padding-left:0;width:100%;height:130px;font-size:0;position:absolute}.transparent-msk{position:absolute;width:100%;z-index:-999;background-color:#252525;opacity:.9;filter:alpha(opacity=90)}#pano-footer .transparent-msk{left:0;height:150px}.pano_unfold_func{font-size:12px}.pano_funcarea_hide{}#pano-tips{display:inline-block;right:0;text-align:right;overflow:hidden;line-height:20px;font-size:12px;color:#797979;position:absolute;bottom:0;z-index:100009}#pano-tips span{font-size:12px}#pano-overview-wrapper{position:absolute;left:10px;bottom:23px;width:300px;height:106px;z-index:100010;visibility:hidden;border:2px solid #3D4145}#pano-overview-holder{width:300px;margin-right:10px}.pano-ui-layer{width:0;height:0;position:absolute;left:0;top:0;z-index:100011}#pano-floor-wrapper{position:absolute;left:0;top:-23px;width:304px;height:36px;visibility:hidden;overflow:visible}"});var layeroutResizeTimer=null,isUserHideAlbum=!1,PanoLayoutManager=ModuleClass.extend("PanoLayoutManager",{constructor:function(){},initialize:function(e,o){try{this._moduleHash=e,this._funcAreaModulesStateHash={},this._container=o,this._panoContainer=null,this.render(o),this._addLayoutEventListeners()}catch(a){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoLayoutManager/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:33})}},render:function(e){try{var o=LAYER_TEMPLATE();this._panoContainer=T(o)[0],T(e).append(this._panoContainer)}catch(a){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoLayoutManager/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:38})}},getModuleContainer:function(e){switch(e){case"PanoRoot":return T.g("pano-container");case"PanoModule":return T.g("pano-flash-wrapper");case"PhotoTour":return T.g("pano-photo-wrapper");case"PanoOverviewModule":return T.g("pano-overview-wrapper");case"PanoGuideModule":return T.g("pano-funcarea");case"PanoIndoorPoiModule":return T.g("pano-indoor—poi-wrapper");case"PanoToolModule":return T.g("pano-sidebar");case"PanoCopyrightModule":return T.g("pano-tips");case"PanoMessageBoxModule":return T.g("pano-msg");case"ui-layer":return T.g("pano-ui-layer");default:return null}},resetFuncAreaModule:function(e){if(!this.funcAreaModule||e.getName()!==this.funcAreaModule.getName()){for(var o=T.g("pano-funcarea");o.lastChild;)o.removeChild(o.lastChild);if(e&&e.getContainer){this.funcAreaModule=e;var a=e.getContainer();return void o.appendChild(a)}}},restoreFuncAreaDoms:function(e){var o=T.g("pano-funcarea");util.each(e,function(e){o.appendChild(e)})},_addLayoutEventListeners:function(){var e=this;T.on(T.g("pano-fold-btn"),"click",function(){if(addStat(STAT_CODE.STAT_PANORAMA,{item:"funcarea-fold-click"}),!T("#pano-fold-btn").hasClass("pano_fold_forbid")){var o=T("#pano-funcarea"),a=o.hasClass("pano_funcarea_hide");isUserHideAlbum=a?!1:!0,e._toggleFoldArea()}}),T.on(T.g("pano-footer"),"mousedown",function(e){e.preventDefault()}),e._windowResizeHandler=function(){if(!document.webkitIsFullScreen&&!document.msFullscreenElement){var e=T.g("pano-container"),o=document.body.offsetWidth,a=document.body.scrollHeight;e.style.width=960>o?"960px":o+"px",e.style.height=480>a?"480px":a+"px"}},T.on(window,"onresize",e._windowResizeHandler)},show:function(){this._toggleFoldArea(!0)},hide:function(){this._toggleFoldArea(!1)},_toggleFoldArea:function(e,o){var a=T("#pano-fold-btn .pano_button"),n=T("#pano-funcarea"),i=T("#pano-floor-wrapper"),t=T("#pano-sidebar"),r=T("#pano-cprt-msk"),s=T("#pano-fold-msk"),d=T("#pano-overview-wrapper"),l=n.hasClass("pano_funcarea_hide");if(e===!0&&!l||e===!1&&l)return void(i.length>0&&(util.setOpacity(i[0],1),i.css("visibility","visible")));var p=new Animation.Animation,u={duration:400,fps:40,delay:Animation.Animation.INFINITE,transition:Animation.Transitions.easeOutQuad,finish:function(){},render:function(){try{}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoLayoutManager/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:180})}}},c=(T("#pano-footer"),parseInt(n.css("height"))),h=20,f=n.children();util.each(f,function(e){"pano-floor-wrapper"!=e.id&&util.setOpacity(e,0)});var m,g;e===!0||void 0===e&&l?(n.removeClass("pano_funcarea_hide"),t.addClass("pano_unfold_sidebar"),a.attr("title","折叠功能区"),m=c,s.css("visibility","visible"),u.render=function(e){try{t.css("bottom",h+e*m+"px"),n.css("bottom",h+(e-1)*m+"px"),s.css("bottom",h+(e-1)*m-20+"px"),r.css({opacity:1-e-.1,filter:"alpha(opacity=0)"}),o||d.css("bottom",10+13*e+"px"),util.each(f,function(o){util.setOpacity(o,e)})}catch(a){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoLayoutManager/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:227})}},i&&i.css("visibility","visible"),this._moduleHash.PanoOverviewModule&&this._moduleHash.PanoOverviewModule.setPolymerizationComponentPosition(!0)):(n.addClass("pano_funcarea_hide"),t.removeClass("pano_unfold_sidebar"),a.attr("title","展开功能区"),g=c+h,m=g-h,u.render=function(e){try{t.css("bottom",g-e*m+"px"),n.css("bottom",-e*c+"px"),s.css("bottom",-e*c+"px"),r.css({opacity:e-.1,filter:"alpha(opacity=90)"}),o||d.css("bottom",23-13*e+"px"),util.each(f,function(o){"pano-floor-wrapper"!==o.id&&util.setOpacity(o,1-e)})}catch(a){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoLayoutManager/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/pano/module/PanoLayoutManager/PanoLayoutManager.js",ln:263})}},u.finish=function(){s.css("visibility","hidden"),i&&i.css("visibility","hidden"),util.each(f,function(e){util.setOpacity(e,1)})},this._moduleHash.PanoOverviewModule&&this._moduleHash.PanoOverviewModule.setPolymerizationComponentPosition(!1)),p.build(u),p.start()},_updateLayout:function(e,o){var a=!o;a?(T("#pano-fold-btn").addClass("pano_fold_forbid"),T("#pano-sidebar").removeClass("pano_unfold_sidebar"),T("#pano-sidebar").css("bottom","20px"),isUserHideAlbum&&T("#pano-overview-wrapper").css("bottom","10px")):(T("#pano-fold-btn").removeClass("pano_fold_forbid"),o&&!isUserHideAlbum&&o&&this._toggleFoldArea(!0),isUserHideAlbum&&T("#pano-overview-wrapper").css("bottom","10px"),T("#pano-funcarea").hasClass("pano_funcarea_hide")||(T("#pano-sidebar").css("bottom","150px"),T("#pano-sidebar").addClass("pano_unfold_sidebar")))},event_layoutChanged:function(e,o){layeroutResizeTimer&&clearTimeout(layeroutResizeTimer);var a=this;this._funcAreaModulesStateHash[e+"_changed"]=this._funcAreaModulesStateHash[e]!=o,this._funcAreaModulesStateHash[e]=o,layeroutResizeTimer=setTimeout(function(){{var e=a._funcAreaModulesStateHash,o=T("#pano-funcarea"),n=a.funcAreaModule||a._moduleHash.PanoGuideModule,i=e.PanoOverviewModule,t=e.PanoGuideModule||e.TrafficModule,r=e.PanoGuideModule_changed||e.TrafficModule_changed;e.TrafficModule_changed}i&&t?(o.addClass("pano_has_overview"),n&&n.event_layoutChanged(document.body.clientWidth-315,e.PanoGuideModule_changed),!isUserHideAlbum&&r&&a._toggleFoldArea(!0,!0)):i&&!t?(o.removeClass("pano_has_overview"),a._toggleFoldArea(!1,!0)):!i&&t?(n&&n.event_layoutChanged(document.body.clientWidth,e.PanoGuideModule_changed),a._toggleFoldArea(!0)):i||t||(o.removeClass("pano_has_overview"),a._toggleFoldArea(!1)),a._updateLayout(i,t)},50)},event_layoutToggle:function(e,o){var a=this,n=o?"block":"none";if("TrafficModule"==e){var i=a.getModuleContainer(e);i&&(i.style.display=n),T.g("pano-ui-layer").style.display=n}else{var i=a.getModuleContainer(e);i&&(i.style.display=n)}},dispose:function(){layeroutResizeTimer&&clearTimeout(layeroutResizeTimer),this._container.removeChild(this._panoContainer),T.un(window,"onresize",this._windowResizeHandler)}});module.exports=PanoLayoutManager});