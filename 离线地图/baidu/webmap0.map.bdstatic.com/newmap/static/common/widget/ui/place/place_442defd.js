define("common:widget/ui/place/place.js",function(require,exports,module){var constant=require("common:widget/ui/constant/Constant.js"),util=require("common:widget/ui/util/util.js"),PlaceLog=require("common:widget/ui/place/tool/log.js"),config=require("common:widget/ui/config/config.js"),MapConfig=config.mapConfig,modelConfig=config.modelConfig,urlConfig=config.urlConfig,specialPreferential={title:"优惠券",maxTitle:"优惠券",wd:"餐饮",des:"提供北京市的餐饮类优惠券分布图","北京":"beijing"},pl_data={cater:{name:"cater",cn_name:"餐馆",cTag:{"中餐馆":"china","西餐厅":"western","快餐":"snack","日本菜":"japan","东南亚菜":"southeast","韩国料理":"korea","川菜":"sichuan","粤菜":"yuecai","小吃":"xiaochi","西式快餐":"westernSnack","中式快餐":"chinaSnack","甜点冷饮":"sweetmeats","面包西点":"bakeshop","火锅":"huoguo","披萨":"pizza","牛排":"beefsteak"},sTag:{tagTxt:["全部","中餐馆","西餐厅","日本菜","韩国料理","东南亚菜","快餐","甜点冷饮","火锅"],tagTxt_b:["餐馆","中餐馆-","西餐厅-","日本菜-","韩国料理-","东南亚菜-","快餐-","甜点冷饮-","中餐馆-火锅-"],china:["火锅","自助餐","川菜","湘菜","粤菜","东北菜","鲁菜","江浙菜","烧烤","海鲜","小吃"],china_b:["中餐馆-火锅-","中餐馆-自助餐","中餐馆-川菜-","中餐馆-湘菜","中餐馆-粤菜-","中餐馆-东北菜","中餐馆-鲁菜","中餐馆-江浙菜","中餐馆-烧烤","中餐馆-海鲜","中餐馆-小吃-"],western:["披萨","牛排","意大利菜","法国菜","德国菜","俄罗斯菜","拉美烧烤","中东料理"],western_b:["西餐厅-披萨-","西餐厅-牛排-","西餐厅-意大利菜","西餐厅-法国菜","西餐厅-德国菜","西餐厅-俄罗斯菜","西餐厅-拉美烧烤","西餐厅-中东料理"],snack:["中式快餐","西式快餐","肯德基","麦当劳","永和大王","味千拉面","马兰拉面","真功夫"],snack_b:["快餐-中式快餐-","快餐-西式快餐-","快餐-肯德基","快餐-麦当劳","快餐-永和大王","快餐-味千拉面","快餐-马兰拉面","快餐-真功夫"],japan:["日本料理","日式烧烤","寿司","日式自助"],japan_b:["日本菜-日本料理","日本菜-日式烧烤","日本菜-寿司","日本菜-日式自助"],southeast:["泰国菜","越南菜","印度菜","菲律宾菜","印尼菜"],southeast_b:["东南亚菜-泰国菜","东南亚菜-越南菜","东南亚菜-印度菜","东南亚菜-菲律宾菜","东南亚菜-印尼菜"],pizza:["必胜客","好伦哥","巴贝拉"],pizza_b:["西餐厅-披萨-必胜客","西餐厅-披萨-好伦哥","西餐厅-披萨-巴贝拉"],beefsteak:["豪客来","豪享来","绿茵阁"],beefsteak_b:["西餐厅-牛排-豪客来","西餐厅-牛排-豪享来","西餐厅-牛排-绿茵阁"],korea:["权金城","汉拿山"],korea_b:["韩国料理-权金城","韩国料理-汉拿山"],sichuan:["香锅","烤鱼"],sichuan_b:["中餐馆-川菜-香锅","中餐馆-川菜-烤鱼"],huoguo:["海底捞","小肥羊","东来顺","呷哺呷哺"],huoguo_b:["中餐馆-火锅-海底捞","中餐馆-火锅-小肥羊","中餐馆-火锅-东来顺","中餐馆-火锅-呷哺呷哺"],xiaochi:["粉面馆","麻辣烫","饺子馆","包子","馄饨店","粥店","熟食","零食"],xiaochi_b:["中餐馆-小吃-粉面馆","中餐馆-小吃-麻辣烫","中餐馆-小吃-饺子馆","中餐馆-小吃-包子","中餐馆-小吃-馄饨店","中餐馆-小吃-粥店","中餐馆-小吃-熟食","中餐馆-小吃-零食"],yuecai:["茶餐厅","燕翅鲍","潮汕菜","客家菜","湛江菜"],yuecai_b:["中餐馆-粤菜-茶餐厅","中餐馆-粤菜-燕翅鲍","中餐馆-粤菜-潮汕菜","中餐馆-粤菜-客家菜","中餐馆-粤菜-湛江菜"],westernSnack:["肯德基","麦当劳","德克士","赛百味"],westernSnack_b:["快餐-西式快餐-肯德基","快餐-西式快餐-麦当劳","快餐-西式快餐-德克士","快餐-西式快餐-赛百味"],chinaSnack:["永和大王","味千拉面","马兰拉面","真功夫","吉野家"],chinaSnack_b:["快餐-中式快餐-永和大王","快餐-中式快餐-味千拉面","快餐-中式快餐-马兰拉面","快餐-中式快餐-真功夫","快餐-中式快餐-吉野家"],sweetmeats:["面包西点","冰淇淋","甜点饮品","稻香村","面包新语","味多美"],sweetmeats_b:["甜点冷饮-面包西点-","甜点冷饮-冰淇淋","甜点冷饮-甜点饮品","甜点冷饮-稻香村","甜点冷饮-面包新语","甜点冷饮-味多美"],bakeshop:["稻香村","面包新语","味多美","好利来","元祖","贝儿多爸爸"],bakeshop_b:["甜点冷饮-面包西点-稻香村","甜点冷饮-面包西点-面包新语","甜点冷饮-面包西点-味多美","甜点冷饮-面包西点-好利来","甜点冷饮-面包西点-元祖","甜点冷饮-面包西点-贝儿多爸爸"],price:["0,+","1,20","20,50","50,120","120,+"],price_cn:["不限","<em>20</em>元以下","<em>20~50</em>元","<em>50~120</em>元","<em>120</em>元以上"],rule:["data_type","taste_rating","price","overall_rating","service_rating"],rule_cn:["<em>默认</em>","<em class='em_o'>口味</em>","<em class='em_p'>价格</em>","<em class='em_o'>好评</em>","<em class='em_o'>服务</em>"]}},hotel:{name:"hotel",cn_name:"酒店",cTag:{"星级酒店":"star","旅馆":"hotel"},sTag:{tagTxt:["全部","快捷酒店","星级酒店","旅馆","度假村","五星级","四星级","三星级","招待所","青年旅社"],tagTxt_b:["酒店","快捷酒店","星级酒店-","旅馆-","度假村","五星级","四星级","三星级","招待所","青年旅社"],star:["五星级","四星级","三星级"],star_b:["星级酒店-五星级","星级酒店-四星级","星级酒店-三星级"],hotel:["招待所","家庭旅馆","青年旅社","客栈"],hotel_b:["旅馆-招待所","旅馆-家庭旅馆","旅馆-青年旅社","旅馆-客栈"],price:["0,+","1,200","200,500","500,800","800,+"],price_cn:["不限","<em>200</em>元以下","<em>200~500</em>元","<em>500~800</em>元","<em>800</em>元以上"],rule:["default","price","total_score","level","health_score"],rule_cn:["<em>默认</em>","<em class='em_p'>价格</em>","<em class='em_o'>好评</em>","<em class='em_o'>星级</em>","<em class='em_o'>卫生</em>"]}},hospital:{name:"hospital",cn_name:"医院",sTag:{tagTxt:["全部","中医院","口腔医院","儿童医院","肿瘤医院","妇科医院","眼科医院","骨科医院","妇幼保健院"],tagTxt_b:["医院","中医院","口腔医院","儿童医院","肿瘤医院","妇科医院","眼科医院","骨科医院","妇幼保健院"]}},scope:{name:"scope",cn_name:"景点",sTag:{}},beauty:{name:"beauty",cn_name:"丽人",sTag:{tagTxt:["全部","美发","SPA","瘦身纤体","美甲"],tagTxt_b:["丽人","美发","SPA","瘦身纤体","美甲"],price:["0,+","0,50","50,100","100,300","300,+"],price_cn:["不限","<em>50</em>元以下","<em>50~100</em>元","<em>100~300</em>元","<em>300</em>元以上"],rule:["data_type","price","overall_rating","comment_num"],rule_cn:["<em>默认</em>","<em class='em_p'>价格</em>","<em class='em_o'>好评</em>","<em class='em_o'>点评数</em>"]}},life:{name:"life",cn_name:"休闲娱乐",cTag:{"健身":"js","体育场馆":"tycg","洗浴":"xy","棋牌室":"qps"},sTag:{tagTxt:["全部","电影院","KTV","体育场馆","健身","游泳馆","羽毛球馆","棋牌室","网吧","洗浴","按摩","足疗","spa","美容","美发","美甲","瑜伽"],tagTxt_b:["休闲娱乐","电影院","KTV","体育场馆-","健身-","游泳馆","羽毛球馆","棋牌室-","网吧","洗浴-","按摩","足疗","spa","美容","美发","美甲","瑜伽"],js:["健身房","瑜伽会所"],js_b:["健身-健身房","健身-瑜伽会所"],tycg:["游泳馆","体育中心","羽毛球馆","篮球场","溜冰场","桌球馆","网球场","足球场","乒乓球馆","保龄球馆","垂钓"],tycg_b:["体育场馆-游泳馆","体育场馆-体育中心","体育场馆-羽毛球馆","体育场馆-篮球场","体育场馆-溜冰场","体育场馆-桌球馆","体育场馆-网球场","体育场馆-足球场","体育场馆-乒乓球馆","体育场馆-保龄球馆","体育场馆-垂钓"],xy:["桑拿","温泉"],xy_b:["洗浴-桑拿","洗浴-温泉"],qps:["桌游"],qps_b:["棋牌室-桌游"],price:["0,+","0,20","20,50","50,120","120,+"],price_cn:["不限","<em>20</em>元以下","<em>20~50</em>元","<em>50~120</em>元","<em>120</em>元以上"],rule:["data_type","price","overall_rating","comment_num"],rule_cn:["<em>默认</em>","<em class='em_p'>价格</em>","<em class='em_o'>好评</em>","<em class='em_o'>点评数</em>"]}}},commonbi={src_name:"通用",price:"人均",priceUnit:"元"},place={hotel:null,scope:null,cinema:null,urlArr:"",URL_PARAM_PREFIX:"pl_",urlParam:{},sectionDiscount:Math.floor((new Date-Date.parse("01/01/2012"))/864e5)+",+",result:!1,barState:{tag:{display:!0},price:{display:!0},first:!0},statVar:{hotel:"",cater:"C_"},area:function(){var e={title:"位置",allName:"全部城区",level:0,menu:["位置"],bLast:!1};return function(a,t){return 2==arguments.length&&e[a]>=0&&(e[a]=t),e[a]}}(),placeRe:/^(hotel|cater|hospital|house|life|education|enterprise|scope|shopping|beauty)$/,placeConfig:{basicInfoCN:{cater:{src_name:"餐饮",service_rating:"服务",hygiene_rating:"卫生",facility_rating:"设施",taste_rating:"口味",environment_rating:"环境",price:"人均",priceUnit:"元"},hotel:{src_name:"酒店",service_rating:"服务",hygiene_rating:"卫生",facility_rating:"设施",price:"参考价",priceUnit:"元"},house:{src_name:"房产",price:"均价",priceUnit:"元/平方米"},hospital:{src_name:"医疗",tag:"标签",technology_rating:"技术",service_rating:"服务"},life:{src_name:"休闲娱乐",price:"人均",priceUnit:"元"},beauty:{src_name:"休闲娱乐",price:"人均",priceUnit:"元"},education:commonbi,enterprise:commonbi,scope:commonbi,shopping:commonbi},replace:{elong:{find:/\?f=301030\&/gi,replace:"?f=1994&"}}},insertHtml:function(e,a,t){var i=[],n=e.place_info,o=n.d_data_type,r="",s=[],c=n.d_discount2_section.replace("-",","),l=n.d_groupon_section.replace("-",","),p=n.d_cater_book_pc_section.replace("-",",");if(this.cachecategory=o.toLowerCase(),this.isUseCater="cater"===this.cachecategory,!pl_data[o])return"";this.stat_data_type=o.toUpperCase()+"_",this.place_dateType=e.place_info.d_data_type;var _="";e.place_info.d_sub_type&&(r=e.place_info.d_sub_type,r.indexOf("-")>-1?(s=r.split("-"),_=s[s.length-1],""==_&&(_=pl_data[o].cn_name)):_=r);var m="";e.place_info.d_price_section&&(m=e.place_info.d_price_section.replace("-",","));var u="";"hotel"==o?u="default":/^(cater|life|beauty)$/.test(o)&&(u="data_type"),e.place_info.d_sort_type&&(u=e.place_info.d_sort_type);var d="";if(e.place_param&&e.place_param[0].sort_rule?d=e.place_param[0].sort_rule:e.place_info.d_sort_rule&&(d=e.place_info.d_sort_rule),this.urlParam[this.URL_PARAM_PREFIX+"data_type"]=o,this.urlParam[this.URL_PARAM_PREFIX+"sub_type"]=r,this.urlParam[this.URL_PARAM_PREFIX+"price_section"]=m,this.urlParam[this.URL_PARAM_PREFIX+"sort_type"]=u,this.urlParam[this.URL_PARAM_PREFIX+"sort_rule"]=d,this.urlParam[this.URL_PARAM_PREFIX+"discount2_section"]=c,this.urlParam[this.URL_PARAM_PREFIX+"groupon_section"]=l,this.urlParam[this.URL_PARAM_PREFIX+"cater_book_pc_section"]=p,this.urlParam[this.URL_PARAM_PREFIX+"ticket_book_flag_section"]="0-+"==e.place_info.d_ticket_book_flag_section?"0,+":e.place_info.d_ticket_book_flag_section,this.urlParam[this.URL_PARAM_PREFIX+"movie_book_section"]="0-+"==e.place_info.d_movie_book_section?"0,+":e.place_info.d_movie_book_section,this.urlParam[this.URL_PARAM_PREFIX+"business_type"]=e.place_info.d_business_type,this.urlParam[this.URL_PARAM_PREFIX+"business_id"]=e.place_info.d_business_id,this.urlParam[this.URL_PARAM_PREFIX+"activity_gwj_section"]="0-+"==e.place_info.d_activity_gwj_section?"0,+":e.place_info.d_activity_gwj_section,place.urlArr=this.getUrlParamString(),"hotel"==this.cachecategory)return i.push(place.hotel.filterHtml(a,e)),i.join("");if("scope"==this.cachecategory)return i.push(place.scope.filterHtml(a,e)),i.join("");if("movie"==e.place_info.d_business_type||e.result.wd.match(/电影院|影院|剧场|影城|剧院/g))return i.push(place.cinema.filterHtml(a,e)),i.join("");if(this.isUseCater)return i.push(place.cater.filterHtml(a,e,t)),i.join("");if(2==s.length)var h=pl_data[o].cTag[s[0]],f=pl_data[o].cTag[s[0]]+"_b";if(3==s.length&&(h=pl_data[o].cTag[s[1]],f=pl_data[o].cTag[s[1]]+"_b"),3==s.length&&pl_data[o].sTag[h]){var g=pl_data[o].sTag[h],v=pl_data[o].sTag[f];i.push('<div  id="tagBar" class="poi_hotelBar"  onclick= "place.toggleBar(this, \'tag\');">'),i.push('<a class="backAll" href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+pl_data[o].cn_name+"','"+m+"','"+u+"','"+d+"');place.stopBubbleBar(event);return false;\">"+pl_data[o].cn_name+"</a>"),i.push('<span id="hotelCheap"><a href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+s[0]+"-','"+m+"','"+u+"','"+d+"');place.stopBubbleBar(event);return false;\">"+s[0]+"</a></span>"),i.push('<span class="three">'+s[1]+"</span>"),i.push("<span></span>"),i.push('<span class="bar_iconBg_c"></span>'),i.push("</div>"),i.push('<div class="poi_hotelCon" id="poi_hotelCon">');for(var y=0;y<g.length;y++)i.push(_!=g[y]?'<a href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+v[y]+"','"+m+"','"+u+"','"+d+"');return false;\">"+g[y]+"</a>":"<span>"+g[y]+"</span>")}else if(2==s.length&&pl_data[o].sTag[h]){var g=pl_data[o].sTag[h],v=pl_data[o].sTag[f];i.push('<div  id="tagBar" class="poi_hotelBar"  onclick= "place.toggleBar(this, \'tag\');">'),i.push('<a class="backAll" href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+pl_data[o].cn_name+"','"+m+"','"+u+"','"+d+"');place.stopBubbleBar(event);return false;\">"+pl_data[o].cn_name+"</a>"),i.push('<span id="hotelCheap" class="three">'+s[0]+"</span>"),i.push("<span></span>"),i.push('<span class="bar_iconBg_c"></span>'),i.push("</div>"),i.push('<div class="poi_hotelCon" id="poi_hotelCon">');for(var y=0;y<g.length;y++)i.push(_!=g[y]?'<a href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+v[y]+"','"+m+"','"+u+"','"+d+"');return false;\">"+g[y]+"</a>":"<span>"+g[y]+"</span>")}else{var b=pl_data[o].sTag.tagTxt,w=pl_data[o].sTag.tagTxt_b;i.push('<div id="tagBar" class="poi_hotelBar"  onclick= "place.toggleBar(this,\'tag\');">'),i.push('<span class="theAll">'+pl_data[o].cn_name+"</span>"),i.push("<span></span>"),i.push('<span class="bar_iconBg_c"></span>'),i.push("</div>"),i.push('<div class="poi_hotelCon" id="poi_hotelCon" style="padding-right:28px;">'),i.push(_==pl_data[o].cn_name?"<span>"+b[0]+"</span>":'<a href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+w[0]+"','"+m+"','"+u+"','"+d+"');return false;\">"+b[0]+"</a>");for(var k=1;k<b.length;k++)i.push(_==b[k]?"<span>"+b[k]+"</span>":'<a href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+w[k]+"','"+m+"','"+u+"','"+d+"');return false;\">"+b[k]+"</a>")}i.push("</div>");var T=pl_data[o].sTag.price_cn,j=pl_data[o].sTag.price;if(T){i.push('<div id="priceBar" class="poi_hotelBar"  onclick= "place.toggleBar(this,\'price\');"><span class="theAll">价格</span><span id="pl_show_price"></span><span class="bar_iconBg_c"></span></div><div class="poi_hotelCon" id="poi_price">');for(var P=0;P<T.length;P++)i.push(m!=j[P]?'<a href="javascript:void(0);" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+r+"','"+j[P]+"','"+u+"','"+d+"');return false;\">"+T[P]+"</a>":"<span>"+T[P]+"</span>");i.push("</div>")}var I,C=pl_data[o].sTag.rule_cn,x=pl_data[o].sTag.rule,D=315;if(C&&e.content){i.push('<div class="poi_hotel_PX" id="poi_hotel_PX">'),I=Math.floor(D/C.length)+"px";for(var A=0;A<C.length;A++)if(u!=x[A])i.push('<a style="width:'+I+';" href="javascript:void(0);" onmouseover="place.showTips(this)" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+r+"','"+m+"','"+x[A]+"','0',{reqtp:1});return false;\">"+C[A]+"</a>");else if("price"==u){var B="";""==d&&(B="1"),"1"==d&&(B="0"),"0"==d&&(B="1"),i.push('<a style="width:'+I+';" href="javascript:void(0);" onmouseover="place.showTips(this)" onclick="Instance(\''+a+"')._hotelType('"+o+"','"+r+"','"+m+"','"+x[A]+"','"+B+'\',{reqtp:1});return false;" class="rule'+B+'">'+C[A]+"</a>")}else i.push('<span style="width:'+I+';">'+C[A]+"</span>");i.push("</div>")}var S=place.isBoxInCity("preferential",e.current_city&&e.current_city.name),R=this.isDefaultFilterSection(c),L=this.isDefaultFilterSection(l),N=this.isDefaultFilterSection(p),U=[];return U.push('<div class="place-filter-cb" id="premium_sort">'),/^(cater|life|beauty)$/.test(o)&&(S||!S&&!R)&&U.push(['<a id="place_premium" href="javascript:void(0);" '+(R?"":' class="item-selected"')+" onclick=\"place.togglePremium(this, {guid:'"+a+"',data:'"+o+"',sub:'"+r+"',price:'"+m+"',sort:'"+u+"',rule:'"+d+"'});\">","<em class='checkbox'></em><span>有优惠</span>","</a>"].join("")),!(1&modelConfig.sup)&&L||/^(hotel)$/.test(o)||U.push(['<a id="place_groupon" href="javascript:void(0);" '+(L?"":' class="item-selected"')+" onclick=\"place.togglePremium(this, {guid:'"+a+"',data:'"+o+"',sub:'"+r+"',price:'"+m+"',sort:'"+u+"',rule:'"+d+"'});\">","<em class='checkbox'></em><span>正在团购</span><img src='../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/hot_103bb48.png'/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/hot_103bb48.png*//>","</a>"].join("")),/^(cater)$/.test(o)&&U.push(['<a id="place_book" href="javascript:void(0);" '+(N?"":' class="item-selected"')+" onclick=\"place.toggleBook(this, {guid:'"+a+"',data:'"+o+"',sub:'"+r+"',price:'"+m+"',sort:'"+u+"',rule:'"+d+"'});\">","<em class='checkbox'></em><span>在线订座</span>","</a>"].join("")),U.push("</div>"),U.length>2&&i.push(U.join("")),"hospital"==o&&i.push('<div style="border-bottom: 1px solid #F1F1F1;"></div>'),i.join("")},initialize:function(e,a){try{"hotel"==this.cachecategory&&place.hotel.initialize(),"scope"==this.cachecategory&&place.scope.initialize(e),"cater"==this.cachecategory&&place.cater.initialize(e),("movie"==this.urlParam.pl_business_type&&this.urlParam.pl_business_id||a.match(/电影院|影院|剧场|影城|剧院/g))&&place.cinema.initialize()}catch(t){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/ui/place/place.js",ln:508})}},getUrlArr:function(){return this.urlArr},togglePremium:function(e,a){var t=this.urlParam,i="item-selected",n=T.dom.hasClass(e,i),o=this.URL_PARAM_PREFIX+("place_premium"http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/==e.id?"discount2_section":"groupon_section"),r="place_premium"http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/==e.id?"d":"g";switch(n?(T.rc(e,i),delete t[o]):(T.ac(e,i),t[o]=this.sectionDiscount),r){case"d":addStat("poilistnormal.poi.discount");case"b":addStat("poilistnormal.poi.seatreserving");case"g":addStat("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/poilistnormal.poi.tuan")}Instance(a.guid).searchByFilter(t)},toggleBook:function(e,a){var t=this.urlParam,i="item-selected",n=T.dom.hasClass(e,i),o=this.URL_PARAM_PREFIX+"cater_book_pc_section",r="b";switch(n?(T.rc(e,i),delete t[o]):(T.ac(e,i),t[o]="1,1"),r){case"d":addStat("poilistnormal.poi.discount");case"b":addStat("poilistnormal.poi.seatreserving");case"g":addStat("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/poilistnormal.poi.tuan")}Instance(a.guid).searchByFilter(t)},isDefaultFilterSection:function(e){return/^0,\+$/.test(e)},getUrlParamString:function(e){var e=e||this.urlParam,a=[];for(var t in e)e.hasOwnProperty(t)&&a.push("&"+t+"="+encodeURIComponent(e[t]));return a.join("")},toggleBar:function(e,a){var t=e.nextSibling;"none"==t.style.display?place.showBar(e,a):place.hideBar(e,a),place.barState.first=!1},showBar:function(e,a){if(e){var t=e.nextSibling;t.style.display="block",e.lastChild.className="bar_iconBg_c";var i=e.childNodes[e.childNodes.length-2];i.style.display="none",place.barState[a].display=!0}},hideBar:function(e,a){if(e){var t=e.nextSibling;t.style.display="none",e.lastChild.className="bar_iconBg_o";var i=e.nextSibling.childNodes,n=e.childNodes[e.childNodes.length-2];n.style.display="block";for(var o=0;o<i.length;o++)"SPAN"==i[o].nodeName&&(n.innerHTML=i[o].innerHTML,n.style.fontWeight="bold",n.style.marginLeft="8px");place.barState[a].display=!1}},showTips:function(e){var a=e.firstChild.innerHTML,t="";switch(a){case"默认":t="默认排序";break;case"口味":t="口味从高到低";break;case"服务":t="服务从高到低";break;case"星级":t="星级从高到低";break;case"好评":t="好评从高到低";break;case"卫生":t="卫生从高到低";break;case"点评数":t="点评数从多到少";break;default:t=""}"价格"==a&&(t="rule1"!=e.className&&T.dom.hasClass(e,"asc")?"价格从低到高":"价格从高到低"),e.title="按"+t},stopBubbleBar:function(e){util.stopBubble(e)},generatePlaceListInfo:function(e){var a,t,i=e.content,n=e.context||{},o=i.ext,r=o.detail_info,s=o.src_name,c=(s.toUpperCase()+"_",e.placeInfo),l=e.cityCode,p=i.uid,_=i.poiType,m=[],u=e.index,d=0,h="hotel"==o.src_name&&parseInt(r.pc_bookable),f=("cater"==o.src_name&&parseInt(r.pc_bookable),r.hasOwnProperty("book_info")),g=/^(hospital|house|education|scope|shopping)$/,v=/^(hospital|house|education|shopping)$/,y="",b="";if("090300"==e.content.new_catalog_id&&((r.overall_rating||r.comment_num&&"0"!=r.comment_num)&&r.overall_rating&&(a=Math.round(1*r.overall_rating*12.2),a=isNaN(a)?0:a,a>0&&(g.test(s)||m.push('<div class="hotel_res" style="float:right;width:auto;margin: 2px 0 0;"><span tid="score_'+u+'" class="score new_score"><b style="width:'+a+'px">评分</b></span></div>'))),f)){var w,k="<a class=\"#{6}\" style=\"float:right;clear:right;margin-top:5px;margin-right:11px\" href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','List','#{7}');return false;\">#{5}</a>";w=[p,_,l,s,r.book_info?"movie_book":"Info_Page","购票",1==r.is_gwj&&r.activity_gwj&&1==r.activity_gwj.is_book?"movieOrderBtnGWJ":"movieOrderBtnSmall",c.d_business_id||""],m.push(baidu.string.format(k,w))}if(r.premium2&&"[object Array]"==Object.prototype.toString.call(r.premium2)&&r.premium2.length&&(d=1),o.src_name==c.d_data_type||""==c.d_data_type){if("090300"!=e.content.new_catalog_id&&(r.overall_rating||r.comment_num&&"0"!=r.comment_num)){var T=[];if(T.push('<p class="hotel_res">'),r.overall_rating&&(a=Math.round(1*r.overall_rating*12.2),a=isNaN(a)?0:a,a>0&&(g.test(s)||T.push('<span tid="score_'+u+'" class="score"><b style="width:'+a+'px">评分</b></span>'))),r.comment_num&&"hospital"!=o.src_name&&"090300"!=e.content.new_catalog_id&&(t=isNaN(r.comment_num)?0:r.comment_num,t>0)){var j=e.lineContent;T.push(j&&j[0]&&512===j[0].kind?'<span class="review_num"><a tid="poiComment_'+u+'" class="review" href="javascript:void(0)" onclick="place.showDetail(\''+p+"', "+_+", "+l+", '"+s+"','Page_Comm','List');addStat('poilistnormal.poi.sublinecomments');return false;\">"+t+"篇评论</a></span>":j&&j[0]&&256===j[0].kind?'<span class="review_num"><a tid="poiComment_'+u+'" class="review" href="javascript:void(0)" onclick="place.showDetail(\''+p+"', "+_+", "+l+", '"+s+"','Page_Comm','List');addStat('poilistnormal.poi.buslinecomments');return false;\">"+t+"篇评论</a></span>":'<span class="review_num"><a tid="poiComment_'+u+'" class="review" href="javascript:void(0)" onclick="place.showDetail(\''+p+"', "+_+", "+l+", '"+s+"','Page_Comm','List');return false;\">"+t+"篇评论</a></span>")}T.push("</p>"),T.length>2&&m.push(T.join(""))}if((r.price||c&&"health_score"==c.d_sort_type&&r.hygiene_rating||"taste_rating"==c.d_sort_type&&r.taste_rating||"service_rating"==c.d_sort_type&&r.service_rating)&&!v.test(s)){m.push('<p class="n_p_lineheight">');var P=place.placeConfig.basicInfoCN[s];if(r.price){var I,C=parseFloat(r.price);y=P.price,b=P.priceUnit,!isNaN(C)&&C>0&&y&&b&&("hotel"==s?(I=parseInt(r.pc_realtime_price),m.push(!isNaN(I)&&I&&I>0?'<span style="color:red" tid="itemPrice_'+u+'" id="itemPrice_'+u+'">¥'+I+b+"起&nbsp;&nbsp;</span>":'<span tid="itemPrice_'+u+'" id="itemPrice_'+u+'">¥'+parseInt(C)+b+"起&nbsp;&nbsp;</span>")):"090300"!=e.content.new_catalog_id&&m.push('<span tid="itemPrice_'+u+'" id="itemPrice_'+u+'">'+y+"："+C+b+"&nbsp;&nbsp;</span>"))}if(c&&"health_score"==c.d_sort_type&&r.hygiene_rating&&m.push('<span tid="hygiene_rating" class="hygiene_rating">'+P.hygiene_rating+"："+r.hygiene_rating+"</span>"),c&&"service_rating"==c.d_sort_type&&r.service_rating&&m.push('<span tid="hygiene_rating" class="hygiene_rating">'+P.service_rating+"："+r.service_rating+"</span>"),c&&"taste_rating"==c.d_sort_type&&r.taste_rating&&m.push('<span tid="hygiene_rating" class="hygiene_rating">'+P.taste_rating+"："+r.taste_rating+"</span>"),r.venue_flag&&m.push(['<a class="no-underline" onclick="place.showDetail(\''+p+"', "+_+", "+l+", '"+s+"','venue','List');return false\" href=\"javascript:void(0)\">","价格表&gt;&gt;","</a>"].join("")),h){var w,k="<a class=\"#{6}\" href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','List');return false;\">#{5}</a>";w=r.xiecheng_sales_promotion&&parseInt(r.xiecheng_sales_promotion)?[p,_,l,s,s,"促销","hotel-order-new hotel-order-new-xiecheng"]:[p,_,l,s,s,"预订","hotel-order-new hotel-order-new-small"],m.push(baidu.string.format(k,w))}m.push("</p>")}if(r.movie_film_count&&"090300"==e.content.new_catalog_id&&(this.urlParam.pl_business_id&&r.timetable.length?(m.push('<div class="movie-info-newest" style="width:208px;_width:204px;">'),m.push(baidu.string.format("<a href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','List','#{5}');return false;\"><span>近期场次<i class=\"arrow\"></i></span><em class=\"light\">"+r.timetable.slice(0,4).join('</em><em class="light">')+"</em></a>",[p,_,l,s,"movie_info",this.urlParam.pl_business_id]))):(m.push('<div class="movie-info-newest">'),m.push(baidu.string.format("<a href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','List');return false;\"><span>实时影讯<i class=\"arrow\"></i></span>目前<em>"+r.movie_film_count+"</em>部影片<em>正在上映!</em></a>",[p,_,l,s,"movie_info"]))),m.push("</div>"),m.push('<div style="clear:left"></div>')),r.ticket_book_flag){var w,C=parseFloat(r.list_min_price),k="<a class=\"#{6}\" href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','list');return false;\">#{5}</a>";C>0&&(m.push('<p class="n_p_lineheight">'),m.push('<span tid="itemPrice_'+u+'" id="itemPrice_'+u+'"><span style="color:red">¥'+C+"元起&nbsp;&nbsp;</span></span>"),w=[p,_,l,s,s,"预订","hotel-order-new hotel-order-new-small"],m.push(baidu.string.format(k,w)),m.push("</p>"))}}if(place.placeRe.test(s)&&r.tag&&!r.movie_film_count&&!r.other_opera_num&&"hotel"!=s&&"090300"!=e.content.new_catalog_id){var x=r.tag.replace(new RegExp(",","gm")," ");n.wd&&n.business_scope_type&&"meishi"==n.business_scope_type&&(x=-1!=x.indexOf(n.wd)?x.replace(n.wd,"<strong>"+n.wd+"</strong>"):"<strong>"+n.wd+"</strong> "+x),m.push('<p tid="itemTag_'+u+'" class="map_tagBox">标签：'+x),m.push("</p>")}if(r.premium2&&"[object Array]"==Object.prototype.toString.call(r.premium2)&&r.premium2.length&&"hotel"!=s){var D,A,B=r.premium2;if(B.length>1)for(var S=0;(D=B[S])&&"lbc-claim"!=D.name;S++);D=D||r.premium2[0],A=D.discount_title,A.length>15&&(A=A.substr(0,15)+"..."),m.push(['<p class="place-preferential" '+("090300"==e.content.new_catalog_id?'style="clear:left;"':"")+">","<a onclick=\"place.showDetail('"+p+"', "+_+", "+l+", '"+s+"','page_discount','List');\" href=\"javascript:void(0)\">","<em></em><strong>"+A+"</strong>","</a></p>"].join(""))}if(r.groupon&&"[object Array]"==Object.prototype.toString.call(r.groupon)&&"hotel"!=s&&"090300"!=e.content.new_catalog_id){var R=r.groupon_num||r.groupon.length;m.push("cater"==s?['<p class="place-preferential groupon" '+("090300"==e.content.new_catalog_id?'style="clear:left;"':"")+">","<a onclick=\"place.showDetail('"+p+"', "+_+", "+l+", '"+s+"','groupon','List');addStat('poilistnormal.poi.tuanbtn');ccStat('餐饮列表团购');addStat(7000,{'uid':'"+p+"',ct:'list_groupon_premium',category:'"+s+"',premium:"+d+",cid:'"+e.content.new_catalog_id+'\'});return false" href="javascript:void(0)">',"<em></em><strong>"+R+"条团购信息</strong>","</a></p>"].join(""):['<p class="place-preferential groupon" '+("090300"==e.content.new_catalog_id?'style="clear:left;"':"")+">","<a onclick=\"place.showDetail('"+p+"', "+_+", "+l+", '"+s+"','groupon','List');addStat(7000,{'uid':'"+p+"',ct:'list_groupon_premium',category:'"+s+"',premium:"+d+",cid:'"+e.content.new_catalog_id+'\'});return false" href="javascript:void(0)">',"<em></em><strong>"+R+"条团购信息</strong>","</a></p>"].join(""))}if(r.other_opera_num&&m.push(['<p class="link"><span>近期上演'+r.other_opera_num+"个剧目，</span>","<a onclick=\"place.showDetail('"+p+"', '"+_+"', '"+l+"', '"+s+"','other_opera','List');return false\" href=\"javascript:void(0)\">","查看演出信息&gt;&gt;","</a></p>"].join("")),r.announcement&&r.announcement.title){var L=r.announcement.title;L>15&&(L=L.substr(0,15)+"..."),m.push(['<p class="place-preferential announcement" '+("090300"==e.content.new_catalog_id?'style="clear:left;"':"")+">","<a onclick=\"place.showDetail('"+p+"', "+_+", "+l+", '"+s+"','announcement','List');return false\" href=\"javascript:void(0)\">","<em></em><strong>"+L+"</strong>","</a></p>"].join(""))}return m.push(this.gouwujieHtml(r,s,[p,_,l])),m.join("")},gouwujieHtml:function(e,a,t){var i=e.activity_gwj,n="<p class=\"place_gwj\"><a href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','List');return false;\">#{5}</a></p>",o={cater:"为人民服务餐厅，订座立返30元代金券",hotel:"为人民服务酒店，入住立返30元代金券",hotel_tips:"参与“为人民服务”优惠季，成功入住后每间夜即可返还30元百度团购全场通用代金券",life:"全场观影减10元 万达更有5折惠",tuan:"为人民服务商户，团购全场9折，满100再返200"},r="",s="";return 1==e.is_gwj&&i&&(1==i.is_book&&(r=o[a],s=o[a+"_tips"]||""),!r&&i.groupon&&i.groupon.length&&(r=o.tuan),r)?(t.push(a),t.push("activity_gwj"),t.push(r+"<b"+(T.browser.ie>8?' style="top:2px;"':"")+">◆</b>"),t.push(s),baidu.string.format(n,t)):""},generatePlaceIwTopInfo:function(e){var a=e.ext,t=a.detail_info,i=a.src_name,n=(i.toUpperCase()+"_",e.uid),o=e.poiType,r=e.cityCode,s=[],c="hotel"==a.src_name&&parseInt(t.pc_bookable),l=/^(hospital|house|education|scope|shopping)$/,p=/^(hospital|house|education|shopping)$/;if("cater"!=a.src_name&&t&&t.homepage&&s.push('<div class="url"><a href="'+t.homepage+'" target="_blank" >'+t.homepage+"</a></div>"),t&&(t.overall_rating||t.price)&&!c&&"090300"!=e.catId){if(s.push('<div class="hotel_iw">'),t.overall_rating){var _=Math.round(1*t.overall_rating*12.2);_=isNaN(_)?0:_,_>0&&(l.test(i)||s.push('<span class="score"><b style="width:'+_+'px">评分</b></span><span tid="iw_poi_score" class="starNum">'+t.overall_rating+"</span>"))}if(t.price){var m=parseFloat(t.price),u=place.placeConfig.basicInfoCN[a.src_name],d=u.price,h=u.priceUnit,f=parseFloat(t.realPrice);p.test(i)||(!isNaN(f)&&f>0?s.push('<span tid="iw_poi_price" class="price">报价：<span style="color:red">'+f+"元起</span></span>"):!isNaN(m)&&m>0&&d&&h&&s.push('<span tid="iw_poi_price" class="price">'+d+": "+m+h+"</span>"))}t.venue_flag&&s.push(['<a class="no-underline" onclick="place.showDetail(\''+n+"', "+o+", "+r+", '"+i+"','venue','Iw');return false\" href=\"javascript:void(0)\">","价格表&gt;&gt;","</a>"].join("")),s.push("</div>")}return s.join("")},generatePlaceIwBottomInfo:function(e){{var a=e.ext,t=this,i=a.detail_info,n=a.src_name||"",o=e.uid,r=e.poiType,s=e.cityCode,c=n.toUpperCase()+"_",l={action:"open_iw"},p=[],_=0,m="hotel"==a.src_name&&parseInt(i.pc_bookable),u="cater"==a.src_name&&parseInt(a.detail_info.pc_bookable);"scope"==a.src_name&&parseInt(i.ticket_book_flag)}if(u&&p.push(t.generateCaterBookPrice(e)),i.premium2&&"[object Array]"==Object.prototype.toString.call(i.premium2)&&i.premium2.length&&"hotel"!=n){var d,h,f=i.premium2;if(_=1,f.length>1)for(var g=0;(d=f[g])&&"lbc-claim"!=d.name;g++);d=d||i.premium2[0],h=d.discount_title,h.length>20&&(h=h.substr(0,20)+"..."),p.push(['<p class="place-preferential">',"<a onclick=\"place.showDetail('"+o+"', '"+r+"', '"+s+"', '"+n+"','page_discount','Iw');\" href=\"javascript:void(0)\">","<em></em><strong>"+h+"</strong><i></i>","</a></p>"].join("")),l.discount=1,addStat("7000",{area:"iw_page",item:"discount_show",from:"map"})}if(i.groupon&&"[object Array]"==Object.prototype.toString.call(i.groupon)&&"hotel"!=n){var v,y=i.groupon_num||i.groupon.length;v="cater"==n?'<p class="place-preferential groupon" '+("090300"==e.categoryId?'style="margin-top: 3px;"':"")+">                        <a onclick=\"place.showDetail('"+o+"', '"+r+"', '"+s+"', '"+n+"','groupon','Iw');addStat('http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/poiinfowin.poi.tuan');ccStat('餐饮气泡团购');addStat(7000,{'uid':'"+o+"',ct:'iw_groupon_premium',category:'"+n+"',premium:"+_+",cid:'"+e.categoryId+'\'});return false" href="javascript:void(0)">                        <em></em><strong>'+y+"条团购信息</strong>                        </a></p>":'<p class="place-preferential groupon" '+("090300"==e.categoryId?'style="margin-top: 3px;"':"")+">                        <a onclick=\"place.showDetail('"+o+"', '"+r+"', '"+s+"', '"+n+"','groupon','Iw');addStat(7000,{'uid':'"+o+"',ct:'iw_groupon_premium',category:'"+n+"',premium:"+_+",cid:'"+e.categoryId+'\'});return false" href="javascript:void(0)">                        <em></em><strong>'+y+"条团购信息</strong>                        </a></p>",p.push(v),l.groupon=1}if(i.announcement&&i.announcement.title){var b=i.announcement.title;b.length>20&&(b=b.substr(0,20)+"..."),p.push(['<p class="place-preferential announcement">',"<a onclick=\"place.showDetail('"+o+"', '"+r+"', '"+s+"', '"+n+"','announcement','Iw');\" href=\"javascript:void(0)\">","<em></em><strong>"+b+"</strong>","</a></p>"].join(""))}if(i.other_opera_num&&(p.push(['<p class="link"><span>近期上演'+i.other_opera_num+"个剧目，</span>","<a onclick=\"place.showDetail('"+o+"', '"+r+"', '"+s+"', '"+a.src_name+"','other_opera','Iw');return false\" href=\"javascript:void(0)\">","查看演出信息&gt;&gt;","</a></p>"].join("")),l.other_opera=1),"090300"!=e.categoryId&&(i.link=i.link||[])){var w=[];w.push(m?'<p tid="iw_poi_detail" class="link link-gray"><em>详情：</em>':'<p tid="iw_poi_detail" class="link"><em>详情：</em>');for(var k=0;k<i.link.length;k++)if(i.link&&i.link[k].url&&"DAODAO"!=i.link[k].name.toUpperCase()){var j=i.link[k].name,P=i.link[k].url,I=T.url.getQueryValue(P,"qt"),C="",x="",D={from:"map",category:n.toLowerCase(),fun:j,area:"iw"};if(I?(C=P,x=decodeURIComponent(T.url.getQueryValue(P,"url"))):(C="http://www.baidu.com/error.html",x=P),"kuxun"==j&&(x+="?fromid=Khslmapbaidu-S1168731-T1183261&est=marketing"),"elong"==j){var A=/^http:\/\/www\.elong\.com.*?(_|-)(\d*)(\.html|\-photos.*|_index_1\.html)$/,B="http://hotel.elong.com/search/$2",S="?semid=baidumap";x=x.replace(A,B+"-hotel/"+S)}"shenbian"==j&&-1==j.indexOf("bd=baidu_map")&&(/\?/.test(x)?x=x.replace(/(\?)(.*)$/,"$1bd=baidu_map&$2"):/\#/.test(x)?x=x.replace(/(\#)(.*)$/,"?bd=baidu_map#$2"):x+="?bd=baidu_map"),I?C=C.replace(/(&|\?|#)(url=)([^&#]*)(&|$|#)/,"$1$2"+encodeURIComponent(x)+"$4"):D.url=x,C=C+"&"+T.url.jsonToQuery(D,function(e){return encodeURIComponent(e)}),w.push("<span onclick=\"addStat(window['STAT_CODE']['STAT_'+'"+c+"'+'PLACE_BOX_LINK'],{name: '"+i.link[k].name+"'});addStat(window['STAT_CODE']['STAT_'+'"+c+"'+'PLACE_ALL_LINK'],{name: '"+i.link[k].name+"',uid:'"+o+"',ct:'iw' })\"><a href=\""+C+'" target="_blank">'+i.link[k].cn_name+"</a></span>")}w.push("</p>"),p.push(w.join(""))}return p.push(this.gouwujieHtml(i,n,[o,r,s])),i.movie_film_count&&"090300"==e.categoryId&&(this.urlParam.pl_business_id&&i.timetable.length?(p.push('<div class="movie-info-newest" style="width:208px;_width:204px;">'),p.push(baidu.string.format("<a href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','Iw','#{5}');return false;\"><span>近期场次<i class=\"arrow\"></i></span><em class=\"light\">"+i.timetable.slice(0,4).join('</em><em class="light">')+"</em></a>",[o,r,s,n,"movie_info",this.urlParam.pl_business_id]))):(p.push('<div class="movie-info-newest">'),p.push(baidu.string.format("<a href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','Iw');return false;\"><span>实时影讯<i class=\"arrow\"></i></span>目前<em>"+i.movie_film_count+"</em>部影片<em>正在上映!</em></a>",[o,r,s,n,"movie_info"]))),p.push("</div>"),l.other_movie=1),p.join("")
},generateAsyncBookPrice:function(e){var a,t,i,n,o,r=this,s=e.ext,c=e.uid,l="hotel"==s.src_name&&parseInt(s.detail_info.pc_bookable),p="scope"==s.src_name&&1===parseInt(s.detail_info.ticket_book_flag),_='<p class="async-book-loading"></p>',m="/detail";return p?r.generateScopeBookPrice(e):l?(t='<div class="async-book-container" data-uid="#{0}" >'+_+"</div>",t=T.string.format(t,[c]),i=new Date,n=new Date(i.getFullYear(),i.getMonth(),i.getDate()+2),o=new Date(i.getFullYear(),i.getMonth(),i.getDate()+3),a={qt:"ota",uid:c,st:T.date.format(n,"yyyy-MM-dd"),et:T.date.format(o,"yyyy-MM-dd")},setTimeout(function(){var t;return s.otaData?(t=T.json.parse(s.otaData),window.place.hotel.otaDataDecode(t.room_info||[]),void r.renderAsyncBookPrice(e,t)):void T.ajax(m+"?"+baidu.url.jsonToQuery(a),{data:a,dataType:"json",cache:!0,duration:1e4,success:function(a,t){var i=this;a=a||{};try{s.otaData=t.responseText,window.place.hotel.otaDataDecode(a.room_info||[]),r.renderAsyncBookPrice(e,a)}catch(n){i.onfailure()}},error:function(){r.renderAsyncBookPrice(e,{})},timeout:function(){r.renderAsyncBookPrice(e,{})}})},100),t):""},generateScopeBookPrice:function(e){function a(e){var a=T.dom(".async-book-container"),t=e.ext;try{a.find(".hotel-order-new").click(function(){var a,i=T.dom(this).attr("ticket-id");i&&(a={ticketId:i}),place.showDetail(e.uid,e.poiType,e.cityCode,t.src_name,t.src_name,"iw",baidu.url.jsonToQuery(a))}),a.find(".async-book-link").click(function(){place.showDetail(e.uid,e.poiType,e.cityCode,t.src_name,t.src_name,"")})}catch(i){}}{var t,i=e.ext.detail_info.brief_ticket;T.dom(".async-book-container"),e.ext}return t=this.createScopeBookHTML(e,i),setTimeout(function(){a(e)},350),t},generateCaterBookPrice:function(e){var a,t=e.ext.detail_info.ori_info,i=(T.dom(".async-book-container"),e.ext);return a="",a=T.string.format(a,[e.uid]),a+=place.createCaterBookPrice({renderData:t,cfg:e,ext:i})},generateAsyncBookByMovie:function(e){var a=this,t=e.uid,i={qt:"timetable",uid:t,from:"pc",sfrom:"map",sflag:"bubble"},n='<p class="async-book-loading"></p>';return this.urlParam.pl_business_id?(i.limit=20,html='<div class="async-book-container booking-movie booking-movie-single" style="margin-top: 3px" data-uid="#{0}" >'+n+"</div>"):html='<div class="async-book-container booking-movie" style="margin-top: 3px" data-uid="#{0}" >'+n+"</div>",html=T.string.format(html,[t]),T.ajax("/detail?"+baidu.url.jsonToQuery(i),{dataType:"json",success:function(t){var i=this;t=t||{};try{a.urlParam.pl_business_id&&(t=T.array.filter(t,function(e){return e.movie_id==a.urlParam.pl_business_id})),a.renderAsyncBookByMovie(e,t)}catch(n){i.error()}},error:function(){a.renderAsyncBookByMovie(e)},timeout:function(){a.renderAsyncBookByMovie(e)}}),html},renderAsyncBookPrice:function(e,a){try{var t,i,n,o,r=this,s=e.uid,c=e.ext,l=[],p=T.array;if(t=T.dom(".async-book-container"),0==t.length&&this.iw)return void this.iw.addEventListener("open",function(){r.renderAsyncBookPrice(e,a)});i=a.room_info||[],o=function(e){try{var a={};return a.roomTypeName=e.basic_info.room_type_name,a.roomId=e.basic_info.room_id,p.each(e.ota_list,function(e){p.each(e.price_info,function(e){var e=parseInt(e.room_price.price)-parseInt(e.minus&&e.minus.price||0)-parseInt(e.coupons&&e.coupons.price||0)+parseInt(e.tax_info&&e.tax_info.price||0);a.price=a.price?a.price>e?e:a.price:e})}),a}catch(t){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/ui/place/place.js",ln:1570})}},p.each(i,function(e){var a;return 2==l.length?!1:void((1==e.basic_info.book_state||2==e.basic_info.book_state)&&(a=o(e),a.roomTypeName&&a.price&&l.push(a)))}),l.length<2&&p.each(i,function(e){var a;return 2==l.length?!1:void(1!=e.basic_info.book_state&&2!=e.basic_info.book_state&&(a=o(e),a.roomTypeName&&a.price&&l.push(a)))}),0==l.length&&l.push({roomTypeName:"标准间",priceInfo:"暂无报价"}),n=this.createAsyncHTML(l),t.html(n),t.find(".async-book-link").click(function(){place.showDetail(s,e.poiType,e.cityCode,c.src_name,"Page","Iw")}),t.find(".hotel-order-new").click(function(){var a,t=T.dom(this).data("room-id");t&&(a={roomId:t}),place.showDetail(s,e.poiType,e.cityCode,c.src_name,c.src_name,"",baidu.url.jsonToQuery(a))})}catch(_){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:_.message||_.description,path:"common:widget/ui/place/place.js",ln:1647})}},renderAsyncBookByMovie:function(e,a){try{var t=this,i=a,n=e.uid,o=e.category,r=e.poiType,s=e.cityCode,c=T.dom(".async-book-loading");window.setTimeout(function(){html=i&&i.length?t.createAsyncMovieHTML(i,n,r,s,o):'<ul><li class="async-book-ota clearfix" style="text-align:center">暂无相关数据</li></ul><a class="async-book-link" href="javascript:void(0);" onclick="place.showDetail(\''+n+"', '"+r+"', '"+s+"', '"+o+"', 'movie_more', 'Iw');\">更多电影>></a>",c.length&&((!i||!i.length)&&c.parent().removeClass("booking-movie"),c[0].insertAdjacentHTML("beforeBegin",html),c.remove(),t.iw&&t.iw.redraw())},500)}catch(l){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:l.message||l.description,path:"common:widget/ui/place/place.js",ln:1694})}},addFilterByArea:function(e,a,t,i){if(GRControll.areaData[e.current_city.code]){var n=GRControll,o=e.current_city.code,r=place.area("level"),s=0,c=!0,l=null;if(n.areaCity=o,l=n.areaData[n.areaCity].district,t.push('<div  id="areaFilter" class="poi_hotelBar" onclick= "place.toggleBar(this, \'tag\');addStat(7000,{category:\''+i+"',area:'region_filter',action:'toggle'})\">"),t.push(1==place.area("menu").length?'<span class="theAll">'+place.area("title")+"</span>":"<a class='backAll' href='javascript:void(0);' onclick='Instance(\""+n.guid+'").changeArea({n:"选择城区",g:"'+n.areaData[n.areaCity].geo+"\",t:0});place.resetArea();place.stopBubbleBar(event);return false;'>"+place.area("title")+"</a>"),t.push("<span></span>"),r>0){r=r>1?1:r;for(var p=place.area("menu")[r],_=(place.area("menu")[place.area("level")],l.length);_--;)if(l[_].n==p){l[_].b?l=l[_].b:place.area("bLast",!0);break}2>r&&c&&l&&!place.area("bLast")&&(t.push('<span class="three">'+p+"</span>"),t.push("<span></span>"))}if(t.push('<span class="bar_iconBg_c"></span>'),t.push("</div>"),t.push('<div class="poi_hotelCon" id="areaLink">'),0==r&&t.push("<span>"+place.area("allName")+"</span>"),l)for(var _=0,m=l.length;m>_;_++)if(l[_].n==place.area("menu")[1]||l[_].n==place.area("menu")[2])t.push("<span>"+l[_].n+"</span>");else{s=place.area("level")>=1?1:0,place.area("bLast")&&(s=0);var u=0==s?"level1_click":place.area("bLast")?"level1_click":"level2_click";t.push("<a href='javascript:void(0)' onclick='Instance(\""+n.guid+'").changeArea({n:"'+l[_].n+'",g:"'+l[_].geo+'",t:'+s+'});addStat(7000,{category:"'+i+'",area:"region_filter",action:"'+u+"\"});return false;'>"+l[_].n+"</a>")}t.push("</div>"),2!=place.area("level")||place.area("bLast")||addStat(7e3,{category:i,area:"region_filter",action:"shangquan_show"}),addStat(7e3,{category:i,area:"region_filter",action:"show"})}},resetArea:function(){place.hotel&&(place.hotel.cacheCurrentIdxs=place.hotel.defaultSelected)},initAlert:function(e){var a=e.ext?e.ext.detail_info:{},t=[],i="",n="";switch(e.status){case 1:case 2:case 4:case 8:case 10:break;case 5:i="该店即将开业，建议确认后再去 ";break;case 3:case 9:case 11:i="可能已搬迁或关闭，建议确认后再去 "}return n=a&&a.point?"http://tousu.baidu.com/map/add?place="+encodeURIComponent(e.name)+"&lat="+encodeURIComponent(a.point.y)+"&lng="+encodeURIComponent(a.point.x)+"#1":"http://tousu.baidu.com/map/add?place="+encodeURIComponent(e.name)+"#1",i&&(t.push('<div class="msgBox inbub">'),t.push('<span class="alrt"></span>'),t.push(i),t.push('<a target="_blank" href="'+n+"\" onclick=\"addStat('7000',{area:'iw_page',item:'bub_alrt_clk',from:'map'})\">欢迎报错</a>"),t.push("</div>"),addStat("7000",{area:"iw_page",item:"bub_alrt_show",from:"map"})),t.join("")},createScopeBookHTML:function(cfg,renderDatas){try{if(!renderDatas)return"";var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="async-book-container" data-uid="',"undefined"==typeof uid?"":uid,'" >    <ul>         ');for(var i=0,ll=renderDatas.length;ll>i;i++)_template_fun_array.push('            <li class="async-book-ota clearfix"><span class="span1">',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/==typeof renderDatas[i].name?"":renderDatas[i].name,"</span>"),renderDatas[i].min_price&&_template_fun_array.push('<span class="span2 blue">¥',"undefined"==typeof renderDatas[i].min_price?"":renderDatas[i].min_price,"起</span>"),_template_fun_array.push('<span class="span3"><a href="javascript:void(0);" ticket-id="',"undefined"==typeof renderDatas[i].ticket_id?"":renderDatas[i].ticket_id,'" class="hotel-order-new hotel-order-new-small">预订</a></span>            </li>        ');_template_fun_array.push('    </ul>    <a class="async-book-link" href="javascript:void(0);">更多门票和价格>></a></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];return template({uid:cfg.uid,renderDatas:renderDatas})}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/ui/place/place.js",ln:1854})}},createAsyncHTML:function(renderDatas){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<ul>");for(var i=0,ll=renderDatas.length;ll>i;i++)_template_fun_array.push('    <li class="async-book-ota clearfix">        <span class="span1">',"undefined"==typeof renderDatas[i].roomTypeName?"":renderDatas[i].roomTypeName,"</span>"),renderDatas[i].price&&_template_fun_array.push('<span class="span2 blue">¥',"undefined"==typeof renderDatas[i].price?"":renderDatas[i].price,"起</span>"),_template_fun_array.push(""),renderDatas[i].priceInfo&&_template_fun_array.push('<span class="span2 gray">',"undefined"==typeof renderDatas[i].priceInfo?"":renderDatas[i].priceInfo,"</span>"),_template_fun_array.push('<span class="span3"><a href="javascript:void(0);" data-room-id="',"undefined"==typeof renderDatas[i].roomId?"":renderDatas[i].roomId,'" class="hotel-order-new hotel-order-new-small">预订</a></span>    </li>');_template_fun_array.push('</ul><a class="async-book-link" href="javascript:void(0);">更多房型和日期>></a>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];return template({renderDatas:renderDatas})}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/ui/place/place.js",ln:1863})}},createAsyncMovieHTML:function(renderDatas,uid,poiType,cityCode,category,movie_id){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<ul>");for(var i=0,ll=renderDatas.length;ll>i;i++){_template_fun_array.push("    ");var item=renderDatas[i];_template_fun_array.push('    <li class="async-book-ota clearfix">        <span class="span2" title="',"undefined"==typeof item.movie_name?"":item.movie_name,'">',"undefined"==typeof item.movie_name?"":item.movie_name,"</span>        "),item.movie_type&&_template_fun_array.push('<span class="span3 gray">',"undefined"==typeof item.movie_type?"":item.movie_type,"</span>"),_template_fun_array.push(""),(item.price||item.origin_price)&&_template_fun_array.push('<span class="span3 blue">¥',"undefined"==typeof(item.price||item.origin_price)?"":item.price||item.origin_price,"起</span>"),_template_fun_array.push('<span class="span3"><a href="javascript:void(0);" onclick="place.showDetail(&#39;',"undefined"==typeof uid?"":uid,"&#39;, &#39;","undefined"==typeof poiType?"":poiType,"&#39;, &#39;","undefined"==typeof cityCode?"":cityCode,"&#39;,&#39;","undefined"==typeof category?"":category,"&#39;, &#39;movie_film&#39;, &#39;Iw&#39;,&#39;","undefined"==typeof item.movie_id?"":item.movie_id,'&#39;);" class="movieOrderBtn">在线订座</a></span>    </li>')}_template_fun_array.push('</ul><a class="async-book-link" href="javascript:void(0);" onclick="place.showDetail(&#39;',"undefined"==typeof uid?"":uid,"&#39;, &#39;","undefined"==typeof poiType?"":poiType,"&#39;, &#39;","undefined"==typeof cityCode?"":cityCode,"&#39;,&#39;","undefined"==typeof category?"":category,'&#39;,&#39;movie_more&#39;, &#39;Iw&#39;);">更多电影>></a>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];return template({renderDatas:renderDatas,uid:uid,poiType:poiType,cityCode:cityCode,category:category})}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/ui/place/place.js",ln:1875})}},createCaterBookPrice:function(json){var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<p class="place-preferential bookab"><em class="order_icon"></em>',"undefined"==typeof renderData.content?"":renderData.content,"&nbsp;"),renderData.promotion.guarantee&&_template_fun_array.push('<em class="save_icon" title="已加入消费者保障计划！"></em>'),_template_fun_array.push(""),renderData.promotion.discount&&_template_fun_array.push('<em class="disc_icon"></em>'),_template_fun_array.push('    <a href="javascript:void(0);" onclick="addStat(&#39;poiinfowin.poi.seatreserving&#39;);place.showDetail(&#39;',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/ui/place/==typeof cfg.uid?"":cfg.uid,"&#39;, &#39;","undefined"==typeof cfg.poiType?"":cfg.poiType,"&#39;, &#39;","undefined"==typeof cfg.cityCode?"":cfg.cityCode,"&#39;, &#39;","undefined"==typeof ext.src_name?"":ext.src_name,"&#39;, &#39;cater_book&#39;, &#39;iw&#39;);addStat(STAT_CODE.STAT_OPENDEATIL_RIGHT, {type:&#39;","undefined"==typeof ext.src_name?"":ext.src_name,'&#39;, action:&#39;click&#39;, area: &#39;iw_page&#39;, item: &#39;ota_order&#39;});" class="hotel-order-new hotel-order-new-small" style="margin-top:-2px;">订座</a> </p>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];return template(json)},showDetail:function(e,a,t,i,n,o,r,s){if(e){var c={cuid:e,uid:e};o&&n&&(c.ct=o.toLowerCase()+"_"+n.toLowerCase()),i&&(c.category=i),addStat(STAT_CODE.STAT_POI_ONXQ,c),PlaceLog.addDetailLog({uid:e,trd:i,des:n,from:o})}var l=urlConfig.DETAIL_PAGE_URL,p=window.location.pathname,_="http://"+l+(p&&p.length<=1?"":window.location.pathname),m="inf";if(window.place&&window.place.placeRe.test(i)&&(_="http://"+l+"/detail",m="ninf"),a==constant.POI_TYPE_BUSLINE||a==constant.POI_TYPE_SUBLINE)_+="?newmap=1&t="+map.mapType+"&s="+encodeURIComponent("bsl&bsltp=0&uid="+e+"&c="+t);else{var u=map.getBounds(),d=Math.min(u.minX,u.maxX),h=Math.max(u.minX,u.maxX),f=Math.min(u.minY,u.maxY),g=Math.max(u.minY,u.maxY),v="("+d+","+f+";"+h+","+g+")",y=window.currentComponent&&window.currentComponent.curKw||"",y=encodeURIComponent(y),b="&wd="+y+"&b="+v+"&"+util.jsonToQuery(statParamInterceptor(),function(e){return encodeURIComponent(e)});if("life"==i&&(b+="&sfrom=map"),i){{i.toUpperCase()}if("ISHOP_INFO"==i?_+="/ishop/detail.html?newmap=1&s="+encodeURIComponent(m+"&uid="+e+"&c="+t):"ISHOP_INFO_IMG"==i&&(_+="/ishop/detail.html?newmap=1&s="+encodeURIComponent(m+"&uid="+e+"&c="+t)+"#picresult"),"Page"==n)_+="?qt="+m+"&uid="+e+b+"&detail="+i,s&&(_+="&business_id="+s);else if("Page_Pic"==n)_+="?qt="+m+"&uid="+e+b+"&detail="+i+"#picresult";else if("Page_Comm"==n)_+="?qt="+m+"&uid="+e+b+"&detail="+i+"#comment";else if("Pic_Page"==n)_+="?qt="+m+"&uid="+e+b+"&detail="+i;else if("Info_Page"==n)_+="?qt="+m+"&uid="+e+b+"&detail="+i;else if("page_discount"==n)_+="?qt="+m+"&uid="+e+b+"&detail="+i+"&dstype=discount";else if("groupon"==n||"premium"===n||"comment"===n){var w={comment:"newComments",premium:"premiumAndGroupon",groupon:"premiumAndGroupon"};_+="?qt="+m+"&uid="+e+b+"&detail="+i+"#"+w[n]}else"announcement"==n?_+="?qt="+m+"&uid="+e+b+"&detail="+i+"&antype=1#announcement":"movie_book"==n||"movie_film"==n||"movie_info"==n||"movie_more"==n?_+=location.href.match(/sfrom=shuangdan/g)?"?qt="+m+"&uid="+e+b+"&detail="+i+(r?"&target="+r:"")+"&channel=shuangdan"+(r?"#schedule-"+r:"#showTable"):"?qt="+m+"&uid="+e+b+"&detail="+i+(r?"&target="+r:"")+(r?"#schedule-"+r:"#showTable"):"venue"==n?_+="?qt="+m+"&uid="+e+b+"&detail="+i+"#venue":"other_opera"==n?_+="?qt="+m+"&uid="+e+b+"&detail="+i+"#schedule":"ota"==n||"hotel"==n?_+="?qt="+m+"&uid="+e+b+"&detail="+i+(r?"&"+r:"")+"#otalist":"scope"==n?_+="?qt="+m+"&uid="+e+b+"&detail="+i+(r?"&"+r:"")+"#otalist":"cater_book"==n&&(_+="?qt="+m+"&uid="+e+b+"&detail="+i+(r?"&"+r:"")+"#order-seat","list"==o&&"cater_book"==n&&addStat("poilistnormal.poi.reservingbtn"));/activity_/.test(n)&&(_+="?qt="+m+"&uid="+e+b+"&detail="+i+(r?"&"+r:"")+"#"+n)}else _+="?newmap=1&t="+map.mapType+"&s="+encodeURIComponent("inf&uid="+e+"&c="+t+"&it="+STAT_CODE.STAT_INF_NORMAL)}window.open(_)},showGroupon:function(e,a,t,i,n,o,r){PlaceLog.addDetailLog({uid:e,trd:i,des:n,from:o});var s=/url=(.*?)(&|$)/,c=s.exec(r);if(c){var l=decodeURIComponent(c[1]),p="?";/\?/.test(l)&&(p="&"),l=l+p+"cid=map_pc_bubble",r=r.replace(s,"url="+encodeURIComponent(l)+"$2")}window.open(r)},showTakeout:function(e){var a="http://waimai.baidu.com/waimai/shop/"+e;e&&window.open(a)},isBoxInCity:function(e,a){return!!specialPreferential[a.replace(/^\s*|\s*$/g,"").replace(/市$/,"")]},placeHookPano:function(e,a){this.placeRe.test(e.src_name||"")&&PlaceLog.addPanoLog({uid:e.uid,trd:e.src_name,from:a})}};module.exports=window.place=place});