define("common:widget/ui/setMyPlace/SetMyPlaceMgr.js",function(e,i,n){var t=(e("common:widget/com/componentManager.js"),e("common:widget/ui/util/util.js")),o=e("common:widget/ui/setMyPlace/SetMyPlaceList.js"),a=e("common:widget/ui/setMyPlace/SetMyPlaceStorer.js"),s=e("common:widget/ui/config/config.js"),d=(s.mapConfig,{isEmpty:function(e){return!/\S+/.test(e)},isNotWord:function(e){return!/^[\u4E00-\u9FA5\uf900-\ufa2d\w]{0,30}$/.test(e)},isOverLong:function(e,i){return T.string.getByteLength(e)>i?!0:!1}}),r={box:null,init:function(){var e=this;this.box=T.dom.create("div",{id:"smp_cover"}),this._innerFun=function(){e.resize()},T.on(window,"resize",this._innerFun)},show:function(){var e=this.box;T.browser.ie?document.body.appendChild(e):(document.body.appendChild(e),window.setTimeout(function(){e.style.opacity="0.2"},0)),this.resize()},hide:function(){var e=this;T.browser.ie?(e.box&&document.body.removeChild(e.box),e.clear()):(e.box.style.opacity=0,window.setTimeout(function(){e.box&&document.body.removeChild(e.box),e.clear()},250))},resize:function(){if(this.box){var e=this.box,i=t.getClientSize();6==T.browser.ie&&(e.style.width=i.width+"px",e.style.height=i.height+"px")}},clear:function(){this._innerFun&&(T.un(window,"resize",this._innerFun),delete this._innerFun),delete this.box}},c=[0,T.G("searchWrapper").offsetHeight],u=1,l=new BMap.Icon("../../../images/tools_img_39c80b4.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png*/,new BMap.Size(13,16),{offset:new BMap.Size(3,16),imageOffset:new BMap.Size(0,-280),infoWindowOffset:new BMap.Size(3,0)}),h={popOpts:{title:"设置常用地点",height:343,width:457,left:380,clickClose:!1,addDom:document.body,offset:c||[0,0],defaultAnchor:u,close:function(){h.closePop()}},helper:d,storer:a,popup:null,component:null,markers:{},infoWindows:{},openList:function(e,i){t.stopBubble(i||window.event),o.open(e),this.bindEvents()},init:function(){if(!window.isPrint){var e=this;a.init(function(){e.addAllPlace()})}},open:function(i){this.popup&&this.popup.close(),i=i||{};var n=this;e.async(["common:widget/ui/Popup/Popup.js","common:widget/com/SetMyPlace/SetMyPlace.js"],function(e,t){var o=n.popup=new e(n.popOpts);o.render(),o.hide(),r.init();new t({dom:o.content,cinfo:i});r.show(),o.show()});var t=T.browser.ie&&T.browser.ie<=7?"keypress":"keydown";T.on(window.document,t,function(e){n._escFun=arguments.callee,27==e.keyCode&&n.popup&&n.popup.close()})},clear:function(){if(this._escFun){var e=T.browser.ie&&T.browser.ie<=7?"keypress":"keydown";T.un(window.document,e,this._escFun),delete this._escFun}map.enableScrollWheelZoom(),this.component.dispose(),r.hide(),delete this.popup},addAllPlace:function(){var e=a.getAll();if(e&&0!=e.length)for(var i=0,n=e.length;n>i;i++)this.buildOverlay(e[i])},buildOverlay:function(e){var i=this,n=this.createMarker(e);return map.addOverlay(n),n.addEventListener("click",function(){t.loadSearchInfo(function(t){var o=i.createInfoWindow(e,t);t.openSearchInfoWnd(o,n)})}),{marker:n}},createInfoWindow:function(e,i){if(e){var n=e.point.split(","),t=i.createSearchInfoWnd({title:e.note,addr:e.addr},{smp:e.uid,cityCode:e.ccode,x:n[0],y:n[1]});return this.infoWindows[e.uid]=t,t}},createMarker:function(e){if(e){var i=t.getPoiPoint(e.point),n=new BMap.Marker(i,{icon:l,title:e.note,enableMassClear:!1});return this.markers[e.uid]=n,n}},updateOverLay:function(e){if(e&&e.uid){var i=e.uid,n=this.markers[i],t=this.infoWindows[i];n&&t&&(map.removeOverlay(n),map.removeOverlay(t)),this.buildOverlay(e)}},addMyPlace:function(e,i){this.open({note:e}),this.hideSug(),"PoiSearch"==i?addStat("indexheader.searchbox.setfusedplace",null,{da_src_bk:"searchBox"}):"iw_ssn"==i||"iw_esn"==i?addStat("poiinfowin.searchbox.setfusedplace",null,{da_src_bk:"bubble"}):addStat("indexheader.searchbox.setfusedplace",null,{da_src_bk:"busandnav"})},editMyPlace:function(e,i){t.stopBubble(e||window.event),this.open(a.getItemByUid(i)),window.MYADDRLAYER_FR_EDIT=!0,this.hideSug()},rmvMyplace:function(e,i,n){t.stopBubble(e||window.event);var o=window.confirm("是否要删除常用地点“"+n+"”?");o&&(this.markers[i]&&map.removeOverlay(this.markers[i]),a.rmvItemByUid(i)),this.hideSug()},showMyPlace:function(e){if(e&&this.markers[e]){var i=this.markers[e],n=this.infoWindows[e];i&&n&&t.loadSearchInfo(function(e){e.openSearchInfoWnd(n,i)}),map.centerAndZoom(i.getPoint(),16)}},itemClick:function(i,n,t,o){var s=e("common:widget/ui/searchBox/searchBox.js");if("PoiSearch"==t){var d=a.getItemByUid(i);return T.g(n).value=" ",void s.notShowSuggest.run()}if(s.notShowSuggest.run(),"PoiSearch"==n)this.showMyPlace(i),addStat("indexheader.searchbox.usefusedplace",null,{da_src_bk:"searchBox"});else{var d=a.getItemByUid(i);"iw_ssn"==n||"iw_esn"==n?(T.g(n).value=d.note,addStat("poiinfowin.searchbox.usefusedplace",null,{da_src_bk:"bubble"})):(s.setValue(n,d.note,o),addStat("indexheader.searchbox.usefusedplace",null,{da_src_bk:"busandnav"})),s.inputInfo[n]?s.inputInfo[n]=T.object.extend(s.inputInfo[n],d):e.async("common:widget/ui/throughpoint/Throughpoint.js",function(e){e.setTPPointBySmp(n,d)})}},hideSug:function(){o.hide()},closePop:function(){window.MYADDRLAYER_FR_EDIT=!1,this.clear()},bindEvents:function(){var e=this;baidu("a.add_place_btn").on("click",function(){var i=baidu(this).data("from")||"";e.addMyPlace("",i)}),baidu("tr.smp_sug_item").on("click",function(){var i=baidu(this).data("from")||"",n=baidu(this).data("uid")||"";e.itemClick(n,i)}),baidu("a.add_place").on("click",function(){var i=baidu(this).data("word")||"";e.addMyPlace(i)}),baidu("a.edit_place").on("click",function(i){var n=baidu(this).data("uid")||"";e.editMyPlace(i,n)}),baidu("a.remv_place").on("click",function(i){var n=baidu(this).data("uid")||"",t=baidu(this).data("word")||"";e.rmvMyplace(i,n,t)})}};n.exports=h});