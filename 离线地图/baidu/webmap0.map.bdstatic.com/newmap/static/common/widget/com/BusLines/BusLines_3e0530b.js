define("common:widget/com/BusLines/BusLines.js",function(require,exports,module){function BusLines(t){MapComponent.call(this,t),this.busStopPois=[],this.stationPoints=[],this.busPolyline=null,this.sCityCode=0,this.stopType=0,this.lineType=[[0,2,3,4,5,6,7,9,10,11],[1,12,13,14],[8]],this.template=null,this.templateObj={}}var componentManager=require("common:widget/com/componentManager.js"),constants=require("common:widget/ui/constant/Constant.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),util=require("common:widget/ui/util/util.js"),BShare=require("common:widget/ui/toolShare/ToolShare.js"),MapComponent=require("common:widget/com/MapComponent.js"),searchData=require("common:widget/ui/searchData/searchData.js"),config=require("common:widget/ui/config/config.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,PanoEntranceUtil=require("common:widget/ui/PanoEntranceUtil/PanoEntranceUtil.js"),mapInfoScrollPanel=require("common:widget/ui/mapInfoScroll/mapInfoScroll.js");T.lang.inherits(BusLines,MapComponent,"BusLines"),T.object.extend(BusLines.prototype,{render:function(){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<div class="mapinfo_con">    <div id="lines_',"undefined"==typeof guid?"":guid,'" class="bus">    '),0==error){_template_fun_array.push("            ");var line=content[0];_template_fun_array.push("      ");var _kind=line.kind;if(_template_fun_array.push('      <dl>          <dt>          <p class="detail_title">',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/==typeof line.name?"":line.name,'</p>          </dt>          <dd style="display:block">      <table cellspacing="1" cellpadding="0" class="info">      '),line.timetable){if(_template_fun_array.push("            <th>运营时间</th>            <td>                "),_kind){_template_fun_array.push("                    ");for(var _i=0;4>=_i;_i++)_template_fun_array.push("                        "),_kind&Math.pow(2,_i)&&_template_fun_array.push('                            <div class="buslines-type buslines-type-',"undefined"==typeof _i?"":_i,'"></div>                        '),_template_fun_array.push("                    ");_template_fun_array.push("                    "),(256==_kind||512==_kind)&&_template_fun_array.push('                        <div class="buslines-type buslines-type-default"></div>                    '),_template_fun_array.push("                ")}_template_fun_array.push("                ","undefined"==typeof line.timetable?"":line.timetable,"                "),line.timetable_ext&&_template_fun_array.push('                    <span class="buslines-more">',"undefined"==typeof line.timetable_ext?"":line.timetable_ext,"</span>                "),_template_fun_array.push("            </td>        </tr>      ")}_template_fun_array.push("      "),line.ticketCal&&_template_fun_array.push("        <tr>        <th>票制</th>        <td>","undefined"==typeof line.ticketCal?"":line.ticketCal,"</td>        </tr>        "),_template_fun_array.push("      "),line.distance&&_template_fun_array.push("        <tr>        <th>线路长度</th>        <td>","undefined"==typeof line.distance?"":line.distance,"</td>        </tr>      "),_template_fun_array.push("        ");var __kind={8:"普通公交",9:"轨道交通",10:"机场专线",11:"旅游线路",12:"轮渡"};if(_template_fun_array.push("        "),_kind){_template_fun_array.push("            ");for(var __i=8;12>=__i;__i++)_template_fun_array.push("                "),_kind&Math.pow(2,__i)&&_template_fun_array.push("                  <tr>                      <th>车辆类型</th>                                         <td>","undefined"==typeof __kind[__i]?"":__kind[__i],"</td>                  </tr>                "),_template_fun_array.push("            ");_template_fun_array.push("        ")}_template_fun_array.push("      "),line.company&&_template_fun_array.push("          <tr>          <th>所属公司</th>          <td>","undefined"==typeof line.company?"":line.company,"</td>          </tr>      "),_template_fun_array.push("      </table>      "),_template_fun_array.push(1==stopType?"          <p class='stationsAlong'>沿线地铁站:</p>      ":"          <p class='stationsAlong'>沿线公交车站:</p>      "),_template_fun_array.push("          <table class=\"line_table\" cellspacing='0' cellpadding='0' class='station'>          <tr>            ");var stops=line.stations;_template_fun_array.push("    ");for(var j=0;j<stops.length;j++)_template_fun_array.push('    <tr id="stop_list_',"undefined"==typeof j?"":j,'">    <th>    <img src="',"../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/blank.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/blank.gif*/,'" class="list_arrow" />    ',"undefined"==typeof(j+1)?"":j+1,'    </th>    <td>            <a data-buslineUid="',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/==typeof line.uid?"":line.uid,'" data-uid="',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/==typeof stops[j].uid?"":stops[j].uid,'" data-name="',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/==typeof stops[j].name?"":stops[j].name,'" data-point="',"undefined"==typeof util.parseGeo(stops[j].geo).points?"":util.parseGeo(stops[j].geo).points,'" data-poitype="',"undefined"==typeof(1==stopType?"010A03":"010A05")?"":1==stopType?"010A03":"010A05",'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:visiable">                    <img src="',"/newmap/static/common/images/transparent.gif",'" />            </a>        <a data-index="',"undefined"==typeof j?"":j,'" data-name="',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/==typeof line.name?"":line.name,'" >',"undefined"http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/==typeof stops[j].name?"":stops[j].name,"<a>    </td>    </tr>    ");_template_fun_array.push("    </tr>    </table>      </dd>    </dl>    ")}else _template_fun_array.push("      <p>抱歉，您访问的页面已不存在，可能由于数据更新导致。</p>      <p>百度建议您重新搜索。</p>    ");_template_fun_array.push("    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],style=".station td a{text-decoration:none}.station td a:hover,.station td a:focus{text-decoration:underline}table.info td{width:auto}table.line_talbe td{width:267px}.buslines-type{margin-top:6px;margin-right:5px;width:41px;height:17px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_tp_4626a24.gif)}.buslines-type-default{background-position:0 0}.buslines-type-0{background-position:0 -17px}.buslines-type-1{background-position:0 -34px}.buslines-type-2{background-position:0 -51px}.buslines-type-3{background-position:0 -68px}.buslines-type-4{background-position:0 -85px}.buslines-more{color:#999;line-height:20px;margin-top:-2px;margin-bottom:5px;width:100%;float:left}.line_table a{text-decoration:none}.line_table a:hover{text-decoration:underline}";require.loadCss({content:style,name:"BusLines"});var templateObj={},json=this.json;BShare.getMInfo=function(){var t="";return json&&0==json.result.error&&(t=json.content[0].name),{text:t,className:me._className,type:"busline"}},this.sCityCode=json.current_city?json.current_city.code:modelConfig.cityCode;var me=this,r=json.result,c=json.content,error=r.error,sHtml=[];return 0==error&&(this.showBusLine(),this.stopType=this.returnLType(parseInt(r.linetype))),templateObj={error:error,content:c,result:r,stopType:this.stopType},template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/BusLines/BusLines.js",ln:95})}},initialize:function(){try{var t=this;mapInfoScrollPanel?mapInfoScrollPanel.show():T.g("MapInfo").style.overflowY="auto",this.setPanoEntrances(),baidu("table.line_table").delegate("a","click",function(e){var n=baidu(this).data("index"),a=baidu(this).data("name");t.selectBusStop(n,a),e.preventDefault()})}catch(e){"undefined"!=typeof alog&&alog("http://webmap0.map.bdstatic.com/newmap/static/common/widget/com/BusLines/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/BusLines/BusLines.js",ln:118})}},showBusLine:function(){var t=this,e=this.json.content[0],n=util.parseGeo(e.geo);2==n.type&&(map.showTerminal="yes",t.busPolyline=mapUtil.addRoute(n.points,constants.ROUTE_TYPE_BUS));var a=t.curStops=e.stations;t.busStopPois=[],t.stationPoints=[];for(var i=0,o=a.length;o>i;i++)!function(){var n=i,o=util.parseGeo(a[n].geo);if(1==o.type){var s=mapUtil.addBusStopPoi(o.points,a[n].name);t.busStopPois.push(s),s.addEventListener("click",function(){t.selectBusStop(n,e.name)}),t.stationPoints.push(util.getPoiPoint(o.points))}}();mapUtil.setViewport(t.stationPoints)},selectBusStop:function(t,e){if(window.searchInViewCtrl&&window.searchInViewCtrl.exit(),this.curStopSelIndex!=t||this.stationPoints[t]&&!map.getBounds().containsPoint(this.stationPoints[t])){var n=this,a=this.curStops,i=this.json.content,o=n.busStopPois[t];map.closeInfoWindow();var s=this.curStopSelIndex;this.curStopSelIndex=t;var r=1!=this.stopType?constants.POI_TYPE_BUSSTOP:constants.POI_TYPE_SUBSTOP,p=i[0].uid;searchData.fetch("inf&it=2&uid="+a[t].uid+"&c="+n.sCityCode,function(i){if(i){var s,l=e;i.content&&i.content.addr&&i.content.blinfo&&(l=i.content.addr,s=i.content.blinfo),l=T.array.unique(l.split(";")).join("; ");var u="";u=i.content&&i.content.primary_uid?i.content.primary_uid:a[t].uid,util.loadSearchInfo(function(e){var i=e.createSearchInfoWnd({title:a[t].name,addr:l,blinfo:s,uid:u,poiType:r},{forBusLine:!0,cityCode:n.sCityCode,x:o.point.lng,y:o.point.lat});if(n.busPanoData&&n.busPanoData[t]){var d=n.busPanoData[t];d.buslineUid=p,d.uid=u,i=PanoEntranceUtil.addPanoThumbnailsInInfoWnd([i],[d],n.busPanoData,"busline")[0]}i.addEventListener("close",function(){T.G("stop_list_"+n.curStopSelIndex)&&T.rc(T.G("stop_list_"+n.curStopSelIndex),"selected"),n.curStopSelIndex=-1}),e.openSearchInfoWnd(i,o)})}}),T.G("stop_list_"+s)&&T.rc(T.G("stop_list_"+s),"selected"),T.G("stop_list_"+t)&&T.ac(T.G("stop_list_"+t),"selected")}},returnLType:function(t){var e=this.lineType.length;for(i=0;e>i;i++){var n=this.lineType[i];for(j=0;j<n.length;j++){var a=n[j];if(a==t)return i}}},setPanoEntrances:function(){for(var t=T(this.$el).find(".list_street_view_poi"),e=[],n=this,a=0;a<t.length;a++)e.push({mercatorLnglat:t[a].getAttribute("data-point"),poiType:t[a].getAttribute("data-poitype"),name:t[a].getAttribute("data-name")});PanoEntranceUtil.insertPanoInfoInSearch(e,"busline",function(e){n.busPanoData=e,PanoEntranceUtil.walkThroughPanoEntrances(t,e,"busline")})}}),module.exports=BusLines});