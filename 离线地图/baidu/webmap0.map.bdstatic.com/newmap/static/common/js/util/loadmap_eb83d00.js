!function(window){function geoToPoint(e){var a=e.split("|");if(1==a[0]){var n=a[1].split(","),t=new BMap.Point(parseFloat(n[0]),parseFloat(n[1]));return t}}function getParam(e){if(e.indexOf("?")>-1)var a=e.slice(e.indexOf("?")+1);else{if(!(e.indexOf("#")>-1))return;var a=e.slice(e.indexOf("#")+1)}if(""!=a){for(var n={},t=a.split("&"),o=0;o<t.length;o++){var i=t[o].split("=");if(i[1]){var r=i[1].indexOf("#");i[1]=r>-1?i[1].slice(0,r):i[1],n[i[0]]=i[1]}}return n}}function setCookie(e,a){var n=1440,t=new Date;t.setTime(t.getTime()+60*n*1e3),document.cookie=e+"="+escape(a)+";expires="+t.toGMTString()}function getCookie(e){var a,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(a=document.cookie.match(n))?unescape(a[2]):null}var PanoLoading=require("common:widget/pano/module/PanoLoading/PanoLoading.js"),userAuth=require("common:widget/com/UserAuth/userAuth.js"),isPrint=window.isPrint=location.href.indexOf("pw=2")>0;if(window.BMAP_TYPE_DIMENSIONAL=window.BMAP_PERSPECTIVE_MAP,window.BMAP_TYPE_HYBIRD="B_SATELLITE_STREET",BMap.PolylineTItem=BMap.DistanceTool,!isPrint){var mc=document.getElementById("MapHolder"),mapInfoTab=document.getElementById("MapInfoTab"),mi=document.getElementById("MapInfo"),vs=document.getElementById("shad_v"),mch=document.body.clientHeight-147,toolsCon=document.getElementById("toolsContent");mch=0>mch?0:mch,mc.style.height=mch+32+"px",mi.style.height=mch+"px",vs.style.height=mch+"px",toolsCon.style.height=mch-55+"px",mapInfoTab.style.top=parseInt((mch-55)/2)+"px",PanoLoading.createMask(getParam(location.href),location.href),document.getElementById("searchWrapper").style.display="block",document.getElementById("tools-container").style.display="block"}var mapType=BMAP_NORMAL_MAP,param=getParam(location.href);param&&(param.tn||param.mt)&&(mapType=param.tn||param.mt);var enableCanvas2dMap=getCookie("BMap_enableCanvas2dMap");if(null===enableCanvas2dMap){var random=Math.ceil(10*Math.random());enableCanvas2dMap=1>=random?!1:!1,setCookie("BMap_enableCanvas2dMap",enableCanvas2dMap?1:0)}else enableCanvas2dMap=1===parseInt(enableCanvas2dMap)?!0:!1;var href=location.href;/drawtype=vector/i.test(href)&&(enableCanvas2dMap=!0),/drawtype=raster/i.test(href)&&(enableCanvas2dMap=!1);var isSameCondition=!0;window.devicePixelRatio&&window.devicePixelRatio>=2&&(enableCanvas2dMap=!1,isSameCondition=!1);var ieReg=/MSIE (\d+(\.\d+)?)/;ieReg.test(navigator.userAgent),9==parseFloat(RegExp.$1)&&(enableCanvas2dMap=!1,isSameCondition=!1);try{var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d")}catch(e){enableCanvas2dMap=!1,isSameCondition=!1}window.isPrint&&(enableCanvas2dMap=!1);var map=window.map=new BMap.Map("MapHolder",{coordType:BMAP_COORD_MERCATOR,zoomLevelMin:3,mapType:mapType,enableCanvas2dMap:!1});map.enableLoadTiles=!0,map.enableKeyboard(),map.enableScrollWheelZoom(),map.enableInertialDragging(),map.enableContinuousZoom();var COUNTRY_LEVEL=4,point=new BMap.Point(12957320,4825100),level=COUNTRY_LEVEL,cityType=[4,11,12,15];if(null!=window._OLR){var json=null;window.JSON&&"[object Function]"==Object.prototype.toString.call(JSON.parse)?json=JSON.parse(window._OLR.index):eval("var json ="+window._OLR.index),window._OLR.hot_city=json.hot_city,point=geoToPoint(json.content.geo),level=cityType[json.content.city_type]}if(param&&param.c){var p=param.c.split(",");if(2==p.length){var lng=parseFloat(p[0]),lat=parseFloat(p[1]);"number"==typeof lng&&"number"==typeof lat&&(point=new BMap.Point(lng,lat))}if(param.l&&"number"==typeof parseInt(param.l)&&(level=parseInt(param.l)),mapType==BMAP_TYPE_DIMENSIONAL){var _city=param.cc;if(1==isPrint){var c_city={bj:"北京",sh:"上海",gz:"广州",sz:"深圳",quanzhou:"泉州",kunming:"昆明",fuzhou:"福州",dongguan:"东莞",wuhan:"武汉",taiyuan:"太原",bengbu:"蚌埠",yancheng:"盐城",yiwu:"义乌"};_city=c_city[param.cc]}_city&&(map.setCurrentCity(_city),point=BMap.Project.convert3DTo2D(map.currentCity,point))}}map.centerAndZoom(point,level),window.stdMapCtrl=new BMap.NavigationControl(isPrint?{type:BMAP_NAVIGATION_CONTROL_ZOOM}:{from:"MAP_INDEX",offset:new BMap.Size(8,40)}),map.addControl(window.stdMapCtrl),window.maptypeCtrl=new BMap.MapTypeControl({offset:new BMap.Size(10,42),anchor:BMAP_ANCHOR_TOP_RIGHT}),map.addControl(window.maptypeCtrl),window.scaleCtrl=new BMap.ScaleControl({offset:new BMap.Size(5,20),printable:!0}),map.addControl(window.scaleCtrl),window.overviewCtrl=new BMap.OverviewMapControl,map.addControl(window.overviewCtrl),overviewCtrl.hide(),map.addEventListener("dragend",userAuth.sendUserOp),map.addEventListener("zoomend",userAuth.sendUserOp),setInterval(function(){userAuth.sendImage(2)},3e5),require.async(["common:widget/ui/tangram/tangram.js","common:widget/ui/stat/statCode.js","common:widget/ui/init/init.js"],function(e,a,n){n.init(),addStat(enableCanvas2dMap?"basemap.mapbase.personalmap_totalnum":"basemap.mapbase.nopersonalmap_totalnum")})}(window);