define("common:widget/ui/mapRevert/MapRevert.js",function(require,exports,module){var util=require("common:widget/ui/util/util.js"),comMgr=require("common:widget/com/componentManager.js"),config=require("common:widget/ui/config/config.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),traffic=require("common:widget/ui/Traffic/Traffic.js"),signMgr=require("common:widget/ui/signMgr/signMgr.js"),aqiMgr=require("common:widget/ui/AQIMgr/AQIMgr.js"),PanoInterface=require("common:widget/pano/PanoInterface/PanoInterface.js"),modelConfig=config.modelConfig,MapRevert={isRevert:!1,revert:function(){var e=location.href,a=util.getParam(e);if(a=util.extendHashParam(e,a),!a)return!1;if(null!=a.q){var o=0;for(var r in a)o++;1==o&&window.setTimeout(function(){try{T.g("PoiSearch").value=decodeURIComponent(a.q)}catch(e){}},300)}return a.mapShareId&&signMgr.parseShare(a.mapShareId),a.poiShareUid&&(a.s=encodeURIComponent("inf&uid="+a.poiShareUid+"&c="+a.cityCode)),a.s?(this.setModel(a),!0):a.poiShareId?(this.revertPoiShare(a),!0):1==a.aqi&&a.cname?(aqiMgr.revert(decodeURIComponent(a.cname)),!0):!1},setModel:function(param){var me=this,opts={cinfo:{cityInit:1},onload:function(){var e=param.tn||param.mt;if(param.c){var a=param.c.split(","),o={};if(2==a.length){{parseFloat(a[0]),parseFloat(a[1])}o=new BMap.Point(parseFloat(a[0]),parseFloat(a[1])),e==BMAP_TYPE_DIMENSIONAL&&(o=BMap.Project.convert3DTo2D(map.currentCity,o)),map.setMapType(e),map.centerAndZoom(o,parseInt(param.l))}}param.panoid&&param.panotype&&me.revertStreetView(param)}};if(null!=param.l&&"number"==typeof parseInt(param.l)&&(opts.cinfo._maplevel=parseInt(param.l)),null!=param.c){var p=param.c.split(",");if(2==p.length){var lng=parseFloat(p[0]),lat=parseFloat(p[1]),point=new BMap.Point(p[0],p[1]);opts.cinfo._centerPoint=point}}var index=param.i;null!=index&&(opts.cinfo._index=index,opts.cinfo.index=index);var showAll=param.poiall;showAll&&(opts.cinfo.poiall=1);var smsCode=param.sms;smsCode&&(opts.cinfo.sms=smsCode),traffic.setBtn(!!param.tfc,!0);var poPindex=param.pi;null!=poPindex&&(opts.cinfo._popIndex=parseInt(poPindex)),null!=param.ttype&&(opts.cinfo.trafType=param.ttype);var popPoint=param.b;if(null!=popPoint){var p=popPoint.split(",");if(2==p.length){var lng=parseFloat(p[0]),lat=parseFloat(p[1]),point=new BMap.Point(p[0],p[1]);opts.cinfo._popPoint=point}}param.s=param.s.replace(/%u[0-9a-zA-Z]{4}/gi,function(e){return encodeURIComponent(unescape(e))});var qs=[];try{qs=decodeURIComponent(param.s).split("&")}catch(e){return void comMgr.load("Error",{dom:T.g("MapInfo")})}for(var query="",i=0,l=qs.length;l>i;i++){var tempQ=qs[i].split("=");if(0!=tempQ.length)if(1!=tempQ.length){var q=tempQ.slice(1).join("");("ec"==tempQ[0]||"en"==tempQ[0])&&(q=q.replace(/\+/g," ")),query+="&"+tempQ[0]+"="+encodeURIComponent(decodeURIComponent(q))}else query+=tempQ[0]}if(query=0==query.indexOf("&")?query.substring(1):query,!query.match(/.*&c=\d{1,3}.*/)){var cc=modelConfig.cityCode;if(_OLR&&_OLR.index)try{eval("var ccd ="+_OLR.index),cc=ccd.content.code}catch(e){cc=modelConfig.cityCode}null==query.match(/tpl:/)&&(query+="&c="+cc)}var queryType=T.trim(qs[0]);switch("alamap"==param.from&&(query+="&provider=pc-aladin"),queryType){case"bt":query=query.replace(/wd1=(.*)&/,"sn=2$$$$$$$$$$$$$1$$$$$$&"),query=query.replace(/wd2=(.*)&/,"en=2$$$$$$$$$$$$$1$$$$$$&"),query&&query.indexOf("&exptype=")<0&&(query+="&exptype=dep&exptime=&version=5");case"nav":query=query.replace(/wd1=(.*)&/,"sn=2$$$$$$$$$$$$$1$$$$$$&"),query=query.replace(/wd2=(.*)&/,"en=2$$$$$$$$$$$$$1$$$$$$&");break;case"s":}opts.dom=T.g("MapInfo"),query.match(/tpl:City/)?comMgr.load("City",opts):comMgr.go(query,opts),searchBox.parseShare(decodeURIComponent(param.s))},revertPhotoTour:function(e,a){PanoInterface.showPhotoTour(e,a)},revertStreetView:function(e){var a="",o="";e.pid?(o=e.pid,a=e.iid||""):"inter"===e.panotype?a=e.panoid:o=e.panoid,PanoInterface.showPano({panoId:o,panoIId:a,panoType:e.panotype,panoHeading:e.heading,panoPitch:e.pitch,panoZoom:e.l,panoShareParam:e.psp,from:"share"}),"alamap"http://webmap2.map.bdstatic.com/newmap/static/common/widget/ui/mapRevert/===e.from?addStat(STAT_CODE.STAT_PANORAMA,{item:e.panotype,catalog:"alamap",func:"alamap",query:e.pword}):addStat(STAT_CODE.STAT_PANORAMA,{from:"share",item:e.panotype})},revertPoiShare:function(e){comMgr.start_event=(new Date).getTime(),comMgr.load("PoiShare",{onload:function(){var a=e.tn||e.mt;map.mapType!==a&&map.setMapType(a)}})},init:function(){this.revert()||(comMgr.load("City",{cinfo:{cityInit:1},onload:function(){var e="../../../../../../../map.baidu.com/index.htm#panoid=0100220000130728103000405J3&panotype=street&heading=2&pitch=-2&l=13&tn=B_NORMAL_MAP&sc=0&newmap=1&shareurl=1&pid=0100220000130728103000405J3&psp={%22PanoModule%22%3A{%22markerUid%22%3A%224eb3b53350e1746c4302450c%22}%2C%22PoiInfoPanelModule%22%3A{%22uid%22%3A%224eb3b53350e1746c4302450c%22}}"/*tpa=http://map.baidu.com/#panoid=0100220000130728103000405J3&panotype=street&heading=2&pitch=-2&l=13&tn=B_NORMAL_MAP&sc=0&newmap=1&shareurl=1&pid=0100220000130728103000405J3&psp={%22PanoModule%22%3A{%22markerUid%22%3A%224eb3b53350e1746c4302450c%22}%2C%22PoiInfoPanelModule%22%3A{%22uid%22%3A%224eb3b53350e1746c4302450c%22}}*/,a="../../../../../../../map.baidu.com/index.htm#panoid=0100220000130728103000405J3&panotype=street&heading=2&pitch=-2&l=13&tn=B_NORMAL_MAP&sc=0&newmap=1&shareurl=1&pid=0100220000130728103000405J3&psp={%22PanoModule%22%3A{%22markerUid%22%3A%224eb3b53350e1746c4302450c%22}%2C%22PoiInfoPanelModule%22%3A{%2"/*tpa=http://map.baidu.com/#panoid=0100220000130728103000405J3&panotype=street&heading=2&pitch=-2&l=13&tn=B_NORMAL_MAP&sc=0&newmap=1&shareurl=1&pid=0100220000130728103000405J3&psp={%22PanoModule%22%3A{%22markerUid%22%3A%224eb3b53350e1746c4302450c%22}%2C%22PoiInfoPanelModule%22%3A{%2*/,o="../../../../../../../map.baidu.com/index.htm#panoid=0100220000130728103037820J3&panotype=street&heading=359&pitch=8&l=18&tn=B_NORMAL_MAP&sc=0&newmap=1&shareurl=1&pid=0100220000130728103037820J3&psp=%7B%22PanoModule%22%3A%7B%22markerUid%22%3A%22af2a37c998544528e6e965e7%22%7D%2C%22PoiInfoPanelModule%22%3A%7B%22uid%22%3A%22af2a37c998544528e6e965e7%22%7D%7D"/*tpa=http://map.baidu.com/#panoid=0100220000130728103037820J3&panotype=street&heading=359&pitch=8&l=18&tn=B_NORMAL_MAP&sc=0&newmap=1&shareurl=1&pid=0100220000130728103037820J3&psp=%7B%22PanoModule%22%3A%7B%22markerUid%22%3A%22af2a37c998544528e6e965e7%22%7D%2C%22PoiInfoPanelModule%22%3A%7B%22uid%22%3A%22af2a37c998544528e6e965e7%22%7D%7D*/,r=location.href;r===e&&(r=o),r===a&&(r=o);var t=util.getParam(r);t=util.extendHashParam(location.href,t),t&&t.panoid&&t.panotype&&MapRevert.revertStreetView(t),isPhotoTourSupported&&t&&t.tourIId&&t.tourId&&MapRevert.revertPhotoTour(t.tourIId,t.tourId)}}),document.fmwd.word.focus())}};module.exports=MapRevert});