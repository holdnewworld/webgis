define("common:widget/ui/place/cinemaFilter.js",function(a,e,i){place=window.place||{},place.cinema=place.cinema||{};T.extend(place.cinema,{filterHtml:function(a,e){this.city=e.current_city.code,this.wd=e.result.wd,this.sub_type=e.place_info.d_sub_type,this.guid=a,addStat(7e3,{area:"cinema_filter",action:"show"});var i,c=[],t=!1,l=!1,n=window._OLR?baidu.json.parse(window._OLR.index)||{}:{};return n.special&&n.special.data&&n.special.data.movie&&n.special.data.movie.length&&(i=n.special.data.movie[0],c.push(i.href?('<div id="cinema-cms-ad" class="cinema-cms-ad"><a href="#url" target="_blank" onclick="addStat(\'indexleftmenu.pcads.moviebanner\', \'click\', {da_trd:\''+i.title+'\'});"><img src="#img" title="#text" alt="#text"/></a></div>').replace("#url",i.href).replace("#img",i.pic_url).replace("#text",i.title):'<div id="cinema-cms-ad" class="cinema-cms-ad"><img src="#img" title="#text" alt="#text"/></div>'.replace("#img",i.pic_url).replace("#text",i.title)),addStat("indexleftmenu.pcads.moviebanner","show")),(e.place_info.d_business_id&&"movie"==e.place_info.d_business_type||e.place_param&&e.place_param[0].d_business_id)&&(l=!0,e.place_info.d_business_id&&"movie"==e.place_info.d_business_type&&!e.place_info.d_business_id.match(/^[0-9]+$/)&&(l=!1),c=[],n.special&&n.special.data&&n.special.data.movie_jiansuo&&n.special.data.movie_jiansuo.length&&(i=n.special.data.movie_jiansuo[0],c.push(i.href?'<div id="cinema-cms-ad" class="cinema-cms-ad"><a href="#url" target="_blank" onclick="addStat(\'indexleftmenu.pcads.filmbanner\', \'click\', {da_trd:\''+i.title+'\'});"><img src="#img" title="#text" alt="#text"/></a></div>'.replace("#url",i.href).replace("#img",i.pic_url).replace("#text",i.title):'<div id="cinema-cms-ad" class="cinema-cms-ad"><img src="#img" title="#text" alt="#text"/></div>'.replace("#img",i.pic_url).replace("#text",i.title)),addStat("indexleftmenu.pcads.filmbanner","show")),place.cinema.film&&place.cinema.film.movie_id==e.place_info.d_business_id?(c.push('<div id="cinema-film" class="cinema-film cinema-film-show">'),c.push(place.cinema.buildFilm(place.cinema.film)),c.push("</div>")):l&&(c.push('<div id="cinema-film" class="cinema-film"></div>'),baidu.ajax("/detail?qt=movie&act=film&movie_id="+e.place_info.d_business_id,{dataType:"json",success:function(a){try{var e=T.g("cinema-film");if(!a||"Success"!=a.errorMsg)return;if(place.cinema.film=a,!T.browser.ie)return e.innerHTML=place.cinema.buildFilm(a),void(e.className="cinema-film cinema-film-show");window.setTimeout(function(){e=T.g("cinema-film"),e.innerHTML=place.cinema.buildFilm(a),e.className="cinema-film cinema-film-show"},1)}catch(i){}},error:function(){}}))),e.place_info.d_activity_gwj_section&&e.place_info.d_activity_gwj_section.match("1")&&(t=!0),c.push('<div id="cinema-filter" class="place-filter-cb cinema-filter">'),c.push('<div class="cinema-filter-district"><a class="booking"><i class="checkbox"></i>在线选座</a>'),c.push('<dl class="area"><dt>位置:&nbsp;</dt><dd><a class="allarea-btn" href="javascript:;">不限</a></dd><dd><a class="adminarea-btn" href="javascript:;">行政区<i class="arrow"></i></a></dd><dd><a class="commarea-btn" href="javascript:;">商圈<i class="arrow"></i></a></dd></dl></div>'),c.push('<div class="cinema-filter-opt"><a class="reset-btn" href="javascript:;">清除条件</a><span class="total">共'+e.result.total+'条结果</span><span class="sort">综合<i>|</i><a class="rate-btn" href="javascript:;" title="按好评从高到低">好评</a></span></div>'),c.push('<div class="cinema-filter-menu"><div class="cinema-filter-menu-container"><a class="close-btn" href="javascript:;">X</a><ul class="area-list"></ul><ul class="circle-list"></ul></div></div>'),c.push("</div>"),c.join("")},placeRequest:function(a){"movie"==a.pl_business_type&&(a.wd=this.wd),Instance(this.guid).searchByFilter(a),"movie"==a.pl_business_type&&delete a.wd},showMenu:function(a){var e=T.dom("#cinema-filter"),i=e.find(".area-list")[0],c=e.find(".circle-list")[0],t=e.find(".adminarea-btn")[0].parentNode,l=e.find(".commarea-btn")[0].parentNode;return a?(t.className="",l.className="",i.removeAttribute("style"),c.removeAttribute("style"),"area"==a?(t.className="selected",i.style.display="block"):(a="circle")&&(l.className="selected",c.style.display="block"),void(e.find(".cinema-filter-menu")[0].className="cinema-filter-menu active")):(place.cinema.urlParam.wd=this.wd.replace(" "+(place.cinema.area.admin||place.cinema.area.comm),""),place.cinema.placeRequest(place.cinema.urlParam),place.cinema.area.admin="",void(place.cinema.area.comm=""))},closeMenu:function(){var a=T.dom("#cinema-filter"),e=a.find(".adminarea-btn")[0].parentNode,i=a.find(".commarea-btn")[0].parentNode;e.className="",i.className="",a.find(".cinema-filter-menu")[0].className="cinema-filter-menu"},filterArea:function(a,e,i){var c,t=T.dom("#cinema-filter"),l=t.find(".allarea-btn")[0];"admin"==a?(place.cinema.area.admin=e,place.cinema.area.comm="",t.find(".adminarea-btn").html(e+'<i class="arrow"></i>')):(place.cinema.area.comm=e,place.cinema.area.admin="",t.find(".commarea-btn").html(e+'<i class="arrow"></i>')),l.className="allarea-btn active"http://webmap2.map.bdstatic.com/newmap/static/common/widget/ui/place/,i&&place.cinema.film?(c=new BMap.Point(i.split(",")[0],i.split(",")[1]),map.centerAndZoom(c,16)):(place.cinema.urlParam.wd=this.wd.match(/电影院|影院|剧场|影城|剧院/g)[0]+" "+e,place.cinema.placeRequest(place.cinema.urlParam)),place.cinema.closeMenu()},filterBooking:function(){var a=T.dom("#cinema-filter"),e=a.find(".booking")[0];"1-1"==place.cinema.urlParam.pl_movie_book_section?(delete place.cinema.urlParam.pl_movie_book_section,delete place.cinema.urlParam.pl_sort_type,e.className="booking"):(place.cinema.urlParam.pl_movie_book_section="1,1",place.cinema.urlParam.pl_sort_type="movie_book",e.className="booking active"),place.cinema.placeRequest(place.cinema.urlParam)},buildFilm:function(a){var e,i=(T("#cinema-film"),[]);if(a&&"Success"==a.errorMsg)return e=Math.round(1*a.movie_score/2*12.2),e=isNaN(e)?0:e,a.movie_starring=a.movie_starring.replace(/\//g," "),a.movie_starring.length>28&&(a.movie_starring=a.movie_starring.substr(0,24)+"..."),a.movie_name.length>18&&(a.movie_name=a.movie_name.substr(0,15)+"..."),i.push("<dl>"),i.push('<dt class="poster"><img width="122" height="170" src="'+a.movie_picture+'" alt="'+a.movie_name+'" title="'+a.movie_name+'"/></dt>'),i.push('<dd class="summary">'),i.push('<span class="name" title="'+a.movie_name+'">'+a.movie_name+'</span></br><span class="rate"><b style="width:'+e+'px"></b></span>&nbsp;'+a.movie_score+"</br></br>"),i.push('<p class="basic"><span class="field">类型:&nbsp;</span>'+(a.movie_type||"暂无")+'&nbsp;&nbsp;<span class="field">时长:&nbsp;</span>'+(a.movie_length?a.movie_length.replace("分钟","")+"分钟":"暂无")+"</p>"),i.push('<p class="director"><span class="field">导演:&nbsp;</span>'+a.movie_director||"暂无</p>"),i.push('<p class="star"><span class="field">主演:&nbsp;</span>'+a.movie_starring||"暂无</p>"),i.push("</dd></dl>"),i.join("")},buildArea:function(){function a(a){for(var e=T.dom(i).find(".area-list")[0],c=T.dom(i).find(".circle-list")[0],t=[],l=[],n=0,s=a[0]?a[0].content:[];n<s.length;n++)s[n].name&&t.push('<li><a  geo="'+s[n].geo+'" class="area-item" href="javascript:;">'+s[n].name+"</a></li>");e.innerHTML=t.join("");for(var n=0,m=a[1]?a[1].content:[];n<m.length;n++)m[n].name&&l.push('<li><a  geo="'+m[n].geo+'" class="circle-item" href="javascript:;">'+m[n].name+"</a></li>");c.innerHTML=l.join(""),t.length||T.dom(i).find(".adminarea-btn").hide(),l.length||T.dom(i).find(".commarea-btn").hide()}var e=this,i=T.g("cinema-filter"http://webmap2.map.bdstatic.com/newmap/static/common/widget/ui/place/);place.cinema.area&&place.cinema.area.city==e.city?a(place.cinema.area.content):baidu.ajax("/?qt=scity&c="+this.city,{dataType:"json",success:function(i){try{if(!i||!i.content)return;place.cinema.area={content:i.content,city:e.city},a(i.content)}catch(c){}},error:function(){}})},resetFilter:function(){delete place.cinema.urlParam.pl_movie_book_section,delete place.cinema.urlParam.pl_sort_type,place.cinema.urlParam.wd=this.wd.match(/电影院|影院|剧场|影城|剧院/g)?this.wd.match(/电影院|影院|剧场|影城|剧院/g)[0]:this.wd,place.cinema.placeRequest(place.cinema.urlParam)},initialize:function(){try{var a=this,e=T.g("cinema-filter");if(place.cinema.urlParam=T.extend({wd:a.wd,pl_data_type:"life"},place.urlParam),!e)return;"movie"==place.cinema.urlParam.pl_business_type&&place.cinema.urlParam.pl_business_id&&T.dom(e).addClass("cinema-filter-film"),"1-1"==place.cinema.urlParam.pl_movie_book_section&&(T.dom(e).find(".booking")[0].className="booking active"),!this.wd.match(/^(电影院|影院|剧场|影城|剧院)$/g)&&place.cinema.area&&(place.cinema.area.admin||place.cinema.area.comm)&&(T.dom(e).find(".allarea-btn")[0].className="allarea-btn active",place.cinema.area.admin?(T.dom(e).find(".adminarea-btn").html(place.cinema.area.admin+'<i class="arrow"></i>'),T.dom(e).find(".commarea-btn").html('商圈<i class="arrow"></i>')):(T.dom(e).find(".adminarea-btn").html('行政区<i class="arrow"></i>'),T.dom(e).find(".commarea-btn").html(place.cinema.area.comm+'<i class="arrow"></i>'))),place.cinema.area&&place.cinema.area.city!=this.city&&(T.dom(e).find(".allarea-btn")[0].className="allarea-btn",T.dom(e).find(".commarea-btn").html('商圈<i class="arrow"></i>'),T.dom(e).find(".adminarea-btn").html('行政区<i class="arrow"></i>')),place.cinema.buildArea(),T.on(e,"click",function(a){a.target.tagName;if("reset-btn"==a.target.className)place.cinema.resetFilter();else if("rate-btn"==a.target.className)place.cinema.urlParam.pl_sort_type="overall_rating",place.cinema.placeRequest(place.cinema.urlParam);else if("close-btn"==a.target.className)place.cinema.closeMenu();else if("adminarea-btn"==a.target.className||T(a.target).parent().hasClass("adminarea-btn")){if(T("#cinema-film").length)return;place.cinema.showMenu("area")}else if("commarea-btn"==a.target.className||T(a.target).parent().hasClass("commarea-btn")){if(T("#cinema-film").length)return;place.cinema.showMenu("circle")}else a.target.className.match("allarea-btn")?place.cinema.showMenu():"area-item"==a.target.className||"circle-item"==a.target.className?place.cinema.filterArea("area-item"==a.target.className?"admin":"circle",a.target.innerHTML,a.target.getAttribute("geo")):(a.target.className.match(/booking/g)||"checkbox"==a.target.className)&&place.cinema.filterBooking()})}catch(i){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/ui/place/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/ui/place/cinemaFilter.js",ln:387})}}}),i.exports=place.cinema});