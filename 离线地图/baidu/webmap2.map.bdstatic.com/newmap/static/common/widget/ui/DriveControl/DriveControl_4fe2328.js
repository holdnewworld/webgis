define("common:widget/ui/DriveControl/DriveControl.js",function(t,e,i){function n(t){this.send=t,this.codes={},this.data={},this.enabled=!0}var s=t("common:widget/ui/config/config.js"),o=s.modelConfig,l=(s.mapConfig,t("common:widget/ui/DriveHelper/DriveUtil.js")),a=l.driveHelper;n.prototype.disable=function(){this.enabled=!1},n.prototype.set=function(t,e){this.enabled&&("function"==typeof e?e.call(this,t):this.data[t]=e)},n.prototype.everytime=function(t,e){if(this.enabled){var i=e;"function"==typeof e?e.call(this,t):("undefined"==typeof this.codes[t]?this.codes[t]=1:this.codes[t]+=1,this.send(t,i))}},n.prototype.conditional=n.prototype.everytime,n.prototype.firsttime=function(t,e){this.enabled&&"undefined"==typeof this.codes[t]&&n.prototype.everytime.call(this,t,e)};var r=window,h=r.DriveControl=BMap.DriveControl=function(t){function e(){BMap.Control.call(this),this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new BMap.Size(0,0)}function i(t,e){function i(t,e,i,n){if(t===e)return n?t:null;for(;t&&1===t.nodeType&&t!==e&&t.tagName.toLowerCase()!==i;)t=t.parentNode;return t}var n=e.toggleButton,o=e.menuEl,a=e.selectAllEl,h=e.content;T.on(n,"click",function(){e[e._brief?(RC(h,I),"showAllItem"):"showSelectedItem"]()}),T.on(o,"click",function(t){if(e._brief)return RC(h,I),e.showAllItem(),void addStat(STAT_NAV_COURSE_BIG);for(var i=T.event.getTarget(t),n="";i&&1===i.nodeType&&i!=o&&"li"!==i.tagName.toLowerCase();)i=i.parentNode;n=l(i.id),e[e.isChecked(n)?"unSelectItem":"selectItem"](n),addStat(STAT_NAV_COURSE_CHECK)}),T.on(a,"click",function(t){for(var i=T.event.getTarget(t);i&&1===i.nodeType&&i!=a;)i=i.parentNode;var n=HC(i,S);n?RC(i,S):AC(i,S),e[n?"unSelectAll":"selectAll"]()}),T.on(h,"mouseover",function(){e._brief&&AC(h,I)}),T.on(h,"mouseout",function(t){var i=t.relatedTarget||t.toElement;T.dom.contains(h,i)||e._brief&&RC(h,I)}),6===T.ie&&(T.on(n,"mouseover",function(t){var e=T.event.getTarget(t),s=i(e,n,"div",!0);s&&AC(s,I)}),T.on(n,"mouseout",function(t){var e=T.event.getTarget(t),s=i(e,n,"div",!0);s&&RC(s,I)}),T.on(a,"mouseover",function(t){var e=T.event.getTarget(t),n=i(e,a,"div",!0);n&&AC(n,I)}),T.on(a,"mouseout",function(t){var e=T.event.getTarget(t),n=i(e,a,"div",!0);n&&RC(n,I)}),T.on(o,"mouseover",function(t){var e=T.event.getTarget(t),n=i(e,o,"li");n&&AC(n,I)}),T.on(o,"mouseout",function(t){var e=T.event.getTarget(t),n=i(e,o,"li");n&&RC(n,I)})),d(m,function(t){var e=s(t.n,"li"),i=s(t.n,"cb"),n=s(t.n,"num"),o=s(t.n,"txt");f[e]=r.G(e),f[n]=r.G(n);var l=r.G(i);f[i]=l;var a=r.G(o);f[o]=a})}function s(t,e){return c("{0}_{1}_{2}",[t,e,p])}function l(t){return t.split("_")[0]}function a(){var t=['<div id="drvSelectAllId" class="drv-ctrl-selectall" style="display:block;"><span id="drvAllCb" class="drv-item-checked"></span><a href="javascript:void(0)">全部选择</a></div>'],e=t.concat(['<ul id="drv_menu" class="drv-ctrl-menu" style="width:100%;">']);return d(m,function(t){var i='<li id={id} style="">{number}{checkbox}{icon}{text}{roadcolor}</li>',n={id:s(t.n,"li"),roadcolor:"roadtype"===t.n?['<div class="drv-ctrl-roadcolor"><span style="background-color:#FC5E20">其他</span>','<span style="background-color:#018607">高速</span>','<span style="background-color:#004EFF">国道</span></div>'].join(""):""};n.text=c('<a id="{0}" href="javascript:void(0)" style="{2}">{1}</a>',[s(t.n,"txt"),t.t,t.s||""]),n.icon='<span class="icon"></span>',n.checkbox=c('<span id="{0}" class="drv-item-checked"></span>',[s(t.n,"cb")]),n.number="roadtype"!==t.n?c('<span id="{0}" style="float:right" class="number">0个</span>',[s(t.n,"num")]):"",e.push(c(i,n))}),e.concat(["</ul>",'<div id="drv_toggle" class="drv-toggle"><img src="../../../images/transparent.gif"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ class="drv-dropup"></div>']).join("")}var r=T,h=!1,c=t.fmt,d=t.aeach,u=(t.oeach,t.afind),p="DriveCtrl",f=function(t,e){return f[s(t,e)]},v=1,m=[{d:1,n:"road",t:"主要路段"},{d:1,n:"ferry",t:"渡口"},{d:1,n:"entry",t:"道路出入口"},{d:1,n:"poi",t:"途经地标"},{d:1,n:"toll",t:"收费站"},{d:0,n:"park",t:"终点停车场"},{d:0,n:"light",t:"红绿灯"},{d:0,n:"sapa",t:"服务区"},{d:0,n:"gas",t:"加油站"},{d:0,n:"cam",t:"摄像头"},{d:0,n:"roadtype",t:"道路类型"}],g={},C="drv-btn-expand",y="drv-btn-collapse",E="drv-dropdown",b="drv-dropup",_="drv-item-selected",A="drv-item-disabled",S="drv-ctrl-selectall-selected",I="drv-ctrl-lihover";HC=T.dom.hasClass,AC=T.ac,RC=T.rc,MENU_MIN_HEIGHT=50,e.prototype=new BMap.Control,e.ID=p,e.DEBUG=h,e.RELEASE=!h;var M=e.Stat=new n(window.addStat),N=e.Const={MENU_CLOSE_IMMEDIATELY:701,OPERATED:"operated!",MENU_CLOSE:702,CLOSE_ARROW:703,MORE_1ST:704,HIDE_1ST:705,MENU_OPEN_MANNUALLY:706,CHECK_NONDEFAULT_ITEM_1ST:707,MARKER_CLICK:708,INFOW_NEXT:709,INFOW_PREV:710,INFOW_ZOOMIN:711,INFOW_ZOOMOUT:712,INFOW_CLOSE:713},w={collapsed:!1,ANIMATE:!1};return w.initialize=function(t){try{return this._map=t,this._brief=!1,this.createCtrlDom(),t.getContainer().appendChild(this.main),this.toggleButton=T.g("drv_toggle"),this.menuEl=T.g("drv_menu"),this.selectAllEl=T.g("drvSelectAllId"),this.initEvents(),i(this.main,this),this.main}catch(e){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/ui/DriveControl/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/ui/DriveControl/DriveControl.js",ln:209})}},w.onMapResize=function(){window.driveCtrl&&window.driveCtrl.updateScrollbar()},w.onMapTypeChange=function(){this.setPostion()},w.initScrollBar=function(){!this.scrollPanel&&this.isAddScrollBar()&&(this.menuEl.style.height=this.getMenuUseableHeight()+"px",this.scrollPanel=new baidu.ui.ScrollPanel({container:this.menuEl,autoUpdate:!1,overflow:"overflow-y"}),this.scrollPanel.render(this.menuEl))},w.getMenuUseableHeight=function(){var t=this.menuEl.style.height;this.menuEl.style.height="auto";var e=map.height,i=e-this.getOffset().height;return menuHeight=this.menuEl.offsetHeight,menuUseableHeight=i-(this.getDom().offsetHeight-this.menuEl.offsetHeight),this.menuEl.style.height=t,menuHeight>menuUseableHeight?MENU_MIN_HEIGHT>menuUseableHeight?MENU_MIN_HEIGHT:menuUseableHeight:menuHeight},w.isAddScrollBar=function(){var t=this.menuEl.style.height;this.menuEl.style.height="auto";var e=map.height,i=e-this.getOffset().height;return menuHeight=this.menuEl.offsetHeight,menuUseableHeight=i-(this.getDom().offsetHeight-this.menuEl.offsetHeight),this.menuEl.style.height=t,menuHeight>menuUseableHeight},w.updateScrollbar=function(){this.initScrollBar(),!this.scrollPanel||this.collapsed||this._brief||(this.menuEl.style.height=this.getMenuUseableHeight()+"px",this.scrollPanel.update())},w.autoAdjCtrlWidth=function(){this.getDom().style.width=this.collapsed?"94px":this._brief?"125px":"161px"},w.createCtrlDom=function(){return this.main=T.dom.create("div",{tid:"drvCtrlPanel",style:"border:1px solid #999;background-color:#fff;left:300px;top:10px;position:absolute;z-index:21;width:161px;",className:"drv-ctrl-main"}),this.title=T.dom.create("div",{className:"drv-ctrl-title",style:"padding-left:7px;"}),this.title.innerHTML="途经路段",this.content=T.dom.create("div",{className:"drv-ctrl-content"}),this.content.innerHTML=a(),this.drvButton=T.dom.create("button",{id:"drvButtonId",className:"drv-btn-class"}),AC(this.drvButton,this.collapsed?y:C),this.main.appendChild(this.title),this.main.appendChild(this.content),this.main.appendChild(this.drvButton),this.main},w.initEvents=function(){var t=this;T.on(t.drvButton,"click",function(){t[t.collapsed?"expand":"collapse"](t.ANIMATE),t.collapsed&&addStat(STAT_NAV_COURSE_CLOSE)})},w.collapse=function(){this.collapsed=!0,this.content.style.display="none",AC(this.drvButton,y),RC(this.drvButton,C),this.oldStatus=this.getCheckboxStatus(),this.unSelectAll(),this.autoAdjCtrlWidth()},w.expand=function(){if(window.trafficCtrl&&trafficCtrl.close(),window.searchInViewCtrl&&searchInViewCtrl.exit(),this.collapsed=!1,this.content.style.display="block",AC(this.drvButton,C),RC(this.drvButton,y),this.oldStatus&&this.oldStatus.count>0){var t=this.oldStatus.status;for(var e in t)t[e]&&this.selectItem(e);this.oldStatus=null}this.autoAdjCtrlWidth(),this.updateScrollbar()},w.hide=function(t){BMap.Control.prototype.hide.call(this),map.removeEventListener("resize",this.onMapResize),map.removeEventListener("maptypechange",this.onMapTypeChange),t||M.everytime(N.MENU_CLOSE)},w.show=function(){BMap.Control.prototype.show.call(this),this.onMapTypeChange(),map.addEventListener("resize",this.onMapResize),map.addEventListener("maptypechange",this.onMapTypeChange),addStat(STAT_NAV_COURSE_DEF),this.setPostion()},w.setPostion=function(){var t=window.maptypeCtrl,e=t.getOffset(),i=e.height,n=e.width+72;if(t.isVisible()&&t.getHeight){var s=t.getHeight();i+=s+5}var o=new BMap.Size(n,i);this.setOffset(o)},w.menu=function(t,e,i){var n=(this._menu,this);RC(this.selectAllEl,S),t?((i||0===this.getCheckboxStatus().count)&&(v=this.isDisabled("road")?4:2,d(m,function(t,e){var i=t.n;v>e?n.selectItem(i):n.unSelectItem(i)}),this.oldStatus=null,n.showSelectedItem(),0===this.getCheckboxStatus().count&&n.showAllItem()),e||M.everytime(N.MENU_OPEN_MANNUALLY)):(M.conditional(N.MENU_CLOSE_IMMEDIATELY,function(t){"undefined"==typeof this.data[N.OPERATED]&&this.send(t)}),n.collapsed||n.collapse()),o.ShowRoadTypeRoute&&n.check("ferry",!0)},w.items=function(){var t=this,e=0;d(m,function(i){var n=f(i.n,"li"),s=f(i.n,"cb"),o=t.isChecked(i.n);o&&(e+=1),t._brief?(s.style.display="none",o?n.style.display="block":(n.style.display="none",n.style.display="block",n.style.display="none")):(n.style.display="block",s.style.display="block")})},w.isMenuExpanded=function(){return this._brief},w.isPushed=function(){return!this.collapsed},w.getMenuItemInfo=function(t){for(var e=0;e<m.length;++e){var i=m[e];if(i.n===t)return i}},w.setNum=function(t,e){f(t,"num").innerHTML=e+"个",g[t]=e;f(t,"li");this.disable(t,0===e)},w.isChecked=function(t){return HC(f(t,"li"),_)},w.check=function(t,e){var i=f(t,"li");e?AC(i,_):RC(i,_)},w.isDisabled=function(t){return HC(f(t,"li"),A)},w.disable=function(t,e){var i=f(t,"li");e?(RC(i,_),AC(i,A)):RC(i,A)},w.getCheckboxStatus=function(){var t=this,e={},i=0;return d(m,function(n){var s=t.isChecked(n.n);e[n.n]=s,s&&(i+=1)}),{count:i,status:e}},w.getItemsDisplay=function(){var t={},e=0;return d(m,function(i,n){if(n!==m.length-1){var s=f(i.n,"li").style.display;t[i.n]=s,"none"!=s&&(e+=1)}}),{count:e,status:t}},w.showSelectedItem=function(){if(this._brief=!0,this.autoAdjCtrlWidth(),this.destroyScrollBar(),0===this.getCheckboxStatus().count)return this._brief=!1,void this.collapse();this.collapsed&&this.expand(),this.selectAllEl.style.display="none";var t=this.toggleButton.firstChild;this.items(),M.firsttime(N.MORE_1ST),RC(t,b),AC(t,E)},w.showAllItem=function(){this._brief=!1,this.autoAdjCtrlWidth(),this.collapsed&&this.expand(),this.selectAllEl.style.display="block";var t=this.toggleButton.firstChild;this.items(),this.updateScrollbar(),M.firsttime(N.HIDE_1ST),RC(t,E),AC(t,b)},w.unSelectItem=function(t){!this.isDisabled(t)&&this.isChecked(t)&&(this.check(t,!1),this.onChecked&&this.onChecked(this,t,!1),M.set(N.OPERATED,!0))},w.selectItem=function(t){this.isDisabled(t)||this.isChecked(t)||(this.check(t,!0),this.onChecked&&this.onChecked(this,t,!0),M.set(N.OPERATED,!0),M.firsttime(t,function(){var e=u(m,function(e){return e.n===t});e.d<=0&&(this.codes[t]=!0,this.send(N.CHECK_NONDEFAULT_ITEM_1ST,{type:e.n}))}))},w.selectAll=function(){var t=this.getCheckboxStatus().status;for(var e in t)this.selectItem(e)},w.unSelectAll=function(){var t=this.getCheckboxStatus().status;for(var e in t)this.unSelectItem(e)},w.destroyScrollBar=function(){this.scrollPanel&&(this.scrollPanel.dispose(),this.menuEl.style.height="auto",this.menuEl.style.width="100%",this.toggleButton.parentNode.appendChild(this.toggleButton),this.scrollPanel=null)},r.extend(e.prototype,w),e}(a);i.exports=h});