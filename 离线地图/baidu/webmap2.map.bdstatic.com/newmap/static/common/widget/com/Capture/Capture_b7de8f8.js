define("common:widget/com/Capture/Capture.js",function(t,e,i){function s(t){if(!t)return"";var e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return e.test(t)?t.replace(e,function(t){var e=i[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):t}function a(){this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new BMap.Size(10,10),this._opts={strokeWeight:1,strokeColor:"black",strokeStyle:"solid",opacity:.05,fillColor:"#2319dc"},this.inUse=!1,this.ctrlNeed2Hide=[maptypeCtrl,overviewCtrl,stdMapCtrl,copyCtrl,scaleCtrl],this.handlerCursors=["n-resize","e-resize","s-resize","w-resize","nw-resize","ne-resize","se-resize","sw-resize"],this._temp={},this._handlers=[],this._bindFuncs=[],this.capSizePx=[0,0],this.busStopMkrs=[],this.normMkrs=[],this.roundMkrs=[],this.destLbls=[],this.lbls=[],this.lines=[],this.areas=[]}var o=t("common:widget/ui/config/config.js"),p=t("common:widget/ui/constant/Constant.js"),n=t("common:widget/ui/Traffic/Traffic.js"),r=t("common:widget/ui/util/util.js"),l=t("common:widget/ui/mapUtil/mapUtil.js"),h=t("common:widget/ui/sateCityList/SateCityList.js"),_=o.mapConfig,d=o.modelConfig;a.prototype=new BMap.Control,a.prototype.loadRes=function(){var e=".cap_handler{position:absolute;height:7px;width:7px;background:#000;font-size:0}#cap_size{background:#202020;font-size:14px;position:absolute;color:#fff;padding:3px}#cap_btn_container{height:32px;width:177px;overflow:hidden;position:relative;z-index:500}.cap_btn_conbg{width:177px;height:65px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/capwrap_ed5bc59.png) no-repeat 0 0;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale', src='image/capwrap.png'/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/widget/com/Capture/image/capwrap.png*/);_background:0 0}.cap_btn_conbg div{position:absolute}#cap_btn_container span{position:absolute;cursor:pointer;height:23px;top:3px}#cap_btn_cancel{width:52px;left:3px}#cap_btn_show{width:58px;left:57px}#cap_btn_save{width:55px;left:117px}#cap_btn_container span.hover{background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/capwrap_ed5bc59.png);background-repeat:no-repeat}#cap_btn_cancel.hover{background-position:-3px -37px}#cap_btn_show.hover{background-position:-57px -37px}#cap_btn_save.hover{background-position:-117px -37px}";return t.loadCss({content:e,name:"Capture"}),!0},a.prototype.initialize=function(t){try{this._map=t;var e=this;this.loadRes(),T.on(document,"keydown",function(t){t=t||window.event,27==t.keyCode&&e.endCapture()})}catch(i){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/com/Capture/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/com/Capture/Capture.js",ln:107})}},a.prototype.beginCapture=function(){this._hideCtrls(),window.driveCtrl&&driveCtrl.isVisible()&&(driveCtrl.hide(!0),this.__driveCtrlFlag=!0),n.exit(),captureCtrl._inUse=!0,BMap.OperationMask.show(map),BMap.OperationMask.setCursor("url(http://webmap2.map.bdstatic.com/newmap/static/common/images/crosshair.cur), crosshair"),this.tipsLabel=tl=new BMap.Label("按住鼠标左键拖选截图区域<br />点击右键或按ESC键退出"),map.addOverlay(tl),tl.setStyles({padding:"2px",borderColor:"#555",color:"#555",background:"#ffffe1"}),tl.setZIndex(9e6),tl.hide();var e=this,i=function(t){return t&&2==t.button&&e.endCapture(),r.preventDefault(t)};T.on(BMap.OperationMask.getDom(map),"mouseup",i),this._bindFuncs.push({element:BMap.OperationMask.getDom(map),type:"mouseup",handler:i});var s=function(t){t=t||window.event;var e=t.target||t.srcElement;if(e!==BMap.OperationMask.getDom(map))return void tl.hide();tl.show();var i=BMap.OperationMask.getDrawPoint(t,!1,{x:8,y:8});tl.setPoint(i)};T.on(document,"mousemove",s),this._bindFuncs.push({element:document,type:"mousemove",handler:s});var a=function(t){if(t=window.event||t,!(0!=t.button&&!T.browser.ie||T.browser.ie&&1!=t.button)){BMap.OperationMask.getDom(map).setCapture&&BMap.OperationMask.getDom(map).setCapture(),e.tipsLabel&&e.tipsLabel.remove(),T.G("cap_size")&&T.G("cap_size").parentNode.removeChild(T.G("cap_size"));var i=T.G("cap_btn_container");i&&i.parentNode.removeChild(i),e._fDiv&&(e._fDiv.parentNode.removeChild(e._fDiv),e._fDiv=null),T.on(document,"mousemove",o),T.on(document,"mouseup",p),e._bindFuncs.push({element:document,type:"mousemove",handler:o}),e._bindFuncs.push({element:document,type:"mouseup",handler:p});var t=window.event||t;return e._temp.mx=t.layerX||t.offsetX||0,e._temp.my=t.layerY||t.offsetY||0,e._temp.mx=e._temp.mx,e._temp.my=e._temp.my,e._temp.ix=t.pageX||t.clientX||0,e._temp.iy=t.pageY||t.clientY||0,BMap.OperationMask.getDom(map).insertAdjacentHTML("beforeBegin",e._generateHTML()),e._fDiv=BMap.OperationMask.getDom(e._map).previousSibling,e._fDiv.style.width="0",e._fDiv.style.height="0",e._fDiv.style.left=e._temp.mx+"px",e._fDiv.style.top=e._temp.my+"px",e._handlers.length=0,e._handlers.push(T.G("cap_h_t")),e._handlers.push(T.G("cap_h_r")),e._handlers.push(T.G("cap_h_b")),e._handlers.push(T.G("cap_h_l")),e._handlers.push(T.G("cap_h_tl")),e._handlers.push(T.G("cap_h_tr")),e._handlers.push(T.G("cap_h_br")),e._handlers.push(T.G("cap_h_bl")),r.stopBubble(t),r.preventDefault(t)}},o=function(t){t=window.event||t;var i=t.pageX||t.clientX||0,s=t.pageY||t.clientY||0,a=i-e._temp.ix,o=s-e._temp.iy;return e._fDiv?(e._fDiv.style.width=Math.abs(a)+"px",e._fDiv.style.height=Math.abs(o)+"px",a>=0?(e._fDiv.style.right="auto",e._fDiv.style.left=e._temp.mx+"px",e._temp.mx+a>map.width-9&&(e._fDiv.style.width=map.width-e._temp.mx-9+"px")):(e._fDiv.style.left="auto",e._fDiv.style.right=map.width-e._temp.mx-1+"px",e._temp.mx+a<5&&(e._fDiv.style.width=e._temp.mx-5+"px")),o>=0?(e._fDiv.style.bottom="auto",e._fDiv.style.top=e._temp.my+"px",e._temp.my+o>map.height-5&&(e._fDiv.style.height=map.height-e._temp.my-5+"px")):(e._fDiv.style.top="auto",e._fDiv.style.bottom=map.height-e._temp.my-1+"px",e._temp.my+o<9&&(e._fDiv.style.height=e._temp.my-9+"px")),e._updateCapSize(),e._updateHandlersPosition(),r.stopBubble(t),r.preventDefault(t)):void 0},p=function(i){if(i=window.event||i,!(0!=i.button&&!T.browser.ie||T.browser.ie&&1!=i.button)&&(T.un(document,"mousemove",o),T.un(document,"mouseup",p),T.un(BMap.OperationMask.getDom(map),"mousedown",a),BMap.OperationMask.getDom(map).releaseCapture&&BMap.OperationMask.getDom(map).releaseCapture(),e._fDiv)){e._fDiv&&0==parseInt(e._fDiv.style.width)&&(e._fDiv.style.width="1px"),e._fDiv&&0==parseInt(e._fDiv.style.height)&&(e._fDiv.style.height="1px"),e._updateCapSize(),e.capSizePx=[parseInt(e._fDiv.style.width),parseInt(e._fDiv.style.height)],e._unifyPos();var s=function(t){t=t||window.event,t.target&&void 0!==T(t.target).attr("_ht")||2!=t.button&&(T.browser.ie&&1!=t.button||(e._fDiv.setCapture&&e._fDiv.setCapture(),T.on(document,"mousemove",n),T.on(document,"mouseup",l),s._initX=parseInt(e._fDiv.style.left),s._initY=parseInt(e._fDiv.style.top),isNaN(s._initX)&&(s._initX=map.width-parseInt(e._fDiv.style.right)-parseInt(e._fDiv.style.width)),isNaN(s._initY)&&(s._initY=map.height-parseInt(e._fDiv.style.bottom)-parseInt(e._fDiv.style.height)),s._x1=t.pageX||t.clientX||0,s._y1=t.pageY||t.clientY||0,t.returnValue=!1))},n=function(t){t=t||window.event;var i=t.pageX||t.clientX||0,a=t.pageY||t.clientY||0,o=i-s._x1,p=a-s._y1;if(e._fDiv){e._fDiv.style.left=s._initX+o>=4&&s._initX+o+parseInt(e._fDiv.style.width)+9<=map.width?s._initX+o+"px":s._initX+o<4?"3px":map.width-parseInt(e._fDiv.style.width)-9+"px",e._fDiv.style.top=s._initY+p>=9&&s._initY+p+parseInt(e._fDiv.style.height)+4<=map.height?s._initY+p+"px":s._initY+p<9?"7px":map.height-parseInt(e._fDiv.style.height)-5+"px";var n=T.G("cap_size");n.style.left=parseInt(e._fDiv.style.left)+2+"px",n.style.top=parseInt(e._fDiv.style.top)-23+"px",parseInt(n.style.top)<0&&(n.style.top=parseInt(e._fDiv.style.top)+2+"px");var r=T.G("cap_btn_container");r.style.left=parseInt(e._fDiv.style.left)+e.capSizePx[0]-173+"px",r.style.top=parseInt(e._fDiv.style.top)+e.capSizePx[1]+7+"px",map.height-parseInt(r.style.top)<30&&(r.style.top=parseInt(r.style.top)-39+"px",r.style.left=parseInt(r.style.left)-4+"px")}},l=function(){T.un(document,"mousemove",n),T.un(document,"mouseup",l),e._fDiv.releaseCapture&&e._fDiv.releaseCapture()};T.on(e._fDiv,"mousedown",s),t.async("common:widget/ui/contextMenu/ContextMenu.js",function(t){e.cm=t.create([{text:"&nbsp;取消",callback:function(){e.endCapture()},width:60},{text:"&nbsp;完成",callback:function(){e.showCapture()},width:60},{text:"&nbsp;另存为",callback:function(){e.saveCapture()},width:60}],e._fDiv,"move")}),T.on(e._fDiv,"contextmenu",function(t){t.cancelBubble=!0});for(var h=function(t){if(t=t||window.event,2!=t.button&&(!T.browser.ie||1==t.button)){var i=t.target||t.srcElement;h._t=t.srcElement,i.setCapture&&i.setCapture();var s=i.getAttribute("_ht");"undefined"!=typeof s&&(e._curHT=s,T.on(document,"mousemove",_),T.on(document,"mouseup",d),e._bindFuncs.push({element:document,type:"mousemove",handler:_}),e._bindFuncs.push({element:document,type:"mouseup",handler:d}),BMap.OperationMask.show(map),BMap.OperationMask.setCursor(e.handlerCursors[s]),h._initX=t.pageX||t.clientX,h._initY=t.pageY||t.clientY,t.cancelBubble=!0,t.returnValue=!1)}},_=function(t){t=t||window.event;var i=t.pageX||t.clientX,s=t.pageY||t.clientY,a=i-h._initX,o=s-h._initY,p=parseInt(e._fDiv.style.left),n=parseInt(e._fDiv.style.right),r=parseInt(e._fDiv.style.top),l=parseInt(e._fDiv.style.bottom),_=1*e._curHT;switch(_){case 0:e._moveFromTop(o,r,l);break;case 1:e._moveFromRight(a,p,n);break;case 2:e._moveFromBottom(o,r,l);break;case 3:e._moveFromLeft(a,p,n);break;case 4:e._moveFromTop(o,r,l),e._moveFromLeft(a,p,n);break;case 5:e._moveFromTop(o,r,l),e._moveFromRight(a,p,n);break;case 6:e._moveFromBottom(o,r,l),e._moveFromRight(a,p,n);break;case 7:e._moveFromBottom(o,r,l),e._moveFromLeft(a,p,n)}e._updateCapSize(),e._updateHandlersPosition();var d=T.G("cap_btn_container");d&&(d.style.display="none")},d=function(){h._t&&h._t.releaseCapture&&h._t.releaseCapture(),T.un(document,"mousemove",_),T.un(document,"mouseup",d),BMap.OperationMask.hide(),0==parseInt(e._fDiv.style.width)&&(e._fDiv.style.width="1px"),0==parseInt(e._fDiv.style.height)&&(e._fDiv.style.height="1px"),e._updateCapSize(),e.capSizePx=[parseInt(e._fDiv.style.width),parseInt(e._fDiv.style.height)],e._temp._fromLeftToRight&&delete e._temp._fromLeftToRight,e._temp._fromBottomToTop&&delete e._temp._fromBottomToTop,e._unifyPos();var t=T.G("cap_btn_container");t&&(t.style.display="block",t.style.left=parseInt(e._fDiv.style.left)+e.capSizePx[0]-173+"px",t.style.top=parseInt(e._fDiv.style.top)+e.capSizePx[1]+7+"px",map.height-parseInt(t.style.top)<30&&(t.style.top=parseInt(t.style.top)-39+"px",t.style.left=parseInt(t.style.left)-4+"px"))},c=0,m=e._handlers.length;m>c;c++)T.on(e._handlers[c],"mousedown",h);BMap.OperationMask.hide();var u=parseInt(e._fDiv.style.top)+parseInt(e._fDiv.style.height)+7,f=parseInt(e._fDiv.style.left)+parseInt(e._fDiv.style.width)-173;isNaN(u)&&(u=map.height-parseInt(e._fDiv.style.bottom)+5),isNaN(f)&&(f=map.width-parseInt(e._fDiv.style.right)-90),map.height-u<30&&(u-=39,f-=4);var v="<div id='cap_btn_container' style='top:"+u+"px;left:"+f+"px'><div class='cap_btn_conbg'><div><span id='cap_btn_cancel' ></span><span id='cap_btn_show' ></span><span id='cap_btn_save'></span></div></div></div>";return BMap.OperationMask.getDom(map).insertAdjacentHTML("beforeBegin",v),T.on(T.G("cap_btn_save"),"mouseover",function(){T.ac(T.G("cap_btn_save"),"hover")}),T.on(T.G("cap_btn_cancel"),"mouseover",function(){T.ac(T.G("cap_btn_cancel"),"hover")}),T.on(T.G("cap_btn_show"),"mouseover",function(){T.ac(T.G("cap_btn_show"),"hover")}),T.on(T.G("cap_btn_save"),"mouseout",function(){T.rc(T.G("cap_btn_save"),"hover")}),T.on(T.G("cap_btn_cancel"),"mouseout",function(){T.rc(T.G("cap_btn_cancel"),"hover")}),T.on(T.G("cap_btn_show"),"mouseout",function(){T.rc(T.G("cap_btn_show"),"hover")}),T.on(T.G("cap_btn_save"),"click",function(){e.saveCapture()}),T.on(T.G("cap_btn_cancel"),"click",function(){e.endCapture()}),T.on(T.G("cap_btn_show"),"click",function(){e.showCapture()}),r.stopBubble(i),r.preventDefault(i)}};T.on(BMap.OperationMask.getDom(map),"mousedown",a),e._bindFuncs.push({element:BMap.OperationMask.getDom(map),type:"mousedown",handler:a})},a.prototype._hideCtrls=function(){for(var t=0,e=this.ctrlNeed2Hide.length;e>t;t++)this.ctrlNeed2Hide[t]&&this.ctrlNeed2Hide[t].hide&&this.ctrlNeed2Hide[t].hide();map.closeInfoWindow(),window.searchInViewCtrl&&window.searchInViewCtrl.hidePopup()},a.prototype._showCtrls=function(){for(var t=0,e=this.ctrlNeed2Hide.length;e>t;t++)this.ctrlNeed2Hide[t]&&this.ctrlNeed2Hide[t].show&&this.ctrlNeed2Hide[t].show(),_["3d_city"][d.cityCode]&&map.getZoom()>=12||(map.currentCity="",map.cityCode="",h.isSateMapSupportCity(d.cityCode)?maptypeCtrl.hide3DControl():maptypeCtrl.hide());window.searchInViewCtrl&&window.searchInViewCtrl.showPopup()},a.prototype.endCapture=function(){for(var e=0,i=this._bindFuncs.length;i>e;e++){var s=this._bindFuncs[e];try{T.un(s.element,s.type,s.handler)}catch(a){continue}}this._bindFuncs.length=0,this._showCtrls(),this.__driveCtrlFlag&&window.driveCtrl&&(this.__driveCtrlFlag=null,driveCtrl.show()),this.tipsLabel&&(this.tipsLabel.remove(),this.tipsLabel=null),BMap.OperationMask.getDom(map).releaseCapture&&BMap.OperationMask.getDom(map).releaseCapture(),BMap.OperationMask.hide(),this._fDiv&&this._fDiv.parentNode&&(this._fDiv.parentNode.removeChild(this._fDiv),this._fDiv=null);var o=T.G("cap_size");o&&o.parentNode&&(o.parentNode.removeChild(o),o=null);var p=T.G("cap_btn_container");p&&(p.parentNode.removeChild(p),p=null),T.rc(T.g("capwrap"),"span_focus"),captureCtrl._inUse=!1;var n=this;n.cm&&t.async("common:widget/ui/contextMenu/ContextMenu.js",function(t){t.destroy(n.cm)})},a.prototype._generateHTML=function(){var t=[];return t.push("<div id='cap_size' style='display:none;z-index:250'>0 x 0</div>"),t.push("<div style='position:absolute;z-index:300;border:"),t.push(this._opts.strokeWeight+"px "+this._opts.strokeStyle+" "+this._opts.strokeColor+";"),t.push("width:0; height:0; font-size:0'>"),t.push("<div class='cap_handler' id='cap_h_tl' _ht='4' style='cursor:nw-resize;top:-4px;left:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_tr' _ht='5' style='cursor:ne-resize;top:-4px;right:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_bl' _ht='7' style='cursor:ne-resize;bottom:-4px;left:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_br' _ht='6' style='cursor:nw-resize;bottom:-4px;right:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_t' _ht='0' style='cursor:n-resize;top:-4px;left:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_l' _ht='3' style='cursor:w-resize;top:-4px;left:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_r' _ht='1' style='cursor:e-resize;top:-4px;right:-4px'></div>"),t.push("<div class='cap_handler' id='cap_h_b' _ht='2' style='cursor:s-resize;bottom:-4px;left:-4px'></div>"),t.push("<div style='height:100%;width:100%;opacity:"+this._opts.opacity+";"),t.push("filter:alpha(opacity="+Math.round(100*this._opts.opacity)+"); background:"+this._opts.fillColor+";cursor:move'></div>"),t.push("</div>"),t.join("")},a.prototype._updateHandlersPosition=function(){var t=parseInt(this._fDiv.style.width),e=parseInt(this._fDiv.style.height),i=Math.abs(t/2)-4+"px",s=Math.abs(e/2)-4+"px",a=t-3+"px",o=e-3+"px";this._handlers[0].style.left=i,this._handlers[1].style.left=a,this._handlers[1].style.top=s,this._handlers[2].style.left=i,this._handlers[2].style.top=o,this._handlers[3].style.top=s,this._handlers[5].style.left=a,this._handlers[6].style.left=a,this._handlers[6].style.top=o,this._handlers[7].style.top=o},a.prototype._updateCapSize=function(){var t=T.G("cap_size");t.style.display="block";var e=this;t.style.left="auto"http://webmap2.map.bdstatic.com/newmap/static/common/widget/com/Capture/!=e._fDiv.style.left?parseInt(e._fDiv.style.left)+2+"px":map.width-parseInt(e._fDiv.style.right)-parseInt(e._fDiv.style.width)+"px","auto"http://webmap2.map.bdstatic.com/newmap/static/common/widget/com/Capture/!=e._fDiv.style.top?(t.style.top=parseInt(e._fDiv.style.top)-23+"px",parseInt(t.style.top)<0&&(t.style.top=parseInt(e._fDiv.style.top)+2+"px")):(t.style.top=map.height-parseInt(e._fDiv.style.bottom)-parseInt(e._fDiv.style.height)-25+"px",parseInt(t.style.top)<0&&(t.style.top=map.height-parseInt(e._fDiv.style.bottom)-parseInt(e._fDiv.style.height)+"px")),t.innerHTML=parseInt(e._fDiv.style.width)+" x "+parseInt(e._fDiv.style.height)},a.prototype._unifyPos=function(){var t=this;t._fDiv&&("auto"==t._fDiv.style.left&&"auto"!=t._fDiv.style.right&&(t._fDiv.style.left=map.width-parseInt(t._fDiv.style.right)-t.capSizePx[0]-2+"px",t._fDiv.style.right="auto"),"auto"==t._fDiv.style.top&&"auto"!=t._fDiv.style.bottom&&(t._fDiv.style.top=map.height-parseInt(t._fDiv.style.bottom)-t.capSizePx[1]-2+"px",t._fDiv.style.bottom="auto"))},a.prototype._moveFromLeft=function(t,e,i){var s=this,a=s.capSizePx[0]-t;0>a?(s._temp._fromLeftToRight=!0,isNaN(e)&&(e=map.width-i-1),-a+e+8<=map.width?(s._fDiv.style.left=isNaN(e)?map.width-i-map.capSizePx[0]-2+"px":e+"px",s._fDiv.style.right="auto",s._fDiv.style.width=-a+"px"):s._fDiv.style.width=map.width-e-8+"px"):(isNaN(i)&&(i=s._temp._fromLeftToRight?map.width-e-1:map.width-e-s.capSizePx[0]-2),map.width-i-a>=6?(s._fDiv.style.left="auto",isNaN(e)||(s._fDiv.style.right=s._temp._fromLeftToRight?map.width-e-1+"px":map.width-e-s.capSizePx[0]-2+"px"),s._fDiv.style.width=a+"px"):s._fDiv.style.width=map.width-i-4+"px")},a.prototype._moveFromRight=function(t,e,i){var s=this,a=s.capSizePx[0]+t;a>=0?(isNaN(e)&&(e=map.width-i-1),a+e+12<=map.width?(s._fDiv.style.left=isNaN(e)?map.width-i-1+"px":e+"px",s._fDiv.style.right="auto",s._fDiv.style.width=a+"px"):s._fDiv.style.width=map.width-e-9+"px"):(isNaN(i)&&(i=map.width-e-1),map.width-i+a>=9?(s._fDiv.style.left="auto",isNaN(e)||(s._fDiv.style.right=map.width-e-1+"px"),s._fDiv.style.width=-a+"px"):s._fDiv.style.width=map.width-i-5+"px")},a.prototype._moveFromTop=function(t,e,i){var s=this,a=s.capSizePx[1]-t;0>a?(s._temp._fromBottomToTop=!0,isNaN(e)&&(e=map.height-i-1),-a+e+11<=map.height?(s._fDiv.style.top=isNaN(e)?map.height-i-map.capSizePx[1]-2+"px":e+"px",s._fDiv.style.bottom="auto",s._fDiv.style.height=-a+"px"):s._fDiv.style.height=map.height-e-5+"px"):(isNaN(i)&&(i=s._temp._fromLeftToRight?map.height-e-1:map.height-e-s.capSizePx[1]-2),map.height-i-a>=9?(s._fDiv.style.top="auto",isNaN(e)||(s._fDiv.style.bottom=s._temp._fromBottomToTop?map.height-e-1+"px":map.height-e-s.capSizePx[1]-2+"px"),s._fDiv.style.height=a+"px"):s._fDiv.style.height=map.height-i-9+"px")},a.prototype._moveFromBottom=function(t,e,i){var s=this,a=s.capSizePx[1]+t;a>=0?(isNaN(e)&&(e=map.height-i-1),a+e+11<=map.height?(s._fDiv.style.top=isNaN(e)?map.height-i-1+"px":e+"px",s._fDiv.style.bottom="auto",s._fDiv.style.height=a+"px"):s._fDiv.style.height=map.height-e-5+"px"):(isNaN(i)&&(i=map.height-e-1),map.height-i+a>=9?(s._fDiv.style.top="auto",isNaN(e)||(s._fDiv.style.bottom=map.height-e-1+"px"),s._fDiv.style.height=-a+"px"):s._fDiv.style.height=map.height-i-9+"px")},a.prototype.saveCapture=function(){var t=this._getReqData(1),e=null;if(document.getElementById("capSaveF")){e=document.getElementById("capSaveF");var i=e.getElementsByTagName("input")[2];i&&(i.value=t)}else{e=document.createElement("form"),e.id="capSaveF",e.name="capSaveF",e.method="post",e.action="http://snap.map.baidu.com/?newmap=1",e.target="_blank";var s=document.createElement("input");s.type="hidden",s.name="qt",s.value="save";var a=document.createElement("input");a.type="hidden",a.name="ie",a.value="utf8";var o=document.createElement("input");o.type="hidden",o.name="data",o.value=t,e.appendChild(s),e.appendChild(a),e.appendChild(o),document.body.appendChild(e)}e.submit(),this.endCapture()},a.prototype.showCapture=function(){var t=window.open("about:blank"),e=this._getReqData(0);baidu.ajax("/?newmap=1",{method:"post",data:"qt=prev&ie=utf8&data="+encodeURIComponent(e),dataType:"json",success:function(e){if(!e||!e.content||!e.result||1==e.result.error)return t.close(),void captureCtrl.showErrorMsg();var i=e.content.image_url;t.location.href=i,t.focus()},error:function(){t.close(),captureCtrl.showErrorMsg()}}),this.endCapture()},a.prototype._getReqData=function(t,e){e=e||{};var i=map.width,s=map.height,a=i/2,o=s/2;(!e||e&&!e.fullsize)&&(i=this.capSizePx[0],s=this.capSizePx[1],a=parseInt(this._fDiv.style.left)+.5*i,o=parseInt(this._fDiv.style.top)+.5*s);var p=map.pixelToPoint(new BMap.Pixel(a,o)),n=map.zoomLevel,r=map.getOverlays();this._getAllMarkers(r),this._getAllLabels(r),this._getAllDrawings(r);var h=[];if(this.areas.length>0&&h.push(this.areas.join(",")),this.lines.length>0&&h.push(this.lines.join(",")),this.normMkrs.length>0){this.normMkrs.sort(function(t,e){return t.zIndex-e.zIndex});for(var _="",d=0,c=this.normMkrs.length;c>d;d++)_=_+","+this.normMkrs[d].data;h.push(_.substring(1))}if(this.destLbls.length>0){this.destLbls.sort(function(t,e){return t.zIndex-e.zIndex});for(var _="",d=0,c=this.destLbls.length;c>d;d++)_=_+","+this.destLbls[d].data;h.push(_.substring(1))}this.lbls.length>0&&h.push(this.lbls.join(","));var m=h.length>0?',"coord":['+h.join(",")+"]":"",u=window.GRControll?window.GRControll.getDataForSnap():null,f="";u&&(f=',"c":'+u.c+',"wd":"'+u.wd+'","wd_h":"'+u.wd2+'","qt":"'+u.qt+'"');var v='{"retype":'+t+',"src":"snap", "logo":"df:logo", "level":'+n+',"center":"'+p.lng+" "+p.lat+'","height":'+s+',"width":'+i+',"coordtype":"M","pictype":"'+l._getPicType()+'"'+m+f;return map.mapType===BMAP_SATELLITE_MAP&&(v+=',"suffix" : "jpg"'),v+="}"},a.prototype._getAllMarkers=function(t){this.normMkrs.length=0;for(var e=0,i=t.length;i>e;e++){var o=t[e];if("Marker"==o.toString()&&o.isVisible()&&o._stCode){var n=o.zIndex||o.getDom()&&o.getDom().style.zIndex;if(o._stCode==p.OVERLAY_STYLE.DRV_M_MKR&&o.siblingElement&&"hidden"==o.siblingElement.style.visibility)continue;if(this.normMkrs.push({data:'{"type":1,"geo":"'+o.getPoint().lng+" "+o.getPoint().lat+'","scode":"df:'+o._stCode+'"}',zIndex:n}),o.getLabel()&&o.getLabel().isVisible()&&o.getLabel()._stCode){lbl=o.getLabel();var r=a._getPointWithPixelOffset(lbl,new BMap.Size(3,4));this.normMkrs.push({data:'{"type":4,"geo":"'+r.lng+" "+r.lat+'","scode":"df:'+lbl._stCode+'","text":"'+s(lbl.content)+'"}',zIndex:n})}}}},a.prototype._getAllLabels=function(t){this.destLbls.length=0,this.lbls.length=0;for(var e=0,i=t.length;i>e;e++)if("Label"==t[e].toString()&&t[e].isVisible()){var o=t[e];if(o._stCode)if(o._stCode==p.OVERLAY_STYLE.DS_LBL||o._stCode==p.OVERLAY_STYLE.DE_LBL)this.destLbls.push({data:'{"type":1,"geo":"'+o.getPoint().lng+" "+o.getPoint().lat+'","scode":"df:'+o._stCode+'","text":"'+s(o.content)+'"}',zIndex:o.zIndex});else{var n=a._getPointWithPixelOffset(o,new BMap.Size(3,5));this.lbls.push('{"type":4,"geo":"'+n.lng+" "+n.lat+'","scode":"df:'+o._stCode+'","text":"'+s(o.content)+'"}')}}},a.prototype._getAllDrawings=function(t){this.lines.length=0,this.areas.length=0;for(var e=function(t){for(var e=[],i=0,s=t.length;s>i;i++)e.push(t[i].lng+" "+t[i].lat);return e.join(",")},i=0,s=t.length;s>i;i++){var a=t[i];if(a._stCode&&a.isVisible()){if("Polyline"==a.toString()&&this.lines.push('{"type":2,"geo":"'+e(a.getPoints())+'","scode":"df:'+a._stCode+'"}'),"PolylineMultipart"==a.toString())for(var o=a.getPoints(),p=0,n=o.length;n>p;p++)this.lines.push('{"type":2,"geo":"'+e(o[p])+'","scode":"df:'+a._stCode+'"}');"Polygon"==a.toString()&&this.areas.push('{"type":3,"geo":"'+e(a.getPoints())+'","scode":"df:'+a._stCode+'"}')}}},a.prototype.showErrorMsg=function(){alert("抱歉，截图失败。请检查您的网络连接，并稍后再试。")},a._getPointWithPixelOffset=function(t,e){var i=e.width,s=e.height;if(t){var a=map.pointToPixel(t.getPoint());return t._config&&t._config.offset?(a.x+=t._config.offset.width+i,a.y+=t._config.offset.height+s):(a.x=a.x+i,a.y=a.y+s),map.pixelToPoint(a)}},window.captureCtrl=new a,i.exports=window.captureCtrl});