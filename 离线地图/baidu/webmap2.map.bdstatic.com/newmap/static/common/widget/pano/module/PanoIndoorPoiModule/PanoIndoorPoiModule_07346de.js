define("common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",function(require,exports,module){var Animation=require("common:widget/ui/Animation/Animation.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),ScrollView=require("common:widget/pano/component/ScrollView/ScrollView.js"),DELAY_FOLD_TIME=200,travelPoiTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_popup">    <div class="travel_base_content">        '),data.lvyou.scope_grade&&_template_fun_array.push('            <p class="travel_grade">                ',"undefined"==typeof data.lvyou.scope_grade?"":data.lvyou.scope_grade,"景区            </p>        "),_template_fun_array.push("                "),data.lvyou.entrance_price&&data.lvyou.shop_hours&&(_template_fun_array.push('            <div class="travel_info_list clearfix">                '),data.lvyou.scope_type&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_type"></i></dt>                        <dd><span>景区类别：</span>',"undefined"==typeof data.lvyou.scope_type?"":data.lvyou.scope_type,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.entrance_price&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_entrance_price"></i></dt>                        <dd><span>门票价格：</span>',"undefined"==typeof data.lvyou.entrance_price?"":data.lvyou.entrance_price,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.shop_hours&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_shop_hours"></i></dt>                        <dd><span>开放时间：</span>',"undefined"==typeof data.lvyou.shop_hours?"":data.lvyou.shop_hours,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.base.address&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_addr"></i></dt>                        <dd><span>地址：</span>',"undefined"==typeof data.base.address?"":data.base.address,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.base.phone&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_phone"></i></dt>                        <dd><span>电话：</span>',"undefined"==typeof data.base.phone?"":data.base.phone,"</dd>                    </dl>                "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("    </div>    "),data.lvyou.entrance_price&&data.lvyou.shop_hours&&(data.lvyou.sug_time||data.lvyou.best_time)&&_template_fun_array.push('        <div class="travel_content_line"></div>    '),_template_fun_array.push("    "),(data.lvyou.sug_time||data.lvyou.best_time)&&(_template_fun_array.push('        <div class="travel_more_content">            <div class="travel_info_list clearfix">                '),data.lvyou.sug_time&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_sub_time"></i></dt>                        <dd><span>建议游玩时间：</span>',"undefined"==typeof data.lvyou.sug_time?"":data.lvyou.sug_time,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.best_time&&_template_fun_array.push('                    <dl class="clearfix">                        <dt><i class="pano_poi_icon travel_best_time"></i></dt>                        <dd><span>最佳旅游季节：</span>',"undefined"==typeof data.lvyou.best_time?"":data.lvyou.best_time,"</dd>                    </dl>                "),_template_fun_array.push("                "),data.lvyou.url&&_template_fun_array.push('                    <p class="travel_more"><a href="',"undefined"http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/==typeof data.lvyou.url?"":data.lvyou.url,'" title="前往百度旅游查看详细信息" target="_blank">更多&gt;&gt;</a></p>                '),_template_fun_array.push("            </div>        </div>    ")),_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],indoorPoiTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<div class="pano_popup"><div class="pano_poi_header clearfix"><p href="javascript:void(0);" class="title">',"undefined"http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/==typeof data.base.name?"":data.base.name,"</p>"),data.film&&_template_fun_array.push('<a href="',"undefined"==typeof data.film.url_all?"":data.film.url_all,'" class="detail_link gray" target="_blank">详情>></a>'),_template_fun_array.push(""),data.hotel&&_template_fun_array.push('<a href="',"undefined"==typeof data.hotel.url_all?"":data.hotel.url_all,'" class="detail_link gray" target="_blank">详情>></a>'),_template_fun_array.push('</div><div class="content_line"></div><ul class="pano_poi_content clearfix">'),data.base.address&&_template_fun_array.push('<li class="clearfix">                <span class="pano_poi_icon pano_poi_icon_addr"></span><span class="type_name">地址：</span><span class="type_cont">',"undefined"==typeof data.base.address?"":data.base.address,"</span></li>"),_template_fun_array.push(""),data.base.phone&&_template_fun_array.push('<li class="clearfix last">                <span class="pano_poi_icon pano_poi_icon_phone"></span><span class="type_name">电话：</span><span class="type_cont">',"undefined"==typeof data.base.phone?"":data.base.phone,"</span></li>"),_template_fun_array.push("</ul>    "),data.film&&data.film.book_list&&0!==data.film.book_list.length){_template_fun_array.push('<div class="content_line"></div><div class="pano_movie_info"><ul class="movie_book clearfix">');for(var i=0;i<data.film.book_list.length&&2>i;i++)_template_fun_array.push('<li class="clearfix">       <span class="span1" title="美国队长2">',"undefined"==typeof data.film.book_list[i].movie_name?"":data.film.book_list[i].movie_name,'</span><span class="span2 gray">',"undefined"==typeof data.film.book_list[i].movie_type?"":data.film.book_list[i].movie_type,'</span><span class="span3 blue">¥',"undefined"==typeof data.film.book_list[i].price?"":data.film.book_list[i].price,'起</span><span class="span3"><a href="',"undefined"==typeof data.film.book_list[i].book_url?"":data.film.book_list[i].book_url,'" class="movie_book_btn" target="_blank">在线订座</a></span></li>');_template_fun_array.push('</ul><div class="clearfix"><a href="',"undefined"==typeof data.film.url_all?"":data.film.url_all,'" class="book_link" target="_blank">更多电影>></a></div></div>')}if(_template_fun_array.push(""),data.hotel&&data.hotel.book_list&&0!==data.hotel.book_list.length){_template_fun_array.push('<div class="content_line"></div><div class="pano_hotel_info"><ul class="hotel_book clearfix">');for(var j=0;j<data.hotel.book_list.length&&2>j;j++)_template_fun_array.push('<li class="clearfix">        <span class="span1">',"undefined"http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/==typeof data.hotel.book_list[j].desc?"":data.hotel.book_list[j].desc,'</span><span class="span2 orange">¥',"undefined"==typeof data.hotel.book_list[j].price?"":data.hotel.book_list[j].price,'起</span><span class="span3"><a href="',"undefined"==typeof data.hotel.book_list[j].book_url?"":data.hotel.book_list[j].book_url,'" class="hotel_book_btn" target="_blank">预订&gt;&gt;</a></span>    </li>');_template_fun_array.push('</ul><div class="clearfix"><a class="book_link" href="',"undefined"==typeof data.hotel.url_all?"":data.hotel.url_all,'" target="_blank">更多房型和日期&gt;&gt;</a></div></div>')}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],panoIndoorPoiModuleTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="indoor_poi_detail_container">    <h3 class="indoor_poi_title">        <dl class="clearfix">            <dt><i class="indoor_poi_icon indoor_poi_name"></i></dt>            <dd>',"undefined"==typeof name?"":name,'</dd>        </dl>    </h3>    <div class="poi_container_wrapper">        <div class="poi_content_wrapper">            <div class="pop_scroller_wrapper">            </div>        </div>    </div>    </div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];require.loadCss({content:".indoor_poi_detail_container{color:#fff;font-size:12px;z-index:100101}.indoor_poi_title{height:40px;width:268px;font-size:12px;line-height:40px;font-weight:400;padding:0 16px;background-color:rgba(37,37,37,.9);background-color:#252525\\9;filter:alpha(opacity=90)\\9;_filter:alpha(opacity=100);border-radius:2px 2px 0 0;color:#abb0b2}.indoor_poi_title dt{float:left;*padding-top:10px}.indoor_poi_title dd{padding-left:5px;cursor:pointer}.indoor_poi_title dd:hover{color:#3af}.indoor_poi_icon{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_0dc7001.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_8_5876649.png);margin-top:-2px;width:14px;height:14px;display:inline-block;vertical-align:middle;margin-right:7px}.indoor_poi_name{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_efd2360.png);_background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_8_f96e26d.png);width:18px;height:18px;background-position:0 0}.poi_container_wrapper{width:300px;overflow:hidden;position:relative;border-top:1px solid #53565d}.poi_content_wrapper{position:absolute;top:-9999px;width:100%;padding:6px 0;overflow:hidden;background-color:rgba(37,37,37,.9);background-color:#252525\\9;filter:alpha(opacity=90)\\9;_filter:alpha(opacity=100);border-radius:0 0 2px 2px}.pop_scroller_wrapper{overflow:hidden}.travel_base_content{padding:8px 14px 0}.travel_more_content{padding:0 14px}.travel_content_line{width:300px;height:1px;margin-bottom:16px;font-size:0;line-height:0;background:#53565d;background:#53565d\\9}.travel_info_list dl{margin-bottom:16px}.travel_info_list dd{padding-left:5px;width:245px}.travel_info_list span{color:#FFF}.travel_info_list dt,.travel_info_list dd{display:inline-block;margin:0;float:left}.travel_grade{display:inline-block;width:74px;height:20px;margin-bottom:16px;text-align:center;color:#000;background:#ffde00;line-height:20px;font-size:12px}.travel_type{background-position:0 0}.travel_entrance_price{background-position:-14px 0}.travel_shop_hours{background-position:-28px 0}.travel_addr{background-position:-42px 0}.travel_phone{background-position:-56px -1px}.travel_sub_time{background-position:-70px 0}.travel_best_time{background-position:-70px 0}.travel_more{float:right}.travel_more a{color:gray;text-decoration:none}.poi_container_wrapper .scrollbar-y,.poi_container_wrapper .scrollbar-y-thumb-prev,.poi_container_wrapper .scrollbar-y-thumb-next,.poi_container_wrapper .scrollbar-y-prev,.poi_container_wrapper .scrollbar-y-next{background-image:none}.poi_container_wrapper .scrollbar-y-prev,.poi_container_wrapper .scrollbar-y-next{width:14px}.poi_container_wrapper .tangram-scrollbar-slider{margin:0 auto;border-radius:20px;background-color:#292c2f;opacity:.95;width:6px}.poi_container_wrapper .scrollbar-y-thumb-btn{margin:0 auto;width:4px;background:#B3B9C3;opacity:.3;border-radius:10px}"});var PanoIndoorPoiModule=ModuleClass.extend("PanoIndoorPoiModule",{_renderTravelPoiInfo:function(a){try{return travelPoiTemplate({data:a})}catch(e){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:20})}},_renderNormalPoiInfo:function(a){try{return indoorPoiTemplate({data:a})}catch(e){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:25})}},initialize:function(a,e,t,o){try{this._container=a,this._events=null,this._isMouseEntered=!1,this._hasPanoPlan=t,this._animateStateEnum={FOLDING:1,EXPANDING:2,STATIC:3},this._animateState=this._animateStateEnum.STATIC,this.render(e,t,o)}catch(n){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:42})}},render:function(a,e,t){try{var o=this,n=o._container;o._isMouseEntered=!1,o._hasPanoPlan=e,o._currentUid=t,o._data=a,o._animateState=this._animateStateEnum.STATIC;var i=panoIndoorPoiModuleTemplate({name:a.base.name}),r=T(i),l=r.find(".pop_scroller_wrapper"),_=null;_=a.lvyou?this._renderTravelPoiInfo(a):this._renderNormalPoiInfo(a),l.append(T(_)),n.innerHTML="",T(n).append(r),n.style.display="block",this._appendScroller(),setTimeout(function(){o._isMouseEntered||(o._expand(),setTimeout(function(){o._isMouseEntered||o._fold()},2e3))},500),this.bindEvents(),T.on(T(".travel_more")[0],"click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"travel-link-click"})}),addStat(STAT_CODE.STAT_PANORAMA,{catalog:"poi-detail",item:Pano.PANO_TYPE_INDOOR,from:a.base.type}),this.dispatch(t)}catch(s){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:102})}},event_poi_change:function(a,e){this.render(a.indoorPoi,this._hasPanoPlan,e)},dispatch:function(a){this.dispatchEvent("poi_change",{uid:a})},bindEvents:function(){{var a=this,e=T(".indoor_poi_title")[0],t=T(".poi_content_wrapper")[0];T(".indoor_poi_detail_container")[0]}a._events={},a._tagMouseIn="",a._events.titleMouseEnter=function(){a._isMouseEntered=!0,a._tagMouseIn="title",a._expand()},a._events.titleMouseLeave=function(){"title"==a._tagMouseIn&&(a._tagMouseIn=""),setTimeout(function(){"content"!=a._tagMouseIn&&"title"!=a._tagMouseIn&&a._fold()},DELAY_FOLD_TIME)},a._events.contMouseEnter=function(){a._isMouseEntered=!0,a._tagMouseIn="content"},a._events.contMouseLeave=function(){"content"==a._tagMouseIn&&(a._tagMouseIn=""),setTimeout(function(){"title"!=a._tagMouseIn&&"content"!=a._tagMouseIn&&a._fold()},DELAY_FOLD_TIME)},T.on(e,"mouseenter",a._events.titleMouseEnter),T.on(e,"mouseleave",a._events.titleMouseLeave),T.on(t,"mouseenter",a._events.contMouseEnter),T.on(t,"mouseleave",a._events.contMouseLeave),T(".indoor_poi_detail_container .movie_book_btn").on("click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookmovie-click",type:"inter"})}),T(".indoor_poi_detail_container .hotel_book_btn").on("click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookhotel-click",type:"inter"})})},getCurrentUid:function(){return this._currentUid},getCurrentUid:function(){return this._currentUid},getPoiData:function(){return this._data},_removeEvents:function(){if(this._events){var a=T(".travel_title")[0],e=T(".poi_content_wrapper")[0];T.un(a,"mouseenter",this._events.titleMouseEnter),T.un(a,"mouseleave",this._events.titleMouseLeave),T.un(e,"mouseenter",this._events.contMouseEnter),T.un(e,"mouseleave",this._events.contMouseLeave)}},dispose:function(){this._removeEvents(),this._container.innerHTML="",this._animation&&(this._animation.cancel(),this._animation=null)},show:function(){this._container.style.display="block"},hide:function(){this._container.style.display="none"},_expand:function(){var a=T(".poi_container_wrapper")[0],e=T(".poi_content_wrapper")[0],t=T(".indoor_poi_title")[0];if(a&&e&&this._animateState!=this._animateStateEnum.EXPANDING){this._animateState=this._animateStateEnum.EXPANDING;var o=e.offsetHeight;a.style.height=o+32+"px";var n=e.offsetTop;-o>n&&(n=-o),this._animation&&this._animation.cancel(),a.style.borderTop="1px solid #53565d",t.style.borderRadius="2px 2px 0 0",e.style.top=n+"px",this._slideAnimate(e,n,0)}},_fold:function(){var a=T(".poi_container_wrapper")[0],e=T(".poi_content_wrapper")[0],t=T(".indoor_poi_title")[0];if(a&&e&&this._animateState!=this._animateStateEnum.FOLDING){this._animateState=this._animateStateEnum.FOLDING;var o=e.offsetHeight,n=e.offsetTop;this._animation&&this._animation.cancel(),this._slideAnimate(e,n,-(o+32),function(){a.style.borderTop="0",t.style.borderRadius="2px"})}},_slideAnimate:function(a,e,t,o){var n=a.offsetTop,i=this,e=+e,t=+t;n!==t&&(this._animation||(this._animation=new Animation.Animation),this._animation.build({fps:60,transition:Animation.Transitions.easeInQuad,duration:350,render:function(o){try{a.style.top=e+o*(t-e)+"px"}catch(n){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoIndoorPoiModule/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/pano/module/PanoIndoorPoiModule/PanoIndoorPoiModule.js",ln:317})}},finish:function(){!!o&&o(),e>t&&T(".poi_container_wrapper")[0]&&(T(".poi_container_wrapper")[0].style.height=0),i._animateState=i._animateStateEnum.STATIC}}))},_appendScroller:function(){var a=T(".pop_scroller_wrapper")[0],e=a.offsetHeight,t=this._getMaxContentHeight();e>t?(a.style.height=t+"px",this.scrollPanel=new ScrollView(a,{overflow:"overflow-y",autoUpdate:!1}),this.scrollPanel.update()):a.style.height=e},_getMaxContentHeight:function(){var a=document.body.offsetHeight,e=70,t=this._hasPanoPlan?335:135,o=32,n=0;return a>768&&(a=768),n=a-e-t-o,n>0?n:0},getShareParam:function(){var a=this.getCurrentUid();return{uid:a}},getSupportEvents:function(){return["poi_change"]}});module.exports=PanoIndoorPoiModule});