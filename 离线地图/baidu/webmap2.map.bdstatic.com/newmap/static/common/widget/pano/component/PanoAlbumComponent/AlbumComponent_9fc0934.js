define("common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js",function(require,exports,module){var Animation=require("common:widget/ui/Animation/Animation.js"),util=require("common:widget/pano/base/util.js"),DO_NOTHING=function(){},IMG_ERROR_URL="../../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/img_error_8d3eb72.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/img_error_8d3eb72.png*/,ALBUM_ITEM_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('        <div class="panoAlbum-item-wraper">            '),src&&(_template_fun_array.push("                "),name?_template_fun_array.push('                    <img src="',"undefined"==typeof src?"":src,'" onerror="this.src=&#39;',"undefined"==typeof errorUrl?"":errorUrl,'&#39;" style="width:',"undefined"==typeof width?"":width,"px;height:","undefined"==typeof height?"":height,'px;" />                    <div class="photo-desc">                                                    <i class="icon ',"undefined"==typeof icon?"":icon,'"></i>                            <span title="',"undefined"==typeof name?"":name,'">',"undefined"==typeof name?"":name,"</span>                    </div>                "):_template_fun_array.push('                    <a id="ugc-upload-item" target="_blank" href="http://pai.baidu.com/"><img src="',"undefined"==typeof src?"":src,'" onerror="this.src=&#39;',"undefined"==typeof errorUrl?"":errorUrl,'&#39;" style="width:',"undefined"==typeof width?"":width,"px;height:","undefined"==typeof height?"":height,'px;" /></a>                '),_template_fun_array.push("            ")),_template_fun_array.push("        </div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],animation,createAlbumItem=function(e,t,i,o,n){var r=document.createElement("li");return r.style.width=e+"px",r.style.height=t+"px",r.className="panoAlbum-item",r.innerHTML=ALBUM_ITEM_TEMPLATE({src:i,icon:o,name:n,errorUrl:IMG_ERROR_URL,width:e,height:t}),r},fadeInOutEffect=function(e,t,i,o){var n=0,r=e.length,a=0,l=t.length,s=new Animation.Animation;return s.build({fps:40,transition:Animation.Transitions.easeOutQuad,duration:i,render:function(i){try{for(n=0;r>n;n++)util.setOpacity(e[n],i);for(a=0;l>a;a++)util.setOpacity(t[a],1-i)}catch(o){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/component/PanoAlbumComponent/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js",ln:44})}},finish:o||DO_NOTHING}),s},move=function(e,t,i,o,n){var r=i-t;0!=r&&(animation=new Animation.Animation,animation.build({fps:60,transition:Animation.Transitions.linear,duration:n||300,render:function(i){try{e.style.left=t+r*i+"px"}catch(o){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/component/PanoAlbumComponent/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/component/PanoAlbumComponent/AlbumComponent.js",ln:61})}},finish:function(){o&&o(e,i)}}))},checkArrowStatus=function(e,t,i,o,n){if(t>=0)return disableArrow(o),void disableArrow(n);this.scrollLeft;i>e?enableArrow(o):disableArrow(o),e>t?enableArrow(n):disableArrow(n)},disableArrow=function(e){baidu.dom.addClass(e,"arrow-disabled")},enableArrow=function(e){baidu.dom.removeClass(e,"arrow-disabled")};require.loadCss({content:'#panoGuideAlbum{height:108px;-moz-user-select:none;-webkit-user-select:none;position:relative}#panoGuideAlbum .left-arrow,#panoGuideAlbum .right-arrow{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/album_aae0aec.png) no-repeat}#panoGuideAlbum #l_arrow,#panoGuideAlbum #r_arrow{float:left;width:30px;height:108px;text-align:center}#panoGuideAlbum #l_arrow:hover,#panoGuideAlbum #r_arrow:hover{cursor:pointer}#panoGuideAlbum .l_arrow .left-arrow{display:inline-block;width:18px;height:18px;background-position:-95px -79px;margin-top:45px}#panoGuideAlbum .r_arrow .right-arrow{display:inline-block;width:18px;height:18px;background-position:-117px -79px;margin-top:45px}#panoGuideAlbum .l_arrow:hover{_zoom:1}#panoGuideAlbum .r_arrow:hover{_zoom:1}#panoGuideAlbum .l_arrow:hover .left-arrow{background-position:-77px -79px}#panoGuideAlbum .r_arrow:hover .right-arrow{background-position:-131px -79px}#panoGuideAlbum .arrow-disabled .left-arrow,#panoGuideAlbum .arrow-disabled:hover .left-arrow{background-position:-95px -99px}#panoGuideAlbum .arrow-disabled .right-arrow,#panoGuideAlbum .arrow-disabled:hover .right-arrow{background-position:-117px -99px}.panoAlbum-container{float:left;overflow:hidden;height:108px;position:relative}.panoAlbum-wraper{position:absolute}#panoGuideAlbum .panoAlbum-item{position:relative;float:left;border:1px #252525 solid;margin-right:5px;font-size:0;position:absolute}#panoGuideAlbum .panoAlbum-item-wraper{left:0;top:0;z-index:4;zoom:1}#panoGuideAlbum .panoAlbum-item img{cursor:pointer;border:0;width:100%;height:100%}#panoGuideAlbum .panoAlbum-item .photo-desc{position:absolute;bottom:0;left:0;width:198px;height:24px;padding-top:25px;font-size:12px;font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif;color:#abb0b2;z-index:3;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/album-title-bg_eeddd16.png) left bottom repeat-x;_background:0 0}#panoGuideAlbum .panoAlbum-item .photo-desc span{display:inline-block;text-indent:4px;vertical-align:middle;width:165px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#panoGuideAlbum .panoAlbum-item .selected-item{position:absolute;top:0;left:0;border:3px solid #3af;z-index:5}#panoGuideAlbum .panoAlbum-item-on{border:1px #3af solid}.panoAlbum-container{height:110px}#panoAlbum-scrollWraper{height:108px;overflow:hidden;position:relative}#panoGuideAlbum .icon{display:inline-block;width:18px;height:18px;vertical-align:middle;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/guide_icons2_56e908a.png) no-repeat;_background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/guide_icons2_8_ff4230f.png) no-repeat}#panoGuideAlbum .photo-desc .icon{margin-left:8px}#panoGuideAlbum .i-poi-1,#panoGuideAlbum .i-poi-2,#panoGuideAlbum .i-poi-4{background-position:-30px 3px}#panoGuideAlbum .i-poi-21{background-position:-39px 3px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-1,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-2,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-4{background-position:-30px -42px}#panoGuideAlbum .i-poi-3{background-position:2px 2px;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-3{background-position:1px -43px}#panoGuideAlbum .i-poi-6{background-position:-122px 1px;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-6{background-position:-122px -43px}#panoGuideAlbum .i-poi-5{background-position:-93px 0;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-5{background-position:-93px -44px}#panoGuideAlbum .i-poi-10,#panoGuideAlbum .i-poi-9,#panoGuideAlbum .i-poi-7{background-position:-64px 0;margin-left:8px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-10,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-9,#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-7{background-position:-66px -43px}#panoGuideAlbum .panoAlbum-item-wraper:hover .i-poi-21{background-position:-39px -43px}.panoAlbum-item-wraper:hover .photo-desc span{color:#d3d8db}'});var AlbumComponent=function(e,t,i,o){this.itemWidth=t,this.itemHeight=i,this.itemMargin=6,this.ignoreUserEvent=!1,this.options=util.merge({},o),this.parentElem=e;var n=this;this.velocity=300,this.scrollLeft=0,this.minScrollLeft=0,this.maxScrollLeft=0;var r=0;this.viewWidth=0,this.itemOuterWidth=0,this.scrollDistance=0,this.maxAnimationDistance=0,this.selectedIndex=void 0;var a=this.container=document.createElement("div"),l="width:"+r+"px; height:"+this.itemHeight+"px; z-index:"+o.zIndex;a.setAttribute("id","panoGuideAlbum"),a.setAttribute("style",l);var s=util.each(["l","r"],function(e){var t=document.createElement("a");return t.id=e+"_arrow",t.href="javascript:void(0)",t.className=e+"_arrow",t.title="",t.innerHTML='<span class="'+("l"==e?"left-arrow":"right-arrow")+'"></span>',t},!0);if(this.leftArrow=s[0],this.rightArrow=s[1],this.albumContainer=document.createElement("div"),this.albumContainer.className="panoAlbum-container",this.albumWraper=document.createElement("div"),this.albumWraper.className="panoAlbum-wraper",this.albumContainer.appendChild(this.albumWraper),a.appendChild(s[0]),a.appendChild(this.albumContainer),a.appendChild(s[1]),e.appendChild(a),n.bindDomEvent(),a.onselectstart=function(){return!1},n._currentIndex>=0){var p=1,u=albumData.content[n._currentIndex],d=n.getFloorInfo(n._currentPanoId);d.floor&&p!=d.floor&&(u.data.source="PanoFloor",u.data.floor=d.floor,u.data.floorsData=d.floorsData,setTimeout(function(){n.dispatchEvent("floor_changed",{data:u.data})},100),p=d.floor)}};baidu.lang.inherits(AlbumComponent,baidu.lang.Class,"AlbumComponent"),baidu.object.extend(AlbumComponent.prototype,{ignoreMouseEvent:function(e){this.ignoreUserEvent=!!e},bindDomEvent:function(){var e=this,t=baidu(this.albumWraper);t.delegate("li","click",function(){if(!e.ignoreUserEvent){var t=this.getAttribute("index");void 0!==t&&e.dispatchEvent("click",{index:t})}}),t.delegate("li","mouseenter",function(){if(!e.ignoreUserEvent){var t=this.getAttribute("index");T.dom.addClass(this,"panoAlbum-item-on"),void 0!==t&&e.dispatchEvent("mouseenter",{index:t})}}),t.delegate("li","mouseleave",function(){if(!e.ignoreUserEvent){var t=this.getAttribute("index");T.dom.removeClass(this,"panoAlbum-item-on"),void 0!==t&&e.dispatchEvent("mouseleave",{index:t})}}),baidu(this.leftArrow).on("click",function(){if(!e.ignoreUserEvent){e.stopScroll();var t=1e3*Math.abs(e.maxScrollLeft-e.minScrollLeft)/(30*e.velocity);e.scrollTo(e.scrollLeft+e.viewWidth,!1,!0,t,function(){e.scroll(-1)})}}),baidu(this.rightArrow).on("click",function(){if(!e.ignoreUserEvent){e.stopScroll();var t=1e3*Math.abs(e.maxScrollLeft-e.minScrollLeft)/(30*e.velocity);e.scrollTo(e.scrollLeft+-e.viewWidth,!1,!0,t,function(){e.scroll(1)})}}),baidu(this.leftArrow).on("mouseenter",function(t){e.ignoreUserEvent||(e.scroll(-1),baidu.event.preventDefault(t))}),baidu(this.leftArrow).on("mouseleave",function(){e.stopScroll()}),baidu(this.rightArrow).on("mouseenter",function(t){e.ignoreUserEvent||(e.scroll(1),baidu.event.preventDefault(t))}),baidu(this.rightArrow).on("mouseleave",function(){e.stopScroll()}),this._window_Resize_handler=function(){e._timer&&clearTimeout(e._timer),e._timer=setTimeout(function(){e.resize()},100)},T.on(window,"resize",this._window_Resize_handler)},getCurrentLiPosition:function(e){var t=e*this.itemOuterWidth+this.scrollLeft+this.itemWidth/2+30,i=document.body.clientHeight-this.container.offsetHeight-10;return{x:t,y:i}},resize:function(e){{var t=this.data||[],i=e||document.body.clientWidth-this.parentElem.offsetLeft;this.viewWidth+60}this.viewWidth=i-60,this.itemOuterWidth=this.itemWidth+this.itemMargin+2;var o=t.length*this.itemOuterWidth;this.minScrollLeft=this.viewWidth-t.length*this.itemOuterWidth,this.scrollDistance=Math.floor(this.viewWidth/this.itemOuterWidth)*this.itemOuterWidth,this.maxAnimationDistance=this.scrollDistance+30,this.container.style.width=i+"px",this.albumContainer.style.width=this.viewWidth+"px",this.albumWraper.style.width=o+"px",checkArrowStatus(this.scrollLeft||0,this.minScrollLeft,this.maxScrollLeft,this.leftArrow,this.rightArrow)},unselect:function(){this.selectedIndex=void 0,baidu.dom.remove("selected-border")},setSelectIndex:function(e){baidu.dom.remove("selected-border");var t=baidu(this.albumWraper).find("li"),i=t[e];if(i){this.selectedIndex=e;var o=baidu.dom.create("div",{id:"selected-border","class":"selected-item"});o.style.height=this.itemHeight-6+"px",o.style.width=this.itemWidth-6+"px",o.style.zoom=1,i.appendChild(o),this.fitImage(e)}},getSelectIndex:function(){return this.selectedIndex},fitImage:function(e){if(this.canScroll){var t=this,i=baidu(this.albumWraper).find("li"),o=i[e];if(o){var n=this.itemOuterWidth*e,r=n+this.itemOuterWidth,a=-this.scrollLeft;if(!(n>=a&&r<=a+this.viewWidth))if(a>n){var l=1e3*Math.abs(n+t.scrollLeft)/t.velocity;this.scrollTo(-n,!1,!1,l)}else if(r>a+this.viewWidth){var s=n-(this.viewWidth-this.itemOuterWidth),l=1e3*Math.abs(s+t.scrollLeft)/t.velocity;this.scrollTo(-s,!1,!1,l)}}}},update:function(e){var t=this,i=this.data;this.data=e;var o=e?e.length:0,n=o*this.itemOuterWidth;this.minScrollLeft=this.viewWidth-o*this.itemOuterWidth,this.scrollDistance=Math.floor(this.viewWidth/this.itemOuterWidth)*this.itemOuterWidth,this.canScroll=n<=this.viewWidth?!1:!0,checkArrowStatus(this.scrollLeft||0,this.minScrollLeft,this.maxScrollLeft,this.leftArrow,this.rightArrow),t._currentIndex=-1;var r=e,a=baidu.g(this.albumWraper);a.style.zIndex=1;var l=this.itemWidth,s=this.itemHeight,p=this.itemOuterWidth,u=[];if(this.fadeInOutEffectAnim&&this.fadeInOutEffectAnim.stop(!0),i){var d=a.getElementsByTagName("li");if(d=util.converToArray(d),util.each(r,function(e,t){var o=i[t];if(o)if(o.src==e.src&&o.name==e.name);else{var n=d[t],r=createAlbumItem(l,s,e.src,e.icon,e.name);r.setAttribute("index",t),r.style.left=p*t+"px",a.insertBefore(r,n),u.push(n),n.parentNode.removeChild(n)}else{var r=createAlbumItem(l,s,e.src,e.icon,e.name);r.setAttribute("index",t),r.style.left=p*t+"px",a.appendChild(r)}}),r.length<i.length)for(var o=i.length,m=r.length;o>m;)a.removeChild(d.pop()),o--;if(util.each(u,function(e){a.appendChild(e)}),u.length>0){var h=function(){for(var e;u.length>0;)e=u.pop(),e.parentNode.removeChild(e);t.fadeInOutEffectAnim=null};this.fadeInOutEffectAnim=fadeInOutEffect([],u,800,h)}}else util.each(r,function(e,t){var i=createAlbumItem(l,s,e.src,e.icon,e.name);i.setAttribute("index",t),i.style.left=p*t+"px",a.appendChild(i)});(this.scrollLeft>this.maxScrollLeft||this.scrollLeft<this.minScrollLeft)&&this.scrollTo(0,!0)},scrollTo:function(e,t,i,o,n){var r=baidu.g(this.albumWraper),a=this.scrollLeft;e=Math.min(this.maxScrollLeft,Math.max(this.minScrollLeft,e)),!i&&(t||Math.abs(a-e)>this.maxAnimationDistance)?r.style.left=e+"px":move(r,a,e,n,o),this.scrollLeft=e},scrollBy:function(e,t){var i=this.scrollLeft+e;this.scrollTo(i,t)},scroll:function(e){var t=this;if(e>0){var i=1e3*Math.abs(this.scrollLeft-this.minScrollLeft)/this.velocity;this.scrollTo(this.minScrollLeft,!1,!0,i,function(){checkArrowStatus(t.scrollLeft,t.minScrollLeft,t.maxScrollLeft,t.leftArrow,t.rightArrow)})}else{var i=1e3*Math.abs(this.scrollLeft)/this.velocity;this.scrollTo(this.maxScrollLeft,!1,!0,i,function(){checkArrowStatus(t.scrollLeft,t.minScrollLeft,t.maxScrollLeft,t.leftArrow,t.rightArrow)})}},stopScroll:function(){if(animation){animation.stop(),animation=null;var e=baidu.g(this.albumWraper);this.scrollLeft=parseInt(e.style.left.replace("px","")),checkArrowStatus(this.scrollLeft,this.minScrollLeft,this.maxScrollLeft,this.leftArrow,this.rightArrow)}},getFloorInfo:function(e){var t=this;if(t._opts.floorData)for(var i=t._opts.floorData.floors,o=0,n=i.length;n>o;o++)for(var r=i[o],a=r.Points,l=0,s=a.length;s>l;l++){var p=a[l];if(e==p.PID)return{floor:r.Floor+"",floorsData:r}}return{floor:null,floorsData:null}},dispose:function(){baidu.dom.remove("panoGuideAlbum"),baidu.un(window,"resize",this._window_Resize_handler)}}),module.exports=AlbumComponent});