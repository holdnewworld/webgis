define("common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",function(e,t,n){var a=e("common:widget/ui/Animation/Animation.js"),i=e("common:widget/pano/module/PanoGuideModule/AlbumModule/AlbumModule.js"),o=e("common:widget/pano/module/PanoGuideModule/TimelineModule/TimelineModule.js"),d=e("common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js"),l=e("common:widget/pano/module/PanoGuideModule/TopicModule/TopicModule.js"),s=e("common:widget/pano/base/ModuleClass.js"),u=e("common:widget/pano/base/service.js"),p=e("common:widget/pano/base/util.js"),c=300,r=null,h=null,m=null,g=s.extend("PanoGuideModule",{constructor:function(){this.container=null,this._data=null,this._display=!1,this._maxWidth=document.body.clientWidth,this._displayStatus={timeline:!1,album:!1,topic:!1}},initialize:function(e,t){try{var n=this,a=this.container=document.createElement("div");this.container.style.height="130px",e&&e.appendChild(a);var s=this.timeLineWapper=document.createElement("div");s.className="pano-func-item",s.style.zIndex="2",a.appendChild(s),h=new o,h.initialize(s),h.addEventListener("pano_changed",function(e){n.dispatchEvent("pano_changed",{data:e.data})});var c=this.topicWapper=document.createElement("div");c.className="pano-func-item",c.style.zIndex="2",a.appendChild(c),m=new l,m.initialize(c);var g=this.timeThroughWapper=document.createElement("div");g.className="pano-func-item",g.style.zIndex="2",g.style.width="200px",g.innerHTML="timeline",a.appendChild(g);var f=this.timethroughModule=new d;f.initialize(g),f.addEventListener("pano_changed",function(e){n.dispatchEvent("pano_changed",{data:e.data})});var y=this.albumWapper=document.createElement("div");y.className="pano-func-item",y.style.zIndex="1",a.appendChild(y),r=new i,r.initialize(y,t.albumImageDomain,{zIndex:t.zIndex});var _=function(e,t){n.dispatchEvent(e.type,t)};p.each(["animate_pano_changed","pano_changed","inter_poi_changed","floor_changed","show_position","hide_position","photo_tour_enter","video_enter"],function(e){r.addEventListener(e,_)});var v=t.data.panoId,M=t.data.panoType;v&&u.getGuideData(v,function(e){n.render(e,M,!0,v,null,t.timeThroughData)})}catch(x){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/exception.fire","catch",{msg:x.message||x.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:124})}},getContainer:function(){return this.container},isAsync:function(){return!0},render:function(e,t,n,a,i,o){try{var d=T.isArray(e.content)&&e.content.length>0,l=T.isArray(e.panoTimelineData)&&e.panoTimelineData.length>0,s=d?e.content:null,u=l?e.panoTimelineData:null;if("street"===t){var c={photoUrl:"../../../../../../../../webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/upload_pano2_01a9410.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/upload_pano2_01a9410.png*/,name:"",type:9};s?s.push(c):s=[c]}if(n&&s)if("inter"===t)if(e.catalogData){var g=e.catalogData.exit.length>0?[e.catalogData.exit[0]]:[],f=null;for(var y in e.catalogData){if(null!==f)break;p.each(e.catalogData[y],function(e){return a===e.data.panoId?(f=y,!0):void 0})}g=g.concat(e.catalogData[f]),r.update(g)}else{var _=void 0!==i?i+1:void 0,g=p.each(s,function(e){try{if(2===e.type&&(e.data.type=21,e.type=21),3===e.type||1===e.type||5===e.type||6===e.type||21===e.type)return e.data.panoId===a&&(_=e.data.floor),e}catch(t){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:214})}},!0);void 0!==_&&(g=p.each(g,function(e){try{if(3===e.type||21===e.type||6===e.type||e.data.floor===_||0==e.data.floor)return e}catch(t){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:226})}},!0)),r.update(g)}else r.update(s);h.update(u);var v=o&&o.length>1;v?this.timethroughModule.update(o):this.timethroughModule.empty();var M=e.topicData&&e.topicData.length>0;M?m.update(e.topicData):m.empty(),this._displayStatus.timeline&&!u||!this._displayStatus.timeline&&!u,this._displayStatus.album=!!s,this._displayStatus.timeline=!!u,this._displayStatus.topic=!!M,this._displayStatus.timeThrough=v,this._display=!!(s||u||M),this.dispatchEvent("layout_changed",{display:this._display}),this.ready()}catch(x){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/exception.fire","catch",{msg:x.message||x.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:273})}},resize:function(e){var t=this._maxWidth,n=this._displayStatus,i=this.albumWapper,o=this.timeLineWapper,d=this.topicWapper,l=this.timeThroughWapper,s=parseInt(i.style.left||0),u=document.body.clientWidth-t,p=u,h=0,m=0;n.timeline&&(m=o.clientWidth,o.style.left=u+"px",p+=m,h+=m),n.topic&&(m=d.clientWidth,d.style.left=u+h+"px",p+=m,h+=m),n.timeThrough&&(m=l.clientWidth,l.style.left=u+h+"px",p+=m,h+=m),r.event_layoutChanged(t-m);var g=p-s;if(!e&&Math.abs(g)>10){r.ignoreMouseEvent(!0);var f=new a.Animation;f.build({fps:60,transition:a.Transitions.easeOutQuad,duration:Math.abs(g)/c*1e3,render:function(e){try{i.style.left=s+e*g+"px"}catch(t){"undefined"!=typeof alog&&alog("http://webmap2.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoGuideModule/PanoGuideModule.js",ln:349})}},finish:function(){i.style.left=p+"px",r.setSelectIndex(r.getSelectIndex()),r.ignoreMouseEvent(!1)}})}else i.style.left=p+"px",r.ignoreMouseEvent(!1)},getSelectAlbumItem:function(){return r?r.getSelectItem():null},update:function(e,t,n,a,i,o){if(this.container.parentNode){var d=this,l=i===this.getName(),s=!0;l&&"inter"!==n&&"street"===a&&(s=!1);var c="inter"===a;u.getGuideData(e,function(n){d.render(n,a,s,e,t,o),c?n&&n.content.length>0&&p.each(n.content,function(t){t.data.panoId==e&&r.setSelectPano(e+"_"+t.data.uid)}):l||(r.unselect(),r.scrollTo(0))})}},event_layoutChanged:function(e,t){e&&(this._maxWidth=e,this.resize(t))},dispose:function(){r.dispose(),r=null,h.dispose(),h=null,m.dispose(),m=null},getSupportEvents:function(){return["animate_pano_changed","pano_changed","inter_poi_changed","layout_changed","floor_changed","show_position","hide_position","photo_tour_enter","video_enter"]}});n.exports=g});