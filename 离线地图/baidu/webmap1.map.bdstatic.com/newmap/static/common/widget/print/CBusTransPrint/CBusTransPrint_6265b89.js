define("common:widget/print/CBusTransPrint/CBusTransPrint.js",function(e,t,s){function i(){T.lang.Class.call(this),this.lineData=null,this.curNo=1,this.lineNo=0,this.lineIndex=0,this.fullTime="",this.lineTip=null,this.linePlanName=[],this.cbtStops=[],this.cbtRoutes=[],this.displayMapList="",this.mapCount=0,this.areaFlag=0}var n=e("common:widget/ui/util/util.js"),a=e("common:widget/ui/mapUtil/mapUtil.js"),l=e("common:widget/ui/config/config.js"),p=(l.mapConfig,e("common:widget/ui/constant/Constant.js")),o=e("common:widget/print/printUtil/printUtil.js"),r=e("common:widget/ui/searchData/searchData.js"),c=null;T.extend(i.prototype,{initialize:function(e){try{var t=this,s=e;c=e.constructor,t.setData(s);var i=s.json,n=i.content[t.lineIndex],a=i.result,l=a.start,p=a.end,r=[],d=T.g("bd"),u=T.g("mapBox"),m=T.g("busDrivers"),h=T.g("remindMsg"),g=T.g("busList"),v=T.g("searchValue");d.insertBefore(m,u),d.insertBefore(h,u),map.removeContextMenu(window.contextMenu),map.disableScrollWheelZoom(),t.appendImg(o.JS("MapHolder"),"dest_markers.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/widget/print/CBusTransPrint/dest_markers.png*/,"../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/ie6_dest_markers_9a7d50c.png*/),t.appendImg(o.JS("MapHolder"),"trans_icons.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/widget/print/CBusTransPrint/trans_icons.png*/,"../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/ie6_trans_icons_345d50b.png*/),v.innerHTML="<li><strong>起点：</strong>"+l.wd+"</li><li><strong>终点：</strong>"+p.wd+"</li><li><strong>路线：</strong>"+t.linePlanName+"</li><li><strong>时间：</strong>"+t.fullTime+"</li>",r.push('<li class="starting"><div class="startingTitle"><strong>起点：</strong>'+l.wd+'</div><div class="distance">全程约：'+t.fullTime+"</div></li>");for(var f=0;f<n.length;f++){var b=t.addLine(n[f]);r.push(b)}r.push('<li class="starting"><div class="startingTitle"><strong>终点：</strong>'+p.wd+"</div></li>"),g.innerHTML=r.join(""),o.JS.getElementByClassName("taxiCost")[0].style.display="none",o.JS("ulE").style.display="none",o.JS("resultTitle").innerHTML="具体路线:",o.JS("resultControl").style.display="",o.JS("remindMsg").innerHTML="百度提醒您：以上的路线信息仅供参考",t.addEvent()}catch(_){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/print/CBusTransPrint/exception.fire","catch",{msg:_.message||_.description,path:"common:widget/print/CBusTransPrint/CBusTransPrint.js",ln:84})}},setData:function(e){var t=this;t.lineIndex=e.curLineIndex,t.lineData=e.json.content[t.lineIndex],t.cbtRoutes=e.linesCache[t.lineIndex].routes,t.cbtStops=e.linesCache[t.lineIndex].stops,t.areaFlag=e.json.result.area_flag;var s=T.g("list"+t.lineIndex),i=o.JS.getElementByClassName("cbtLineTitleItem",s);t.fullTime=i[i.length-1].innerHTML.split(":")[1].replace(/^\s*/,""),t.linePlanName=function(){for(var e=[],t=0,s=i.length;s>t;t++){var n=i[t];if(3==n.childNodes.length){var a=n.childNodes[0].className.indexOf("Air")>-1?"航班":"火车";e.length&&e.push("&#8594;"),e.push(n.childNodes[1].innerHTML+"("+a+")")}}return e.join("")}(),t.lineTip=o.JS.getElementByClassName("cbtTip",s)},addLine:function(e){var t=this,s=e,i=s.type,n=[];switch(i){case CBusTransInst.constructor.SEG_LINE_RAILWAY_TYPE:var a=t.getRailwayHtml(s);n.push(a);break;case CBusTransInst.constructor.SEG_LINE_AIR_TYPE:var l=t.getAirLineHtml(s);n.push(l);break;case CBusTransInst.constructor.SEG_LINE_BUS_TYPE:var p=t.getBusLineHtml(s);n.push(p)}return n.join("")},getRailwayHtml:function(e){var t=this,s=e.data,i=s.line,n=s.off,a=s.on,l=t.lineTip.shift(),p=['<li class="singleLine"><span class="num">'+t.curNo+'</span><div class="hd"><div class="byrailway"><img src="../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"></div><div class="tf">'],o="";if(1==t.areaFlag||3==t.areaFlag)var o='在&nbsp;<span class="highlight_orange">'+a.name+"</span>&nbsp;";return p.push('<a class="cs" href="javascript:void(0)">'+l.innerHTML+"</a></div>"),p.push("<p>"+o+'乘坐&nbsp;<em  class="highlight_orange">'+i.name+'</em>，在&nbsp;<span class="highlight_orange">'+n.name+"</span>&nbsp;下车</p>"),p.push('<div class="openCloseButton" num="'+t.curNo+'"><span>展开地图</span></div></div>'),p.push('<div class="smallMap"><div class="firstMapBox" id="smallMapBox'+t.curNo+'_0"></div></div></li>'),t.curNo++,t.lineNo++,p.join("")},getAirLineHtml:function(e){var t=this,s=e.data,i=s.line,n=(s.on,s.off),a=t.lineTip.shift(),l=['<li class="singleLine"><span class="num">'+t.curNo+'</span><div class="hd"><div class="byair"><img src="../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"></div><div class="tf">'];return l.push('<a class="cs" href="javascript:void(0)">'+a.innerHTML+"</a></div>"),l.push('<p>乘坐&nbsp;<em class="highlight_orange">'+i.name+'&nbsp;</em>航班，在&nbsp;<span class="highlight_orange">'+n.name+"</span>&nbsp;降落</p>"),l.push('<div class="openCloseButton" num="'+t.curNo+'"><span>展开地图</span></div></div>'),l.push('<div class="smallMap"><div class="firstMapBox" id="smallMapBox'+t.curNo+'_0"></div></div></li>'),t.curNo++,t.lineNo++,l.join("")},getBusLineHtml:function(e){var t=this,s=e.data,i=e.start,n=e.end,a=t.lineTip.shift(),l=['<li class="singleLine" listType="parent" listOpen = "false" curNo = "'+t.curNo+'"+ taxiOk = "false"><span class="num">'+t.curNo+'</span><div class="hd"><div class="bybus"><img src="../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"></div><div class="tf">'];l.push('<a class="cs" href="javascript:void(0)">'+a.innerHTML+"</a></div>"),l.push('<p>从&nbsp;<a href="javascript:void(0);">'+i.wd+'</a>&nbsp;至&nbsp;<a href="javascript:void(0);">'+n.wd+"</a>&nbsp;</p>"),l.push('<div class="openCloseButton" num="'+t.lineNo+'"><span>查看详情</span></div></div></div></li>'),t.lineNo++;var p=t.getBusListHtml(s[0]);return l.push(p),l.push('<li class="taxiFareLine" id="taxiline'+t.curNo+'"></li>'),t.curNo++,l.join("")},getBusListHtml:function(e){var t=this,s=e,i=s.lines[0],n=s.stops[0],a=[];t.bLines=i,t.bStops=n;for(var l=0,p=n.length;p>l;l++){if(0!=n[l].walk.distance){var o=t.getWalkItemHtml(n[l]);a.push(o)}else 0!=l||0!=i[l].type&&1!=i[l].type?l!=p-1||!i[l-1]||0!=i[l-1].type&&1!=i[l-1].type||(t.isResetEnd=!0):t.isResetStart=!0;if(l!=n.length-1){var r=t.getBusItemHtml(i[l],l);a.push(r)}}return a.join("")},getWalkItemHtml:function(e){var t=this,s=e,i=s.getOn,n=(s.getOff,s.walk,t.lineTip.shift()),a=t.defaultOpen?"li_open":"li_close",l=['<li class="singleLine '+a+'" listType="child"><div class="hd"><div class="step"><img src="../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"></div><div class="tf">'];return l.push('<a class="cs" href="javascript:void(0)">'+n.innerHTML+"</a></div>"),l.push('<p>步行至&nbsp;<a href="javascript:void(0);">'+i.name+"</a>&nbsp;</p>"),l.push('<div class="openCloseButton" num="'+t.lineNo+'"><span>展开地图</span></div></div>'),l.push('<div class="smallMap"><div class="firstMapBox" id="smallMapBox'+t.lineNo+'"></div></div></li>'),t.lineNo++,l.join("")},getBusItemHtml:function(e,t){var s=this,i=e,a=s.lineTip.shift(),l=s.defaultOpen?"li_open":"li_close";if(i.name.indexOf("地铁")>-1&&i.name.indexOf("号线")>-1){var p=i.name.indexOf("环(")>-1?i.name.substr(0,i.name.indexOf("环("))+"环)":i.name;p=p.indexOf("环")>-1?p:p.replace(/\(.*?-(.*?)\)/,"($1")+"方向)";var o=i.name.indexOf("(")>-1?i.name.substr(0,i.name.indexOf("(")):i.name}else{var p=i.name.indexOf("(")>-1?i.name.substr(0,i.name.indexOf("(")):i.name;n.isInteger(p)&&(p+="路");var o=p}if(o.indexOf("地铁")>-1)var r='<div class="bysub"><img src="../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"></div>';else var r='<div class="bybus"><img src="../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/ width="148" height="14"></div>';var c=['<li class="singleLine '+l+'" listType="child"><div class="hd">'+r+'<div class="tf">'];return a&&a.innerHTML&&c.push('<a class="cs" href="javascript:void(0)">'+a.innerHTML+"</a></div>"),c.push("<p>乘坐&nbsp;<strong>"+o+'</strong>，在&nbsp;<a href="javascript:void(0);">'+s.bStops[t+1].getOff.name+"</a>&nbsp;下车</p>"),c.push('<div class="openCloseButton" num="'+s.lineNo+'"><span>展开地图</span></div></div>'),c.push('<div class="smallMap"><div class="firstMapBox" id="smallMapBox'+s.lineNo+'"></div></div></li>'),s.lineNo++,c.join("")},addEvent:function(){var e=this,t=o.JS.getElementByClassName("singleLine");e.singleLine=t,e.textDisplay=T.g("textDisplay"),e.mapDisplay=T.g("mapDisplay");for(var s=0,i=t.length;i>s;s++){var a=o.JS.getElementByClassName("smallMap",t[s]),l=t[s].getAttribute("listType")||!1;t[s].onmouseover=function(e){var t=e||window.event;T.dom.hasClass(this,"singleLineHover")||T.ac(this,"singleLineHover"),o.JS.stopBubbleEvent(t)};var e=this;t[s].onmouseout=function(e){var t=e||window.event;T.dom.hasClass(this,"singleLineHover")&&"true"!=this.getAttribute("listOpen")&&T.rc(this,"singleLineHover"),o.JS.stopBubbleEvent(t)},t[s].setAttribute("openmap","false"),"parent"==l?t[s].onclick=function(){return function(t){var s=t||window.event,i=this,n=i.nextSibling,a=["li_open","li_close"],l=parseInt(this.getAttribute("curNo")),p=T.g("taxiline"+l),r=p.getAttribute("taxiOk"),c=o.JS.getElementByClassName("openCloseButton",this)[0].childNodes[0],d="true"==i.getAttribute("listOpen")?!0:!1;for(i.setAttribute("listOpen",!d+""),c.innerHTML=d?"查看详情":"隐藏详情","true"===r&&d?p.style.display="none":"true"!==r||d?"true"===r||"null"===r||d||e.taxiFare(e.lineData[l-1],p):p.style.display="block",T.ac(this,"singleLineHover");"parent"!=n.getAttribute("listType")&&n.getAttribute("listType");)i=n,d?(T.ac(i,a[1]),T.rc(i,a[0]),i.onclick(s,"hide")):(T.ac(i,a[0]),T.rc(i,a[1])),n=i.nextSibling}}(s):(e.mapCount++,t[s].onclick=function(t){return function(s,i,l){var p=this,r=i||"defalut",c=l||t,d=s||window.event,u=d.target||d.srcElement;a=o.JS.getElementByClassName("smallMap",p)[0],isOpenMap="true"==p.getAttribute("openmap")?!0:!1,mapOk="ok"==a.getAttribute("data-map")?!0:!1,"hide"==r?isOpenMap&&(isOpenMap=e.hideMap(a,c),n.stopBubble(d)):"show"==r?isOpenMap||(mapOk?(isOpenMap=e.showMap(a,c),n.stopBubble(d)):(e.createSmallMap(a,c),isOpenMap=e.showMap(a,c))):"defalut"==r&&(isOpenMap?("openCloseButton"===u.className||"收起地图"===u.innerHTML||"展开地图"===u.innerHTML)&&(mapOk?(isOpenMap=isOpenMap?e.hideMap(a,c):e.showMap(a,c),n.stopBubble(d)):(e.createSmallMap(a,c),isOpenMap=e.showMap(a,c))):mapOk?(isOpenMap=isOpenMap?e.hideMap(a,c):e.showMap(a,c),n.stopBubble(d)):(e.createSmallMap(a,c),isOpenMap=e.showMap(a,c)))}}(s))}e.textDisplay.onclick=function(){return function(s){var i=s||window.event,n=e.displayMapList.split("<").join("").split(">");if(!n.length)return!1;for(var a=0;a<n.length-1;a++)t[n[a]].onclick(i,"hide",n[a])}}(),e.mapDisplay.onclick=function(){return function(s){var i=s||window.event,n=e.displayMapList.split(",");if(n.length-1<e.mapCount)for(var a=0;a<t.length;a++)e.displayMapList.indexOf(a+",")>-1||("parent"!=t[a].getAttribute("listtype")||"parent"==t[a].getAttribute("listtype")&&"false"==t[a].getAttribute("listopen"))&&t[a].onclick(i,"show",a)}}()},createSmallMap:function(e,t){var s=e,i=this,n=t,l=(o.JS.getElementByClassName("BMap_mask",s),o.JS.getElementByClassName("firstMapBox",s)[0]),p=new BMap.Map(l,{coordType:BMAP_COORD_MERCATOR}),r=new BMap.Point(12957320,4825100);p.centerAndZoom(r,12),mapType==BMAP_TYPE_DIMENSIONAL&&(p.setCurrentCity(paramExt.cc),p.setMapType(mapType)),p.addControl(new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_ZOOM})),i.busPoi=i.addCBusPoi(p),i.busRoutes=i.addCBusRoute(p);var c=[];return c[0]=new BMap.Point(i.busRoutes[n]._bounds.maxX,i.busRoutes[n]._bounds.maxY),c[1]=new BMap.Point(i.busRoutes[n]._bounds.minX,i.busRoutes[n]._bounds.minY),setTimeout(function(){p.setViewport(c),a.unSelectRoute(i.busRoutes[n]),a.selectRoute(i.busRoutes[n])},100),s.setAttribute("data-map","ok"),!0},hideMap:function(e,t){var s=this,i=s.displayMapList.split("<"+t+">"),n=o.JS.getElementByClassName("openCloseButton",s.singleLine[t])[0].childNodes[0];e.style.display="none",s.displayMapList=i.join("");var a=s.displayMapList.split("<").join("").split(">");return 1==i.length?T.ac(s.textDisplay,"Selected"):T.rc(s.textDisplay,"Selected"),T.dom.hasClass(s.mapDisplay,"Selected")&&T.rc(s.mapDisplay,"Selected"),a.length-1==0&&T.ac(s.textDisplay,"Selected"),s.singleLine[t].setAttribute("openmap","false"),n.innerHTML="展开地图",!1},showMap:function(e,t){var s=this,i=o.JS.getElementByClassName("openCloseButton",s.singleLine[t])[0].childNodes[0];s.displayMapList=s.displayMapList+"<"+t+">",e.style.display="block";var n=s.displayMapList.split("<").join("").split(">");return T.dom.hasClass(s.textDisplay,"Selected")&&T.rc(s.textDisplay,"Selected"),n.length-1==s.mapCount&&T.ac(s.mapDisplay,"Selected"),s.singleLine[t].setAttribute("openmap","true"),i.innerHTML="收起地图",!0},addCBusPoi:function(e){for(var t=this,s=[],i=0,n=t.cbtStops.length;n>i;i++){var l=t.cbtStops[i],o=null;if(0==i){var r=t.isResetStart?t.cbtStops[i+1].point:l.point;o=a.addDestPoi(r,"",p.DEST_START,"",e),o.setZIndex(20)}else if(i==n-1){var r=t.isResetEnd?t.cbtStops[i-1].point:l.point;o=a.addDestPoi(r,"",p.DEST_END,"",e),o.setZIndex(20)}else if(i>0&&n-1>i){var d=0;switch(l.type){case c.STOP_TYPE_RAIL:d=p.TRANS_TYPE_RAIL;break;case c.STOP_TYPE_AIR:d=p.TRANS_TYPE_AIR;break;case c.STOP_TYPE_BUS:d=p.TRANS_TYPE_BUS;break;case c.STOP_TYPE_DRIVING:d=p.TRANS_TYPE_DRIVING;break;case c.STOP_TYPE_WALKING:d=p.TRANS_TYPE_WALKING}o=a.addTransPoi(l.point.toString(),d,"",e),(d==c.STOP_TYPE_RAIL||d==c.STOP_TYPE_AIR)&&o.setZIndex(10)}s.push(o)}return s},addCBusRoute:function(e){for(var t=this,s=[],i=0,n=t.cbtRoutes.length;n>i;i++){var l=t.cbtRoutes[i],o=i>0?t.cbtRoutes[i-1]:null,r=n>i?t.cbtRoutes[i+1]:null,d=5==l.type?p.ROUTE_TYPE_WALK:p.ROUTE_TYPE_BUS,u=l.points.toString();if(o&&d==p.ROUTE_TYPE_WALK&&(o.type==c.SEG_LINE_SUBWAY_TYPE||o.type==c.SEG_LINE_SUBWAY_TYPE)){var m=o.points.toString();u=m.substr(m.lastIndexOf(";")+1)+";"+u}if(r&&r.type==c.SEG_LINE_SUBWAY_TYPE&&d==p.ROUTE_TYPE_WALK){var h=r.points.toString();u+=";"+h.substr(0,h.indexOf(";"))}var g=a.addRoute(u,d,"",e);s.push(g)}return s},appendImg:function(e,t,s){var i=o.findAlphaImageLoader("div",e,t),n=document.createElement("img");if(n.className="ie6_print",n.src=s,i.length)for(var a=0,l=i.length;l>a;a++){var p=i[a],r=n.cloneNode(!0);p.className="noprint",r.style.top=p.style.top,r.style.left=p.style.left,p.parentNode.appendChild(r)}},taxiFare:function(e,t){var s=e,i=s.code,n=s.start,a=n.wd,l=n.uid||"",p=n.pt,o=s.end,c=o.wd,d=o.uid||"",u=o.pt,m="nav&navtp=0&sy=0&drag=0&st=1&et=1&c="+i+"&sc="+i+"&ec="+i+"&sn=1$$"+l+"$$"+p+"$$"+encodeURIComponent(a)+"$$$$$$&en=1$$"+d+"$$"+u+"$$"+encodeURIComponent(c)+"$$$$$$&sq="+encodeURIComponent(a)+"&eq="+encodeURIComponent(c);r.fetch(m,function(e){var s=e.content.taxi||!1;if(s){var i=s.detail[0],n=s.detail[1];t.innerHTML="<span>打车费用：</span>"+i.desc+i.totalPrice+"元&nbsp;&nbsp;&nbsp;&nbsp;"+n.desc+n.totalPrice+"元",t.setAttribute("taxiOk","true"),t.style.display="block"}else t.setAttribute("taxiOk","null"),t.style.display="none"})}}),s.exports=i});