define("common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),Animation=require("common:widget/ui/Animation/Animation.js"),service=require("common:widget/pano/base/service.js"),util=require("common:widget/pano/base/util.js");require.loadCss({content:"#pano-classify-wrapper{position:absolute;right:45px;top:0;height:40px;width:176px;overflow:hidden;z-index:100010}.pano-classify-panel{position:relative;left:176px;height:40px;width:176px;color:#fff;font-size:12px;*background-color:#252525;_background-color:#252525;border-radius:2px;font-size:12px;background-position:0 -3px}#pano-classify-wrapper .transparent-msk{left:0;top:0;height:40px;border-radius:2px;background-color:#252525;opacity:.9;filter:alpha(opacity=90)}.classify_splite_line{display:inline-block;height:18px;width:1px;font-size:1px;line-height:1px;vertical-align:top;margin-top:12px;margin-left:7px;background-color:#3c3e42;_background-color:#3c3e42;background-color:#222\\9}.pano-classify-panel li{float:left;display:inline-block;height:34px;width:35px}.pano-classify-panel li a{display:inline-block;width:48px;height:40px}.pano-classify-panel li a{display:inline-block;margin-top:7px;height:26px;width:27px;overflow:hidden;background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/classification_search_icons2_f908cb3.png);background-repeat:no-repeat}.pano_classify_hotel{background-position:3px -1px}.pano_classify_hotel:hover{background-position:3px -26px}.pano_classify_select .pano_classify_hotel,.pano_classify_select .pano_classify_hotel:hover{background-position:3px -100px}.pano_classify_restaurant{background-position:-49px -2px}.pano_classify_restaurant:hover{background-position:-49px -27px}.pano_classify_select .pano_classify_restaurant,.pano_classify_select .pano_classify_restaurant:hover{background-position:-49px -101px}.pano_classify_movie{background-position:-155px -51px}.pano_classify_movie:hover{background-position:-155px -24px}.pano_classify_select .pano_classify_movie,.pano_classify_select .pano_classify_station:hover{background-position:-162px -97px}.pano_classify_station{background-position:-24px -1px}.pano_classify_station:hover{background-position:-24px -26px}.pano_classify_select .pano_classify_station,.pano_classify_select .pano_classify_station:hover{background-position:-24px -100px}.pano_classify_indoor{background-position:-75px -1px}.pano_classify_indoor:hover{background-position:-75px -26px}.pano_classify_select .pano_classify_indoor,.pano_classify_select .pano_classify_indoor:hover{background-position:-75px -100px}.pano-classify-panel li:last-child a{border-radius:0 4px 4px 0}.pano-classify-panel li:first-child a{border-radius:4px 0 0 4px}"});var getClassifySearchWrapper=function(){var classifySearchTmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="pano-classify-wrapper"><ul class="clearfix pano-classify-panel"><li data-index="1"><a href="javascript:void(0);" title="检索周边酒店" class="pano_classify_hotel"></a><span class="classify_splite_line"></span></li><li data-index="2"><a href="javascript:void(0);" title="检索周边餐饮" class="pano_classify_restaurant"></a><span class="classify_splite_line"></span></li><li data-index="3"><a href="javascript:void(0);" title="检索周边电影院" class="pano_classify_movie"></a><span class="classify_splite_line"></span></li><li data-index="4"><a href="javascript:void(0);" title="检索周边公交站" class="pano_classify_station"></a><span class="classify_splite_line"></span></li><li data-index="5"><a href="javascript:void(0);" title="检索周边内景" class="pano_classify_indoor"></a></li><div class="transparent-msk"></div></ul></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];return function(){var a=classifySearchTmpl({});return T(a)[0]}}(),classifySearchWrapper=null,classifySearchContainer=null,selectedClassifySearchType=void 0,classifySearchBtn=null,classifySearchBtnVisible=!1,panoContext=null,_classifySearchPanelVisible=!1,_displayAnimate=function(){var a=40,e=400,s=Animation.Transitions["ease-out"],i=new Animation.Animation,n=174,l=0,o="left";return function(t,r){var c=T(classifySearchWrapper).find(".pano-classify-panel")[0];if(void 0===r)_classifySearchPanelVisible=!_classifySearchPanelVisible;else{if(_classifySearchPanelVisible===r)return;_classifySearchPanelVisible=r}_classifySearchPanelVisible&&(classifySearchWrapper.style.display="block");var p=_classifySearchPanelVisible?n:l,f=_classifySearchPanelVisible?l:n;i.build({fps:a,transition:s,duration:e,render:function(a){try{c.style[o]=p+(f-p)*a+"px"}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/ClassifySearchModule/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js",ln:61})}},finish:function(){t(),!_classifySearchPanelVisible&&(classifySearchWrapper.style.display="none")}})}}(),ClassifySearchModule=ModuleClass.extend("ClassifySearchModule",{initialize:function(a,e,s){try{classifySearchBtnVisible=!0,classifySearchContainer=a,panoContext=s,classifySearchWrapper=getClassifySearchWrapper(),classifySearchContainer.appendChild(classifySearchWrapper),classifySearchBtn=e,this.open(),this.bindFoldExpandEvent(),this.bindEvents()}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/ClassifySearchModule/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/pano/module/ClassifySearchModule/ClassifySearchModule.js",ln:87})}},bindFoldExpandEvent:function(){var a=this,e=null,s=800,i=function(){e&&clearTimeout(e),a.open()},n=function(){e&&clearTimeout(e),e=setTimeout(function(){a.close()},s)};T.on(classifySearchWrapper,"mouseenter",i),T.on(classifySearchWrapper,"mouseleave",n),T.on(classifySearchBtn,"mouseenter",i),T.on(classifySearchBtn,"mouseleave",n)},toggle:function(a){_displayAnimate(function(){},a)},open:function(){this.toggle(!0)},close:function(){this.toggle(!1)},bindEvents:function(){var a=this;T(classifySearchWrapper).on("click",function(e){for(var s=e.target;"LI"!==s.nodeName&&s!==classifySearchWrapper;)s=s.parentNode;if("LI"===s.nodeName){var i=s.getAttribute("data-index");i!==selectedClassifySearchType?(T(classifySearchWrapper).find(".pano_classify_select").attr("class",""),T(s).attr("class","pano_classify_select")):(T(classifySearchWrapper).find(".pano_classify_select").attr("class",""),i=void 0),selectedClassifySearchType=i,a._updateClassifySearchMarkers(selectedClassifySearchType),T(classifySearchBtn).attr("class","classify_icon_"+selectedClassifySearchType),addStat(STAT_CODE.STAT_PANORAMA,{item:"classifysearchpanel-click"})}baidu.event.preventDefault(e)})},updateClassifySearch:function(){void 0!==selectedClassifySearchType&&this._updateClassifySearchMarkers(selectedClassifySearchType)},_updateClassifySearchMarkers:function(a){this._removeClassifySearchMarkers();var e=panoContext.getPanoOptions(),s=this;void 0!==a&&e&&service.getClassifySearchData(e.panoMCPoint.x,e.panoMCPoint.y,a,function(a){return function(e){var i=panoContext.getPanoOptions();i.panoId===a&&e&&e.length>0&&s._addClassifySearchMarkers(e.slice(0,10))}}(e.panoId))},_addClassifySearchMarkers:function(a){var e=this;e._markerIds=[],util.each(a,function(a){a.markerId=util.getUniqueId("MARKER_"),e._markerIds.push(a.markerId)}),this.dispatchEvent("add_markers",a)},_removeClassifySearchMarkers:function(){this._markerIds&&this._markerIds.length&&(this.dispatchEvent("remove_markers",this._markerIds),this._markerIds=null)},dispose:function(){classifySearchContainer.removeChild(classifySearchWrapper),classifySearchWrapper=null,classifySearchContainer=null,selectedClassifySearchType=void 0,classifySearchBtn=null,classifySearchBtnVisible=!1,T.un(document.body,"mousedown",window.pano_classify_global_click_handler),window.pano_classify_global_click_handler=null},getSupportEvents:function(){return["add_markers","remove_markers"]}});module.exports=ClassifySearchModule});