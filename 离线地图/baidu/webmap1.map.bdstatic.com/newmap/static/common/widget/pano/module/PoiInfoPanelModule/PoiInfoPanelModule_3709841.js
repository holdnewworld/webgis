define("common:widget/pano/module/PoiInfoPanelModule/PoiInfoPanelModule.js",function(require,exports,module){var FoldPanelComponent=require("common:widget/pano/component/FoldPanelComponent/FoldPanelComponent.js"),ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),PanoPoi=require("common:widget/pano/model/PanoPoi.js");require.loadCss({content:".list-title-bar{position:absolute;top:20px;left:103px;font-size:12px;line-height:40px;height:40px;width:87px;background-color:#252525;background-color:rgba(37,37,37,.9);filter:alpha(opacity=90);border-radius:2px 0 0 2px;color:#c5cbd6}.list-title-bar .v-line{position:absolute;right:0;top:10px;height:20px;width:1px;background-color:#53565c}.list_title_text{text-indent:42px;display:block;line-height:40px;text-decoration:none;color:#c5cbd6;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon2_d6ba4ea.png) no-repeat 9px 8px;_background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon_8_2_9ebc767.png) no-repeat;_background-position:9px 8px}.list_title_text:hover{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon2_hover_9b65ccc.png) no-repeat 9px 7px;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/pano_list_icon_8_2_hover_951b39a.png) no-repeat;_background-position:9px 7px;color:#3af}.busline_title_icon,.busline_title_icon:hover{overflow:hidden;width:87px;white-space:nowrap;text-overflow:ellipsis;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/busline-icon2_36fa0ae.png) no-repeat 10px 6px;_background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/busline-icon-ie6_d8bc65f.png)}.busline_title_icon:hover{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/busline-icon2_hover_5813c0b.png) no-repeat 12px 6px!important}.info-title-bar,.info-title-bar-nolist{position:absolute;top:20px;font-size:12px;line-height:40px;height:40px;width:193px;padding:0 10px;background-color:#252525;background-color:rgba(37,37,37,.9);_background-color:#252525;*background-color:#252525;filter:alpha(opacity=90);_filter:alpha(opacity=90);border-radius:0 2px 2px 0;color:#c5cbd6}.info-title-bar{left:190px}.info-title-bar p{_margin-top:10px}.info-title-bar-nolist{left:103px;width:280px;border-radius:2px}.poi_title_text{_margin-top:10px;width:95%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer}.poi_title_text:hover{color:#3af}.poi_default_icon{background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_efd2360.png);*background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_marker_8_f96e26d.png);width:18px;height:18px;background-position:0 0;margin-top:-2px;margin-right:7px;display:inline-block;vertical-align:middle}.info-title-bar dt,.info-title-bar dd{display:inline-block;margin:0;float:left}.info-title-bar dt{*margin-top:7px}.pano_popup_title{margin:0 auto;width:260px;height:35px;color:#c5cbd5;font-size:14px;line-height:35px;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.pano_popup_title span{color:#eaae00}.pano_popup{width:300px;font-size:12px;color:#939799}.pano_popup a{text-decoration:none;color:#c5cbd6}.pano_popup .content_line{margin:14px;height:1px;font-size:0;line-height:0;background:#3c3c42}.pano_poi_header{margin:9px 14px 0}.pano_poi_header .indoor_view_icon{float:left;margin-top:-3px}.pano_poi_header .detail_link{color:#71557b;float:right}.pano_poi_header .detail_link:hover{color:#33a9ff}.pano_poi_header .title{float:left;width:210px;margin-right:6px;font-size:12px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#d3d8db}.pano_poi_content{margin-bottom:6px}.pano_poi_content li{margin:0 14px 10px}.pano_poi_content li.last{margin-bottom:0}.pano_poi_content li span{float:left}.pano_poi_content .type_cont{width:206px}.pano_popup .book_link{float:right;color:#7a7c80;margin-bottom:10px}.pano_popup .book_link:hover{color:#3af}.movie_newest{font-size:12px}.movie_newest a span{display:inline-block;width:48px;padding:5px 8px;vertical-align:middle;background:#9bcb66;color:#fff}.movie_book .span1{display:inline-block;width:104px;vertical-align:middle;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.movie_book .span2,.movie_book .span3{display:inline-block;width:48px;*margin-left:-3px}.movie_newest a em{color:red;font-style:normal}.pano_popup .gray{color:#71757b}.pano_popup .blue{color:#40acff}.pano_popup .orange{color:#ee6919}.pano_hotel_info li,.pano_movie_info li{margin-bottom:14px;line-height:20px}.pano_hotel_info,.pano_movie_info{margin:0 14px}.hotel_book .span1{display:inline-block;width:140px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.hotel_book .span2{display:inline-block;width:60px;overflow:hidden}.movie_book_btn{display:inline-block;height:20px;line-height:20px;text-align:center;text-decoration:none;font-size:12px;color:#caac00!important;_overflow:hidden;zoom:1;width:60px}.hotel_book_btn{display:inline-block;vertical-align:top;width:60px;height:20px;line-height:20px;font-size:12px;color:#caac00!important;text-align:center;text-decoration:none;_overflow:hidden;zoom:1}.pano_poi_icon{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_0dc7001.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/travel_icons_8_5876649.png);margin-top:1px;margin-right:5px;width:14px;height:14px;display:inline-block;vertical-align:middle}.pano_poi_icon_addr{background-position:-42px 0}.pano_poi_icon_phone{background-position:-56px -1px}.pano_popup .bottom_line{margin:12px 14px 0;font-size:0;line-height:0;height:1px;background:#3c3c42;_background:#222}.pano_poi_footer li{height:35px;text-align:center;cursor:pointer;font-size:12px}.pano_poi_footer .indoor_view{padding-top:9px;display:block}.pano_poi_footer .indoor_view:hover{color:#3af}.pano_poi_footer .detail_indoor_view_icon{display:inline-block;width:27px;height:29px;vertical-align:middle;margin-right:10px;margin-top:-4px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/classification_search_icons2_f908cb3.png) no-repeat;background-position:-75px 0;_background-position:-75px 0}.pano_poi_footer .indoor_view:hover .detail_indoor_view_icon{background-position:-75px -25px}.pano_popup h4.pano_poi_list_header{margin-bottom:18px;text-align:center;font-size:14px;font-weight:400;letter-spacing:3px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.pano_poi_list_content .list_item{position:relative;z-index:0;overflow:hidden;padding:14px 10px;vertical-align:middle}.pano_poi_list_content .list_item_line{position:absolute;top:0;left:18px;width:272px;height:1px;font-size:0;line-height:0;border:0;background:#3c3c42;_background:#222}.pano_poi_list_content .list_item_icon{float:left;width:30px}.list_item_content{float:left;cursor:pointer}.list_item_content .pano_poi_name{width:180px;margin-bottom:12px;font-weight:400;font-size:12px;color:#c5cbd5;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.pano_info_name{float:left;width:37px;color:#71757b}.pano_poi_addr{margin-bottom:7px}.pano_info_cont{float:left;width:170px;color:#71757b}.list_item_bg{position:absolute;z-index:-1;left:0;top:1px;width:999px;height:999px;background:transparent}.list_item_hover .list_item_bg{background-color:#4d4e4e;opacity:.8;filter:alpha(opacity=80);_filter:alpha(opacity=100)}.pano_entrance{position:absolute;top:10px;right:16px;width:58px;overflow:hidden}.street_view_icon,.indoor_view_icon{float:right;width:24px;height:26px}.street_view_icon{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/poi_detail_d5cec92.png) no-repeat}.indoor_view_icon{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/classification_search_icons2_f908cb3.png) no-repeat;background-position:-78px -4px;_background-position:-80px 0}.list_item_hover .indoor_view_icon{background-position:-78px -4px}.street_view_icon{background-position:0 -32px}.pano_entrance_split_line{height:12px;width:1px;float:right;font-size:0;margin:4px 5px 4px 2px;background:#53565c;_background:#222}.indoor_view_icon_hover,.pano_poi_header .indoor_view_icon:hover{background-position:-78px -29px}.pano_poi_list_page{margin-top:5px;text-align:center}.pano_poi_list_page span{display:inline-block;margin:0 4px;color:#d3d8db;padding:0 5px}.pano_poi_list_page a{display:inline-block;line-height:20px;padding:0 5px;text-decoration:none;color:#939799}.pano_poi_list_page a:hover{color:#d3d8db}.list_item_icon span{display:inline-block;width:19px;height:29px;margin-left:5px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/markers_new_37c4817.png) no-repeat;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/markers_new_ie6_429ba35.png) no-repeat}.list_item_icon span.no_1{background-position:0 0}.list_item_hover span.no_1{background-position:0 -32px}.list_item_icon span.no_2{background-position:-24px 0}.list_item_hover span.no_2{background-position:-24px -32px}.list_item_icon span.no_3{background-position:-47px 0}.list_item_hover span.no_3{background-position:-47px -32px}.list_item_icon span.no_4{background-position:-69px 0}.list_item_hover span.no_4{background-position:-69px -32px}.list_item_icon span.no_5{background-position:-93px 0}.list_item_hover span.no_5{background-position:-93px -32px}.list_item_icon span.no_6{background-position:-117px 0}.list_item_hover span.no_6{background-position:-117px -32px}.list_item_icon span.no_7{background-position:-141px 0}.list_item_hover span.no_7{background-position:-141px -32px}.list_item_icon span.no_8{background-position:-164px 0}.list_item_hover span.no_8{background-position:-164px -32px}.list_item_icon span.no_9{background-position:-188px 0}.list_item_hover span.no_9{background-position:-188px -32px}.list_item_icon span.no_10{background-position:-211px 0}.list_item_hover span.no_10{background-position:-211px -32px}.pano_poi_list_content .list_item.busline_station{padding:5px 10px}.busline_station .pano_poi_name{line-height:25px;margin-bottom:0;margin-left:10px}"});var POI_DETAIL_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push(""),panoPoi.tour)_template_fun_array.push('        <div class="pano_popup">        <div class="pano_poi_header clearfix">            <p href="javascript:void(0);" class="title">                ',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.tour.name?"":panoPoi.tour.name,'            </p>        </div><div class="bottom_line"></div><div class="pano_poi_footer"><ul><li data-action="tour" data-tourid="',"undefined"==typeof panoPoi.tour.tourid?"":panoPoi.tour.tourid,'"><a data-action="tour" data-tourid="',"undefined"==typeof panoPoi.tour.tourid?"":panoPoi.tour.tourid,'" href="javascript:void(0);" class="indoor_view"><span as-parent="1" class="detail_indoor_view_icon"></span>进入内景</a></li></ul></div>    </div>');else{if(_template_fun_array.push('    <div class="pano_popup">        <div class="pano_poi_header clearfix">            <p href="javascript:void(0);" class="title">                ',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.poi.name?"":panoPoi.poi.name,'            </p>            <a href="javascript:void(0);" class="detail_link gray" target="_blank" data-action="detail">详情>></a>        </div>        <div class="content_line"></div>        <ul class="pano_poi_content">            '),panoPoi.poi.addr&&(_template_fun_array.push('                <li class="clearfix">                                        '),_template_fun_array.push(1===panoPoi.poi.poi_type||3===panoPoi.poi.poi_type?'                        <span class="type_name">车次：</span>                    ':'                        <span class="type_name">地址：</span>                    '),_template_fun_array.push('                    <span class="type_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.poi.addr?"":panoPoi.poi.addr,"</span>                </li>            ")),_template_fun_array.push("            "),panoPoi.poi.tel&&_template_fun_array.push('                <li class="clearfix last">                                        <span class="type_name">电话：</span>                    <span class="type_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.poi.tel?"":panoPoi.poi.tel,"</span>                </li>            "),_template_fun_array.push("        </ul>        "),panoPoi.movie){_template_fun_array.push('            <div class="content_line"></div>            <div class="pano_movie_info">                <div class="movie_newest">                    '),panoPoi.poi.movie_count&&_template_fun_array.push('                        <a href="javascript:void(0);">                            <span>实时影讯<i class="arrow"></i></span>                            目前                            <em>',"undefined"==typeof panoPoi.poi.movie_count?"":panoPoi.poi.movie_count,"</em>                            部影片                            <em>正在上映!</em>                        </a>                    "),_template_fun_array.push('                </div>                <ul class="movie_book">                    ');for(var i=0;i<panoPoi.movie.length;i++)_template_fun_array.push('                        <li class="clearfix">                            <span class="span1" title="美国队长2">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.movie[i].name?"":panoPoi.movie[i].name,'</span>                            <span class="span2 gray">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.movie[i].type?"":panoPoi.movie[i].type,'</span>                            <span class="span3 orange">¥',"undefined"==typeof panoPoi.movie[i].price?"":panoPoi.movie[i].price,'起</span>                            <span class="span3">                                <a href="javascript:void(0);" class="movie_book_btn" data-action="bookMovie" data-mid="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.movie[i].id?"":panoPoi.movie[i].id,'" target="_blank">在线订座</a>                            </span>                        </li>                    ');_template_fun_array.push('                </ul>                <div class="clearfix">                    <a href="javascript:void(0)" class="book_link" target="_blank" data-action="moreMovie">更多电影>></a>                </div>            </div>        ')}if(_template_fun_array.push("        "),panoPoi.hotel){_template_fun_array.push('            <div class="content_line"></div>            <div class="pano_hotel_info">                <ul class="hotel_book">                    ');for(var j=0;j<panoPoi.hotel.length;j++)_template_fun_array.push('                        <li class="clearfix">                            <span class="span1">',"undefined"==typeof panoPoi.hotel[j].roomTypeName?"":panoPoi.hotel[j].roomTypeName,'</span>                            <span class="span2 orange">¥',"undefined"==typeof panoPoi.hotel[j].price?"":panoPoi.hotel[j].price,'起</span>                            <span class="span3">                                <a href="javascript:void(0);" class="hotel_book_btn" target="_blank" data-action="bookHotel" data-rid="',"undefined"==typeof panoPoi.hotel[j].roomId?"":panoPoi.hotel[j].roomId,'">                                    预订>>                                </a>                            </span>                        </li>                    ');_template_fun_array.push('                </ul>                <div class="clearfix">                    <a class="book_link" href="javascript:void(0);" data-action="detail" target="_blank">更多房型和日期&gt;&gt;</a>                </div>            </div>        ')}_template_fun_array.push("        "),panoPoi.pano&&panoPoi.pano.iid&&_template_fun_array.push('            <div class="bottom_line"></div>            <div class="pano_poi_footer">                <ul>                    <li data-action="indoor" data-iid="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.pano.iid?"":panoPoi.pano.iid,'">                        <a data-action="indoor" data-iid="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoi.pano.iid?"":panoPoi.pano.iid,'" href="javascript:void(0);" class="indoor_view"><span as-parent="1" class="detail_indoor_view_icon"></span>进入内景</a>                    </li>                </ul>            </div>        '),_template_fun_array.push("    </div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],POI_LIST_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_popup"><div class="pano_poi_list_content"><ul>');for(var i=0,len=panoPoiList.content.length;len>i;i++)_template_fun_array.push('<li data-action="goToPoi" data-index="',"undefined"==typeof i?"":i,'" class="list_item clearfix"><a class="list_item_bg"></a>'),0!=i&&_template_fun_array.push('<div class="list_item_line"></div>'),_template_fun_array.push('<a href="javascript:void(0);" class="list_item_icon"><span class="no_',"undefined"==typeof(i+1)?"":i+1,'"></span></a><div class="list_item_content"><h4 class="pano_poi_name">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoiList.content[i].poi.name?"":panoPoiList.content[i].poi.name,'</h4><ul class="pano_poi_detail">'),panoPoiList.content[i].poi.addr&&_template_fun_array.push('<li class="clearfix pano_poi_addr"><span class="pano_info_name">地址：</span><span class="pano_info_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoiList.content[i].poi.addr?"":panoPoiList.content[i].poi.addr,"</span></li>"),_template_fun_array.push(""),panoPoiList.content[i].poi.tel&&_template_fun_array.push('<li class="clearfix pano_poi_tel"><span class="pano_info_name">电话：</span><span class="pano_info_cont">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==typeof panoPoiList.content[i].poi.tel?"":panoPoiList.content[i].poi.tel,"</span></li>"),_template_fun_array.push('</ul><div class="pano_entrance">'),panoPoiList.content[i].poi.hasIndoor&&_template_fun_array.push('<a data-action="showIndoor" data-index="',"undefined"==typeof i?"":i,'" href="javascript:void(0);" class="indoor_view_icon"></a><span class="pano_entrance_split_line"></span>'),_template_fun_array.push(""),panoPoiList.content[i].poi.sid&&_template_fun_array.push('<span class="street_view_icon"></span>'),_template_fun_array.push("</div></div></li>");if(_template_fun_array.push("</ul></div>"),panoPoiList.pageInfo){_template_fun_array.push('<div class="pano_poi_list_page"><p>'),panoPoiList.pageInfo.hasHome&&_template_fun_array.push('<span class="home"><a data-action="home_page" href="javascript:void(0);">首页</a></span>'),_template_fun_array.push(""),panoPoiList.pageInfo.hasPrev&&_template_fun_array.push('<span class="pre"><a data-action="prev_page" href="javascript:void(0);">&lt;上一页</a></span>'),_template_fun_array.push("");for(var i=0,len=panoPoiList.pageInfo.text.length;len>i;i++)_template_fun_array.push(""),panoPoiList.pageInfo.text[i]==panoPoiList.pageInfo.index?_template_fun_array.push(' <span class="curPage">',"undefined"==typeof panoPoiList.pageInfo.text[i]?"":panoPoiList.pageInfo.text[i],"</span>"):_template_fun_array.push('<span><a data-action="pn" href="javascript:void(0);">',"undefined"==typeof panoPoiList.pageInfo.text[i]?"":panoPoiList.pageInfo.text[i],"</a></span>"),_template_fun_array.push("");_template_fun_array.push(""),panoPoiList.pageInfo.hasNext&&_template_fun_array.push('<span class="next"><a data-action="next_page" href="javascript:void(0);">下一页&gt;</a></span>'),_template_fun_array.push("</p></div>")}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],BUSLINE_TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_popup"><div class="pano_poi_list_content"><ul>');for(var i=0,len=poiList.length;len>i;i++)_template_fun_array.push('<li data-action="goToBusStation" data-index="',"undefined"==typeof i?"":i,'" class="list_item busline_station clearfix"><a class="list_item_bg"></a>'),0!=i&&_template_fun_array.push('<div class="list_item_line"></div>'),_template_fun_array.push('<div class="list_item_content"><h4 class="pano_poi_name">',"undefined"==typeof poiList[i].stationName?"":poiList[i].stationName,'</h4><div class="pano_entrance">'),poiList[i].pano&&poiList[i].pano.pid&&_template_fun_array.push('<span class="street_view_icon"></span>'),_template_fun_array.push("</div></div></li>");_template_fun_array.push("</ul></div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],VIEW_HEADER=59,VIEW_FOOTER=150,CONTEN_PADDING=12,BUFFER=32,fitForIndex=function(i,o,a,t,e){var n=t;if(o>=n&&n+e>=a)return void 0;if(n>o)return o;if(a>n+e){var p=o-(e-(a-o));return p}},getPanelMaxHeight=function(){var i=document.body.offsetHeight-VIEW_HEADER-VIEW_FOOTER-CONTEN_PADDING-BUFFER;return Math.max(i,50)},gotoDetailPage=function(i){var o=i.getAttribute("data-action");if(!o){var a=i.getAttribute("as-parent");if(!a)return;i=i.parentNode,o=i.getAttribute("data-action")}var t=this._data.poi;switch(o){case"indoor":var e=i.getAttribute("data-iid");this.dispatchEvent("pano_changed",{data:{source:"PoiInfoPanelModule",panoIId:e}}),addStat(STAT_CODE.STAT_PANORAMA,{item:"poidetail-indoorview-click"});break;case"detail":3===t.poi.poi_type?util.showDetail(t.poi.uid,t.poi.poi_type,t.poi.city,"",""):util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,"Page");break;case"bookMovie":var n=i.getAttribute("data-mid");util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,"movie_book","",n),addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookmovie-click",type:"street"});break;case"moreMovie":util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,"movie_more");break;case"bookHotel":var p=i.getAttribute("data-rid"),s="";p&&(s=baidu.url.jsonToQuery({roomId:p})),util.showDetail(t.poi.uid,0,t.poi.city,t.poi.src,t.poi.src,"",s),addStat(STAT_CODE.STAT_PANORAMA,{item:"streetview-bookhotel-click",type:"street"})}},listPanelAction=function(i,o){for(var a=(this._data.poi,this._data.list.content),t=this._data.list.pageInfo,e=!1;!e&&i&&i!==o;){var n=i.getAttribute("data-action");switch(n){case"goToPoi":case"goToBusStation":var p=i.getAttribute("data-index"),s=a[p];this.setSelect(p);var r=this;s.extend(PanoPoi.TYPE.pano).then(function(){s.pano.belonging?r.dispatchEvent("inter_poi_changed",{data:{source:"PoiInfoPanelModule",panoId:s.pano.pid,uid:s.poi.uid,pid:s.pano.pid,poiType:2,panoHeading:s.pano.dir,panoPitch:s.pano.pitch,x:s.pano.x,y:s.pano.y,panoX:s.pano.panox,panoY:s.pano.panoy}}):r.dispatchEvent("animate_pano_changed",{data:{source:"PoiInfoPanelModule",panoId:s.pano.pid,uid:s.poi.uid,pid:s.pano.pid,poiType:2,panoHeading:s.pano.dir,panoPitch:s.pano.pitch,x:s.pano.x,y:s.pano.y,panoX:s.pano.panox,panoY:s.pano.panoy}}),r.foldList(),setTimeout(function(){r.dispatchEvent("hide_position")},100)});break;case"showIndoor":var p=i.getAttribute("data-index"),s=a[p],r=this;s.extend(PanoPoi.TYPE.pano).then(function(){r.dispatchEvent("pano_changed",{data:{source:"PoiInfoPanelModule",panoIId:s.pano.iid}})}),e=!0,addStat(STAT_CODE.STAT_PANORAMA,{item:"poilist-indoorview-click"});break;case"pn":var l=parseInt(i.innerHTML);l--,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0;break;case"home_page":l=0,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0;break;case"prev_page":var l=t.index-1;l--,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0;break;case"next_page":var l=t.index-1;l++,this.updatePoiListInfo({pn:l,nn:l*t.pageSize}),e=!0}i=i.parentNode}},PoiInfoPanelModule=ModuleClass.extend("PoiInfoPanelModule",{initialize:function(i,o,a,t,e,n,p){try{this._busLineCityCode=n,this._busLineUid=e,this._panoContext=o,this._data={poi:void 0,list:void 0,listUrl:void 0},this._saveData={poi:void 0,list:void 0,listUrl:void 0},this.parentDom=parentDom=document.createElement("div");var s=document.createElement("div"),r=this.listButton=document.createElement("div");r.className="list-title-bar",s.appendChild(r);var l=this.infoButton=document.createElement("div");l.className="info-title-bar",s.appendChild(l);var _=document.createElement("div"),d=this.infoPanel=new FoldPanelComponent(l,_,{align:"right"});d.setPosition(103,VIEW_HEADER);var c=this.listPanel=new FoldPanelComponent(r,_,{align:"left"});c.setPosition(103,VIEW_HEADER),parentDom.appendChild(s),parentDom.appendChild(_),i.appendChild(parentDom),t||this.hide();var u=this;T.on(r,"mouseenter",function(){d.fold(!0)}),T.on(l,"mouseenter",function(){c.fold(!0);var i=u._data.poi;if(i){var o=i.poi?i.poi.x:i.pano.x,a=i.poi?i.poi.y:i.pano.y;u.dispatchEvent("show_position",{data:{x:o,y:a}})}}),T.on(l,"mouseleave",function(){u.dispatchEvent("hide_position")}),d.addEventListener("click",function(i){gotoDetailPage.call(u,i.target,_),i.preventDefault()}),c.addEventListener("click",function(i){listPanelAction.call(u,i.target,_)});var h={},m=function(i,o){return o?(f&&h[o]&&clearTimeout(h[o]),void(h[o]=setTimeout(function(){o!==f&&T(i).removeClass("list_item_hover")},5))):void T(i).removeClass("list_item_hover")};c.addEventListener("mouseout",function(i){for(var o=i.target;o&&o!==_;){var a=o.getAttribute("data-action");if("showIndoor"===a&&T(o).removeClass("indoor_view_icon_hover"),"goToPoi"===a||"goToBusStation"===a){m(o,f),f=void 0;break}o=o.parentNode}});var f=void 0;c.addEventListener("mouseover",function(i){for(var o=i.target,a=!1;o&&o!==_;){var t=o.getAttribute("data-action");if("showIndoor"===t&&(T(o).addClass("indoor_view_icon_hover"),a=!0),"goToPoi"===t||"goToBusStation"===t){var e=o.getAttribute("data-index");if(e!==f){var n=u._data.list.content[e];n.extend(PanoPoi.TYPE.poi).then(function(){u.dispatchEvent("show_position",{data:{x:n.poi.x,y:n.poi.y}})}),f=e}T(o).hasClass("list_item_hover")||T(o).addClass("list_item_hover");var p=o.offsetTop,s=fitForIndex(e,p,p+o.clientHeight,this.getScrollValue(),this.getViewSize().height);void 0!==s&&this.scrollTo(s),a&&T(o).removeClass("list_item_hover");break}o=o.parentNode}}),c.addEventListener("mouseleave",function(){f=void 0,u.dispatchEvent("hide_position")});var v=void 0,g=!1,x=!1,b=!1,P=function(){clearTimeout(v),setTimeout(function(){var i=g||x;i!==b&&(b=i,u.dispatchEvent("status_changed",{isExpand:b}))},200)};if(c.addEventListener("before_expand",function(){g=!0,P()}),d.addEventListener("before_expand",function(){x=!0,P()}),c.addEventListener("before_fold",function(){g=!1,P()}),d.addEventListener("before_fold",function(){x=!1,P()}),this.$shareParam){var w=this.$shareParam.uid,y=(this.$shareParam.url,this._panoContext.getMarkerUidInBestPano());this.$shareParam.busLineUid&&(this._busLineUid=this.$shareParam.busLineUid),y?this.setData(y,!0,!0,y,null,!0):this.setData(w,!0,!0)}else a&&t&&this.setData(a,!0,!0,a,p,!0)}catch(k){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/exception.fire","catch",{msg:k.message||k.description,path:"common:widget/pano/module/PoiInfoPanelModule/PoiInfoPanelModule.js",ln:505})}},foldAllPanel:function(){return this.foldDetail().foldList(),this},foldDetail:function(){return this.infoPanel.fold(),this},expandDetail:function(i){this.infoPanel.expand(i)},foldList:function(){return this.listPanel.fold(),this},freeze:function(){return this.infoPanel.ignoreMouseEvent(!0),this.listPanel.ignoreMouseEvent(!0),this},unfreeze:function(){return this.infoPanel.ignoreMouseEvent(!1),this.listPanel.ignoreMouseEvent(!1),this},setData:function(i,o,a,t,e){var n,p,s=i instanceof PanoPoi?i:new PanoPoi(i);void 0===e&&(e=!0),o&&(n=this._busLineUid?this.updateBusLineListInfo(this._busLineUid,this._busLineCityCode):this.updatePoiListInfo()),p=this.updatePoiDetailInfo(s);var r=[];p&&r.push(p),n&&r.push(n);var l=T.when.apply(T,r),_=this;return l.then(function(){if(_._data.list){var o="";o=_._data.list.buslineName?'<a class="list_title_text busline_title_icon" href="javascript:void(0);">'+_._data.list.buslineName+'</a><div class="v-line"></div>':'<a class="list_title_text" href="javascript:void(0);">列表</a><div class="v-line"></div>',_.listPanel.setTitle(o)}else _.infoButton.className="info-title-bar-nolist",_.infoPanel.setAlign("top");var n=document.createElement("p");if(n.innerHTML='<i class="poi_default_icon"></i>'+s.poi.name,n.className="poi_title_text",_.infoPanel.setTitle(n),s.getUid()===t&&_.savePoiInfo(),_.unfreeze(),_.listPanel.fold(!0),e&&_.infoPanel.expand(2500),a&&_._data.list){var p=void 0;util.each(_._data.list.content,function(o,a){return o.getUid()===i?(p=a,!0):void 0})}})},updatePoiDetailInfo:function(i){var o=this;this._data.poi=i;var a=i.extend(PanoPoi.TYPE.pano,PanoPoi.TYPE.poi).then(function(){return"hotel"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==i.poi.src?i.extend(PanoPoi.TYPE.hotel):"life"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PoiInfoPanelModule/==i.poi.src?i.extend(PanoPoi.TYPE.movie):void 0});return a.then(function(){var a=POI_DETAIL_TEMPLATE({panoPoi:i});o.infoPanel.setContent(a,getPanelMaxHeight()),o.infoPanel.fold(!0),o.dispatchEvent("poi_change",{uid:i.getUid(),x:i.pano.x,y:i.pano.y})})},setDetailContent:function(i,o){if(i){var a=document.createElement("p");a.innerHTML='<i class="poi_default_icon"></i>'+i,a.className="poi_title_text",this.infoPanel.setTitle(a)}var t=POI_DETAIL_TEMPLATE({panoPoi:o});this.infoPanel.setContent(t,getPanelMaxHeight())},restorePoiInfo:function(){function i(i){for(var o=0,a=i.length;a>o;o++)for(var t in PanoPoi.prototype)i[o][t]=PanoPoi.prototype[t]}this._data=baidu.object.clone(this._saveData),this._data&&this._data.poi&&i([this._data.poi]),this._data&&this._data.list&&this._data.list.content&&i(this._data.list.content),this.infoPanel.restore(),this._data.poi||!this._data.list||this._data.list.content||this.hide()},savePoiInfo:function(){this._saveData=baidu.object.clone(this._data),this._saveData||(this._saveData={poi:void 0,list:void 0,listUrl:void 0}),this.infoPanel.save()},updatePoiListInfo:function(i,o){var a=this,t=o?util.getSearchResultFromUrl(i):util.getSearchResultFromPCMap(i);if(!t)return null;var e=t.then(function(i,o){if(i.content&&!(i.content.length<=1)){var t=PanoPoi.initWithPoiSearchResult(i);a._data.list=t,a._data.listUrl=o;var e=POI_LIST_TEMPLATE({panoPoiList:t});a.listPanel.setContent(e,getPanelMaxHeight())}});return e},updateBusLineListInfo:function(i,o){var a=new PanoPoi(i,o),t=this,e=a.extend(PanoPoi.TYPE.busline).then(function(){var i=PanoPoi.initWithBuslineResult(a.busline);t._data.list=i;var o=BUSLINE_TEMPLATE({poiList:i.content}),e=a.busline.buslineFullName.split("(")[1].split(")")[0],n='<p class="pano_popup_title">'+a.busline.buslineName+"(<span>"+e+"</span>)</p>";t.listPanel.setContentHeader(n),t.listPanel.setContent(o,getPanelMaxHeight())});return e},setSelect:function(i){if(this._data.list){var o=this._data.list.content[i];if(o){var a=this;PanoPoi.prototype.extend.call(o,PanoPoi.TYPE.poi,PanoPoi.TYPE.pano).then(function(){panoPoiIndex=void 0!==o.pano.index?o.pano.index:i;var t={poiuid:o.poi.uid,pid:o.pano.pid,panoIId:o.pano.iid,name:o.poi.name,poiType:o.pano.belonging?"interPoi":"poi",index:panoPoiIndex,heading:o.pano.dir,pitch:o.pano.pitch,x:o.pano.x,y:o.pano.y,px:o.pano.panox,py:o.pano.panoy,rank:o.pano.rank||100,catalog:o.pano.catalog};a._removePoiSearchMarker(),a._addPoiSearchMarker([t])})}}},_addPoiSearchMarker:function(i){var o=this;o._markerIds=[],util.each(i,function(i){i.markerId=util.getUniqueId("MARKER_"),o._markerIds.push(i.markerId)}),this.dispatchEvent("add_markers",i),this.dispatchEvent("poi_search_marker_changed",i)},_removePoiSearchMarker:function(){this._markerIds&&this._markerIds.length&&(this.dispatchEvent("remove_markers",this._markerIds),this._markerIds=null)},show:function(){return this.parentDom.style.visibility="visible",this
},hide:function(){return this.parentDom.style.visibility="hidden",this},getShareParam:function(){if(!this._data.poi)return null;var i=this._panoContext.getPanoOptions(),o=i.panoId,a=this._data.poi.pano.pid;if(o!==a)return null;var t=this._data.poi.getUid(),e={uid:t};return this._busLineUid&&(e.busLineUid=this._busLineUid),e},getDetailPanoPoi:function(){return this._data.poi},dispose:function(){this.infoPanel.dispose(),this._busLineUid=void 0,this._busLineCityCode=void 0;var i=this.parentDom;i.innerHTML="",i.parentNode.removeChild(i)},getSupportEvents:function(){return["pano_changed","animate_pano_changed","show_position","hide_position","poi_search_marker_changed","remove_markers","add_markers","status_changed","inter_poi_changed","add_search_marker","poi_change"]}});module.exports=PoiInfoPanelModule});