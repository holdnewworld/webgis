define("common:widget/pano/module/PanoCityPageModule/PanoCityPageModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),service=require("common:widget/pano/base/service.js"),pcConfig=require("common:widget/ui/config/config.js"),ScrollView=require("common:widget/pano/component/ScrollView/ScrollView.js"),util=require("common:widget/pano/base/util.js"),PanoInterface=require("common:widget/pano/PanoInterface/PanoInterface.js");require.loadCss({content:'.pano_city_page_layer{position:absolute;left:0;top:0;width:100%;height:100%;z-index:10001;font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif;font-size:12px;display:none}.pano_city_page_layer a,.pano_city_page_layer a:hover{color:gray;text-decoration:none}.pano_city_page_layer a:hover{text-decoration:underline}.pano_city_page_close_btn{position:absolute;right:0;_right:-1px;top:0;display:inline-block;width:35px;height:35px;border-left:1px solid #f2f2f2;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/pano_whole/close_btn_07bbb31.gif) no-repeat 10px 10px}.pano_city_page_close_btn:hover{background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/close_btn_hover_bc0bd92.gif);background-color:#5098da}.pano_city_page_mask{position:relative;left:0;top:0;width:100%;height:100%;background-color:#000;filter:alpha(opacity=20);opacity:.2;z-index:0}.pano_city_page_pop{position:absolute;left:50%;top:50%;width:675px;margin-left:-337px;margin-top:-243px;overflow:hidden;z-index:1;border:1px solid gray;background-color:#fafafa}.pano_city_page_header,.pano_city_page_footer{height:35px;line-height:35px;text-align:center;color:#333;font-size:15px;border-bottom:1px solid #f2f2f2}.pano_city_page_footer{position:absolute;bottom:0;left:0;width:100%;line-height:28px;border-bottom:0;border-top:1px solid #f2f2f2}.pano_city_page_footer a,.pano_city_page_footer a:hover,.pano_city_page_footer span{font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif;font-size:12px;color:#999}.pano_city_page_content_wrapper{padding:10px 20px 15px}.pano_ad_banner{margin-bottom:15px;width:635px;height:60px}.pano_scroll_content{position:relative}.pano_scroll_content div{overflow:hidden;width:635px}.pano_city_page_image_list{width:650px}.pano_city_page_image_list li{float:left;margin:0 10px 10px 0}.pano_city_page_image_list li a{padding:3px;height:80px;cursor:pointer;text-decoration:none;position:relative;border:1px solid #E6E6E6;display:inline-block}.pano_city_page_image_list li a:hover{border-color:#000}.pano_city_page_image_list .name{text-indent:10px;width:140px;height:20px;background-color:#000;opacity:.7;filter:alpha(opacity=70);overflow:hidden;position:absolute;bottom:3px;left:3px;font-size:12px;color:#fff;overflow:hidden;line-height:20px}.city_reco_title{font-size:13px;line-height:13px;color:#4c73c2;margin-bottom:12px}.pano_city_page_image_list .pano_new{display:block;position:absolute;top:-1px;right:-2px;width:45px;height:45px;padding:0;margin:0;z-index:200;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/pano_theme_c4dbfa7.png) no-repeat 0 0;_background-image:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/panorama/pano_theme_8_20ed703.png)}.pano_city_page_image_list .pano_beta{display:block;position:absolute;top:-2px;right:-2px;width:45px;height:45px;padding:0;margin:0;z-index:200;background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/pano_beta_b049dea.png);_background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/pano_beta_8_073575f.png)}.city_link_list{width:650px}.city_link_list li{float:left;margin:0 20px 8px 0}.city_link_list li a,.city_link_list li a:hover{color:#666;white-space:nowrap}.city_detail_reco_type{width:640px;margin:12px 0;text-align:center;border-left:1px solid #ededed}.city_detail_reco_type p .selected,.city_detail_reco_type p .selected:hover{background-color:#278DF2;color:#fff}.city_detail_reco_type p a{float:left;border-top:1px solid #ededed;border-right:1px solid #ededed;border-bottom:1px solid #ededed;background-color:#F3F3F3;display:inline-block;width:158px;line-height:28px;text-align:center;color:#333}.pano_scroll_content .more_link p{float:right;_display:inline;margin-right:20px;white-space:nowrap;font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif;color:#4c73c2}.pano_city_page_text_list .city_link_list{display:none}.pano_city_page_text_list.show_more .city_link_list{margin-top:8px;display:block}.pano_city_page_text_list .more_icon{display:inline-block;width:14px;height:10px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/more_arrow_down_e08bab2.gif) no-repeat 4px 4px}.pano_city_page_text_list.show_more .more_icon{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_whole/more_arrow_up_61f2cb8.gif) no-repeat 4px 4px}'});var PanoCityPageWrapperTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_city_page_layer">    <div class="pano_city_page_mask"></div>    <div class="pano_city_page_pop">        <a href="javascript:void(0);" class="pano_city_page_close_btn" title="关闭"></a>        <div class="pano_city_page_header">            百度全景        </div>        <div class="pano_city_page_content_wrapper">        </div>        <div class="pano_city_page_footer">            <a href="http://quanjing.baidu.com/" target="_blank">全景官网</a>            <span>|</span>            <a href="http://nlbc.baidu.com/lbs-lbc/?from=mappano" target="_blank">商户全景上传</a>            <span>|</span>            <a href="http://developer.baidu.com/map/jshome.htm" target="_blank">全景API</a>            <span>|</span>            <a id="pano-ugc-upload" href="http://pai.baidu.com/?from=pcmap" target="_blank">用户全景上传</a>        </div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],CityRecoPageTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<div>    "),data.ad&&data.ad.name&&_template_fun_array.push('        <div class="pano_ad_banner">            <a href="',"undefined"==typeof data.ad.linkUrl?"":data.ad.linkUrl,'" target="_blank" class="recom_ad">                <img src="',"undefined"==typeof data.ad.imageUrl?"":data.ad.imageUrl,'" alt="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/==typeof data.ad.name?"":data.ad.name,'"  width="635" height="60" />            </a>        </div>    '),_template_fun_array.push('    <p class="city_reco_title">推荐城市</p>    <div class="pano_scroll_content">        <div class="pano_scroll_wrapper">            <ul class="pano_city_page_image_list clearfix">                ');for(var i=0;i<data.reco.length;i++)_template_fun_array.push('                    <li data-action="showPano" data-pid="',"undefined"==typeof data.reco[i].pano.panoId?"":data.reco[i].pano.panoId,'">                        <a href="javascript:void(0);">                            <img width="140px" height="80px" src="',"undefined"==typeof data.reco[i].imageUrl?"":data.reco[i].imageUrl,'">                            <p class="name">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/==typeof data.reco[i].name?"":data.reco[i].name,"</p>                             "),1==data.reco[i].isNew&&1!=data.reco[i].isBeta&&_template_fun_array.push('                                <span class="pano_new"></span>                            '),_template_fun_array.push("                            "),1==data.reco[i].isBeta&&_template_fun_array.push('                                <span class="pano_beta"></span>                            '),_template_fun_array.push("                        </a>                    </li>                ");_template_fun_array.push("            </ul>        </div>    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],CityDetailPageTemplate=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<div>    "),data.ad&&data.ad.name&&_template_fun_array.push('        <div class="pano_ad_banner">            <a href="',"undefined"==typeof data.ad.linkUrl?"":data.ad.linkUrl,'" target="_blank" class="recom_ad">                <img src="',"undefined"==typeof data.ad.imageUrl?"":data.ad.imageUrl,'" alt="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/==typeof data.ad.name?"":data.ad.name,'"  width="635" height="60" />            </a>        </div>    '),_template_fun_array.push('    <div>         <p class="city_reco_title">推荐城市</p>        <ul class="city_link_list clearfix">            ');for(var recoCityList=data.reco[0].textThemes,i=0,len=recoCityList.length;len>i;i++)_template_fun_array.push('                <li data-action="showPano" data-pid="',"undefined"==typeof recoCityList[i].pano.panoId?"":recoCityList[i].pano.panoId,'"><a href="javascript:void(0);">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/==typeof recoCityList[i].name?"":recoCityList[i].name,"</a></li>            ");_template_fun_array.push("        </ul>    </div>    ");var selectedTheme=data.selectedThemeIndex||1,themeData=data.reco[selectedTheme];if(_template_fun_array.push("    <div>        "),data.reco.length>2){for(_template_fun_array.push('            <div class="city_detail_reco_type ">                <p class="clearfix">                    '),i=1,len=data.reco.length;len>i;i++)_template_fun_array.push("                        "),selectedTheme==i?(_template_fun_array.push("                            <a "),selectedTheme==i&&_template_fun_array.push(' class="selected" '),_template_fun_array.push(' href="javascript:void(0);">                         ')):_template_fun_array.push('                            <a data-action="selectTheme" data-themeIndex="',"undefined"==typeof i?"":i,'" href="javascript:void(0);">                        '),_template_fun_array.push("                                ","undefined"==typeof data.reco[i].themeName?"":data.reco[i].themeName,"                            </a>                    ");_template_fun_array.push("                </p>            </div>        ")}for(_template_fun_array.push('        <div class="pano_scroll_content">            <div class="pano_scroll_wrapper">                <ul class="pano_city_page_image_list clearfix">                    '),i=0,len=themeData.pictureThemes.length;len>i;i++)_template_fun_array.push('                        <li data-action="showPano" data-pid="',"undefined"==typeof themeData.pictureThemes[i].pano.panoId?"":themeData.pictureThemes[i].pano.panoId,'">                            <a href="javascript:void(0);return false;">                                <img width="140px" height="80px" src="',"undefined"==typeof themeData.pictureThemes[i].imageURL?"":themeData.pictureThemes[i].imageURL,'">                                <p class="name">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/==typeof themeData.pictureThemes[i].name?"":themeData.pictureThemes[i].name,"</p>                             </a>                        </li>                    ");if(_template_fun_array.push('                </ul>                                <div class="pano_city_page_text_list" data-action="showMore">                    '),themeData.textThemes.length>0){for(_template_fun_array.push('                        <div class="more_link clearfix">                            <p><a href="javascript:void(0);">更多</a><a class="more_icon"></a></p>                        </div>                        <ul class="city_link_list clearfix">                            '),i=0,len=themeData.textThemes.length;len>i;i++)_template_fun_array.push('                                <li data-action="showPano" data-pid="',"undefined"==typeof themeData.textThemes[i].pano.panoId?"":themeData.textThemes[i].pano.panoId,'"><a>',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/==typeof themeData.textThemes[i].name?"":themeData.textThemes[i].name,"</a></li>                               ");_template_fun_array.push("                        </ul>                    ")}_template_fun_array.push("                </div>            </div>        </div>    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],MAX_CONTENT_HEIGHT=415,CONTENT_HEADER_FOOTER_HEIGHT=95,PanoCityPageModule=ModuleClass.extend("PanoCityPageModule",{initialize:function(e,a){try{this._cityCode=e,this._cityName=a,this._scrollView=null,this._panos=null,this._container=null,this._popContainer=null,this._popContentDom=null,this._scrollContentDom=null,this._closeBtn=null,this._render(e,a),this._bindEvents()}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/pano/module/PanoCityPageModule/PanoCityPageModule.js",ln:36})}},_bindEvents:function(){var e=this;T.on(this._popContainer,"click",function(a){for(var t,i,o,n,p=a.target;p&&p!==this;){if(t=p.getAttribute("data-action"),i=p.getAttribute("data-pid"),"showPano"===t&&i&&(n=e.getPanoDataFromPid(i),n&&PanoInterface.showPano(n),e.dispose(),T.event.preventDefault(a)),"showMore"===t){if(T(p).toggleClass("show_more"),e._scrollView){e._scrollView.update();var r=e._scrollView._scrollPanel.getScrollBar("y");if(r&&r.getSize()){var _=r.getSize().height;e._scrollView.scrollTo(_)}}T.event.preventDefault(a)}"selectTheme"===t&&(o=p.getAttribute("data-themeIndex"),e._cityPageData.selectedThemeIndex=o,e._renderContent(e._cityPageData,e._popContentDom),T.event.preventDefault(a)),p=p.parentNode}}),T.on(this._closeBtn,"click",function(){e.dispose()}),T.on("pano-ugc-upload","click",function(){addStat(STAT_CODE.STAT_PANORAMA,{item:"pano-ugc-entrance-click"})})},_render:function(e,a){try{var t=PanoCityPageWrapperTemplate({cityName:a||"百度全景"}),i=T(t);this._container=i[0],this._popContainer=i.find(".pano_city_page_pop")[0],this._closeBtn=i.find(".pano_city_page_close_btn")[0],this._popContentDom=i.find(".pano_city_page_content_wrapper")[0],document.body.appendChild(this._container);var o=this,n=service.getPanoCityPageData(e);n.then(function(e){for(var a=0;a<e.reco.length;a++){var t=e.reco[a];t.pictureThemes&&0==t.pictureThemes.length&&t.textThemes&&0==t.textThemes.length&&e.reco.splice(a,1)}o._savePanos(e),o._cityPageData=e,o._cityPageData.type=e.reco[0].themeName?"detail":"list",o._renderContent(o._cityPageData,o._popContentDom)})}catch(p){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/exception.fire","catch",{msg:p.message||p.description,path:"common:widget/pano/module/PanoCityPageModule/PanoCityPageModule.js",ln:133})}},_savePanos:function(e){function a(e){var a=[];if(!e)return a;for(var t in e)e[t]&&e[t].pano&&a.push(e[t].pano);return a}var t=e.reco;if(t){this._panos=[];var i=[];for(var o in t)t[o].themeName&&(i=i.concat(t[o].textThemes,t[o].pictureThemes));0==i.length&&(i=t),this._panos=a(i)}},getPanoDataFromPid:function(e){var a=this._panos;for(var t in a)if(a[t].panoId==e)return a[t]},_renderContent:function(e,a){function t(e){var a,t,o;a=util.getDomSize(e).height,a>MAX_CONTENT_HEIGHT&&(o=a-MAX_CONTENT_HEIGHT),i._scrollContentDom=T(e).find(".pano_scroll_content")[0],t=util.getDomSize(i._scrollContentDom).height,o?(i._scrollContentDom.style.height=t-o+"px",i._popContainer.style.height=MAX_CONTENT_HEIGHT+CONTENT_HEADER_FOOTER_HEIGHT+"px",i._popContainer.style.marginTop=-(MAX_CONTENT_HEIGHT+CONTENT_HEADER_FOOTER_HEIGHT)/2+"px"):(i._scrollContentDom.style.height=t+"px",i._popContainer.style.height=a+CONTENT_HEADER_FOOTER_HEIGHT+"px",i._popContainer.style.marginTop=-(a+CONTENT_HEADER_FOOTER_HEIGHT)/2+"px"),i._scrollView=new ScrollView(i._scrollContentDom,{overflow:"overflow-y",autoUpdate:!1})}try{var i=this,o="detail"http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/===e.type?CityDetailPageTemplate({data:e}):CityRecoPageTemplate({data:e}),n=T(o)[0];a.innerHTML="",a.appendChild(n),this._container.style.display="block",t(n,a);var i=this}catch(p){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoCityPageModule/exception.fire","catch",{msg:p.message||p.description,path:"common:widget/pano/module/PanoCityPageModule/PanoCityPageModule.js",ln:248})}},dispose:function(){this._panos=null,this._scrollView=null,this._cityName=void 0,this._cityCode=void 0,this._container&&(document.body.removeChild(this._container),this._container=null,this._popContainer=null,this._popContentDom=null)}});module.exports=PanoCityPageModule});