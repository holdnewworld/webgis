define("common:widget/pano/base/service.js",function(t,e,n){function a(t,e,n,a){if(e){var o=arguments.length;3==o&&(a=n,n=null);var r=new T.Deferred;e.t=(new Date).getTime();var i=[];for(var u in e)void 0!==e[u]&&i.push(u+"="+e[u]);i=i.join("&");var c=t+i,l=function(t){n&&n(t),r.resolve(t)};return baidu.jsonp(c,l,{cbtype:a?a:"fn"}),r}}var o=t("common:widget/ui/config/config.js"),r=t("common:widget/pano/base/util.js"),i=t("common:widget/pano/base/CatalogMap.js"),u=o.mapVersion,c=o.urlConfig,l=function(){var t=null,e=function(t){var e=t.getFullYear(),n=t.getMonth()+1,a=t.getDate();return n=10>n?"0"+n:n,a=10>a?"0"+a:a,[e,n,a].join("-")};return function(){if(!t){t={};var n=new Date,a=new Date;a.setDate(n.getDate()+2);var o=new Date;o.setDate(n.getDate()+3),t.start=e(a),t.end=e(o)}return t}}(),s=u.UDT_VERSION||"20140317",f=c.PANO_URL+"?udt="+s+"&",p=c.PANO_URL+"?qt=guide&",d="/?",g=c.PANO_PHPUI_URL+"/?",v="/detail?",h=c.PANO_URL+"?qt=search&",y={getPanoInfoByUid:function(t,e){var n=a(f,{qt:"poi",uid:t});return e?n.then(function(t){e(t)}):n},getPanoPoiInfoByUid:function(t,e){var n=new T.Deferred;return a(d,{qt:"inf",uid:t},"callback").then(function(t){e&&e(t),n.resolve(t)}),n},getHotelInfoByUid:function(t,e){var n=l(),o=a(v,{qt:"ota",st:n.start,et:n.end,uid:t},"callback");return e?o.then(function(t){e(t)}):o},getMovieInfoByUid:function(t,e){var n=a(v,{qt:"timetable",uid:t,from:"pc",sfrom:"map",sflag:"bubble"},"callback");return e?n.then(function(t){e(t)}):n},getIndoorPoiInfoByUid:function(t){var e=new T.Deferred,n=0;return function o(){a(g,{qt:"poidetail",uid:t,t:(new Date).getTime()}).then(function(t){n++,0==t.result.error_type||200==t.result.error_type?e.resolve(t):2>n?o():e.resolve(t)})}(),e},getGuideData:function(t,e){function n(t){var e=[],n=[],a=[],o=null,r=!1,u=0,c=t.length;for(u=0,c=t.length;c>u;u++)if(t[u].Catalog){r=!0,o={exit:[],other:[]};break}for(var u=0,c=t.length;c>u;u++){var l=t[u];if(7!=l.Type||isPhotoTourSupported){var s={photoUrl:null,name:l.Info,type:l.Type,catalog:l.Catalog,data:{tourId:l.TourID,floor:l.Floor,panoId:l.PID,panoHeading:l.Dir,panoPitch:l.Pitch,type:l.Type,panoX:l.PanoX,panoY:l.PanoY,x:l.X,y:l.Y,uid:l.UID,rank:l.Height}};if(r)if(3===s.type)o.exit.push(s);else{var f=i.getCatalogInfo(s.catalog);o[f.id]||(o[f.id]=[]),o[f.id].push(s)}0===l.Type?n.push(s):8===l.Type?a.push(s):e.push(s)}}return{panoAllumData:e,topicData:a,panoTimelineData:n,catalogData:o}}var a=p+"sid="+t;baidu.jsonp(a,function(t){var a={},o=!0;t&&0==t.result.error&&t.content&&(a=n(t.content),o=!1),e({content:a.panoAllumData,topicData:a.topicData,panoTimelineData:a.panoTimelineData,catalogData:a.catalogData,error:o})},{cbtype:"fn"})},getStreetBriefByLocation:function(t,e){if(t.point&&"function"==typeof e){var n=t.point||{},a=t.level||15,o=t.mode||"day",r=f+baidu.url.jsonToQuery({qt:"qsdata",x:n.lng||n.x,y:n.lat||n.y,l:a,action:0,mode:o,t:(new Date).getTime()});baidu.jsonp(r,function(t){if(t&&t.result&&0==t.result.error&&t.content){var n=t.content,a=n.id,o=parseFloat(n.x/100),r=parseFloat(n.y/100),i=new BMap.Point(o,r);e({type:"brief",content:{id:a,point:i},error:0})}else e({error:1})},{cbtype:"fn"})}},getNavSearch:function(t){return a(d,t,null,"callback")},getNavSteps:function(t){return a(g+"qt=routeSteps&",t,null,"callback").then(function(t){var e=t.content.traffic_steps,n=r.each(t.content.steps,function(t,n){var a={rx:t.RX/100,ry:t.RY/100,x:t.X/100,y:t.Y/100,dir:t.dir,pid:t.pid},o=e[n];o||(o={end:[1],status:1}),a.instructions=r.clearTag(t.instructions);var i=0,u=r.each(o.end,function(t,e){var n=Math.ceil(100*t);return i+n>100&&(n=100-i),i+=n,{value:n,status:o.status[e]}},!0);return 100>i&&(u[u.length-1].value+=100-i),a.traffic=u,a},!0);return n[0].pid||(n=n.slice(1)),t.content.steps=n,delete t.content.traffic_steps,t})},getClassifySearchData:function(t,e,n,o){function i(t,e){if(!t||0===t.content.length)return null;var n=t.content;return r.each(n,function(t){return{poiuid:t.UID,pid:t.PID,panoIId:t.IID,poiType:"poi",catalog:e,name:t.name,rank:t.Height,heading:t.Dir,pitch:t.Pitch,x:t.X,y:t.Y,px:t.PanoX,py:t.PanoY,index:-1}},!0)}var u={0:"",1:"FE02",2:"FE01",3:"FE06",4:"FE0A",5:"FEFE"},c=a(h,{x:t,y:e,radius:200,tag:n},"fn");return o?c.then(function(t){t=i(t,u[n]),o(t)}):c},getComponentResultByQuery:function(t){var e="/?qt="+t,n=new T.Deferred;return T.ajax(e,{dataType:"json",success:function(t){return t&&t.result?void n.resolve(t,e):void n.resolve(null)},error:function(){n.resolve(null)}}),n},getPanoPoints:function(t,e){var n=t.join("|");e=e||"bus";var a="udt="+s+"&qt=batchdata&from="+e+"&key="+n,o=new T.Deferred;return baidu.ajax("/?qt=panobatch",{method:"post",dataType:"json",data:a,success:function(t){o.resolve(t)}}),o},getBuslineByUid:function(t,e){var n=a(d,{qt:"bsl",bsltp:"1",newmap:"1",uid:t,c:e,t:(new Date).getTime()},null,"callback"),o=this;return n.then(function(t){var e=t.content[0].stations,n=t.content[0].name,a=[],i="",u=null,c="";0==t.result.linetype||6==t.result.linetype?c="010A05":1==t.result.linetype&&(c="010A03");for(var l=0,s=e.length;s>l;l++)i=e[l].geo,i=i.split("|")[2].split(";")[0],a.push(i),u=i.split(","),e[l].point={x:u[0],y:u[1]};return o.getPanoPoints(a,"busline").then(function(t){return r.each(a,function(n,a){t.content[a]&&(e[a].pano=t.content[a])}),{buslineName:n,stations:e,catalog:c}})})},getPanoCityPageData:function(t){return a(d,{qt:"panoReco",code:t,t:(new Date).getTime()},null,"callback")},getSdataByPid:function(){var t={};return function(e){var n=new T.Deferred;return t[e]?n.resolve(t[e]):a(f,{qt:"sdata",pc:1,sid:e},null,"fn").then(function(a){a&&a.result||n.resolve(null);var o=a.content[0]||a.content,i=r.copy(o,!0);t[e]=i,n.resolve(i)}),n}}(),getIndoorData:function(t){var e=new T.Deferred;return a(f,{qt:"idata",iid:t},null,"fn").then(function(t){if(!t||!t.result)return null;var n=(t.content[0]||t.content).interinfo,a=r.copy(n,!0);e.resolve(a)}),e},getActivityPano:function(){return a(d,{qt:"panoActivity"},null,"callback")},getCopyRightData:function(){return a(d,{qt:"panoCMS",file:"pano_copyright"},null,"callback")},getTourGuideData:function(t){var e=new T.Deferred;if("d270a38b230b50fced74f8f7"==t)var n={Paths:[{tourId:"1",tourName:"太和殿",tourImage:"../../../../../../panofeedback/panoPhotoTour/1/scene.jpg"/*tpa=http://webmap1.map.bdstatic.com/panofeedback/panoPhotoTour/1/scene.jpg*/,X:12958111,Y:4826928},{tourId:"2",tourName:"御花园",tourImage:"../../../../../../panofeedback/panoPhotoTour/2/scene.jpg"/*tpa=http://webmap1.map.bdstatic.com/panofeedback/panoPhotoTour/2/scene.jpg*/,X:12958111,Y:4826928},{tourId:"3",tourName:"狮子",tourImage:"../../../../../../panofeedback/panoPhotoTour/3/scene.jpg"/*tpa=http://webmap1.map.bdstatic.com/panofeedback/panoPhotoTour/3/scene.jpg*/,X:12958111,Y:4826928}],defaultId:"1",name:"北京故宫 "};return e.resolve(n),e}};n.exports=y});