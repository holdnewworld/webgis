define("common:widget/pano/module/PanoExitMarker/PanoExitMarker.js",function(t,i,e){var o=t("common:widget/ui/util/util.js"),n=t("common:widget/ui/mapUtil/mapUtil.js"),a=t("common:widget/pano/PanoInterface/PanoInterface.js"),s=t("common:widget/ui/config/config.js"),p=t("common:widget/pano/base/ModuleClass.js"),r=s.modelConfig,d=p.extend("PanoExitMarker",{constructor:function(){this.isOpen=!1,this.showlabel=!0,this.point=null,this.panoId=null,this.panoType="",this.exitMkr=null,this.exitLbl=null,this.level=16,this.data={}},initialize:function(t,i,e){try{this.isOpen=!0,this.point=i,this.panoId=t.panoId,this.uid=t.uid,this.panoType=t.panoType,this.level=e,this.cityName=r.cityName,this.createMarker(this.point)}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoExitMarker/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoExitMarker/PanoExitMarker.js",ln:46})}},set:function(t,i){this.data[t]=i},get:function(t){return this.data[t]},createMarker:function(t){var i=baidu.browser.ie<7?"../../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_png8_d133824.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_png8_d133824.png*/:"../../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_c1d9c10.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_c1d9c10.png*/,e=new BMap.Icon(i,new BMap.Size(21,32),{imageOffset:new BMap.Size(-1,-42)});this.exitMkr=new BMap.Marker(t,{icon:e,offset:new BMap.Size(0,-2),title:"点击进入全景"}),map.addOverlay(this.exitMkr),this.exitMkr.setTop(!0,9999999);var o='<div style="line-height: 25px;height:25px;margin-right:10px;">刚才在这里</div><a href="javascript:void(0)" style="border: 0;position: absolute;height:10px;width: 10px;background: url(http://webmap1.map.bdstatic.com/newmap/static/common/images/moBtnClose_1eecca8.png) no-repeat 0px 0px;right: 7px;top: 7px;">';this.exitLbl=n.createNormalTip(o,{point:t,offset:new BMap.Size(-45,-59)}),this.exitLbl.setStyle({backgroundColor:"none",backgroundImage:"url("+i+")",backgroundRepeat:"no-repeat",backgroundPosition:" 0px 0px",height:"39px",width:"92px",border:"0",position:"absolute",left:"0px",top:"1px",zoom:1,zIndex:1e5,textAlign:"center"});var a=this;setTimeout(function(){map.addOverlay(a.exitLbl),map.zoomTo(a.level),map.panTo(t),map.getZoom()<9&&a.showPanoTip(),a.addEvents()},800)},addEvents:function(){var t=this;this.exitMkr.addEventListener("click",function(i){if(baidu.event.preventDefault(i.domEvent),baidu.event.stopPropagation(i.domEvent),"photo_tour"==t.panoType)a.showPhotoTour(t.uid,t.panoId);else{if(t.uid)a.showPano({research:!0,panoType:t.panoType,searchParam:{uid:t.uid}});else{var e=t.get("from");a.showPano({point:t.point,panoId:t.panoId,panoType:t.panoType,from:e})}addStat(STAT_CODE.STAT_STREETVIEW,{from:"exit-marker",item:t.panoType})}}),this.exitMkr.addEventListener("remove",function(){t.exitMkr=null,t.exitLbl=null,t.data={}});var i=this.exitLbl.domElement.childNodes[1];T.on(i,"click",function(){t.exitLbl&&t.exitLbl.hide(),t.data={}})},show:function(t,i,e){"全国"!=r.cityName&&(this.cityName=r.cityName),this.point=i,this.panoId=t.panoId,this.panoType=t.panoType,this.uid=t.uid,this.level=e,this.isOpen=!0,this.exitMkr||this.createMarker(i),this.showlabel&&(this.exitLbl.setPoint(i),this.exitLbl.show()),this.exitMkr.setPoint(i),this.exitMkr.show(),map.setCenter(i),map.zoomTo(e),map.getZoom()<9&&this.showPanoTip()},hide:function(){this.isOpen=!1,this.exitMkr&&this.exitMkr.hide(),showlabel&&this.exitLbl&&this.exitLbl.hide()},showPanoTip:function(){if(!T.G("defCityTip")){var t='<div id="defCityTip" class="GR_Tip def_city_tip"></div>';o.beforeEndHTML(document.body,t)}T.G("defCityTip").innerHTML='<div class="tip_cont">全国模式下无全景路网显示，您可以<a class="cur_city" href="javascript:void(0);" onclick="Instance(\''+this.guid+"').recoverDefaultMap()\">切换回"+this.cityName+"</a></div><button onclick=\"Instance('"+this.guid+"').closePanoTip(T.G('defCityTip'));\"></button>",this.setTipPos(T.G("defCityTip")),setTimeout(function(){var t=T.G("defCityTip");t&&(t.style.display="none")},5e3)},setTipPos:function(t){t.style.display="block";var i=T.g("MapInfoCon").clientWidth,e=o.getClientSize().width,n=t.clientWidth,a=e/2-n/2;map.fullScreenMode?t.style.top="38px":(t.style.top="145px",a+=i/2),t.style.left=a+"px"},closePanoTip:function(t){t&&(t.style.display="none")},recoverDefaultMap:function(){var t=this.point,i=16;map.zoomTo(i),map.panTo(t),this.closePanoTip()}});e.exports=d});