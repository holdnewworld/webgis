define("common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",function(require,exports,module){var ModuleClass=require("common:widget/pano/base/ModuleClass.js"),util=require("common:widget/pano/base/util.js"),Animation=require("common:widget/ui/Animation/Animation.js"),config=require("common:widget/ui/config/config.js");require.loadCss({content:'.pano_timethrough_wrapper{position:relative;width:198px;height:108px;margin:0 1px 0 3px;border:1px transparent solid;font-size:12px;font-family:Arial,"Microsoft Yahei","微软雅黑",sans-serif}.pano_timethrough_wrapper img{cursor:pointer;border:0;position:absolute;top:0;left:0;z-index:2;background-color:#000}.pano_timethrough_wrapper .photo-mask{z-index:3;position:absolute;bottom:0;left:0;width:100%;height:100%;text-align:center;font-size:12px;color:#fff;z-index:3;cursor:pointer;background-color:#000;filter:alpha(opacity=65);background-color:rgba(0,0,0,.65);text-decoration:none}.pano_timethrough_wrapper .photo-mask .icon{display:block;background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/pano_whole/timelineicon-8-black_db6cdc5.png);width:32px;margin:0 auto;height:100%;background-repeat:no-repeat;background-position:0 center}.pano_timethrough_wrapper .photo-mask:hover .icon{background-position:-32px center;color:#3af}.pano_timethrough_wrapper .photo-mask .time-text{position:absolute;width:100%;text-align:center;top:72px;left:0}.pano_timethrough_wrapper .photo-mask:hover .time-text{color:#34a4f4}.pano_timethrough_wrapper .timethrough-list-container{width:100%;position:absolute;top:0;background-color:#252525;opacity:.9;_background-color:gray;*background-color:gray;text-align:center;z-index:1;overflow:hidden}.pano_timethrough_wrapper .timethrough-list-container .line{border-bottom:1px solid #393c40;margin:0 auto;width:95%;font-size:0;height:0}.pano_timethrough_wrapper .timethrough-list-container .item{height:50px;line-height:50px;color:#b5b9c5;display:block;text-decoration:none;cursor:pointer}.pano_timethrough_wrapper .timethrough-list-container .selected{color:#34a4f4}.pano_timethrough_wrapper .timethrough-list-container .item:hover{background-color:gray}'});var TEMPLATE=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="pano_timethrough_wrapper">    '),_template_fun_array.push(isLatest?'        <a class="photo-mask">    ':'        <a class="photo-mask">    '),_template_fun_array.push('        <div class="icon"></div>        <div class="time-text">',"undefined"==typeof label?"":label,'</div>    </a>    <img id="timeThroughThumb" style="background-color:#2b2e31;" width="198" height="108" src="',"undefined"==typeof currectImage?"":currectImage,'" onerror="this.src=&#39;',"undefined"==typeof error_src?"":error_src,'&#39;;">    <div class="timethrough-list-container">        ',"undefined"==typeof throughListHtml?"":throughListHtml,"    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],IMG_ERROR_URL="../../../../../images/blank.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/blank.gif*/,panoTimelineModuleContainer=null,panoData=null,TIME_THROUGH_DATA_EXAMPLE=[{ID:"01011700001306272100190835F",IsCurrent:1,Time:"day",TimeDir:"",TimeLine:"201402",Year:"2014"},{ID:"01011700001306100916155955B",IsCurrent:0,Time:"day",TimeDir:"obsolete",TimeLine:"201306",Year:"2013"}],convertTimelineData=function(){},PanoTimelineModule=ModuleClass.extend("PanoTimelineModule",{initialize:function(t){try{this.container=t;var e=this;this.listStatus=-2,this.isMouseInRange=0;var i=0;T(t).on("click",function(t){var i=t.target?t.target.getAttribute("data-pid"):null;i&&(e.dispatchEvent("pano_changed",{data:{panoId:i,keepPov:!0}}),addStat(STAT_CODE.STAT_PANORAMA,{item:"panotimethrough-click"}),e.hide(!0),e.isMouseInRange=0)}).on("mouseenter",function(){e.isMouseInRange=1,clearTimeout(i),i=setTimeout(function(){e._fireAction()},200)}).on("mouseleave",function(){e.isMouseInRange=0,clearTimeout(i),i=setTimeout(function(){e._fireAction()},300)})}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/TimethroughModule/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",ln:78})}},_fireAction:function(){this.isMouseInRange?this.show():this.hide()},show:function(){if(-2===this.listStatus){var t=this;this.listStatus=1;var e=T(".timethrough-list-container",this.container),i=e.outerHeight(),o=new Animation.Animation,n={duration:400,fps:40,delay:Animation.Animation.INFINITE,transition:Animation.Transitions.easeOutQuad,render:function(t){try{e.css("top",-t*i+"px")}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/TimethroughModule/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",ln:102})}},finish:function(){t.listStatus=2,t._fireAction()}};o.build(n),o.start()}},hide:function(t){if(2===this.listStatus){var e=this;this.listStatus=-1;var i=T(".timethrough-list-container",this.container),o=i.outerHeight();if(t===!0)return i.css("top","0px"),void(this.listStatus=-2);var n=new Animation.Animation,a={duration:400,fps:40,delay:Animation.Animation.INFINITE,transition:Animation.Transitions.easeOutQuad,render:function(t){try{i.css("top",(t-1)*o+"px")}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/pano/module/PanoGuideModule/TimethroughModule/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/pano/module/PanoGuideModule/TimethroughModule/TimethroughModule.js",ln:133})}},finish:function(){e.listStatus=-2,e._fireAction()}};n.build(a),n.start()}},empty:function(){this.container.innerHTML="",this.container.style.display="none"},update:function(t){var e=0;this.container.style.display="block",t.sort(function(t,e){var i,o,n;return i=t.TimeLine,o=i.substr(0,4),n=i.substr(4,2),a_time=new Date(o,n),i=e.TimeLine,o=i.substr(0,4),n=i.substr(4,2),b_time=new Date(o,n),a_time>b_time?1:-1});var i="",o=0,n=util.each(t,function(t){var n="item",a=t.TimeLine,r=a.substr(0,4),s=a.substr(4,2),u=r+"年"+(parseInt(s)?s+"月":"");return 1===t.IsCurrent&&(e=t.ID,i=u,o=t.dir,n="item selected"),'<a data-pid="'+t.ID+'" class="'+n+'">'+u+"</a>"},!0),a=util.getImage3DUrl(config.urlConfig.PANO_3DIMAGE_URL,e,o,0,198,108),r=1===t[t.length-1].IsCurrent,s={currectImage:a,label:r?"时光机":i,throughListHtml:n.join('<div class="line"></div>'),isLatest:r,error_src:IMG_ERROR_URL},u=document.getElementById("timeThroughThumb");if(u){var c=u.src;s.currentImage=c;var m=new Image;m.onload=function(){var t=document.getElementById("timeThroughThumb");t.src=this.src},m.src=a}var l=TEMPLATE(s);this.container.innerHTML=l,this.isMouseInRange&&this.show()},getSupportEvents:function(){return["pano_changed"]},dispose:function(){panoTimelineModuleContainer.innerHTML=""}});module.exports=PanoTimelineModule});