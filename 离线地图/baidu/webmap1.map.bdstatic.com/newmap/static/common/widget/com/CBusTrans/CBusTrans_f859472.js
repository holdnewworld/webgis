define("common:widget/com/CBusTrans/CBusTrans.js",function(require,exports,module){function CBusTrans(t){window.CBusTransInst=this,MapComponent.call(this,t),this.start=null,this.end=null,this.result=null,this.startCity=null,this.endCity=null,this.curCity=null,this.linesCache=[],this.schemeNames=[],this.curOverlays={mkrs:[],infoWins:[],polylines:[],tipMkrs:[]},this.anotherPlys=[],this.curLineIndex=-1,this.preHightRoute=null,this.preSelectedDom=null,this.curMapZoomLevel=1,this.pageCap=5,this.scrollPanel=new baidu.ui.ScrollPanel({container:"cbtMiddle",overflow:"overflow-y",autoUpdate:!1}),this.disAnotherHandler=0,this.hideAnotherHandler=0,this.noResult=!1}var componentManager=require("common:widget/com/componentManager.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),constants=require("common:widget/ui/constant/Constant.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),util=require("common:widget/ui/util/util.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),BShare=require("common:widget/ui/toolShare/ToolShare.js"),SyncMgr=require("common:widget/ui/SyncMgr/SyncMgr.js"),SchemeFaver=require("common:widget/ui/SchemeFaver/SchemeFaver.js"),Page=require("common:widget/ui/page/Page.js"),transInfoWindow=require("common:widget/ui/transInfoWindow/transInfoWindow.js"),MapComponent=require("common:widget/com/MapComponent.js"),mapInfoScrollPanel=require("common:widget/ui/mapInfoScroll/mapInfoScroll.js"),transInfo=require("common:widget/ui/transInfoWindow/transInfoWindow.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),taxi=require("common:widget/ui/taxiMgr/TaxiMgr.js"),config=require("common:widget/ui/config/config.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,Share=require("common:widget/ui/mapShare/MapShare.js");CBusTrans.SEG_LINE_NULL_TYPE=0,CBusTrans.SEG_LINE_RAILWAY_TYPE=1,CBusTrans.SEG_LINE_AIR_TYPE=2,CBusTrans.SEG_LINE_BUS_TYPE=3,CBusTrans.SEG_LINE_DRIVING_TYPE=4,CBusTrans.SEG_LINE_WALKING_TYPE=5,CBusTrans.SEG_LINE_BUS_TITLE_TYPE=6,CBusTrans.SEG_LINE_SUBWAY_TYPE=7,CBusTrans.SEG_LINE_RAILWAY_DASHED_TYPE=8,CBusTrans.STOP_TYPE_START=0,CBusTrans.STOP_TYPE_END=1,CBusTrans.STOP_TYPE_RAIL=2,CBusTrans.STOP_TYPE_AIR=3,CBusTrans.STOP_TYPE_BUS=4,CBusTrans.STOP_TYPE_DRIVING=5,CBusTrans.STOP_TYPE_WALKING=6,CBusTrans.STOP_TYPE_SUBWAY=7,CBusTrans.STOP_TYPE_SHIP=8,CBusTrans.STOP_TYPE_NORMAL=9,CBusTrans.STOP_SUBTYPE_OFF=0,CBusTrans.STOP_SUBTYPE_ON=1,CBusTrans.STOP_SUBTYPE_ST=2,CBusTrans.STOP_SUBTYPE_ET=3,CBusTrans.STOP_SUBTYPE_NULL=4,CBusTrans.START_IS_CITY=1,CBusTrans.END_IS_CITY=2,CBusTrans.START_END_IS_CITY=3,CBusTrans.OPEN_URL="../../../../../../../map.baidu.com/-s=.htm"/*tpa=http://map.baidu.com/?s=*/,T.lang.inherits(CBusTrans,MapComponent,"CBusTrans"),T.object.extend(CBusTrans.prototype,{render:function(){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="cbtContainer">        <div id="cbtTop" class="cbttop">        <div class="cbtTransToolContainer">            <span class="cbtTransToolBkg">                <span id="cbtToolRail" class="cbtTansTool cbtTansToolRailOpen" onclick="addStat(\'crosscitybusscheme.crosscitybl.tabexchangetotrain\');CBusTransInst._selTransToolType(0)" onmouseover="CBusTransInst._stragyOver(this, 0)" onmouseout="CBusTransInst._stragyOut(this, 0)">火车</span><span id="cbtToolAir" onclick="addStat(\'crosscitybusscheme.crosscitybl.tabexchangetoplane\');CBusTransInst._selTransToolType(1);" onmouseover="CBusTransInst._stragyOver(this, 1)" onmouseout="CBusTransInst._stragyOut(this, 1)" class="cbtTansTool cbtTansToolAirClose">飞机</span>            </span>        </div>        <div class="cbtType">            <input id="cbtType0" type="radio" name="cbtType" value = "0" onclick="CBusTransInst._selTransTimeType(0);" checked /><label for="cbtType0">较快捷</label>&nbsp;&nbsp;&nbsp;&nbsp;            <input id="cbtType1" type="radio" name="cbtType" value = "1" onclick="CBusTransInst._selTransTimeType(1);" /><label for="cbtType1">出发较早</label>&nbsp;&nbsp;&nbsp;&nbsp;            <input id="cbtType2" type="radio" name="cbtType" value = "2" onclick="CBusTransInst._selTransTimeType(2);" /><label for="cbtType2">到达较早</label>        </div>        <div id="cbtSugNavContainer" class="cbtSugNavContainer">',"undefined"==typeof cbtSuggestNav?"":cbtSuggestNav,'</div>        <div id="cbtChangeTipContainer">',"undefined"==typeof cbtChangeTip?"":cbtChangeTip,'</div>    </div>    <div id="cbtMiddleWrapper" class="cbtmiddleWrapper">        <div id="cbtMiddle" class="cbtmiddle">                        <div id="cbtWrapList" class="cbtWrapList">',"undefined"==typeof cbtWrapList?"":cbtWrapList,'</div>            <div id="cbtPage" class ="cbtPage"></div>            <div id="cbtDeclare" class="route_tips">                <div class="cbtBusDataFrom">飞机火车数据来源：<em class="cbus_src"></em><a  target="_blank" href="http://www.qunar.com/">去哪儿</a></div>                百度提醒您：以上行车线路仅供参考，如有问题请到                <a target="_blank" href="http://tousu.baidu.com/map/add">百度地图投诉中心</a>                反馈。            </div>        </div>    </div>    <div id="cbtBottom" class="cbtbottom">        <p class="cbtbr">查看:            <a href="javascript:void(0)" tid=\'routeReturn\' onclick="CBusTransInst._back();return false;">返程</a>&nbsp;|&nbsp;            <a href="javascript:void(0)" onclick="CBusTransInst._switchToNav();return false;">驾车</a>&nbsp;',"undefined"==typeof walkInfo?"":walkInfo,'        </p>         <p class="cbtbl">            <a href="javascript:void(0)" tid="reChoice" onclick="CBusTransInst._reSelectAddr();return false;">重选起终点</a>        </p>    </div>        <img src=',"../../../images/bgs_6dbfd12.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif*/,' style="display:none"/>    <img src=',"../../../images/trans_icons_45ed3d3.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/trans_icons_45ed3d3.png*/,' style="display:none"/>    <img src=',"../../../images/print_bgs_1f51a84.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/print_bgs_1f51a84.png*/,' style="display:none"/></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],style=".cbtSeparator{display:none;height:2px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/busbackground_11bc213.gif) repeat-x;margin:0;overflow:hidden}.cbttop{padding:15px 0 8px}.cbtmiddleWrapper{position:relative;_zoom:1;padding:0 5px 0 10px}.cbtmiddle{position:relative;_zoom:1;overflow:hidden}.cbtWrapList{width:315px;_zoom:1}.cbtUL{position:relative}.cbtbottom{position:absolute;height:28px;bottom:0;width:100%;line-height:28px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/busbackground_11bc213.gif) 0 -2px repeat-x}.cbtbottom a{color:#4e70c9}.cbtlist{position:relative;_zoom:1;cursor:pointer;margin:0 0 10px}.cbtUL .cbtscheme{border-left:2px solid #c7dbfe;border-right:2px solid #c7dbfe}.cbtUL .on .cbtscheme{border-left-color:#9CB6FF;border-right-color:#9CB6FF}.cbtUL .active .cbtscheme{border-left-color:#9CB6FF;border-right-color:#9CB6FF}.cbtUL .cbtlinetop{height:17px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bus_8774626.gif) no-repeat right -30px;font-size:0;zoom:1;overflow:hidden}.cbtUL .cbtlinetopleft{width:20px;height:17px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bus_8774626.gif) no-repeat left -30px;color:#fff;font-size:12px;font-weight:700;padding:2px 0 0 3px}.cbtUL .on .cbtlinetop{background-position:right 0}.cbtUL .on .cbtlinetopleft{background-position:left 0}.cbtUL .active .cbtlinetop{background-position:right 0}.cbtUL .active .cbtlinetopleft{background-position:left 0}.cbtUL .cbtlinebottom{position:relative;height:5px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bus_8774626.gif) no-repeat right -50px;overflow:hidden}.cbtUL .cbtlinebottomleft{position:relative;width:20px;height:5px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bg_bus_8774626.gif) no-repeat left -50px;overflow:hidden}.cbtUL .on .cbtlinebottom{background-position:right -20px}.cbtUL .on .cbtlinebottomleft{background-position:left -20px}.cbtUL .active .cbtlinebottom{background-position:right -20px}.cbtUL .active .cbtlinebottomleft{background-position:left -20px}.cbtUL .open{cursor:default}.cbtUL .open .cbtlinebottom{background-position:right -25px}.cbtUL .open .cbtlinebottomleft{background-position:left -25px}.cbtSegRoute{position:relative;padding:10px 10px 10px 25px;_padding:12px 5px 10px 25px;border-bottom:solid 1px #CCC;_zoom:1}.cbtBusDetail{position:relative;display:none;background:#F6F6F6}.cbtBusDetailRoute{position:relative;padding:10px 5px 10px 45px;border-bottom:solid 1px #CCC;_zoom:1}.cbtBusDetailTaxi{position:relative;padding:10px 2px 10px 0;text-align:right;border-bottom:solid 1px #CCC;_zoom:1}.cbtBusDetailClose{position:relative;_zoom:1}.cbtClose{color:#3D6DCC;float:right}.cbtSegIconAir{position:absolute;left:7px;top:13px;width:11px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -225px -216px}.cbtSegIconBus{position:absolute;left:0;top:10px;width:25px;height:18px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -99px -211px}.cbtSegIconDriving{position:absolute;left:7px;top:14px;width:10px;height:10px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -196px -195px}.cbtSegIconWalking{position:absolute;left:0;top:10px;width:18px;height:25px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -126px -211px}.cbtSegIconRail{position:absolute;left:7px;top:13px;width:8px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -196px -216px}.cbtBusDetailIconBus{position:absolute;left:18px;top:8px;width:25px;height:18px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -99px -211px}.cbtBusDetailIconSubway{position:absolute;left:18px;top:8px;width:25px;height:18px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -155px -211px}.cbtBusDetailIconWalking{position:absolute;left:18px;top:8px;width:18px;height:25px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -126px -211px}.cbtTip{float:right;color:gray;text-decoration:underline;padding:2px 0 0 5px}.cbtBusLineName{color:#3D6DCC;font-weight:700;padding:0 2px}.cbtCBusLineName{color:#F26118;font-weight:700;padding:0 2px}.cbtTaxiIcon{position:absolute;left:25px;top:12px;width:13px;height:13px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -38px -372px}.cbtLineTitleClose{padding:0 0 0 10px;margin:-5px 0 0 0;border-bottom:0;_zoom:1}.cbtLineTitleOpen{padding:0 0 0 10px;margin:-5px 0 0 0;border-bottom:solid 2px #CCDAFD;_zoom:1}.cbtLine{display:none;cursor:pointer}.cbtLineTitleItem{position:relative;padding:0 25px 5px;_zoom:1;color:gray;font-size:12px}.cbtUL .cbtTitleItemRail{position:absolute;left:8px;top:3px;width:8px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -204px -216px}.cbtUL .on .cbtTitleItemRail{position:absolute;left:8px;top:3px;width:8px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -196px -216px}.cbtUL .active .cbtTitleItemRail{position:absolute;left:8px;top:3px;width:8px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -196px -216px}.cbtUL .cbtTitleItemAir{position:absolute;left:7px;top:0;width:11px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -236px -216px}.cbtUL .on .cbtTitleItemAir{position:absolute;left:7px;top:0;width:11px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -225px -216px}.cbtUL .active .cbtTitleItemAir{position:absolute;left:7px;top:0;width:11px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -225px -216px}.cbtUL .cbtTitleItemName{color:#F8AA83;font-size:14px;font-weight:700;padding-right:10px}.cbtUL .on .cbtTitleItemName{color:#F26118;font-size:14px;font-weight:700;padding-right:10px}.cbtUL .active .cbtTitleItemName{color:#F26118;font-size:14px;font-weight:700;padding-right:10px}.cbtUL .cbtTransfer{color:gray;font-size:12px}.cbtSegIconStart{position:absolute;left:2px;top:8px;width:22px;height:21px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/trans_icons_45ed3d3.png) 0 0}.cbtSegIconEnd{position:absolute;left:2px;top:8px;width:22px;height:21px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/trans_icons_45ed3d3.png) 0 -26px}.cbtSegRouteStart{position:relative;padding:10px 0 10px 30px;border-bottom:solid 1px #CCC;_zoom:1}.cbtSegRouteEnd{position:relative;padding:10px 0 12px 30px;_zoom:1}.cbtSegRouteStart span{height:19px;padding-right:5px;display:inline-block;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) right -160px}.cbtSegRouteStart span strong{line-height:18px;height:18px;padding-left:5px;display:inline-block;color:#fff;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) 0 -160px}.cbtSegRouteEnd span{height:19px;padding-right:5px;display:inline-block;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) right -160px}.cbtSegRouteEnd span strong{line-height:18px;height:18px;padding-left:5px;display:inline-block;color:#fff;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) 0 -160px}.cbtSwitchOff{position:absolute;z-index:100;width:18px;height:16px;top:10px;right:10px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) right -350px}.cbtSwitchOn{position:absolute;z-index:100;width:18px;height:16px;top:10px;right:10px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) right -330px;cursor:pointer}.cbta{color:#3D6DCC;padding:0 2px}.cbtac{color:#F26118;padding:0 2px}.cbtPage{margin:5px 0}.cbtToolBar{background:#E6EDFF;height:19px;_zoom:1;cursor:default}.cbtPrint{margin-left:21px}.cbtPrint,.cbtToolBar .afav{float:right;cursor:pointer}.cbtToolBar .afav{margin-top:2px}.cbtPrint img{position:relative;top:2px;width:14px;height:14px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/tools_img_39c80b4.png) -60px -181px}.cbtPrint a{padding:0 5px;color:#3D6DCC}.cbtSendToPhone{float:right}.cbtSendToPhone img{position:relative;top:2px;width:14px;height:15px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -17px -370px}.cbtSendToPhone a{padding:0 5px 0 2px;color:#3D6DCC}.cbtTransToolContainer{text-align:center}.cbtTansTool{cursor:pointer;display:inline-block;line-height:27px;text-align:center;height:26px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat}.cbtTansToolRailOpen{width:84px;background-position:-83px -507px}.cbtTansToolRailClose{width:84px;background-position:-83px -567px}.cbtROpenOver{width:84px;background-position:-83px -597px}.cbtRCloseOver{width:84px;background-position:-83px -537px}.cbtTansToolAirOpen{width:84px;background-position:-168px -567px}.cbtTansToolAirClose{width:84px;background-position:-168px -507px}.cbtAOpenOver{width:84px;background-position:-168px -537px}.cbtACloseOver{width:84px;background-position:-168px -597px}.cbtType{padding:5px 0 0 60px}.cbtType input,.cbtType label{cursor:pointer}.cbtTransToolBkg{display:inline-block}.cbtSuggestNav{height:25px;line-height:25px;background:#FFF4CC;font-size:12px;padding-left:3px;display:none;margin:5px 20px 0 12px}.cbtSuggestNav a{color:#3d71de}.cbtChangeTip{margin:6px 20px 0 12px;padding-left:5px;height:25px;line-height:25px;background:#FFF4CC;font-size:12px;display:none}.cbtBusDataFrom{padding:0 0 25px}.cbtLink{line-height:25px;padding-left:5px;_padding-top:3px;background:#FFF4CC}.cbtLink a{color:#4876C1;white-space:nowrap}.cbtLink span{color:#BD1B06}.cbtLinkLogo{position:relative;top:2px;width:8px;height:11px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) -164px -195px no-repeat}.cbtbottom .cbtbl{float:left;padding-left:10px}.cbtbottom .cbtbr{float:right;padding-right:10px}.cbtDescFontSize{line-height:20px}.route_tips em.cbus_src{display:inline-block;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/cbus_src_d2f0e8b.gif) center no-repeat;width:17px;height:17px;vertical-align:middle;margin-right:3px}p.cbus_tip{margin:10px 0}.cbtLink a{margin-left:5px}";require.loadCss({content:style,name:"CBusTrans"});var templateObj={},me=this;if(BShare.getMInfo=function(){var t="";if(me.total&&0!=me.total){var e=me.s_query,n=me.e_query,s=me.curLineIndex,a=me.schemeNames,t="";a&&a[s]&&BShare.fixName(e+"到"+n)+" "+a[s].join("，换")}return{text:t,className:me._className}},mapInfoScrollPanel&&mapInfoScrollPanel.hide(),!me._checkValid())return;if(me._initKeyParams(this.json),me._setNormalMapType(),!this.json.content){var noResultHtml=me._renderNoResult();return this.noResult=!0,map.centerAndZoom(map.getCenter(),map.getZoom()),noResultHtml}var sugNavHtml=me._renderSuggestNav();templateObj.cbtSuggestNav=sugNavHtml;var changeTipHtml=me._renderChangeTip();templateObj.cbtChangeTip=changeTipHtml;var listHtml=this._renderList();return templateObj.cbtWrapList=listHtml,template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:179})}},initialize:function(){try{var t=this,e=this.json;if(window.trafficCtrl&&window.trafficCtrl.hide(),!t._checkValid())return;if(!t.json.content)return;var n=e.result.end;2!=searchBox._curSelIndex&&searchBox.setSwitchTab(2),searchBox.setValue("BusSearchSta"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/,null==e.result.start.wd?"":e.result.start.wd),searchBox.setValue("BusSearchEnd"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/,null==n.wd?"":n.wd),searchBox.busSSG1&&searchBox.busSSG1.setValue(document.fmbus.word_from.value),searchBox.busSSG2&&searchBox.busSSG2.setValue(document.fmbus.word_to.value),t.setSwitchNavParams(),t._setCxtMenuParams(),t._createPage(),t._initStrategy(),t._addZoomEndListener(),t._bindResizeEvent(),t._resizeCbtMiddle(),t.scrollPanel.render("cbtMiddle"),BoxContainer&&BoxContainer.resetStatus(),t.json.content&&PanoUtil.isPanoStatus()&&PanoUtil.closePano("search"),T.on(window,"onresize",function(){var t=CBusTransInst;t.scrollPanel&&t.scrollPanel.update()}),this.load()}catch(s){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:248})}},load:function(){var t=this;if(t._checkValid()&&t.json.content){var e=t._getShareLineIndex();t._openLineItem(e)}},unload:function(){var t=this;window.startPoi=null,window.endPoi=null,window.cxtBusPoints&&(window.cxtBusPoints.length=0,window.cxtBusPoints=null),t.curLineIndex=-1,t._removeZoomEndListener(),t.json.content&&T.un(window,"onresize",t._resizeCbtMiddle),t.linesCache&&(t.linesCache.length=0,t.linesCache=null),t.curOverlays&&(t._clearCurOverlays(),t.curOverlays=null),t.anotherPlys&&(t.anotherPlys.length=0,t.anotherPlys=null),t.json=null,t.start=null,t.end=null,t.result=null,t.startCity=null,t.endCity=null,t.curCity=null,t.scrollPanel=null},_checkValid:function(){var t=this,e=!0;return t.linesCache||(e=!1),t.curOverlays||(e=!1),t.anotherPlys||(e=!1),e},_initKeyParams:function(t){this.json=t,this.result=t.result,this.start=t.result.start,this.end=t.result.end,this.s_query=this.result.s_query?this.result.s_query:this.start.wd,this.e_query=this.result.e_query?this.result.e_query:this.end.wd,this.startCity=t.result.start_city,this.endCity=t.result.end_city,this.total=this.result.total,this.curCity=t.current_city,this.cty=t.result.cty,this.csy=t.result.csy,this.pagenum=t.result.pn},_setNormalMapType:function(){map.mapType==BMAP_TYPE_DIMENSIONAL&&map.setMapType(BMAP_NORMAL_MAP)},_bindResizeEvent:function(){var t=this;T.on(window,"onresize",t._resizeCbtMiddle)},_resizeCbtMiddle:function(){var t=CBusTransInst,e=util.getClientSize(),n=e.height,s=T.G("cbtTop")?T.G("cbtTop").offsetHeight:0,a=T.G("cbtBottom")?T.G("cbtBottom").offsetHeight:0,i=n-s-a-124-32-5;i>0&&(T.G("cbtMiddle").style.height=i+"px"),t.scrollPanel&&t.scrollPanel.update()},_getShareLineIndex:function(){var t=this,e=0;return t.cinfo._index&&(e=parseInt(t.cinfo._index),t.cinfo._index=null),e},setSwitchNavParams:function(){var t=this;require.async("common:widget/ui/throughpoint/Throughpoint.js",function(e){t._setSwitchNavParams(e)})},_setSwitchNavParams:function(t){var e=this,n=e.start,s=e.startCity,a=n.wd,i=n.uid||"",o=n.pt,r=s.code,c=e.end,p=e.endCity,l=c.wd,d=c.uid||"",u=c.pt,m=p.code,g=e.curCity,b=g.code,_=t.getQueryParam(),h=t.getCityCode(),T="nav&navtp=0&sy=0&drag=0&st=1&et=1&c="+b+"&sc="+r+"&ec="+h+m+"&sn=1$$"+i+"$$"+o+"$$"+encodeURIComponent(a)+"$$$$$$&en="+_+"1$$"+d+"$$"+u+"$$"+encodeURIComponent(l)+"$$$$$$&sq="+encodeURIComponent(a)+"&eq="+encodeURIComponent(l);e.navQueryString=T},_setCxtMenuParams:function(){var t=this,e=t.start.pt,n=t.start.wd,s=t.end.pt,a=t.end.wd,i=new BMap.Point(e.split(",")[0],e.split(",")[1]),o=new BMap.Point(s.split(",")[0],s.split(",")[1]);window.cxtBusPoints||(window.cxtBusPoints=[]),window.cxtBusPoints[0]={p:i,n:n,t:0},window.cxtBusPoints[1]={p:o,n:a,t:1}},_createPage:function(){var t=this,e=t.json.result.total;if(e<=t.pageCap)return void(T.G("cbtPage").style.display="none");{var n=Math.ceil(e/t.pageCap),s=t.json.result.pn;new Page("cbtPage",function(e){addStat("crosscitybusscheme.crosscitybl.pageturning");var n=t.start,s=t.end,a=t.startCity,i=t.endCity,o=n.wd,r=n.uid||"",c=n.pt,p=a.code,l=s.wd,d=s.uid||"",u=s.pt,m=i.code,g="bt&c="+modelConfig.cityCode+"&sn=1$$"+r+"$$"+c+"$$"+encodeURIComponent(o)+"$$$$$$&en=1$$"+d+"$$"+u+"$$"+encodeURIComponent(l)+"$$$$$$&sc="+p+"&ec="+m+"&pn="+(e-1)+"&rn="+t.pageCap+t._getStrategyParam();componentManager.go(g)},{pageCount:n,page:s+1,update:!1})}},_renderNoResult:function(){try{var t=this,e=t.result;t.setSwitchNavParams();var n,s,a=e.cty;"1"==a?(n="航班信息",s="火车线路"):(n="火车线路信息",s="航班线路");var i=["<div class='result_holder' style='padding:10px'>","<p class='cbus_tip'>暂无<span class='nr_kw'>"+t.start.wd+"</span>到<span class='nr_kw'>"+t.end.wd+"</span>"+n+'，<div class="cbtLink"><img class="cbtLinkLogo" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ /><a href=\'javascript:void(0)\' onclick="CBusTransInst._clickSuggestCbtRoute('+a+');return false;">查看'+s+"信息</a></div></p>","<div style='background:#FFF4CC;height:10px'><div style='margin:0 7px;padding:2px 0;border-bottom:dashed 1px #F5D8A3'></div></div>","<p style='background:#FFF4CC;padding: 0 0 5px 5px;margin-bottom:5px'>您可尝试查看<a href='javascript:void(0)' onclick=\"addStat('crosscitybusscheme.crosscitybl.tipsforcrossnav');CBusTransInst._clickSuggestNav();return false;\">驾车路线</a>。</p>","<div class='nr_suggest'>您还可以更换关键词再次尝试。","</div>","<div id='route_tips' class='route_tips'>百度提醒您：以上方案仅供参考，如有问题请到<a id='mapComplaintCenter' target='_blank' href='http://tousu.baidu.com/map/add'>百度地图投诉中心</a>反馈。</div>","</div>"];return i.join("")}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:576})}},_clickSuggestCbtRoute:function(t){var e=this,n=e.start,s=e.end,a=e.startCity,i=e.endCity,o=n.wd,r=n.uid||"",c=n.pt,p=a.code,l=s.wd,d=s.uid||"",u=s.pt,m=i.code,g=0;g=1==t?0:1;var b="bt&c="+modelConfig.cityCode+"&sn=1$$"+r+"$$"+c+"$$"+encodeURIComponent(o)+"$$$$$$&en=1$$"+d+"$$"+u+"$$"+encodeURIComponent(l)+"$$$$$$&sc="+p+"&ec="+m+"&rn="+e.pageCap+"&cty="+g;componentManager.go(b)},_renderSuggestNav:function(){try{var t=this,e="",n=1==t.result.car_better?!0:!1;return n&&(e='<div class="cbtSuggestNav" style="display:block">起终点距离较近, 建议用户 <a href="javascript:void(0)" onclick="CBusTransInst._clickSuggestNav();return false;">驾车前往</a></div>',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/!=typeof t.result.cty&&0==t.result.cty?addStat("crosscitybusscheme.crosscitybl.tipsbelowtraintab"):"undefined"!=typeof t.result.cty&&1==t.result.cty&&addStat("crosscitybusscheme.crosscitybl.tipsbelowplanetab")),e}catch(s){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:635})}},_clickSuggestNav:function(){var t=this,e=t.start,n=t.startCity,s=e.wd,a=e.uid||"",i=e.pt,o=n.code,r=t.end,c=t.endCity,p=r.wd,l=r.uid||"",d=r.pt,u=c.code,m=t.curCity,g=m.code,b="nav&navtp=0&sy=0&drag=0&st=1&et=1&c="+g+"&sc="+o+"&ec="+u+"&sn=1$$"+a+"$$"+i+"$$"+encodeURIComponent(s)+"$$$$$$&en=1$$"+l+"$$"+d+"$$"+encodeURIComponent(p)+"$$$$$$&sq="+encodeURIComponent(s)+"&eq="+encodeURIComponent(p);componentManager.go(b)},_renderChangeTip:function(){try{var t=this,e=t.result,n=e.s_query||"起点",s=e.e_query||"终点",a="",i=t.result.search_times>1?!0:!1;return i&&(a='<p class ="cbtChangeTip" style="display:block"><strong>'+n+"</strong>到<strong>"+s+"</strong>无驾车路线, 请参考下述路线方案.</p>"),a}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:686})}},_renderList:function(){try{for(var t=this,e=t.json.content,n=['<ul class="cbtUL">'],s=0,a=e.length;a>s;s++){var i=t._renderItem(s);n.push(i)}return n.push("</ul>"),n.join("")}catch(o){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:o.message||o.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:703})}},_renderItem:function(t){try{var e=this,n=[],s=e.json.content[t],a=e.linesCache[t]={stops:[],routes:[],totalTime:0},i=t+1;n.push('<li id="list'+t+"\" class='cbtlist' onclick=\"CBusTransInst._openLineItem("+t+')" onmouseover="CBusTransInst._mouseOver('+t+')" onmouseout = "CBusTransInst._mouseOut('+t+')"><div id="swt'+t+'" class="cbtSwitch cbtSwitchOff" onclick="CBusTransInst._switchLineItem(event, '+t+")\"></div><div class='cbtlinetop'><div class='cbtlinetopleft'>"+i+"</div></div><div id='scheme"+t+"' class='cbtscheme'>");var o=e._getLineTitle(s,a,t);n.push(o),n.push('<div id="line'+t+'" class="cbtLine">');var r=e._getStartHtml(e.start,a,t);n.push(r);var c=e._isCurLineMultiType(s);c&&addStat("crosscitybusscheme.crosscitybl.tipsbelowplanetabmix");for(var p=e.json.result.area_flag,l=p==CBusTrans.START_IS_CITY||p==CBusTrans.START_END_IS_CITY?!0:!1,d=0,u=s.length;u>d;d++){var m=s[d];if(m.type!=CBusTrans.SEG_LINE_NULL_TYPE)switch(0!=d&&(l=!1),m.type){case CBusTrans.SEG_LINE_RAILWAY_TYPE:var g={isMultiType:c,segLineIndex:d,isFromCity:l},b=e._getRailWayHtml(m,a,t,g);n.push(b);break;case CBusTrans.SEG_LINE_AIR_TYPE:var g={isFromCity:l},_=e._getAirHtml(m,a,t,g);n.push(_);break;case CBusTrans.SEG_LINE_BUS_TYPE:var h=e._getBusHtml(m,a,t,d);n.push(h);break;case CBusTrans.SEG_LINE_DRIVING_TYPE:var T=e._getDrivingHtml(m,a,t,d);n.push(T);break;case CBusTrans.SEG_LINE_WALKING_TYPE:var v=e._getWalkingHtml(m,a,t,d);n.push(v)}}var f=e._getEndHtml(e.end,a,t);n.push(f);var C=e._getToolBarHtml(t);n.push(C),n.push("</div>"),n.push("</div><div class='cbtlinebottom'><div class='cbtlinebottomleft'></div></div></li>");var x=n.join(""),y=Math.ceil(a.totalTime/3600),I='<div class="cbtLineTitleItem">全程约: '+y+"小时</div>";return x=x.replace(/#cbtLineTime#/,I)}catch(S){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:S.message||S.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:812})}},_isCurLineMultiType:function(t){for(var e=!1,n=!1,s=!1,a=0,i=t.length;i>a;a++){var o=t[a].type;o==CBusTrans.SEG_LINE_RAILWAY_TYPE&&(n=!0),o==CBusTrans.SEG_LINE_AIR_TYPE&&(s=!0)}return e=n&&s},_getToolBarHtml:function(t){var e=['<div class="cbtToolBar">'];e.push('<div class="cbtPrint"><img src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/></img><a target="Print" title="打印" tid=\'cbusPrintBtn_'+t+"' onclick=\"addStat('crosscitybusscheme.crosscitybl.ccblprint');CBusTransInst._printMap(this, event, "+t+')">打印地图</a></div>');var n=this.guid+"_favbtn_"+t;return e.push("<div id='"+n+"' tid='cbusFavBtn_"+t+'\' onclick="addStat(\'crosscitybusscheme.crosscitybl.ccblfavoutite\');CBusTransInst.addToFav(this)"\' title="加入收藏夹" class="afav"><img src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*//><a href="javascript:void(0)">收藏</a></div>'),e.push("</div>"),e.join("")},_getStartHtml:function(t,e,n){var s,a,i,o,r=this,c=r.result.area_flag,p=c==CBusTrans.START_IS_CITY||c==CBusTrans.START_END_IS_CITY;if(p){var l=r.json.content,d=l[n][0].data.on;s=t.wd||"起点",a=d.uid||"",i=mapUtil.parse2Geo(d.geo).points}else s=t.wd||"起点",a=t.uid||"",i=t.pt;o={desc:""};var u=r._getAdjustStGeoStr(n);u&&(i=u);var m=e.stops.length,g=['<div class="cbtSegRouteStart" onclick="CBusTransInst._clickStop(event, '+n+", "+m+')"><div><span><strong>'+s+"</strong></span></div>"];g.push('<div class="cbtSegIconStart"></div>'),g.push("</div>");var b={uid:a,name:s,stopInfo:o,point:i,type:CBusTrans.STOP_TYPE_START,subType:CBusTrans.STOP_SUBTYPE_NULL,_lineIndex:n,_stopIndex:m};return e.stops.push(b),g.join("")},_getAdjustStGeoStr:function(t){var e=this,n=e.json.content,s="",a=n[t],i=a[0],o=i.type;if(o==CBusTrans.SEG_LINE_BUS_TYPE||o==CBusTrans.SEG_LINE_SUBWAY_TYPE){var r=i.data[0].stops,c=r[0][0],p=c.getOn,l=c.walk;l.distance<=0&&(s=mapUtil.parse2Geo(p.geo).points)}return s},_getEndHtml:function(t,e,n){var s,a,i,o,r=this,c=r.result.area_flag,p=c==CBusTrans.END_IS_CITY||c==CBusTrans.START_END_IS_CITY;if(p){var l=r.json.content,d=l[n].length-1,u=l[n][d].data.off;s=t.wd||"终点",a=u.uid||"",i=mapUtil.parse2Geo(u.geo).points}else s=t.wd||"终点",a=t.uid||"",i=t.pt;o={desc:""};var m=r._getAdjustEdGeoStr(n);m&&(i=m);var g=e.stops.length,b=['<div class="cbtSegRouteEnd" onclick="CBusTransInst._clickStop(event, '+n+", "+g+')"><div><span><strong>'+s+"</strong></span></div>"];b.push('<div class="cbtSegIconEnd"></div>'),b.push("</div>");var _={uid:a,name:s,stopInfo:o,point:i,type:CBusTrans.STOP_TYPE_END,subType:CBusTrans.STOP_SUBTYPE_NULL,_lineIndex:n,_stopIndex:g};return e.stops.push(_),b.join("")},_getAdjustEdGeoStr:function(t){var e=this,n=e.json.content,s="",a=n[t],i=a[a.length-1],o=i.type;if(o==CBusTrans.SEG_LINE_BUS_TYPE||o==CBusTrans.SEG_LINE_SUBWAY_TYPE){var r=i.data[0].stops,c=r[0][r[0].length-1],p=c.getOff,l=c.walk;l.distance<=0&&(s=mapUtil.parse2Geo(p.geo).points)}return s},_getLineTitle:function(t,e,n){for(var s=this,a=['<div id="lineTitle'+n+'" class="cbtLineTitleClose">'],i=[],o=0,r=t.length;r>o;o++){var c=t[o];if(c.type==CBusTrans.SEG_LINE_RAILWAY_TYPE||c.type==CBusTrans.SEG_LINE_AIR_TYPE){var p=c.data,l=p.line.name,d=p.on.start_time,u=p.off.start_time,m=p.off.name,g=p.line.type,b={type:g,name:l,onTime:d,offTime:u};i.push(b);var _={type:0,name:m};i.push(_)}}i.pop();for(var h=[],o=0,r=i.length;r>o;o++){var T=i[o],v="";1==T.type?(v='<div class="cbtLineTitleItem"><div class="cbtTitleItemRail"></div><span class="cbtTitleItemName">'+T.name+"</span><span>"+s._getSETime(T.onTime,T.offTime)+"</span></div>",h.push(T.name)):2==T.type?(v='<div class="cbtLineTitleItem"><div class="cbtTitleItemAir"></div><span class="cbtTitleItemName">'+T.name+"</span><span>"+s._getSETime(T.onTime,T.offTime)+"</span></div>",h.push(T.name)):v='<div class="cbtLineTitleItem"><div class="cbtTransfer">中转站: '+T.name+"</div></div>",a.push(v)}return this.schemeNames.push(h),a.push("#cbtLineTime#"),a.push("</div>"),a.join("")},_getSETime:function(t,e){var n=["","次日","第三日","第四日","第五日","第六日","第七日","第八日","第九日","第十日"],s=t.substr(1),a=parseInt(e.substring(0,1)),i=e.substr(1),o=n[a];i=o+i;var r=s+" - "+i;return r},_getRailWayHtml:function(t,e,n,s){var a,i,o,r=this,c=r._getCrossCityTime(t,1);e.totalTime+=c.seconds;var p=t.data.line.name,l=t.data.on.name,d=t.data.off.name,u=e.routes.length;
i=e.stops.length;var m=t.data.on.uid,g=t.data.on.geo,b=mapUtil.parse2Geo(g).points,_=t.data.on.start_time,h=_.substr(1),T="乘坐"+p+"次列车",v=l+", 乘"+p+"次列车<br/>"+h+"发车, 约"+c.desc;o={desc:T,tip:v},a={uid:m,name:l+"上车",stopInfo:o,point:b,type:CBusTrans.STOP_TYPE_RAIL,subType:CBusTrans.STOP_SUBTYPE_ON,_lineIndex:n,_stopIndex:i},e.stops.push(a);var f="";s.isMultiType&&(f='<a class="cbta" href="javascript:void(0)" onclick="CBusTransInst._moreRailWays(event, '+n+", "+s.segLineIndex+');return false;">(更多列车)</a>');var C=s.isFromCity,x="";C&&(x='在<a class="cbtac" onclick="CBusTransInst._clickStop(event, '+n+", "+i+')">'+l+"</a>"),i=e.stops.length;var y=['<div class="cbtSegRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+u+', this)">'];y.push('<div class="cbtSegIconRail"></div><div class="cbtTip">'+c.desc+'</div><div class="cbtDescFontSize">'+x+'乘坐<span class="cbtCBusLineName">'+p+"</span>次列车 "+f+' , 在<a class="cbtac" onclick="CBusTransInst._clickStop(event, '+n+", "+i+')">'+d+"</a>下车</div>"),y.push("</div>");var I=t.data.off.uid,S=t.data.off.geo,B=mapUtil.parse2Geo(S).points;o={desc:""},a={uid:I,name:d+"下车",stopInfo:o,point:B,type:CBusTrans.STOP_TYPE_RAIL,subType:CBusTrans.STOP_SUBTYPE_OFF,_lineIndex:n,_stopIndex:i},e.stops.push(a);for(var w=t.data.line.stations,E=[],P=0,$=w.length;$>P;P++){var k=w[P].geo;k&&E.push(k)}var L=E.join(";"),R=t.data.line.line_type,U=1==R?CBusTrans.SEG_LINE_RAILWAY_DASHED_TYPE:CBusTrans.SEG_LINE_RAILWAY_TYPE,N={name:p,points:L,type:U,_lineIndex:n,_routeIndex:u};return e.routes.push(N),y.join("")},_moreRailWays:function(t,e,n){var s=this,a=s.json.content,i=a[e][n],o=i.data.on,r=i.data.off,c=o.name,p=o.uid||"",l=mapUtil.parse2Geo(o.geo).points,d=o.city_uid,u=r.name,m=r.uid||"",g=mapUtil.parse2Geo(r.geo).points,b=r.city_uid,_="bt&c="+modelConfig.cityCode+"&sc="+d+"&ec="+b+"&sn=1$$"+p+"$$"+l+"$$"+encodeURIComponent(c)+"$$$$$$&en=1$$"+m+"$$"+g+"$$"+encodeURIComponent(u)+"$$$$$$&rn="+s.pageCap;componentManager.go(_),util.stopBubble(t)},_getCrossCityTime:function(t,e){var n=this,s=t.data.on.start_time,a=t.data.off.start_time,i=s.substr(1),o=s.substring(0,1);o="0"+(parseInt(o)+1);var r=a.substr(1),c=a.substring(0,1);c="0"+(parseInt(c)+1);var p="2000/01/"+o+" "+i,l="2000/01/"+c+" "+r,d=new Date(p),u=new Date(l),m=(u.getTime()-d.getTime())/1e3,g="";if(1==e){var b=Math.ceil(m/3600);g=b+"小时"}else g=n._getFormatTime(m);var _={desc:g,seconds:m};return _},_getAirHtml:function(t,e,n,s){var a,i,o,r=this,c=r._getCrossCityTime(t,1);e.totalTime+=c.seconds;var p=t.data.line.name,l=t.data.on.name,d=t.data.off.name,u=e.routes.length;i=e.stops.length;var m=t.data.on.uid,g=t.data.on.geo,b=mapUtil.parse2Geo(g).points,_=t.data.on.start_time,h=_.substr(1),T="乘坐"+p+"航班",v=l+", 乘"+p+"航班<br/>"+h+"起飞, 约"+c.desc;o={desc:T,tip:v},a={uid:m,name:l+"上飞机",stopInfo:o,point:b,type:CBusTrans.STOP_TYPE_AIR,subType:CBusTrans.STOP_SUBTYPE_ON,_lineIndex:n,_stopIndex:i},e.stops.push(a);var f=s.isFromCity,C="";f&&(C='在<a class="cbtac" onclick="CBusTransInst._clickStop(event, '+n+", "+i+')">'+l+"</a>"),i=e.stops.length;var x=['<div class="cbtSegRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+u+', this)">'];x.push('<div class="cbtSegIconAir"></div><div class="cbtTip">'+c.desc+'</div><div class="cbtDescFontSize">'+C+'乘坐<span class="cbtCBusLineName">'+p+'</span>航班, 在<a class="cbtac" onclick="CBusTransInst._clickStop(event, '+n+", "+i+')">'+d+"</a>降落</div>"),x.push("</div>");var y=t.data.off.uid,I=t.data.off.geo,S=mapUtil.parse2Geo(I).points;o={desc:""},a={uid:y,name:d+"下飞机",stopInfo:o,point:S,type:CBusTrans.STOP_TYPE_AIR,subType:CBusTrans.STOP_SUBTYPE_OFF,_lineIndex:n,_stopIndex:i},e.stops.push(a);var g=t.data.on.geo,b=mapUtil.parse2Geo(g).points,B=b+";"+S,w={name:p,points:B,type:CBusTrans.SEG_LINE_AIR_TYPE,_lineIndex:n,_routeIndex:u};return e.routes.push(w),x.join("")},_getBusHtml:function(t,e,n,s){var a=this,i=T.trim(t.start.wd),o=T.trim(t.end.wd),r=e.stops.length,c=e.routes.length;r-=1;var p=[],l=a._getBusInfo(t);e.totalTime+=l.seconds,p.push('<div class="cbtSegRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+c+", this);CBusTransInst._openBusDetail(event, "+n+", "+s+')">'),p.push('<div class="cbtSegIconBus"></div><div class="cbtTip">'+l.timeDesc+'</div><div class="cbtDescFontSize">从<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+r+')">'+i+"</a>");var d=[],u="从"+i+"到"+o,m={name:u,points:d,type:CBusTrans.SEG_LINE_BUS_TITLE_TYPE,_lineIndex:n,_routeIndex:c};e.routes.push(m);var g=a._getBusDetailHtml(t,e,n,s,d),b=e.stops.length;return p.push('至<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+b+')">'+o+'</a><a id="busDetailTip_'+n+"_"+s+'" class="cbta">详情</a></div>'),p.push("</div>"),p.join("")+g},_getBusInfo:function(t){for(var e=this,n=t.data[0].lines[0],s=t.data[0].stops[0],a=0,i=0,o=s.length-1;o>i;i++){var r=s[i],c=r.walk,p=c.distance;p>0&&(a+=parseInt(c.time));var l=n[i];if(a+=parseInt(l.time),i==o-1){var d=s[i+1],u=d.walk;u.distance>0&&(a+=parseInt(u.time))}}var m=e._getFormatTime(a),g={timeDesc:m,seconds:a};return g},_getFormatTime:function(t){var e="",n=0,s=0;return n=Math.floor(t/3600),s=Math.ceil(60*(t/3600-Math.floor(t/3600))),e+=n>0?n+"小时":"",e+=s>0?s+"分钟":""},_getFormatDistance:function(t){"string"==typeof t&&(t=parseFloat(t));var e;return e=!t||0>t?"0米":10>=t?"10米":1e3>t?10*Math.round(t/10)+"米":(t/1e3).toFixed(1)+"公里","1000米"==e&&(e="1.0公里"),e},_getBusDetailHtml:function(t,e,n,s,a){var i,o=this,r=null,c=0,p=null,l=0,d=t.code,u=util.isActiveCity("taxi",d),m=[];m.push("<div id=busDetail_"+n+"_"+s+' class="cbtBusDetail">');for(var g=t.data[0].lines[0],b=t.data[0].stops[0],_=t.data[0].lines,h=0,T=b.length-1;T>h;h++){var v=g[h],f=b[h],C=b[h+1],x=f.getOn,y="站"==x.name.substr(x.name.length-1)?x.name:x.name+"站",I=x.uid||"",S=mapUtil.parse2Geo(x.geo).points,B=f.walk,w=B.distance,E=mapUtil.parse2Geo(B.geo).points,P=!1,$=v.type,k=g[h-1]||{},L=k.type||0;if(1==$&&1==L&&(P=!0),c=e.stops.length,!P&&w>0||P&&w>10){l=e.routes.length;var R='<div class="cbtBusDetailRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+l+', this)"><div class="cbtBusDetailIconWalking"></div><div class="cbtTip">'+o._getFormatDistance(w)+'</div><div class="cbtDescFontSize">步行至<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+c+')">'+y+"</a></div></div>";m.push(R);var U="步行至"+y;p={name:U,points:E,type:CBusTrans.SEG_LINE_WALKING_TYPE,_lineIndex:n,_routeIndex:l},e.routes.push(p),a.push(l)}var N=v.name,O=v.type;N=o._getFormatBusLineName(N,O);var Y=mapUtil.parse2Geo(v.geo).points,A=v.station_num,G="乘坐"+N,D="乘坐"+N+",<br/> 约"+o._getFormatTime(v.time);i={desc:G,tip:D};var j=1==O?CBusTrans.STOP_TYPE_SUBWAY:CBusTrans.STOP_TYPE_BUS;r={uid:I,name:y+"上车",stopInfo:i,point:S,type:j,subType:CBusTrans.STOP_SUBTYPE_ON,_lineIndex:n,_stopIndex:c},e.stops.push(r);var M=C.getOff,F="站"==M.name.substr(M.name.length-1)?M.name:M.name+"站",W=M.uid||"",z=mapUtil.parse2Geo(M.geo).points;c=e.stops.length,l=e.routes.length;var H="cbtBusDetailIconBus",q="";1==O&&(H="cbtBusDetailIconSubway",C.walk.sname&&(q="("+C.walk.sname+")"));var V='<div class="cbtBusDetailRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+l+', this)"><div class="'+H+'"></div><div class="cbtTip">'+A+'站</div><div class="cbtDescFontSize">乘坐<span class="cbtBusLineName">'+N+", </span>"+o._getCombileLineName(_,h)+'在<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+c+')">'+F+"</a>下车"+q+"</div></div>";m.push(V),i={desc:""};var Z=1==O?CBusTrans.STOP_TYPE_SUBWAY:CBusTrans.STOP_TYPE_BUS;r={uid:W,name:F+"下车",stopInfo:i,point:z,type:Z,subType:CBusTrans.STOP_SUBTYPE_OFF,_lineIndex:n,_stopIndex:c},e.stops.push(r);var $=1==O?CBusTrans.SEG_LINE_SUBWAY_TYPE:CBusTrans.SEG_LINE_BUS_TYPE;if(p={name:N,points:Y,type:$,_lineIndex:n,_routeIndex:l},e.routes.push(p),a.push(l),h==T-1){var K=C.getOn,Q=t.end.wd||K.name,J=C.walk,X=J.distance,te=mapUtil.parse2Geo(J.geo).points;if(X>0){l=e.routes.length;var ee='<div class="cbtBusDetailRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+l+', this)"><div class="cbtBusDetailIconWalking"></div><div class="cbtTip">'+o._getFormatDistance(X)+'</div><div class="cbtDescFontSize">步行至'+Q+"</div></div>";m.push(ee);var ne="步行至"+Q;p={name:ne,points:te,type:CBusTrans.SEG_LINE_WALKING_TYPE,_lineIndex:n,_routeIndex:l},e.routes.push(p),a.push(l)}if(u){var se='<div class="cbtBusDetailTaxi"><a class="cbta" onclick="CBusTransInst._openTaxiPanel(event, '+n+", "+s+', this)">打车费用</a>(按驾车的最短路程计算)</div>';m.push(se)}}}return m.push("</div>"),m.join("")},_getFormatBusLineName:function(t,e){var n="";return 1==e?(t=t.indexOf("环(")>-1?t.substr(0,t.indexOf("环("))+"环)":t,t=t.indexOf("环")>-1?t:t.replace(/\(.*?-(.*?)\)/,"($1")+"方向)",n=t):(t=t.indexOf("(")>-1?t.substr(0,t.indexOf("(")):t,util.isInteger(t)&&(t+="路"),n=t),n},_getCombileLineName:function(t,e){var n=this;if(t.length>1){for(var s=[],a=t[0],i=a[e],o=0,r=0,c=a.length;c>r;r++)a[r].geo&&o++;for(var r=1,c=t.length;c>r;r++){var p=t[r],l=p[e];i.uid!=l.uid&&(s[l.uid]||(s[l.uid]=l.uid,s.push(n._getFormatBusLineName(l.name,l.type))))}return s.length>0?"(或"+s.join(", ")+")":""}return""},_getDrivingHtml:function(t,e,n,s){var a,i=this,o=t.start.wd,r=t.end.wd,c=e.stops.length,p=c+1,l=e.routes.length,d=i._getDrivingInfo(t);e.totalTime+=d.seconds;var u=['<div class="cbtSegRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+l+', this)">'];u.push('<div class="cbtSegIconDriving"></div><div class="cbtTip">'+d.timeDesc+'</div><div class="cbtDescFontSize">从<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+c+')">'+o+'</a>至<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+p+')">'+r+'</a>&nbsp;&nbsp;<a class="cbta" onclick="CBusTransInst._openDrivingDetail(event, '+n+", "+s+')">详情</a></div>'),u.push("</div>");var m=t.start,g=m.uid||"",b=m.wd,_=m.pt,h="由此驾车,<br/> 约"+d.timeDesc;a={desc:"由此驾车",tip:h};var T={uid:g,name:b+"开车",stopInfo:a,point:_,type:CBusTrans.STOP_TYPE_DRIVING,subType:CBusTrans.STOP_SUBTYPE_ST,_lineIndex:n,_stopIndex:c};e.stops.push(T);var v=t.end,f=v.uid||"",C=v.wd,x=v.pt;a={desc:"驾车结束"};var y={uid:f,name:C+"停车",stopInfo:a,point:x,type:CBusTrans.STOP_TYPE_DRIVING,subType:CBusTrans.STOP_SUBTYPE_ET,_lineIndex:n,_stopIndex:p};e.stops.push(y);var I="从"+b+"驾车到"+C,S={name:I,points:d.geoStr,type:CBusTrans.SEG_LINE_DRIVING_TYPE,_lineIndex:n,_routeIndex:l};return e.routes.push(S),u.join("")},_getDrivingInfo:function(t){for(var e=this,n=t.data.rss,s=[],a=0,i=n.length;i>a;a++){var o=n[a];if(o.g){var r=mapUtil.parse2Geo(o.g).points;s.push(r)}}var c=s.join(";"),p=t.data.time,l=e._getFormatTime(p),d={geoStr:c,timeDesc:l,seconds:p};return d},_getWalkingHtml:function(t,e,n,s){var a,i=this,o=t.start.wd,r=t.end.wd,c=e.stops.length,p=c+1,l=e.routes.length,d=i._getWalkingInfo(t);e.totalTime+=d.seconds;var u=['<div class="cbtSegRoute" onclick="CBusTransInst._highlightRoute(event, '+n+", "+l+', this)">'];u.push('<div class="cbtSegIconWalking"></div><div class="cbtTip">'+d.timeDesc+'</div><div class="cbtDescFontSize">从<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+c+')">'+o+'</a>至<a class="cbta" onclick="CBusTransInst._clickStop(event, '+n+", "+p+')">'+r+'</a>&nbsp;&nbsp;<a class="cbta" onclick="CBusTransInst._openWalkingDetail(event, '+n+", "+s+')">详情</a></div>'),u.push("</div>");var m=t.start,g=m.uid||"",b=m.wd,_=m.pt,h="由此步行,<br/> 约"+d.timeDesc;a={desc:"由此步行",tip:h};var T={uid:g,name:b+"步行",stopInfo:a,point:_,type:CBusTrans.STOP_TYPE_WALKING,subType:CBusTrans.STOP_SUBTYPE_ST,_lineIndex:n,_stopIndex:c};e.stops.push(T);var v=t.end,f=v.uid||"",C=v.wd,x=v.pt;a={desc:"步行结束"};var y={uid:f,name:C+"停步",stopInfo:a,point:x,type:CBusTrans.STOP_TYPE_WALKING,subType:CBusTrans.STOP_SUBTYPE_ET,_lineIndex:n,_stopIndex:p};e.stops.push(y);var I="从"+b+"步行到"+C,S={name:I,points:d.geoStr,type:CBusTrans.SEG_LINE_WALKING_TYPE,_lineIndex:n,_routeIndex:l};return e.routes.push(S),u.join("")},_getWalkingInfo:function(t){for(var e=this,n=t.data.rss,s=[],a=0,i=n.length;i>a;a++){var o=n[a];if(o.g){var r=mapUtil.parse2Geo(o.g).points;s.push(r)}}var c=s.join(";"),p=t.data.time,l=e._getFormatTime(p),d={geoStr:c,timeDesc:l,seconds:p};return d},_mouseOver:function(t){for(var e=this,n=this.json.content,s=n.length,a=0;s>a;a++){var i=T.G("list"+a);t==a?T.ac(i,"on"):T.rc(i,"on")}e.disAnotherHandler&&window.clearTimeout(e.disAnotherHandler),e.disAnotherHandler=window.setTimeout(function(){e._dispAnthorPly(t)},10)},_mouseOut:function(t){var e=this,n=T.G("list"+t);T.rc(n,"on"),e.hideAnotherHandler&&window.clearTimeout(e.hideAnotherHandler),e.hideAnotherHandler=window.setTimeout(function(){e._hideAnotherPlys()},10)},_dispAnthorPly:function(t){var e=this;if(t!=e.curLineIndex){var n=this.anotherPlys[t];if(n)n.show();else{for(var s=e.linesCache[t].routes,a=[],i=0,o=s.length;o>i;i++){var r=s[i],c=r.type;c!=CBusTrans.SEG_LINE_BUS_TITLE_TYPE&&a.push(r.points)}var p=a.join(";");n=mapUtil.addRoute(p,constants.ROUTE_TYPE_TEMP_BUS),this.anotherPlys[t]=n}}},_hideAnotherPlys:function(){for(var t=0,e=this.anotherPlys.length;e>t;t++){var n=this.anotherPlys[t];n&&n.hide()}},_openLineItem:function(t){var e=this,n=e.json.content,s=n.length,a=T.G("line"+t);if("block"!=a.style.display){for(var i=0;s>i;i++){var o=T.G("line"+i),r=T.G("swt"+i),c=T.G("list"+i),p=T.G("lineTitle"+i);i==t?(o.style.display="block",r.className="cbtSwitchOn",T.ac(c,"active"),T.ac(c,"open"),p.className="cbtLineTitleOpen",e.curLineIndex!=t&&(e._renderLineInMap(t),e.curLineIndex=t)):(o.style.display="none",r.className="cbtSwitchOff",T.rc(c,"active"),T.rc(c,"open"),p.className="cbtLineTitleClose")}Share.listIndex=t,e.scrollPanel.update(),SchemeFaver.isRepeat.call(this,{pathtype:9,dom:T.G(this.guid+"_favbtn_"+t)})}},_switchLineItem:function(t,e){var n=this,s=T.G("line"+e),a=T.G("lineTitle"+e),i=T.G("list"+e);if("none"==s.style.display||""==s.style.display)n._openLineItem(e);else{s.style.display="none";var o=T.G("swt"+e);o.className="cbtSwitchOff",a.className="cbtLineTitleClose",T.rc(i,"open")}n.scrollPanel.update(),util.stopBubble(t)},_renderLineInMap:function(t){try{var e=this;e._clearCurOverlays(),e._hideAnotherPlys();var n=e.linesCache[t],s=n.stops,a=n.routes;e._renderPlys(a),e._renderMkrs(s),e.curMapZoomLevel=map.zoomLevel}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:2226})}},_renderPlys:function(t){try{for(var e=this,n=0,s=t.length;s>n;n++){{var a,i=t[n],o=i.type,r=i.points;i._routeIndex}switch(o){case CBusTrans.SEG_LINE_RAILWAY_TYPE:case CBusTrans.SEG_LINE_AIR_TYPE:case CBusTrans.SEG_LINE_BUS_TYPE:case CBusTrans.SEG_LINE_DRIVING_TYPE:case CBusTrans.SEG_LINE_SUBWAY_TYPE:a=mapUtil.addRoute(r,constants.ROUTE_TYPE_BUS);break;case CBusTrans.SEG_LINE_RAILWAY_DASHED_TYPE:a=mapUtil.addRoute(r,constants.ROUTE_TYPE_RAIL_DASHED);break;case CBusTrans.SEG_LINE_WALKING_TYPE:var c=t[n-1]?t[n-1].type:null,p=t[n-1]?t[n-1].points:null,l=t[n+1]?t[n+1].type:null,d=t[n+1]?t[n+1].points:null,u=e._adjustWalkingGeoStr(r,c,p,l,d);a=mapUtil.addRoute(u,constants.ROUTE_TYPE_WALK);break;case CBusTrans.SEG_LINE_BUS_TITLE_TYPE:a={routeNos:r}}a._type=o,e.curOverlays.polylines.push(a)}}catch(m){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:m.message||m.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:2277})}},_adjustWalkingGeoStr:function(t,e,n,s,a){var i="",o="";return e==CBusTrans.SEG_LINE_SUBWAY_TYPE&&n&&(i=n.substr(n.lastIndexOf(";")+1),t=i+";"+t),s==CBusTrans.SEG_LINE_SUBWAY_TYPE&&a&&(o=a.substr(0,a.indexOf(";")),t=t+";"+o),t},_renderMkrs:function(t){try{for(var e=this,n=[],s=0,a=t.length;a>s;s++){var i=t[s],o=t[s+1]||null,r=i.type,c=(i.subType,i.point),p=c.split(","),l=p[0],d=p[1],u=new BMap.Point(l,d);n.push(u);var m;switch(r){case CBusTrans.STOP_TYPE_START:m=mapUtil.addDestPoi(c,"",constants.DEST_START),m.enableDragging(),m.addEventListener("dragstart",function(){this.closeInfoWindow()}),m.addEventListener("dragend",function(){var t=this;e._startMkrDragEnd(t)}),m._name=i.name,m._uid=i.uid,m._sc=e.startCity.code,window.startPoi=m,m.setZIndex(20);break;case CBusTrans.STOP_TYPE_END:m=mapUtil.addDestPoi(c,"",constants.DEST_END),m.enableDragging(),m.addEventListener("dragstart",function(){this.closeInfoWindow()}),m.addEventListener("dragend",function(){var t=this;e._endMkrDragEnd(t)}),m._name=i.name,m._uid=i.uid,m._ec=e.endCity.code,window.endPoi=m,m.setZIndex(20);break;case CBusTrans.STOP_TYPE_RAIL:m=mapUtil.addTransPoi(c,constants.TRANS_TYPE_RAIL),m.setZIndex(10);break;case CBusTrans.STOP_TYPE_AIR:m=mapUtil.addTransPoi(c,constants.TRANS_TYPE_AIR),m.setZIndex(10);break;case CBusTrans.STOP_TYPE_BUS:m=mapUtil.addTransPoi(c,constants.TRANS_TYPE_BUS);break;case CBusTrans.STOP_TYPE_SUBWAY:m=mapUtil.addTransPoi(c,constants.TRANS_TYPE_SUB);break;case CBusTrans.STOP_TYPE_DRIVING:m=mapUtil.addTransPoi(c,constants.TRANS_TYPE_DRIVING);break;case CBusTrans.STOP_TYPE_WALKING:m=mapUtil.addTransPoi(c,constants.TRANS_TYPE_WALKING)}m._indexNo=s,m.addEventListener("click",function(){var t=this._indexNo;e._clickMkr(t)});var g=i.name,b=i.stopInfo.desc||"",_=o?o.name:"",h={title:g,content:b,curIndex:s,total:a,obj:e,transUid:"",nextInfo:_,nextTransCbk:e._nextTransCbk,zoomTransCbk:e._zoomTransCbk},T=transInfo.createTransInfoWnd(h);e.curOverlays.mkrs.push(m),e.curOverlays.infoWins.push(T);var u=m.getPoint();e._createGetOnMkrTip(i,u)}mapUtil.setViewport(n,10),e._zoomEndFunc(e)}catch(v){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/CBusTrans/exception.fire","catch",{msg:v.message||v.description,path:"common:widget/com/CBusTrans/CBusTrans.js",ln:2430})}},_createGetOnMkrTip:function(t,e){var n=this;if(t.subType==CBusTrans.STOP_SUBTYPE_ON||t.subType==CBusTrans.STOP_SUBTYPE_ST){var s=t.stopInfo.tip||"";if(s){var a=mapUtil.createTip(s,"TipC2",{point:e,offset:new BMap.Size(8,-57),style:{background:"url(http://webmap2.map.bdstatic.com/newmap/static/common/images/tip2_04a17e7.gif) 0 0 no-repeat",color:"#000",height:"48px",border:"0",padding:"0 0 0 4px"}}),i=t.type;a._type=i;var o=map.getZoom();11>=o&&(i==CBusTrans.STOP_TYPE_RAIL||i==CBusTrans.STOP_TYPE_AIR||i==CBusTrans.STOP_TYPE_DRIVING?a.show():a.hide()),n.curOverlays.tipMkrs.push(a)}}},_addZoomEndListener:function(){var t=this;map.addEventListener("zoomend",t._zoomEndFunc)},_removeZoomEndListener:function(){var t=this;map.removeEventListener("zoomend",t._zoomEndFunc)},_zoomEndFunc:function(){for(var t=CBusTransInst,e=map.getZoom(),n=0,s=t.curOverlays.tipMkrs.length;s>n;n++){var a=t.curOverlays.tipMkrs[n],i=a.getLabel();if(e>11)a.show(),i&&i.setStyle({visibility:"visible",display:"inline"});else{var o=a._type;o==CBusTrans.STOP_TYPE_RAIL||o==CBusTrans.STOP_TYPE_AIR||o==CBusTrans.STOP_TYPE_DRIVING?(a.show(),i&&i.setStyle({visibility:"visible",display:"inline"})):(a.hide(),i&&i.setStyle({visibility:"hidden",display:"none"}))}}},_startMkrDragEnd:function(t){{var e=t.getPoint();e.lng+","+e.lat}mapUtil.getGEORevertAddress(e,function(t){CBusTransInst._startMkrDragEndCbk(t)})},_startMkrDragEndCbk:function(t){var e=this,n=t.content||{},s=n.address||"未知路段",a=window.startPoi.getPoint(),i=a.lng+","+a.lat,o=n.address_detail?n.address_detail.city_code:modelConfig.cityCode,r=window.endPoi._name,c=window.endPoi.getPoint(),p=c.lng+","+c.lat,l=window.endPoi._uid,d=e.endCity.code,u=modelConfig.cityCode;o==d&&(u=o);var m="bt&c="+u+"&sc="+o+"&ec="+d+"&sn=1$$$$"+i+"$$"+encodeURIComponent(s)+"$$$$$$&en=1$$"+l+"$$"+p+"$$"+encodeURIComponent(r)+"$$$$$$&rn="+e.pageCap;componentManager.go(m)},_endMkrDragEnd:function(t){{var e=t.getPoint();e.lng+","+e.lat}mapUtil.getGEORevertAddress(e,function(t){CBusTransInst._endMkrDragEndCbk(t)})},_endMkrDragEndCbk:function(t){var e=this,n=t.content||{},s=n.address||"未知路段",a=window.endPoi.getPoint(),i=a.lng+","+a.lat,o=n.address_detail?n.address_detail.city_code:modelConfig.cityCode,r=window.startPoi._name,c=window.startPoi.getPoint(),p=c.lng+","+c.lat,l=window.startPoi._uid,d=e.startCity.code,u=modelConfig.cityCode;d==o&&(u=d);var m="bt&c="+u+"&sc="+d+"&ec="+o+"&sn=1$$"+l+"$$"+p+"$$"+encodeURIComponent(r)+"$$$$$$&en=1$$$$"+i+"$$"+encodeURIComponent(s)+"$$$$$$&rn="+e.pageCap;componentManager.go(m)},_clickMkr:function(t){var e=this,n=e.curOverlays,s=n.mkrs,a=n.infoWins,i=s[t],o=a[t];transInfo.transInfoWindow(i,o)},_nextTransCbk:function(t,e){var n=e.curOverlays,s=n.mkrs[t],a=n.infoWins[t];transInfo.transInfoWindow(s,a);var i=s.getPoint();util.isInBounds(i)||map.setCenter(i)},_zoomTransCbk:function(t,e){var n=BMap.MapType[map.mapType].zoomLevelMax;map.zoomTo(0==t?n:e.curMapZoomLevel!=map.zoomLevel?e.curMapZoomLevel:n-3)},_clearCurOverlays:function(){for(var t=this,e=t.curOverlays.mkrs,n=t.curOverlays.polylines,s=t.curOverlays.infoWins,a=t.curOverlays.tipMkrs,i=0,o=e.length;o>i;i++){var r=e[i];map.removeOverlay(r),r=null}e.length=0;for(var i=0,o=a.length;o>i;i++){var c=a[i],p=c.getLabel();map.removeOverlay(c),map.removeOverlay(p),c=null,p=null}a.length=0;for(var i=0,o=s.length;o>i;i++){var l=s[i];l=null}s.length=0;for(var i=0,o=n.length;o>i;i++){var d=n[i];d._type!=CBusTrans.SEG_LINE_BUS_TITLE_TYPE&&mapUtil.removeRoute(d)}n.length=0,t.preSelectedDom&&(t.preSelectedDom.style.backgroundColor="transparent")},_clickStop:function(t,e,n){var s=this,a=s.curOverlays,i=a.mkrs[n],o=a.infoWins[n];transInfo.transInfoWindow(i,o);var r=i.getPoint();map.setCenter(r),util.stopBubble(t)},_highlightRoute:function(t,e,n,s){var a=this;a.preSelectedDom&&(a.preSelectedDom.style.backgroundColor="transparent"),s.style.backgroundColor="#DDDDDD",a.preSelectedDom=s,a.preHightRoute&&(a.preHightRoute._type==CBusTrans.SEG_LINE_BUS_TITLE_TYPE?a._unhighlightTitleRoute(a.preHightRoute):mapUtil.unSelectRoute(a.preHightRoute));var i=a.curOverlays.polylines[n],o=i._type;switch(o){case CBusTrans.SEG_LINE_RAILWAY_TYPE:case CBusTrans.SEG_LINE_RAILWAY_DASHED_TYPE:case CBusTrans.SEG_LINE_AIR_TYPE:case CBusTrans.SEG_LINE_BUS_TYPE:case CBusTrans.SEG_LINE_DRIVING_TYPE:case CBusTrans.SEG_LINE_WALKING_TYPE:case CBusTrans.SEG_LINE_SUBWAY_TYPE:mapUtil.selectRoute(i);var r=i.getPoints();mapUtil.setViewport(r,10);break;case CBusTrans.SEG_LINE_BUS_TITLE_TYPE:a._highlightTitleRoute(i)}a._zoomEndFunc(a),a.preHightRoute=i,util.stopBubble(t)},_highlightTitleRoute:function(t){for(var e=this,n=e.curOverlays.polylines,s=t.routeNos,a=[],i=0,o=s.length;o>i;i++){var r=s[i],c=n[r];mapUtil.selectRoute(c),a=a.concat(c.getPoints())}mapUtil.setViewport(a,10)},_unhighlightTitleRoute:function(t){for(var e=this,n=e.curOverlays.polylines,s=t.routeNos,a=0,i=s.length;i>a;a++){var o=s[a],r=n[o];mapUtil.unSelectRoute(r)}},_openDrivingDetail:function(t,e,n){var s=this,a=s.json.content,i=a[e][n];s._openInNewPage(i,"nav"),util.stopBubble(t)},_openWalkingDetail:function(t,e,n){var s=this,a=s.json.content,i=a[e][n];s._openInNewPage(i,"walk"),util.stopBubble(t)},_openInNewPage:function(t,e){var n,s,a,i=t.start.wd,o=t.start.pt,r=t.start.uid||"",c=t.end.wd,p=t.end.pt,l=t.end.uid||"";"nav"==e?(n=t.end_city,s=t.start_city,a=t.end_city):(n=t.code,s=t.code,a=t.code);var d=(t.code,e+"&c="+n+"&sc="+s+"&ec="+a+"&sy=0&sn=1$$"+r+"$$"+o+"$$"+i+"$$$$&en=1$$"+l+"$$"+p+"$$"+c+"$$$$");d=CBusTrans.OPEN_URL+encodeURIComponent(d)+"sr=1",window.open(d)},_openBusDetail:function(t,e,n){var s="busDetail_"+e+"_"+n,a=T.G(s),i="busDetailTip_"+e+"_"+n,o=T.G(i);"none"==a.style.display||""==a.style.display?(a.style.display="block",o.innerHTML="收起",addStat("crosscitybusscheme.crosscitybl.detailsaboutccbl","show")):(a.style.display="none",o.innerHTML="详情",addStat("crosscitybusscheme.crosscitybl.detailsaboutccbl","hide")),this.scrollPanel.update(),util.stopBubble(t)},_openTaxiPanel:function(t,e,n,s){var a=this,i=a.json.content,o=i[e][n],r=o.code,c=o.start,p=c.wd,l=c.uid||"",d=c.pt,u=o.end,m=u.wd,g=u.uid||"",b=u.pt,_="nav&navtp=0&sy=0&drag=0&st=1&et=1&c="+r+"&sc="+r+"&ec="+r+"&sn=1$$"+l+"$$"+d+"$$"+encodeURIComponent(p)+"$$$$$$&en=1$$"+g+"$$"+b+"$$"+encodeURIComponent(m)+"$$$$$$&sq="+encodeURIComponent(p)+"&eq="+encodeURIComponent(m),h={query:_},T=!0;taxi.openTaxi(s,h,T),util.stopBubble(t)},_printMap:function(t,e){util.stopBubble(e),require.async("common:widget/ui/PrintMap/PrintMap.js",function(e){e.printMap(t)})},_sendToPhone:function(t,e){util.stopBubble(e),sms.ready(t,"bt")},_selTransToolType:function(t){var e=this;e._initStrategyTy(t),e.strategyChange()},_selTransTimeType:function(){var t=this;t.strategyChange({from:1})},strategyChange:function(t){t=t||{};var e=this,n=e.start,s=e.end,a=e.startCity,i=e.endCity,o=n.wd,r=n.pt,c=n.uid||"",p=a.code,l=s.wd,d=s.pt,u=s.uid||"",m=i.code,g=e._getStrategyParam(),b="bt&c="+modelConfig.cityCode+"&sn=1$$"+c+"$$"+r+"$$"+encodeURIComponent(o)+"$$$$$$&en=1$$"+u+"$$"+d+"$$"+encodeURIComponent(l)+"$$$$$$&sc="+p+"&ec="+m+"&rn="+e.pageCap+g;t&&1==t.from&&(b+="&reqtp=1"),componentManager.go(b)},_initStrategy:function(){var t=this,e=t.json.result,n=e.cty||0,s=e.csy||0;t._initStrategyTy(n),t._initStrategySy(s)},_initStrategyTy:function(t){var e=T.G("cbtToolRail"),n=T.G("cbtToolAir");0==t?(T.ac(e,"cbtTansToolRailOpen"),T.rc(e,"cbtTansToolRailClose"),e.style.fontWeight=700,e._selected=!0,T.ac(n,"cbtTansToolAirClose"),T.rc(n,"cbtTansToolAirOpen"),n.style.fontWeight=100,n._selected=!1):(T.ac(e,"cbtTansToolRailClose"),T.rc(e,"cbtTansToolRailOpen"),e.style.fontWeight=100,e._selected=!1,T.ac(n,"cbtTansToolAirOpen"),T.rc(n,"cbtTansToolAirClose"),n.style.fontWeight=700,n._selected=!0)},_initStrategySy:function(t){var e=T.G("cbtType"+t);e.checked=!0},_back:function(){addStat("crosscitybusscheme.crosscitybl.showreturn");var t=this,e=t.start,n=t.end,s=t.startCity,a=t.endCity,i=e.wd,o=e.pt,r=e.uid||"",c=s.code,p=n.wd,l=n.pt,d=n.uid||"",u=a.code,m=t._getStrategyParam(),g="bt&c="+modelConfig.cityCode+"&sn=1$$"+d+"$$"+l+"$$"+encodeURIComponent(p)+"$$$$$$&en=1$$"+r+"$$"+o+"$$"+encodeURIComponent(i)+"$$$$$$&sc="+u+"&ec="+c+"&rn="+t.pageCap+m;componentManager.go(g)},_switchToNav:function(){var t=this;addStat("crosscitybusscheme.crosscitybl.shownav"),searchBox.setSwitchTab(3),componentManager.go(t.navQueryString)},_reSelectAddr:function(){addStat("crosscitybusscheme.crosscitybl.reslectterminal");var t=this,e=t.result,n=t.start,s=t.end,a=t.startCity,i=t.endCity,o=e.s_query,r=n.pt,c=n.uid||"",p=a.code,l=e.e_query,d=s.pt,u=s.uid||"",m=i.code,g=t._getStrategyParam(),b="bt&c="+modelConfig.cityCode+"&sn=2$$"+c+"$$"+r+"$$"+encodeURIComponent(o)+"$$$$$$&en=2$$"+u+"$$"+d+"$$"+encodeURIComponent(l)+"$$$$$$&sc="+p+"&ec="+m+"&rn="+t.pageCap+g+"&src=4";componentManager.go(b)},_getStrategyParam:function(){var t=0,e=0,n=T.G("cbtToolRail");t=1==n._selected?0:1;var s=T.G("cbtType0"),a=T.G("cbtType1"),i=T.G("cbtType2");s.checked?e=0:a.checked?e=1:i.checked&&(e=2);var o="&cty="+t+"&csy="+e;return o},_stragyOver:function(t,e){0==e?t._selected?T.ac(t,"cbtROpenOver"):T.ac(t,"cbtRCloseOver"):t._selected?T.ac(t,"cbtAOpenOver"):T.ac(t,"cbtACloseOver")},_stragyOut:function(t,e){0==e?(T.rc(t,"cbtROpenOver"),T.rc(t,"cbtRCloseOver")):(T.rc(t,"cbtAOpenOver"),T.rc(t,"cbtACloseOver"))},addToFav:function(t){var e=this;SyncMgr.checkFav(function(){SchemeFaver.toClound.call(e,{pathtype:9,dom:t})},this)}}),module.exports=CBusTrans});