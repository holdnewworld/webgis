define("common:widget/com/PoiSearch/PoiSearch.js",function(require,exports,module){function loadCss(){var t='#txtPanel .buslineInfo,#txtPanel .sublineInfo{background:0 0;height:30px;line-height:30px;color:#999}#txtPanel .buslineInfo td{vertical-align:middle;border-right:1px solid #9cb5ff;border-top:1px solid #ccdafd;border-bottom:1px solid #ccdafd}#txtPanel .sublineInfo td{vertical-align:middle;border-right:1px solid #9cb5ff;border-top:1px solid #9cb5ff;border-bottom:1px solid #ccdafd}#txtPanel .sublineInfo th{border-left:1px solid #9cb5ff;border-top:1px solid #9cb5ff;border-bottom:1px solid #ccdafd}#txtPanel .buslineInfo th{border-left:1px solid #9cb5ff;border-top:1px solid #ccdafd;border-bottom:1px solid #ccdafd}#txtPanel .addBorderTop td{vertical-align:middle;border-right:1px solid #9cb5ff;border-top:1px solid #9cb5ff;border-bottom:0}#txtPanel .addBorderTop th{border-left:1px solid #9cb5ff;border-top:1px solid #9cb5ff;border-bottom:0}#txtPanel .buslineDetails{border-left:1px solid #9cb5ff;border-right:1px solid #9cb5ff;border-bottom:1px solid #9cb5ff}#txtPanel .buslinePrice{color:#999;float:right;margin-right:5px}#txtPanel .bus-type{margin-top:5px;margin-right:5px;width:41px;height:17px;float:left;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bus_tp_4626a24.gif)}#txtPanel .bus-time{margin-top:4px}#txtPanel .bus-type-default{background-position:0 0}#txtPanel .bus-type-0{background-position:0 -17px}#txtPanel .bus-type-1{background-position:0 -34px}#txtPanel .bus-type-2{background-position:0 -51px}#txtPanel .bus-type-3{background-position:0 -68px}#txtPanel .bus-type-4{background-position:0 -85px}#txtPanel .addBorderTop{color:#3d6dcc}#txtPanel .panelFocus{background:#ebf1fb}#txtPanel .busStopFocus{background:#f4f4f4}#POI_TABLE_LST{border-collapse:collapse}#BL_TABLE_LST{border-collapse:collapse;width:100%}#BL_TABLE_LST th{width:31px}#BL_TABLE_LST div.bl_icon{margin-left:7px;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif) no-repeat -103px -212px;width:19px;height:20px}#more_busline{height:25px;line-height:25px;background:#f8f9fc;border:1px solid #e9e9e9}#more_busline p{padding-left:63px;width:190px;height:23px;line-height:25px;font-size:13px;color:#4c73c2}#POI_TABLE_LST .hoverstyle{background:#eff5fe;cursor:pointer;*cursor:hand}#BL_TABLE_LST .hoverstyle{background:#eff5fe;cursor:pointer;*cursor:hand}#showAllResults a.map_btn .map_btn_l{display:inline-block;width:300px;text-align:center}#showAllResults a.map_btn .map_btn_r{padding-right:10px}#showAllResults a.map_btn:hover .map_btn_l,a.map_btn:active .map_btn_l{background-position:left 0}#showAllResults a.map_btn span{display:inline-block;background-image:none;height:30px;line-height:40px;color:#4c73c2}div#showallDivBtn{height:40px;line-height:40px;text-align:center}div#showallDivBtn a,div#showallDivBtn a:hover{color:#4c73c2}.tuan-guid .tuan{display:block;width:48px;height:48px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/icon_magicbox_16bad9f.png) no-repeat 2px 2px}.tuan-guid{margin:10px}.tuan-guid li{width:316px;position:relative;height:67px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/new_index_00afcec.png) 0 -375px;margin-bottom:5px;cursor:pointer}.tuan-guid a{display:block;height:59px;padding:8px 30px 0 60px;text-decoration:none;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/new_index_00afcec.png) 0 -375px}.tuan-guid a:hover{text-decoration:none}.tuan-guid img{position:absolute;left:5px;top:9px}.tuan-guid b{font-weight:100;color:#4c73c2}.tuan-guid p{line-height:18px;color:#000}.tuan-guid li.hover{background-position:0 -449px}.tuan-guid li.hover a{background-position:right -449px}a.map_btn{text-decoration:none;cursor:pointer;color:#000}.result td a.map_btn span{display:inline-block;background-image:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/map_btn_46a538f.png);background-repeat:no-repeat;height:22px;line-height:22px;color:#000}a.map_btn .map_btn_l{background-position:left 0;padding-left:10px}a.map_btn .map_btn_r{background-position:right -22px;padding-right:10px}a.map_btn:hover .map_btn_l,a.map_btn:active .map_btn_l{background-position:left -44px;padding-left:10px}a.map_btn:hover .map_btn_r,a.map_btn:active .map_btn_r{background-position:right -66px;padding-right:10px}#POI_TABLE_LST a{text-decoration:none}#POI_TABLE_LST .bus a.firstCon{float:left;display:inline-block;_display:block;_zoom:1}#POI_TABLE_LST a:hover,#POI_TABLE_LST a:focus{text-decoration:underline}#BL_TABLE_LST a{text-decoration:none}#BL_TABLE_LST .bus a.firstCon{float:left;display:inline-block;_display:block;_zoom:1}#BL_TABLE_LST a:hover,#BL_TABLE_LST a:focus{text-decoration:underline}.correct_jiu{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/icon_qipao_d0c2524.png) no-repeat scroll 0 0 transparent;height:12px;margin:-2px 3px 0 0;vertical-align:middle;width:13px}.pano_poi{height:18px;margin:3px 8px 0 0;width:18px;float:right;text-align:right;color:#3C6FCB;text-decoration:none;display:block;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_bg_new_3569ebd.gif) no-repeat scroll -86px -31px transparent;*background-position:-86px -33px}.pano_poi .street_view_poi:hover{text-decoration:underline}.street_view_poi{height:18px;margin:1px 6px 0 0;width:42px;float:right;text-align:right;color:#3C6FCB;text-decoration:none;display:block;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_c1d9c10.png) no-repeat scroll 0 -259px transparent;*width:45px;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_png8_d133824.png) no-repeat 0 -259px transparent;*background-position:0 -208px;_padding-top:5px}#result_page_c{margin:5px -10px 0 -8px}.poi-children{margin-top:8px;margin-bottom:3px}.poi-children ul.poi-children-nav{color:#666;width:100%;height:26px;line-height:26px;margin-bottom:5px;border-bottom:solid #e1e1e1 1px}.poi-children li.child-active{border-top:solid #e1e1e1 1px;border-left:solid #e1e1e1 1px;border-right:solid #e1e1e1 1px;border-bottom:solid #fff 1px;color:#333;font-weight:700}.focus-over li.child-active,.focus li.child-active{border-bottom:solid #f6f6f6 1px}.poi-children ul.poi-children-nav li{float:left;padding-right:9px;padding-left:9px;height:25px;line-height:25px;text-align:center;cursor:pointer}#POI_TABLE_LST ul.poi-children-list{color:#36C;width:100%;margin-bottom:2px;margin-top:2px}#POI_TABLE_LST ul.children-list-hide{display:none}#POI_TABLE_LST ul.poi-children-list li{line-height:18px;margin-left:10px}#POI_TABLE_LST ul.poi-children-list li.normal-child{margin-left:0}.poi-children div.poi-pchild-nav{height:31px;line-height:31px;#line-height:31px;_line-height:31px;width:100%;color:#36c;padding-left:13px;margin-left:-13px;border-top:solid #e1e1e1 1px;-moz-user-select:none;position:relative}.poi-pchild-click{font-family:"微软雅黑";float:left;cursor:pointer;width:100%;position:relative}.poi-pchild-click:hover{font-weight:700}.poi-children .pchild-nav-active{font-weight:700}.poi-children div.poi-child-mod{overflow:hidden;padding-right:5px}.poi-children div.poi-child-hide{display:none}.poi-children div.pchild-arrow{float:right;width:32px;height:32px;cursor:pointer;background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/child-arrow_9002af7.gif) no-repeat;position:absolute;right:0}.poi-children div.pchild-dw{background-position:0 -32px}.poi-children div.pchild-up{background-position:0 0}.poi-children div.pchild-dw:hover{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/child-arrow-hover_decf54b.gif) no-repeat;background-position:0 -32px}.poi-children div.pchild-up:hover{background:url(http://webmap1.map.bdstatic.com/newmap/static/common/images/child-arrow-hover_decf54b.gif) no-repeat;background-position:0 0}#BL_TABLE_LST .poi-child-link{color:#496ce0;text-decoration:underline}#POI_TABLE_LST .poi-child-link{color:#496ce0;text-decoration:none}#screening{_position:relative;_z-index:2}#txtPanel{_position:relative;_z-index:0}.dataValidator{position:relative}.dataValidator .markTitle{width:170px;padding-left:20px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/suspecteddata_b98be68.gif) no-repeat 0 3px;color:#999}.suspectedData{color:#3d6dcc;height:23px;line-height:23px;width:40px;margin-right:5px}.thx4Right{position:absolute;display:block;right:1px;bottom:22px;padding:2px 20px 2px 5px;width:105px;height:22px;line-height:22px;background:#fcfef1;border:1px solid #dcb147;color:#63666a;z-index:1000;_left:-50px;_top:-30px}.thx4Wrong{position:absolute;display:block;right:1px;bottom:22px;width:105px;height:66px;padding:2px 20px 2px 5px;line-height:22px;background:#fcfef1;border:1px solid #dcb147;color:#63666a;z-index:1000;_left:-50px;_top:-75px}.thx4Right span,.thx4Wrong span{position:absolute;top:7px;right:6px;width:10px;height:10px;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/closeIcon_7777f8d.gif) no-repeat center;zoom:1;_top:6px}.nb_dis{float:right;margin-right:4px;display:block;*position:absolute;*right:80px}.poiTitleW--long{width:240px}.poiTitleW .busline_title{font-size:15px;font-weight:700;padding-right:6px;color:#3d6dcc}.poiTitleW .busline_stops{color:#666}a.btn_bus_show{float:left}p.space_tip{margin-bottom:10px}.sugg_query{padding:5px;margin:10px 10px 0}.sugg_query a,.su_muti_q a,.su_uniq_q a{line-height:25px;text-decoration:none;color:#36c}.sugg_query a:hover,.su_muti_q a:hover{text-decoration:underline}.sugg_query .sugg_return_query{color:#ee0303}.sugg_query .sugg_src_query{font-family:arial;color:#36c}.su_uniq_q{background-color:#e5eeff;padding:8px}.su_muti_q{padding-left:10px;line-height:18px;zoom:1;margin:0}.sugg_query{padding:5px;margin:8px 10px 0}.sugg_q_result,.sugg_q_wd,.jump_black{margin:8px 10px 0;padding:5px 10px;background-color:#e5eeff;line-height:25px}.sugg_q_result a,.jump_black a,.sugg_q a{text-decoration:none;color:#36c;margin-right:10px}.sugg_q_result a:hover,.jump_black a:hover,.sugg_q a:hover{text-decoration:underline}.sugg_q_wd b{color:#ee0303;font-weight:700}.sugg_q{padding:10px;line-height:18px}a.orign_search{margin:0}';require.loadCss({content:t,name:"PoiSearch"})}function PoiSearch(t){MapComponent.call(this,t),window.PoiSearchInst=this,this.MAX_RESULT_COUNT=760,this.itemsPerPage=10,this.curSelA=null,this.cmdNo=45,this.points=[],this.childPoints=[],this.childItems=[],this.uids=[],this.markers=[],this.childMarkers=[],this.childDisplay={},this.fatherIndex=[],this.infoWnds=[],this.busStopPois=[],this.stationPoints=[],this.showIconIndices=[],this.isShowAllBtn=!1,this.busLineUid=[],this.showBusLine=!1,PoiSearchInst.timeFeeInfo={},this.pl_stat="",this.curKw="",this.sugKw="",this.curItemPPage=0,this.curPage=0,this.totalCount=0,this.totalPage=0,this.buslineTotalPage=0,this.childMarkerIndex=0,this.childHTMLIndex=0,this.childBindIndex=0,this.curSelIndex=-1,this.curChildIndex=-1,this.lastSelection="",this.bizCount=0,this.centerPt=null,this.centerPoi=null,this.cInfoWnd=null,this.radius=0,this.isnbSearch=!1,this.ctrPoiName="未知地点",this.ctrPoiUid="",this.busPolylines=[],this.normPolylines=[],this.normPolygons=[],this.stationTips=[],this.sCityCode=0,this.sCityName="",this.reIndex=[],this.isGRequest=!1,this.isOnlyShowMainRes=!0,this.mainResNo=0,this.isShowAllRes=!1,this.isShowJumpBack=!1,this.placeRe=window.place.placeRe,this.placeConfig=window.place.placeConfig,this.routeStartEndMkr=[],Share.setSmSCode(0),window.clearClarify&&clearClarify()}var MapComponent=require("common:widget/com/MapComponent.js"),comMgr=require("common:widget/com/componentManager.js"),stat=require("common:widget/ui/stat/CodeStat.js"),config=require("common:widget/ui/config/config.js"),util=require("common:widget/ui/util/util.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),constant=require("common:widget/ui/constant/Constant.js"),searchData=require("common:widget/ui/searchData/searchData.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),sms=require("common:widget/ui/sms/sms.js"),mapInfoScrollPanel=require("common:widget/ui/mapInfoScroll/mapInfoScroll.js"),SyncMgr=require("common:widget/ui/SyncMgr/SyncMgr.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),Page=require("common:widget/ui/page/Page.js"),NbSearch=require("common:widget/ui/NbSearch/NbSearch.js"),iKnow=require("common:widget/ui/iKnow/iKnow.js"),Share=require("common:widget/ui/mapShare/MapShare.js"),BShare=require("common:widget/ui/toolShare/ToolShare.js"),sateCityList=require("common:widget/ui/sateCityList/SateCityList.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),PanoEntranceUtil=require("common:widget/ui/PanoEntranceUtil/PanoEntranceUtil.js"),weather=require("common:widget/ui/Weather/Weather.js"),ClearBase=require("common:widget/ui/ClearBase/ClearBase.js"),placeEntrance=require("common:widget/ui/place/placeEnter.js"),PanoInterface=require("common:widget/pano/PanoInterface/PanoInterface.js"),GenRequest=require("common:widget/ui/genericRequest/GenericRequest.js");window.GRControll||(window.GRControll=new GenRequest({toolAreaId:"GR_Select"}));var MapConfig=config.mapConfig,modelConfig=config.modelConfig,hasRevertUrl,NOPIC="../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/nopic_96d29d1.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/nopic_96d29d1.gif*/;T.inherits(PoiSearch,MapComponent,"PoiSearch"),T.extend(PoiSearch.prototype,{render:function(){try{loadCss();var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="route_contentWrapper_poi">    <div id="main_result_content" class="result_holder">        <div id="poiAdContainer" >',"undefined"==typeof new_cms_ad?"":new_cms_ad,"</div>     ","undefined"==typeof suggest_query?"":suggest_query,"","undefined"==typeof pinyin_suggest?"":pinyin_suggest,""),jump_back&&_template_fun_array.push('           <p class="jump_black">已切换至<b>',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==typeof json.current_city.name?"":json.current_city.name,'</b>，<a class="orign_search" onclick="baiduInstance(&#39;',"undefined"==typeof guid?"":guid,"&#39;).cnameSearch(&#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==typeof json.result.wd?"":json.result.wd,"&#39;,&#39;","undefined"==typeof startCityCode?"":startCityCode,'&#39;, 3);return false;" href="javascript:void(0)">点击查看</a><b>',"undefined"==typeof startCityName?"":startCityName,"</b>的搜索结果</p>"),_template_fun_array.push("        "),showTuan&&_template_fun_array.push('                  <div class="tuan-guid" tid="searchtuanbox">        <ul>        <li onmouseover="T.ac(this,\'hover\')" onmouseout="T.rc(this,\'hover\')" >        <a id="nuomi_guid" href="http://www.nuomi.com/?cid=map_pc_icon" title="团购" target="_blank">        <img src="',"/newmap/static/common/images/transparent.gif",'"  class="tuan" />        <b>团购</b>        <p>提供',"undefined"==typeof(json.current_city.cname||json.current_city.name)?"":json.current_city.cname||json.current_city.name,"的美食、娱乐、生活服务、酒店旅游团购分布图</p>        </a>        </li>        </ul>          </div>        "),_template_fun_array.push("  "),("undefined"!=typeof result_title||"undefined"!=typeof screening)&&_template_fun_array.push('   <div id="screening">   ',"undefined"==typeof result_title?"":result_title,"      ","undefined"==typeof screening?"":screening,"   </div>    "),_template_fun_array.push("   ","undefined"==typeof no_result_title?"":no_result_title,'         <div id="txtPanel" class="mapinfo_con">',"undefined"==typeof satequery_suggest?"":satequery_suggest,""),json.space_poi&&_template_fun_array.push('                    <p class="space_tip" >您是否要<a href="javascript:void(0)" onclick="baiduInstance(&#39;',"undefined"==typeof guid?"":guid,"&#39;)._showSpacePoi(&#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==typeof json.space_poi.uid?"":json.space_poi.uid,"&#39;, &#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==typeof json.space_poi.name?"":json.space_poi.name,'&#39;);return false;">在<b>全国</b>查看“<b>',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==typeof json.space_poi.name?"":json.space_poi.name,"</b>”全段</a></p>"),_template_fun_array.push("","undefined"==typeof list?"":list,'<div id="result_page_c"></div>',"undefined"==typeof place_entrance_wd?"":place_entrance_wd,"","undefined"==typeof no_result?"":no_result,'    <div id="pctomoBottomId2" class="pctomo_bottom2"></div>            <div id="user_feedback" class="blueC">百度提醒您：结果有错误？请到<a id="mapComplaintCenter" target="_blank" href="http://tousu.baidu.com/map/add?hidePoi=1">百度地图投诉中心</a>反馈。</div>    </div></div></div><div id="pctomoBottomId" class="pctomo_bottom"></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];this.setBdShare(),addStat("searchresult.searchresult.pvuvonline","show"),this.cinfo&&this.cinfo.poiall?(this.isOnlyShowMainRes=!1,Share.setPoiShowAll(1)):Share.setPoiShowAll(0);var j=this.json,r=j.result;if(!j||!j.result)return;6===r.type&&T.isObject(j.content)&&!T.isArray(j.content)&&(j.content=[j.content],j.result.total=1,j.result.count=1,j.place_info={d_data_type:""});var c=j.content,pinfo=j.place_info||{};this.cmdNo=r.cmd_no,this.business_scope_type=r.business_scope_type,this.isUseCater="cater"===pinfo.d_data_type;var startCityCode=this.startCity.code||1,curCityCode=j.current_city.code;this.isShowJumpBack=!(!r.jump_back||!("undefined"==typeof r.sug_index||r.sug_index<0)||startCityCode==curCityCode);var templateObj={guid:this.guid,json:this.json,startCityCode:this.cinfo.startCity.code,startCityName:this.cinfo.startCity.name,jump_back:this.isShowJumpBack,showTuan:!1};this.json.place_info&&this.placeRe.test(this.json.place_info.d_data_type)&&(place.result=!0,templateObj.screening=this.cinfo&&this.cinfo.searchByContextMenu||j.center||modelQuery&&"nb"==modelQuery.qt&&modelQuery.nb_x&&modelQuery.nb_y?place.insertHtml(this.json,this.guid,!0):place.insertHtml(this.json,this.guid)),j.result.debug&&window.mapDebugObjWxp&&window.mapDebugObjWxp.init(j.debug_info),this.isGRequest=11!=r.type&&1==r.op_gel?!0:!1,window.GRControll.isGRequest=this.isGRequest,r.return_query=baidu.encodeHTML(r.return_query),r.wd=baidu.encodeHTML(r.wd),this.curPage=r.page_num,this.totalCount=r.total,this.pagingCount=r.total>this.MAX_RESULT_COUNT?this.MAX_RESULT_COUNT:r.total,this.specialCount=r.spec_dispnum||0,this.displayCount=this.totalCount+this.specialCount,this.curItemPPage=r.count,this.curKw=r.return_query||r.wd,this.what=r.what||r.wd,this.sugKw=r.wd2||"",this.totalPage=Math.ceil(this.pagingCount/this.itemsPerPage),this.buslineTotalPage=Math.ceil(this.json.result.total_busline_num/this.itemsPerPage),this.children=j.children,this.grandchild=j.grandchildren||"",this.bizCount=0==this.curPage?this.getBizCount():this.cinfo.bizCount||0,j.current_city?(this.sCityCode=j.current_city.code,this.sCityName=j.current_city.name,this.ctype=j.current_city.type):(this.sCityCode=modelConfig.cityCode,this.sCityName=modelConfig.cityName),this.centerCityCode=this.cinfo&&this.cinfo.oc||this.sCityCode;var ctr=j.center,hasCtr0=ctr&&ctr.poi&&ctr.poi[0],hasCtrGeo=hasCtr0&&ctr.poi[0].geo,hasCtrUid=hasCtr0&&ctr.poi[0].uid,hasCtrName=hasCtr0&&ctr.poi[0].name,modelQuery=util.getParam("?qt="+window.currentComponent.modelQuery);modelQuery&&modelQuery.gr_radius&&(window.GRControll.GRCircleRadius=modelQuery.gr_radius),this.cinfo&&this.cinfo.searchByContextMenu?(this.isnbSearch=!0,this.centerPt=this.cinfo.centerPoint,this.ctrPoiName=this.cinfo.ctrPoiName?this.cinfo.ctrPoiName:"中心点",this.radius=this.cinfo.radius):hasCtrGeo?(this.isnbSearch=!!ctr,this.centerPt=util.getPointByStr(util.parseGeo(ctr.poi[0].geo).points),this.radius=r.radius):modelQuery&&"nb"==modelQuery.qt&&modelQuery.nb_x&&modelQuery.nb_y&&(this.isnbSearch=!0,this.centerPt=new BMap.Point(modelQuery.nb_x,modelQuery.nb_y),this.cinfo.centerPoint=this.centerPt,this.cinfo.searchByContextMenu=!0,this.radius=r.radius),hasCtrUid&&hasCtrName&&(this.ctrPoiUid=ctr.poi[0].uid,this.ctrPoiName=ctr.poi[0].name);var cn=this.sCityName,sg_search=this.cinfo.sg_search||0,wd=this.curKw?this.curKw:"";if(1&j.current_city.sup&&/团购/.test(this.curKw)&&(templateObj.showTuan=!0),!sg_search&&j.suggest_query){var suggs=j.suggest_query,suggStrs=[],swd="",sug_type=1==r.current_null&&!this.totalCount,swd=j.result.sugg_wd;if(swd&&1===suggs.length)swd=j.result.sugg_wd||suggs[0].query,suggStrs.push("<p class='sugg_query su_uniq_q' >已显示“<span class='sugg_return_query' >"+j.result.return_query+"</span>”的搜索结果，仍然搜索：<a  class='sugg_pinyin' onclick='PoiSearchInst.suggQuery(\""+swd+'",0,"PS",true);return false;\' >'+swd+"</a><br /></p>");else{sug_type?(suggStrs.push("<p class='no_result_title'>在<strong>"+cn+"</strong>"),suggStrs.push("范围内未找到相关地点。</P>"),suggStrs.push("<p class='sugg_q su_muti_q'><br />您是否要找：<br />")):suggStrs.push("<p class='sugg_q_result'>您是否要找：");for(var i=0,l=suggs.length;l>i;i++)suggStrs.push("<a href='javascript:void(0)' onclick='PoiSearchInst.suggQuery(\""+suggs[i].query+'", 2,"SUGG");return false;\'>'),suggStrs.push(suggs[i].query),suggStrs.push("</a>"),i<suggs.length-1&&sug_type&&suggStrs.push("<br />");suggStrs.push("</p>")}templateObj.suggest_query=suggStrs.join("")}if(!sg_search&&j.psrs&&j.psrs.SENum>0&&!j.suggest_query&&j.result&&j.result.return_query==j.result.wd){this.no_result_wd_flag=1==r.current_null&&!this.totalCount;for(var pinyinHtml=[],phtml=[],phtmlstr="",i=0,l=j.psrs.SENum;l>i;i++)phtml.push(" <a class='sugg_wd' onclick='PoiSearchInst.suggQuery(\""+j.psrs.SEResult[i]+'",0,"PS");return false;\' >'+j.psrs.SEResult[i]+"</a>"),i<j.psrs.SENum-1&&this.no_result_wd_flag&&phtml.push("<br />");phtmlstr=phtml.join(""),this.no_result_wd_flag?(pinyinHtml.push("<p class='sugg_query'>在<strong>"+cn+"</strong>"),pinyinHtml.push("范围内未找到相关地点。</P>"),pinyinHtml.push("<p class='sugg_query su_muti_q'><br />您是否要找：<br />"+phtmlstr+"</p>")):pinyinHtml.push("<p class='sugg_q_result'>您是否要找："+phtmlstr+"<br /></p>"),templateObj.pinyin_suggest=pinyinHtml.join("")}var sateSuggestHtml="";if(1===j.result.pattern_sign&&(sateCityList.isSateMapSupportCity(j.current_city.code)?(this.isShowJumpBack||(sateSuggestHtml="<p style='margin-bottom:10px;'>您是否要<a onclick='PoiSearchInst.sendSateSuggestQuery(\""+j.result.return_query+'", "'+j.current_city.code+"\");return false;'  href='javascript:void(0)'>在"+j.current_city.name+'找名称中含有"'+j.result.return_query+'"的地点？</a></p>'),map.setMapType(BMAP_SATELLITE_MAP),maptypeCtrl&&maptypeCtrl.streetMapMgr(!0)):sateSuggestHtml="当前城市不支持卫星图",templateObj.satequery_suggest=sateSuggestHtml),this.changeMapAfterSearch(modelConfig.cityCode),0==r.total&&c&&0==c.length||0==r.total&&!c){if(this._addCenterPoint(ctr),1==this.json.result.op_gel&&this.json.result.res_l>0){window.GRControll.setGRequestFlg(1e3);var x=parseFloat(this.json.result.res_x),y=parseFloat(this.json.result.res_y),point=new BMap.Point(x,y),me=this;window.setTimeout(function(){(0!=x||0!=y)&&map.centerAndZoom(point,me.json.result.res_l)},10)}else this.isGRequest||this.centerPt&&mapUtil.setViewport([this.centerPt]);return this._processNoResult(r,template,templateObj)}var result_titles=[""],tt="";this.isnbSearch?(tt=hasCtrName?'“<span class="r_kw">'+ctr.poi[0].name+"</span>”":"“<span class='r_kw'>"+this.ctrPoiName+"</span>”",result_titles.push("在"+tt+"附近 "),result_titles.push(' 查找“<span class="r_kw">'+this.curKw+"</span>” "),result_titles.push('&nbsp;<a id="aChangeRange" class="arrowLink" href="javascript:void(0)">更改条件</a>'),templateObj.result_title='<p class="black">'+result_titles.join("")+"</p>"):!this.isnbSearch&&r.requery&&(templateObj.result_title='<p class="sugg_q_wd">未找到结果，为您提供“<b>'+r.requery+"</b>”的搜索结果。</p>"),this.cinfo&&this.cinfo.isClickNextPage&&(this.isOnlyShowMainRes=!1);var htmls=[],showIconIndex=0,lineNum=0;this.isShowAllTipOn=c[0]&&c[0].acc_flag&&1==c[0].acc_flag?!0:!1;for(var i=0,l=r.count;l>i;i++)if(c[i].poiType!=constant.POI_TYPE_BUSLINE&&c[i].poiType!=constant.POI_TYPE_SUBLINE&&(showIconIndex++,this.showIconIndices[i]=showIconIndex),this._setColContent(c,i,htmls,showIconIndex,j.line_content),this.cinfo&&this.cinfo.sms&&this.cinfo.sms==c[i].uid&&(sms.ready("",c[i].uid,c[i].poiType,this.sCityCode),Share.setSmSCode(c[i].uid)),this.isOnlyShowMainRes&&this.isShowAllTipOn&&0==c[i].acc_flag);else{if(this.uids.push(c[i].uid),c[i].poiType==constant.POI_TYPE_BUSLINE||c[i].poiType==constant.POI_TYPE_SUBLINE){this.markers.push(""),this.points.push(""),lineNum++;continue}var isgrandtype=0;if(this.children&&1===c[i].father_son&&this.children[c[i].uid]){var children=this.children[c[i].uid],grandchild=this.grandchild,_children,isgrandchild,gchildnum,childType,catalog,cl,_isnormal=!1;grandchild&&1==children[0].father_son?(isgrandchild=!0,gchildnum=children.length,isgrandtype=1):(isgrandchild=!1,gchildnum=1,isgrandtype=2);for(var __i=0;gchildnum>__i;__i++){var flag=0,_mkr;if(isgrandchild){children[__i].father_son&&grandchild[children[__i].uid]?(_children=grandchild[children[__i].uid],childType=this.getChildType(_children),catalog=childType.catalog,cl=catalog.length):(catalog=[],cl=0);var childGeo=util.parseGeo(children[__i].geo);if(1==childGeo.type){var poiName=children[__i].name.split("-")[1]||children[__i].name;_mkr=mapUtil.addSearchPoi(childGeo.points,flag++,poiName,{uid:children[__i].uid,ext_type:children[__i].ext_type,type:"pchild",grand:!1,isgrandtype:0,origin_id:children[__i].origin_id||{}}),this.childMarkers.push(_mkr),this.childPoints.push(util.getPointByStr(childGeo.points)),this.childMarkerIndex++}}else _children=children,_children.length>8?(childType=this.getChildType(_children),catalog=childType.catalog,cl=catalog.length,_isnormal=!1):(cl=_children.length,_isnormal=!0);if(_isnormal)for(var flag=0,j=0;cl>j;j++){var _mkr,childGeo=util.parseGeo(_children[j].geo);1==childGeo.type&&(_mkr=mapUtil.addSearchPoi(childGeo.points,flag++,_children[j].name,{uid:_children[j].uid,ext_type:_children[j].ext_type,type:"child",grand:!1,isgrandtype:0,origin_id:_children[j].origin_id||{}}),this.childMarkers.push(_mkr),this.childPoints.push(util.getPointByStr(childGeo.points)),this.childMarkerIndex++)}else for(var _j=0;cl>_j;_j++)for(var flag=0,_mkr,j=0;j<_children.length;j++)if(_children[j].tab_catalog==catalog[_j]){var childGeo=util.parseGeo(_children[j].geo);1==childGeo.type&&(_mkr=mapUtil.addSearchPoi(childGeo.points,flag++,_children[j].name,{uid:_children[j].uid,ext_type:_children[j].ext_type,type:"child",grand:isgrandchild,isgrandtype:0,origin_id:_children[j].origin_id||{}}),(_j||isgrandchild)&&_mkr.hide(),this.childMarkers.push(_mkr),this.childPoints.push(util.getPointByStr(childGeo.points)),this.childMarkerIndex++)}}}var geo=util.parseGeo(c[i].geo),isGroupon=c[i].ext&&c[i].ext.detail_info&&c[i].ext.detail_info.groupon&&"[object Array]"==Object.prototype.toString.call(c[i].ext.detail_info.groupon);1==geo.type&&(this.markers.push(j.line_content&&j.line_content[0]&&512===j.line_content[0].kind?mapUtil.addSearchPoi(geo.points,showIconIndex-1,c[i].name,{type:isGroupon?"groupon":"normal",uid:c[i].uid,ext_type:c[i].ext_type,isgrandtype:isgrandtype,origin_id:c[i].origin_id||{},markerType:"subline"}):j.line_content&&j.line_content[0]&&256===j.line_content[0].kind?mapUtil.addSearchPoi(geo.points,showIconIndex-1,c[i].name,{type:isGroupon?"groupon":"normal",uid:c[i].uid,ext_type:c[i].ext_type,isgrandtype:isgrandtype,origin_id:c[i].origin_id||{},markerType:"busline"}):mapUtil.addSearchPoi(geo.points,showIconIndex-1,c[i].name,{type:isGroupon?"groupon":"normal",uid:c[i].uid,ext_type:c[i].ext_type,isgrandtype:isgrandtype,origin_id:c[i].origin_id||{}})),this.points.push(util.getPointByStr(geo.points)))}var rcls=this.isUseCater?"result result_place":"result",resultTrd="";if(j&&j.result&&(36==j.result.type||38==j.result.type)&&j.place_info&&j.place_info.d_data_type&&(resultTrd=j.place_info.d_data_type,"cinema"===j.place_info.d_business_type&&(resultTrd=j.place_info.d_business_type)),templateObj.list='<table id="POI_TABLE_LST" cellspacing="0" cellpadding="0" class="'+rcls+" black "+resultTrd+'">'+htmls.join("")+"</table>",!place.result&&c[0]&&(c[0].cla&&c[0].cla[0]&&c[0].cla[0][0]&&c[0].geo||c[0].poi_origin&&33==c[0].poi_origin)){var placeProCode=null,geoStr=c[0].geo,BDPoiName="",nbOpt={nb_x:placeEntrance.execGeo(geoStr).x,nb_y:placeEntrance.execGeo(geoStr).y,uid:c[0].uid};c[0].poi_origin&&33==c[0].poi_origin?(placeProCode=33,BDPoiName=c[0].name):c[0].cla&&c[0].cla[0]&&c[0].cla[0][0]&&c[0].geo&&(placeProCode=c[0].cla[0][0]);var placeProtype={13:!0,14:!0,18:!0,20:!0,33:!0};placeProtype[placeProCode]&&(templateObj.place_entrance_wd='<div id="place_tag">'+placeEntrance.insertHtml(placeProCode,this.sCityCode,nbOpt.nb_x,nbOpt.nb_y,nbOpt.uid,BDPoiName)+"</div>")}this._addCenterPoint(ctr),this.setMap(lineNum),templateObj.new_cms_ad=this._setNewCms();var $el=this.$el=T(template(templateObj));return $el.find(".p_title+div").find("img").bind("error",function(){$img=T(this).attr("src",NOPIC),$img.unbind("error")}),$el}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/PoiSearch/PoiSearch.js",ln:748})}},initialize:function(t){try{t=t||{};{var e=t.from||"",i=this,n=(this.markers,this.json),o=n.content;STAT_CODE.STAT_PANEL_SELECT,STAT_CODE.STAT_MAP_SELECT}if(this.op_gel_pic=n.result.op_gel,this.showInfoFlag="",this.setStatusByRes(n),BoxContainer&&BoxContainer.resetStatus(),this.setPanoStatus(e,this.cinfo.genRequestKey),window.isPrint||ClearBase.clearInit(),1==this.isnbSearch){var s=this.ctrPoiName;("未知地点"==s||"当前位置"==s)&&(s=this.curKw),searchBox.setSwitchTab(1,s)}if(place.result){var a=T.G("tagBar"),r=T.G("priceBar");place.barState.price.display?place.showBar(r,"price"):place.hideBar(r,"price"),place.barState.tag.display?place.showBar(a,"tag"):place.hideBar(a,"tag"),place.initialize(t,this.curKw)}if(this.bindEvent(),this.bindMarkersEvent(),this.bindChildrenMarkersEvent(),this.bindChildrenEvent(),this.setPoiPaging(),this.isnbSearch&&(T.G("crangeListI")&&T.on(T.G("crangeListI"),"change",function(){i.ctrPoiUid?searchInfoWindow.roundSearchByValue(i.curKw,i.ctrPoiUid,"crangeListI",i.centerCityCode,4,i.centerPt.lng,i.centerPt.lat):searchInfoWindow.rangeSearchByValue(i.curKw,i.centerPt.lng,i.centerPt.lat,"crangeListI",i.centerCityCode,4)}),i._initializeChangeRange()),this.isGRequest&&window.GRControll.openedMarker)if(this.json&&this.json.center&&this.json.center.poi&&this.json.center.poi[0]&&this.json.center.poi[0].uid==window.GRControll.openedMarker.uid)window.GRControll.openedMarker=null;else{var l=!1;if(this.json&&this.json.content)for(var c=0,p=this.json.content.length;p>c;c++){var d=this.json.content[c];if(d&&d.uid&&d.uid==window.GRControll.openedMarker.uid){this.setMarkerOpenInUrl(c,-1,-1,{notMove:!0,notZoom:!0}),l=!0;break}}if(!l&&!window.spotInfoWnd){var i=this;util.loadSearchInfo(function(t){i.setMissingMarker(t)})}}if(this.revertUrl(),this.valiSuggQuery(),this.json.space_poi&&T.G("user_feedback")&&(T.G("user_feedback").style.marginLeft="0"),this.isGRequest?this._setGRequest():38==this.json.result.type&&(window.GRControll.clearCache(),window.GRControll.clearGRMap()),map.mapType==BMAP_TYPE_DIMENSIONAL&&(NbSearch.hide(),modelConfig.enableMapMove=!1,MapConfig.poiSearch.enableRoute=!1,MapConfig.poiSearch.showCircle=!1,window.GRControll.disabledGR=!0,window.GRControll.clearCache(),window.GRControll.clearGRMap()),i.json&&i.json.content){var o=i.json.content,h=i.json.line_content;h&&h[0]&&(i._drawBusLine(h[0],!0,0,1),i.showBusLine=!0),(o[0].poiType==constant.POI_TYPE_SUBLINE||o[0].poiType==constant.POI_TYPE_BUSLINE)&&(i.select(0),map.showTerminal="yes")}"showAllBtn"!=e&&this.customScrollPanel(),this.bindEvtForAreaFilter(),this.json.result.area_profile&&1==this.json.result.area_profile?(this.hasDefaultAreaPoi=!0,this._showArea(this.json.result.profile_uid,{type:"new",isInit:!0,isFromShowAll:this.isShowAllRes})):!this.children&&0===this.curPage&&!this.isShowAllRes,this.busLineUid&&this.busLineUid.length>0&&this._addTimeInfo(this.busLineUid,!1,e),this._setCmsCont(),this.setWeiPaiTool(),this.rmSurplusRes(),this.addTrdStat()
}catch(u){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/exception.fire","catch",{msg:u.message||u.description,path:"common:widget/com/PoiSearch/PoiSearch.js",ln:958})}},addTrdStat:function(){var t=T("#POI_TABLE_LST").get(0);if(t){var e=t.className.split(" "),i=e[e.length-1].toUpperCase(),n=(T(".poiTitleW .poi_title"),T(".poiTitleW .detail"),T(".street_view_poi")),o=(T(".hotelImgBox img"),T("#POI_TABLE_LST  tr"));o.on("click",function(t){var e=T(t.target);if((e.hasClass("poi_title")||e.hasClass("label"))&&e.parent().hasClass("poiTitleW"))switch(i){case"CATER":addStat("poilistnormal.poi.foodtitle","show",{da_trd:i});break;case"HOTEL":addStat("poilistnormal.poi.hoteltitle","show",{da_trd:i});break;case"CINEMA":addStat("poilistnormal.poi.filmtitle","show",{da_trd:i});break;case"SCOPE":addStat("poilistnormal.poi.scenerytitle","show",{da_trd:i});break;default:addStat("poilistnormal.poi.othertitle","show",{da_trd:i})}else if(e.hasClass("detail"))switch(i){case"CATER":addStat("poilistnormal.poi.fooddetail","show",{da_trd:i});break;case"HOTEL":addStat("poilistnormal.poi.hoteldetail","show",{da_trd:i});break;case"CINEMA":addStat("poilistnormal.poi.filmdetail","show",{da_trd:i});break;case"SCOPE":addStat("poilistnormal.poi.scenerydetail","show",{da_trd:i});break;default:addStat("poilistnormal.poi.otherdetail","show",{da_trd:i})}else if(e.parent().hasClass("hotelImgBox"))switch(i){case"CATER":addStat("poilistnormal.poi.foodImg","show",{da_trd:i});break;case"HOTEL":addStat("poilistnormal.poi.hotelImg","show",{da_trd:i});break;case"CINEMA":addStat("poilistnormal.poi.filmImg","show",{da_trd:i});break;case"SCOPE":addStat("poilistnormal.poi.sceneryImg","show",{da_trd:i});break;default:addStat("poilistnormal.poi.otherImg","show",{da_trd:i})}else switch(i){case"CATER":addStat("poilistnormal.poi.foodBlankArea","show",{da_trd:i});break;case"HOTEL":addStat("poilistnormal.poi.hotelBlankArea","show",{da_trd:i});break;case"CINEMA":addStat("poilistnormal.poi.filmBlankArea","show",{da_trd:i});break;case"SCOPE":addStat("poilistnormal.poi.sceneryBlankArea","show",{da_trd:i});break;default:addStat("poilistnormal.poi.otherBlankArea","show",{da_trd:i})}}),n.on("click",function(){switch(i){case"CATER":addStat("poilistnormal.poi.foodpano","show",{da_trd:i});break;case"HOTEL":addStat("poilistnormal.poi.hotelpano","show",{da_trd:i});break;case"CINEMA":addStat("poilistnormal.poi.filmpano","show",{da_trd:i});break;case"SCOPE":addStat("poilistnormal.poi.scenerypano","show",{da_trd:i});break;default:addStat("poilistnormal.poi.otherpano","show",{da_trd:i})}})}},setMap:function(t){var e=this.points;if(this.centerPt&&e.push(this.centerPt),!(this.cinfo&&this.cinfo._maplevel&&this.cinfo._centerPoint||this.json&&this.json.result&&this.json.result.sug_index>=0&&this.json.result.sug_index<=9))if(this.isGRequest){if(1==this.json.result.op_gel&&this.json.result.res_l>0){window.GRControll.setGRequestFlg(1e3);var i=parseFloat(this.json.result.res_x),n=parseFloat(this.json.result.res_y),o=new BMap.Point(i,n);map.centerAndZoom(o,this.json.result.res_l)}}else if(map.mapType==BMAP_TYPE_DIMENSIONAL){if(e&&""!=e[0]){var s=BMap.MapType[BMAP_TYPE_DIMENSIONAL].citys,a=s[map.currentCity][1],r=util.getPointsBounds(e),l=mapUtil.getBitLevel(r);if(a.intersects(r)){15>=l&&(l=15);for(var c,p=0;p<e.length;p++){var c=e[p];if("Point"==c.toString())break}map.centerAndZoom(c,l)}else maptypeCtrl.select(BMAP_NORMAL_MAP),mapUtil.setViewport(e,30)}}else t?mapUtil.setViewport(e.slice(t),30):1!=this.json.result.area_profile&&mapUtil.setViewport(e.concat(this.childPoints),30)},rmSurplusRes:function(){if(map.noShowBl){for(var t=0;9>t;t++)T("#POI_TABLE_LST tr.noshowbl")[t]&&"none"!=T("#POI_TABLE_LST tr.noshowbl")[t].style.display&&T("#POI_TABLE_LST tr.noshowbl").remove();map.noShowBl=!1}},setStatusByRes:function(t){var e=t.result,i=e.type;if(t.current_city&&!(1&t.result.result_show)&&11==t.result.type&&0==t.result.total&&0==t.result.spec_dispnum){var n=t.current_city,o=["country","province","city","area"],s=null!=n.type?modelConfig.level[o[n.type]]:void 0,a=null!=n.geo?a=util.geoToPoint(n.geo):void 0;map.enableLoadTiles?(s&&map.zoomTo(s),a&&map.setCenter(a)):(map.enableLoadTiles=!0,map.centerAndZoom(a||map.getCenter(),s||map.getZoom()))}if(1==searchBox._curSelIndex){var r=window.poiResponse;if("1"==t.result.op_gel&&window.useraction&&(!r||r&&t.result.return_query==r.result.return_query)){{r&&r.result.qid}window.poiResponse=t}else window.poiResponse=t}else window.poiResponse=null;if(11!=i&&36!=i||t.center||(document.fmwd.word.value=t.result.wd,searchBox.poiSSG&&searchBox.poiSSG.setValue(t.result.wd),1!=searchBox._curSelIndex&&searchBox.setSwitchTab(1)),36==t.result.type||38==t.result.type){var l={};switch(t.place_info&&t.place_info.d_data_type&&(l.category=t.place_info.d_data_type.toUpperCase(),"cinema"===t.place_info.d_business_type&&(l.category=t.place_info.d_business_type.toUpperCase())),l.category){case"CATER":addStat("poilistnormal.poi.foodliststat","show",{da_trd:l.category});break;case"HOTEL":addStat("poilistnormal.poi.hotelliststat","show",{da_trd:l.category});break;case"CINEMA":addStat("poilistnormal.poi.filmliststat","show",{da_trd:l.category});break;case"SCOPE":addStat("poilistnormal.poi.sceneryliststat","show",{da_trd:l.category});break;default:addStat("poilistnormal.poi.otherliststat","show",{da_trd:l.category})}}},cnameSearch:function(t,e,i){indexUtil.cnameSearch(t,e,i)},showBusTime:function(t){var e=T(t.target),i=e.prev(".bus-time"),n=i.children("p").length;e.hasClass("bus-time-dn")?(i.css("height",19*parseInt(n/5+1)+"px"),e.removeClass("bus-time-dn"),e.addClass("bus-time-up")):(i.css("height","19px"),e.removeClass("bus-time-up"),e.addClass("bus-time-dn"))},_setCmsCont:function(){if(!window.isPrint){var t=require("common:widget/ui/CMSUtil/cmsControl.js");baidu.g("pctomoBottomId2").innerHTML=t.getPc2MoStr("poi")}},_setNewCms:function(){var t="";if(window._OLR&&window._OLR.index){var e=baidu.json.parse(window._OLR.index)||{},i=e.special&&e.special.data&&e.special.data.top.poi?e.special.data.top.poi:"";if("2"!==T.cookie.get("poiCmsAd")){var n=i?i.length:0;if(i&&n>0){var o=new Date,s=o.getHours()%n;t=i[s].icon?'<div class="newCmsAd" style="background-image:url('+i[s].icon+') !important;">':'<div class="newCmsAd">',t=i[s].link2?t+i[s].title+'<a href="'+i[s].link1+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.poilink', 'click', {da_trd:'"+i[s].title+"'});\">"+i[s].link_text1+'</a>&nbsp;&nbsp;<span>|</span>&nbsp;&nbsp;<a href="'+i[s].link2+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.poilink', 'click', {da_trd:'"+i[s].title+"'});\">"+i[s].link_text2+'</a><a id="poiAdClose" class="closeBtn" href="#"></a></div>':t+i[s].title+'<a href="'+i[s].link1+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.poilink', 'click', {da_trd:'"+i[s].title+"'});\">"+i[s].link_text1+'</a><a id="poiAdClose" class="closeBtn" style="top:11px;" href="#"></a></div>'}else t=""}}return""!=t&&addStat("indexleftmenu.links.poilink","show"),t},_setDetailLink:function(t,e,i,n,o){if(!window.isPrint){var o=o||{},s=t.ext,a=s?s.src_name:"",r=(this.json.place_info,1==t.biz_type),l="";if(t.detail&&t.ty==constant.GEO_TYPE_POINT||t.poiType==constant.POI_TYPE_BUSLINE||t.poiType==constant.POI_TYPE_SUBLINE)if(s&&("biaozhu_data"==a&&"1"==s.yw_type||this.placeRe.test(a))){var c="详情";if("biaozhu_data"==a&&"1"==s.yw_type)i.push(' - <a class="detail blueA" href="javascript:void(0)" tid="poiDetail_'+("child"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==o.type?"child_"+e:e)+'" onclick="place.showDetail(\''+t.uid+"', "+t.poiType+", "+this.sCityCode+", 'ISHOP_INFO');"+l+'return false;">详情»</a> <img src="../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/yw_c0325d6.gif"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/yw_c0325d6.gif*/ style="position:relative;top:3px"/>');else{var p=(a.toUpperCase()+"_","");"hospital"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==a&&t.business_id&&(p=t.business_id),i.push(n&&n[0]&&512===n[0].kind?' - <a class="detail blueA" tid="poiDetail_'+("child"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==o.type?"child_"+e:e)+'" href="javascript:void(0)" onclick="addStat(\'poilistnormal.poi.sublinedetail\');place.showDetail(\''+t.uid+"', "+t.poiType+", "+this.sCityCode+", '"+a+"','Page','List'"+(p?",false,'"+p+"'":"")+");"+l+'return false;">'+c+"»</a>":n&&n[0]&&256===n[0].kind?' - <a class="detail blueA" tid="poiDetail_'+("child"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==o.type?"child_"+e:e)+'" href="javascript:void(0)" onclick="addStat(\'poilistnormal.poi.buslinedetail\');place.showDetail(\''+t.uid+"', "+t.poiType+", "+this.sCityCode+", '"+a+"','Page','List'"+(p?",false,'"+p+"'":"")+");"+l+'return false;">'+c+"»</a>":' - <a class="detail blueA" tid="poiDetail_'+("child"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==o.type?"child_"+e:e)+'" href="javascript:void(0)" onclick="place.showDetail(\''+t.uid+"', "+t.poiType+", "+this.sCityCode+", '"+a+"','Page','List'"+(p?",false,'"+p+"'":"")+");"+l+'return false;">'+c+"»</a>")}t._hasDetail=!0}else 6!==this.json.result.type&&"aoi"!=a&&(i.push(' - <a class="detail blueA" tid="poiDetail_'+("child"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==o.type?"child_"+e:e)+'" href="javascript:void(0)" onclick="place.showDetail(\''+t.uid+"', "+t.poiType+", "+this.sCityCode+",'"+a+"');"+l+'return false;">详情»</a>'),t._hasDetail=!0);r&&i.push("<span class='tip_biz_r'>推广</span>")}},setPanoStatus:function(t,e){var i=this.cinfo||{},n=i.isClickNextPage,o=i.isFilter||!1,s="search";this.json.content&&!n&&!o&&"showAllBtn"!==t&&PanoUtil.isPanoStatus()&&PanoUtil.closePano(s,!!e),window.PanoMap&&window.PanoMap.isOpen&&!window.GRControll.isGRequest&&PanoMap.hide()},_setGRequest:function(){var t=window,e=this;if(t.GRControll.setGRequestFlg(500),t.GRControll.setGRData(this.json,{cinfo:this.cinfo}),this.cinfo&&this.cinfo._index&&this.cinfo._index.indexOf("uid,")>=0){var i=this.cinfo._index.split("uid,")[1];t.GRControll.sendInfoRequest(i)}e.storeDataForSIV=function(){var t={};return e.json&&(t.json=e.json),e.cinfo&&(t.cinfo={cinfo:e.cinfo}),t},e.resetOverlayForSiv=function(){var t=e.json.result.type;38==t&&e.json.center&&e._addCenterPoint(e.json.center)}},clearMarkersInPoi:function(t){var e=this;e&&e.clearMarkers&&e.clearMarkers(t),e.storeDataForSIV=null,e.resetOverlayForSiv=null,e&&e.changeRangePopup&&(e.changeRangePopup.close(),e.changeRangePopup=null)},clearArea:function(){var t=this;t&&t._clearArea&&t._clearArea()},customScrollPanel:function(){var t=5;T.browser.ie&&(t=3,"6"==T.browser.ie&&place.result===!0&&(t=10)),this.scrollPanel=new baidu.ui.ScrollPanel({container:"main_result_content",overflow:"overflow-y",autoUpdate:!1,margin:[5,t,0,0]}),T.un(window,"onresize",this.resizeListContent),this.resizeListContent(),T.on(window,"onresize",this.resizeListContent),this.scrollPanel&&this.scrollPanel.render("main_result_content")},resizeListContent:function(){{var t=window.PoiSearchInst,e=T.G("pctomoBottomId");T.G("pctomoBottomId2")}if(1==t.op_gel_pic&&e&&(e.style.display="none"),e){var i=T.G("main_result_content"),n=e.parentNode,o=(T.dom.getPosition(n),util.getClientSize()),s=e.offsetHeight,a=142;place.result===!0&&(s=0,e.style.display="none");var r=o.height-a-s-10;r=r>0?r:0,i.style.height=r+"px",mapInfoScrollPanel&&mapInfoScrollPanel.hide(),t.scrollPanel&&t.scrollPanel.update({notToTop:!0})}},clearMarkers:function(t){for(var e=GRControll.openedMarker,i=0,n=this.markers.length;n>i;i++)this.markers[i]&&map.removeOverlay(this.markers[i]);this.markers.length=0,t&&"circle"!=t||(this.centerPt&&map.removeOverlay(this.centerPt),this.centerPt=null,this.centerPoi&&map.removeOverlay(this.centerPoi),this.centerPoi=null),NbSearch.hide(),this.cInfoWnd=null;for(var i=0,n=this.busPolylines.length;n>i;i++)this.busPolylines[i]&&map.removeOverlay(this.busPolylines[i]);this.busPolylines=[];for(var i=0,n=this.busStopPois.length;n>i;i++)this.busStopPois[i]&&map.removeOverlay(this.busStopPois[i]);this.busStopPois=[],this.unListMarker&&(map.removeOverlay(this.unListMarker),this.unListMarker=null),e&&(GRControll.openedMarker=e)},unload:function(t,e){var i=window.GRControll.openedMarker;if(11!=this.json.result.type&&window.GRControll.clearCache(),this.json=null,this.curSelA=null,this.extIsRequesting||(this.points.length=0,this.childPoints.length=0),this.childItems.length=0,this.childDisplay.length=0,this.markers.length=0,this.childMarkers.length=0,this.infoWnds.length=0,this.busStopPois.length=0,this.stationPoints.length=0,this.showIconIndices.length=0,this.centerPt=null,this.centerPoi=null,this.cInfoWnd=null,this.isShowAllBtn=0,this.busPolylines.length=0,this.normPolylines.length=0,this.normPolygons.length=0,this.storeDataForSIV=null,this.resetOverlayForSiv=null,place.result=!1,place.place_dateType=null,place.urlArr="",this.changeRangePopup&&(this.changeRangePopup.close(),this.changeRangePopup=null),this.unListMarker&&(map.removeOverlay(this.unListMarker),this.unListMarker=null),window.mapDebugObjWxp&&window.mapDebugObjWxp.debug_info&&delete window.mapDebugObjWxp.debug_info,e.json&&e.json.result){var n=e.json.result.type;36!=n&&38!=n&&39!=n&&(GRControll.clearGRMap(),GRControll.clearListener(),GRControll.clearCache())}i&&(GRControll.openedMarker=i),T.un(window,"onresize",this.resizeListContent),MapComponent.prototype.unload.apply(this)},setMissingMarker:function(t){var e=this,i=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET}),n=util.getPoiPoint(util.parseGeo(window.GRControll.openedMarker.geo).points),o=new BMap.Marker(n,{icon:i,zIndexFixed:!0,baseZIndex:25e5});map.addOverlay(o),o._stCode=constant.OVERLAY_STYLE.GEN_MKR1,o.setTitle(window.GRControll.openedMarker.name),e.unListMarker=o;var s="/?qt=inf&uid="+window.GRControll.openedMarker.uid+"&ie=utf-8&t="+(new Date).getTime();baidu.ajax(s,{dataType:"json",success:function(i){i&&i.content&&e.showMissingInfoWin(i,t)},error:function(){}}),o.addEventListener("mouseover",function(){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-156),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});o.setIcon(t),o.setTop(!0,1000100)}),o.addEventListener("mouseout",function(){if(!map.temp.infoWin||1!=map.temp.infoWin.isOpen()||map.temp.infoWin.overlay!==this){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});o.setIcon(t),o.setTop(!1)}}),o.addEventListener("click",function(){e.unListInfoW&&e.unListMarker&&e.unListOpt&&t.openSearchInfoWnd(e.unListInfoW,e.unListMarker,e.unListOpt)})},showMissingInfoWin:function(t,e){var i=this,n=t.content,o=util.getPointByStr(util.parseGeo(n.geo).points),s=n.addr,a=n.tel,r=i._getCateInfo(n.cla),l=l||{};l.notMove=!0,(n.poiType==constant.POI_TYPE_BUSSTOP||n.poiType==constant.POI_TYPE_SUBSTOP)&&(s=T.array.unique(s.split(";")).join("; ")),a&&(a=a.replace(/,/g,", "));var c=n.detail&&n.ty==constant.GEO_TYPE_POINT||n.poiType==constant.POI_TYPE_BUSLINE||n.poiType==constant.POI_TYPE_SUBLINE,p=e.createSearchInfoWnd({title:n.name,addr:s,tel:a,uid:n.uid,detail:n.detail,ext_type:n.ext_type,cate:r,poiType:n.poiType,hasDetail:c,ext:n.ext,status:n.status,cp:n.cp,cla:r,catId:n.new_catalog_id||""},{cityCode:i.sCityCode,x:o.lng,y:o.lat});if(p){if(p.addEventListener("open",function(){window.GRControll.setGRequestFlg(1500),map.infoWindow.closeButton&&T.on(map.infoWindow.closeButton,"click",function(){if(i.unListMarker){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});i.unListMarker.setIcon(t),i.unListMarker.setTop(!0,1000100),window.GRControll.openedMarker=null}})}),p.addEventListener("close",function(){if(i.unListMarker){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_RED_SIZE,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});i.unListMarker.setIcon(t),i.unListMarker.setTop(!0,1000100)}window.GRControll.openedMarker=null}),map.temp.infoWin&&1==map.temp.infoWin.isOpen())var d=window.GRControll.openedMarker;e.openSearchInfoWnd(p,i.unListMarker,l),d&&setTimeout(function(){window.GRControll.openedMarker=d},500),i.unListInfoW=p,i.unListOpt=l;var h=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-156),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});i.unListMarker&&(i.unListMarker.setIcon(h),i.unListMarker.setTop(!0,1000100)),window.GRControll.mdMarker1&&GRControll.mdMarker1.hide(),window.GRControll.mdMarker2&&GRControll.mdMarker2.hide()}},setMarkerOpenInUrl:function(t,e,i,n){var o=this;if(-1!=t&&"c"!=t){var s=o.json.content[t]&&o.json.content[t].poiType||-1;if(s!=constant.POI_TYPE_BUSLINE&&s!=constant.POI_TYPE_SUBLINE||-1==i){var a=!0,r=!0;n&&n.notMove?a=!0:o.cinfo._centerPoint||(a=!1),n&&n.notZoom?r=!0:o.cinfo._maplevel||(r=!1),o.select(t,{notMove:a,notZoom:r,forReAppear:!0})}else o._processUrlReappear(s)}"c"==t&&o.cInfoWnd&&o.centerPoi&&(o._setTop(o.centerPoi,!0),util.loadSearchInfo(function(t){t.openSearchInfoWndPOI(o.cInfoWnd,o.centerPoi)}),this.curSelIndex="c"),(s==constant.POI_TYPE_BUSSTOP||s==constant.POI_TYPE_SUBSTOP)&&setTimeout(function(){o._processUrlReappear(s)},300)},_initializeChangeRange:function(){try{var t=this,e=T.G("aChangeRange");T.on(e,"click",function(e){e=e||window.event,t._showRangePop(e),util.preventDefault(e)})}catch(i){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/exception.fire","catch",{msg:i.message||i.description,path:"common:widget/com/PoiSearch/PoiSearch.js",ln:1872})}},_showRangePop:function(){var t=this,e=T.G("aChangeRange");require.async(["common:widget/ui/Popup/Popup.js","common:widget/ui/searchInfoWindow/searchInfoWindow.js"],function(i,n){if(t.changeRangePopup)t.changeRangePopup&&t.changeRangePopup.close();else{t.changeRangePopup=new i({title:"周边搜索",content:t._generateMorePopupHtml(t.ctrPoiName),width:253,addDom:"wrapper",close:function(){t.changeRangePopup=null}}),t.changeRangePopup.addConnectDom(e),t.changeRangePopup.render();var o=t.changeRangePopup.getDom().style;o.left="38px",o.top="33px",t.changeRangePopup.content.style.paddingLeft="6px",t.changeRangePopup.content.style.paddingBottom="8px",T.G("crangeKw")&&(T.G("crangeKw").focus(),T.G("crangeKw").value=t.json&&t.json.result&&t.json.result.wd);var s=T.G("crangeBtn");T.on(s.form,"submit",function(e){""==T.G("crangeKw").value?T.G("crangeKw").focus():(t.ctrPoiUid?n.roundSearchByInput("crangeKw",t.ctrPoiUid,"crangeList",t.centerCityCode,3,t.centerPt.lng,t.centerPt.lat):n.rangeSearchByInput("crangeKw",t.centerPt.lng,t.centerPt.lat,"crangeList",t.centerCityCode,3),t.changeRangePopup&&t.changeRangePopup.close()),baidu.event.preventDefault(e)});var a=T.G("crange_cate_list");if(a)for(var r=a.getElementsByTagName("a"),l=0,c=r.length;c>l;l++)t.ctrPoiUid?!function(){var e=r[l];T.on(e,"click",function(){n.roundSearchByLink(e,t.ctrPoiUid,"crangeList",t.centerCityCode,2,t.centerPt.lng,t.centerPt.lat),t.changeRangePopup&&t.changeRangePopup.close()})}():!function(){var e=r[l];T.on(e,"click",function(){n.rangeSearchByLink(e,t.centerPt.lng,t.centerPt.lat,"crangeList",t.centerCityCode,2),t.changeRangePopup&&t.changeRangePopup.close()})}()}})},loadData:function(t){var e=decodeURIComponent(t);if(e.indexOf("nb")>=0){this.cinfo||(this.cinfo={}),this.cinfo.searchByContextMenu=!0,this.isnbSearch=!0;for(var i=e.split("&"),n=[],o=0,s=i.length;s>o;o++){if(0==i[o].indexOf("ar=")){var a=i[o].substring(4),r=parseFloat(a.split(";")[0].split(",")[0]),l=parseFloat(a.split(";")[0].split(",")[1]),c=parseFloat(a.split(";")[1].split(",")[0]),p=parseFloat(a.split(";")[1].split(",")[1]);this.cinfo.centerPoint=new BMap.Point((r+c)/2,(l+p)/2),this.centerPt=this.cinfo.centerPoint}if(0==i[o].indexOf("nb_x=")){var a=i[o].substring(5);n[0]=a}if(0==i[o].indexOf("nb_y=")){var a=i[o].substring(5);n[1]=a}}n[0]&&n[1]&&(this.centerPt=this.cinfo.centerPoint=new BMap.Point(n[0],n[1]))}return t},select:function(t,e){var e=e||{},i="childIndex"in e;if(e.dispMoreBusline)var n=this.blObj||[];else var n=this.json&&this.json.content||[];i&&(n=this.childItems);{var o=this;n[t]&&1==n[t].biz_type}if(!i&&t==this.curSelIndex&&"father"==this.lastSelection||i&&t==this.curSelIndex&&e.childIndex==this.curChildIndex){var s,a;if(i?(s=this.childPoints,a=e.childIndex):(s=this.points,a=t),1!=e.force&&(!s[a]||map.getBounds().containsPoint(s[a]))&&(n[a]&&n[a].poiType!=constant.POI_TYPE_BUSSTOP&&n[a].poiType!=constant.POI_TYPE_SUBSTOP||!n[a]))return;if(n[a]&&(n[a].poiType==constant.POI_TYPE_BUSSTOP||n[a].poiType==constant.POI_TYPE_SUBSTOP)&&map.temp.infoWin&&o.markers[a]&&1==map.temp.infoWin.isOpen()&&map.temp.infoWin.overlay===o.markers[a]&&(!s[a]||map.getBounds().containsPoint(s[a])))return}map.closeInfoWindow(),this.hideBusInfo(this.curSelIndex),this.curStopSelIndex=-1,T.G("line_list_"+this.curLineSelIndex)&&(T.rc(T.G("line_list_"+this.curLineSelIndex),"active"),this.curLineSelIndex=-1),e.fromSIV||window.searchInViewCtrl&&window.searchInViewCtrl.exit();var r=this.curSelIndex;if(this.curSelIndex=t,i){this.lastSelection="son";var l=this.curChildIndex;this.curChildIndex=e.childIndex,setTimeout(function(){addStat(STAT_CODE.STAT_FATHERSON_CLICK,{type:2,uid:n[e.childIndex]&&n[e.childIndex].uid})},1e3)}else this.lastSelection="father",this.curChildIndex=-1,n[t]&&n[t].father_son&&setTimeout(function(){addStat(STAT_CODE.STAT_FATHERSON_CLICK,{type:1})},1e3);if(this.isnbSearch&&this.centerPoi&&!this.centerPoi.isVisible()&&(this.centerPoi=null,this.cInfoWnd=null,this._addCenterPoint(this.json.center)),e&&!e.showBusLine&&this._clearBusLine(),this._clearLine(),this._clearArea(),this.isnbSearch&&(e.notZoom=!0),i){e.isSon=!0;var c=o.markers[o.fatherIndex[e.childIndex]],p=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_BLUE_ICON_WID*o.fatherIndex[e.childIndex],-constant.A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});c.setIcon(p),c.setTop(!0),this._showInfoWindow(n,e.childIndex,e),this.json.content[t].poi_profile&&o._showArea(this.json.content[t].uid,{type:"new",adjust:!1})}else if(n[t]){switch(n[t].ty){case constant.GEO_TYPE_AREA:n[t]&&o._showArea(n[t].uid);break;case constant.GEO_TYPE_LINE:map.showTerminal="yes",n[t].poiType==constant.POI_TYPE_BUSLINE||n[t].poiType==constant.POI_TYPE_SUBLINE?map.noShowBl||this._showBusLine(n[t].uid,!e.forReAppear,e.showBLCbk,t,1):("yes"==this.showInfoFlag&&this._showInfoWindow(n,t,e),this._showLine(n,t,e));break;case constant.GEO_TYPE_POINT:this._showInfoWindow(n,t,e)}n[t].poi_profile&&o._showArea(n[t].uid,{type:"new",adjust:!1})}r!=t&&o.curSelA&&(T.rc(o.curSelA,"focus"),T.rc(o.curSelA,"focus-over"));var d=T.G("item-td-"+t);if(d){T.ac(d,"focus"),T.rc(d,"focus-over"),o.curSelA=d;var h=this;try{!function(){var e=util.getParam("?qt="+window.currentComponent.modelQuery),i=e.qt,n=h.json.result.type,o=h.json.result.page_num,s=T(d);"s"!==i||11!==n||s.data("exactPoilistAll")||(addStat("exactPoilist.all.click"),s.data("exactPoilistAll",!0)),"s"!==i||11!==n||t||o||s.data("exactPoilistNo1")||(addStat("exactPoilist.no1.click"),s.data("exactPoilistNo1",!0))}()}catch(u){}}var _=o.markers[r];_&&this._setTop(_,!1);var m=o.markers[t];if(m&&m.isgrandtype&&1==m.isgrandtype?addStat("poilistnormal.child.pfclick"):m&&2==m.isgrandtype&&addStat("poilistnormal.child.cfclick"),m&&(!e.forReAppear||-1==this.reIndex[1])){var o=this;setTimeout(function(){var e=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_BLUE_ICON_WID*(t-o.specialCount),-constant.A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});m.setIcon(e),o._setTop(m,!0)},200)}var f=o.childMarkers[l];f&&o._setTop(f,!1);var g=o.childMarkers[e.childIndex];if(setTimeout(function(){o._setTop(g,!0,!1,{isSon:!0})},200),g&&!g.isgrand&&addStat(g.isgchild?"poilistnormal.child.ppchildclick":"poilistnormal.child.childclick"),this._setShareSelIndex(this.curSelIndex),11!=this.json.result.type&&this.markers[t]){var w=1;map.temp.infoWin&&map.temp.infoWin.isOpen()||(w=50),setTimeout(function(){var e=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_BLUE_ICON_WID*t,-constant.A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});o.markers[t].setIcon(e)},w),window.GRControll.mdMarker1&&GRControll.mdMarker1.hide(),window.GRControll.mdMarker2&&GRControll.mdMarker2.hide()}return e&&e.statCode&&setTimeout(function(){var i=n[t],o=i.ext&&i.ext.src_name?i.ext.src_name:"";addStat(e.statCode,{n:t,uid:n[t].uid,ct:e.ct,category:o})},1e3),!1},setComponentList:function(t){this.select(t)},_showInfoWindow:function(t,e,i){var n=this;util.loadSearchInfo(function(o){n.loadInfoWindow(t,e,i,o)})},loadInfoWindow:function(t,e,i,n){var o,s,a=this,i=i||{};if(i.isSon?(o=this.childPoints,s=this.childMarkers):(o=this.points,s=this.markers),1!=i.forReAppear||-1==this.reIndex[1]||t[e].poiType!=constant.POI_TYPE_BUSLINE&&t[e].poiType!=constant.POI_TYPE_SUBLINE&&t[e].poiType!=constant.POI_TYPE_BUSSTOP&&t[e].poiType!=constant.POI_TYPE_SUBSTOP){var r=function(){!map.temp.infoWin||map.temp.infoWin&&0==map.temp.infoWin.isOpen()||(setTimeout(function(){i&&i.level?(a.isGRequest&&window.GRControll.setGRequestFlg(1e3),map.zoomTo(i.level)):map.zoomLevel<15&&(a.isGRequest&&window.GRControll.setGRequestFlg(1e3),map.zoomTo(15))},50),map.removeEventListener("moveend",arguments.callee))};if(!this.isGRequest){var l=map.pointToPixel(o[e]);l&&(l.y=l[1]=l.y-60,map.setCenter(map.pixelToPoint(l)))}i.notZoom||this.isGRequest||map.addEventListener("moveend",r);var c=t[e].addr;(t[e].poiType==constant.POI_TYPE_BUSSTOP||t[e].poiType==constant.POI_TYPE_SUBSTOP)&&(c=T.array.unique(c.split(";")).join("; "));var p=t[e].tel,d=t[e].topic||"",h=t[e].date||"",u=this._getCateInfo(t[e].cla),_=null,m=this.json.result.wd||"";_=n.createSearchInfoWnd({title:t[e].name,addr:c,tel:p,uid:t[e].uid,detail:t[e].detail,ext_type:t[e].ext_type,cate:u,poiType:t[e].poiType,hasDetail:t[e]._hasDetail,topic:d,date:h,ext:t[e].ext,status:t[e].status,cp:t[e].cp,cla:t[e].cla,bizType:t[e].biz_type,origin_id:t[e].origin_id||{},catId:t[e].new_catalog_id||"",pano:t[e].pano||0,indoor_pano:t[e].indoor_pano||0,wd:m,pano_index:e},{cityCode:this.sCityCode,x:o[e].lng,y:o[e].lat}),_&&(_._aIndex=e,function(){var i=e,n=function(t){if(-1!=a.curChildIndex)var i=T.G("item-td-"+a.fatherIndex[a.curChildIndex]);else var i=T.G("item-td-"+t);if(i&&(T.rc(i,"focus"),T.rc(i,"focus-over")),a.curA=null,-1!=a.curChildIndex)var n=a.childMarkers[a.curChildIndex];else var n=a.markers[a.curSelIndex];if(n)if(-1!=a.curChildIndex){if(n.isgrand){var o=n.textlen,s=new BMap.Icon(constant.PCHILD_MARKER_IMG,new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+o],28),{imageOffset:new BMap.Size(0,-constant.PCHILD_MARKER_HEIGHT*(6-o)),offset:new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+o]/2,constant.PCHILD_MARKER_HEIGHT),infoWindowOffset:new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+o]/2,1)});n.setIcon(s),T(T(n.siblingElement).children("div")[0]).css("color","#f21101");var r=T.G("child-"+e);T.rc(r,"pchild-nav-active")}else{var l=a.childDisplay[a.curChildIndex]-1,s=new BMap.Icon(constant.CHILD_MARKER_IMG,constant.CHILD_MARKER_ORANGE_SIZE,{offset:constant.CHILD_MARKER_OFFSET,imageOffset:new BMap.Size(-constant.CHILD_MARKER_WID*l,-constant.CHILD_MARKER_ORANGE_Y),infoWindowOffset:constant.CHILD_MARKER_INFOWND_OFFSET});n.setIcon(s)}n.setTop(!1);var c=a.markers[a.fatherIndex[a.curSelIndex]],p=c.customProperty&&"normal"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==c.customProperty.type?0:-constant.A_J_MARKER_ORANGE_ICON_Y;s=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_RED_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_RED_ICON_WID*(a.fatherIndex[a.curSelIndex]-a.specialCount),p),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET}),c.setIcon(s),c.setTop(!1)}else{var p=n.customProperty&&"normal"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==n.customProperty.type?0:-constant.A_J_MARKER_ORANGE_ICON_Y,s=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_RED_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_RED_ICON_WID*(e-a.specialCount),p),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});n.setIcon(s),n.setTop(!1)}a.curSelIndex=-1,a.curChildIndex=-1,a._setShareSelIndex(-1)};_.addEventListener("close",function(){n(i),a.isGRequest&&(window.GRControll.openedMarker=null),_.removeEventListener("close",arguments.callee)}),_.addEventListener("open",function(){a.isGRequest&&(window.GRControll.openedMarker={uid:t[e].uid,geo:t[e].geo,name:t[e].name}),_.removeEventListener("open",arguments.callee)})}(),i.from="poisearch",n.openSearchInfoWndPOI(_,s[e],i))}},_adjustViewPort:function(t){var e=this,i=e._constructBounds(t).getCenter();zoom=map.getZoom(),map.centerAndZoom(i,zoom)},_showLine:function(t,e,i){if(!MapConfig.poiSearch.enableRoute)return void this._showInfoWindow(t,e,i);var n=t[e].uid,o=this;if(!i)var i={};searchData.fetch("ext&uid="+n+"&l="+(BMap.MapType[map.mapType].zoomLevelMax-1)+"&c="+o.sCityCode,function(n){if(n&&(!n||n.content)){var s=util.parseGeo(n.content.geo);if(2==s.type){var a=[],r=s.bound;if("string"==typeof s.points){o.normPolylines.push(mapUtil.addRoute(s.points));for(var l=s.points.split(";"),c=0,p=l.length;p>c;c++){var d=l[c].split(",");a.push(new BMap.Point(d[0],d[1]))}}else for(var c=0,p=s.points.length;p>c;c++)if(s.points[c]){o.normPolylines.push(mapUtil.addRoute(s.points[c]));for(var h=s.points[c].split(";"),u=0,_=h.length;_>u;u++)a.push(new BMap.Point(parseFloat(h[u].split(",")[0]),parseFloat(h[u].split(",")[1])))}if(t[e]._views){if(map.zoomLevel==t[e]._views.level||i.notZoom){var r=s.bound.split(";"),m=new BMap.Bounds(r[0].split(",")[0],r[0].split(",")[1],r[1].split(",")[0],r[1].split(",")[1]);map.getBounds().containsBounds(m)||i.notZoom||o.isGRequest||"yes"===o.showInfoFlag&&mapUtil.setViewport(a,10)}else o.isGRequest||"yes"===o.showInfoFlag&&mapUtil.setViewport(a,10);"yes"!==o.showInfoFlag&&(i.notZoom=!0,o._showInfoWindow(t,e,i))}else i.notMove||i.notZoom||o.isGRequest||(t[e]._views=map.getViewport(a,{margins:[10,10,10,10]}),"yes"===o.showInfoFlag&&map.setViewport(t[e]._views)),"yes"!==o.showInfoFlag&&(i.notZoom=!0,o._showInfoWindow(t,e,i))}}})},_clearLine:function(){for(var t=0,e=this.normPolylines.length;e>t;t++)mapUtil.removeRoute(this.normPolylines[t]),this.normPolylines[t]=null;this.normPolylines.length=0},_showArea:function(t,e){var i=this,n="&uid="+t+"&c="+this.sCityCode;e=e||{},"new"===e.type&&(n+="&ext_ver=new"),e.isFromShowAll&&map.mapType==BMAP_TYPE_DIMENSIONAL||(searchData.fetch("ext"+n,function(t){"new"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/===e.type?i._setExtArea(t,{type:"poi",adjust:e.adjust,isInit:e.isInit}):i._setExtArea(t,{type:"norm"}),i.extIsRequesting=!1,i.json||(i.points.length=0,i.childPoints.length=0)},function(){mapUtil.setViewport(i.points.concat(i.childPoints)),i.extIsRequesting=!1,i.json||(i.points.length=0,i.childPoints.length=0)}),i.extIsRequesting=!0)},_setExtArea:function(t,e){if(t&&(!t||t.content)){e=e||{};var i=this,n=util.parseGeo(t.content.geo);if(!n)return void(e.isInit&&mapUtil.setViewport(i.points.concat(i.childPoints)));n=n.points;var o=[],s="poi"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/===e.type?constant.AREA_TYPE_POI:constant.AREA_TYPE_NORM;if("string"==typeof n){i.normPolygons.push(mapUtil.addArea(n,s));for(var a=n.split(";"),r=0,l=a.length;l>r;r++)o.push(new BMap.Point(parseFloat(a[r].split(",")[0]),parseFloat(a[r].split(",")[1])))}else for(var r=0,l=n.length;l>r;r++)if(n[r]){i.normPolygons.push(mapUtil.addArea(n[r],s));for(var a=n[r].split(";"),c=0,p=a.length;p>c;c++)o.push(new BMap.Point(parseFloat(a[c].split(",")[0]),parseFloat(a[c].split(",")[1])))}i.isGRequest?window.GRControll.setGRequestFlg(1e3):e.isInit?mapUtil.setViewport(o.concat(i.points,i.childPoints)):e.adjust!==!1&&mapUtil.setViewport(o)}},_clearArea:function(){for(var t=0,e=this.normPolygons.length;e>t;t++)mapUtil.removeArea(this.normPolygons[t]),this.normPolygons[t]=null;
this.normPolygons.length=0},_setColContent:function(t,e,i,n,o){if(!window.isPrint){var s=[],a=t[e].addr,r=t[e].tel&&t[e].tel.replace(/(,|;)/gi,", ").replace("、","<br />");a&&s.push(t[e].poiType==constant.POI_TYPE_BUSSTOP||t[e].poiType==constant.POI_TYPE_SUBSTOP?"车次:"+a+"<br/>":"地址:"+a+"<br/>"),r&&s.push("电话:"+r),s=s.join("");var l=util.getPointByStr(util.parseGeo(t[e].geo).points),c=l.lng+"|"+l.lat,p="";t[e].origin_id&&t[e].origin_id.overview_guid&&(p=t[e].origin_id.overview_guid);var d={point:c,uid:t[e].uid,cityCode:this.sCityCode,title:t[e].name,content:s,panoGuid:p},h=SyncMgr.checkInFav({from:"poi",json:d}),u="",_="加入收藏夹",m=_;null!=h&&-1!=h&&(u="poi-fav-selected",_="取消收藏",m=_)}var f;this.json.place_info&&(f=this.json.place_info.d_data_type);var g=t[e].ext&&t[e].ext.detail_info&&t[e].ext.detail_info.groupon&&"[object Array]"==Object.prototype.toString.call(t[e].ext.detail_info.groupon);if(this.isUseCater)return i.push(place.caterList.listHtml(this.json,t[e],e,n,this.sCityCode,c,s,u,m,g,this.guid)),void(1==this.json.result.debug&&this.json.debug_info&&this.json.debug_info.results&&this.json.debug_info.results.length&&window.mapDebugObjWxp&&window.mapDebugObjWxp.showPoiDebug&&(i.push("<tr><td></td><td>"),i.push(window.mapDebugObjWxp.showPoiDebug(this.json.debug_info.results,e)),i.push("</tr></td>")));var w=this,v=(this.guid,!1),P=/餐饮/;w.currentNodeDisplay="";var y=t[e].poiType,b=1==t[e].biz_type,g=t[e].ext&&t[e].ext.detail_info&&t[e].ext.detail_info.groupon&&"[object Array]"==Object.prototype.toString.call(t[e].ext.detail_info.groupon);t[e].biz_type=b,b||(t[e].biz_type=0);var S=0;if(t[e]&&t[e].ext&&t[e].ext.detail_info){var I=t[e].ext.detail_info;I.premium2&&"[object Array]"==Object.prototype.toString.call(I.premium2)&&I.premium2.length&&(S=1)}w.focusPanel=function(t,e){var i=T(t),n=T(".sublineInfo");T(".buslineInfo").removeClass("panelFocus"),n.removeClass("panelFocus"),i.addClass("panelFocus"),(0===n.length||e.showMoreBl)&&T(i.nextAll("tr")[0]).addClass("panelFocus")};var x;x=y===constant.POI_TYPE_BUSLINE?(0===e?" class='noshowbl buslineInfo addBorderTop panelFocus' ":" class='noshowbl buslineInfo addBorderTop' ")+'onclick="PoiSearchInst.focusPanel(this);" id="item-td-'+e+'" ':y===constant.POI_TYPE_SUBLINE?(0===e?" class='noshowbl sublineInfo panelFocus' ":" class='noshowbl sublineInfo' ")+'onclick="PoiSearchInst.focusPanel(this);" id="item-td-'+e+'" ':(b?" class='poi_biz_r' ":"")+' id="item-td-'+e+'" ',this.isOnlyShowMainRes&&0==t[e].acc_flag&&this.isShowAllTipOn?(0==this.mainResNo?(t[0].poiType===constant.POI_TYPE_SUBLINE||t[0].poiType===constant.POI_TYPE_BUSLINE?(this.curKw.length>14&&(this.curKw=this.curKw.substr(0,12)+"…"),i.push('<tr id="showAllResults"><td id="Tr_A_ShowAll" colSpan="2"><a href="javascript:void(0)" onclick="addStat(\'poilistnormal.poi.displayothers\');PoiSearchInst.showAllRes({noshowbl:true});return false;" class="map_btn"><span class="map_btn_l"><span class="map_btn_r">查找其他名称中含有“'+this.curKw+'”的结果</span></span></a></td></tr><tr style="display:none;" '+x+">")):i.push('<tr><td id="Tr_A_ShowAll" colSpan="2"><a href="javascript:void(0)" onclick="PoiSearchInst.showAllRes();return false;" style="float:right" class="map_btn"><span class="map_btn_l"><span class="map_btn_r">查看全部'+this.displayCount+'条结果</span></span></a></td></tr><tr style="display:none;" '+x+">"),this.isShowAllBtn=!0):i.push('<tr style="display:none;" '+x+">"),this.mainResNo++):(i.push("<tr "+x+">"),t[e].ty==constant.GEO_TYPE_LINE&&t[e].poiType==constant.POI_TYPE_BUSLINE&&w.busLineUid.push(t[e].uid)),t[e].poiType==constant.POI_TYPE_BUSLINE?i.push('<th><div class="bl_icon"></div></th>'):t[e].poiType==constant.POI_TYPE_SUBLINE?i.push('<th><div class="sl_icon"></div></th>'):11==this.json.result.type?(i.push('<th><div id="no'+n+'" class="icon'+(g?" icon-groupon":"")+'" onclick="PoiSearchInst.select('+e+', {statCode:STAT_CODE.STAT_PANEL_SELECT})" title="在图上显示该点">'),i.push("</div></th>")):(i.push('<th><div id="no'+n+'" class="icon'+(g?" icon-groupon":"")+'" onclick="PoiSearchInst.select('+e+', {statCode:STAT_CODE.STAT_GR_ITEM_CLICK})" title="在图上显示该点">'),i.push("</div></th>")),i.push("<td "+("090300"==t[e].new_catalog_id?'style="position:relative"':"")+">"),y!=constant.POI_TYPE_NORMAL&&i.push("<div>"),i.push('<div class="p_title">');var C="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/;if(i.push('<div class="inr_pano">'),"undefined"!=typeof t[e].ext_type&&1&t[e].ext_type&&i.push('<a href="javascript:void(0)" class=\'inr_poi\' data-uid="'+t[e].uid+'" data-wd="'+t[e].name+'" title="查看室内地图"><img alt="查看室内地图" src="'+C+'"/></a>'),t[e].pano&&i.push(t[e].cla[0]&&P.test(t[e].cla[0][1])?"<a href='javascript:void(0);' onclick='addStat(\"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/poilistnormal.poi.pano\");' class='street_view_poi' data-index=\""+e+'" data-iconindex="'+n+"\" ><img src='"+C+"' />全景</a>":"<a href='javascript:void(0);' class='street_view_poi' data-index=\""+e+'" data-iconindex="'+n+"\" ><img src='"+C+"' />全景</a>"),i.push("</div>"),t[e].ext&&t[e].ext.detail_info&&t[e].ext.detail_info.openkitchen&&i.push('<a title="透明橱窗" class="p_openkitchen" target="_blank" href="'+t[e].ext.detail_info.openkitchen+'"'),this.isnbSearch&&t[e].dis){var E="";E=t[e].dis<1e3?t[e].dis+"米":(t[e].dis/1e3).toFixed(1)+"公里",i.push('<div class="nb_dis">'+E+"</div>")}var R="poiTitleW";if(this.isnbSearch&&t[e].dis&&(R+=" poiTitleW--short"),(t[e].poiType==constant.POI_TYPE_BUSLINE||t[e].poiType==constant.POI_TYPE_SUBLINE)&&(R+=" poiTitleW--long"),i.push('<p class="'+R+'">'http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/),i.push(o&&o[0]&&512===o[0].kind?'<a tid="poi_name_'+e+'" id="link'+e+"_show_"+this.guid+'" class = "poi_title" href="javascript:void(0)" onclick="addStat(\'poilistnormal.poi.sublinetitle\');" >':o&&o[0]&&256===o[0].kind?'<a tid="poi_name_'+e+'" id="link'+e+"_show_"+this.guid+'"  class = "poi_title" href="javascript:void(0)" onclick="addStat(\'poilistnormal.poi.buslinetitle\');" >':'<a tid="poi_name_'+e+'" id="link'+e+"_show_"+this.guid+'"  class = "poi_title" href="javascript:void(0)">'),t[e].poiType==constant.POI_TYPE_BUSLINE||t[e].poiType==constant.POI_TYPE_SUBLINE){var M=t[e].name.match(/\((.*)\)$/);if(M){var A=M[1],B=A.length,L=t[e].name.substr(0,t[e].name.length-B-2),k="<span class='busline_title' >"+L+"</span><span class='busline_stops' >"+A+"</span>";i.push(k)}}else i.push(t[e].name);y==constant.POI_TYPE_BUSSTOP?i.push("-公交车站"):y==constant.POI_TYPE_SUBSTOP&&i.push("-地铁站"),i.push("</a>"),this._setDetailLink(t[e],e,i,o,{bPremium:S}),i.push("</p>"),i.push("</div>"),i.push(this._initAlert(t,e));var O=t[e].ext,j=O?O.src_name:"",G=this.json.place_info;if(t[e].indoor_pano){var N=t[e].indoor_pano;i.push('<div class="hotelImg"><div class="hotelImgBox"><img src="'+N+'" onclick="PoiSearchInst.openIndoorPano('+e+',event)"  /><a href="javascript:void(0);" onclick="PoiSearchInst.openIndoorPano('+e+',event)" class="innerPanoBox">室内景</a></div></div>')}else if(O&&O.detail_info&&O.detail_info.image){var U=(j.toUpperCase()+"_",t[e].ext.detail_info.image),D="http://webmap3.map.bdimg.com/maps/services/thumbnails?width=105&height=82&align=center,center&quality=100&src="+encodeURIComponent(U);window.devicePixelRatio>1&&(D="http://webmap3.map.bdimg.com/maps/services/thumbnails?width=140&height=110&align=center,center&quality=100&src="+encodeURIComponent(U)),i.push(o&&o[0]&&512===o[0].kind?'<div class="hotelImg" '+("090300"==t[e].new_catalog_id&&'style="display: none;"')+'><div class="hotelImgBox"><img src="'+D+"\" onclick=\"addStat('poilistnormal.poi.sublineimage');place.showDetail('"+t[e].uid+"', "+y+", "+this.sCityCode+", '"+j+"','Page_Pic','List');\"  /></div></div>":o&&o[0]&&256===o[0].kind?'<div class="hotelImg" '+("090300"==t[e].new_catalog_id&&'style="display: none;"')+'><div class="hotelImgBox"><img src="'+D+"\" onclick=\"addStat('poilistnormal.poi.buslineimage');place.showDetail('"+t[e].uid+"', "+y+", "+this.sCityCode+", '"+j+"','Page_Pic','List');\"  /></div></div>":'<div class="hotelImg" '+("090300"==t[e].new_catalog_id&&'style="display: none;"')+'><div class="hotelImgBox"><img src="'+D+'" onclick="place.showDetail(\''+t[e].uid+"', "+y+", "+this.sCityCode+", '"+j+"','Page_Pic','List');\"  /></div></div>")}if(1==this.json.result.debug&&this.json.debug_info&&this.json.debug_info.results&&this.json.debug_info.results.length&&window.mapDebugObjWxp&&window.mapDebugObjWxp.showPoiDebug&&i.push(window.mapDebugObjWxp.showPoiDebug(this.json.debug_info.results,e)),t[e].addr)if(y==constant.POI_TYPE_BUSSTOP||y==constant.POI_TYPE_SUBSTOP){var F="途经公交车",q="公交";y==constant.POI_TYPE_SUBSTOP&&(F="途经地铁",q="地铁");for(var K,W=util.formatBlinfo(t[e].blinfo),Y=0,H=[],z={},J=W.length;J>Y;Y++){var K=t[e].blinfo[Y].addr;z[K]||(H.push((0!=Y?", ":"")+"<a href='javascript:void(0)' id='line_list_"+e+"_"+Y+"'"),H.push(" onclick='PoiSearchInst.selectBusLine(\""+W[Y].index+'", "'+W[Y].uid+'", '+e+",event);return false;'>"+W[Y].addr+"</a>"),z[K]=!0)}i.push('<p><span class="poi_bustrans">'+F+"：</span>"+H.join("")+"</p>"),window.isPrint||i.push("<div class='remk' id=\"remk_"+e+'">可点击车次查看路线详情</div>'),i.push("</div>"),this.curLines=t[e].blinfo}else{if("090300"==t[e].new_catalog_id)i.push(t[e].ext&&t[e].ext.detail_info&&(t[e].ext.detail_info.book_info||t[e].ext.detail_info.overall_rating||t[e].ext.detail_info.groupon_num)?'<p class="n_p_lineheight" style="width:191px;float:left;">'+t[e].addr+"</p>":'<p class="n_p_lineheight">'+t[e].addr+"</p>");else if(t[e].ext&&"cater"==t[e].ext.src_name){if(t[e].ext.detail_info&&t[e].ext.detail_info.pc_bookable){var Z,V="<a style=\"float:right;clear:right;margin-top:5px;margin-right:18px\" class=\"#{6}\" href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','list');return false;\">#{5}</a>";Z=[t[e].uid,t[e].poiType,this.sCityCode,t[e].ext.src_name,"cater_book","订座","hotel-order-new hotel-order-new-small book-cater"],i.push(baidu.string.format(V,Z))}t[e].addr&&i.push('<p class="n_p_lineheight">地址：'+t[e].addr+"</p>")}else i.push('<p class="n_p_lineheight">地址：'+t[e].addr+"</p>");t[e].tel&&"090300"!=t[e].new_catalog_id&&i.push('<p tid="itemTel_'+e+'" class="n_p_lineheight">电话：'+t[e].tel.replace(/,/g,", ")+"</p>")}else t[e].tel&&"090300"!=t[e].new_catalog_id&&i.push('<p tid="itemTel_'+e+'" class="n_p_lineheight">电话：'+t[e].tel.replace(/,/g,", ")+"</p>");if(O&&G&&this.placeRe.test(O.src_name)&&O.detail_info&&i.push(window.place.generatePlaceListInfo({content:t[e],index:e,placeInfo:this.json.place_info,cityCode:this.sCityCode,lineContent:o,context:{wd:this.what,business_scope_type:this.business_scope_type}})),!this.placeRe.test(j)&&"090300"!=t[e].new_catalog_id&&""!=t[e].show_tag&&t[e].show_tag&&t[e].show_tag.length>0&&"0"!=t[e].tag_num){for(i.push('<p tid="itemTag_'+e+'" class="map_tagBox">标签：'),Y=0;Y<t[e].show_tag.length;Y++)i.push('<span class="map_tagList">'+t[e].show_tag[Y]+"</span>");i.push("</p>")}if(this.children&&t[e].father_son&&this.children[t[e].uid]){i.push('<div style="clear:both"></div>');var X,Q=this.children[t[e].uid],$=this.grandchild;if(Q.length<=8&&0==Q[0].father_son){addStat("poilistnormal.child.childshow","show"),i.push('<p class="remk n_p_lineheight">在此点上有：</p>'),i.push('<ul class="poi-children-list">');for(var te=1,Y=0;Y<Q.length;Y++){this.childDisplay[this.childHTMLIndex]=te,this.fatherIndex[this.childHTMLIndex]=e;var ee=Q[Y].name.split("-")[1]||Q[Y].name;ee.split("(")[1]&&(ee.split(")")[1]||(ee=ee.replace(/\([^\)]*\)/g,"")));var ie=40;(Q[Y].detail&&Q[Y].ty==constant.GEO_TYPE_POINT||Q[Y].poiType==constant.POI_TYPE_BUSLINE||Q[Y].poiType==constant.POI_TYPE_SUBLINE)&&(ie=36),ee.replace(/[\u0100-\uffff]/g,"##").length>ie&&(ee=ee.substring(0,ie/2)+"..."),i.push('<li class="n_p_lineheight normal-child"><a id="child-'+this.childHTMLIndex+'" class="poi-child-link" href="javascript:void(0);">'+te++ +". "+ee+"</a>"),i.push("</li>"),this.childHTMLIndex++,this.childItems.push(Q[Y])}i.push("</ul>")}else{var ne,oe,se,ae;$&&1==Q[0].father_son?(oe=!0,se=Q.length,addStat("poilistnormal.child.pchildshow","show")):(oe=!1,se=1,addStat("poilistnormal.child.childshow","show"),addStat("poilistnormal.child.ctypeshow","show")),i.push('<div class="poi-children">');for(var re=0;se>re;re++){if(oe){var le=Q[re].name.split("-")[1]||Q[re].name;le.split("(")[1]&&(le.split(")")[1]||(le=le.replace(/\([^\)]*\)/g,""))),i.push('<div class="poi-pchild-nav">'),i.push('<p class="poi-pchild-click" id="child-'+this.childHTMLIndex+'">'+le+"</p>"),this.fatherIndex[this.childHTMLIndex]=e,this.childHTMLIndex++,this.childItems.push(Q[re]),Q[re].father_son&&$[Q[re].uid]&&i.push('<div class="pchild-arrow pchild-dw"></div>'),i.push("</div>"),i.push('<div class="poi-child-mod poi-child-hide">'),Q[re].father_son&&$[Q[re].uid]?(X=$[Q[re].uid],ne=this.getChildType(X),catalog=ne.catalog,ae=catalog.length):(catalog=[],ae=0)}else i.push('<div class="poi-child-mod">'),X=Q,ne=this.getChildType(X),catalog=ne.catalog,ae=catalog.length;i.push(oe?'<ul class="poi-children-nav poi-childnav-grand">':'<ul class="poi-children-nav">');for(var ce=0;ae>ce;ce++)i.push(0==ce?'<li class="child-active">'+catalog[ce]+"</li>":"<li>"+catalog[ce]+"</li>");i.push("</ul>"),i.push('<div style="clear:both"></div>');for(var pe=0;ae>pe;pe++){i.push(0==pe?'<ul class="poi-children-list" name="'+catalog[pe]+'">':'<ul class="poi-children-list children-list-hide"  name="'+catalog[pe]+'">');for(var te=1,Y=0;Y<X.length;Y++)if(X[Y].tab_catalog==catalog[pe]){this.childDisplay[this.childHTMLIndex]=te,this.fatherIndex[this.childHTMLIndex]=e;var ee=X[Y].name.split("-")[1]||X[Y].name;ee.split("(")[1]&&(ee.split(")")[1]||(ee=ee.replace(/\([^\)]*\)/g,"")));var ie=40;(X[Y].detail&&X[Y].ty==constant.GEO_TYPE_POINT||X[Y].poiType==constant.POI_TYPE_BUSLINE||X[Y].poiType==constant.POI_TYPE_SUBLINE)&&(ie=36),ee.replace(/[\u0100-\uffff]/g,"##").length>ie&&(ee=ee.substring(0,ie/2)+"..."),i.push('<li class="n_p_lineheight"><a id="child-'+this.childHTMLIndex+'" class="poi-child-link" href="javascript:void(0);">'+te++ +". "+ee+"</a>"),i.push("</li>"),this.childHTMLIndex++,this.childItems.push(X[Y])}i.push("</ul>")}i.push("</div>")}i.push("</div>")}}if(y!=constant.POI_TYPE_BUSLINE&&y!=constant.POI_TYPE_SUBLINE&&(i.push('<p class="p_left">'),y!=constant.POI_TYPE_BUSLINE&&y!=constant.POI_TYPE_SUBLINE&&i.push('<a tid="poiFavBtn_'+e+'"  id="poifav_'+t[e].uid+"\" href=\"javascript:void(0)\" onclick=\"addStat('poilistnormal.poi.poilistfavourite');SyncMgr.goFav({'point':'"+c+"','uid':'"+t[e].uid+"','cityCode':'"+this.sCityCode+"','title':'"+T.encodeHTML(t[e].name)+"','content':'"+T.encodeHTML(s)+"','panoGuid':'"+p+'\'});return false;" class="poi-fav '+u+'"><img class="favorite" alt="'+m+'" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ />收藏</a>'),i.push('<a class="poi-fav" tid="poiSmSBtn_'+e+"\" href=\"javascript:void(0)\" onclick=\"addStat('poilistnormal.poi.poilisttomb');addStat(STAT_CODE.STAT_POI_ONXQ, {ct:'list_page_share',uid:'"+t[e].uid+"'});PoiSearchInst._sendToSMS(this,'"+t[e].uid+"',"+t[e].poiType+","+this.sCityCode+",'list',"+v+',event);return false;"><img class="stml" alt="免费发送到手机" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*//>发送到手机</a>'),i.push("<a class=\"poi-fav\"  href=\"javascript:void(0)\" onclick=\"addStat('poilistnormal.share.poilistshare');PoiSearchInst._sharePOI(event,{from:'poishare', linkinfo:{poiShareUid:'"+t[e].uid+'\'}});return false;"><img class="shareIcon"  alt="分享" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ />分享</a>'),i.push("<a  onclick=\"addStat('poilistnormal.revision.poirevision');PoiSearchInst.goCorrect(1,'"+t[e].uid+'\');" target="_blank" href="http://i.map.baidu.com/api/page/poicorrect/addpoiproblempc?business_trigger=10&poi_uid='+encodeURIComponent(t[e].uid)+'" class="poi-fav poi-favNext" ><img class="correct_jiu" alt="纠错" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*//>纠错</a>'),i.push("</p>")),i.push("</td>"),i.push("</tr>"),t[e].poiType===constant.POI_TYPE_BUSLINE){var de;de="";var he='<tr id = "'+t[e].uid+'"'+(0===e?" class='noshowbl buslineInfo bltimefee panelFocus' ":" class='noshowbl buslineInfo bltimefee' ")+'style="display: none;"><th>&nbsp;</th><td class = "timeFeeInfo"><div class="bus-time">{timetable}</div></td>';i.push(he)}(y==constant.POI_TYPE_BUSLINE||y==constant.POI_TYPE_SUBLINE)&&(i.push('<tr class = "noshowbl" style="display:'+this.currentNodeDisplay+';" onclick = "PoiSearchInst.focusPanelAll(this)"><td class = "noshowbl buslineDetails" colspan="2"><div><div class="noshowbl poi_bus_show" id="bus_info_link_'+e+'" ><a class="btn_bus_show" href="javascript:void(0)" onclick="return PoiSearchInst.showBusInfo('+e+')">途经车站</a></div>'),i.push('<div class="poi_bus_list" id="bus_info_'+e+'" style="display:none"></div></td></tr>'),i.push("</div>")),t[e].addr&&(y==constant.POI_TYPE_BUSSTOP||y==constant.POI_TYPE_SUBSTOP)&&i.push('<tr><td colspan="2" style="padding:0"><div class="lfsPanel" id="LFS_'+e+'"></div></td></tr>'),i.push(1==this.isShowAllBtn?'<tr style="height:5px;display:none"><th></th><td style="font-size:0"></td></tr>':'<tr style="height:5px"><th></th><td style="font-size:0"></td></tr>');var ue=this.json.result.total_busline_num-2;1==e&&t[0]&&t[0].poiType&&(2==t[0].poiType||4==t[0].poiType)&&ue>0&&(i.push('<tr id="more_busline" class = "noshowbl" onmouseover = "T(this).addClass(\'hoverstyle\')" onmouseout = "T(this).removeClass(\'hoverstyle\');" onclick = "addStat(\'poilistnormal.poi.displaymorebl\');PoiSearchInst.fetchMoreBusinfo()"><td></td><td><p>显示其他'+ue+"条线路</p></td></tr>"),addStat("poilistnormal.poi.displaymorebl","show"))},dispMoreBusline:function(t){var e,i,n=this,o="",s=t.content,a=[];n.blObj=s,n.nn&&n.nn>0?(e=n.nn,n.curBuslinePage=0==e?0:(e+2)/10):n.curBuslinePage=0;for(var r=0,l=s.length;l>r;r++){if(a.push(s[r].uid),0==r?s[r].poiType===constant.POI_TYPE_BUSLINE?o+='<tr class="buslineInfo addBorderTop panelFocus focus" onclick="addStat(\'poilistnormal.poi.blshown\');PoiSearchInst.focusPanel(this, {showMoreBl: true});PoiSearchInst.select('+r+', {dispMoreBusline: true});" id="item-td-'+r+'">':s[r].poiType===constant.POI_TYPE_SUBLINE&&(o+='<tr class="sublineInfo panelFocus focus" onclick="addStat(\'poilistnormal.poi.blshown\');PoiSearchInst.focusPanel(this, {showMoreBl: true});PoiSearchInst.select('+r+', {dispMoreBusline: true});" id="item-td-'+r+'">'):s[r].poiType===constant.POI_TYPE_BUSLINE?o+='<tr class="buslineInfo addBorderTop" onclick="addStat(\'poilistnormal.poi.blshown\');PoiSearchInst.focusPanel(this, {showMoreBl: true});PoiSearchInst.select('+r+', {dispMoreBusline: true});">':s[r].poiType===constant.POI_TYPE_SUBLINE&&(o+='<tr class="sublineInfo" onclick="addStat(\'poilistnormal.poi.blshown\');PoiSearchInst.focusPanel(this, {showMoreBl: true});PoiSearchInst.select('+r+', {dispMoreBusline: true});">'),o+='<th><div class="bl_icon"></div></th>',o+='<td><div class="p_title"><div class="inr_pano"></div><p class="poiTitleW poiTitleW--long">',o+='<a tid="poi_name_'+r+'" id="link'+r+"_show_"+n.guid+'" href="javascript:void(0)">',i=s[r].name.match(/\((.*)\)$/)){var c=i[1],p=c.length,d=s[r].name.substr(0,s[r].name.length-p-2);o+="<span class='busline_title' >",o+=d,o+="</span><span class='busline_stops' >",o+=c,o+="</span>"}o+='</a> - <a class="detail blueA" tid="poiDetail_'+r+'" href="javascript:void(0)" onclick="place.showDetail(\''+s[r].uid+"', "+s[r].poiType+", "+n.sCityCode+');return false;">详情»</a></p></div></td></tr>',o+='<tr id = "'+s[r].uid+'"',o+=0==r?'class="buslineInfo bltimefee panelFocus" style="display:;"><th>&nbsp;</th><td class = "timeFeeInfo"><div class="bus-time">{timetable}</div></td></tr>':'class="buslineInfo bltimefee " style="display:;"><th>&nbsp;</th><td class = "timeFeeInfo"><div class="bus-time">{timetable}</div></td></tr>',o+='<tr style="display:'+n.currentNodeDisplay+';" onclick = "PoiSearchInst.focusPanelAll(this)"><td class = "buslineDetails" colspan="2"><div><div class="poi_bus_show" id="bus_info_link_'+r+'" ><a class="btn_bus_show" href="javascript:void(0)" onclick="return PoiSearchInst.showBusInfo('+r+', {dispMoreBusline: true})">途经车站</a></div>',o+='<div class="poi_bus_list" id="bus_info_'+r+'" style="display:none"></div></td></tr>',o+='<tr style="height:5px"><th></th><td style="font-size:0"></td></tr>'}var h=T("#Tr_A_ShowAll a");if(void 0===n.nn||0===n.nn){if(n.blfirstLoad===!0){for(var u=T("#POI_TABLE_LST tr"),_=0;9>_;_++)T(u.get(_)).remove();T("<table id = 'BL_TABLE_LST'><tbody></tbody></table>").insertBefore(T("#POI_TABLE_LST")),T("#BL_TABLE_LST tbody").prepend(o),n.blfirstLoad=!1}else T("#BL_TABLE_LST tbody").html(o);T("#showAllResults").remove(),h&&void 0===T("#showallDivBtn").get(0)&&(h=T("<div id='showallDivBtn'></div>").append(h[0]),h.insertAfter(T("#result_page_c")))}else T("#BL_TABLE_LST tbody").html(o),T("#showAllResults").remove(),h&&!T("#showallDivBtn")&&(h=T("<div id='showallDivBtn'></div>").append(h[0]),h.insertAfter(T("#result_page_c")));n._addTimeInfo(a,!1),T.G("more_busline")&&(T.G("more_busline").style.display="none"),1!==n.buslineTotalPage&&(T.G("result_page_c").style.display=""),n.scrollPanel&&n.scrollPanel.update()},fetchMoreBusinfo:function(){this.setBuslinePager();var t=this.sCityCode,e=this.json.result.wd,i=this;searchData.fetch("bl&c="+encodeURIComponent(t)+"&wd="+encodeURIComponent(e),function(t){i.blfirstLoad=!0,i.dispMoreBusline(t)})},focusPanelAll:function(t){var e=T(t).prevAll("tr"),i=T(".sublineInfo"),n=e.length;T(".buslineInfo").removeClass("panelFocus"),i.removeClass("panelFocus"),T(e[n-1]).addClass("panelFocus"),0===i.length&&T(e[n-2]).addClass("panelFocus")},_sendToSMS:function(t,e,i,n,o,s,a){var r=window.event||a;util.stopBubble(r),sms.ready(t,e,i,n,o,s)},_sharePOI:function(t,e){BShare&&BShare._open(t,e)},_initAlert:function(t,e){var i=t[e].ext?t[e].ext.detail_info:{},n=[],o="",s="";switch(t[e].status){case 1:case 2:case 4:case 8:case 10:break;case 5:o="该店即将开业，建议确认后再去 ";break;case 3:case 9:case 11:o="可能已搬迁或关闭，建议确认后再去 "}return s=i&&i.point?"http://tousu.baidu.com/map/add?place="+encodeURIComponent(t[e].name)+"&lat="+encodeURIComponent(i.point.y)+"&lng="+encodeURIComponent(i.point.x)+"#1":"http://tousu.baidu.com/map/add?place="+encodeURIComponent(t[e].name)+"#1",!t[e].suspected_flag&&o&&(n.push('<div class="msgBox">'),n.push('<span class="alrt"></span>'),n.push(o),n.push('<a target="_blank" href="'+s+"\" onclick=\"addStat('7000',{area:'iw_page',item:'side_alrt_clk',from:'map'})\">欢迎报错</a>"),n.push("</div>"),addStat("7000",{area:"iw_page",item:"side_alrt_show",from:"map"})),n.join("")},_itemOver:function(t,e,i){t&&this.curSelIndex!=e&&T.ac(t,"focus-over");var n=this,o=i?n.childMarkers:n.markers,s=1000100;if(o[e]&&o[e].isVisible()){if(i){if(o[e].isgrand)var a=o[e].textlen,r=new BMap.Icon(constant.PCHILD_MARKER_IMG,new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+a],28),{imageOffset:new BMap.Size(-constant.PCHILD_MARKER_HOVER,-constant.PCHILD_MARKER_HEIGHT*(6-a)),offset:new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+a]/2,constant.PCHILD_MARKER_HEIGHT),infoWindowOffset:new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+a]/2,1)});else var l=n.childDisplay[e]-1,r=new BMap.Icon(constant.CHILD_MARKER_IMG,constant.CHILD_MARKER_GREEN_SIZE,{offset:constant.CHILD_MARKER_OFFSET,imageOffset:new BMap.Size(-constant.CHILD_MARKER_WID*l,-constant.CHILD_MARKER_GREEN_Y),infoWindowOffset:constant.CHILD_MARKER_INFOWND_OFFSET});s++}else var r=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_BLUE_ICON_WID*(e-this.specialCount),-constant.A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});if(o[e].setIcon(r),i&&o[e].isgrand){T(T(o[e].siblingElement).children("div")[0]).css("color","#0f71e8");var c=T.G("child-"+e);T.ac(c,"pchild-nav-active")}o[e].setTop(!0,s)}},_itemOut:function(t,e,i){t&&this.curSelIndex!=e&&T.rc(t,"focus-over");var n=i?this.childMarkers:this.markers;if(n[e]&&n[e].isVisible()){if(i){if(this.fatherIndex[e]==this.curSelIndex&&this.curChildIndex==e)return void n[e].setTop(!0,1)}else if(e==this.curSelIndex)return void n[e].setTop(!0);var o=this;if(i)if(n[e].isgrand)var s=n[e].textlen,a=new BMap.Icon(constant.PCHILD_MARKER_IMG,new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+s],28),{imageOffset:new BMap.Size(0,-constant.PCHILD_MARKER_HEIGHT*(6-s)),offset:new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+s]/2,constant.PCHILD_MARKER_HEIGHT),infoWindowOffset:new BMap.Size(constant["PCHILD_MARKER_WIDTH_"+s]/2,1)});else var r=o.childDisplay[e]-1,a=new BMap.Icon(constant.CHILD_MARKER_IMG,constant.CHILD_MARKER_ORANGE_SIZE,{offset:constant.CHILD_MARKER_OFFSET,imageOffset:new BMap.Size(-constant.CHILD_MARKER_WID*r,-constant.CHILD_MARKER_ORANGE_Y),infoWindowOffset:constant.CHILD_MARKER_INFOWND_OFFSET});else var l=n[e].customProperty&&"normal"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/==n[e].customProperty.type?0:-constant.A_J_MARKER_ORANGE_ICON_Y,a=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_RED_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_RED_ICON_WID*(e-this.specialCount),l),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});if(n[e].setIcon(a),i&&n[e].isgrand){T(T(n[e].siblingElement).children("div")[0]).css("color","#f21101");var c=T.G("child-"+e);T.rc(c,"pchild-nav-active")}n[e].setTop(!1)}},_hotelType:function(t,e,i,n,o,s){s=s||{};var a=this,r="",l={};l[place.URL_PARAM_PREFIX+"data_type"]=t,l[place.URL_PARAM_PREFIX+"sub_type"]=e,l[place.URL_PARAM_PREFIX+"price_section"]=i,l[place.URL_PARAM_PREFIX+"sort_type"]=n,l[place.URL_PARAM_PREFIX+"sort_rule"]=o,l[place.URL_PARAM_PREFIX+"discount2_section"]=place.urlParam[place.URL_PARAM_PREFIX+"discount2_section"],l[place.URL_PARAM_PREFIX+"groupon_section"]=place.urlParam[place.URL_PARAM_PREFIX+"groupon_section"],r=place.getUrlParamString(l);var c=e;if(""==e&&(e=a.curKw,c=a.curKw),e&&e.indexOf("-")>-1){var p=e.split("-");c=p[p.length-1],""==c&&(c=p[p.length-2])}this.isnbSearch?util.loadSearchInfo(a.ctrPoiUid?function(t){t.roundSearchByValue(c,a.ctrPoiUid,"crangeListI",a.centerCityCode,2,a.centerPt.lng,a.centerPt.lat,null,l)}:function(t){t.rangeSearchByValue(c,a.centerPt.lng,a.centerPt.lat,"crangeListI",a.centerCityCode,null,null,null,l)}):comMgr.go("bd&c="+a.sCityCode+"&wd="+encodeURIComponent(c)+r,{cinfo:{isFilter:!0}}),i!==a.priceStatFalg&&void 0!==a.priceStatFalg&&addStat("poilistnormal.poi.foodpriceclick"),a.priceStatFalg=i,e!==a.sortsStatFalg&&void 0!==a.sortsStatFalg&&addStat("poilistnormal.poi.foodsort"),a.sortsStatFalg=e},searchByFilter:function(t){var e=this,i=place.getUrlParamString(t),n=t[place.URL_PARAM_PREFIX+"sub_type"],o=n;if(""==n&&(n=e.curKw,o=e.curKw),n.indexOf("-")>-1){var s=n.split("-");o=s[s.length-1],""==o&&(o=s[s.length-2])}if(this.isnbSearch)util.loadSearchInfo(e.ctrPoiUid?function(i){i.roundSearchByValue(o,e.ctrPoiUid,"crangeListI",e.centerCityCode,2,e.centerPt.lng,e.centerPt.lat,null,t)}:function(i){i.rangeSearchByValue(o,e.centerPt.lng,e.centerPt.lat,"crangeListI",e.centerCityCode,null,null,null,t)});else{if("hotel"===place.cachecategory){var a=place.hotel.getAreaInfo(),r="",l="s&c="+(place.hotel.current_city||e.sCityCode);return a&&!a.content&&!a.geo&&a.name&&(r=a.name+" "),o=r+o,t.hasOwnProperty("wd"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/)&&t.wd?(l+="&wd="+encodeURIComponent(t.wd),delete t.wd):l+="&wd="+encodeURIComponent(o),void comMgr.go(l+i,{cinfo:{isFilter:!0}})}if(t.pl_sub_type.match(/电影院|影院|剧场|影城|剧院/g))return void comMgr.go("s&c="+e.sCityCode+i+"&on_gl=0"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/+(t.wd?"":"&wd="+encodeURIComponent(o)),{cinfo:{isFilter:!0}});if("cater"===place.cachecategory)return comMgr.go("s&c="http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/+e.sCityCode+i+(t.wd?"":"&wd="+encodeURIComponent(o)),{cinfo:{isFilter:!0}});comMgr.go("bd&c="+e.sCityCode+"&wd="+encodeURIComponent(o)+i,{cinfo:{isFilter:!0}})}},_disStaLin:function(t,e,i,n,o){o&&util.stopBubble(o);var s=T.G("LFS_"+t),a=T.G("remk_"+t);a.style.display=i?"none":"block",s.style.display=i?"block":"none",s.innerHTML=n?n:"",this.scrollPanel&&this.scrollPanel.update({notToTop:!0})},_getCateInfo:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(t[i][1]),n-1>i&&e.push(", ");return e.join("")},_generateSingleLink:function(t,e,i){return i?"<a href='javascript:void(0)' class='first'>"+t+"</a>":"<a href='javascript:void(0)'>"+t+"</a>"},_generateMorePopupHtml:function(t){var e=[];e.push("<div>"),e.push("<div class='change_rs_title'>在<span class='important'>"+t+"</span>查找：</div>"),e.push("<div id='crange_cate_list' class='iw_cate_list' style='float:none;margin-top:10px;'>");for(var i=["ATM","银行","宾馆","餐馆","公交站","超市","加油站"],n=0,o=i.length;o>n;n++)e.push(0==n?"<a href='javascript:void(0)' class='first'>"+i[n]+"</a>":"<a href='javascript:void(0)'>"+i[n]+"</a>");return e.push("</div>"),e.push("<div class='mt10'>"),e.push("<form>"),e.push("<span>其他：</span><input id='crangeKw' style='vertical-align:middle;width:140px;padding:0;height:24px;line-height:24px;' type='text' size='20' maxLength='100' autocomplete='off' /> <input id='crangeBtn' class='iw_bt' type='submit' value='搜索' onmouseup='this.className=&quot;iw_bt_over&quot;' onmousedown='this.className=&quot;iw_bt_down&quot;' onmouseout='this.className=&quot;iw_bt&quot;' onmouseover='this.className=&quot;iw_bt_over&quot;'/>"),e.push("</form>"),e.push("</div></div>"),e.join("")},showBusList:function(t){return t.parentNode.style.display="none",t.parentNode.nextSibling.style.display="block",!1},hideBusList:function(t){return t.parentNode.style.display="none",t.parentNode.previousSibling.style.display="block",!1},_showBusLine:function(t,e,i,n,o){var s=this;this._clearBusLine(),this._clearLine(),this._clearArea(),this.curBslUid=t;var a=o?"&bsltp=1":"",r="/?qt=bsl"+a+"&newmap=1&uid="+t+"&c="+s.sCityCode+"&t="+(new Date).getTime();baidu.ajax(r,{dataType:"json",success:function(t){if(t&&(!t||t.content)){var a=t.content[0];a.uid==s.curBslUid&&(s._drawBusLine(a,e,n,o),i&&"function"==typeof i&&i(t))}},error:function(t){console.log("qt=bsl",t)}})},_addTimeInfo:function(t,e,i){var n=this,o="/?qt=bslarr&newmap=1&uids="+t.join(",")+"&c="+n.sCityCode+"&t="+(new Date).getTime();baidu.ajax(o,{dataType:"json",success:function(t){!t||t&&!t.content||n._insertInfoinCtrlPanel(t.content,i)},error:function(t,e){console.log("qt=bsl",e)}})},_insertInfoinCtrlPanel:function(t,e){var i,n,o,s=/\{.+?\}/g;i=T(".bltimefee"),n=T(".bltimefee td"),o=T(".buslinePrice");for(var a=0,r=i.length;r>a;a++)for(var l in t)if(i[a].id===t[l].uid){n[a].innerHTML=n[a].innerHTML.replace(s,function(e){switch(e){case"{timetable}":return t[l].timetable;case"{stime}":return t[l].startTime;case"{etime}":return t[l].endTime;case"{fullticket}":return(t[l].maxPrice/100).toFixed(1)}});var c=t[l].kind,p=T(n[a]);if("showAllBtn"!=e){if(c){for(var d=0;4>=d;d++)c&Math.pow(2,d)&&p.prepend('<div class="bus-type bus-type-'+d+'"></div>');256==c&&p.prepend('<div class="bus-type bus-type-default"></div>')}i[a].style.display=""}}for(var a=0,h=o.length;h>a;a++)for(var l in t)o[a].innerHTML=o[a].innerHTML.replace(s,(t[l].maxPrice/100).toFixed(1)),o[a].style.display=""},_drawBusLine:function(t,e,i,n){var o,s=this,a=util.parseGeo(t.geo);if(this.routeStartEndMkr=[],a&&2==a.type&&(map.showTerminal="yes2",o=mapUtil.addRoute(a.points,constant.ROUTE_TYPE_BUS),this.busPolylines.push(o),this.routeStartEndMkr.push(o._sMarker),this.routeStartEndMkr.push(o._eMarker)),t&&(!t||t.stations)){var r=s.curStops=t.stations;s.stationPoints=[],s.busStopPois=[],s.stationTips=[];for(var l=0,c=r.length;c>l;l++)!function(){var e=l,o=util.parseGeo(r[e].geo);if(1==o.type){var a=mapUtil.addBusStopPoi(o.points,r[e].name);s.busStopPois.push(a),a.addEventListener("click",function(){s.selectBusStop(e,t.name,i)}),s.stationPoints.push(util.getPoiPoint(o.points)),n?(0==l||l==c-1)&&s.stationTips.push(mapUtil.createTip(t.stations[l].name,"TipC",{point:a.getPoint()})):s.stationTips.push(mapUtil.createTip(t.stations[l].name,"TipC",{point:a.getPoint()}))}}();e&&(s.isGRequest&&window.GRControll.setGRequestFlg(1e3),mapUtil.setViewport(s.stationPoints,10))}},_clearBusLine:function(){if(this.busPolylines){for(var t=0,e=this.busPolylines.length;e>t;t++)mapUtil.removeRoute(this.busPolylines[t]),this.busPolylines[t]=null;this.busPolylines.length=0}for(var t=0;t<this.busStopPois.length;t++)this.busStopPois[t]&&(this.busStopPois[t].remove(),this.busStopPois[t]=null,map.removeOverlay(this.stationTips[t]));
for(var t=0;t<this.routeStartEndMkr.length;t++)this.routeStartEndMkr[t]&&(map.removeOverlay(this.routeStartEndMkr[t]),this.routeStartEndMkr[t]=null);this.busStopPois.length=0,this.stationPoints.lengtn=0,this.curStopSelIndex=-1,this._setShareSelIndex(this.curSelIndex)},selectBusLine:function(t,e,i,n,o){n&&(n.target||n.srcElement)&&util.stopBubble(n);var s,a,r,l,c,p=this,d=t.indexOf("_"),h=e.indexOf("_"),u=e;if(d>=0&&(s=t.split("_"),t=s[0],r=s[1]),h>=0&&(a=e.split("_"),e=a[0],l=a[1],c=a[2]),p.isGRequest)return void place.showDetail(e,constant.POI_TYPE_BUSLINE,modelConfig.cityCode);var _=(this.json.content[i],this.curSelIndex);map.closeInfoWindow(),this.curSelIndex=i;this.curLineSelIndex;this.curLineSelIndex=i+"_"+t,this._setShareSelIndex(i);var m="";if(window.searchInViewCtrl&&window.searchInViewCtrl.exit(),this.curActiveLineIndex){var f=this.curActiveLineGuid.split("_")[0];if(f!=e&&f!=l){var g=i+"_"+(c&&t>r?r:t),w=T.G("line_list_"+this.curActiveLineIndex),v=T.G("line_list_"+g);T.rc(w,"active"),T.ac(v,"active"),this.curActiveLineIndex=g,this.curActiveLineGuid=u}}else{var v=T.G("line_list_"+i+"_"+t);T.ac(v,"active"),this.curActiveLineIndex=i+"_"+t,this.curActiveLineGuid=u}this._showBusLine(e,!1,function(s){var a=[];m=s.content[0].name,lineData=s.content[0],_!=i&&p.curSelA&&(T.rc(p.curSelA,"focus"),T.rc(p.curSelA,"focus-over")),a.push("<span title='关闭' class='c' onclick='PoiSearchInst._disStaLin("+i+","+t+",false,false,event)'>&times;</span><dl class='lfs'><dt>"+lineData.name),h>=0&&a.push(" <a href='javascript:void(0)' tid='routeReturn' onclick='PoiSearchInst.selectBusLine(\""+r+"_"+t+'", "'+l+"_"+e+'_1", '+i+", event);return false;'>返程</a>"),a.push('</dt><dd><table cellspacing="1" cellpadding="0" width="100%">'),lineData.startTime&&lineData.endTime?a.push("<tr><th>起点站首末班时间</th><td>"+lineData.startTime+" - "+lineData.endTime+"</td></tr>"):(lineData.startTime&&a.push("<tr><th>起点站首班时间</th><td>"+lineData.startTime+"</td></tr>"),lineData.endTime&&a.push("<tr><th>起点站末班时间</th><td>"+lineData.endTime+"</td></tr>")),lineData.maxPrice&&a.push("<tr><th>单程最高票价</th><td>"+(lineData.maxPrice/100).toFixed(2)+"元</td></tr>"),a.push("</table></dd></dl>"),p._disStaLin(i,t,!0,a.join(""));var c=T.G("item-td-"+i);c&&(T.ac(c,"focus"),T.rc(c,"focus-over"),p.curSelA=c),p._setShareSelIndex(p.curSelIndex),n||(p.isGRequest&&window.GRControll.setGRequestFlg(1e3),map.setCenter(p.points[i])),o&&"function"==typeof o&&o(),this.scrollPanel&&this.scrollPanel.update({notToTop:!0})},i),window.PanoMap&&window.PanoMap.isOpen&&window.PanoMap.hide()},showBusInfo:function(t,e){var i=this;e=e||{};var n={force:!0,showBLCbk:function(n){if(n&&(!n||n.content)){var o=n.content[0];if(o){var s=T.G("bus_info_"+t);if(s){s.style.display="block";var a=T.G("bus_info_link_"+t);a&&(a.style.display="none");var r=["<div class='bus'><table cellspacing='0' cellpadding='0' class='station'>"],l=i.curStops=o.stations,c=(l.length,i.json.content),p=i.curBusLineType=i.returnLType(n.result.linetype);e.dispMoreBusline&&(c=i.blObj),i.showPanoEntrance=function(t){var e=T(t).children("a")[1];null!==e.getAttribute("data-pname")&&(e.style.visibility="visible")},i.hidePanoEntrance=function(t){var e=T(t).children("a")[1];e.style.visibility="hidden"};for(var d=l.length,h=Math.ceil(d/2),u=d%2===1?(d+1)/2:d/2,_=0;h>_;_++,u++){var m,f,g,w;m=l[_],f=m.name,w=l[u],m.name.length>7&&(m.name=m.name.substr(0,7)+"…"),r.push("<tr id='stop_list_"+t+"_"+_+"'>"),r.push("<td class = 'stop_list_left' onmouseover = 'PoiSearchInst.showPanoEntrance(this)' onmouseout = 'PoiSearchInst.hidePanoEntrance(this)' >"),r.push("<a class = 'firstCon' href='javascript:void(0)' onclick='return PoiSearchInst.selectBusStop("+_+', "'+c[t].name+'", '+t+")'>"+(_+1)+"."+m.name+"</a>"),r.push('<a data-name="'+f+'" data-buslineUid="'+o.uid+'" data-uid="'+m.uid+'" data-point="'+util.parseGeo(m.geo).points+'" data-poitype="'+(1==p?"010A03":"010A05")+'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:hidden"><img src="'+modelConfig.timg+'" ></a></td>'),u!=d&&(g=w.name,w.name.length>7&&(w.name=w.name.substr(0,7)+"…"),r.push("<td class = 'stop_list_right' onmouseover = 'PoiSearchInst.showPanoEntrance(this)' onmouseout = 'PoiSearchInst.hidePanoEntrance(this)' >"),r.push("<a class = 'firstCon' href='javascript:void(0)' onclick='return PoiSearchInst.selectBusStop("+u+', "'+c[t].name+'", '+t+")'>"+(u+1)+"."+w.name+"</a>"),r.push('<a data-name="'+g+'" data-buslineUid="'+o.uid+'" data-uid="'+w.uid+'" data-point="'+util.parseGeo(w.geo).points+'" data-poitype="'+(1==p?"010A03":"010A05")+'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:hidden"><img src="'+modelConfig.timg+'" ></a></td>'),r.push("</tr>"))}r.push("</table></div>"),s.innerHTML='<a class="btn_bus_hide" href="javascript:void(0)" onclick="return PoiSearchInst.hideBusInfo(\''+t+"')\">点击站名查看车站位置</a>"+r.join(""),i.scrollPanel&&i.scrollPanel.update({notToTop:!0}),i.setPanoEntrances(function(t){i.busPanoData=t;var e=T(s).find(".stop_list_left .list_street_view_poi").get(),n=T(s).find(".stop_list_right .list_street_view_poi").get(),o=e.concat(n);PanoEntranceUtil.walkThroughPanoEntrances(T(o),t,"busline"),T(o).css("visibility","hidden")}),e.sbiCbk&&"function"==typeof e.sbiCbk&&e.sbiCbk()}}}}};for(var o in e)n[o]=e[o];this.select(t,n)},hideBusInfo:function(t){var e=T.G("bus_info_link_"+t);e&&(e.style.display="block");var i=T.G("bus_info_"+t);i&&(i.style.display="none"),this.scrollPanel&&this.scrollPanel.update({notToTop:!0})},showCircleTool:function(){var t=this;if(MapConfig.poiSearch.showCircle&&t.json){var e=null;e=t.json.center&&t.json.center.poi?util.getPointByStr(util.parseGeo(t.json.center.poi[0].geo).points):t.cinfo.centerPoint,NbSearch.show(e)}},_processNoResult:function(t,e,i){var n=[],o=this.sCityName,s=this.json.center,a=s&&s.poi&&s.poi[0]&&s.poi[0].name,r=this.cinfo.sg_search||0;if(this.isnbSearch){var l=["<p class='black'>在"],c="";if(a)c="http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(s.poi[0].name+" "+this.curKw)+"&cl=3",l.push("“<span class='nr_kw'>"+s.poi[0].name+"</span>”");else{var c="http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(this.curKw)+"&cl=3";l.push("“<span class='nr_kw'>未知地点</span>”")}l.push("附近 "),l.push("查找;“<span class='nr_kw'>"+this.curKw+"</span>” "),l.push("&nbsp<a id='aChangeRange' class='arrowLink' href='javascript:void(0)'>更改条件</a></p>","<hr size='1' class='nr_hr' />"),i.result_title=l.join(""),n.push("<p>未找到相关地点。</p>","<p>您可在上方",this.isGRequest?"":"<strong>更改距离</strong>或","<strong>更改条件</strong>再次尝试。</p>",a?iKnow.getIknowCode("想知道: "+o+" "+s.poi[0].name+"附近哪有"+this.curKw):null,"<div class='nr_suggest'>您还可以：","<ul><li>看看输入的文字是否有误</li>"),n.push(a?'<li>在百度网页中查找“<a href="'+c+'">'+s.poi[0].name+" "+this.curKw+"</a>”</li>":'<li>在百度网页中查找“<a href="'+c+'">'+this.curKw+"</a>”</li>"),n.push("</ul></div>")}else{if(this.isGRequest)i.no_result_title="<p class='no_result_title'>在<strong>当前视图区域</strong>内未找到相关地点。";else{var p=[];(!(this.json.suggest_query&&this.json.suggest_query.length||this.json.psrs&&this.json.psrs.SENum)||this.json.suggest_query&&r)&&(o?(p=["<p class='no_result_title'>在<strong>"+o+"</strong>"],0!=this.ctype&&void 0!=this.ctype&&p.push("及<strong>全国</strong>范围"),p.push("内未找到相关地点。</P>"),i.no_result_title=p.join("")):(0==this.ctype||void 0==this.ctype)&&(i.no_result_title="<p class='no_result_title'>在<strong>全国</strong>范围内未找到相关地点。</p>"))}var d=iKnow.getPromptInfo("想知道: "+this.curKw+"在哪",this.curKw);n.push(d)}return i.no_result=n.join(""),e(i)},setCenterPt:function(t,e){var i=this,n=null;if(this.isnbSearch){if(this.centerPoi=e.addRangeSearchCenterPoi(this.centerPt,this.ctrPoiName,!1),window.GRControll.isGRCircleShow&&this.showCircleTool(),t&&t.poi&&t.poi[0]){var o=t.poi[0].addr,s=t.poi[0].tel;(t.poi[0].poiType==constant.POI_TYPE_BUSSTOP||t.poi[0].poiType==constant.POI_TYPE_SUBSTOP)&&(o=T.array.unique(o.split(";")).join("; ")),s&&(s=s.replace(/,/g,", ")),n={title:this.ctrPoiName,addr:o,tel:s,uid:t.poi[0].uid,poiType:t.poi[0].poiType,ext:t.poi[0].ext,status:t.poi[0].status,cp:t.poi[0].cp,cla:t.poi[0].cla},this.cInfoWnd=e.createSearchInfoWnd(n,{cityCode:this.centerCityCode,x:this.centerPt.lng,y:this.centerPt.lat})}else this.cinfo&&this.cinfo.centerPoint&&(n={title:this.ctrPoiName},this.cInfoWnd=e.createSearchInfoWnd(n,{x:this.centerPt.lng,y:this.centerPt.lat,cityCode:this.centerCityCode}));this.centerPoi&&this.cInfoWnd&&(this.cInfoWnd.addEventListener("close",function(){i._setTop(this.overlay,!1),i.curSelIndex=-1,i._setShareSelIndex(i.curSelIndex)}),this.centerPoi.addEventListener("click",function(){if(e.content=n,"c"!=i.curSelIndex){window.GRControll.isGRCircleShow&&(i.showCircleTool(),window.GRControll.isGRCircleShow=!0),i.select(-1);var t=this;setTimeout(function(){i._setTop(t,!0)},200),e.openSearchInfoWndPOI(i.cInfoWnd,i.centerPoi),i.curSelIndex="c",i._setShareSelIndex(i.curSelIndex)}}),this.centerPoi.addEventListener("mouseover",function(){i._setTop(this,!0,!0)}),this.centerPoi.addEventListener("mouseout",function(){map.temp.infoWin&&1==map.temp.infoWin.isOpen()&&map.temp.infoWin.overlay===this||i._setTop(this,!1)}))}},_addCenterPoint:function(t){var e=this;util.loadSearchInfo(function(i){e.setCenterPt(t,i)})},suggQuery:function(t,e,i,n){if(n=n||!1,t){e||(e=0);{this.curKw?this.curKw:"",this.sCityName}comMgr.go("s&from=webmap&stp=0&wd="+encodeURIComponent(t)+"&c="+this.sCityCode+"&src="+e+"&force_query="+n,{cinfo:{sg_search:1}})}},selectBusStop:function(t,e,i,n){if(this.curStopSelIndex!=i+"_"+t||this.stationPoints[t]&&!map.getBounds().containsPoint(this.stationPoints[t])){var o=this,s=this.curStops;if(s){var a=(this.json.content,o.busStopPois[t]);map.closeInfoWindow();var r=this.curStopSelIndex;this.curStopSelIndex=i+"_"+t,this._setShareSelIndex(i),s[t]&&(window.GRControll.isClearBeforeSend=!1,searchData.fetch("inf&uid="+s[t].uid+"&c="+o.sCityCode+"&it="+STAT_CODE.STAT_INF_STOP,function(i){if(i&&i.content){var r,l=e;i.content&&i.content.addr&&(l=i.content.addr,r=i.content.blinfo),l=T.array.unique(l.split(";")).join("; ");var c="";c=i.content&&i.content.primary_uid?i.content.primary_uid:s[t].uid,util.loadSearchInfo(function(e){var p=e.createSearchInfoWnd({title:s[t].name,addr:l,uid:c,blinfo:r,poiType:i.content.poiType},{forBusLine:!0,cityCode:o.sCityCode,x:o.stationPoints[t].lng,y:o.stationPoints[t].lat});o.busPanoData&&o.busPanoData[t]?(p=PanoEntranceUtil.addPanoThumbnailsInInfoWnd([p],[o.busPanoData[t]],o.busPanoData,"busline")[0],p.addEventListener("close",function(){T.G("stop_list_"+o.curStopSelIndex)&&T.rc(T.G("stop_list_"+o.curStopSelIndex),"selected"),o.curStopSelIndex=-1,o._setShareSelIndex(o.curSelIndex)}),e.openSearchInfoWndPOI(p,a,n)):o.setPanoEntrances(function(i){o.busPanoData=i,o.busPanoData&&o.busPanoData[t]&&(p=PanoEntranceUtil.addPanoThumbnailsInInfoWnd([p],[o.busPanoData[t]],o.busPanoData,"busline")[0]),p.addEventListener("close",function(){T.G("stop_list_"+o.curStopSelIndex)&&T.rc(T.G("stop_list_"+o.curStopSelIndex),"selected"),o.curStopSelIndex=-1,o._setShareSelIndex(o.curSelIndex)}),e.openSearchInfoWndPOI(p,a,n)})})}}),T.G("stop_list_"+r)&&T.rc(T.G("stop_list_"+r),"selected"),T(".bus td").on("click",function(t){T(".bus td").removeClass("busStopFocus"),T(t.target).parent().addClass("busStopFocus")}))}}},_setTop:function(t,e,i,n){return t&&t.setTop?(n=n||{},e&&!t._isTop?(t._isTop=!0,void(i?t.setTop(!0,1000100):n.isSon?t.setTop(!0,1000101):t.setTop(!0))):void(e||(t._isTop=null,t.setTop(!1)))):void 0},_showSpacePoi:function(t,e){if(t){var i=BMap.MapType[map.mapType].zoomLevelMax-3,n="ext&uid="+t+"&l="+i+"&c="+this.sCityCode+"&wd="+encodeURIComponent(e);searchData.fetch(n,function(t){t&&t.content&&comMgr.load("SpacePoi",{cinfo:{initData:t,poiName:e}})},function(){})}},_setShareSelIndex:function(t){var e=this.curLineSelIndex,i=this.curStopSelIndex;"undefined"==typeof t&&(t=-1),"undefined"==typeof e?e=-1:(e=this.curLineSelIndex+"",e=e.split("_")&&e.split("_")[1]||-1),"undefined"==typeof i?i=-1:(i=this.curStopSelIndex+"",i=i.split("_")&&i.split("_")[1]||-1);var n="";this.isGRequest&&this.json&&this.json.content&&this.json.content[t]&&(n="|"+this.json.content[t].uid),Share.listIndex=t+"|"+e+"|"+i+n},_processUrlReappear:function(t){if(-1!=t&&this.cinfo._index){var e=this.reIndex[0],i=this.reIndex[1],n=this.reIndex[2],o=this;if(t==constant.POI_TYPE_BUSLINE||t==constant.POI_TYPE_SUBLINE)-1!=n?setTimeout(function(){o.showBusInfo(e,{forReAppear:!0,sbiCbk:function(){o.selectBusStop(n,"",e,{})}})},100):setTimeout(function(){o.selectBusStop(n,"",o.curSelIndex,{notMove:!0,notZoom:!0})},100);else if(t==constant.POI_TYPE_BUSSTOP||t==constant.POI_TYPE_SUBSTOP){var s=this.json.content;s[this.curSelIndex]&&s[this.curSelIndex].blinfo[i]&&s[this.curSelIndex].blinfo[i].uid&&(this.selectBusLine(i,s[this.curSelIndex].blinfo[i].uid,this.curSelIndex,!0,function(){-1!=n&&setTimeout(function(){o.selectBusStop(n,"",e,{notMove:!0,notZoom:!0})},100)}),T.G("btn_unfold_bsline_"+this.curSelIndex)&&this.showBusList(T.G("btn_unfold_bsline_"+this.curSelIndex)))}}},hideBarCircleTool:function(){NbSearch.hide(),window.GRControll.isGRCircleShow=!1},showAllRes:function(t){addStat(STAT_CODE.STAT_STRONG_ALL,{wd:this.curKw?this.curKw:"",uid:1}),this.isShowAllRes=!0;var e=T.G("Tr_P_UpdateInfo");e&&e.parentNode.removeChild(e);var i=T.G("Tr_A_ShowAll");i&&i.parentNode.removeChild(i);var n=T("#showallDivBtn");n.remove();var o=T.G("POI_TABLE_LST").getElementsByTagName("TR"),s=T.G("BL_TABLE_LST");if(s&&s.remove(),t&&t.noshowbl)for(var a=0,r=o.length;r>a;a++)o[a].style.display="none"==o[a].style.display?"":"none";else for(var a=0,r=o.length;r>a;a++)"none"==o[a].style.display&&(o[a].style.display="");this._clearBusLine(),this._clearLine(),this._clearArea();for(var l=0,c=this.json.content,a=0,p=this.json.result.count;p>a;a++)if(c[a].poiType!=constant.POI_TYPE_BUSLINE&&c[a].poiType!=constant.POI_TYPE_SUBLINE&&(l++,this.showIconIndices[a]=l),1!=c[a].acc_flag)if(this.uids.push(c[a].uid),c[a].poiType!=constant.POI_TYPE_BUSLINE&&c[a].poiType!=constant.POI_TYPE_SUBLINE){if(this.children&&1===c[a].father_son&&this.children[c[a].uid])for(var d=this.children[c[a].uid],h=0;h<d.length;h++){var u=util.parseGeo(d[h].geo);1==u.type&&(this.childMarkers.push(mapUtil.addSearchPoi(u.points,this.childMarkerIndex,d[h].name,{uid:d[h].uid,ext_type:d[h].ext_type,type:"child",origin_id:d[h].origin_id||{}})),this.childPoints.push(util.getPointByStr(u.points)),this.childMarkerIndex++)}var _=util.parseGeo(c[a].geo);1==_.type&&(this.markers.push(mapUtil.addSearchPoi(_.points,l-1,c[a].name,{uid:c[a].uid,ext_type:c[a].ext_type,groupon:c[a].ext&&c[a].ext.detail_info.groupon,origin_id:c[a].origin_id||{}})),this.points.push(util.getPointByStr(_.points)))}else this.markers.push(""),this.points.push("");this.initialize({from:"showAllBtn"}),1!=this.json.result.area_profile&&mapUtil.setViewport(this.points,30),T.G("result_page_c").style.display="",Share.setPoiShowAll(1),this.scrollPanel.update({notToTop:!0})},sendSateSuggestQuery:function(t,e){map.setMapType(BMAP_NORMAL_MAP);var i=e||modelConfig.cityCode;comMgr.go("con&contp=0&wd="+encodeURIComponent(t)+"&pn=0&c="+i+"&check_sate=0")},bindEvent:function(){var t=this;this.$el.on("click","#poisearch-show-all-btn",function(){t.showAllRes()}),baidu.on("poiAdClose","click",function(){baidu.g("poiAdContainer").innerHTML="",T.cookie.set("poiCmsAd","2",{expires:6048e5})}),baidu("a.street_view_poi").on("click",function(e){var i=baidu(this).data("index"),n=baidu(this).data("iconIndex");t.openPano(i,n),e.preventDefault(),util.stopBubble(e)}),baidu("#nuomi_guid").on("click",function(){addStat("indexleftmenu.placemenu.groupon",null,{da_trd:"团购"})})},bindMarkersEvent:function(){var t=this,e=this.json.content,i=this.markers,n=STAT_CODE.STAT_PANEL_SELECT,o=STAT_CODE.STAT_MAP_SELECT,s=0;11!=t.json.result.type&&(n=STAT_CODE.STAT_GR_ITEM_CLICK,o=STAT_CODE.STAT_GR_MARKER_CLICK);for(var a=0,r=i.length;r>a;a++)!window.isPrint&&this.isShowAllRes&&e[a]&&1==e[a].acc_flag?s++:!function(){var r=a,l=t.json.content[r].poiType;i[a]&&(i[a]._visible||i[a].isVisible())&&(T("#item-td-"+a).mouseenter(function(){t._itemOver(T.G("item-td-"+r),r)}),T("#item-td-"+a).mouseleave(function(){t._itemOut(T.G("item-td-"+r),r)}),i[a].addEventListener("click",function(){t.select(r,{statCode:o,ct:"mk",showBusLine:t.showBusLine})}),i[a].addEventListener("mouseover",function(){t._itemOver(T.G("item-td-"+r),r)}),i[a].addEventListener("mouseout",function(){t._itemOut(T.G("item-td-"+r),r)}));var c=T.G("no"+(a+1-s)),p=T.G("item-td-"+r);T.on(p,"click",function(i){i=i||window.event;var o={};if("yes"===t.showInfoFlag)o.statCode=n,o.notZoom=!0,t._showInfoWindow(e,r,o),T.ac(p,"focus"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/PoiSearch/);else{var s=t.json.line_content;s&&s[0]&&512===s[0].kind?t._clickItem(i,r,"poilistnormal.poi.sublinetotalclick"):s&&s[0]&&256===s[0].kind?t._clickItem(i,r,"poilistnormal.poi.buslinetotalclick"):t._clickItem(i,r,n)}}),c&&(T.on(c,"mouseover",function(){t._itemOver(null,r)}),T.on(c,"mouseout",function(){t._itemOut(null,r,l)}))}();1==i.length&&e[0].ty==constant.GEO_TYPE_LINE&&e[0].poiType!=constant.POI_TYPE_BUSLINE&&e[0].poiType!=constant.POI_TYPE_SUBLINE&&(t.showInfoFlag="yes",t._showLine(e,0,{statCode:n}))},getChildType:function(t){var e=[];return T.array(t).each(function(t,i){T.array(e).contains(i.tab_catalog)||e.push(i.tab_catalog)}),{type:1,catalog:e}},bindChildrenEvent:function(){{var t=this.childMarkers;this.json.content}T.on(T(".poi-pchild-click"),"click",function(t){addStat("poilistnormal.child.pchildclick"),t.stopPropagation();var e=T(t.target),i=e.parent().parent().find(".pchild-nav-active");e.hasClass("pchild-nav-active")||(i.removeClass("pchild-nav-active"),e.addClass("pchild-nav-active"))}),T(".pchild-arrow").off("click"),T.on(T(".pchild-arrow"),"click",function(e){e.stopPropagation();var i,n,o,s=T(e.target),a=s.parent().children(".pchild-arrow"),r=T(a.parent().next("div")[0]),l=a.parent().parent().find(".pchild-up"),c=T(l.parent().next("div")[0]),p=l.parent().children(".pchild-arrow");r.hasClass("poi-child-mod")&&(a[0]==l[0]?(r.toggleClass("poi-child-hide"),s.removeClass("pchild-up"),s.addClass("pchild-dw"),i=r.find("a"),i.each(function(e,i){t[parseInt(T(i).attr("id").split("-")[1])].hide()})):(c.toggleClass("poi-child-hide"),p.removeClass("pchild-up"),p.addClass("pchild-dw"),r.toggleClass("poi-child-hide"),s.removeClass("pchild-dw"),s.addClass("pchild-up"),n=r.find(".poi-children-list"),n.each(function(t,e){T(e).hasClass("children-list-hide")||(i=T(e).find("a"))}),i.each(function(e,i){t[parseInt(T(i).attr("id").split("-")[1])].show()}),o=c.find("a"),o.each(function(e,i){t[parseInt(T(i).attr("id").split("-")[1])].hide()})))});var e=T(".poi-children-nav"),i=e.children(),n=T(".poi-child-mod").children(".poi-children-list"),o={},s=0;n.each(function(t,e){o[s]=[];var i=T(e).find("a");i.each(function(t,e){o[s].push(parseInt(T(e).attr("id").split("-")[1]))}),s++}),i.each(function(i,n){T.on(T(n),"click",function(n){n.stopPropagation();var s=T(n.target),a=s.html(),r=s.parents(".poi-child-mod"),l=o[i].length;if(addStat(e.hasClass("poi-childnav-grand")?"poilistnormal.child.ptypeclick":"poilistnormal.child.ctypeclick"),s.hasClass("child-active"));else{for(var c,p=s.parent().children(".child-active"),d=r.children(".poi-children-list"),h=0;l>h;h++)t[o[i][h]].show();d.each(function(e,i){var n=T(i);n.hasClass("children-list-hide")?n.attr("name")==a&&(c=n):(n.addClass("children-list-hide"),n.find("a").each(function(e,i){t[parseInt(T(i).attr("id").split("-")[1])].hide()}))}),c.removeClass("children-list-hide"),p.removeClass("child-active"),s.addClass("child-active")}})})},bindChildrenMarkersEvent:function(){for(var t=this,e=this.childMarkers,i=(this.json.content,0),n=e.length;n>i;i++)!window.isPrint&&this.isShowAllRes&&t.childBindIndex>i||!function(){var n=i;t.childBindIndex++,e[i]&&(T("#child-"+i).mouseenter(function(){t._itemOver(T.G("child-"+n),n,!0)}),T("#child-"+i).mouseleave(function(){t._itemOut(T.G("child-"+n),n,!0)}),T.on(T.G("child-"+n),"click",function(e){e=e||window.event,t._clickItem(e,t.fatherIndex[n],void 0,{childIndex:n}),e.stopPropagation()}),e[i].addEventListener("click",function(e){addStat(e.target.isgrand?"poilistnormal.child.pcclick":e.target.isgchild?"poilistnormal.child.ppclick":"poilistnormal.child.ccclick"),t.select(t.fatherIndex[n],{childIndex:n})}),e[i].addEventListener("mouseover",function(){t._itemOver(T.G("item-td-"+t.fatherIndex[n]),n,!0)}),e[i].addEventListener("mouseout",function(){t._itemOut(T.G("item-td-"+t.fatherIndex[n]),n,!0)}))}()},_clickItem:function(t,e,i,n){var o=this,s=t.srcElement||t.target,a={statCode:i,showBusLine:o.showBusLine};T.dom.hasClass(s,"street_view_poi")?a.ct="list_page_street":T.dom.hasClass(s,"inr_poi")?a.ct="list_page_inr":T.dom.hasClass(s,"pano_poi")&&(a.ct="list_page_pano"),n&&"childIndex"in n?this.select(e,{childIndex:n.childIndex,showBusLine:o.showBusLine}):this.select(e,a),this._setStreetview(e),"pano_poi"!=s.className&&window.PanoMap&&PanoMap.isOpen&&PanoMap.hide(),"string"==typeof i&&addStat(i)},setBuslinePager:function(){{var t=this;new Page("result_page_c",function(e){var i,n=t.sCityCode,o=t.json.result.wd;i=e-1===0?0:10*(e-1),t.nn=i,searchData.fetch("bl&c="+encodeURIComponent(n)+"&wd="+encodeURIComponent(o)+"&nn="+i,function(e){t.dispMoreBusline(e)})},{pageCount:t.buslineTotalPage,page:t.curPage+1,update:!0})}this.isShowAllTipOn&&this.isOnlyShowMainRes&&(T.G("result_page_c").style.display="none"),this.scrollPanel&&this.scrollPanel.update({notToTop:!0})},setPoiPaging:function(){var t=this;if(this.pagingCount>10){var e=this.sugKw?1:0,i="&db="+this.json.result.db;if(this.isnbSearch){if(this.cinfo.centerPoint){{var n=(this.cinfo.centerPoint.lng,this.cinfo.centerPoint.lat,this.cinfo.uid),o=t.radius,t=this;new Page("result_page_c",function(s){var a=t.getNormalNum(s),r="";if(t.isGRequest){r="&da_src=pcmappg.poi.page&on_gel=1&src=7&gr=3",GRControll.openedMarker=null;var l=map.getBounds(),c=Math.min(l.minX,l.maxX),p=Math.max(l.minX,l.maxX),d=Math.min(l.minY,l.maxY),h=Math.max(l.minY,l.maxY);r+="&b=("+c+","+d+";"+p+","+h+")&l="+map.zoomLevel,t.cinfo&&t.cinfo.centerPoint&&(r+="&nb_x="+t.cinfo.centerPoint.lng,r+="&nb_y="+t.cinfo.centerPoint.lat),window.GRControll.GRCircleRadius&&(r+="&gr_radius="+window.GRControll.GRCircleRadius),window.GRControll.noRemoveTip1=!0}comMgr.go("nb&c="+t.sCityCode+place.urlArr+"&wd="+encodeURIComponent(t.curKw)+"&uid="+n+"&pn="+(s-1)+i+"&wd2="+encodeURIComponent(t.sugKw)+"&sug="+e+r+"&nn="+a,{cinfo:{isClickNextPage:!0,searchByContextMenu:!0,centerPoint:t.cinfo.centerPoint,ctrPoiName:t.ctrPoiName,radius:o,bizCount:t.bizCount}})},{pageCount:t.totalPage,page:t.curPage+1,update:!1})}this.isShowAllTipOn&&this.isOnlyShowMainRes&&(T.G("result_page_c").style.display="none")}else{new Page("result_page_c",function(n){var o=t.getNormalNum(n),s="";if(t.isGRequest){s="&da_src=pcmappg.poi.page&on_gel=1&src=7&gr=3",window.GRControll.openedMarker=null;var a=map.getBounds(),r=Math.min(a.minX,a.maxX),l=Math.max(a.minX,a.maxX),c=Math.min(a.minY,a.maxY),p=Math.max(a.minY,a.maxY);s+="&b=("+r+","+c+";"+l+","+p+")&l="+map.zoomLevel,window.GRControll.noRemoveTip1=!0}comMgr.go("nb&c="+t.centerCityCode+"&wd="+encodeURIComponent(t.curKw)+"&uid="+t.ctrPoiUid+"&r="+t.radius+"&pn="+(n-1)+i+place.urlArr+"&wd2="+encodeURIComponent(t.sugKw)+"&sug="+e+s+"&nn="+o,{cinfo:{isClickNextPage:!0,bizCount:t.bizCount}})},{pageCount:t.totalPage,page:t.curPage+1,update:!1})}this.isShowAllTipOn&&this.isOnlyShowMainRes&&(T.G("result_page_c").style.display="none")}else{{new Page("result_page_c",function(n){var o=t.getNormalNum(n),s="";if(t.isGRequest){s="&da_src=pcmappg.poi.page&on_gel=1&src=7&gr=3",window.GRControll.openedMarker=null;var a=map.getBounds(),r=Math.min(a.minX,a.maxX),l=Math.max(a.minX,a.maxX),c=Math.min(a.minY,a.maxY),p=Math.max(a.minY,a.maxY);s+="&b=("+r+","+c+";"+l+","+p+")&l="+map.zoomLevel,window.GRControll.noRemoveTip1=!0}var d=45==t.cmdNo?"s":"con",h="&addr=0";map.noShowBl=!0,comMgr.go(d+"&from=webmap&c="+t.sCityCode+place.urlArr+"&wd="+encodeURIComponent(t.curKw)+"&pn="+(n-1)+i+"&wd2="+encodeURIComponent(t.sugKw)+"&sug="+e+s+h+"&nn="+o,{cinfo:{isClickNextPage:!0,bizCount:t.bizCount}})},{pageCount:t.totalPage,page:t.curPage+1,update:!1})}this.isShowAllTipOn&&this.isOnlyShowMainRes&&(T.G("result_page_c").style.display="none")}}},revertUrl:function(){if(!hasRevertUrl){hasRevertUrl=!0;var t=this;if(this.cinfo&&(this.cinfo._maplevel&&this.cinfo._centerPoint||(this.cinfo._maplevel?map.zoomTo(this.cinfo._maplevel):this.cinfo._centerPoint&&map.setCenter(this.cinfo._centerPoint)),"undefined"!=typeof this.cinfo._index&&t.json&&t.json.content)){this.cinfo._index=decodeURIComponent(this.cinfo._index);var e=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[0]||this.cinfo._index,i=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[1]||-1,n=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[2]||-1,o=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[3]||"",s=!0;""!=o&&t.json&&t.json.content&&t.json.content[e]&&o!=t.json.content[e].uid&&(s=!1),s&&(this.reIndex=[e,i,n],this.setMarkerOpenInUrl(e,i,n))}}},valiSuggQuery:function(){if(this.json&&this.json.content&&this.json.result&&0==this.json.result.page_num&&this.json.result.sug_index>=0&&this.json.result.sug_index<=9){if(this.cinfo&&!this.cinfo._maplevel&&!this.cinfo._centerPoint){if(this.json.content[this.json.result.sug_index]){this.isGRequest;var t=util.parseGeo(this.json.content[this.json.result.sug_index].geo),e=map.pointToPixel(util.getPointByStr(t.points)),i=map.pixelToPoint(new BMap.Pixel(e.x,e.y-60)),n=BMap.MapType[map.mapType].zoomLevelMax;this.isGRequest,map.centerAndZoom(i,n)}var o=this;if(setTimeout(function(){o.select(o.json.result.sug_index,{notZoom:!0})},500),T.G("MapInfo")&&this.json.result.sug_index>0&&T.G("link"+this.json.result.sug_index+"_show_"+this.guid)){var s=T.G("item-td-"+this.json.result.sug_index);s&&(T.G("MapInfo").scrollTop=s.offsetTop)}}}else T.G("MapInfo")&&(T.G("MapInfo").scrollTop=0)},getBizCount:function(){if(!this.json||!this.json.content)return 0;for(var t=this.json.content,e=0,i=0,n=t.length;n>i;i++)t[i].biz_type&&1==t[i].biz_type&&e++;return e},getNormalNum:function(t){var e=0;return t>2?e=10*(t-1)-this.specialCount-this.bizCount:t>1&&(e=(t-1)*this.curItemPPage-this.specialCount-this.bizCount),e},bindEvtForAreaFilter:function(){var t=T.g("areaLink");t&&baidu.on(t,"click",function(t){var e=t.target||t.srcElement;if("a"==e.tagName.toLowerCase()){var i=e.innerHTML,n=parseInt(place.area("level"),0);place.area("level",++n>=2?2:n),place.area("bLast")?(place.area("menu").splice(2,1),place.area("menu")[1]=i,place.area("level",1)):place.area("menu")[place.area("level")]=i}})},setBdShare:function(){var t=this;BShare.getMInfo=function(){var e="",i="more",n=(t.curKw,t.curSelIndex),o=t.json;if(o&&o.content&&t.displayCount&&0!=t.displayCount){var s=o.content[n];if(s){var a=s.name||"",r=s.addr||"",l=s.tel||"",c=t.points[n];switch(c&&(c=c.lng+" "+c.lat),s.poiType){case constant.POI_TYPE_BUSLINE:i="busline";break;case constant.POI_TYPE_SUBLINE:i="busline";break;case constant.POI_TYPE_BUSSTOP:i="single",a=BShare.fixName(a+"-公交车站"),r=r?"途经公交："+T.array.unique(r.split(";")).join("; "):"";break;case constant.POI_TYPE_SUBSTOP:i="single",a=BShare.fixName(a+"-地铁站"),r=r?"途经地铁："+T.array.unique(r.split(";")).join("; "):"";break;default:i="single",a=BShare.fixName(a),l=l.replace(/,/g,", ")}e=[a,r,l].join(" ")}else e=t.curKw+"的搜索结果 "}return{text:e,className:t._className,type:i}}},openPano:function(t,e){var i=this.json,n=(i.result.wd,i.content[t]),o={uid:n.uid,index:e-1,addr:n.addr,from:"list",wd:i.result.wd};PanoInterface.showPano({panoId:n.sid,research:!0,panoType:"street",searchParam:o,from:"PoiSearch"}),addStat(STAT_CODE.STAT_PANORAMA,{item:"street",catalog:"list",func:"click",query:i.result.wd})},openIndoorPano:function(t,e){e=e||window.event;var i=this.json,n=i.content[t],o={uid:n.uid,from:"list",wd:i.result.wd};PanoInterface.showPano({panoId:n.sid,research:!0,panoType:"inter",searchParam:o}),util.stopBubble(e),addStat(STAT_CODE.STAT_PANORAMA,{item:"inter",catalog:"list",func:"click",query:i.result.wd})},_setStreetview:function(t){if(PanoUtil.isOpen){var e=this.json,i=e.content[t],n=this;1!=i.pano&&PanoUtil.isOpen?require.async("common:widget/ui/PanoMsgBox/PanoMsgBox.js",function(t){n.msgBox=new t({data:{info:"这个地方暂时没有全景哟~",funtype:"no"}}),n.msgBox.show()}):this.openPano(t,t+1)}},changeMapAfterSearch:function(t){var e=map.mapType;e!=BMAP_NORMAL_MAP&&map.mapType==BMAP_SATELLITE_MAP&&(sateCityList.isSateMapSupportCity(t)||maptypeCtrl.select(BMAP_NORMAL_MAP))},setPanoEntrances:function(t){for(var e=this,i=e.curStops,n=null,o=i.length,s=(e.json.content,e.curBusLineType),a=[],r=0;o>r;r++)n=i[r],a.push({mercatorLnglat:util.parseGeo(n.geo).points,poiType:1==s?"010A03":"010A05",name:n.name});PanoEntranceUtil.insertPanoInfoInSearch(a,"busline",function(n){if(null!==n)for(var s=0;o>s;s++)n[s].uid=i[s].uid,n[s].buslineUid=e.curBslUid;t(n)})},returnLType:function(t){var e=[[0,2,3,4,5,6,7,9,10,11],[1,12,13,14],[8]],n=e.length;for(i=0;n>i;i++){var o=e[i];for(j=0;j<o.length;j++){var s=o[j];if(s==t)return i}}},goCorrect:function(t,e){util.loadSearchInfo(function(i){i.goCorrect(t,e)}),addStat("poiinfowin.revision.revisionbtn")},setWeiPaiTool:function(){},poiSearchFor3D:function(){}}),module.exports=PoiSearch});