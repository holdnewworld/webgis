define("common:widget/com/MapSign/MapSign.js",function(n,t,i){function a(n){n=n||{},T.lang.Class.call(this,n),window.MapSignInst=this,this.cinfo=n.cinfo||{},c=this.cinfo.searchInfoWindow||{},this._USERSHARE=1,this.oFav=null,this.checkFlash=0,this.ls=null,this.userTagPanl=null,this.temp={iw:{_iw:null,title:"",content:"",mkhsCode:null,guid:null,index:0,marker:null,edit:0,list:{}},cur:{label:null,index:13},icon:null,plObj:null,event:{}},this.infav={},this.isShowPoiLab=0,this.poiMarker={},this.config={iw:{index:0,title:"我的标记",content:"我的备注",cityCode:1,fav:0,save:0,show:0,toal:0,lagerT:50},pl:{toal:0,lagerT:50},lb:{label:{},toal:0,index:0,lagerT:20},cur:{11:{_w:12,w:21,h:21,l:0,t:0,x:6,y:21},12:{_w:12,w:21,h:21,l:23,t:0,x:6,y:21},13:{_w:12,w:21,h:21,l:46,t:0,x:6,y:21},14:{_w:12,w:21,h:21,l:69,t:0,x:6,y:21},15:{_w:12,w:21,h:21,l:92,t:0,x:6,y:21},16:{_w:12,w:21,h:21,l:115,t:0,x:6,y:21},21:{_w:19,w:23,h:25,l:0,t:21,x:9,y:25},22:{_w:19,w:23,h:25,l:23,t:21,x:9,y:25},23:{_w:19,w:23,h:25,l:46,t:21,x:9,y:25},24:{_w:19,w:23,h:25,l:69,t:21,x:9,y:25},25:{_w:19,w:23,h:25,l:92,t:21,x:9,y:25},26:{_w:19,w:23,h:25,l:115,t:21,x:9,y:25},31:{_w:17,w:21,h:21,l:0,t:46,x:1,y:21},32:{_w:17,w:21,h:21,l:23,t:46,x:1,y:21},33:{_w:17,w:21,h:21,l:46,t:46,x:1,y:21},34:{_w:17,w:21,h:21,l:69,t:46,x:1,y:21},35:{_w:17,w:21,h:21,l:92,t:46,x:1,y:21},36:{_w:17,w:21,h:21,l:115,t:46,x:1,y:21},41:{_w:25,w:25,h:25,l:0,t:67,x:12,y:25},42:{_w:25,w:25,h:25,l:25,t:67,x:12,y:25},43:{_w:24,w:24,h:25,l:50,t:67,x:12,y:25},44:{_w:25,w:25,h:25,l:75,t:67,x:12,y:25},45:{_w:25,w:25,h:25,l:100,t:67,x:12,y:25},46:{_w:19,w:19,h:25,l:125,t:67,x:9,y:25}}},this.favTime="",this.favArr=[],this.LINEICON=new BMap.Icon("../../../../../../../api.map.baidu.com/images/mapctrls.png"/*tpa=http://api.map.baidu.com/images/mapctrls.png*/,new BMap.Size(11,11),{imageOffset:new BMap.Size(-26,-313)}),this.LINECLOSEICON=new BMap.Icon("../../../../../../../api.map.baidu.com/images/mapctrls.gif"/*tpa=http://api.map.baidu.com/images/mapctrls.gif*/,new BMap.Size(12,12),{imageOffset:new BMap.Size(0,-14)}),this.lineId=0,this.curLineId=0,this.lineMarker={},this.lineArr={},this.textInfo={1:"名称最多15个字",2:"请输入文字",3:"黄反",4:"您最多可输入100个字",5:"您最多可输入50个字"},this.tabDom=null,this.tabIndex=null,this.followInfo={point:"点击左键标记位置，右键或Esc退出",polyline:"",remark:"可点击想要标记的位置"},this._temp={signType:null,event:{}},this.userId=baidu.cookie.get("BAIDUID")||"",this.render()}var o=n("common:widget/ui/constant/Constant.js"),s=n("common:widget/ui/mapUtil/mapUtil.js"),p=n("common:widget/ui/util/util.js"),r=n("common:widget/ui/SyncMgr/SyncMgr.js"),l=n("common:widget/ui/signMgr/signMgr.js"),g=n("common:widget/ui/tools/tools.js"),c=null;T.lang.inherits(a,T.lang.Class,"MapSign"),T.object.extend(a.prototype,{render:function(){try{var t=".userTagPanl{width:119px;height:65px;position:relative}.userTagPanl .cont{position:relative;width:119px;height:65px;overflow:hidden}.userTagPanl .bg{width:119px;height:96px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/us_sign_16b1fce.png) no-repeat 0 0;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale', src='../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/us_sign_16b1fce.png'/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/us_sign_16b1fce.png*/);_background:0 0}.userTagPanl .bg div{width:118px;position:absolute;top:27px;left:1px}.userTagPanl .bg div b{display:block;width:33px;height:27px;float:left;margin:4px 0 0 4px;display:inline;cursor:pointer}.userTagPanl .userTagPanlP{background-position:-5px -69px}.userTagPanl .userTagPanlL{background-position:-42px -69px}.userTagPanl .userTagPanlF{background-position:-79px -69px}.userTagPanl .bg .closeBtn{position:absolute;width:10px;height:10px;overflow:hidden;top:-23px;right:9px}.userTagPanl .hover{background-image:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/us_sign_16b1fce.png)}#userTagPanl #J_TagPInfo{top:36px;left:-9px;width:146px}#userTagPanl .point .j{left:31px}#userTagPanl .polyline .j{left:72px}#userTagPanl .remark .j{left:115px}.userSignIwBox{margin:8px 0 0 15px;color:#333}.userSignIwBox .hide{display:none}.userSignIw{width:285px;float:left}.sign_photoBox{float:left;width:32px;text-align:center;margin-left:6px;_display:inline;cursor:pointer}.sign_photoBox span{color:#4673cc;display:block;*margin-top:4px;text-decoration:underline}.userSignIw .userSignTip{position:absolute;left:29px;top:22px;width:193px;z-index:100}.userSignIw .userTagCont{margin-top:5px;-zoom:1;overflow:hidden}.userSignIw .userTagCont .userSignTip{top:52px;*top:51px}.userSignIw .hide{display:none}#selectPhoto{padding:10px 0 0 30px}#selectPhoto .goEdit{text-align:right;margin-top:8px;*margin-top:6px}#selectPhoto li{height:33px;margin-top:2px;*margin-top:-1px;_margin-top:-3px}#selectPhoto li a{float:left;display:block;border:1px solid #fff;width:36px;height:32px;text-align:center;margin:0 11px 0 1px;display:inline}#selectPhoto li a.on,#selectPhoto li a:hover{border:1px solid #83A5E2;background-color:#EFF3FC}.userSignTip{border:#dfb35c solid 1px;background:#fffecd;color:#cc0003;padding:2px;line-height:18px}.usLbContent textarea{resize:none;margin:0;padding:0;border:0;overflow:visible;width:100%;word-wrap:break-word;white-space:-moz-pre-wrap}.usLbContent textarea:focus{outline:0}.sp_s{background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/us_cursor_4c00be8.gif) no-repeat;overflow:hidden}.sp_11{width:12px;height:21px;background-position:0 0;margin-top:5px}.sp_12{width:12px;height:21px;background-position:-23px 0;margin-top:5px}.sp_13{width:12px;height:21px;background-position:-46px 0;margin-top:5px}.sp_14{width:12px;height:21px;background-position:-69px 0;margin-top:5px}.sp_15{width:12px;height:21px;background-position:-92px 0;margin-top:5px}.sp_16{width:12px;height:21px;background-position:-115px 0;margin-top:5px}.sp_21{width:19px;height:25px;background-position:0 -21px;margin-top:3px}.sp_22{width:19px;height:25px;background-position:-23px -21px;margin-top:3px}.sp_23{width:19px;height:25px;background-position:-46px -21px;margin-top:3px}.sp_24{width:19px;height:25px;background-position:-69px -21px;margin-top:3px}.sp_25{width:19px;height:25px;background-position:-92px -21px;margin-top:3px}.sp_26{width:19px;height:25px;background-position:-115px -21px;margin-top:3px}.sp_31{width:17px;height:21px;background-position:0 -46px;margin-top:5px}.sp_32{width:17px;height:21px;background-position:-23px -46px;margin-top:5px}.sp_33{width:17px;height:21px;background-position:-46px -46px;margin-top:5px}.sp_34{width:17px;height:21px;background-position:-69px -46px;margin-top:5px}.sp_35{width:17px;height:21px;background-position:-92px -46px;margin-top:5px}.sp_36{width:17px;height:21px;background-position:-115px -46px;margin-top:5px}.sp_41{width:25px;height:25px;background-position:0 -67px;margin-top:3px}.sp_42{width:25px;height:25px;background-position:-25px -67px;margin-top:3px}.sp_43{width:24px;height:24px;background-position:-50px -67px;margin-top:3px}.sp_44{width:25px;height:25px;background-position:-75px -67px;margin-top:3px}.sp_45{width:25px;height:24px;background-position:-100px -67px;margin-top:3px}.sp_46{width:19px;height:25px;background-position:-125px -67px;margin-top:3px}.favSignBt .favBtnOver{background-position:left center}.favSignBt .favBtnDown{background-position:left bottom;font-weight:700}.favSign li a.smallFavBtnOver{background-position:-68px -29px}.favSign li a.smallFavBtnDown{background-position:-68px -58px;font-weight:700}";n.loadCss({content:t,name:"MapSign"}),this.cinfo&&this.cinfo.arg&&l.fun(this.cinfo.arg)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/MapSign/MapSign.js",ln:338})}},mapSign:function(){var n=this;if(g.closeMeasure(),g.endCaptureMap(),l.userTagPanl)return void(l.userTagPanl.isVisible()?n.exituserSign():(l.userTagPanl.show(),n.refreshTab(),T.ac(T.g("signwrap"),"span_focus")));if(!l.userTagPanl){l.userTagPanl=this._creUserTagPanl(),map.addControl(l.userTagPanl),l.userTagPanl.contDom.style.right=(map.width-119)/2+"px",l.userTagPanl.contDom.style.top="42px",l.userTagPanl.contDom._offset.width=(map.width-119)/2,n.refreshTab(),T.ac(T.g("signwrap"),"span_focus");var t=function(){l.userTagPanl.contDom.style.right=(map.width-119)/2+"px",l.userTagPanl.contDom._offset.width=(map.width-119)/2};return map.addEventListener("resize",t),void(n._temp.event.map=[{obj:map,type:"resize",fun:t}])}},_creUserTagPanl:function(){var n=this,t=function(){this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new BMap.Size(318,10)};return t.prototype=new BMap.Control,t.prototype.initialize=function(){try{this.contDom=document.createElement("div"),this.contDom.className="userTagPanl",this.contDom.id="userTagPanl";var t='<div class="cont" id="userSignPanel">';return t+='<div class="bg">',t+="<div>",t+='<b title="标记地点" userTagPanl="1" class="userTagPanlP" onclick="Instance(\''+n.guid+"').tab(0);return false;\" onmouseover=\"Instance('"+n.guid+"').tabOver(this,0);\" onmouseout=\"Instance('"+n.guid+"').tabOut(this,0);\"></b>",t+='<b title="手绘路线" userTagPanl="2" class="userTagPanlL" onclick="Instance(\''+n.guid+"').tab(1);return false;\" onmouseover=\"Instance('"+n.guid+"').tabOver(this,1);\" onmouseout=\"Instance('"+n.guid+"').tabOut(this,1);\"></b>",t+='<b title="文字备注" userTagPanl="3" class="userTagPanlF" onclick="Instance(\''+n.guid+"').tab(2);return false;\" onmouseover=\"Instance('"+n.guid+"').tabOver(this,2);\" onmouseout=\"Instance('"+n.guid+"').tabOut(this,2);\"></b>",t+='<b title="关闭" onclick="Instance(\''+n.guid+'\').exituserSign();return false;" class="closeBtn"></b>',t+="</div></div></div>",this.contDom.innerHTML=t,this.contDom._anchor=BMAP_ANCHOR_TOP_RIGHT,this.contDom._offset=new BMap.Size(318,42),map.getContainer().appendChild(this.contDom),n.tabDom=this.contDom,this.contDom}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/MapSign/MapSign.js",ln:405})}},t.prototype.getrightpx=function(){var n=map.getSize().width,t=(n-135)/2;return t=228>t?228:t},t.prototype.setZindex=function(n){this.contDom.style.zIndex=n},new t},tab:function(n){var t=this,e=t.tabDom.getElementsByTagName("b");if(n==t.tabIndex)return t.exitMask(),!1;switch(null!=t.tabIndex&&e[t.tabIndex]?T.rc(e[t.tabIndex],"hover"):null,t.tabIndex=n,T.ac(e[t.tabIndex],"hover"),t.tabIndex){case 0:t.openPoint();break;case 1:t.openPolyline();break;case 2:t.openRemark()}},tabOver:function(n,t){var e=this;t!=e.tabIndex&&T.ac(n,"hover")},tabOut:function(n,t){var e=this;t!=e.tabIndex&&T.rc(n,"hover")},refreshTab:function(){this.tab(0)},resetTab:function(){var n=this;if(n.tabDom){var t=n.tabDom.getElementsByTagName("b");null!=n.tabIndex&&t[n.tabIndex]&&T.rc(t[n.tabIndex],"hover"),n.tabIndex=null}},openPoint:function(){var n=this;if(n.exitFun(),n._temp.signType="Point",MapSignInst.config.iw.toal>=MapSignInst.config.iw.lagerT)return MapSignInst.showTipInfo("您最多可创建"+MapSignInst.config.iw.lagerT+"个标记点","J_TagPInfo","userTagPanl","point"),void n.exitFun();var t=n.initMask("transparent.cur,default,curLab",this.openPointFun),e=function(t){var e=(new Date).getTime();if(!(n.openPoint.lastTime&&n.openPoint.lastTime>0&&e-n.openPoint.lastTime<500)){n.openPoint.lastTime=e;var i=MapSignInst.createMark("",t),a=MapSignInst.config.iw.index-1;MapSignInst.openInfoWnd(i,a,{type:"new"}),MapSignInst.exitCurLab(),n.exitFollowTip(),BMap.OperationMask.setCursor(map.getDefaultCursor()),setTimeout(function(){n.exitMask()},150)}};T.on(t,"click"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/,e),n._temp.event.point&&n._temp.event.point.push?n._temp.event.point.push({obj:t,type:"click",fun:e}):n._temp.event.point=[{obj:t,type:"click",fun:e}],n.showFollowTip("point")},exitPoint:function(){var n=this;if(n._temp.event.point&&n._temp.event.point.length>0){for(var t=0;t<n._temp.event.point.length;t++){var e=n._temp.event.point[t];T.un(e.obj,e.type,e.fun),n._temp.signType=null}n._temp.event.point=[]}},openPolyline:function(){var n=this;map.closeInfoWindow(),n.exitFun(),this.showFollowTip("polyline"),BMap.OperationMask.show(map),MapSignInst.addLine(),n._temp.signType="Polyline"},stopLine:function(){var n=new BMap.Marker(e.point,{icon:MapSignInst.LINECLOSEICON,enableMassClear:!1});map.addOverlay(n)},exitPolyline:function(){var n=this;MapSignInst.temp.plObj&&MapSignInst.temp.plObj.close(),n._temp.signType=null},openRemark:function(){var n=this;n.exitFun(),n._temp.signType="Remark";var n=this;if(MapSignInst.config.lb.toal>=MapSignInst.config.lb.lagerT)return MapSignInst.showTipInfo("您最多可创建"+MapSignInst.config.lb.lagerT+"个文字备注","J_TagPInfo","userTagPanl","remark"),void n.exitFun();var t=n.initMask(" ,text"),e=function(t){var e=(new Date).getTime();n.openRemark.lastTime&&n.openRemark.lastTime>0&&e-n.openRemark.lastTime<500||(n.openRemark.lastTime=e,MapSignInst.createLabel({},t),n.exitFollowTip(),BMap.OperationMask.setCursor(map.getDefaultCursor()),setTimeout(function(){n.exitMask()},150))};T.on(t,"click",e),n._temp.event.remark=[{obj:t,type:"click",fun:e}],n.showFollowTip("remark")},exitRemark:function(){var n=this;if(n._temp.event.remark){var t=n._temp.event.remark[0];T.un(t.obj,t.type,t.fun),n._temp.signType=null}},initMask:function(n){map.closeInfoWindow();var t=this,e=(n.split(",")[0],n.split(",")[1]),i=n.split(",")[2]||"",a="";l.userTagPanl.setZindex(2e4),BMap.OperationMask.show(map);var o=BMap.OperationMask.getDom(map);BMap.OperationMask.setCursor("url('"+a+"'),"+e),i&&MapSignInst.showCurLab();var s=function(n){2==n.button&&t.exitMask()},p=function(n){27==n.keyCode&&t.exitMask()};return T.on(o,"mouseup",s),T.on(document,"keydown",p),t._temp.event.mask=[{obj:o,type:"mouseup",fun:s},{obj:document,type:"keydown",fun:p}],o},exitMaskFun:function(){var n=this;if(n._temp.event.mask&&n._temp.event.mask.length>0){for(var t=0;t<n._temp.event.mask.length;t++){var e=n._temp.event.mask[t];T.un(e.obj,e.type,e.fun)}n._temp.event.mask=[]}},hideMask:function(){var n=BMap.OperationMask.getDom(map);BMap.OperationMask.hide(map),n.style.cursor="pointer"},exituserSign:function(){var n=this;if(T.rc(T.g("signwrap"),"span_focus"),l.userTagPanl&&l.userTagPanl.hide(),n.exitMask(),n._temp.event.map&&n._temp.event.map.length>0){for(var t=0;t<n._temp.event.map.length;t++){var e=n._temp.event.map[t];map.removeEventListener(e.type,e.fun)}n._temp.event.map=[]}},showFollowTip:function(n){var t=this;if(t.followShow=!1,t.followInfo[n]){var e;t.followTitle||(e=t.followTitle=new BMap.Label(t.followInfo[n],{offset:new BMap.Size(0,0)})),e=t.followTitle,e.setOffset(new BMap.Size(8,14)),"point"==n&&e.setOffset(new BMap.Size(5,5)),e.setStyles({color:"#333",borderColor:"#ff0103"}),e.setContent(t.followInfo[n]),map.addOverlay(e),e.hide(),t.followShow=!0;var i=function(n){if(t.followShow){n=window.event||n;var i=n.target||n.srcElement;if(i!=BMap.OperationMask.getDom(map))return void e.hide();e.show();var a=BMap.OperationMask.getDrawPoint(n,!0);e.setPoint(a),t.followShow=!0}};T.on(document,"mousemove",i),t._temp.event.followTip=[{obj:document,type:"mousemove",fun:i}]}},exitFollowTip:function(){var n=this;if(n._temp.event.followTip&&n._temp.event.followTip.length>0){var t=n._temp.event.followTip[0];n.followTitle.hide(),T.un(t.obj,t.type,t.fun),n._temp.event.followTip=[]}},exitFun:function(){var n=this;n._temp.signType&&n["exit"+n._temp.signType]();try{n.exitFollowTip(),n.exitMaskFun(),MapSignInst.exitCurLab()}catch(t){}},exitMask:function(){var n=this;n.hideMask(),n.resetTab(),n.exitFun()},connectFlash:function(t){var e;return MapSignInst.checkFlash?e=t():(document.getElementById("J_fav_my")||p.beforeEndHTML(document.body,'<div style="witdh:0;height:0;overflow:hidden" id="J_fav_my"></div>'),n.async("common:widget/ui/localStorage/LocalStorage.js",function(n){MapSignInst.ls=new n({contentID:"J_fav_my",flashID:"fsign",flashURL:"../../../swf/LocalStorage.swf"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/swf/LocalStorage.swf*/}),MapSignInst.ls.render({callBack:function(){MapSignInst.checkFlash=1;var n=baidu.swf.getMovie("fsign").read;if(void 0==n)var i=window.setInterval(function(){n=baidu.swf.getMovie("fsign").read,void 0!=n&&(window.clearInterval(i),e=t())},50);else e=t()}})})),e},filtXss:function(n){var n=n||"";return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},getDeXssNum:function(n){var t=/&amp;|&lt;|&gt;|&quot;|&#39;/g;return n.match(t).length},checkTextInfo:function(n,t){return 1==n||2==n||4==n||5==n?(t.innerHTML=MapSignInst.textInfo[n],void T.rc(t,"hide")):1},autoSetMarkerNameByGEOResult:function(n){var t=n.content;if(t&&t.address){var e=t.address;t.surround_poi&&t.surround_poi[0]&&(e=t.surround_poi[0].addr);for(var i in l.mapSign.pointInfo.list){var a=l.mapSign.pointInfo.list[i];if(a.point==t.point.x+"|"+t.point.y){if(a.title==a.geoName||!a.geoName){a.title=e,a.geoName=e,MapSignInst.poiMarker[i].getLabel().setContent(e);var o=T.G("us_infoWnd_title");o&&(o.value=e),MapSignInst.temp.iw.list[i]&&(MapSignInst.temp.iw.list[i].title=e)}break}}}},createMark:function(n,t,e){var i,a,o,r,g,c,u,d,f,m,h=MapSignInst.config.iw.index;if(e)i=new BMap.Point(n.point.split("|")[0],n.point.split("|")[1]),o=a=n.title,r=e&&"share"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/==e.from?l.deCodeShare(n.content):n.content,g=n.cityCode,save=1,d=n.show,f=n.cur,m=n.uid,MapSignInst.temp.cur.index=f,c=0,e&&"share"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/==e.from?c=e.isInFav:e&&"fav"==e.from&&(c=1);else{var t=t||window.event;i=BMap.OperationMask.getDrawPoint(t,!0),a=MapSignInst.config.iw.title,o="",r=MapSignInst.config.iw.content,g=MapSignInst.config.iw.cityCode,c=MapSignInst.config.iw.fav,save=MapSignInst.config.iw.save,d=MapSignInst.config.iw.show,f=MapSignInst.temp.cur.index,m=MapSignInst.config.iw.uid}var v=MapSignInst.config.cur[f],w=function(n){var t,e;if("undefined"!=typeof n){var a=l.mapSign.pointInfo.list[n].point;t=a.split("|")[0],e=a.split("|")[1]}else t=i.lng,e=i.lat;var n="undefined"!=typeof n?n:MapSignInst.config.iw.index,o="?newmap=1&qt=ncent&b="+t+","+e+";"+t+","+e+"&l=12&t="+new Date;baidu.ajax(o,{dataType:"json",success:function(t){var e=t||{},i=l.mapSign.pointInfo.list[n].cityCode,a=e.current_city.code;i!=a&&(l.mapSign.pointInfo.list[n].cityCode=e.current_city.code,1!=i&&i!=a&&map.closeInfoWindow())},error:function(){}})};e||w();var I=new BMap.Marker(i,{enableMassClear:!1,title:a}),M=new BMap.Label(o,{offset:new BMap.Size(v._w-v.x+3,-20)});return u=MapSignInst.createIcon(),e&&"fav"==e.from&&(u=new BMap.Icon("image/iw_bg.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/image/iw_bg.png*/,new BMap.Size(12,12),{imageOffset:new BMap.Size(-180,-136),infoWindowOffset:new BMap.Size(7,0)}),M.hide(),I._from="fav"),MapSignInst.isShowPoiLab||M.hide(),M.addEventListener("mouseover",function(){MapSignInst.poiMarker[h].setTop(!0,27e7)}),M.addEventListener("mouseout",function(){MapSignInst.poiMarker[h].setTop(!0,26e7)}),M.addEventListener("click",function(){MapSignInst.openInfoWnd(MapSignInst.poiMarker[h],h,{type:"marker"})}),M.setStyle({borderColor:"#808080",color:"#333",cursor:"pointer",padding:"1px 2px"}),I.setIcon(u),I.setLabel(M),I.addEventListener("click",function(){var n=e?e.from||"":"";MapSignInst.openInfoWnd(this,h,{type:"marker",from:n})}),I.addEventListener("mouseover",function(){this.setTop(!0,27e7)}),I.addEventListener("mouseout",function(){this.setTop(!0,26e7)}),e||(I.addEventListener("dragend",function(){var n=p.getOverlayPoint(this),t=n.lng+"|"+n.lat;l.mapSign.pointInfo.list[h].point!=t&&(s.getGEORevertAddress({lng:n.lng,lat:n.lat},function(n){MapSignInst.autoSetMarkerNameByGEOResult(n)}),l.mapSign.pointInfo.list[h].point=t,w(h))}),I.enableDragging(!0)),map.addOverlay(I),e||I.setTitle("可移动改变位置"),l.mapSign.pointInfo.list[h]||(l.mapSign.pointInfo.list[h]={point:i.lng+"|"+i.lat,title:a,content:r,cityCode:g,fav:c,save:save,show:d,cur:f,uid:m},MapSignInst.poiMarker[h]=I),MapSignInst.temp.iw.index=h,MapSignInst.temp.iw.pre=h,MapSignInst.temp.iw.marker=I,MapSignInst.config.iw.index++,MapSignInst.config.iw.toal++,I},createInfoWnd:function(n,t,e){var i=(n.index,c.createSearchInfoWnd(n,t));return i.addEventListener("open",function(){{var n=MapSignInst.temp.iw.index,t=MapSignInst.temp.iw.marker;new BMap.Label("",{offset:new BMap.Size(5,-10)})}MapSignInst.poiMarker[n].iwOpen=!0,"new"!=e.type||t.editInfo||(T.browser.opera?setTimeout(function(){MapSignInst.editInfoWnd(e)},120):MapSignInst.editInfoWnd(e)),MapSignInst.poiMarker[n].getLabel().hide(),MapSignInst.temp.cur.index=l.mapSign.pointInfo.list[n].cur,MapSignInst.temp.iw.mkhsCode=MapSignInst.poiMarker[n].hashCode,MapSignInst.temp.iw.pre=n}),i.addEventListener("close",function(){var n=MapSignInst.temp.iw.pre,t=l.mapSign.pointInfo.list[n];if(MapSignInst.temp.iw.mkhsCode=null,1!=t.save){var e=T.trim(T.G("us_infoWnd_title").value),i=T.trim(T.G("us_infoWnd_content").value);MapSignInst.temp.iw.list[n]={title:e,content:i}}if(t.show=0,1!=MapSignInst.temp.iw.edit){var a=MapSignInst.poiMarker[n].getLabel(),o=MapSignInst.temp.cur.index,s=MapSignInst.config.cur[o];a.setContent(t.title),a.getDom().title=t.title,a.setStyle({left:s._w-s.x+3+"px"}),a.show(),MapSignInst.temp.iw&&MapSignInst.temp.iw.marker&&"fav"==MapSignInst.temp.iw.marker._from&&a.hide()}else MapSignInst.temp.iw.edit=0;MapSignInst.temp.iw.guid=null}),MapSignInst.temp.iw._iw=i,i},openInfoWnd:function(n,t,e){if(MapSignInst.temp.iw.mkhsCode!=n.hashCode){var e=e||{},i=l.mapSign.pointInfo.list[t];i.show=1;var a=i.point.split("|")[0],o=i.point.split("|")[1],p=function(){var n=MapSignInst.createInfoWnd({userSign:1,title:i.title,content:i.content,index:t,fav:i.fav},{cityCode:i.cityCode,x:a,y:o},e);return n},g=p(),u=function(){MapSignInst.temp.iw.index=t,MapSignInst.temp.iw.marker=n,e.userSign=1,c.openSearchInfoWndPOI(g,n,e),1!=i.save&&(T.browser.opera?setTimeout(function(){MapSignInst.editInfoWnd(e)},120):MapSignInst.editInfoWnd(e))};e&&"new"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/==e.type?setTimeout(function(){g=p(),s.getGEORevertAddress({lng:a,lat:o},function(n){MapSignInst.autoSetMarkerNameByGEOResult(n)}),u()},80):u();var d=r.favCloudData[MapSignInst.checkInFav(t)];d&&(MapSignInst.temp.iw._dataid=d.id||"")}},checkInFav:function(n,t){if(t&&"share"==t.from){for(var e=t.json,i=0;i<r.favCloudData.length;i++){var a=r.converToOriginal(r.favCloudData[i].data);if(a.point==e.point&&a.title==e.title&&a.content==l.deCodeShare(e.content))return i}return-1}if(t&&("poi"==t.from||"nomal"==t.from)){var e=t.json;e.content&&(e.content=e.content.replace(/&nbsp;/g," "));for(var i=0;i<r.favCloudData.length;i++){var a=r.converToOriginal(r.favCloudData[i].data);if(a.point==e.point&&a.title==e.title&&a.content==e.content)return i}return-1}for(var i=0;i<r.favCloudData.length;i++){var a=r.converToOriginal(r.favCloudData[i].data);if(a.point==l.mapSign.pointInfo.list[n].point&&a.title==l.mapSign.pointInfo.list[n].title&&a.content==l.mapSign.pointInfo.list[n].content)return i}return-1},editInfoWnd:function(n){var t=MapSignInst.temp.iw.index,e=MapSignInst.temp.iw.marker;e.enableDragging(),e.setTitle("可移动改变位置");var i,a,o,s,p,r,g,c=l.mapSign.pointInfo.list[t],u=map.getInfoWindow();if(("new"!=n.type||!e.editInfo)&&u){"button"==n.type||"new"==n.type?(i=c.title,a=MapSignInst.deTransformArea(c.content)):(i=MapSignInst.temp.iw.list[t].title||MapSignInst.config.iw.title,a=MapSignInst.temp.iw.list[t].content||MapSignInst.config.iw.content),0==c.save?(o="保存",s="删除",g="添加标记",p="btnSignSave",r="btnSignDelete"):(o="确定",s="取消",g="修改标记",p="btnSignSure",r="btnSignCancel");var d,f=MapSignInst.config.iw.title,m=MapSignInst.config.iw.content,h=function(){d=['<div id="selectPhoto" class="hide"></div>','<div class="userSignIwBox" id="J_userSignIwBox">','<div class="userSignIw">','<div style="z-index:100;height:25px;"><span style="float:left;margin:3px 5px 0 0;">名称</span><input type="text" style="color:#8C8C8C;float:left;width:248px;height:15px;padding:3px 3px;font:12px/1.5 tahoma,arial,宋体;line-height:18px;border:#b5b5b5 solid 1px;" name="title" value="'+i+'" onfocus="MapSignInst.focus(this,\''+f+"','','JuserSignTiptitle')\" onblur=\"MapSignInst.blur(this,'"+f+'\',\'\')" id="us_infoWnd_title" /><div class="userSignTip hide" id="JuserSignTiptitle"></div></div>','<div class="userTagCont"><span style="float:left;margin:3px 5px 0 0;">备注</span><textarea style="border:#b5b5b5 solid 1px;color:#8C8C8C;float:left;font:12px/1.5 tahoma,arial,宋体;height:64px;overflow-y:auto;padding:3px;width:248px" name="content" onfocus="MapSignInst.focus(this,\''+m+"','','JuserSignTipContent')\" onblur=\"MapSignInst.blur(this,'"+m+'\',\'\')" id="us_infoWnd_content" value="'+a+'"></textarea><div class="userSignTip hide" id="JuserSignTipContent"></div></div>','<div style="overflow:hidden;clear:both;height:0;"></div>','<div style="text-align:right;margin:5px -1px 15px 0;*margin:3px -1px 18px 0;"><input type="button" value="'+o+'" id="'+p+'" style="cursor:pointer;margin-right:5px;" onclick="MapSignInst.submitInfoWnd(this,'+t+')" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'" class="iw_bt" /><input type="button" value="'+s+'" id="'+r+'" style="cursor:pointer" onclick="MapSignInst.cancelSubmit()" onmouseover="this.className=\'iw_bt_over\'" onmouseout="this.className=\'iw_bt\'" onmousedown="this.className=\'iw_bt_down\'" onmouseup="this.className=\'iw_bt_over\'" class="iw_bt" /></div>',"</div>",'<div class="sign_photoBox" onclick="MapSignInst.selectPhoto(this)" title="更换标记样式"><img src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ id="sign_photo" class="sp_s sp_'+c.cur+'" /><span>更换</span></div>','<div style="overflow:hidden;height:0;clear:both"></div>',"</div>"].join(""),u&&(e.editInfo=!0,u._iw_title=g,u.setTitle('<p class="iw_poi_title">'+g+"</p>"),T.G("userSignEdit").innerHTML='<div style="width:100%;background:#fff;">'+d+"</div>",T.G("userSignEdit").style.display="block",T.G("userSignContent").style.display="none",T.G("userSignCtrl").style.display="none",T.G("iw_poi_inter").style.display="none",T.G("us_infoWnd_content").value=a,MapSignInst.temp.iw._iw.redraw())};h(),"button"==n.type&&(c.save=2)}},deletePoint:function(){var n=MapSignInst.temp.iw.index,t=MapSignInst.temp.iw.marker;map.removeOverlay(t),MapSignInst.config.iw.toal--,delete l.mapSign.pointInfo.list[n],delete MapSignInst.poiMarker[n],this.hideMapInfo()},iwIputChg:function(n,t){var e=MapSignInst.temp.iw.index,i=l.mapSign.pointInfo.list[e];i[n]=t.value},focus:function(n,t,e,i){e||(e=""),n.style.color="#000",n.value!=t?null:n.value=e;var i=document.getElementById(i);i.innerHTML="",T.ac(i,"hide")},blur:function(n,t,e){n.style.color="#8c8c8c",n.value==e||n.value.length<=0?n.value=t:null},hiddenForm:function(n){MapSignInst.temp.iw.edit=1,T.G("userSignEdit").style.display="none",T.G("userSignCtrl").style.display="",T.G("userSignContent").style.display="",T.G("iw_poi_inter").style.display="",T.G("userSignContent").style.height="auto";var t=T.G("userSignContent").offsetHeight;T.G("userSignContent").style.height=t+"px";var e=MapSignInst.temp.iw;e.marker.closeInfoWindow(),MapSignInst.openInfoWnd(e.marker,e.index,n)},submitInfoWnd:function(n,t){var e=T.trim(T.G("us_infoWnd_title").value),i=T.trim(T.G("us_infoWnd_content").value),a=l.mapSign.pointInfo.list[t],o=function(n){var t=MapSignInst.checkInfoInput(e,30,T.G("JuserSignTiptitle")),o=T.trim(e),s=MapSignInst.filtXss(o);if(!t)return 1;var p=T.trim(i),r=MapSignInst.filtXss(p),l=MapSignInst.checkInfoInput(i,200,T.G("JuserSignTipContent"));if(!l)return 1;MapSignInst.temp.iw._iw.setTitle('<p class="iw_poi_title" title="'+s+'">'+s+"</p>");var g=MapSignInst.transformArea(r);MapSignInst.temp.iw.marker.disableDragging(),MapSignInst.temp.iw.marker.setTitle(s),a.title=s,a.content=g,a.save=1,T.G("userSignContent").innerHTML=g,MapSignInst.hiddenForm(n)};if(1!=a.fav)o();else{var s=MapSignInst.checkInFav(t),p=MapSignInst.temp.iw._dataid;if(o({favId:s}))return;var r=l.mapSign.pointInfo.list[t],g={cityCode:r.cityCode,content:r.content,point:r.point,title:r.title,fav:1,cur:r.cur};this.updateToFav(g,{index:s,id:p})}},cancelSubmit:function(){var n=MapSignInst.temp.iw.index,t=l.mapSign.pointInfo.list[n];0==l.mapSign.pointInfo.list[n].save?(MapSignInst.deletePoint(),MapSignInst.config.iw.toal--):(t.save=1,MapSignInst.hiddenForm())},createIcon:function(){var n=MapSignInst.temp.cur.index,t=MapSignInst.config.cur[n],e=new BMap.Icon("../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/us_mk_icon_dadafd4.png"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/us_mk_icon_dadafd4.png*/,new BMap.Size(t.w,t.h),{offset:new BMap.Size(t.x,t.y),imageOffset:new BMap.Size(-t.l,-t.t),infoWindowOffset:new BMap.Size(t._w-2,1)});return MapSignInst.temp.icon=e,e},showCurLab:function(){var n,t=this;MapSignInst.temp.cur.label||(n=MapSignInst.temp.cur.label=new BMap.Marker(map.getCenter(),new BMap.Icon("../../../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/us_cursor_4c00be8.gif"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/us_cursor_4c00be8.gif*/)),n.setTop(!0,28e7)),n=MapSignInst.temp.cur.label;{var e=MapSignInst.temp.cur.index;MapSignInst.config.cur[e]}n.isVisible()||map.addOverlay(n);var i=MapSignInst.createIcon();n.setIcon(i),n.hide();var a=function(t){t=window.event||t;var e=t.target||t.srcElement;if(e!=BMap.OperationMask.getDom(map))return void n.hide();n.show();var i=BMap.OperationMask.getDrawPoint(t,!0);n.setPoint(i)};T.on(document,"mousemove"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/,a),t.temp.event.showCurLab&&t.temp.event.showCurLab.push?t.temp.event.showCurLab.push({obj:document,type:"mousemove",fun:a}):t.temp.event.showCurLab=[{obj:document,type:"mousemove",fun:a}]},exitCurLab:function(){var n=this;if(n.temp.event.showCurLab&&n.temp.event.showCurLab.length>0){MapSignInst.temp.cur.label.hide();for(var t=0;t<n.temp.event.showCurLab.length;t++){var e=n.temp.event.showCurLab[t];T.un(e.obj,e.type,e.fun)}n.temp.event.showCurLab=[]}},setCurLab:function(n){var t=MapSignInst.temp.iw.index,e=l.mapSign.pointInfo.list[t];if(1==e.fav);else{var i=MapSignInst.checkInFav(t);-1==i||(MapSignInst.favArr[i].cur=n,MapSignInst.updateFav())}e.cur=MapSignInst.temp.cur.index=n;var a=(MapSignInst.config.cur[n],MapSignInst.createIcon());MapSignInst.temp.iw.marker.setIcon(a)},getPhotoHtml:function(n){for(var t=[],e=1;3>=e;e++){for(var i=[],a=1;6>=a;a++){var o=e.toString()+a.toString();i.push(o==n?'<a href="javascript:void(0);" onclick="MapSignInst.goEdit('+o+');return false" class="on"><img src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/  class="sp_s sp_'+o+'" /></a>':'<a href="javascript:void(0);" onclick="MapSignInst.goEdit('+o+');return false"><img src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/  class="sp_s sp_'+o+'" /></a>')}t.push("<li>"+i.join("")+"</li>")}return"<ul>"+t.join("")+'</ul><div class="goEdit"><input type="button" class="iw_bt" onmouseup="this.className=\'iw_bt_over\'" onmousedown="this.className=\'iw_bt_down\'" onmouseout="this.className=\'iw_bt\'" onmouseover="this.className=\'iw_bt_over\'"  onclick="MapSignInst.goEdit()" style="cursor: pointer; margin-right: 33px;" value="返回"></div>'},goEdit:function(n){var t=map.getInfoWindow();t.setTitle('<p class="iw_poi_title">'+t._iw_title+"</p>"),T.ac(T.G("selectPhoto"),"hide"),T.rc(T.G("J_userSignIwBox"),"hide"),n&&(T.G("sign_photo").className="sp_s sp_"+n,MapSignInst.setCurLab(n))},selectPhoto:function(n){T.rc(T.G("selectPhoto"),"hide"),T.ac(T.G("J_userSignIwBox"),"hide");var t=n.getElementsByTagName("img")[0].className.split("sp_s sp_")[1];map.getInfoWindow().setTitle('<p class="iw_poi_title">更换标记样式</p>'),T.G("selectPhoto").innerHTML=MapSignInst.getPhotoHtml(t)},showTipInfo:function(n,t,e,i){var e=e||"favBtn",t=t||"J_favInfo",i=i||"",a="",o=function(){T.rc(T.G(t),"hide"),MapSignInst.favTime=setTimeout(function(){T.ac(T.G(t),"hide")},2e3)};document.getElementById(t)?(document.getElementById(t).innerHTML='<div class="jct"><div class="j"></div></div><div class="jext">'+n+"</div>",document.getElementById(t).className=i,o()):(6==T.browser.ie&&(p.beforeEndHTML(T.G(e),'<div id="'+t+'_width" style="position:absolute;top:-1000px;"><div class="jct"><div class="j"></div></div><div class="jext">'+n+"</div></div>"),a='style="width:'+T.g(t+"_width").clientWidth+'px"'),p.beforeEndHTML(T.G(e),'<div id="'+t+'" class="'+i+'" '+a+'><div class="jct"><div class="j"></div></div><div class="jext">'+n+"</div></div>"),o())},loadFavData:function(){var n=this;setTimeout(function(){n.connectFlash(n.getFavArr)},0)},getFavArr:function(){try{var n=MapSignInst.ls.getValue("sign","list")}catch(t){return}MapSignInst.favArr=void 0==n?[]:n
},goFavFun:function(n){var t,e,i,a=0,o=function(){var n="已从收藏夹中删除",t=i&&T.g("poifav_"+i);if(!a){t&&(T.ac(t,"poi-fav-selected"),t.title="取消收藏");var e=T.G("JiwFav");e&&(T.rc(e,"fav"),T.ac(e,"has_fav"),e.title="取消收藏"),n="成功添加到收藏夹"}MapSignInst.showTipInfo(n)};if(n){var s=n.title,p=n.content;i=n.uid;var r=n.cityCode,g=n.point,c=n.panoGuid||"",u={cityCode:r,content:p,point:g,title:s,fav:1,cur:n.cur,uid:i,panoGuid:c},d=MapSignInst.checkInFav("",{from:"poi",json:u});-1==d?MapSignInst.addFav(u,o,this):(a=1,MapSignInst.deleteFavByIndex(d,o,this))}else{var f=MapSignInst.temp.iw.index;t=MapSignInst.temp.iw.marker,e=l.mapSign.pointInfo.list[f],i=e.uid;var u={cityCode:e.cityCode,content:e.content,point:e.point,title:e.title,fav:1,cur:e.cur,uid:i},d=MapSignInst.checkInFav("",{from:"nomal",json:u});-1==d?(e.fav=1,t.getDom().removeAttribute("title"),t.enableDragging(!1),MapSignInst.addFav(u,o,this)):(a=1,MapSignInst.deleteFavByIndex(d,o,this))}},searchPoiSign:function(n){n.cur=11;var t=MapSignInst.createMark(n,"",{from:"poi"}),e=MapSignInst.temp.iw.index;MapSignInst.openInfoWnd(t,e),t.setTop(!0,27e7)},changeFavPoiFun:function(n){var t=baidu.url.queryToJson(location.href);if(t&&t.mapShareId){MapSignInst.checkInStorage(n,{type:"share"})}else{MapSignInst.checkInStorage(n)}},updateFav:function(){MapSignInst.ls.setValue("sign","list",MapSignInst.favArr)},checkCurText:function(n,t){if(""==n)return 2;var e=T.string.getByteLength(n);if(e>t){if(30==t)return 1;if(200==t)return 4;if(100==t)return 5}return 10},checkInfoInput:function(n,t,e){var i=MapSignInst.checkCurText(n,t),a=MapSignInst.checkTextInfo(i,e);return a?1:0},transformArea:function(n){var t=new RegExp("\n","g"),e=new RegExp(" ","g"),i=n.replace(t,"<br/>").replace(e,"&nbsp;");return i},deTransformArea:function(n){var t=new RegExp("<br/>","g"),e=new RegExp("&nbsp;","g"),i=n.replace(t,"\n").replace(e," ");return i},clearFav:function(){var n=function(){MapSignInst.ls.setValue("sign","list",[]);for(var n=MapSignInst.favArr.length;n--;)MapSignInst.deleteFavByIndex(n)};MapSignInst.connectFlash(n)},hideAllPoi:function(){for(var n=0;n<MapSignInst.favArr.length;n++)MapSignInst.poiHide(n)},poiHide:function(n){var t=function(){var t=MapSignInst.checkInStorage(n);if(-1==t);else{var e=MapSignInst.poiMarker[t];map.removeOverlay(e),delete l.mapSign.pointInfo.list[t],delete MapSignInst.poiMarker[t]}};MapSignInst.connectFlash(t)},addFav:function(n,t,e){var n=r.converToGe(n),i={action:0,data:n,type:0},a=Array.prototype.slice.call(arguments,3);r.upload(i,function(n){i.id=n.content.data[0].id,r.favCloudData.unshift(i),MapSignInst.oFav&&MapSignInst.oFav.goPage(),t&&t.apply(e,a)})},updateToFav:function(n,t){if(n){t=t||{};var e="",i=!1,n=r.converToGe(n);"undefined"!=typeof t.index&&r.favCloudData[t.index]?(e=r.favCloudData[t.index].id,i=!0):t.id&&(e=t.id);var a={id:e,data:n,action:o.SYNC_ACTION_UPDATE,type:o.SYNC_DATA_TYPE_POI};r.upload(a,function(){MapSignInst.showTipInfo("修改成功"),i&&(r.favCloudData[t.index].data=n,MapSignInst.oFav&&MapSignInst.oFav.goPage());var e=T.G("JiwFav");e&&(T.rc(e,"fav"),T.ac(e,"has_fav"),e.title="取消收藏")})}},checkInStorage:function(n,t){var e=l.mapSign.pointInfo.list;if(t&&"poi"==t.type){for(var i in e){{e[i]}if(e[i].point==t.ob.point&&e[i].title==t.ob.title&&e[i].content==t.ob.content)return i}return-1}if(t&&"share"==t.type){for(var i in e){var a=(e[i],r.converToOriginal(r.favCloudData[n].data));if(e[i].point==a.point&&e[i].title==a.title&&e[i].content==a.content)return i}return-1}for(var i in e){var a=(e[i],r.converToOriginal(r.favCloudData[n].data));if(1==e[i].fav&&e[i].point==a.point&&e[i].title==a.title&&e[i].content==a.content)return i}return-1},showSharePoI:function(n){MapSignInst.sharePointArr=n;var t=function(){var n=-1;MapSignInst.isShowPoiLab=1;for(var t in MapSignInst.sharePointArr){var e=MapSignInst.sharePointArr[t];if(1!=e.show){MapSignInst.getFavArr();var i=MapSignInst.checkInFav("",{from:"share",json:e});if(-1==i)var a=MapSignInst.createMark(e,"",{from:"share",isInFav:0});else var a=MapSignInst.createMark(e,"",{from:"share",isInFav:1});a.show()}else n=t}if(MapSignInst.isShowPoiLab=0,-1!=n){var e=MapSignInst.sharePointArr[n];MapSignInst.getFavArr();var i=MapSignInst.checkInFav("",{from:"share",json:e});if(-1==i)var a=MapSignInst.createMark(e,"",{from:"share",isInFav:0});else var a=MapSignInst.createMark(e,"",{from:"share",isInFav:1});MapSignInst.openInfoWnd(a,MapSignInst.temp.iw.index)}};MapSignInst.connectFlash(t)},showSharePolyline:function(n){for(var t in n)MapSignInst.addLine(n[t],{from:"share"})},showShareRemark:function(n){for(var t in n)MapSignInst.createLabel(n[t])},getSignLink:function(n,t,e){var i=function(){var i=new T.Ajax;i.method="POST",i.data=["type="+e,"act=create_share","json="+encodeURIComponent(n),"t="+(new Date).getTime(),"userid="+baidu.cookie.get("BAIDUID")||""].join("&"),i.request("http://webmap1.map.bdstatic.com/userflag/share.php"),i.onsuccess=function(n){var e=baidu.json.parse(n.responseText);t(e)}};MapSignInst.connectFlash(i)},createLabel:function(n,t){var e,i,a=n&&n.point||0,t=t||window.event;a?(i=new BMap.Point(n.point.split("|")[0],n.point.split("|")[1]),e=l.deCodeShare(n.content)):(i=BMap.OperationMask.getDrawPoint(t,!0),e="");var o=MapSignInst.config.lb.index,s=a?"us_edit":"us_submit",p=a?"编辑备注":"完成编辑",r=a?1:0,g=a?"":"none",c=a?"none":"",u=new BMap.Label("",{offset:new BMap.Size(3,-7),point:i,enableMassClear:!1}),d='<div style="width:125px;overflow:hidden;font-size:12px;line-height:16px;" class="usLbContent" id="usLb'+u.hashCode+o+'">';d+='<textarea style="border:0;width:125px;height:72px;font-size:12px;overflow-y:auto;display:'+c+'" id="usLbTe'+u.hashCode+o+'">'+MapSignInst.deTransformArea(e)+"</textarea>",d+='<div style="width:122px;padding:1px 2px;background:#fff;display:'+g+';overflow:visible;word-wrap:break-word;white-space:-moz-pre-wrap;" id="usLbDiv'+u.hashCode+o+'">'+e+"</div>",d+='<div style="position:absolute;width:45px;height:22px;padding-left:2px;overflow:hidden;bottom:-1px;right:-47px;-right:-48px;cursor:default"><div style="width:66px;float:left;height:78px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/us_sign_tex_2bd8c45.png) no-repeat 0 0;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=image/us_sign_tex.png);_background:none;">',d+='<style type="text/css">',d+=".us_remark_but{display:block;position:absolute;top:0;left:2px;z-index:9999;}",d+=".us_remark_but img{width:19px;height:20px;margin:1px;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/us_sign_tex_2bd8c45.png) no-repeat 0 -33px;cursor:pointer;}",d+=".us_remark_but .us_submit{background-position:0 -33px}",d+=".us_remark_but .us_submit_on{background-position:0 -58px}",d+=".us_remark_but .us_delete{background-position:-23px -33px}",d+=".us_remark_but .us_delete_on{background-position:-23px -58px}",d+=".us_remark_but .us_edit{background-position:-46px -33px}",d+=".us_remark_but .us_edit_on{background-position:-46px -58px}",d+="</style>",d+='<b class="us_remark_but">',d+='<img class="'+s+'" title="'+p+'" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ onclick="MapSignInst.subRemark(this,'+o+',event)" onmouseover="this.className=this.className + \'_on\'" onmouseout="this.className=this.className.split(\'_on\')[0]"/>',d+='<img class="us_delete" title="删除" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/ onclick="MapSignInst.delRemark('+o+',event)" onmouseover="this.className=\'us_delete_on\'" onmouseout="this.className=\'us_delete\'" />',d+="</b>",d+="</div></div>",d+='<div class="hide" style="position:absolute;bottom:-26px;left:-1px;width:123px;height:20px;background:none repeat scroll 0 0 #FFFECD;border:1px solid #DFB35C;color:#CC0003;line-height:18px;padding:2px;" id="usLbMess'+u.hashCode+o+'"></div>',d+="</div>",u.addEventListener("domready",function(){this.getDom().removeAttribute("unselectable"),this.getDom().setAttribute("unselectable","off"),this.getDom().innerHTML=d;var n=T.G("usLbTe"+this.hashCode+o),t=T.G("usLbMess"+u.hashCode+o);T.on(n,"focus",function(){T.ac(t,"hide")}),T.on(n,"click",function(n){n.stopPropagation()}),T.on(n,"dblclick",function(n){n.stopPropagation()}),T.on(n,"mousemove",function(n){n.stopPropagation()}),T.on(n,"mousedown",function(n){n.stopPropagation()}),T.on(n,"keydown",function(n){n.stopPropagation()}),T.on(n,"mousewheel",function(n){n.stopPropagation()}),T.on(n,"selectstart",function(n){n.stopPropagation()}),window.addEventListener&&n.addEventListener("DOMMouseScroll",function(n){n&&n.stopPropagation()},!1)}),map.addOverlay(u),u.setStyle({whiteSpace:"normal",border:"1px solid #999",MozUserSelect:""}),l.mapSign.remarkInfo.list[MapSignInst.config.lb.index]={point:i.lng+"|"+i.lat,content:e,type:r},MapSignInst.config.lb.label[MapSignInst.config.lb.index]={label:u},MapSignInst.config.lb.index++,MapSignInst.config.lb.toal++,u.addEventListener("mouseover",function(){this.getDom().style.zIndex="100"}),u.addEventListener("mouseout",function(){this.getDom().style.zIndex="80"})},subRemark:function(n,t,e){var e=window.event||e;p.stopBubble(e),p.preventDefault(e);var i=MapSignInst.config.lb.label[t].label,a=i.hashCode,o=(T.G("usLb"+a+t),T.G("usLbTe"+a+t)),s=o.value,r=T.G("usLbDiv"+a+t),g=T.G("usLbMess"+a+t);if(1!=l.mapSign.remarkInfo.list[t].type){o.blur();var c=s;s=T.trim(s),s=MapSignInst.filtXss(s),s=MapSignInst.transformArea(s);var u=MapSignInst.checkInfoInput(c,100,g);if(!u)return;o.style.display="none",i.getDom().style.MozUserSelect="none",r.innerHTML=s,r.style.display="block",n.className="us_edit",n.title="编辑备注",l.mapSign.remarkInfo.list[t].type=1,l.mapSign.remarkInfo.list[t].content=s}else o.style.display="",i.getDom().style.MozUserSelect="",o.focus(),o.value=o.value,MapSignInst.fixTextareaFocusCursorPosition(o),r.style.display="none",n.className="us_submit",n.title="完成编辑",l.mapSign.remarkInfo.list[t].type=2},fixTextareaFocusCursorPosition:function(n){(T.browser.chrome||T.browser.safari)&&(n.select(),window.getSelection().collapseToEnd())},delRemark:function(n,t){var t=window.event||t;p.stopBubble(t),p.preventDefault(t);var e=MapSignInst.config.lb.label[n].label;map.removeOverlay(e),delete l.mapSign.remarkInfo.list[n],MapSignInst.config.lb.toal--,this.hideMapInfo()},addLine:function(n,t){if(MapSignInst.config.pl.toal>=MapSignInst.config.pl.lagerT)return MapSignInst.showTipInfo("您最多可创建"+MapSignInst.config.pl.lagerT+"个手绘路线","J_TagPInfo","userTagPanl","polyline"),void MapSignInst.exitMask();var e,i=[],a=[],o=1,s={},p=0,r={},g={},c=0,u=this,d=function(n){o?(s=new BMap.Label('<span class="BMap_diso"><span class="BMap_disi">起点</span></span>',{point:n.point,enableMassClear:!1}),s.setStyle({border:0,background:"none"}),map.addOverlay(s),s.setOffset(new BMap.Size(8,-5)),o=0):p+=map.getDistance(MapSignInst.getPoint(i[i.length-1]),n.point);var t=new BMap.Marker(n.point,{icon:MapSignInst.LINEICON,enableMassClear:!1});a.push(t),i.push(n.point.lng+"|"+n.point.lat),map.addOverlay(t)},f=function(){for(var n=0,i=MapSignInst.lineMarker[e];n<i.length;n++)map.removeOverlay(i[n]),delete MapSignInst.lineMarker[e];delete l.mapSign.polylineInfo.list[e],delete MapSignInst.lineArr[e],map.removeOverlay(r),map.removeOverlay(g),map.removeOverlay(s),t&&"share"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/MapSign/==t.from?map.removeOverlay(I):I.clear(),MapSignInst.config.pl.toal--,MapSignInst.hideMapInfo()},m=function(){if(i.length){e=MapSignInst.lineId,l.mapSign.polylineInfo.list[MapSignInst.lineId]=i,MapSignInst.config.pl.toal++,MapSignInst.lineMarker[MapSignInst.lineId]=a;var n=parseFloat(i[i.length-1].split("|")[0])-parseFloat(i[i.length-2].split("|")[0]),t=parseFloat(i[i.length-1].split("|")[1])-parseFloat(i[i.length-2].split("|")[1]),o=MapSignInst.getPoint(i[i.length-1]);if(r=new BMap.Marker(o,{icon:MapSignInst.LINECLOSEICON,enableMassClear:!1}),map.addOverlay(r),r.setOffset(n>=0?new BMap.Size(14,0):new BMap.Size(-14,0)),p>=1e3)var s=parseInt(parseFloat(p/1e3*10))/10,c="公里";else var s=parseInt(p),c="米";g=new BMap.Label('<span style="color:#FF6319;font-weight:bold">'+s+"</span>"+c,{point:o,enableMassClear:!1}),g.setStyle({padding:"2px"}),g.setOffset(t>=0?new BMap.Size(-5,-35):new BMap.Size(-5,11)),map.addOverlay(g),r.addEventListener("click",function(){f()}),MapSignInst.lineArr[e]=r}};if(t&&"share"==t.from){for(var h=0;h<n.length;h++){var v={};v.point=MapSignInst.getPoint(n[h]),d(v)}m();for(var w=[],h=0;h<i.length;h++)w.push(MapSignInst.getPoint(i[h]));var I=new BMap.Polyline(w,{strokeColor:"#FD8045",strokeWeight:3,strokeOpacity:1,enableMassClear:!1});map.addOverlay(I),MapSignInst.lineId++,MapSignInst.config.pl.toal++}else{var I=new BMap.PolylineTItem(map,{showResult:!1,enableMassClear:!1,cursor:"url(http://webmap1.map.bdstatic.com/newmap/static/common/images/circle.cur),default"});u.temp.plObj=I;var M=function(n){if(T.un(document,"keydown",M),MapSignInst.resetTab(),n=window.event||n,27==n.keyCode){for(var t=0,e=a;t<e.length;t++)map.removeOverlay(e[t]);map.removeOverlay(s),c=1}},S=function(){return 1==a.length?(map.removeOverlay(a[0]),map.removeOverlay(s),MapSignInst.resetTab(),l.userTagPanl.setZindex(2e4),void MapSignInst.lineId++):(m(),setTimeout(function(){"Point"!=MapSignInst._temp.signType&&"Remark"!=MapSignInst._temp.signType&&MapSignInst.resetTab()},1),l.userTagPanl.setZindex(2e4),void MapSignInst.lineId++)};I.addEventListener("drawend",function(){T.un(document,"keydown",M),c||S()}),I.open(),I.setLineColor("#FD8045"),I.setLineStroke(3),T.on(document,"keydown",M),I.addEventListener("addpoint",function(n){d(n)})}},getPoint:function(n){return new BMap.Point(n.split("|")[0],n.split("|")[1])},parseAllShare:function(n){MapSignInst.showSharePoI(n.pointInfo.list),MapSignInst.showSharePolyline(n.polylineInfo.list),MapSignInst.showShareRemark(n.remarkInfo.list)},hideMapInfo:function(){},btnOver:function(n){n.className="favBtnOver"},btnOut:function(n){n.className=""},btnDown:function(n){n.className="favBtnDown"},btnUp:function(n){n.className="favBtnOver"},smallBtnOver:function(n){n.className="smallFavBtnOver"},smallBtnOut:function(n){n.className=""},smallBtnDown:function(n){n.className="smallFavBtnDown"},smallBtnUp:function(n){n.className="smallFavBtnOver"},getFavDataById:function(n){for(var t,e=r.favCloudData,i=0,a=e.length;a>i;i++)if(t=e[i],t.id==n)return t;return null},getOriginalFavDataById:function(n){return r.converToOriginal(this.getFavDataById(n).data)},delFavDataById:function(n){for(var t,e=r.favCloudData,i=0,a=e.length;a>i;i++)if(t=e[i],t.id==n)return e.splice(i,1),t.action=2,t;return null},checkInFavById:function(n){for(var t,e=r.favCloudData,i=0,a=e.length;a>i;i++)if(t=e[i],t.id==n)return!0;return!1}}),i.exports=a});