define("common:widget/com/NavTrans/NavTrans.js",function(require,exports,module){function NavTrans(){if(window.NavTransInst=this,MapComponent.apply(this,arguments),this.cinfo&&1==this.cinfo.isPos&&(0==this.cinfo.destFlag?(window.conType=0,window.conPoint=this.cinfo.point):(window.conType=1,window.conPoint=this.cinfo.point),this.setContext(window.conPoint)),this.json){var t=this.json.result;this.result=t,this.total=t.total,this.start=t.start,this.end=t.end,this.end=this.end[this.end.length-1],this.waypoints=t.waypoints,this.sCity=t.start_city,this.eCity=t.end_city,this.eCity=this.eCity[this.eCity.length-1],this.strategy=t.sy,this.drag=t.drag||0,this.currentCity=modelConfig.cityCode,this.s_query=t.s_query?t.s_query:this.start.wd,this.e_query=t.e_query?t.e_query:this.end.wd,window.cxtBusPoints||(window.cxtBusPoints=[]),this.total&&(this.start.pt=mapUtil.parse2Geo(this.json.content.kps[0].pt).points,this.end.pt=mapUtil.parse2Geo(this.json.content.kps[this.json.content.kps.length-1].pt).points);var e=this.start.pt.split(",");this.sp=new BMap.Point(e[0],e[1]),window.cxtBusPoints[0]={p:this.sp,n:this.start.wd,t:0},e=this.end.pt.split(","),this.ep=new BMap.Point(e[0],e[1]),window.cxtBusPoints[1]={p:this.ep,n:this.end.wd,t:1},this.taxi=this.json.content.taxi,this.mainRouteIndex=[],this.mainRouteStart=[0],this.mainRoute=[],this.tpList=[],this.wpList=[],this.noName="未知路段",this.rettype=["","从起点出发","到达目的地","途经点","行驶","到达目的地(在左侧)","到达目的地(在右侧)"],this.total&&(this.routeIndex=this.generateRouteIndex(),this.navListData=this.generateNavListData(),this.navListView=new NavListView(this.navListData)),mapInfoScrollPanel&&mapInfoScrollPanel.hide()}}function startGo(t,e,n){var i=window.startPoi.point,a=window.endPoi.point,s=TPM.getQueryParam(function(){}),o=TPM.getCityCode(),r=a.lng+","+a.lat;window.cxtBusPoints[1].route&&(r=window.cxtBusPoints[1].route);var d="nav&c="+modelConfig.cityCode+"&drag=1&sc="+t+"&st=1&ec="+o+e+"&et=1&sy="+n+"&sn=1$$$$"+i.lng+","+i.lat+"$$"+encodeURIComponent(window.cxtBusPoints[0].n)+"$$$$$$&en="+s+"1$$$$"+a.lng+","+a.lat+"$$"+encodeURIComponent(window.cxtBusPoints[1].n)+"$$$$$$";componentManager.go(d)}function endGo(t,e,n){var i=window.startPoi.point,a=window.endPoi.point,s=TPM.getQueryParam(function(){}),o=TPM.getCityCode(),r=i.lng+","+i.lat;window.cxtBusPoints[0].route&&(r=window.cxtBusPoints[0].route);var d="nav&c="+modelConfig.cityCode+"&drag=1&sc="+t+"&st=1&ec="+o+e+"&et=1&sy="+n+"&sn=1$$$$"+i.lng+","+i.lat+"$$"+encodeURIComponent(window.cxtBusPoints[0].n)+"$$$$$$&en="+s+"1$$$$"+a.lng+","+a.lat+"$$"+encodeURIComponent(window.cxtBusPoints[1].n)+"$$$$$$";componentManager.go(d)}var componentManager=require("common:widget/com/componentManager.js"),config=require("common:widget/ui/config/config.js"),constants=require("common:widget/ui/constant/Constant.js"),MapComponent=require("common:widget/com/MapComponent.js"),util=require("common:widget/ui/util/util.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),transUtil=require("common:widget/ui/transUtil/transUtil.js"),taxi=require("common:widget/ui/taxiMgr/TaxiMgr.js"),SchemeFaver=require("common:widget/ui/SchemeFaver/SchemeFaver.js"),sms=require("common:widget/ui/sms/sms.js"),setComplaintCenterURL=require("common:widget/ui/SetComplaintCenter/SetComplaintCenter.js"),transInfo=require("common:widget/ui/transInfoWindow/transInfoWindow.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),mapInfoScrollPanel=require("common:widget/ui/mapInfoScroll/mapInfoScroll.js"),Share=require("common:widget/ui/mapShare/MapShare.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),searchData=require("common:widget/ui/searchData/searchData.js"),iKnow=require("common:widget/ui/iKnow/iKnow.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,NavListView=require("common:widget/view/NavList/NavList.js"),NavMap=require("common:widget/com/NavTrans/NavMap.js");T.lang.inherits(NavTrans,MapComponent,"NavTrans"),T.object.extend(NavTrans.prototype,{render:function(){try{if(!this.json)return;var style="#route_contentWrapper{padding:0 5px 0 10px}.drivingRouteFeedback{width:315px;margin:10px 0 0 10px}";if(require.loadCss({content:style,name:"NavTrans"}),addStat("navscheme.navscheme.render"),this.total){addStat("navscheme.navscheme.hasresultrender","click"),this.result.end.length>1&&addStat("navscheme.navscheme.withtp","click");var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="nav_container"><div id="navAdContainer">',"undefined"==typeof data.new_cms_ad?"":data.new_cms_ad,'</div>     <div id="route_top" class="route_top">        <div class="drivingRouteFeedback">            <div class="feedBackImg">                                <a href="http://tiyan.baidu.com/index.php?r=imap/index" title="驾车路线反馈" target="_blank">                    <img height="50" width="315" src="',"../../../images/feedback.bak_80444ac.png"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/feedback.bak_80444ac.png*/,'" alt="驾车路线反馈，反馈有好礼" />                </a>            </div>        </div>        <div style="padding:10px 0 0 9px;text-indent:4px;"><a id="route_survey" class="textLineA" target="_blank" href="">推荐的路线满意吗？给个评价吧！</a></div>                '),data.cbtLink&&_template_fun_array.push('            <div style="padding:10px 0 0 9px">                <div class="cbtLink">                    <img class="cbtLinkLogo" src="',"/newmap/static/common/images/transparent.gif",'" >&nbsp;<span>从',"undefined"==typeof data.startName?"":baidu.template._encodeHTML(data.startName),"到","undefined"==typeof data.endName?"":baidu.template._encodeHTML(data.endName),'的跨城公交 </span><a href="javascript:void(0)" id="showCBusRoute" tid="showCBusRoute">查看线路</a>                </div>            </div>        '),_template_fun_array.push("        "),data.taxi&&_template_fun_array.push('        <div id="newBsTaxi" class="MapInfo_taxiCost">            <span class="textLineA">打车费用: ',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/==typeof data.taxi?"":baidu.template._encodeHTML(data.taxi),'元</span> <span style="color:#999999" id="totalPriceResult">(按驾车的最短路程计算)</span>        </div>        '),_template_fun_array.push('        <div id="route_type" class="drive strategySel">             <div class="strategySel_r" id="navStrategy">                <span class="leftBorLine"></span>                <div class="noSel" id="type0">推荐路线</div>                <div class="noSel" id="type1"><span class="lineBg">最短路程</span></div>                <div class="noSel" id="type2"><span class="lineBg">不走高速</span></div>                <span class="rightBorLine"></span>            </div>        </div>    </div>    <div class="route_contentWrapper">    </div>    <div id="drive_bottom" class="route_bottom black navtran">        <p class="lp">            <a id="reChoice" tid="reChoice" href="javascript:void(0)">',"undefined"==typeof data.reChoice?"":data.reChoice,'</a>        </p>        <p class="rp">            查看：<a id="routeReturn" href="javascript:void(0)" tid="routeReturn">返程</a>&nbsp;|&nbsp;            '),data.busInfo?_template_fun_array.push('            <a href="javascript:void(0)" id="routeBus" data-stat="',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/==typeof data.busInfo.stat?"":baidu.template._encodeHTML(data.busInfo.stat),'">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/==typeof data.busInfo.text?"":baidu.template._encodeHTML(data.busInfo.text),"</a>            "):_template_fun_array.push("            暂无公交            "),_template_fun_array.push("            &nbsp;            "),data.walkInfo&&_template_fun_array.push('            |&nbsp;<a href="javascript:void(0)" id="routeWalk">步行</a>            '),_template_fun_array.push("        </p>    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],taxi="";this.sCity.code==this.eCity.code&&util.isActiveCity("taxi",this.sCity.code)&&this.taxi&&(taxi=this.taxi.detail[0].totalPrice,addStat("navscheme.navscheme.texifee"));var cmsAdStr=this._setNewCms();this.navListView.setNavCmsAdStrFlag(cmsAdStr?1:0);var cbtLink=!1,busInfo;this.sCity.code!=this.eCity.code?(cbtLink=!0,busInfo={stat:"crosscitybusscheme.crosscitybl.tipsforcrossbl",text:"跨城市公交"}):busInfo=0==modelConfig.supBus&&2==modelConfig.cityType?void 0:{stat:"navscheme.navscheme.showbl",text:"公交"};var reChoice=1==this.routeIndex.length?"重选起终点":"重选起终点和途经点",dis=parseFloat(BMap.Project.getDistanceByMC(this.sp,this.ep)),walkInfo=!1;1500>dis&&(walkInfo=!0),this.$el=T(template({data:{new_cms_ad:cmsAdStr,cbtLink:cbtLink,startName:this.start.wd,endName:this.end.wd,taxi:taxi,reChoice:reChoice,busInfo:busInfo,walkInfo:walkInfo}})),this.$el.find(".route_contentWrapper").append(this.navListView.render())}else{addStat("navscheme.navscheme.noresultrender","click");var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="nav_container">    <div class="mapinfo_con">        <p style="text-indent:5px;line-height:25px;background:#FFF5CA">未能计算出从“<span class="nr_kw">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/==typeof data.start.wd?"":baidu.template._encodeHTML(data.start.wd),"</span>”","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/==typeof data.tp1?"":baidu.template._encodeHTML(data.tp1),'到“<span class="nr_kw">',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/==typeof data.end.wd?"":baidu.template._encodeHTML(data.end.wd),"</span>”的驾车路线，抱歉。</p>        ","undefined"==typeof ss?"":ss,'        <div class="nr_suggest">您还可以：            <ul>                <li>看看地图当前城市是否有误，尝试更换城市</li>                <li>您可在地图上移动起点、终点，再次尝试</li>", "<li>您可更换关键词再次尝试。</li>            </ul>        </div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];this.$el=T(template({data:this.getNoResultTemplateData()})),this.result.end.length>1&&addStat("navscheme.navscheme.withtp","click")}return this.$el}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/NavTrans/NavTrans.js",ln:214})}},initialize:function(){try{var t=window;this.busQueryString=this.buildBusQueryString(),t.searchInViewCtrl&&t.searchInViewCtrl.exit(),t.weipaiTool&&t.weipaiTool.resetStatus(),BoxContainer&&BoxContainer.resetStatus(),this.json.content&&PanoUtil.isPanoStatus()&&PanoUtil.closePano("search"),searchBox.setSwitchTab(3),searchBox.driveSSG1?searchBox.driveSSG1.setValue(this.start.wd):searchBox.setValue("DriveSearchSta",this.start.wd),searchBox.driveSSG2?searchBox.driveSSG2.setValue(this.end.wd):searchBox.setValue("DriveSearchEnd",this.end.wd);var e=this.generateNavMapData();if(this.navMap=new NavMap(e),this.navMap.drawLines(),!this.total)return;this.navMap.addPopInfoWin(),this.modelQuery=this.navMap.buildQuery().url,this.isMainRequest===!1&&(t.currentComponent.modelQuery=this.modelQuery),this.navListView.initialize(),1==this.navListData.routes.length&&this.showSendTipOnResultPage(),this.processState(),this._panoNavParams=this._generatePanoNavPrams(),this.changStrategy(this.strategy),this._binder(),map.mapType==BMAP_TYPE_DIMENSIONAL&&this.navMap.navTranFor3D(!1),this.cinfo&&"nav"==this.cinfo.sms&&(sms.ready("","nav"),Share.setSmSCode("nav")),SchemeFaver.isRepeat.call(this,{pathtype:0,dom:T.G("driveFavBtn")}),setComplaintCenterURL(map,this),this.setSurveyLink(),mapInfoScrollPanel?mapInfoScrollPanel.hide():T.g("MapInfo").style.overflowY="hidden"}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/NavTrans/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/com/NavTrans/NavTrans.js",ln:322})}},getNoResultTemplateData:function(){var t=this.result,e={ss:"",tp1:"",start:this.start,end:this.end},n="";if("未知路段"==this.start.wd||"未知路段"==this.end.wd);else{for(var i=0;i<t.end.length-1;i++)i==t.end.length-2?(n+=t.end[i].wd,e.tp1+="“<span class='nr_kw'>"+t.end[i].wd+"</span>”"):(n+=t.end[i].wd+"、",e.tp1+="“<span class='nr_kw'>"+t.end[i].wd+"</span>”、");n&&(n="经"+n,e.tp1="经"+e.tp1),e.ss=iKnow.getIknowCode("想知道:"+modelConfig.cityName+"从"+this.start.wd+n+"到"+this.end.wd+"开车怎么走？")}return e},buildBusQueryString:function(){var t=this,e=1==t.start.bus_stop?0:1,n=1==t.end.bus_stop?0:1,i=t.start.uid||"",a=t.end.uid||"",s=indexUtil.getBusExpTime(),o=window.BusTransInst?BusTransInst.exptype:"dep",r=window.BusTransInst?BusTransInst.version:5,d="bt&bttp=1&c="+t.currentCity+"&sc="+t.sCity.code+"&ec="+t.eCity.code+"&sn="+e+"$$"+i+"$$"+t.start.pt+"$$"+encodeURIComponent(t.start.wd)+"$$$$$$&en="+n+"$$"+a+"$$"+t.end.pt+"$$"+encodeURIComponent(t.end.wd)+"$$$$$$&sq="+encodeURIComponent(t.s_query)+"&eq="+encodeURIComponent(t.e_query)+"&exptype="+o+"&exptime="+s+"&version="+r;return d},processState:function(){var t=this;if(void 0!=t.cinfo._index){var e=t.cinfo._index.split("-");if(t.cinfo._index.indexOf("showAll")>-1)t.navListView.showAllDes();else if(e[1]){for(var n=e[1].split(","),i=0;i<n.length;i++)isNaN(n[i])||t.navListView.expandItem(parseInt(n[i]));Share.listIndex="0-"+n}t.cinfo._index=null}if(void 0!=t.cinfo._popIndex){var a=parseInt(t.cinfo._popIndex);if(a>0&&a<t.navMap.popPoints.length){var s=t.navMap.popPoints[a].p,o=t.navMap.popPoints[a].a,r=t.navMap.popWins[a];if(0!=a&&a!=t.navMap.popPoints.length-1){var d=mapUtil.addDrvDirIcon(s,o);d.addEventListener("click",t.getClickMarker(r,d,a)),transInfo.transInfoWindow(d,r,{showLine:!0}),t.navMap.popPois.push(d)}else 0==a?t.navMap.clickStop(a):a==t.navMap.popPoints.length-1&&t.navMap.clickStop(this.tpList.length+1)}}},_binder:function(){var t=this;this.navListView.addEventListener("kmclick",function(){t.navMap.resetDrv()}),this.navListView.addEventListener("delviaclick",function(e,n){addStat("navscheme.navscheme.removetp","click"),t.navMap.delVia(n)}),this.navListView.addEventListener("h3click",function(e,n){t.navMap.clickStop(n)}),this.navListView.addEventListener("mainlistclick",function(e,n){t.navMap.mainRoudeClick(n.itemIndex,n.groupIndex)}),this.navListView.addEventListener("mainlistmouseover",function(e,n){t.navMap.mainRoudeOn(n.itemIndex,n.groupIndex)}),this.navListView.addEventListener("mainlistmouseout",function(e,n){t.navMap.mainRoudeOut(n.itemIndex,n.groupIndex)}),this.navListView.addEventListener("sublistclick",function(e,n){t.navMap.highRoute(n.itemIndex)}),this.navListView.addEventListener("sublistmouseover",function(e,n){t.navMap.addTips(n.itemIndex)}),this.navListView.addEventListener("sublistmouseout",function(e,n){t.navMap.removeTips(n.itemIndex)}),this.navListView.addEventListener("panodataready",function(e,n){var i=t.getPopWndAndLineRelation();t.navMap.updatePanoPopWins(n,i)}),this.navMap.addEventListener("poiinfoopen",function(e,n){t.navListView.hightLightItem(n.index)}),this.$el.find("#newBsTaxi").click(function(){t.getTaxi(this)}),this.$el.find("#routeReturn").click(function(){t.returnDr()}),this.$el.find("#reChoice").click(function(){t.backAddr()}),this.$el.find("#showCBusRoute").click(function(){addStat("navscheme.navscheme.cbuschange","click"),t.busChange()}),this.$el.find("#routeBus").click(function(){addStat(this.getAttribute("data-stat")),t.busChange()}),this.$el.find("#routeWalk").click(function(){t.navWalk()}),this.$el.find("#driveSmSBtnID").click(function(e){t.sendSMS(this,e)}),this.$el.find("#driveFavBtn").click(function(e){t.addToFav(this,e)}),this.$el.find("#drivePrintBtnID").click(function(){t.print(this)}),baidu.on("navAdClose","click",function(){baidu.g("navAdContainer").innerHTML="",T.cookie.set("navCmsAd","2",{expires:6048e5})})},changStrategy:function(t){var e=this;if(T.g("navStrategy")){var n=T.g("navStrategy");if(n)for(var i=n.getElementsByTagName("div"),a=0;a<i.length;a++){var s=i[a];if(t==s.id.charAt(4)){s.className="sel";var o=T.g("totalPriceResult");o&&(0==t?o.innerHTML="(按驾车的最少时间计算)":1==t?o.innerHTML="(按驾车的最短路程计算)":2==t&&(o.innerHTML="(按照不走高速的方案计算)")),s.checked=1}s.style.cursor="pointer",s.onclick=function(){T.g("type"+e.strategy)?T.g("type"+e.strategy).className="noSel":null,e.strategy=this.id.charAt(4),this.className="sel",this.checked=1,navigator.cookieEnabled&&T.cookie.set("Map_navTranType",e.strategy,{expires:new Date((new Date).getTime()+31536e6)});var t=e.navMap.buildQueryOnlyByTp(null,4);addStat("navscheme.navscheme.clickstrategy"+e.strategy),componentManager.go("nav&c="+e.currentCity+"&drag=0&sc="+e.sCity.code+"&ec="+t.tc+e.eCity.code+"&sy="+e.strategy+"&sn=1$$$$"+e.start.pt+"$$"+encodeURIComponent(e.start.wd)+"$$$$$$&en="+t.tp+"1$$$$"+e.end.pt+"$$"+encodeURIComponent(e.end.wd)+"$$$$$$&sq="+encodeURIComponent(e.s_query)+"&eq="+encodeURIComponent(e.e_query)+"&reqtp=1",{isMainRequest:"no"})},s.onmouseover=function(){for(var t=this,n=t.getElementsByTagName("span"),i=T.g("navStrategy").getElementsByTagName("span"),a=0,s=t.id.charAt(4),o=0;o<i.length;o++)i[o]==n[0]&&(a=o);s==e.strategy?(T.ac(T.g("route_type"),"bus_strategySel_on"),0==s?i[0].className="leftBorLine leftBorLine_active_on":2==s&&(i[i.length-1].className="rightBorLine rightBorLine_active_on")):(t.className="noSel noSel_on",0==s?i[0].className="leftBorLine leftBorLine_on":2==s&&(i[i.length-1].className="rightBorLine rightBorLine_on")),n[0]&&(n[0].className="lineBg lineBg_on"),a+2<i.length&&i[a+1]&&(i[a+1].className="lineBg lineBg_on")},s.onmouseout=function(){for(var t=this,n=t.getElementsByTagName("span"),i=T.g("navStrategy").getElementsByTagName("span"),a=0,s=t.id.charAt(4),o=0;o<i.length;o++)i[o]==n[0]&&(a=o);s==e.strategy?(T.rc(T.g("route_type"),"bus_strategySel_on"),0==s?i[0].className="leftBorLine":2==s&&(i[i.length-1].className="rightBorLine")):(t.className="noSel",0==s?i[0].className="leftBorLine":2==s&&(i[i.length-1].className="rightBorLine")),n[0]&&(n[0].className="lineBg"),a+2<i.length&&i[a+1]&&(i[a+1].className="lineBg")}}}},unload:function(){TPM.state="",TPM.clearTpListInMap(),TPM.afterAddByPoint=void 0,window.cxtBusPoints=null,window.startPoi=null,window.endPoi=null,window.dropRoutes=[];var t=T.G("defCityTip");t&&(t.style.display="none"),this.navListView&&this.navListView.unload(),this.navMap&&this.navMap.unload(),MapComponent.prototype.unload.apply(this,arguments)},getTaxi:function(t){taxi.openTaxi(t,{data:this.taxi,from:"nav"})},isCrossCity:function(){return this.sCity&&this.eCity?this.sCity.code!=this.eCity.code:!1},addFeedback:function(){},setSurveyLink:function(){var t=T.g("route_survey"),e=new Date,n=[e.getFullYear(),e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,e.getDate()<10?"0"+e.getDate():e.getDate(),e.getHours()<10?"0"+e.getHours():e.getHours(),e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds()].join("-"),i="http://tiyan.baidu.com/index.php?r=survey%2Fjump&version=old&citycode="+[this.sCity.code,this.eCity.code].join(",")+"&start="+encodeURIComponent(this.start.wd)+"&end="+encodeURIComponent(this.end.wd)+"&searchtime="+n;t.href=i},_setNewCms:function(){var t="";if(window._OLR&&_OLR.index){var e=baidu.json.parse(_OLR.index)||{},n=e.special&&e.special.data&&e.special.data.top.nav?e.special.data.top.nav:"";if("2"!==T.cookie.get("navCmsAd")){var i=n?n.length:0;if(n&&i>0){var a=new Date,s=a.getHours()%i;t=n[s].icon?'<div class="newCmsAd" style="background-image:url('+n[s].icon+') !important;">':'<div class="newCmsAd">',t=n[s].link2?t+n[s].title+'<a href="'+n[s].link1+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.navlink', 'click', {da_trd:'"+n[s].title+"'});\">"+n[s].link_text1+'</a>&nbsp;&nbsp;<span>|</span>&nbsp;&nbsp;<a href="'+n[s].link2+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.navlink', 'click', {da_trd:'"+n[s].title+"'});\">"+n[s].link_text2+'</a><a id="navAdClose" class="closeBtn" href="#"></a></div>':t+n[s].title+'<a href="'+n[s].link1+"\" target=\"_blank\" onclick=\"addStat('indexleftmenu.links.navlink', 'click', {da_trd:'"+n[s].title+"'});\">"+n[s].link_text1+'</a><a id="navAdClose" class="closeBtn" href="#"></a></div>'}else t=""}}return""!=t&&addStat("indexleftmenu.links.navlink","show"),t},getPopWndAndLineRelation:function(){for(var t=[],e=this.json.content.kps,n=e.length,i=[],a=0,s=0,o=0;o<this.tpList.length;o++)t.push(this.tpList[o].index);for(i.push(s),i.push(s),s+=1;n-2>a;)0==a?(this.mainRoute.length>0&&(s+=1),i.push(s),s+=1,a+=2):-1!==T.array.indexOf(this.mainRoute,a)?(s+=1,i.push(s),s+=1,a+=1):-1!==T.array.indexOf(t,a)?(s+=1,a+=1):(i.push(s),s+=1,a+=1);return i.push(s),i.push(s),i},generateRouteIndex:function(){for(var t=this.json.content.kps,e=this.json.content.rss,n=0,i=[{start:0,mn:[]}],a=0;a<e.length;a++){var s=e[a],o=t[a];if(s.mn&&1==s.mn.m&&s.n&&s.mn.mg&&(i[i.length-1].mn.push(a),this.mainRouteStart.push(a),this.mainRoute.push(a)),3==o.rt){var r=this.waypoints?this.waypoints[n].if_wp:!1;r?(i[i.length-1].end=a,i.push({start:a,mn:[]}),this.tpList.push({name:this.waypoints[n].wd||e[a+1].n||this.noName,index:a,tpIndex:n,direction:t[a].a,points:mapUtil.parse2Geo(t[a].pt).points}),-1==T.array.indexOf(this.mainRouteStart,a)&&this.mainRouteStart.push(a)):this.wpList.push({name:e[a+1].n||this.noName,index:a,tpIndex:n}),n++}else a===e.length-1&&(i[i.length-1].end=a)}return i},generateNavListData:function(){for(var t=this.json.content.kps,e=this.json.content.rss,n={type:"nav",start:{name:this.json.result.start.wd,uid:this.start.uid,points:mapUtil.parse2Geo(t[0].pt).points,poiType:"FF0201",direction:t[0].a},end:{name:this.json.result.end[this.json.result.end.length-1].wd,uid:this.end.uid,points:mapUtil.parse2Geo(t[t.length-1].pt).points,poiType:"FF0202",direction:t[t.length-1].a},routes:[],tpList:this.tpList,wpList:this.wpList,showScrollPanel:!0},i=0,a=0;a<this.routeIndex.length;a++){var s=this.routeIndex[a],o=[];o.hasSubList=!1;for(var r=s.start;r<=s.end;r++){var d=t[r].rt,p=parseInt(e[r].d);e[r].poi&&(p-=e[r].poi.pd);var c=this.roundDis(p);if(0==s.mn.length)0===o.length&&o.push({subList:[]});else if(r===s.start){var h="";h=s.start===s.mn[0]?"从"+e[r].n+"出发":-1!==T.array.indexOf(s.mn,r+1)?".从"+e[s.mn[0]].n+"出发":"从"+(0==r?"起点":"途经点")+"到"+e[s.mn[0]].n,-1===T.array.indexOf(s.mn,r+1)&&(o.push({title:h,points:mapUtil.parse2Geo(t[r].pt).points,direction:t[r].a,subList:[]}),this.mainRouteIndex.push(i))}else T.array.indexOf(s.mn,r)>-1&&(o.push(T.array.indexOf(s.mn,r)===s.mn.length-1?{title:e[r].n+"到"+(a===this.routeIndex.length-1?"终点":"途经点"),points:mapUtil.parse2Geo(t[r].pt).points,direction:t[r].a,subList:[]}:{title:e[r].n,points:mapUtil.parse2Geo(t[r].pt).points,direction:t[r].a,subList:[]}),this.mainRouteIndex.push(i));if(r==s.start)o.length&&(o[o.length-1].subList.push({desc:"从<span>"+(0==a?"起点":"途经点")+"</span>向"+this.getTurType(t[r].ett)+"出发，",points:mapUtil.parse2Geo(t[r+1].pt).points,direction:t[r+1].a}),o.hasSubList=!0,i++);else if(r==s.start+1){var l=this.getSubListDesc(r,c,"mid");T.array.indexOf(s.mn,r)>-1?(o[o.length-1].subList.push({desc:"从<span>"+(0==a?"起点":"途经点")+"</span>向"+e[r].n+"出发，"+l,points:mapUtil.parse2Geo(t[r].pt).points,direction:t[r].a}),o.hasSubList=!0,i++):o[o.length-1].subList[0].desc+=l}else if(r==s.end-1){var l=this.getSubListDesc(r,c,"end");o[o.length-1].subList.push({desc:l,points:mapUtil.parse2Geo(t[r].pt).points,direction:t[r].a}),o.hasSubList=!0,i++}else if(r==s.end){var d=this.leftOrRight(e,t,r),u=this.getTr(r-1);if(a===this.routeIndex.length-1)var m=2==d?"到达<span>终点</span>":5==d?"到达<span>终点</span>(在道路<span>左侧</span>)":6==d?"到达<span>终点</span>(在道路<span>右侧</span>)":"";else var m=2==d?"到达<span>途经点</span>":5==d?"到达<span>途经点</span>(在道路<span>左侧</span>)":6==d?"到达<span>途经点</span>(在道路<span>右侧</span>)":"";o[o.length-1].subList[o[o.length-1].subList.length-1].desc+=m+u}else if(3!==d){var l=this.getSubListDesc(r,c,"mid");o[o.length-1].subList.push({desc:l,points:mapUtil.parse2Geo(t[r].pt).points,direction:t[r].a}),o.hasSubList=!0,i++}}n.routes.push(o)}return n.extInfo=this.getExtInfo(),n.distanceValue=this.json.content.dis,n.cmsAds=this.getCmsAds(),n.navAds=!0,n},getSubListDesc:function(t,e,n){var i=["","朝"],a=this.json.content.rss,s=this.json.content.kps,o=this.getRoadName(a[t-1].t,a[t-1].n),r=this.getRoadName(a[t].t,a[t].n),d=this.getRoadName(a[t+1].t,a[t+1].n),p=(""!=r&&o==r?"继续":"")+this.getRoadAct(a[t].t,a[t].n),c="mid"==n?this.getTicInfo(s,t):this.getTicInfo(s,t+1),h=a[t].poi,l=this.getPoiInfo(a,h,t),u=p+"<span>"+r+"</span>"+this.rettype[s[t].rt]+e+"，"+l+c;if("mid"==n){var m=this.getTr(t),g=i[s[t].dw]||"",v=s[t].dr?g+"<span>"+s[t].dr+"</span>，":"",f=this.getRetType(a[t+1].t,0,a[t+1].n),w=r==d?"":f+"<span>"+d+"</span>";u+=v+"<span>"+this.getTurType(s[t].ett)+"</span>"+w+m}return u},getTr:function(t){var e=this.json.content.rss;return 1==e[t].tr?"<br><font color='#CA0000'>全路段收费</font>":2==e[t].tr?"<br><font color='#CA0000'>部分路段收费</font>":""},generateNavMapData:function(){for(var t=[],e=[],n=[],i=[],a=[],s=[],o=[],r=[],d=[],p=[],c=this.json.content.kps,h=this.json.content.rss,l=-1,u=0,m=0;m<this.routeIndex.length;m++)for(var g=this.routeIndex[m],v=g.start;v<=g.end;v++){-1!==T.array.indexOf(this.mainRouteStart,v)&&(v!==l&&v-1!==g.start&&(i.push([]),a.push([])),l=v),-1!==T.array.indexOf(this.mainRoute,v)&&u++;var f=c[v].rt,w=parseInt(h[v].d);if(v==g.start){if(t.push({p:mapUtil.parse2Geo(c[v].pt).points,n:this.start.wd}),0===m)var y={p:this.start.pt,a:-1};else var y={p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a};r.push(y);var _={};_.popPoint=y,0==m&&(s.push(y),a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}));var x=this.getRoadName(h[v+1].t,h[v+1].n),P={title:0==m?this.start.wd:this.getTpName(v),info:"",next:x||this.noName};d.push(P),_.popInfo=P,p.push(0==m?0:_);var $=this.getRoadName(h[v+1].t,h[v+1].n),b=this.getRoadName(h[v+2].t,h[v+2].n),C=parseInt(h[v+1].d),S=this.roundDis(C);if(r.push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}),0==m&&s.push(r[r.length-1]),v+2==g.end)d.push({title:$||this.noName,info:this.rettype[c[v+1].rt]+S,next:"停车点"});else{f=c[v+2].rt;var I=this.getRetType(h[v+1].t,1,h[v+1].n);3==f&&(b="到达"+this.rettype[f],I="，");var L=this.getTicInfo(c,v+1);d.push({title:$||this.noName,info:L+this.getTurType(c[v+1].ett)+I+b,next:b||this.noName})}}else if(v==g.start+1){var B=mapUtil.parse2Geo(h[v].g);n.push(B.points),e.push(B.bound),i[i.length-1].push(B.bound),o[o.length]||(o[o.length]=[]),o[o.length-1].push({p:B.points,d:w,b:B.bound});var N=this.getRoadName(h[v].t,h[v].n),$=this.getRoadName(h[v+1].t,h[v+1].n),b=h[v+2]?this.getRoadName(h[v+2].t,h[v+2].n):"",C=parseInt(h[v+1].d),S=this.roundDis(C);if(r.push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}),s.push(r[r.length-1]),1==a.length?a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}):u>0&&h[v].n==h[this.mainRoute[u-1]].n&&a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}),v+1==g.end)d.push({title:"停车点",info:this.rettype[c[v+1].rt],next:m==this.routeIndex.length-1?"终点":"途经点"});else if(v+2==g.end)d.push({title:x||this.noName,info:this.rettype[c[v+1].rt]+S,next:"停车点"});else if(3==c[v+2].rt){var f=c[v+2].rt,k=this.rettype[f];d.push({title:x||this.noName,info:this.rettype[c[v+1].rt]+S+"，到达"+k,next:b||this.noName})}else{var M,f=c[v+1].rt;if(3==f&&v+2==c.length){x=N;var R=parseInt(h[v+2].d),U=this.roundDis(R);M=this.rettype[c[v+2].rt]+U+"，到达停车点"}else{x=T.trim(h[v+2].n);var R=parseInt(h[v+1].d),U=this.roundDis(R);if(v+3==g.end)if(3!=f||this.isTp(v)){N=this.getRoadName(h[v+1].t,h[v+1].n),b=this.getRoadName(h[v+2].t,h[v+2].n);var L=this.getTicInfo(c,v+1);M=L+this.getTurType(c[v+1].ett)+","}else{N=this.getRoadName(h[v].t,h[v].n),b="停车点";var R=parseInt(h[v+2].d),U=this.roundDis(R);M=this.rettype[c[v].rt]+U+this.getTurType(c[v+1].ett)+"，到达停车点"}else if(3!=f||this.isTp(v)){N=this.getRoadName(h[v+1].t,h[v+1].n),b=this.getRoadName(h[v+2].t,h[v+2].n);var I=this.getRetType(h[v+2].t,1,h[v+2].n),L=this.getTicInfo(c,v+1);M=L+this.getTurType(c[v+1].ett)+I+b}else{N=this.getRoadName(h[v].t,h[v].n),b=this.getRoadName(h[v+3].t,h[v+3].n);var R=parseInt(h[v+2].d),U=this.roundDis(R),I=this.getRetType(h[v+3].t,1,h[v+3].n),L=this.getTicInfo(c,v+1);M=L+this.getTurType(c[v].ett)+I+b}}d.push({title:N||this.noName,info:M,next:b||this.noName})}}else if(v==g.end-1){var B=mapUtil.parse2Geo(h[v].g);n.push(B.points),o[o.length-1].push({p:B.points,d:w,b:B.bound}),e.push(B.bound),i[i.length-1].push(B.bound),r.push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}),s.push(r[r.length-1]),1==a.length?a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}):u>0&&h[v].n==h[this.mainRoute[u-1]].n&&(0==a[a.length-1].length&&a[a.length-1].push({p:mapUtil.parse2Geo(c[v-1].pt).points,a:c[v-1].a}),a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a})),d.push({title:"停车点",info:"步行前往"+(m==this.routeIndex.length-1?"终点":"途经点"),next:m==this.routeIndex.length-1?this.end.wd:this.getTpName(g.end)})}else if(v==g.end)m===this.routeIndex.length-1&&(t.push({p:mapUtil.parse2Geo(c[v].pt).points,n:this.end.wd}),r.push({p:this.end.pt,a:-1}),s.push(r[r.length-1]),1==a.length?a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}):u>0&&h[v].n==h[this.mainRoute[u-1]].n&&a[a.length-1].push({p:this.end.pt,a:-1}),d.push({title:this.end.wd,info:"",next:""}),p.push(d.length-1));else if(3===f){var k=T.trim(h[v+1].n);k=k||this.noName,t.push({p:mapUtil.parse2Geo(c[v].pt).points,n:k}),o[o.length]||(o[o.length]=[])}else{var N=(this.getRoadName(h[v-1].t,h[v-1].n),this.getRoadName(h[v].t,h[v].n)),x=this.getRoadName(h[v+1].t,h[v+1].n),L=this.getTicInfo(c,v),f=c[v+1].rt,$=this.getRoadName(h[v+1].t,h[v+1].n),b=this.getRoadName(h[v+2].t,h[v+2].n),C=parseInt(h[v+1].d),S=this.roundDis(C),B=mapUtil.parse2Geo(h[v].g);if(n.push(B.points),o[o.length-1].push({p:B.points,d:w,b:B.bound}),e.push(B.bound),i[i.length-1].push(B.bound),r.push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}),s.push(r[r.length-1]),1==a.length?a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a}):u>0&&h[v].n==h[this.mainRoute[u-1]].n&&(0==a[a.length-1].length&&a[a.length-1].push({p:mapUtil.parse2Geo(c[v-1].pt).points,a:c[v-1].a}),a[a.length-1].push({p:mapUtil.parse2Geo(c[v].pt).points,a:c[v].a})),3==c[v+2].rt){var f=c[v+2].rt,k=this.rettype[f],b=T.trim(h[v+3].n);d.push({title:x||this.noName,info:this.rettype[c[v+1].rt]+S+"，到达"+k,next:b||this.noName})}else if(3==c[v+1].rt){k=this.rettype[f];var C=parseInt(h[v+2].d),S=this.roundDis(C);x=T.trim(h[v].n);var b=T.trim(h[v+3].n),I=this.getRetType(h[v+3].t,1,h[v+3].n),L=this.getTicInfo(c,v+2);d.push({title:x||this.noName,info:L+this.getTurType(c[v+2].ett)+I+b,next:b||this.noName})}else{var I=this.getRetType(h[v+2].t,1,h[v+2].n),L=this.getTicInfo(c,v+1);(2==c[v+2].rt||5==c[v+2].rt||6==c[v+2].rt)&&(I="到达",b="停车点"),d.push({title:x||this.noName,info:L+this.getTurType(c[v+1].ett)+I+b,next:b||this.noName})}}}return{dragPoints:t,driveBounds:e,drivePoints:n,driveTargetPoints:s,groupBounds:i,groupPopPoints:a,routePoints:o,popPoints:r,popInfos:d,keyPopInfos:p,start:this.start,end:this.end,endArray:this.json.result.end,sCity:this.sCity,eCity:this.eCity,endCityArray:this.json.result.end_city,total:this.total,drag:this.drag,cinfo:this.cinfo,waypoints:this.waypoints,strategy:this.strategy,mainRouteIndex:this.mainRouteIndex}},getTurType:function(t){var e=["","直行","右前方转弯","右转","右后方转弯","调头","左后方转弯","左转","左前方转弯","稍向左转","直行","稍向右转","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向"];return e[t]},getRoadName:function(t,e){var n=["","环岛","无属性道路","主路","高速连接路","交叉点内路段","连接道路","停车场内部道路","服务区内部道路","桥","步行街","辅路","匝道","全封闭道路","未定义交通区域","POI连接路","隧道","步行道","公交专用道","提前右转道"];return""!=e&&e||(9==t||12==t||1==t||16==t)&&(e=n[t]),e},getRetType:function(t,e,n){var i="";return 0==e?(i="进入",n||9!=t&&12!=t?(0==t||!n&&1!=t&&16!=t)&&(i=""):i="上"):1==e&&(i="，进入",n||9!=t&&12!=t?(0==t||!n&&1!=t&&16!=t)&&(i=""):i="，上"),i},roundDis:function(t){var e="";return t>0&&10>=t?e="10米":t>10&&(e=1e3>t?10*(t/10).toFixed(0)+"米":(t/1e3).toFixed(1)+"公里"),e},getRoadAct:function(t,e){var n="沿";return(0==t||!e&&1!=t&&16!=t&&9!=t&&12!=t)&&(n=""),n},getTicInfo:function(t,e){var n=["在","从","从"],i=["","","离开"],a=t[e].iw;return""==t[e].ic?"":(n[a]||"")+"<span>"+t[e].ic+"</span>"+(i[a]||"")
},getPoiInfo:function(t,e,n){var i="",a=["过","在"],s=["左侧的","右侧的",""];if(e){var o=s[e.ps]||"",r=a[e.pw]||"",d=e.pd<(13==t[n].t||4==t[n].t?1e3:50)?"":"约"+this.roundDis(e.pd)+"后";i=r+o+"<span class='b'>"+e.pn+"</span>"+d+(""==o?"":"，")}return i},leftOrRight:function(t,e,n){var i,a,s,o=mapUtil.parse2Geo(t[n-1].g).points.split(";"),r=this.end.pt.split(",");if(o&&o.length>=2){var d=o.length;a=o[d-1].split(","),s=o[d-2].split(",")}else a=mapUtil.parse2Geo(e[n-1].pt).points.split(","),s=mapUtil.parse2Geo(e[n-2].pt).points.split(",");var p=(a[0]-r[0])*(s[1]-r[1])-(a[1]-r[1])*(s[0]-r[0]);0==p?i=2:p>0?i=6:0>p&&(i=5);var c=BMap.Project.getDistanceByMC(new BMap.Point(r[0],r[1]),new BMap.Point(a[0],a[1]));return 10>c&&(i=2),i},getExtInfo:function(){var t=this.json.content.dis,e=this.roundDis(t),n=this.json.content.time,i="";return e&&(i+=e),n&&(i+="/"+transUtil.formatTime(n,"nav")),i="约"+i},getCmsAds:function(){return""},getPanoNavParams:function(){return this._panoNavParams},_generatePanoNavPrams:function(){var t=searchData.setUrl(this.modelQuery),e=util.getParam(t);if(e&&e.sn&&e.en)var n={start:e.sn,end:e.en,level:e.l,bound:e.b,currentCity:e.c,sc:e.sc,ec:e.ec,strategy:e.sy,extinfo:e.extinfo,time_index:-1,day:-1};else n="";return n},getTpName:function(t){for(var e=0;e<this.tpList.length;e++)if(this.tpList[e].index===t)return this.tpList[e].name;var n=this.json.content.rss[t+1].n;return n=n?n:this.noName},isTp:function(t){for(var e=!1,n=0;n<this.tpList.length;n++)if(this.tpList[n].index===t){e=!0;break}return e},returnDr:function(){addStat("navscheme.navscheme.showreturn");var t=this;t.cinfo&&1==t.cinfo.isSingle&&(t.cinfo.t=0==t.cinfo.t?1:0),t.navMap.dragPoints.reverse();var e=this.navMap.buildQueryOnlyByTp(null,5);componentManager.go("nav&navtp=1&c="+t.currentCity+"&drag=0&sc="+t.eCity.code+"&ec="+e.tc+t.sCity.code+"&sy="+t.strategy+"&en="+e.tp+"1$$$$"+t.start.pt+"$$"+encodeURIComponent(t.start.wd)+"$$$$$$&sn=1$$$$"+t.end.pt+"$$"+encodeURIComponent(t.end.wd)+"$$$$$$&sq="+encodeURIComponent(t.e_query)+"&eq="+encodeURIComponent(t.s_query),{cinfo:t.cinfo})},busChange:function(){searchBox.setSwitchTab(2);var t=this;searchBox._ByClickTab=!1,t.cinfo&&1==t.cinfo.isSingle&&(t.cinfo.q=t.cinfo.q.replace(/^nse&/,"bse&")),t.cinfo._maplevel=map.getZoom(),t.cinfo._centerPoint=map.getCenter(),componentManager.go(this.busQueryString,{cinfo:t.cinfo})},backAddr:function(){addStat("navscheme.navscheme.reslectterminal");var t=this;if(t.cinfo&&1==t.cinfo.isSingle)componentManager.go(t.cinfo.q+"&src=4",{cinfo:t.cinfo});else{var e=this.navMap.buildQueryOnlyByTp(2,6);componentManager.go("nav&c="+t.currentCity+"&drag=0&sc="+t.sCity.code+"&ec="+e.tc+t.eCity.code+"&sy="+t.strategy+"&sn=2$$$$"+t.start.pt+"$$"+encodeURIComponent(this.s_query)+"$$$$$$&en="+e.tp+"2$$$$"+t.end.pt+"$$"+encodeURIComponent(this.e_query)+"$$$$$$&src=4")}},navWalk:function(){var t=this;t.cinfo&&1==t.cinfo.isSingle&&(t.cinfo.t=0==t.cinfo.t?1:0),componentManager.go("walk&version=2.0&walktp=1&c="+t.currentCity+"&wdrag=0&sc="+t.sCity.code+"&ec="+t.eCity.code+"&sy="+t.strategy+"&en=1$$$$"+t.end.pt+"$$"+encodeURIComponent(t.end.wd)+"$$$$$$&sn=1$$$$"+t.start.pt+"$$"+encodeURIComponent(t.start.wd)+"$$$$$$&sq="+encodeURIComponent(t.s_query)+"&eq="+encodeURIComponent(t.e_query),{cinfo:t.cinfo})},sendSMS:function(t,e){var e=e||window.event;sms.ready(this,"nav"),addStat("navscheme.navscheme.navtomb"),util.stopBubble(e)},addToFav:function(t,e){addStat("navscheme.navscheme.navfavourite");var n=this;util.stopBubble(window.event||e),SyncMgr.checkFav(function(){SchemeFaver.toClound.call(n,{pathtype:0,dom:t})},this)},print:function(t){addStat("navscheme.navscheme.navschemeprint"),require.async("common:widget/ui/PrintMap/PrintMap.js",function(e){e.printMap(t.getElementsByTagName("a")[0])})},navTranFor3D:function(t){var e=this;MapConfig.navTrans.enableDragging=t,window.startPoi&&(t?window.startPoi.enableDragging():window.startPoi.disableDragging()),window.endPoi&&(t?window.endPoi.enableDragging():window.endPoi.disableDragging()),t?e.navMap.tipLabel&&map.addOverlay(e.navMap.tipLabel):e.navMap.tipLabel&&map.removeOverlay(e.navMap.tipLabel);for(var n=0;n<e.navMap.dragPois.length;n++)t?e.navMap.dragPois[n].enableDragging():e.navMap.dragPois[n].disableDragging()},setContext:function(t){var e=this;t&&(mapUtil.getGEORevertAddress(t,function(t){e.setValue(t)}),0==window.conType?this.startP=t:this.endP=t)},setValue:function(t){function e(t){var e=t.target.getPoint();util.loadSearchInfo(function(n){var i=n.createSearchInfoWnd({title:p},{x:e.lng,y:e.lat,isMenu:!0});n.openSearchInfoWnd(i,t.target),i.addEventListener("open",function(){n.switchInfoWndTab(1,"iw_esn")})})}function n(t){var e=t.target.getPoint();util.loadSearchInfo(function(n){var i=n.createSearchInfoWnd({title:p},{x:e.lng,y:e.lat,isMenu:!0});n.openSearchInfoWnd(i,t.target),i.addEventListener("open",function(){n.switchInfoWndTab(0,"iw_ssn")})})}var i=t.content,a=this,s="0",o="0",r=0,d=0==window.conType?this.startP:this.endP;if(!i)return void(0==window.conType?(map.removeOverlay(window.startPoi),window.startPoi=null):(map.removeOverlay(window.endPoi),window.endPoi=null));if(i){var p=i.address||"未知路段",c=map.temp.infoWin;if(window.cxtBusPoints||(window.cxtBusPoints=[]),0==window.conType)return window.cxtBusPoints[0]={p:d,n:p},window.startPoi?window.startPoi.setPoint(window.cxtBusPoints[0].p):(window.startPoi=mapUtil.addDestPoi(window.cxtBusPoints[0].p,"",constants.DEST_START),window.startPoi.enableDragging()),searchBox.busSSG1.setValue(p),searchBox.inputInfo.BusSearchSta.note=p,searchBox.inputInfo.BusSearchSta.point=window.startPoi.point.lng+","+window.startPoi.point.lat,searchBox.driveSSG1.setValue(p),searchBox.inputInfo.DriveSearchSta.note=p,searchBox.inputInfo.DriveSearchSta.point=window.startPoi.point.lng+","+window.startPoi.point.lat,window.startPoi.addEventListener("click",e),window.startPoi.addEventListener("dragging",function(){this.closeInfoWindow(),window.startPoi.removeEventListener("click",e)}),window.startPoi.addEventListener("dragend",function(){a.dragPointEnd(this,0)}),window.startPoi&&window.endPoi?startGo(s,o,r):c&&c.isOpen()&&c._ext&&"未知地点"!=c._ext.name&&(window.endPoi=mapUtil.addDestPoi(c.getPoint(),"",constants.DEST_END),window.endPoi.addEventListener("dragstart",function(t){a.dragStart(t)}),window.endPoi.addEventListener("dragging",function(t){a.draging(t)}),window.endPoi.addEventListener("dragend",function(t){a.dragEnd(t,1)}),window.endPoi.enableDragging(),window.cxtBusPoints[1]={p:c.getPoint(),n:c._ext.name||"未知地点",t:1},window.startPoi&&window.endPoi&&startGo(s,o,r)),void(i=null);if(1==window.conType)return window.cxtBusPoints[1]={p:d,n:p},window.endPoi?window.endPoi.setPoint(window.cxtBusPoints[1].p):(window.endPoi=mapUtil.addDestPoi(window.cxtBusPoints[1].p,"",constants.DEST_END),window.endPoi.enableDragging()),searchBox.busSSG2.setValue(p),searchBox.inputInfo.BusSearchEnd.note=p,searchBox.inputInfo.BusSearchEnd.point=window.endPoi.point.lng+","+window.endPoi.point.lat,searchBox.driveSSG2.setValue(p),searchBox.inputInfo.DriveSearchEnd.note=p,searchBox.inputInfo.DriveSearchEnd.point=window.endPoi.point.lng+","+window.endPoi.point.lat,window.endPoi.addEventListener("click",n),window.endPoi.addEventListener("dragging",function(){this.closeInfoWindow(),window.endPoi.removeEventListener("click",n)}),window.endPoi.addEventListener("dragend",function(){a.dragPointEnd(this,1)}),window.startPoi&&window.endPoi?endGo(s,o,r):c&&c.isOpen()&&c._ext&&"未知地点"!=c._ext.name&&(window.startPoi=mapUtil.addDestPoi(c.getPoint(),"",constants.DEST_START),window.startPoi.addEventListener("dragstart",function(t){a.dragStart(t)}),window.startPoi.addEventListener("dragging",function(t){a.draging(t)}),window.startPoi.addEventListener("dragend",function(t){a.dragEnd(t,0)}),window.startPoi.enableDragging(),window.cxtBusPoints[0]={p:c.getPoint(),n:c._ext.name||"未知地点",t:0},window.startPoi&&window.endPoi&&endGo(s,o,r)),void(i=null)}},dragPointEnd:function(t,e){if(t){window.conType=e;var n=util.getOverlayPoint(t),i=this;mapUtil.getGEORevertAddress(n,function(t){i.setValue(t)}),0==window.conType?this.startP=n:this.endP=n}},removeTipOnResultPage:function(t){t&&(t.style.display="none",modelConfig.notShowTipInResultPage=!0)},showSendTipOnResultPage:function(){if(!isPrint){var t,e,n=this,i=/(sn=\d.*en=\d.*\$)/;if(!T.G("defCityTip")){var a='<div id="defCityTip" class="GR_Tip def_city_tip"></div>';util.beforeEndHTML(document.body,a)}this.modelQuery.match(i)&&(t=this.modelQuery.match(i)[1],e="http://tiyan.baidu.com/index.php?r=imap/post&tabs=0&source=1&start="+this.start.wd+"&end="+this.end.wd+"&"+t,e=encodeURI(e).replace(/'/g,escape("'")),T.G("defCityTip").innerHTML='<div class="tip_cont"><div class = "feedbackPop"><span>如果遇到问题，请您直接<a href = "'+e+'" title = "百度反馈专区" target = "_blank">告诉百度地图</a></span></div><button id="defCityTip-close-btn" onclick=";"></button>',this.setTipPos(T.G("defCityTip")),T("#defCityTip-close-btn").on("click",function(){n.removeTipOnResultPage(T.G("defCityTip"))}))}},setTipPos:function(t){t.style.display="block";var e=T.g("MapInfoCon").clientWidth,n=util.getClientSize().width,i=t.clientWidth,a=n/2-i/2;map.fullScreenMode?t.style.top="38px":(t.style.top="145px",a+=e/2),t.style.left=a+"px"},getOverlays:function(){return this.navMap.exportOverlays}}),module.exports=NavTrans});