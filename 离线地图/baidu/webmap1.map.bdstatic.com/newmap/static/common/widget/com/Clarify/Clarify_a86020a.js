define("common:widget/com/Clarify/Clarify.js",function(require,exports,module){function Clarify(e){MapComponent.call(this,e),this.curKw="",this.returnQuery="",this.ccodes=[],this.sCityCode=0,this.curSelIndex=-1,this.normPolylines=[],this.mcData=null,this.poiPionts=[],this.type=null,this.markers=[];var t="../../../images/mk_14e51b4.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/mk_14e51b4.gif*/;this.ICONS=[new BMap.Icon(t,new BMap.Size(19,23),{offset:new BMap.Size(6,23)}),new BMap.Icon(t,new BMap.Size(25,23),{offset:new BMap.Size(9,23),imageOffset:new BMap.Size(0,-30)}),new BMap.Icon(t,new BMap.Size(30,23),{offset:new BMap.Size(12,23),imageOffset:new BMap.Size(0,-60)}),new BMap.Icon(t,new BMap.Size(34,23),{offset:new BMap.Size(15,23),imageOffset:new BMap.Size(0,-90)})],this.moreCityScrollPanel=new baidu.ui.ScrollPanel({container:"moreCity_scrollPanel",overflow:"overflow-y",autoUpdate:!1})}var MapComponent=require("common:widget/com/MapComponent.js"),comMgr=require("common:widget/com/componentManager.js"),config=require("common:widget/ui/config/config.js"),util=require("common:widget/ui/util/util.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),searchData=require("common:widget/ui/searchData/searchData.js"),ClearBase=require("common:widget/ui/ClearBase/ClearBase.js"),iKnow=require("common:widget/ui/iKnow/iKnow.js"),GenRequest=require("common:widget/ui/genericRequest/GenericRequest.js");window.GRControll||(window.GRControll=new GenRequest({toolAreaId:"GR_Select"}));var MapConfig=config.mapConfig,modelConfig=config.modelConfig;T.lang.inherits(Clarify,MapComponent,"Clarify"),T.object.extend(Clarify.prototype,{render:function(){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("","undefined"==typeof no_result_title?"":no_result_title,'<div class="mapinfo_con">  ',"undefined"==typeof suggest_query?"":suggest_query,"  ","undefined"==typeof pinyin_suggest?"":pinyin_suggest,"  ","undefined"==typeof satequery_suggest?"":satequery_suggest,"  "),json.space_poi&&_template_fun_array.push('      <p style="margin-bottom:10px">您是否要<a href="javascript:void(0)" onclick="Instance(&#39;',"undefined"==typeof guid?"":guid,"&#39;)._showSpacePoi(&#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof json.space_poi.uid?"":json.space_poi.uid,"&#39;, &#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof json.space_poi.name?"":json.space_poi.name,'&#39;);return false;">在<b>全国</b>查看“<b>',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof json.space_poi.name?"":json.space_poi.name,"</b>”全段</a></p>  "),_template_fun_array.push("   "),json.result.jump_back&&_template_fun_array.push('      <p class="j_b">您是否要<a onclick="Instance(&#39;',"undefined"==typeof guid?"":guid,"&#39;).cnameSearch(&#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof json.result.wd?"":json.result.wd,"&#39;,&#39;","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof startCity.code?"":startCity.code,'&#39;, 3);return false;" href="javascript:void(0)">在<b>',"undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof startCity.name?"":startCity.name,"</b>找名称中含有<b>","undefined"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/==typeof json.result.wd?"":json.result.wd,"</b>的地点</a></p>  "),_template_fun_array.push("  ","undefined"==typeof description_city?"":description_city,"  ","undefined"==typeof cityList?"":cityList,"  ","undefined"==typeof moreCityLink?"":moreCityLink,"  ","undefined"==typeof prompt_info?"":prompt_info,"</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],style=".city_table{margin:5px 0 8px;_margin-left:4px;width:100%}.city_table tr{line-height:28px}.city_table a{text-decoration:none;color:#36c}.city_table a:hover{text-decoration:underline}.city_result{background:#fff2c7;height:25px;line-height:25px;padding-left:5px}#moreCityPop{*padding-left:4px;_padding-left:8px}#moreCityPop a{text-decoration:none;color:#36c}.sugg_q_cl a{text-decoration:none;color:#36c;line-height:30px}.sugg_q_cl a:hover,#moreCityPop a:hover{text-decoration:underline}";require.loadCss({content:style,name:"Clarify"});var json=this.json;if(!json||!json.content)return;var j=json,r=j.result;r.type&&(this.type=r.type),r.return_query=baidu.encodeHTML(r.return_query),r.wd=baidu.encodeHTML(r.wd),this.curKw=r.wd,this.returnQuery=r.return_query,this.sCityCode=j.current_city&&j.current_city.code||modelConfig.cityCode,this.sCityName=j.current_city&&j.current_city.name||modelConfig.cityName;var ctype=j.current_city&&j.current_city.type;this.ctype=ctype;var c=j.content,sg_search=this.cinfo.sg_search||0,cn=this.sCityName,wd=this.curKw?this.curKw:"";T.g("PoiSearch").value=wd||"";var templateObj={guid:this.guid,json:this.json,startCity:this.startCity||{}};if(!sg_search&&j.suggest_query){for(var suggs=j.suggest_query,suggStrs=["<p class='sugg_q_cl'>您是否要找：<br />"],i=0,l=suggs.length;l>i;i++)suggStrs.push("<a href='javascript:void(0)' onclick='Instance(\""+this.guid+'").q("'+suggs[i].query+'", 2,"SUGG");return false;\'>'),suggStrs.push(suggs[i].query),suggStrs.push("</a>"),i<suggs.length-1&&suggStrs.push("<br />");suggStrs.push("</p>"),templateObj.suggest_query=suggStrs.join("")}if(!sg_search&&j.psrs&&j.psrs.SENum>0&&!j.suggest_query&&j.result&&j.result.return_query==j.result.wd){for(var pinyinHtml=["<p class='sugg_q_cl'>您是否要找：<br />"],i=0,l=j.psrs.SENum;l>i;i++)pinyinHtml.push(" <a href='javascript:void(0)' onclick='Instance(\""+this.guid+'").q("'+j.psrs.SEResult[i]+'",0,"PS");return false;\' >'+j.psrs.SEResult[i]+"</a>"),i<j.psrs.SENum-1&&pinyinHtml.push("<br />");pinyinHtml.push("</p>"),templateObj.pinyin_suggest=pinyinHtml.join("")}var sateSuggestHtml="";1===j.result.pattern_sign&&(sateSuggestHtml="<p style='margin-bottom:10px;'>您是否要<a onclick='Instance(\""+this.guid+'").sendSateSuggestQuery("'+j.result.return_query+'", "'+j.current_city.code+"\");return false;'  href='javascript:void(0)'>在"+j.current_city.name+'找名称中含有"'+j.result.return_query+'"的地点？</a></p>',map.setMapType(BMAP_SATELLITE_MAP),maptypeCtrl&&maptypeCtrl.streetMapMgr(!0)),templateObj.satequery_suggest=sateSuggestHtml,0==r.current_null||(templateObj.no_result_title="<p  class='no_result_title'>在<strong>"+this.sCityName+"</strong>范围内没有找到相关地点。</p>");var clists=["<p  class=''>在<strong>"+this.sCityName+"</strong>范围内没有找到相关地点。</p>",'<p class="mt10 ">其它城市结果：</p>','<div><table class="city_table" cellspacing="0" cellpadding="0" border="0" align="left">',"<tr>"],moreCity=j.more_city;if(1==ctype&&moreCity&&moreCity.length>0)for(var i=0;i<moreCity[0].city.length;i++)c.push(moreCity[0].city[i]);for(var i=0,ti=0;i<c.length;i++,ti++){var chnL=escape(c[i].name).length/6,numL=c[i].num.toString().length,totL=2*chnL+numL;if(this.addCityPoi(c[i]),12>=totL)clists.push('<td width="33%" valign="top">');else{if(ti%3==2){clists.push("</tr><tr>"),clists.push('<td width="66%" valign="top" colspan="2">'),clists.push('<a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').searchInCity("+c[i].code+');return false;" tid="selCity_'+i+'" class="hotcity">'+c[i].name+"</a>("+c[i].num+")"),clists.push("</td>"),ti+=2;continue}clists.push('<td width="66%" valign="top" colspan="2">'),ti++}clists.push('<a href="javascript:void(0)" onclick="Instance(\''+this.guid+"').searchInCity("+c[i].code+');return false;" tid="selCity_'+i+'" class="hotcity">'+c[i].name+"</a>("+c[i].num+")"),clists.push("</td>"),this.ccodes.push(c[i].code),(ti+1)%3==0&&clists.push("</tr><tr>")}clists.push("</tr></table>"),clists.push('<div style="clear:both;"></div>'),clists.push("</div>"),templateObj.cityList=clists.join(""),1!=ctype&&r.count>6&&(templateObj.moreCityLink='<div id="moreCityPop" ><a id="moreCity1" class="arrowLink" href="javascript:void(0)" onclick="return Instance(\''+this.guid+"').showMoreCity()\">更多城市</a></div>");var sg=iKnow.getPromptInfo("想知道: "+this.curKw+"在哪",this.curKw);return templateObj.prompt_info=sg,template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/Clarify/Clarify.js",ln:238})}},initialize:function(){try{var e=this,t=this.json,i=t.more_city;!t.current_city&&t.result&&37==t.result.type&&(window.GRControll&&window.GRControll.setGRData(t),window.GRControll&&window.GRControll.clearGRMap());for(var n=window.searchPanoType||"",o=0;o<i.length;o++)if(i[o].city)for(var s=i[o].city,r=0;r<s.length;r++)"panoTopBanner"==n?this.addPanoCityPoi(s[r]):this.addCityPoi(s[r]);if(this.setLevel(),this.cinfo?this.cinfo._maplevel&&this.cinfo._centerPoint?map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel):this.cinfo._maplevel?map.centerAndZoom(map.getCenter(),this.cinfo._maplevel):this.cinfo._centerPoint?map.centerAndZoom(this.cinfo._centerPoint,map.getZoom()):map.centerAndZoom(map.getCenter(),map.getZoom()):map.centerAndZoom(this.cinfo._centerPoint,this.cinfo._maplevel),7!=this.type&&window.GRControll&&(window.GRControll.setGRequestFlg(1e3),window.GRControll.setGRData(this.json)),window.clarifyObj&&!window.clarifyObj.isMainRequest)try{window.clarifyObj.dispose()}catch(a){}window.clarifyObj=this,7!=this.type&&(window.clearClarify=function(){window.clarifyMarker&&map.clearOverlays()},window.clarifyMarker=e.markers),BoxContainer&&BoxContainer.resetStatus(),this.cinfo&&"searchBox"==this.cinfo.from&&ClearBase.clearInit(),(7==t.result.type||37==t.result.type||40==t.result.type)&&addStat("poilistnormal.poi.allsorts","show")}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/Clarify/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/com/Clarify/Clarify.js",ln:323})}},unload:function(){this.normPolylines.length=0,7!=this.type&&window.GRControll&&window.GRControll.clearCache(),this.moreCityScrollPanel=null},searchInCity:function(e){var t="",i=this.cinfo.sg_search||0;t=this.json&&this.json.result&&this.json.result.current_null?this.curKw:this.returnQuery,this.json&&this.json.result&&this.json.result.return_query&&(t=this.json.result.return_query),modelConfig.enableMapMove=!1,window.mapMoveTimer&&(clearTimeout(window.mapMoveTimer),window.mapMoveTimer=null),window.mapMoveTimer=setTimeout(function(){modelConfig.enableMapMove=!0},4e3);var n=window.searchPanoType||"";7!=this.type?40==this.type?comMgr.go("con&from=webmap&contp=1&da_src=pcmappg.clearify&on_gel=1&src=6&wd="+encodeURIComponent(t)+"&c="+e,{cinfo:{sg_search:i,from:n}}):comMgr.go("con&from=webmap&contp=1&da_src=pcmappg.clearify&on_gel=1&wd="+encodeURIComponent(t)+"&c="+e,{cinfo:{sg_search:i,from:n}}):comMgr.go("con&from=webmap&contp=1&wd="+encodeURIComponent(t)+"&c="+e,{cinfo:{sg_search:i}})},showMoreCity:function(){var e=this;return this.pop&&1==this.pop.visible?void this.pop.hide():this.pop&&0==this.pop.visible?void this.pop.show():this.mcData?void this._showMCPopup(this.mcData):void e._showMCPopup()},_showMCPopup:function(){var e=this.json.more_city;if(e){var t=this;this.curSelIndex=-1,require.async("common:widget/ui/Popup/Popup.js",function(i){t.pop=new i({title:"更多城市",content:t._getMoreCityListHtml(e),height:160,width:240,addDom:T.G("moreCityPop"),close:function(){t.pop=null}}),t.pop.addConnectDom(T.G("moreCity1")),t.pop.render(),t.moreCityScrollPanel.render("moreCity_scrollPanel"),t.pop.getDom().id="more_city_popup",t.pop.getDom().style.left="0",t.pop.getDom().style.top="18px"})}},_getMoreCityListHtml:function(e){if(e&&!(e&&e.length<=0)){var t=[];t.push("<div class='moreCity_wrapper'>"),t.push("<div id='moreCity_scrollPanel' class='moreCity_scrollPanel'>"),t.push("<ol class='mc_list'>");for(var i=0;i<e.length;i++){t.push("<li><a id='prov_"+i+"' href='javascript:void(0)' onclick='return Instance(\""+this.guid+'").unfoldCityList('+i+")'>"),t.push(e[i].province+"</a>("+e[i].num+")");var n=e[i].city;t.push("<ol id='cl_"+i+"'class='mc_list_city' style='display:none'>");for(var o=0,s=n.length;s>o;o++)t.push("<li><a href='javascript:void(0)' onclick='Instance(\""+this.guid+'").searchInCity('+n[o].code+");return false;' >"+n[o].name+"</a>("+n[o].num+")</li>");t.push("</ol></li>")}return t.push("</ol>"),t.push("</div>"),t.push("</div>"),t.join("")}},unfoldCityList:function(e){var t=T.G("cl_"+e);if(t)return"block"==t.style.display?this._hide(e):(this._hide(this.curSelIndex),this._show(e)),t.parentNode.parentNode.parentNode&&(t.parentNode.parentNode.parentNode.scrollTop=24*e,this.moreCityScrollPanel.update()),!1},_show:function(e){if(-1!=e){var t=T.G("cl_"+e);T.ac(T.G("prov_"+e),"fold"),t.style.display="block",this.curSelIndex=e}},_hide:function(e){if(-1!=e){var t=T.G("cl_"+e);T.rc(T.G("prov_"+e),"fold"),t.style.display="none"}},q:function(e,t){if(e){t||(t=0);{this.curKw?this.curKw:"",this.sCityName}comMgr.go("s&stp=0&wd="+encodeURIComponent(e)+"&c="+this.sCityCode+"&src="+t,{cinfo:{sg_search:1}})}},_showSpacePoi:function(e,t){if(e){var i=BMap.MapType[map.mapType].zoomLevelMax-3,n="ext&uid="+e+"&l="+i+"&c="+this.sCityCode+"&wd="+encodeURIComponent(t);searchData.fetch(n,function(e){e&&e.content&&comMgr.load("SpacePoi",{cinfo:{initData:e,poiName:t}})},function(){})}},addCityPoi:function(e){if(!(this.ctype>1)){var t=e.code,i=e.geo,n=e.name,o=e.num,s=util.geoToPoint(i);if(10>o)var r=this.ICONS[0],a=7;else if(100>o)var r=this.ICONS[1],a=5;else if(1e3>o)var r=this.ICONS[2],a=3;else var r=this.ICONS[3],a=1;var c=new BMap.Marker(s,{icon:r});c.addEventListener("domready",function(){util.beforeEndHTML(c.siblingElement,'<div style="z-index:10;font-weight:bold;position: absolute;color:#FFF;text-align:center;margin-top:1px;margin-left:'+a+'px">'+o+"</div>"),c.removeEventListener("domready",arguments.callee)}),map.addOverlay(c),c.setTitle(n+"共"+o+"个结果"),this.markers.push(c),o>999&&(o="999+");var l=this;c.addEventListener("click",function(){7!=this.type,l.searchInCity(t)}),c.addEventListener("mouseover",function(){this.setTop(!0)}),c.addEventListener("mouseout",function(){this.setTop(!1)}),this.poiPionts.push(s)}},setLevel:function(){if(this.isMainRequest!==!1){var e=this.json;if(40!=e.result.type){if(!(this.poiPionts.length<=0))if(1==e.current_city.code)map.centerAndZoom(new BMap.Point(11606355.22,4669275.88),5);else{if(this._mapInfo)return void map.centerAndZoom(this._mapInfo.center,this._mapInfo.level);if(modelConfig.enableMapMove=!1,window.mapMoveTimer&&clearTimeout(window.mapMoveTimer),window.mapMoveTimer=setTimeout(function(){modelConfig.enableMapMove=!0},4e3),window.GRControll&&window.GRControll.setGRequestFlg(4e3),1==this.poiPionts.length)return void map.centerAndZoom(this.poiPionts[0],6);mapUtil.setViewport(this.poiPionts)}}else if(this.history){window.GRControll&&window.GRControll.setGRequestFlg(2e3);var t=new BMap.Point(e.result.res_x,e.result.res_y);map.centerAndZoom(t,e.result.res_l)}}},sendSateSuggestQuery:function(e,t){map.setMapType(BMAP_NORMAL_MAP);var i=t||modelConfig.cityCode;comMgr.go("con&contp=0&wd="+encodeURIComponent(e)+"&pn=0&c="+i+"&check_sate=0")},cnameSearch:function(e,t,i){indexUtil.cnameSearch(e,t,i)}}),module.exports=Clarify});