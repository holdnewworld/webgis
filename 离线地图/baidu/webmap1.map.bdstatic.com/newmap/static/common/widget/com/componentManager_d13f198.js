define("common:widget/com/componentManager.js",function(require,exports,module){var searchData=require("common:widget/ui/searchData/searchData.js"),util=require("common:widget/ui/util/util.js"),modelCode={1:"City",2:"City",5:"BusStops",6:{special:{condition:"json.content.poiType===0",component:"PoiSearch"},defaultComponent:"Detail"},7:"Clarify",11:"PoiSearch",13:"RouteAddr",14:"BusTrans",15:"LinesQuery",18:"BusLines",19:"RouteAddr",20:"NavTrans",21:"SearchInView",22:"BusTrans",23:"RouteAddr",24:"RouteAddr",26:"SpecialPoi",28:"District",29:"RouteAddr",31:"NavWalk",36:"PoiSearch",37:"Clarify",38:"PoiSearch",39:"SearchInView",40:"Clarify",41:"PoiAddr",48:"CBusTrans"},printModel=["City","PoiSearch","SearchInView","BusTrans","NavTrans","CBusTrans"],components={},compMonitorFlag=!1,componentManager={start_event:0,compMonitorFlag:!1,go:function(url,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),opts=opts||{};var me=this;me.start_event=(new Date).getTime(),searchData.fetch(url,function(json){if(me.start_send=(new Date).getTime(),opts.json=json,opts.url=url,json&&json.result&&json.result.auth&&(window.AUTH=json.result.auth),1&json.result.result_show)return map.setMapType(BMAP_SATELLITE_MAP),void(window.maptypeCtrl&&window.maptypeCtrl.streetMapMgr(!0));var type=json.result.type,componentName=modelCode[type];if(!T.isString(componentName)&&componentName&&componentName.defaultComponent){var selector=componentName;if(componentName=selector.defaultComponent,selector.special){var flag=!0;try{eval(selector.special.condition)||(flag=!1)}catch(e){flag=!1}flag&&(componentName=selector.special.component)}}componentName&&(compMonitorFlag=!0,"NavTrans"==componentName||"RouteAddr"==componentName?me.loadTPMAsync(function(){me.load(componentName,opts,callback)}):me.loadPlaceAsync(function(){me.load(componentName,opts,callback)}))},function(){me.start_send=(new Date).getTime(),me.load("Error",{dom:baidu("#MapInfo")})})},load:function(e,o,n){var t=this,a={};o=o||{},o.dom=T(o.dom?o.dom:"#MapInfo"),o.name=e,require.async("common:widget/com/"+e+"/"+e+".js",function(r){t.transfer_time=(new Date).getTime();for(var i in components)null!=components[i]&&components[i].dom&&o.dom&&components[i].dom[0]===o.dom[0]&&(components[i].unload(components[i]._className,o),t.remove(i));if("Fav"!=e){var c=require("common:widget/ui/BoxContainer/BoxContainer.js");c&&c.exit()}!window.currentComponent||"PoiSearch"!=currentComponent._className&&"SearchInView"!=currentComponent._className||(t.preModuleName=window.currentComponent._className);var s=new r(o);components[e]=s,t.setBeforeRender(s,o);var m=s.render();if(m&&"object"==typeof m)s.$parentEl.empty().append(s.$el);else if(m&&"string"==typeof m)s.$el=T(m),s.$parentEl.empty().append(s.$el);else if(!m)return;if(o.json&&t.setInitStatus(s,o),s.initialize(),"function"==typeof o.onload&&o.onload(s),n&&n(s),window.isPrint&&baidu.array.contains(printModel,s._className)&&t.loadPrintCom(s),t.start_send){var l="z_"+e.toLowerCase()+"_load_time",u=t.transfer_time-t.start_send;u>0&&(a[l]=u,alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/cus.fire","time",a))}})},get:function(e){return components[e]},remove:function(e){components[e]=null},setBeforeRender:function(e,o){try{var n=o.json||{},t=require("common:widget/ui/Weather/Weather.js"),a=require("common:widget/ui/indexUtil/IndexUtil.js"),r=require("common:widget/ui/config/config.js"),i=r.modelConfig;if(util.loadSearchInfo(function(e){e.rangeSearchCenterMarker&&(e.rangeSearchCenterMarker.remove(),e.rangeSearchCenterMarker=null)}),e.isMainRequest&&n.current_city){var c=n.current_city;t.active=i.cityName!==c.name&&!n.weather,a.setCurCity(c.name,c.code,c.type,c),null!=c.sup_bus&&a.setSupBus(c.sup_bus),i.upCityid=c.up_cityid?c.up_cityid:c.code,window.clearClarify=null}}catch(s){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/exception.fire","catch",{msg:s.message||s.description,path:"common:widget/com/componentManager.js",ln:310})}},setInitStatus:function(e,o){var n=o.json||{},t=require("common:widget/ui/mapInfo/mapInfo.js"),a=require("common:widget/ui/fullScreen/fullScreen.js");n.hot_city&&window._OLR&&(window._OLR.hot_city=n.hot_city),1&n.result.result_show&&1==n.result.pattern_sign||window.GRControll&&window.GRControll.clearAfterGetAtBase(n),!map.fullScreenMode&&"close"!=t.status||window.GRControll&&window.GRControll.isGRequest&&!o.history||(map.fullScreenMode?n&&n.result&&2==n.result.type||o.cinfo&&0==o.cinfo.exitLargeMapMode||(a&&a.exitFull(void 0),"close"==t.status&&t.show()):"close"==t.status&&(n&&n.result&&2==n.result.type||o.cinfo&&0==o.cinfo.exitLargeMapMode||t.show()))},loadPrintCom:function(e){var o=e._className+"Print";require.async("common:widget/print/"+o+"/"+o+".js",function(e){var o=new e;o.initialize(currentComponent)})},loadPlaceAsync:function(e){require.async(["common:widget/ui/place/place.js","common:widget/ui/place/hotelFilter.js","common:widget/ui/place/caterFilter.js","common:widget/ui/place/scopeFilter.js","common:widget/ui/place/cinemaFilter.js","common:widget/ui/place/caterList.js","common:widget/ui/place/caterPopInner.js"],function(o,n,t,a,r,i,c){o.hotel=n,o.cater=t,o.scope=a,o.cinema=r,o.caterList=i,o.caterPopInner=c,window.place=o,e&&e()})},loadTPMAsync:function(e){require.async(["common:widget/ui/throughpoint/Throughpoint.js"],function(o){window.TPM=o,e&&e(o)})}};window.componentManager=componentManager,module.exports=componentManager});