define("common:widget/com/SearchInView/SearchInView.js",function(require,exports,module){function SearchInView(t){window.SearchInViewInst=this,MapComponent.call(this,t),this.MAX_RESULT_COUNT=760,this.itemsPerPage=10,this.curSelA=null,this.cmdNo=1,this.points=[],this.uids=[],this.markers=[],this.infoWnds=[],this.busStopPois=[],this.stationPoints=[],this.showIconIndices=[],this.curKw="",this.sugKw="",this.curItemPPage=0,this.curPage=0,this.totalCount=0,this.totalPage=0,this.curSelIndex=-1,this.bizCount=0,this.centerPt=null,this.centerPoi=null,this.cInfoWnd=null,this.radius=0,this.isnbSearch=!1,this.ctrPoiName="未知地点",this.ctrPoiUid="",this.busPolylines=[],this.normPolylines=[],this.normPolygons=[],this.sCityCode=0,this.sCityName="",this.reIndex=[],this.placeRe=window.place.placeRe,this.placeConfig=window.place.placeConfig}var MapComponent=require("common:widget/com/MapComponent.js"),comMgr=require("common:widget/com/componentManager.js"),stat=require("common:widget/ui/stat/CodeStat.js"),util=require("common:widget/ui/util/util.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),constant=require("common:widget/ui/constant/Constant.js"),SyncMgr=require("common:widget/ui/SyncMgr/SyncMgr.js"),BoxContainer=require("common:widget/ui/BoxContainer/BoxContainer.js"),Page=require("common:widget/ui/page/Page.js"),Share=require("common:widget/ui/mapShare/MapShare.js"),BShare=require("common:widget/ui/toolShare/ToolShare.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),PanoInfoUtil=require("common:widget/ui/PanoInfoUtil/PanoInfoUtil.js"),mapInfoScrollPanel=require("common:widget/ui/mapInfoScroll/mapInfoScroll.js"),searchData=require("common:widget/ui/searchData/searchData.js"),sms=require("common:widget/ui/sms/sms.js"),config=require("common:widget/ui/config/config.js"),modelConfig=config.modelConfig,MapConfig=config.mapConfig,setComplaintCenterURL=require("common:widget/ui/SetComplaintCenter/SetComplaintCenter.js"),ClearBase=require("common:widget/ui/ClearBase/ClearBase.js"),placeEntrance=require("common:widget/ui/place/placeEnter.js"),GenRequest=require("common:widget/ui/genericRequest/GenericRequest.js");window.GRControll||(window.GRControll=new GenRequest({toolAreaId:"GR_Select"}));var iKnow=require("common:widget/ui/iKnow/iKnow.js");T.lang.inherits(SearchInView,MapComponent,"SearchInView"),T.object.extend(SearchInView.prototype,{render:function(){try{var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="screening">',"undefined"==typeof result_title?"":result_title,"","undefined"==typeof screening?"":screening,"</div> ","undefined"==typeof no_result_title?"":no_result_title,'  <div id="txtPanel" class="mapinfo_con">',"undefined"==typeof suggest_query?"":suggest_query,"","undefined"==typeof pinyin_suggest?"":pinyin_suggest,"","undefined"==typeof space_poi?"":space_poi,"","undefined"==typeof list?"":list,'    <div id="result_page_c"></div>',"undefined"==typeof place_entrance_wd?"":place_entrance_wd,"","undefined"==typeof no_result?"":no_result,'    <div id="pctomoInView" class="pctomo_bottom2"></div>    <div id="user_feedback" class="blueC">百度提醒您：结果有错误？请到<a id="mapComplaintCenter" target="_blank" href="http://tousu.baidu.com/map/add">百度地图投诉中心</a>反馈。</div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],style=".mapinfo_con td a{text-decoration:none}.mapinfo_con td a:hover,.mapinfo_con td a:focus{text-decoration:underline}.correct_jiu{background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/icon_qipao_d0c2524.png) no-repeat scroll 0 0 transparent;height:12px;margin:-2px 3px 0 0;vertical-align:middle;width:13px}#result_page_c{margin:5px -10px 0 -8px}.pano_poi{height:18px;margin:3px 8px 0 0;width:18px;float:right;text-align:right;color:#3C6FCB;text-decoration:none;display:block;background:url(http://webmap2.map.bdstatic.com/newmap/static/common/images/pano_bg_new_3569ebd.gif) no-repeat scroll -86px -31px transparent;*background-position:-86px -33px}.pano_poi .street_view_poi:hover{text-decoration:underline}.street_view_poi{height:18px;margin:1px 6px 0 0;width:42px;*width:45px;float:right;text-align:right;color:#3C6FCB;text-decoration:none;display:block;background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_c1d9c10.png) no-repeat scroll 0 -259px transparent;*width:45px;_background:url(http://webmap0.map.bdstatic.com/newmap/static/common/images/street_tool_png8_d133824.png) no-repeat scroll 0 -259px transparent;*background-position:0 -208px;_padding-top:5px}";require.loadCss({content:style,name:"SearchInView"});var templateObj={};this.setBShareInfo(),addStat("searchresult.searchresult.pvuvonline","show"),window.clearClarify&&clearClarify();var j=this.json;if(!j||!j.result)return;var json=j,r=j.result;r.return_query=baidu.encodeHTML(r.return_query),r.wd=baidu.encodeHTML(r.wd),this.isUseCater="cater"===this.json.place_info.d_data_type,this.curPage=r.page_num,this.totalCount=r.total,this.pagingCount=r.total,this.pagingCount>this.MAX_RESULT_COUNT&&(this.pagingCount=this.MAX_RESULT_COUNT),this.specialCount=0==r.page_num?r.spec_dispnum||0:0,this.displayCount=this.totalCount+this.specialCount,this.curItemPPage=r.count,this.curKw=r.return_query||r.wd,this.what=r.what||r.wd,this.sugKw=r.wd2||"",this.totalPage=Math.ceil(this.pagingCount/this.itemsPerPage);var c=j.content;if(this.cmdNo=r.cmd_no,this.bizCount=0==this.curPage?this.getBizCount():this.cinfo.bizCount||0,j.current_city?(this.sCityCode=j.current_city.code,this.sCityName=j.current_city.name,this.ctype=j.current_city.type):(this.sCityCode=modelConfig.cityCode,this.sCityName=modelConfig.cityName),this.centerCityCode=this.cinfo&&this.cinfo.oc||this.sCityCode,json.place_info&&this.placeRe.test(json.place_info.d_data_type)&&(place.result=!0,templateObj.screening=place.insertHtml(json,this.guid)),0==r.total&&c&&0==c.length||0==r.total&&!c){if(1==this.json.result.op_gel&&this.json.result.res_l>0){window.GRControll.setGRequestFlg(1e3);var point=new BMap.Point(this.json.result.res_x,this.json.result.res_y),me=this;window.setTimeout(function(){map.centerAndZoom(point,me.json.result.res_l)},10)}return this._processNoResult(r,templateObj,template)}for(var result_titles=[],htmls=[],showIconIndex=0,i=0,l=r.count;l>i;i++)if(c[i].poiType!=constant.POI_TYPE_BUSLINE&&c[i].poiType!=constant.POI_TYPE_SUBLINE&&(showIconIndex++,this.showIconIndices[i]=showIconIndex),this._setColContent(c,i,htmls,showIconIndex),this.uids.push(c[i].uid),c[i].poiType!=constant.POI_TYPE_BUSLINE&&c[i].poiType!=constant.POI_TYPE_SUBLINE){var geo=util.parseGeo(c[i].geo),isGroupon=c[i].ext&&c[i].ext.detail_info&&c[i].ext.detail_info.groupon&&"[object Array]"==Object.prototype.toString.call(c[i].ext.detail_info.groupon);1==geo.type&&(this.markers.push(mapUtil.addSearchPoi(geo.points,showIconIndex-1,c[i].name,{type:isGroupon?"groupon":"normal",groupon:c[i].ext&&c[i].ext.detail_info&&c[i].ext.detail_info.groupon_num})),this.points.push(util.getPointByStr(geo.points)))}else this.markers.push(""),this.points.push("");var rcls=this.isUseCater?"result result_place":"result",resultTrd="";if(j.place_info&&j.place_info.d_data_type&&(resultTrd=j.place_info.d_data_type,"cinema"===j.place_info.d_business_type&&(resultTrd=j.place_info.d_business_type)),templateObj.list='<table cellspacing="0" cellpadding="0" class="'+rcls+" black "+resultTrd+'">'+htmls.join("")+"</table>",!place.result&&c[0]&&(c[0].cla&&c[0].cla[0]&&c[0].cla[0][0]&&c[0].geo||c[0].poi_origin&&33==c[0].poi_origin)){var placeProCode=null,geoStr=c[0].geo,BDPoiName="",nbOpt={nb_x:placeEntrance.execGeo(geoStr).x,nb_y:placeEntrance.execGeo(geoStr).y,uid:c[0].uid};33==c[0].poi_origin?(placeProCode=33,BDPoiName=c[0].name):c[0].cla&&c[0].cla[0]&&c[0].cla[0][0]&&c[0].geo&&(placeProCode=c[0].cla[0][0]);var placeProtype={13:!0,14:!0,18:!0,20:!0,33:!0};placeProtype[placeProCode]&&(templateObj.place_entrance_wd='<div id="place_tag">'+placeEntrance.insertHtml(placeProCode,this.sCityCode,nbOpt.nb_x,nbOpt.nb_y,nbOpt.uid,BDPoiName)+"</div>")}var l=r.res_l,cpt=new BMap.Point(r.res_x,r.res_y);return map.getZoom()==l&&map.getCenter().equals(cpt)||(window.GRControll.setGRequestFlg(1e3),map.centerAndZoom(cpt,l)),template(templateObj)}catch(e){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/SearchInView/exception.fire","catch",{msg:e.message||e.description,path:"common:widget/com/SearchInView/SearchInView.js",ln:271})}},initialize:function(t){try{t=t||{};var e=this,i=t.from||"";if(window.isPrint||ClearBase.clearInit(),this.setStatusByRes(this.json),this.setPanoStatus(i,this.cinfo.genRequestKey),place.result){var n=T.G("tagBar"),o=T.G("priceBar");place.barState.price.display?place.showBar(o,"price"):place.hideBar(o,"price"),place.barState.tag.display?place.showBar(n,"tag"):place.hideBar(n,"tag"),place.initialize(t,this.curKw)}this.bindEvtForAreaFilter();for(var s=this.markers,a=0,r=s.length;r>a;a++)!function(){var t=a,i=e.json.content[t].poiType;s[a]&&s[a].isVisible()&&(T("#item-td-"+a).mouseenter(function(){e._itemOver(T.G("item-td-"+t),t,i)}),T("#item-td-"+a).mouseleave(function(){e._itemOut(T.G("item-td-"+t),t,i)}),s[a].addEventListener("click",function(){e.json.content[t].ext;e.select(t,{statCode:STAT_CODE.STAT_GR_MARKER_CLICK,ct:"mk"})}),s[a].addEventListener("mouseover",function(){e._itemOver(T.G("item-td-"+t),t,i)}),s[a].addEventListener("mouseout",function(){e._itemOut(T.G("item-td-"+t),t,i)}));var n=T.G("no"+(a+1));T.on(n,"mouseover",function(){e._itemOver(null,t,i)}),T.on(n,"mouseout",function(){e._itemOut(null,t,i)}),T.on(T.G("item-td-"+t),"click",function(i){i=i||window.event,e._clickItem(i,t)})}();if(this.pagingCount>10){var l=this.sugKw?1:0,c="&db="+this.json.result.db;new Page("result_page_c",function(t){var i=e.getNormalNum(t),n="&da_src=pcmappg.searchinview.page&on_gel=1&src=7&gr=3",o=map.getBounds();n+="&b=("+o.minX+","+o.minY+";"+o.maxX+","+o.maxY+")&l="+map.zoomLevel,GRControll.openedMarker=null,GRControll.noRemoveTip1=!0,comMgr.go("bd&c="+e.sCityCode+place.urlArr+"&wd="+encodeURIComponent(e.curKw)+"&pn="+(t-1)+c+"&rn=10&wd2="+encodeURIComponent(e.sugKw)+"&sug="+l+n+"&nn="+i,{cinfo:{bizCount:e.bizCount,isClickNextPage:!0}})},{pageCount:e.totalPage,page:e.curPage+1,update:!1})}if(GRControll.openedMarker){var p=!1;if(this.json&&this.json.content)for(var a=0,d=this.json.content.length;d>a;a++){var u=this.json.content[a];if(u&&u.uid&&u.uid==GRControll.openedMarker.uid){this.setMarkerOpenInUrl(a,-1,-1,{notMove:!0,notZoom:!0}),p=!0;break}}p||window.spotInfoWnd||this.setMissingMarker()}if(this.cinfo&&(this.cinfo._maplevel&&this.cinfo._centerPoint||this.cinfo._maplevel&&map.zoomTo(this.cinfo._maplevel),"undefined"!=typeof this.cinfo._index&&e.json&&e.json.content)){var h=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[0]||this.cinfo._index,_=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[1]||-1,f=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[2]||-1,m=this.cinfo._index.split("|")&&this.cinfo._index.split("|")[3]||"",g=!0;""!=m&&e.json&&e.json.content&&e.json.content[h]&&m!=e.json.content[h].uid&&(g=!1),g&&(this.reIndex=[h,_,f],this.setMarkerOpenInUrl(h,_,f))}if(window.GRControll.setGRequestFlg(500),window.GRControll.setGRData(this.json,{cinfo:this.cinfo}),this.cinfo&&this.cinfo._index&&this.cinfo._index.indexOf("uid,")>=0){var w=this.cinfo._index.split("uid,")[1];window.GRControll.sendInfoRequest(w)}if(e.json&&e.json.result&&e.json.result.wd&&window.searchInViewCtrl&&e.history&&!place.result){var I=searchInViewCtrl.isMoving?500:0;setTimeout(function(){searchInViewCtrl.curKw=e.json.result.wd,searchInViewCtrl.prepare()},I)}mapInfoScrollPanel?mapInfoScrollPanel.show():T.g("MapInfo").style.overflowY="auto",BoxContainer.resetStatus(),this._setCmsCont(),this.bindEvent(),this.addTrdStat(),this.setWeiPaiTool(),setComplaintCenterURL(map,this)}catch(v){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/SearchInView/exception.fire","catch",{msg:v.message||v.description,path:"common:widget/com/SearchInView/SearchInView.js",ln:490})}},clearMarkersInSiv:function(t){var e=this;e&&e.clearMarkers&&e.clearMarkers(t)},addTrdStat:function(){var t=T("#txtPanel table").get(0)&&T("#txtPanel table").get(0).className.split(" ");if(t){var e=t[t.length-1].toUpperCase(),i=(T(".poiTitleW .poi_title"),T(".poiTitleW .detail"),T(".street_view_poi")),n=(T(".hotelImgBox img"),T("#txtPanel table  tr"));n.on("click",function(t){var i=T(t.target);if((i.hasClass("poi_title")||i.hasClass("label"))&&i.parent().hasClass("poiTitleW"))switch(e){case"CATER":addStat("poilistnormal.poi.foodtitle","show",{da_trd:e});break;case"HOTEL":addStat("poilistnormal.poi.hoteltitle","show",{da_trd:e});break;case"CINEMA":addStat("poilistnormal.poi.filmtitle","show",{da_trd:e});break;case"SCOPE":addStat("poilistnormal.poi.scenerytitle","show",{da_trd:e});break;default:addStat("poilistnormal.poi.othertitle","show",{da_trd:e})}else if(i.hasClass("detail"))switch(e){case"CATER":addStat("poilistnormal.poi.fooddetail","show",{da_trd:e});break;case"HOTEL":addStat("poilistnormal.poi.hoteldetail","show",{da_trd:e});break;case"CINEMA":addStat("poilistnormal.poi.filmdetail","show",{da_trd:e});break;case"SCOPE":addStat("poilistnormal.poi.scenerydetail","show",{da_trd:e});break;default:addStat("poilistnormal.poi.otherdetail","show",{da_trd:e})}else if(i.parent().hasClass("hotelImgBox"))switch(e){case"CATER":addStat("poilistnormal.poi.foodImg","show",{da_trd:e});break;case"HOTEL":addStat("poilistnormal.poi.hotelImg","show",{da_trd:e});break;case"CINEMA":addStat("poilistnormal.poi.filmImg","show",{da_trd:e});break;case"SCOPE":addStat("poilistnormal.poi.sceneryImg","show",{da_trd:e});break;default:addStat("poilistnormal.poi.otherImg","show",{da_trd:e})}else switch(e){case"CATER":addStat("poilistnormal.poi.foodBlankArea","show",{da_trd:e});break;case"HOTEL":addStat("poilistnormal.poi.hotelBlankArea","show",{da_trd:e});break;case"CINEMA":addStat("poilistnormal.poi.filmBlankArea","show",{da_trd:e});break;case"SCOPE":addStat("poilistnormal.poi.sceneryBlankArea","show",{da_trd:e});break;default:addStat("poilistnormal.poi.otherBlankArea","show",{da_trd:e})}}),i.on("click",function(){switch(e){case"CATER":addStat("poilistnormal.poi.foodpano","show",{da_trd:e});break;case"HOTEL":addStat("poilistnormal.poi.hotelpano","show",{da_trd:e});break;case"CINEMA":addStat("poilistnormal.poi.filmpano","show",{da_trd:e});break;case"SCOPE":addStat("poilistnormal.poi.scenerypano","show",{da_trd:e});break;default:addStat("poilistnormal.poi.otherpano","show",{da_trd:e})}})}},setStatusByRes:function(t){if(39==t.result.type&&1==searchBox._curSelIndex){var e=window.poiResponse;if("1"==t.result.op_gel&&window.useraction&&(!e||e&&t.result.return_query==e.result.return_query)){var i=e&&e.result.qid;window.poiResponse=t,addStat(7e3,{fqid:i,fbound:window.firstbounds,bound:window.lastbounds,useraction:window.useraction})}else window.poiResponse=t}else window.poiResponse=null;if(document.fmwd.word.value=t.result.wd,39==t.result.type&&window.place&&1==place.result&&(searchBox.poiSSG&&searchBox.poiSSG.setValue(t.result.wd),1!=searchBox._curSelIndex&&searchBox.setSwitchTab(1)),39==t.result.type){var n={};switch(t.place_info&&t.place_info.d_data_type&&(n.category=t.place_info.d_data_type.toUpperCase(),"cinema"===t.place_info.d_business_type&&(n.category=t.place_info.d_business_type.toUpperCase())),n.category){case"CATER":addStat("poilistnormal.poi.foodliststat","show",{da_trd:n.category});break;case"HOTEL":addStat("poilistnormal.poi.hotelliststat","show",{da_trd:n.category});break;case"CINEMA":addStat("poilistnormal.poi.filmliststat","show",{da_trd:n.category});break;case"SCOPE":addStat("poilistnormal.poi.sceneryliststat","show",{da_trd:n.category});break;default:addStat("poilistnormal.poi.otherliststat","show",{da_trd:n.category})}}},customScrollPanel:function(){var t=5;T.browser.ie&&(t=3,"6"==T.browser.ie&&place.result===!0&&(t=10)),this.scrollPanel=new baidu.ui.ScrollPanel({container:"main_result_content",overflow:"overflow-y",autoUpdate:!1,margin:[5,t,0,0]}),this.resizeContent&&T.un(window,"onresize",this.resizeContent);{var e=T.G("pctomoBottomId");T.G("pctomoBottomId2")}this.resizeContent=function(){if(1==window.op_gel_pic&&e&&(e.style.display="none"),e){var t=T.G("main_result_content"),i=e.parentNode,n=(T.dom.getPosition(i),util.getClientSize()),o=e.offsetHeight;place.result===!0&&(o=0,e.style.display="none");var s=n.height-142-o-10;s=s>0?s:0,t.style.height=s+"px",mapInfoScrollPanel&&mapInfoScrollPanel.hide(),window.SearchInViewInst&&SearchInViewInst.scrollPanel&&SearchInViewInst.scrollPanel.update({notToTop:!0})}},this.resizeContent(),T.on(window,"onresize",this.resizeContent),this.scrollPanel&&this.scrollPanel.render("txtPanel")},_setCmsCont:function(){if(!window.isPrint){var t=require("common:widget/ui/CMSUtil/cmsControl.js");baidu.g("pctomoInView").innerHTML=t.getPc2MoStr("poi")}},bindEvent:function(){var t=this;baidu("a.inr_poi").on("click",function(t){var e=baidu(this).data("uid"),i=baidu(this).data("wd");InrMgr.open(e,{wd:i,code:STAT_CODE.STAT_INR_LIST_CLICK}),t.preventDefault()}),baidu("a.street_view_poi").on("click",function(e){var i=baidu(this).data("index"),n=baidu(this).data("iconIndex");t.openPano(i,n),e.preventDefault(),e.stopPropagation()})},_clickItem:function(t,e){var i=this,n=t.srcElement||t.target;"pano_poi"!=n.className&&window.PanoMap&&PanoMap.isOpen&&PanoMap.hide();var o={statCode:STAT_CODE.STAT_GR_ITEM_CLICK};T.dom.hasClass(n,"street_view_poi")?o.ct="list_page_street":T.dom.hasClass(n,"inr_poi")?o.ct="list_page_inr":T.dom.hasClass(n,"pano_poi")&&(o.ct="list_page_pano"),i.select(e,o),this._setStreetview(e)},_hotelType:function(t,e,i,n,o,s){s=s||{};var a=this,r="",l={};l[place.URL_PARAM_PREFIX+"data_type"]=t,l[place.URL_PARAM_PREFIX+"sub_type"]=e,l[place.URL_PARAM_PREFIX+"price_section"]=i,l[place.URL_PARAM_PREFIX+"sort_type"]=n,l[place.URL_PARAM_PREFIX+"sort_rule"]=o,l[place.URL_PARAM_PREFIX+"discount2_section"]=place.urlParam[place.URL_PARAM_PREFIX+"discount2_section"],l[place.URL_PARAM_PREFIX+"groupon_section"]=place.urlParam[place.URL_PARAM_PREFIX+"groupon_section"],r=place.getUrlParamString(l);var c=e;if(""==e&&(e=a.curKw,c=a.curKw),e.indexOf("-")>-1){var p=e.split("-");c=p[p.length-1],""==c&&(c=p[p.length-2])}switch(window.searchInViewCtrl&&(window.searchInViewCtrl.curKw=c,window.searchInViewCtrl.isOpen&&baidu(window.searchInViewCtrl._container).trigger("click")),comMgr.go("bd&c="+a.sCityCode+"&wd="+encodeURIComponent(c)+r,{cinfo:{isFilter:!0}}),i!==PoiSearchInst.priceStatFalg&&void 0!==PoiSearchInst.priceStatFalg&&addStat("poilistnormal.poi.foodpriceclick"),PoiSearchInst.priceStatFalg=i,e!==PoiSearchInst.sortsStatFalg&&void 0!==PoiSearchInst.sortsStatFalg&&addStat("poilistnormal.poi.foodsort"),PoiSearchInst.sortsStatFalg=e,n){case"price":addStat("poilistnormal.poi.price");break;case"overall_rating":addStat("poilistnormal.poi.rating");break;case"taste_rating":addStat("poilistnormal.poi.taste");break;case"service_rating":addStat("poilistnormal.poi.services");break;default:addStat("poilistnormal.poi.default")}},searchByFilter:function(t){var e=this,i=place.getUrlParamString(t),n=t[place.URL_PARAM_PREFIX+"sub_type"],o=n;if(""==n&&(n=e.curKw,o=e.curKw),n.indexOf("-")>-1){var s=n.split("-");o=s[s.length-1],""==o&&(o=s[s.length-2])}if("hotel"===place.cachecategory){var a=place.hotel.getAreaInfo(),r="",l="s&c="+(place.hotel.current_city||e.sCityCode);return a&&!a.content&&!a.geo&&a.name&&(r=a.name+" "),o=r+o,t.hasOwnProperty("wd"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/SearchInView/)&&t.wd?(l+="&wd="+encodeURIComponent(t.wd),delete t.wd):l+="&wd="+encodeURIComponent(o),void comMgr.go(l+i,{cinfo:{isFilter:!0}})}return t.pl_sub_type.match(/电影院|影院|剧场|影城|剧院/g)?void comMgr.go("s&c="+e.sCityCode+i+"&on_gl=0&wd="+encodeURIComponent(o),{cinfo:{isFilter:!0}}):"cater"===place.cachecategory?comMgr.go("s&c="http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/SearchInView/+e.sCityCode+i+(t.wd?"":"&wd="+encodeURIComponent(o)),{cinfo:{isFilter:!0}}):(window.searchInViewCtrl&&(window.searchInViewCtrl.curKw=o,window.searchInViewCtrl.isOpen&&baidu(window.searchInViewCtrl._container).trigger("click")),void comMgr.go("bd&c="+e.sCityCode+"&wd="+encodeURIComponent(o)+i,{cinfo:{isFilter:!0}}))},clearMarkers:function(){for(var t=GRControll.openedMarker,e=0,i=this.markers.length;i>e;e++)this.markers[e]&&map.removeOverlay(this.markers[e]);this.markers.length=0,this.cInfoWnd=null;for(var e=0,i=this.busPolylines.length;i>e;e++)this.busPolylines[e]&&map.removeOverlay(this.busPolylines[e]);this.busPolylines=[];for(var e=0,i=this.busStopPois.length;i>e;e++)this.busStopPois[e]&&map.removeOverlay(this.busStopPois[e]);this.busStopPois=[],this.unListMarker&&(map.removeOverlay(this.unListMarker),this.unListMarker=null),t&&(GRControll.openedMarker=t)},unload:function(){var t=GRControll.openedMarker;T.G("MapInfo")&&(T.G("MapInfo").style.overflowX="hidden"),window.GRControll.clearCache(),place.result=!1,place.urlArr="",place.place_dateType=null,this.json=null,this.curSelA=null,this.points.length=0,this.markers.length=0,this.infoWnds.length=0,this.busStopPois.length=0,this.stationPoints.length=0,this.showIconIndices.length=0,this.centerPt=null,this.centerPoi=null,this.cInfoWnd=null,this.busPolylines.length=0,this.normPolylines.length=0,this.normPolygons.length=0,this.changeRangePopup&&(this.changeRangePopup.close(),this.changeRangePopup=null),this.unListMarker&&(map.removeOverlay(this.unListMarker),this.unListMarker=null),t&&(GRControll.openedMarker=t),MapComponent.prototype.unload.apply(this)},setMissingMarker:function(){var t=this,e=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET}),i=util.getPoiPoint(util.parseGeo(GRControll.openedMarker.geo).points),n=new BMap.Marker(i,{icon:e,zIndexFixed:!0,baseZIndex:25e5});n.setTitle(GRControll.openedMarker.name),map.addOverlay(n),n._stCode=constant.OVERLAY_STYLE.GEN_MKR1,t.unListMarker=n;var o="/?qt=inf&uid="+GRControll.openedMarker.uid+"&ie=utf-8&t="+(new Date).getTime();baidu.ajax(o,{dataType:"json",success:function(e){e&&e.content&&util.loadSearchInfo(function(i){t.showMissingInfoWin(e,i)})},error:function(t){console.log("qt=inf",t)}}),n.addEventListener("mouseover",function(){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-156),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});n.setIcon(t),n.setTop(!0,1000100)}),n.addEventListener("mouseout",function(){if(!map.temp.infoWin||1!=map.temp.infoWin.isOpen()||map.temp.infoWin.overlay!==this){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});n.setIcon(t),n.setTop(!1)}}),n.addEventListener("click",function(){t.unListInfoW&&t.unListMarker&&t.unListOpt&&util.loadSearchInfo(function(e){e.openSearchInfoWnd(t.unListInfoW,t.unListMarker,t.unListOpt)})})},showMissingInfoWin:function(t,e){var i=this,n=t.content,o=util.getPointByStr(util.parseGeo(n.geo).points);if(!s)var s={};s.notMove=!0;var a=n.addr;(n.poiType==constant.POI_TYPE_BUSSTOP||n.poiType==constant.POI_TYPE_SUBSTOP)&&(a=T.array.unique(a.split(";")).join("; "));var r=n.tel;r&&(r=r.replace(/,/g,", "));var l=i._getCateInfo(n.cla),c=n.detail&&n.ty==constant.GEO_TYPE_POINT||n.poiType==constant.POI_TYPE_BUSLINE||n.poiType==constant.POI_TYPE_SUBLINE,p=e.createSearchInfoWnd({title:n.name,addr:a,tel:r,uid:n.uid,cate:l,poiType:n.poiType,hasDetail:c,ext:n.ext,status:n.status,cp:n.cp,cla:n.cla,catId:n.new_catalog_id||""},{cityCode:i.sCityCode,x:o.lng,y:o.lat});if(p){if(p.addEventListener("open",function(){window.GRControll.setGRequestFlg(1500),map.infoWindow.closeButton&&T.on(map.infoWindow.closeButton,"click",function(){if(i.unListMarker){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});i.unListMarker.setIcon(t),i.unListMarker.setTop(!0,1000100),window.GRControll.openedMarker=null}})}),p.addEventListener("close",function(){if(i.unListMarker){var t=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(0,-116),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});i.unListMarker.setIcon(t),i.unListMarker.setTop(!0,1000100)}GRControll.openedMarker=null}),map.temp.infoWin&&1==map.temp.infoWin.isOpen())var d=GRControll.openedMarker;e.openSearchInfoWnd(p,i.unListMarker,s),d&&setTimeout(function(){GRControll.openedMarker=d},500),i.unListInfoW=p,i.unListOpt=s;var u=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-156),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});i.unListMarker.setIcon(u),i.unListMarker.setTop(!0,1000100),GRControll.mdMarker1&&GRControll.mdMarker1.hide(),GRControll.mdMarker2&&GRControll.mdMarker2.hide()}},loadData:function(){},setMarkerOpenInUrl:function(t,e,i,n){var o=this;if(-1!=t&&"c"!=t){var s=o.json.content[t]&&o.json.content[t].poiType||-1;if(s!=constant.POI_TYPE_BUSLINE&&s!=constant.POI_TYPE_SUBLINE||-1==i){var a=!0,r=!0;n&&n.notMove?a=!0:o.cinfo._centerPoint||(a=!1),n&&n.notZoom?r=!0:o.cinfo._maplevel||(r=!1),o.select(t,{notMove:a,notZoom:r,forReAppear:!0})}else o._processUrlReappear(s)}"c"==t&&o.cInfoWnd&&o.centerPoi&&(o._setTop(o.centerPoi,!0),util.loadSearchInfo(function(t){t.openSearchInfoWndPOI(o.cInfoWnd,o.centerPoi)}),this.curSelIndex="c"),(s==constant.POI_TYPE_BUSSTOP||s==constant.POI_TYPE_SUBSTOP)&&setTimeout(function(){o._processUrlReappear(s)},300)},select:function(t,e){if(!e)var e={};{var i=this.json&&this.json.content||[],n=this;i[t]&&1==i[t].biz_type}if(t==this.curSelIndex){if(1!=e.force&&(!this.points[t]||map.getBounds().containsPoint(this.points[t]))&&(i[t]&&i[t].poiType!=constant.POI_TYPE_BUSSTOP&&i[t].poiType!=constant.POI_TYPE_SUBSTOP||!i[t]))return;if(i[t]&&(i[t].poiType==constant.POI_TYPE_BUSSTOP||i[t].poiType==constant.POI_TYPE_SUBSTOP)&&map.temp.infoWin&&n.markers[t]&&1==map.temp.infoWin.isOpen()&&map.temp.infoWin.overlay===n.markers[t]&&(!n.points[t]||map.getBounds().containsPoint(n.points[t])))return}map.closeInfoWindow(),this.hideBusInfo(this.curSelIndex),this.curStopSelIndex=-1,T.G("line_list_"+this.curLineSelIndex)&&(T.rc(T.G("line_list_"+this.curLineSelIndex),"selected"),this.curLineSelIndex=-1);var o=this.curSelIndex;if(this.curSelIndex=t,n.markers[t]&&!n.markers[t].isVisible()&&(n.markers[t]=null,n.markers[t]=mapUtil.addSearchPoi(n.points[t],this.showIconIndices[t]-1),n.markers[t].addEventListener("click",function(){n.select(t,{statCode:STAT_CODE.STAT_GR_MARKER_CLICK})}),n.markers[t].addEventListener("mouseover",function(){n.markers[t].setIcon(n._getOverIcon(t))}),n.markers[t].addEventListener("mouseout",function(){map.temp.infoWin&&1==map.temp.infoWin.isOpen()&&map.temp.infoWin.overlay===this||n.markers[t].setIcon(n._getNormIcon(t))}),n.markers[t]._l=n.markers[t].iconDom.style.left,n.markers[t]._t=n.markers[t].iconDom.style.top),this._clearBusLine(),this._clearLine(),this._clearArea(),i[t])switch(i[t].ty){case constant.GEO_TYPE_AREA:n._showArea(i,t);break;case constant.GEO_TYPE_LINE:i[t].poiType==constant.POI_TYPE_BUSLINE||i[t].poiType==constant.POI_TYPE_SUBLINE?this._showBusLine(i[t].uid,!e.forReAppear,e.showBLCbk,t,1):this._showLine(i,t,e);break;case constant.GEO_TYPE_POINT:this._showInfoWindow(i,t,e)}e&&e.statCode&&setTimeout(function(){addStat(e.statCode,{n:t,uid:i[t].uid,ct:e.ct})},1e3),o!=t&&n.curSelA&&(T.rc(n.curSelA,"focus"),T.rc(n.curSelA,"focus-over"));var s=T.G("item-td-"+t);s&&(T.ac(s,"focus"),T.rc(s,"focus-over"),n.curSelA=s);var a=n.markers[o];a&&this._setTop(a,!1);var r=n.markers[t];if(r&&(!e.forReAppear||-1==this.reIndex[1])){var n=this;setTimeout(function(){n._setTop(r,!0)},200)}if(this._setShareSelIndex(this.curSelIndex),this.markers[t]){var l=1;map.temp.infoWin&&map.temp.infoWin.isOpen()||(l=50),setTimeout(function(){n.markers[t].setIcon(n._getOverIcon(t))},l),GRControll.mdMarker1&&GRControll.mdMarker1.hide(),GRControll.mdMarker2&&GRControll.mdMarker2.hide()}return!1},setComponentList:function(t){this.select(t)},_showInfoWindow:function(t,e,i){var n=this;util.loadSearchInfo(function(o){n.loadInfoWindow(t,e,i,o)})},loadInfoWindow:function(t,e,i,n){var o=this;if(!i)var i={};if(1!=i.forReAppear||-1==this.reIndex[1]||t[e].poiType!=constant.POI_TYPE_BUSLINE&&t[e].poiType!=constant.POI_TYPE_SUBLINE&&t[e].poiType!=constant.POI_TYPE_BUSSTOP&&t[e].poiType!=constant.POI_TYPE_SUBSTOP){var s=t[e].addr;(t[e].poiType==constant.POI_TYPE_BUSSTOP||t[e].poiType==constant.POI_TYPE_SUBSTOP)&&(s=T.array.unique(s.split(";")).join("; "));var a=t[e].tel;a&&(a=a.replace(/,/g,", "));var r=this._getCateInfo(t[e].cla),l=null;l=n.createSearchInfoWnd({title:t[e].name,addr:s,tel:a,uid:t[e].uid,cate:r,poiType:t[e].poiType,hasDetail:t[e]._hasDetail,ext:t[e].ext,ext_type:t[e].ext_type,status:t[e].status,cp:t[e].cp,cla:t[e].cla,bizType:t[e].biz_type,catId:t[e].new_catalog_id,pano:t[e].pano||0,indoor_pano:t[e].indoor_pano||0,pano_index:e},{cityCode:this.sCityCode,x:o.points[e].lng,y:o.points[e].lat}),l&&(l._aIndex=e,function(){var i=e,n=function(t){var i=T.G("item-td-"+t);T.rc(i,"focus"),T.rc(i,"focus-over"),o.curA=null;var n=o.markers[o.curSelIndex];if(n){var s=n.customProperty&&"normal"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/SearchInView/==n.customProperty.type?0:-constant.A_J_MARKER_ORANGE_ICON_Y,a=new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_RED_ICON_WID*(e-o.specialCount),s),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET});n.setIcon(a),n.setTop(!1)}o.curSelIndex=-1,o._setShareSelIndex(-1)};l.addEventListener("close",function(){n(i),GRControll.openedMarker=null,l.removeEventListener("close",arguments.callee)}),l.addEventListener("open",function(){map.infoWindow.closeButton&&T.on(map.infoWindow.closeButton,"click",function(){n(i),GRControll.openedMarker=null,T.un(map.infoWindow.closeButton,"click",arguments.callee)}),GRControll.openedMarker={uid:t[e].uid,geo:t[e].geo,name:t[e].name},l.removeEventListener("open",arguments.callee)})}(),i.from="searchinview",n.openSearchInfoWndPOI(l,o.markers[e],i))}},_showLine:function(t,e,i){var n=t[e].uid,o=this;if(!i)var i={};searchData.fetch("ext&uid="+n+"&l="+(BMap.MapType[map.mapType].zoomLevelMax-1)+"&c="+o.sCityCode,function(n){if(n&&(!n||n.content)){var s=util.parseGeo(n.content.geo);if(2==s.type){var a=[];if("string"==typeof s.points){o.normPolylines.push(mapUtil.addRoute(s.points));for(var r=s.points.split(";"),l=0,c=r.length;c>l;l++){var p=r[l].split(",");a.push(new BMap.Point(p[0],p[1]))}}else for(var l=0,c=s.points.length;c>l;l++)if(s.points[l]){o.normPolylines.push(mapUtil.addRoute(s.points[l]));for(var d=s.points[l].split(";"),u=0,h=d.length;h>u;u++)a.push(new BMap.Point(parseFloat(d[u].split(",")[0]),parseFloat(d[u].split(",")[1])))}if(t[e]._views){if(map.zoomLevel==t[e]._views.level||i.notZoom){var _=s.bound.split(";");new BMap.Bounds(_[0].split(",")[0],_[0].split(",")[1],_[1].split(",")[0],_[1].split(",")[1])}else;i.notZoom=!0,o._showInfoWindow(t,e,i)}else i.notZoom=!0,o._showInfoWindow(t,e,i)}}})},_clearLine:function(){for(var t=0,e=this.normPolylines.length;e>t;t++)mapUtil.removeRoute(this.normPolylines[t]),this.normPolylines[t]=null;this.normPolylines.length=0},_showArea:function(t,e){if(t[e]){var i=this;searchData.fetch("ext&uid="+t[e].uid+"&c="+this.sCityCode,function(t){if(t&&(!t||t.content)){var e=util.parseGeo(t.content.geo).points,n=[];if("string"==typeof e){i.normPolygons.push(mapUtil.addArea(e,constant.AREA_TYPE_NORM));for(var o=e.split(";"),s=0,a=o.length;a>s;s++)n.push(new BMap.Point(parseFloat(o[s].split(",")[0]),parseFloat(o[s].split(",")[1])))
}else for(var s=0,a=e.length;a>s;s++)if(e[s]){i.normPolygons.push(mapUtil.addArea(e[s]),constant.AREA_TYPE_NORM);for(var o=e[s].split(";"),r=0,l=o.length;l>r;r++)n.push(new BMap.Point(parseFloat(o[r].split(",")[0]),parseFloat(o[r].split(",")[1])))}window.GRControll.setGRequestFlg(1e3),mapUtil.setViewport(n)}})}},_clearArea:function(){for(var t=0,e=this.normPolygons.length;e>t;t++)mapUtil.removeArea(this.normPolygons[t]),this.normPolygons[t]=null;this.normPolygons.length=0},_setColContent:function(t,e,i,n){if(!window.isPrint){var o=[],s=t[e].addr,a=t[e].tel&&t[e].tel.replace(/(,|;)/gi,", ").replace("、","<br />");s&&o.push(t[e].poiType==constant.POI_TYPE_BUSSTOP||t[e].poiType==constant.POI_TYPE_SUBSTOP?"车次:"+s+"<br/>":"地址:"+s+"<br/>"),a&&o.push("电话:"+a),o=o.join("");var r=util.getPointByStr(util.parseGeo(t[e].geo).points),l=r.lng+"|"+r.lat,c={point:l,uid:t[e].uid,cityCode:this.sCityCode,title:t[e].name,content:o},p=SyncMgr.checkInFav({from:"poi",json:c}),d="",u="加入收藏夹",h=u;null!=p&&-1!=p&&(d="poi-fav-selected",u="取消收藏",h=u)}var _=(this.json.place_info.d_data_type,t[e].ext&&t[e].ext.detail_info&&t[e].ext.detail_info.groupon&&"[object Array]"==Object.prototype.toString.call(t[e].ext.detail_info.groupon));if(this.isUseCater)return void i.push(place.caterList.listHtml(this.json,t[e],e,n,this.sCityCode,l,o,d,h,_));var f=t[e].poiType,m=1==t[e].biz_type,g=!1,w=/餐饮/;t[e].biz_type=m;var I=0;if(t[e]&&t[e].ext&&t[e].ext.detail_info){var v=t[e].ext.detail_info;v.premium2&&"[object Array]"==Object.prototype.toString.call(v.premium2)&&v.premium2.length&&(I=1)}m||(t[e].biz_type=0),i.push("<tr "+(m?" class='poi_biz_r' ":"")+'id="item-td-'+e+'">'),t[e].poiType==constant.POI_TYPE_BUSLINE?i.push('<th><div class="bl_icon"></div></th>'):t[e].poiType==constant.POI_TYPE_SUBLINE?i.push('<th><div class="sl_icon"></div></th>'):(i.push('<th><div id="no'+n+'" class="icon'+(_?" icon-groupon":"")+'" onclick="SearchInViewInst.select('+e+', {statCode:STAT_CODE.STAT_GR_ITEM_CLICK})" title="在图上显示该点">'),i.push("</div></th>")),i.push("<td "+("090300"==t[e].new_catalog_id?'style="position:relative"':"")+">"),f!=constant.POI_TYPE_NORMAL&&i.push("<div>"),i.push('<div style="overflow:hidden;clear:both;*overflow:visible;">'),i.push('<div class="inr_pano">');var S="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*/;"undefined"!=typeof t[e].ext_type&&1&t[e].ext_type&&i.push('<a href="javascript:void(0)"  class=\'inr_poi\' data-uid="'+t[e].uid+'" data-wd="'+t[e].name+'"  title="查看室内地图"><img alt="查看室内地图" src="'+S+'"></a>'),t[e].pano&&i.push(t[e].cla[0]&&w.test(t[e].cla[0][1])?"<a href='javascript:void(0);'  class='street_view_poi' data-index=\""+e+'" data-iconindex="'+n+"\" ><img src='"+S+"' >全景</a>":"<a href='javascript:void(0);' class='street_view_poi' data-index=\""+e+'" data-iconindex="'+n+"\" ><img src='"+S+"' >全景</a>"),i.push("</div>"),t[e].ext&&t[e].ext.detail_info&&t[e].ext.detail_info.openkitchen&&i.push('<a title="透明橱窗" class="p_openkitchen" target="_blank" href="'+t[e].ext.detail_info.openkitchen+'"'),i.push('<p class="poiTitleW">'),i.push("餐馆"==this.curKw?'<a tid="poi_name_'+e+'" id="link'+e+"_show_"+this.guid+'" class = "poi_title" href="javascript:void(0)" SearchInViewInst.select('+e+', {statCode:STAT_CODE.STAT_GR_ITEM_CLICK});return false;">':'<a tid="poi_name_'+e+'" id="link'+e+"_show_"+this.guid+'" class = "poi_title" href="javascript:void(0)" onclick="SearchInViewInst.select('+e+', {statCode:STAT_CODE.STAT_GR_ITEM_CLICK});return false;">'),i.push(t[e].name),f==constant.POI_TYPE_BUSSTOP?i.push("-公交车站"):f==constant.POI_TYPE_SUBSTOP&&i.push("-地铁站"),i.push("</a>");var P=t[e].ext,y=P?P.src_name:"",C=this.json.place_info,b="";if(t[e].detail&&t[e].ty==constant.GEO_TYPE_POINT||f==constant.POI_TYPE_BUSLINE||f==constant.POI_TYPE_SUBLINE){if(P&&("biaozhu_data"==y&&"1"==P.yw_type||this.placeRe.test(y))){var R="详情";if(g=!0,"biaozhu_data"==y&&"1"==P.yw_type)i.push(' - <a class="detail blueA" tid="poiDetail_'+e+'" href="javascript:void(0)" onclick="place.showDetail(\''+t[e].uid+"', "+f+", "+this.sCityCode+", 'ISHOP_INFO');"+b+'return false;">详情»</a> <img src="../../../../../../../webmap2.map.bdstatic.com/newmap/static/common/images/yw_c0325d6.gif"/*tpa=http://webmap2.map.bdstatic.com/newmap/static/common/images/yw_c0325d6.gif*/ style="position:relative;top:3px"/>');else{var E=(y.toUpperCase()+"_","");"hospital"==y&&t[e].business_id&&(E=t[e].business_id),i.push(' - <a class="detail blueA" tid="poiDetail_'+e+'" href="javascript:void(0)" onclick="place.showDetail(\''+t[e].uid+"', "+f+", "+this.sCityCode+", '"+y+"','Page','List'"+(E?",false,'"+E+"'":"")+');return false;">'+R+"»</a>")}}else i.push(' - <a class="detail blueA" tid="poiDetail_'+e+'" href="javascript:void(0)" onclick="place.showDetail(\''+t[e].uid+"', "+t[e].poiType+", "+this.sCityCode+");"+b+'return false;">详情»</a>');t[e]._hasDetail=!0}if(m&&i.push("<span class='tip_biz_r'>推广</span>"),i.push("</p>"),i.push("</div>"),i.push(this._initAlert(t,e)),t[e].indoor_pano){var x=t[e].indoor_pano;i.push('<div class="hotelImg"><div class="hotelImgBox"><img src="'+x+'" onclick="SearchInViewInst.openIndoorPano('+e+')"  /><a href="javascript:void(0);" onclick="SearchInViewInst.openIndoorPano('+e+')" class="innerPanoBox">室内景</a></div></div>')}else if(P&&P.detail_info&&P.detail_info.image){var M=(y.toUpperCase()+"_",t[e].ext.detail_info.image),O="http://webmap3.map.bdimg.com/maps/services/thumbnails?width=70&height=55&src="+encodeURIComponent(M);i.push('<div class="hotelImg"'+("090300"==t[e].new_catalog_id&&'style="display: none;"')+'><div class="hotelImgBox"><img src="'+O+"\" onclick=\"addStat('poilistnormal.poi.image');place.showDetail('"+t[e].uid+"', "+f+", "+this.sCityCode+", '"+y+"','Page_Pic','List');\"  /></div></div>")}if(1==this.json.result.db&&t[e].debug_str&&i.push("<br /><span>debug: "+t[e].debug_str+"</span>"),(f==constant.POI_TYPE_BUSLINE||f==constant.POI_TYPE_SUBLINE)&&(i.push("</div><div>"),i.push('<div class="poi_bus_show" id="bus_info_link_'+e+'" ><a class="btn_bus_show" href="javascript:void(0)" onclick="return SearchInViewInst.showBusInfo('+e+')">途经车站</a></div>'),i.push('<div class="poi_bus_list" id="bus_info_'+e+'" style="display:none"></div>'),i.push("</div>")),t[e].addr){if(f==constant.POI_TYPE_BUSSTOP||f==constant.POI_TYPE_SUBSTOP){var k="途经公交车",A="公交";f==constant.POI_TYPE_SUBSTOP&&(k="途经地铁",A="地铁"),i.push('<p><span class="poi_bustrans">'+k+"：</span>"+T.array.unique(t[e].addr.split(";")).join("; ")+"</p>"),i.push("</div>"),i.push('<div class="poi_bus_show"><a class="btn_bus_show" tid="poiDetail_'+e+'" id="btn_unfold_bsline_'+e+'" href="javascript:void(0)" onclick="return SearchInViewInst.showBusList(this)">详情</a></div>'),i.push('<div class="poi_bus_list" style="display:none">'),i.push('<a class="btn_bus_hide" href="javascript:void(0)" onclick="return SearchInViewInst.hideBusList(this)">点击列表查看线路详情</a>'),i.push("<div class='bus'><table cellspacing='0' cellpadding='0' class='line'>");var B=t[e].addr.split(";");this.curLines=t[e].blinfo;for(var L=0,j=t[e].blinfo.length;j>L;L++){var U=T.trim(B[L]);""!==U&&(i.push("<tr id='line_list_"+e+"_"+L+"'>"),i.push("<th style='list_arrow'><img src='../../../images/blank.gif'/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/blank.gif*/ class='list_arrow'/></th>"),i.push("<td style='white-space:nowrap'>"+U+"</td>"),i.push("<td><a href='javascript:void(0)'"),i.push("onclick='return SearchInViewInst.selectBusLine("+L+', "'+t[e].blinfo[L].uid+'", '+e+")'>("+t[e].blinfo[L].name+")</a></td>"),i.push("</tr>"))}i.push("</table></div>"),i.push("</div>")}else if(f==constant.POI_TYPE_NORMAL||"undefined"==typeof t[e].poiType){if("090300"==t[e].new_catalog_id)i.push(t[e].ext&&t[e].ext.detail_info&&(t[e].ext.detail_info.book_info||t[e].ext.detail_info.overall_rating||t[e].ext.detail_info.groupon_num)?'<p class="n_p_lineheight" style="width:191px;float:left;">'+t[e].addr+"</p>":'<p class="n_p_lineheight">'+t[e].addr+"</p>");else if(t[e].ext&&"cater"==t[e].ext.src_name){if(t[e].ext.detail_info&&t[e].ext.detail_info.pc_bookable){var G,N="<a style=\"float:right;clear:right;margin-top:5px;margin-right:18px\" class=\"#{6}\" href=\"javascript:void(0);\" onclick=\"place.showDetail('#{0}','#{1}','#{2}','#{3}','#{4}','list');return false;\">#{5}</a>";G=[t[e].uid,t[e].poiType,this.sCityCode,t[e].ext.src_name,"cater_book","订座","hotel-order-new hotel-order-new-small book-cater"],i.push(baidu.string.format(N,G))}t[e].addr&&i.push('<p class="n_p_lineheight">地址：'+t[e].addr+"</p>")}else i.push('<p class="n_p_lineheight">地址：'+t[e].addr+"</p>");t[e].tel&&"090300"!=t[e].new_catalog_id&&i.push('<p tid="itemTel_'+e+'" class="n_p_lineheight">电话：'+t[e].tel.replace(/,/g,", ")+"</p>")}}else t[e].tel&&"090300"!=t[e].new_catalog_id&&i.push('<p tid="itemTel_'+e+'" class="n_p_lineheight">电话：'+t[e].tel.replace(/,/g,", ")+"</p>");if(P&&C&&this.placeRe.test(P.src_name)&&P.detail_info&&i.push(window.place.generatePlaceListInfo({content:t[e],index:e,placeInfo:this.json.place_info,cityCode:this.sCityCode,context:{wd:this.what,business_scope_type:this.business_scope_type}})),!this.placeRe.test(y)&&"090300"!=t[e].new_catalog_id&&""!=t[e].show_tag&&t[e].show_tag&&t[e].show_tag.length>0&&"0"!=t[e].tag_num){for(i.push('<p tid="itemTag_'+e+'" class="map_tagBox">标签：'),L=0;L<t[e].show_tag.length;L++)i.push('<span class="map_tagList">'+t[e].show_tag[L]+"</span>");i.push("</p>")}if(t[e].ext&&t[e].ext.title_link)for(var F=t[e].ext.title_link,L=0,j=F.length;j>L;L++)i.push('<a href="'+F[L].link+'" target="_blank" >'+F[L].title+"</a>"),j-1>L&&i.push("&nbsp;&nbsp;");i.push('<p class="p_left">'),i.push('<a id="poifav_'+t[e].uid+"\" href=\"javascript:void(0)\" onclick=\"addStat('poilistnormal.poi.poilistfavourite');SyncMgr.goFav({'point':'"+l+"','uid':'"+t[e].uid+"','cityCode':'"+this.sCityCode+"','title':'"+T.encodeHTML(t[e].name)+"','content':'"+T.encodeHTML(o)+'\'});return false;" class="poi-fav '+d+'"><img class="favorite" alt="'+h+'" src="'+S+'">收藏</a>'),i.push('<a href="javascript:void(0)" onclick=\'addStat("poilistnormal.poi.poilisttomb");SearchInViewInst._sendToSMS(this, "'+t[e].uid+'", "'+f+'", "'+this.sCityCode+'","list",'+g+');return false;\' class="poi-fav"><img class="stml" alt="免费发送到手机" src="'+S+'">发送到手机</a>'),i.push("<a class=\"poi-fav\"  href=\"javascript:void(0)\" onclick=\"addStat('poilistnormal.share.poilistshare');SearchInViewInst._sharePOI(event,{from:'poishare', linkinfo:{poiShareUid:'"+t[e].uid+'\'}})"><img class="shareIcon"  alt="分享" src="'+S+'" />分享</a>'),i.push("<a  onclick=\"addStat('poilistnormal.revision.poirevision');PoiSearchInst.goCorrect(1,'"+t[e].uid+'\');" target="_blank" href="http://i.map.baidu.com/api/page/poicorrect/addpoiproblempc?business_trigger=10&poi_uid='+encodeURIComponent(t[e].uid)+'" class="poi-fav poi-favNext" ><img class="correct_jiu" alt="纠错" src="../../../images/transparent.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/transparent.gif*//>纠错</a>'),i.push("</p>"),i.push("</td>"),i.push("</tr>"),i.push('<tr style="height:5px"><th></th><td style="font-size:0"></td></tr>')},_sendToSMS:function(t,e,i,n,o,s){sms.ready(t,e,i,n,o,s)},_sharePOI:function(t,e){BShare&&BShare._open(t,e)},_initAlert:function(t,e){var i=t[e].ext?t[e].ext.detail_info:{},n=[],o="",s="";switch(t[e].status){case 1:case 2:case 4:case 8:case 10:break;case 5:o="该店即将开业，建议确认后再去 ";break;case 3:case 9:case 11:o="可能已搬迁或关闭，建议确认后再去 "}return s=i&&i.point?"http://tousu.baidu.com/map/add?place="+encodeURIComponent(t[e].name)+"&lat="+encodeURIComponent(i.point.y)+"&lng="+encodeURIComponent(i.point.x)+"#1":"http://tousu.baidu.com/map/add?place="+encodeURIComponent(t[e].name)+"#1",o&&(n.push('<div class="msgBox">'),n.push('<span class="alrt"></span>'),n.push(o),n.push('<a target="_blank" href="'+s+'" >欢迎报错</a>'),n.push("</div>")),n.join("")},_itemOver:function(t,e){t&&this.curSelIndex!=e&&T.ac(t,"focus-over");var i=this,n=i.markers;n[e]&&n[e].isVisible()&&(n[e].setIcon(i._getOverIcon(e)),n[e].setTop(!0,1000100))},_itemOut:function(t,e){t&&this.curSelIndex!=e&&T.rc(t,"focus-over");var i=this,n=i.markers;n[e]&&n[e].isVisible()&&(map.temp.infoWin&&1==map.temp.infoWin.isOpen()&&map.temp.infoWin.overlay===n[e]||(n[e].setIcon(i._getNormIcon(e)),n[e].setTop(!1)))},_getCateInfo:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(t[i][1]),n-1>i&&e.push(", ");return e.join("")},showBusList:function(t){return t.parentNode.style.display="none",t.parentNode.nextSibling.style.display="block",!1},hideBusList:function(t){return t.parentNode.style.display="none",t.parentNode.previousSibling.style.display="block",!1},_showBusLine:function(t,e,i,n,o){var s=this;this._clearBusLine(),this._clearLine(),this._clearArea(),this.curBslUid=t;var a=o?"&bsltp=1":"",r="/?qt=bsl"+a+"&newmap=1&uid="+t+"&c="+s.sCityCode+"&t="+(new Date).getTime();baidu.ajax(r,{dataType:"json",success:function(t){if(t&&(!t||t.content)){var o=t.content[0];o.uid==s.curBslUid&&(s._drawBusLine(o,e,n),i&&"function"==typeof i&&i(t))}},error:function(t,e){console.log("qt=bsl",e)}})},_drawBusLine:function(t,e,i){var n=this,o=util.parseGeo(t.geo);if(o&&2==o.type&&n.busPolylines.push(mapUtil.addRoute(o.points,constant.ROUTE_TYPE_BUS)),t&&(!t||t.stations)){var s=n.curStops=t.stations;n.stationPoints=[],n.busStopPois=[];for(var a=0,r=s.length;r>a;a++)!function(){var e=a,o=util.parseGeo(s[e].geo);if(1==o.type){var r=mapUtil.addBusStopPoi(o.points,s[e].name);n.busStopPois.push(r),r.addEventListener("click",function(){n.selectBusStop(e,t.name,i)}),n.stationPoints.push(util.getPoiPoint(o.points))}}();e&&(window.GRControll.setGRequestFlg(1e3),mapUtil.setViewport(n.stationPoints,10))}},_clearBusLine:function(){if(this.busPolylines){for(var t=0,e=this.busPolylines.length;e>t;t++)mapUtil.removeRoute(this.busPolylines[t]),this.busPolylines[t]=null;this.busPolylines.length=0}for(var t=0;t<this.busStopPois.length;t++)this.busStopPois[t]&&(this.busStopPois[t].remove(),this.busStopPois[t]=null);this.busStopPois.length=0,this.stationPoints.lengtn=0,this.curStopSelIndex=-1,this._setShareSelIndex(this.curSelIndex)},selectBusLine:function(t,e){place.showDetail(e,constant.POI_TYPE_BUSLINE,modelConfig.cityCode)},showBusInfo:function(t,e){var i=this;e=e||{};var n={force:!0,showBLCbk:function(n){if(n&&(!n||n.content)){var o=n.content[0];if(o){var s=T.G("bus_info_"+t);if(s){s.style.display="block";var a=T.G("bus_info_link_"+t);a&&(a.style.display="none");for(var r=["<div class='bus'><table cellspacing='0' cellpadding='0' class='station'>"],l=i.curStops=o.stations,c=(l.length,i.json.content),p=0;p<l.length;p++){var d=l[p];r.push("<tr id='stop_list_"+t+"_"+p+"'>"),r.push("<th style='white-space:nowrap'><img src='../../../images/blank.gif'/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/blank.gif*/ class='list_arrow' />"+(p+1)+"</th>"),r.push("<td><a href='javascript:void(0)' onclick='return SearchInViewInst.selectBusStop("+p+', "'+c[t].name+'", '+t+")'>"+d.name+"</a></td>"),r.push("</tr>")}r.push("</table></div>"),s.innerHTML='<a class="btn_bus_hide" href="javascript:void(0)" onclick="return SearchInViewInst.hideBusInfo(\''+t+"')\">点击站名查看车站位置</a>"+r.join(""),e.sbiCbk&&"function"==typeof e.sbiCbk&&e.sbiCbk()}}}}};for(var o in e)n[o]=e[o];this.select(t,n)},hideBusInfo:function(t){var e=T.G("bus_info_link_"+t);e&&(e.style.display="block");var i=T.G("bus_info_"+t);i&&(i.style.display="none")},_processNoResult:function(t,e,i){{var n=[];this.sCityName}e.no_result_title="<p  class='no_result_title'>在<strong>当前视图区域</strong>内未找到相关地点。";"http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(this.curKw)+"&cl=3";if(place.result)n.push("<div class='nr_suggest'>百度建议您：","<ul><li>拖动或者缩放视图区域；</li>","<li>更改筛选条件；</li>","</ul></div>");else{var o=iKnow.getPromptInfo("想知道: "+this.curKw+"在哪",this.curKw);n.push(o)}return e.result_title="",e.list="",e.page="",e.feedback="",e.no_result=n.join(""),i(e)},selectBusStop:function(t,e,i,n){if(this.curStopSelIndex!=i+"_"+t||this.stationPoints[t]&&!map.getBounds().containsPoint(this.stationPoints[t])){var o=this,s=this.curStops;if(s){var a=(this.json.content,o.busStopPois[t]);map.closeInfoWindow();var r=this.curStopSelIndex;this.curStopSelIndex=i+"_"+t,this._setShareSelIndex(i),s[t]&&(window.GRControll.isClearBeforeSend=!1,searchData.fetch("inf&uid="+s[t].uid+"&c="+o.sCityCode+"&it="+STAT_CODE.STAT_INF_STOP,function(i){if(i){var r=e;i.content&&i.content.addr&&(r=i.content.addr),r=T.array.unique(r.split(";")).join("; "),util.loadSearchInfo(function(e){var l=e.createSearchInfoWnd({title:s[t].name,addr:r,uid:s[t].uid,poiType:i.content.poiType},{forBusLine:!0,cityCode:o.sCityCode,x:o.stationPoints[t].lng,y:o.stationPoints[t].lat});l.addEventListener("close",function(){T.G("stop_list_"+o.curStopSelIndex)&&T.rc(T.G("stop_list_"+o.curStopSelIndex),"selected"),o.curStopSelIndex=-1,o._setShareSelIndex(o.curSelIndex)}),e.openSearchInfoWndPOI(l,a,n)})}}),T.G("stop_list_"+r)&&T.rc(T.G("stop_list_"+r),"selected"),T.G("stop_list_"+this.curStopSelIndex)&&T.ac(T.G("stop_list_"+this.curStopSelIndex),"selected"))}}},_setTop:function(t,e,i){return t&&t.setTop?e&&!t._isTop?(t._isTop=!0,void(i?t.setTop(!0,1000100):t.setTop(!0))):void(e||(delete t._isTop,t.setTop(!1))):void 0},_showSpacePoi:function(t,e){if(t){var i=BMap.MapType[map.mapType].zoomLevelMax-3,n="ext&uid="+t+"&l="+i+"&c="+this.sCityCode+"&wd="+encodeURIComponent(e);searchData.fetch(n,function(t){t&&t.content&&comMgr.load("SpacePoi",{cinfo:{initData:t,poiName:e}})},function(t){console.log("_showSpacePoi",t)})}},_setShareSelIndex:function(t){var e=this.curLineSelIndex,i=this.curStopSelIndex;"undefined"==typeof t&&(t=-1),"undefined"==typeof e?e=-1:(e=this.curLineSelIndex+"",e=e.split("_")&&e.split("_")[1]||-1),"undefined"==typeof i?i=-1:(i=this.curStopSelIndex+"",i=i.split("_")&&i.split("_")[1]||-1);var n="";this.json&&this.json.content&&this.json.content[t]&&(n="|"+this.json.content[t].uid),Share.listIndex=t+"|"+e+"|"+i+n},_processUrlReappear:function(t){if(-1!=t&&this.cinfo._index){var e=this.reIndex[0],i=this.reIndex[1],n=this.reIndex[2],o=this;if(t==constant.POI_TYPE_BUSLINE||t==constant.POI_TYPE_SUBLINE)-1!=n?setTimeout(function(){o.showBusInfo(e,{forReAppear:!0,sbiCbk:function(){o.selectBusStop(n,"",e,{notMove:!0,notZoom:!0})}})},100):setTimeout(function(){o.selectBusStop(n,"",o.curSelIndex,{notMove:!0,notZoom:!0})},100);else if(t==constant.POI_TYPE_BUSSTOP||t==constant.POI_TYPE_SUBSTOP){var s=this.json.content;s[this.curSelIndex]&&s[this.curSelIndex].blinfo[i]&&s[this.curSelIndex].blinfo[i].uid&&(this.selectBusLine(i,s[this.curSelIndex].blinfo[i].uid,this.curSelIndex,!0,function(){-1!=n&&setTimeout(function(){o.selectBusStop(n,"",e,{notMove:!0,notZoom:!0})},100)}),T.G("btn_unfold_bsline_"+this.curSelIndex)&&this.showBusList(T.G("btn_unfold_bsline_"+this.curSelIndex)))}}},_getNormIcon:function(t){var e=this.markers[t].customProperty&&"normal"http://webmap1.map.bdstatic.com/newmap/static/common/widget/com/SearchInView/==this.markers[t].customProperty.type?0:-constant.A_J_MARKER_ORANGE_ICON_Y;return new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_RED_SIZE,{offset:constant.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_RED_ICON_WID*t,e),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET})},_getOverIcon:function(t){return new BMap.Icon(constant.A_J_MARKER_IMG,constant.A_J_MARKER_BLUE_SIZE,{offset:constant.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(-constant.A_J_MARKER_BLUE_ICON_WID*t,-constant.A_J_MARKER_BLUE_ICON_Y),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET})},getBizCount:function(){if(!this.json||!this.json.content)return 0;for(var t=this.json.content,e=0,i=0,n=t.length;n>i;i++)t[i].biz_type&&1==t[i].biz_type&&e++;return e},getNormalNum:function(t){var e=0;return t>1&&(e=(t-1)*this.curItemPPage-this.bizCount),e},bindEvtForAreaFilter:function(){var t=T.g("areaLink");t&&baidu.on(t,"click",function(t){var e=t.target||t.srcElement;if("a"==e.tagName.toLowerCase()){var i=e.innerHTML,n=parseInt(place.area("level"),0);place.area("level",++n>=2?2:n),place.area("bLast")?(place.area("menu").splice(2,1),place.area("menu")[1]=i,place.area("level",1)):place.area("menu")[place.area("level")]=i}})},openPano:function(t,e){var i=this.json,n=(i.result.wd,i.content[t]),o={uid:n.uid,index:e-1,addr:n.addr,from:"list",wd:i.result.wd};PanoInfoUtil.callPano(o)},openIndoorPano:function(t){var e=this.json,i=e.content[t],n={uid:i.uid,from:"list",wd:e.result.wd};PanoInfoUtil.callInnerPano(n)},_setStreetview:function(t){if(PanoUtil.isOpen){var e=this.json,i=e.content[t],n=this;1!=i.pano?require.async("common:widget/ui/PanoMsgBox/PanoMsgBox.js",function(t){n.msgBox=new t({data:{info:"这个地方暂时没有全景哟~",funtype:"no"}}),n.msgBox.show()}):this.openPano(t,t+1)}},setBShareInfo:function(){var t=this;BShare.getMInfo=function(){var e="",i="more",n=(t.curKw,t.curSelIndex,t.json);return n&&n.content&&t.displayCount&&0!=t.displayCount&&(e=t.curKw+"的搜索结果 "),{text:e,type:i,className:t._className}}},setPanoStatus:function(t,e){var i=this.cinfo||{},n=i.isClickNextPage,o=i.isFilter||!1,s="search";this.json.content&&!n&&!o&&"showAllBtn"!==t&&PanoUtil.isPanoStatus()&&PanoUtil.closePano(s,!!e),window.PanoMap&&window.PanoMap.isOpen&&!window.GRControll.isGRequest&&PanoMap.hide()},setWeiPaiTool:function(){var t=window,e=this.json.result;this.isGRequest=1==e.op_gel?!0:!1,this.isGRequest&&this.isMainRequest&&t.weipaiTool&&t.weipaiTool.resetStatus()}}),module.exports=SearchInView});