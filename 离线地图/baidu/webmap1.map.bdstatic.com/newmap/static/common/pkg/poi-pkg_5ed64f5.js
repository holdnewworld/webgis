define("common:widget/ui/genericRequest/GenericRequest.js",function(require,exports,module){function GenRequest(){T.lang.Class.call(this),this.json=null,this.gInfo={},this.qWord="",this.qCity=-1,this.listeners={},this.isGRequest=!1,this.isableGenUIRequest=!0,this.isableGRequestByMapChanged=!0,this.genDataLst={},this.spotId="",this.genDataIdLis=[],this.isableGenMDRequest=!1,this.curTileMapId="",this.mouseOnTileTime=null,this.spotOnId="",this.gssSubmitId="",this.mdLabel1=null,this.mdMarker1=null,this.mdLabel2=null,this.mdMarker2=null,this.toolAreaId="GR_Select",this.GRMapId="",this.areaCity="",this.areaDistrict="",this.GRCircleRadius=1e3,this.isGRCircleShow=!0,this.spotOverUid="",this.isClearBeforeSend=!0,this.queryStr="",this.uiPermit=1e3,this.openedMarker=null,this.curSearchCPt=null,this.types={36:{t:1},37:{t:2},38:{t:1},39:{t:1},40:{t:2}},this.ifShowCustonTip=!1,this.disabledGR=!1,this.initialize()}var util=require("common:widget/ui/util/util.js"),config=require("common:widget/ui/config/config.js"),constant=require("common:widget/ui/constant/Constant.js"),mapInfo=require("common:widget/ui/mapInfo/mapInfo.js"),comMgr=require("common:widget/com/componentManager.js"),fullScreenCtrl=require("common:widget/ui/fullScreen/fullScreen.js"),place=require("common:widget/ui/place/place.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),searchData=require("common:widget/ui/searchData/searchData.js"),Share=require("common:widget/ui/mapShare/MapShare.js"),PanoUtil=require("common:widget/ui/PanoUtil/PanoUtil.js"),modelConfig=config.modelConfig,MapConfig=config.MapConfig,GR_ICON=new BMap.Icon(constant.A_J_MARKER_IMG,new BMap.Size(15,17),{offset:new BMap.Size(7,20),imageOffset:new BMap.Size(-152,-176),infoWindowOffset:new BMap.Size(7,2)});T.extend(GenRequest.prototype,{initialize:function(e){try{for(var t in e)"undefined"!=typeof e[t]&&(this[t]=e[t]);this.clearCache()}catch(n){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:n.message||n.description,path:"common:widget/ui/genericRequest/GenericRequest.js",ln:138})}},setGRData:function(e,t){return this.disabledGR?(this.clearCache(),void this.clearGRMap()):void(e&&(this.json=e,this.gInfo=t||{},this.clearListener(),this.resetStatus()))},resetStatus:function(){var e=this.json.result.type.toString();this.types[e]&&(this.isGRequest=!0,1==this.types[e].t?(this.addGRMap(),this.addMDRequest(),this.addTip()):2==this.types[e].t&&(this.clearGRMap(),this.clearListener()),this.addMDEvent(),this.curSearchCPt=map.centerPoint)},addTip:function(){if(this.ifShowCustonTip){var e=util.getClientSize().width;"open"==mapInfo.status&&(e-=310),this.ifShowCustonTip=!1}},clearBeforeSendAtBase:function(){this.isClearBeforeSend?this.clearListener():this.isClearBeforeSend=!0},clearAfterGetAtBase:function(e){var t={36:"poiSearch",38:"circleSearch",39:"searchInView"},n={18:"busLine",6:"busLineStop",27:"rightClick"},i=e.result.type;if((2!=i||!e.content||0!=e.content.error)&&i&&!t[i]){if(n[i])return;var a=e.result.return_query||"",r=e.result.wd2||"";(this.qWord!=a+"_"+r||this.qCity!=modelConfig.cityCode)&&(this.genDataLst={},this.genDataIdLis=[]),this.qWord="",this.qCity=-1,this.clearGRMap(),this.openedMarker=null}},clearCache:function(){var e=this;e.isableGenUIRequest=!0,e.isableGRequestByMapChanged=!0,e.isGRequest=!1,e.genDataLst={},e.genDataIdLis=[],e.isableGenMDRequest=!1,e.curTileMapId="",e.mouseOnTileTime=null,e.spotOnId="",e.gssSubmitId="",e.spotOverUid="",e.mdLabel1&&e.mdLabel1.hide(),e.mdLabel2&&e.mdLabel2.hide(),e.mdMarker1&&e.mdMarker1.hide(),e.mdMarker2&&e.mdMarker2.hide(),e.clearListener(),""!=e.spotId&&(map.removeSpots(e.spotId),e.spotId="")},checkEventBind:function(e,t,n,i){return e?t[n]&&t[n]==i?!1:(t[n]=i,!0):t[n]&&t[n]==i?(t[n]="",delete t[n],!0):!1},clearListener:function(e){var t=this;e&&"md"!=e||(t.checkEventBind(!1,t.listeners,"map_mousemove","addMouseOnMDEvent")&&setTimeout(function(){map.removeEventListener("mousemove",t.addMouseOnMDEvent)},0),t.checkEventBind(!1,t.listeners,"map_spotmouseover","spotMouseOverMD")&&setTimeout(function(){map.removeEventListener("spotmouseover",t.spotMouseOverMD)},5),t.checkEventBind(!1,t.listeners,"map_spotmouseout","spotMouseOutMD2")&&setTimeout(function(){map.removeEventListener("spotmouseout",t.spotMouseOutMD2)},10)),e&&"ui"!=e||(t.checkEventBind(!1,t.listeners,"map_load","bindGenResLoad")&&map.removeEventListener("load",t.bindGenResLoad),t.checkEventBind(!1,t.listeners,"map_moveend","bindGenResMove")&&map.removeEventListener("moveend",t.bindGenResMove),t.checkEventBind(!1,t.listeners,"map_zoomend","bindGenResZoom")&&map.removeEventListener("zoomend",t.bindGenResZoom),t.checkEventBind(!1,t.listeners,"map_mapcontainerresize","bindGenResResize")&&map.removeEventListener("mapcontainerresize",t.bindGenResResize))},clearGRMap:function(){if(""!=this.GRMapId){var e=map.getTileLayer(this.GRMapId);e&&(map.removeTileLayer(e),this.GRMapId="",this.qWord="",this.qCity=-1,this.genDataLst={},this.genDataIdLis=[])}},addGRMap:function(){var e=this;if(e.json){var t=e.json.result.return_query||"",n=e.json.result.wd2||"";if(e._getPlaceParam||(e._getPlaceParam=function(t){var n=t.place_info,i=!1;if(n)for(var a in n)/_section$/.test(a)&&n[a]!=e._getPlaceParam[a]&&(e._getPlaceParam[a]=n[a],i=!0);return i}),e.qWord!=t+"_"+n||e.qCity!=modelConfig.cityCode||window.place&&place.result&&e._getPlaceParam(e.json)){if(e.clearGRMap(),38==e.json.result.type&&map.zoomLevel<11)return;e.qWord=t+"_"+n,e.qCity=modelConfig.cityCode;var i=new BMap.Bounds(-21364736,-10616832,23855104,15859712),a=new BMap.Copyright(i),r=!1,o=new BMap.TileLayer({copyright:a,transparentPng:r,requestMonitor:!0,monitorOpts:{seed:.02,name:"md"}});o.zIndex=1,o.getTilesUrl=function(t,n){var i=BMap.MapType[this.getMapType()];if("object"!=typeof i)return null;var a=i.baseUnits*Math.pow(2,18-n),o=parseInt(t.lng/a),s=parseInt(t.lat/a),d="",m=["http://gss0.map.baidu.com/","http://gss1.map.baidu.com/","http://gss2.map.baidu.com/","http://gss3.map.baidu.com/"],l=Math.abs(o+s)%m.length;d=modelConfig.DATA_URL+"bkg_png&c="+modelConfig.cityCode+"&ie=utf-8",window.place&&(d+=place.urlArr?"&wd="+encodeURIComponent(e.json.result.return_query)+place.urlArr:"&wd="+encodeURIComponent(e.json.result.return_query)),e.json.result.wd2&&(d+="&wd_h="+encodeURIComponent(e.json.result.wd2));var u=map.getBounds(),p=Math.min(u.minX,u.maxX),c=Math.max(u.minX,u.maxX),h=Math.min(u.minY,u.maxY),f=Math.max(u.minY,u.maxY),M=escape("(")+p+","+h+";"+c+","+f+escape(")");return d+="&l="+n+"&xy="+o+"_"+s+"&b="+M+"&t="+(new Date).getTime(),r&&T.browser.ie>5&&T.browser.ie<7&&(d=encodeURIComponent(d)),d=m[l]+d},map.addTileLayer(o),e.GRMapId=o.getMapType()}}},addMDRequest:function(){var me=this;me.addMouseOnMDEvent||(me.addMouseOnMDEvent=function(e){var t=map.getTileId(e.point,map.getZoom());if(t.row&&t.column&&t.level){var n=t.level+"_"+t.row+"_"+t.column;if(me.curTileMapId=n,me.genDataLst[n]){if(me.spotOnId!=n){""!=me.spotId&&map.removeSpots(me.spotId),me.spotId=map.addSpots(me.genDataLst[n]),me.spotOnId=n;for(var i=-1,a=0,r=me.genDataIdLis.length;r>a;a++)if(n==me.genDataIdLis[a]){i=a;break}i>=0&&(me.genDataIdLis.splice(i,i),me.genDataIdLis.push(n))}}else if(me.json.result.return_query&&me.gssSubmitId!=t.level+"_"+t.row+"_"+t.column){me.gssSubmitId=t.level+"_"+t.row+"_"+t.column;var o=[];o.push("http://gss3.map.baidu.com/"+modelConfig.DATA_URL),window.place&&o.push(place.urlArr?"bkg_data&c="+modelConfig.cityCode+"&ie=utf-8&wd="+encodeURIComponent(me.json.result.return_query)+place.urlArr:"bkg_data&c="+modelConfig.cityCode+"&ie=utf-8&wd="+encodeURIComponent(me.json.result.return_query)),me.json.result.wd2&&o.push("&wd_h="+encodeURIComponent(me.json.result.wd2));var s=map.getBounds(),d="("+s.minX+","+s.minY+";"+s.maxX+","+s.maxY+")";o.push("&l="+map.zoomLevel+"&xy="+t.row+"_"+t.column+"&b="+d),T.jsonp(o.join(""),function(e,t){e&&(t.slow?ErrorMonitor("md_data","req_slow"+t.slow,o,.02,{xhr:t,url:o,type:"slow"}):ErrorMonitor("md_data","succ",o,.02,{xhr:t,url:o,type:"succ"}),window.GRControll.getGRData(e))},{error:function(e){ErrorMonitor("md_data","req_fail","",.02,{type:"fail",url:o,xhr:e})}}),ErrorMonitor("md_data","BASE","",.02)}}}),me.spotMouseOverMD||(me.spotMouseOverMD=function(e){if(!PanoUtil.isPanoStatus()){var spotArr=e.spots;if(spotArr&&!(spotArr.length<1)&&spotArr[0].tag&&"GR_DATA"==spotArr[0].tag){if(me.json&&me.json.content)for(var i=0,n=me.json.content.length;n>i;i++)for(var j=0,nn=spotArr.length;nn>j;j++)if(spotArr[j].userdata.uid==me.json.content[i].uid)return;var tempMarker=null,tempLabel=null,mindex=0;me.onMarker&&me.onMarker===me.mdMarker1?(tempMarker=me.mdMarker2,tempLabel=me.mdLabel2,mindex=2):(tempMarker=me.mdMarker1,tempLabel=me.mdLabel1,mindex=1),tempMarker&&tempMarker.map?(tempMarker.hide(),tempMarker.setPoint(spotArr[0].pt),tempMarker.show(),me.spotOverUid=spotArr[0].userdata.uid):(tempMarker=new BMap.Marker(spotArr[0].pt,{icon:GR_ICON,zIndexFixed:!0,baseZIndex:3e6}),me.spotOverUid=spotArr[0].userdata.uid,map.addOverlay(tempMarker),eval("me.mdMarker"+mindex+" = tempMarker"),tempMarker.addEventListener("click",me.spotClickMD),tempMarker.addEventListener("mouseout",me.spotMouseOutMD));for(var laStr=[],i=0,n=spotArr.length;n>i;i++)laStr.push(spotArr[i].userdata.name);tempLabel&&tempLabel.map?(tempMarker.getLabel()||tempMarker.setLabel(tempLabel),tempLabel.hide(),tempLabel.setContent(laStr.join("<br />")),tempLabel.show()):(tempLabel=new BMap.Label(laStr.join("<br />"),{offset:new BMap.Size(10,-24)}),tempMarker.setLabel(tempLabel),eval("me.mdLabel"+mindex+" = tempLabel"),tempLabel.setStyle({backgroundColor:"#FFFFD5",borderColor:"#808080"}))}}}),me.spotMouseOutMD||(me.spotMouseOutMD=function(){if(!PanoUtil.isPanoStatus()&&(me.mdLabel1&&me.mdLabel1.hide(),me.mdLabel2&&me.mdLabel2.hide(),me.onMarker!==this))if(map.temp.infoWin&&1==map.temp.infoWin.isOpen()){if(map.temp.infoWin.overlay===this)return;this.hide()}else this.hide(),me.spotOverUid=""}),me.spotMouseOutMD2||(me.spotMouseOutMD2=function(){if(!PanoUtil.isPanoStatus()){var e=me.mdMarker2;if(e&&e.map&&(!map.temp.infoWin||0==map.temp.infoWin.isOpen()||map.temp.infoWin.overlay!==e)){if(me.onMarker&&me.onMarker===e)return;e.hide()}if(e=me.mdMarker1,e&&e.map&&(!map.temp.infoWin||0==map.temp.infoWin.isOpen()||map.temp.infoWin.overlay!==e)){if(me.onMarker&&me.onMarker===e)return;e.hide()}}}),me.spotClickMD||(me.spotClickMD=function(){PanoUtil.isPanoStatus()||""!=me.spotOverUid&&(map.temp.infoWin&&map.temp.infoWin.close(),me.onMarker=this,util.loadSearchInfo(function(e){me.sendInfoRequest(me.spotOverUid,e)}),addStat(STAT_CODE.STAT_GR_MARKER_CLICK,{uid:me.spotOverUid,ct:"spot"}))}),setTimeout(function(){me.checkEventBind(!0,me.listeners,"map_mousemove","addMouseOnMDEvent")&&map.addEventListener("mousemove",me.addMouseOnMDEvent)},10),setTimeout(function(){me.checkEventBind(!0,me.listeners,"map_spotmouseover","spotMouseOverMD")&&map.addEventListener("spotmouseover",me.spotMouseOverMD)},20),setTimeout(function(){me.checkEventBind(!0,me.listeners,"map_spotmouseout","spotMouseOutMD2")&&map.addEventListener("spotmouseout",me.spotMouseOutMD2)},30)},sendInfoRequest:function(e,t){if(e){var n=this;Share.listIndex="uid,"+e;var i="inf&uid="+e+"&ie=utf-8&t="+(new Date).getTime();searchData.fetch(i,function(e){var i=e.content,a=util.getPointByStr(util.parseGeo(i.geo).points);if(!r)var r={};var o=i.addr;(i.poiType==constant.POI_TYPE_BUSSTOP||i.poiType==constant.POI_TYPE_SUBSTOP)&&(o=T.array.unique(o.split(";")).join("; "));var s=i.tel;s&&(s=s.replace(/,/g,", "));var d=n._getCateInfo(i.cla),m={};i.ext&&i.ext.detail_info&&i.ext.detail_info.origin_id&&(m=i.ext.detail_info.origin_id);var l=t.createSearchInfoWnd({title:i.name,addr:o,tel:s,uid:i.uid,cate:d,ext_type:i.ext_type,detail:i.detail,poiType:i.poiType,hasDetail:i.detail&&i.ty==constant.GEO_TYPE_POINT||i.poiType==constant.POI_TYPE_BUSLINE||i.poiType==constant.POI_TYPE_SUBLINE,ext:i.ext,cp:i.cp,cla:i.cla,origin_id:m,pano:i.pano||0,indoor_pano:i.indoor_pano||0,catId:i.new_catalog_id},{cityCode:n.sCityCode,x:a.lng,y:a.lat});if(l){if(n.openedMarker={uid:i.uid,geo:i.geo,name:i.name},l.addEventListener("open",function(){window.spotInfoWnd=!0,n.setGRequestFlg(1500),l.closeButton&&T.on(l.closeButton,"click",function(){map.temp.infoWin.overlay&&map.temp.infoWin.overlay.hide(),n.onMarker=null,n.openedMarker=null,T.un(l.closeButton,"click",arguments.callee)}),l.removeEventListener("open",arguments.callee)}),l.addEventListener("close",function(){window.spotInfoWnd=!1,n.mdLabel1&&n.mdLabel1.hide(),n.mdLabel2&&n.mdLabel2.hide(),map.temp.infoWin.overlay&&map.temp.infoWin.overlay.hide(),Share.listIndex="",n.onMarker=null,n.openedMarker=null,l.removeEventListener("close",arguments.callee)}),n.onMarker)r.from="gr",t.openSearchInfoWnd(l,n.onMarker,r);else if(!n.mdMarker1){var u=util.getPointByStr(util.parseGeo(i.geo).points);n.mdMarker1=new BMap.Marker(u,{icon:GR_ICON,zIndexFixed:!0}),map.addOverlay(n.mdMarker1),n.mdMarker1.addEventListener("click",n.spotClickMD),n.mdMarker1.addEventListener("mouseout",n.spotMouseOutMD),t.openSearchInfoWnd(l,n.mdMarker1,r)}n.mdLabel1&&n.mdLabel1.hide(),n.mdLabel2&&n.mdLabel2.hide()}})}},setGRequestFlg:function(e){var t=this;t.isableGRequestByMapChanged=!1,setTimeout(function(){t.isableGRequestByMapChanged=!0},e)},ifChangeMap:function(){if(!this.json)return{f:0};if(1==this.json.result.op_gel){var e=new BMap.Point(this.json.result.res_x,this.json.result.res_y);return{f:1,p:e,l:this.json.result.res_l}}return{f:2}},getGRData:function(e){if(e&&!(e.err_no<0)){for(var t=[],n=0,i=e.uids.length;i>n;n++)t.push({pt:new BMap.Point(e.uids[n].x,e.uids[n].y),bd:[-7,0,7,17],userdata:{name:e.uids[n].name,uid:e.uids[n].uid},tag:"GR_DATA"});var a=e.tileid;if(this.genDataLst[a]=t,this.genDataIdLis.push(a),this.genDataIdLis.length>30){var r=this.genDataIdLis.shift();delete this.genDataLst[r],delete r}this.spotOnId!=this.curTileMapId&&(""!=this.spotId&&map.removeSpots(this.spotId),this.genDataLst[this.curTileMapId]&&(this.spotId=map.addSpots(this.genDataLst[this.curTileMapId]),this.spotOnId=this.curTileMapId))}},hideMarkerByIW:function(){var e=this,t=!1;t=map.temp.infoWin&&1==map.temp.infoWin.isOpen(),t&&map.temp.infoWin.overlay===e.mdMarker1?(e.mdLabel2&&e.mdLabel2.hide(),e.mdMarker2&&e.mdMarker2.hide()):t&&map.temp.infoWin.overlay===e.mdMarker2?(e.mdLabel1&&e.mdLabel1.hide(),e.mdMarker1&&e.mdMarker1.hide()):(e.mdLabel1&&e.mdLabel1.hide(),e.mdLabel2&&e.mdLabel2.hide(),e.mdMarker1&&e.mdMarker1.hide(),e.mdMarker2&&e.mdMarker2.hide())},checkMove:function(){var e=this;if(!e.curSearchCPt||mapInfo&&mapInfo.isGoing||fullScreenCtrl&&fullScreenCtrl.isGoing)return!1;var t=map.pointToPixel(e.curSearchCPt),n=map.pointToPixel(map.centerPoint),i=Math.abs(t.x-n.x),a=Math.abs(t.y-n.y);return i>=.2*map.width||a>=.2*map.height?!0:!1},addMDEvent:function(){var e=this;e.clearListener(),e.bindGenResLoad||(e.bindGenResLoad=function(){e.hideMarkerByIW(),e.sendGenRequest()}),e.bindGenResDrag||(e.bindGenResDrag=function(){1==e.checkMove()&&e.sendGenRequest("&gr=2")}),e.bindGenResMove||(e.bindGenResMove=function(){1==e.checkMove()&&e.sendGenRequest("&gr=2")}),e.bindGenResZoom||(e.bindGenResZoom=function(){e.hideMarkerByIW(),e.sendGenRequest("&gr=1")}),e.bindGenResResize||(e.bindGenResResize=function(){e.mdLabel&&e.mdLabel.hide(),e.mdMarker&&e.mdMarker.hide(),e.sendGenRequest()}),e.checkEventBind(!0,e.listeners,"map_load","bindGenResLoad")&&map.addEventListener("load",e.bindGenResLoad),e.checkEventBind(!0,e.listeners,"map_moveend","bindGenResMove")&&map.addEventListener("moveend",e.bindGenResMove),e.checkEventBind(!0,e.listeners,"map_zoomend","bindGenResZoom")&&map.addEventListener("zoomend",e.bindGenResZoom),e.checkEventBind(!0,e.listeners,"map_mapcontainerresize","bindGenResResize")&&map.addEventListener("mapcontainerresize",e.bindGenResResize)},sendGenRequest:function(e){var t=this,n=window;if(t.curSearchCPt=map.centerPoint,t.json){if(38==t.json.result.type&&map.zoomLevel<11)return t.clearListener("md"),t.clearGRMap(),void(n.PoiSearchInst&&(n.PoiSearchInst.clearMarkersInPoi("a"),n.PoiSearchInst.clearArea()));if(t.isableGenUIRequest&&t.isableGRequestByMapChanged){t.mdLabel&&t.mdLabel.hide(),t.mdMarker&&t.mdMarker.hide();t.clearListener(),e||(e="");var i=t.json.result.return_query,a="&c="+modelConfig.cityCode+"&wd="+encodeURIComponent(i)+"&da_src=pcmappg.map&on_gel=1&l="+map.zoomLevel+e;t.json.result.wd2&&(a+="&wd2="+t.json.result.wd2);var r=map.getBounds();switch(a+="&b=("+r.minX+","+r.minY+";"+r.maxX+","+r.maxY+")",t.isableGenUIRequest=!1,t.json.result.type){case 36:n.PoiSearchInst&&(n.PoiSearchInst.clearMarkersInPoi(),n.PoiSearchInst.clearArea()),setTimeout(function(){t.isableGenUIRequest=!0},t.uiPermit),n.place&&(t.queryStr=place.urlArr?"s"+a+place.urlArr:"s"+a),n.currentComponent.modelQuery=t.queryStr,comMgr.go(t.queryStr,{dom:T.G("MapInfo"),cinfo:{genRequestKey:e},isMainRequest:"no"});break;case 37:n.clearClarify&&clearClarify(),setTimeout(function(){t.isableGenUIRequest=!0},t.uiPermit),t.queryStr="s"+a,comMgr.go(t.queryStr,{dom:T.G("MapInfo"),isMainRequest:"no"});break;case 38:var o="";if(n.PoiSearchInst&&(n.PoiSearchInst.clearMarkersInPoi(),n.PoiSearchInst.clearArea()),t.json.center&&t.json.center.poi){o+="&uid="+t.json.center.poi[0].uid;var s=util.getPointByStr(util.parseGeo(t.json.center.poi[0].geo).points);o+="&nb_x="+s.lng,o+="&nb_y="+s.lat}else t.gInfo.cinfo.centerPoint&&(o+="&nb_x="+t.gInfo.cinfo.centerPoint.lng,o+="&nb_y="+t.gInfo.cinfo.centerPoint.lat);t.GRCircleRadius&&(o+="&gr_radius="+t.GRCircleRadius),setTimeout(function(){t.isableGenUIRequest=!0},t.uiPermit),n.currentComponent.modelQuery="nb"+a+o,place.urlArr?t.gInfo.cinfo?comMgr.go("nb"+a+place.urlArr+o,{dom:T.G("MapInfo"),cinfo:t.gInfo.cinfo,isMainRequest:"no"}):comMgr.go("nb"+a+place.urlArr+o,{dom:T.G("MapInfo"),isMainRequest:"no"}):t.gInfo.cinfo?comMgr.go("nb"+a+o,{dom:T.G("MapInfo"),cinfo:t.gInfo.cinfo,isMainRequest:"no"}):comMgr.go("nb"+a+o,{dom:T.G("MapInfo"),isMainRequest:"no"});break;case 39:n.SearchInViewInst&&n.SearchInViewInst.clearMarkersInSiv(),setTimeout(function(){t.isableGenUIRequest=!0},t.uiPermit),n.currentComponent.modelQuery="bd"+a,place.urlArr?comMgr.go("bd"+a+place.urlArr,{dom:T.G("MapInfo"),cinfo:{genRequestKey:e},isMainRequest:"no"}):comMgr.go("bd"+a,{dom:T.G("MapInfo"),cinfo:{genRequestKey:e},isMainRequest:"no"});break;case 40:n.searchInViewCtrl&&n.searchInViewCtrl.clear(),setTimeout(function(){t.isableGenUIRequest=!0},t.uiPermit),comMgr.go("bd"+a,{dom:T.G("MapInfo"),isMainRequest:"no"})}}}},_getCateInfo:function(e){for(var t=[],n=0,i=e.length;i>n;n++)t.push(e[n][1]),i-1>n&&t.push(", ");return t.join("")},getDataForSnap:function(){if(this.isGRequest&&this.json){var e=this.json.result.return_query||"",t=this.json.result.wd2||"",n="bkg_png",i=modelConfig.cityCode;return{wd:e,wd2:t,qt:n,c:i}}return!1}}),module.exports=GenRequest});
;define("common:widget/ui/NbSearch/NbSearch.js",function(e,o,n){var t=e("common:widget/ui/constant/Constant.js"),a=e("common:widget/ui/config/config.js"),i=(a.mapConfig,e("common:widget/ui/mapUtil/mapUtil.js")),m=function(){var o,n,a,m,r={};return r.show=function(e){function r(e){T.on(document,"onmousemove",p),T.on(document,"onmouseup",s);var o=e.clientX||e.x,n=map.pointToPixel(a.getPoint());f=o-n.x,g=!0}function p(e){var t=(e.clientX||e.x)-f,i=new BMap.Pixel(t,map.pointToPixel(a.getPoint()).y),r=Math.floor(map.getDistance(map.pixelToPoint(i),n.getPoint()));500>r?r=500:r>5e3?r=5e3:a.setPoint(map.pixelToPoint(i)),GRControll.GRCircleRadius=r,o.setRadius(r),m.setContent(GRControll.GRCircleRadius+"m")}function s(){g=!1,a&&a.iconDom&&(a.iconDom.children[0].style.left="0px"),T.un(document,"onmousemove",p),T.un(document,"onmouseup",s),i.setViewport([new BMap.Point(o.getBounds().minX,o.getBounds().minY),new BMap.Point(o.getBounds().maxX,o.getBounds().maxY)],-50)}this.loadCss(),o&&(map.removeOverlay(o),map.removeOverlay(n),map.removeOverlay(a),map.removeOverlay(m)),o=new BMap.Circle(e,GRControll.GRCircleRadius,{strokeColor:"#a3b1cc",fillColor:"#4673cc",strokeOpacity:.9,fillOpacity:.2,strokeWeight:1}),map.addOverlay(o);var c={offset:t.A_J_MARKER_OFFSET,imageOffset:new BMap.Size(-200,0),infoWindowOffset:t.A_J_MARKER_INFOWND_OFFSET},l=new BMap.Icon("../images/bgs_6dbfd12.gif"/*tpa=http://webmap1.map.bdstatic.com/newmap/static/common/images/bgs_6dbfd12.gif*/,t.A_J_MARKER_RED_SIZE,c);n=new BMap.Marker(e,{icon:l,baseZIndex:25e5});var d=o.getBounds();e=new BMap.Point(d.maxX,.5*(d.minY+d.maxY));var u=map.pointToPixel(e);a=new BMap.Marker(map.pixelToPoint(u),{icon:new BMap.Icon("../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/nbsearch_366e590.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/nbsearch_366e590.png*/,new BMap.Size(31,19),{offset:new BMap.Size(16,14),imageOffset:new BMap.Size(0,0),infoWindowOffset:t.A_J_MARKER_INFOWND_OFFSET}),baseZIndex:25e6}),a.addEventListener("mouseover",function(e){e.target.iconDom.children[0].style.left="-88px"}),a.addEventListener("mouseout",function(e){!g&&e.target.iconDom&&(e.target.iconDom.children[0].style.left="0px")}),m=new BMap.Label("a",{offset:new BMap.Size(30,0)}),m.setStyle({zIndex:20020,background:"url(http://webmap0.map.bdstatic.com/newmap/static/common/images/nbsearch_366e590.png) -31px 0",border:"none",height:"20px",color:"black",textIndent:"5px",textAlign:"center",zoom:1,width:"56px",lineHeight:"20px",padding:"0"}),m.setContent(GRControll.GRCircleRadius+"m"),a.setLabel(m),map.addOverlay(a),map.addOverlay(n),T(m.getDom()).attr("tid","nbHandleLabel");var f,g=!1;a.addEventListener("mousedown",r)},r.hide=function(){map.removeOverlay(o),map.removeOverlay(n),map.removeOverlay(a),map.removeOverlay(m)},r.loadCss=function(){var o=".nb_dis{float:right;margin-right:4px;display:block;*position:absolute;*right:80px}";e.loadCss({content:o,name:"NbSearch"})},r}();n.exports=m});
;define("common:widget/ui/page/Page.js",function(a,e,t){function i(a,e,t){if(T.lang.Class.call(this),a){this.container="object"==typeof a?a:T.g(a),this.page=1,this.pageCount=100,this.argName="pg",this.pagecap=4,this.callback=e,this.update=!0;var i={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:!0};t||(t=i);for(var s in t)"undefined"!=typeof t[s]&&(this[s]=t[s]);this.render()}}T.extend(i.prototype,{render:function(){try{var e='.page{font-family:"宋体";text-align:center;line-height:12px;font-size:13px}.page a{display:inline-block;border:#e7ecf0 solid 1px;padding:5px 6px 3px;text-decoration:none}.page a:hover{background:#e8f1f6}.page span{display:inline-block;margin:0 2px}.page span.curPage{padding:4px 5px;font-weight:700}.page a.next-none{cursor:default;color:#949494}.page a.next-none:hover{background:#fff}';a.loadCss({content:e,name:"page"}),this.initialize()}catch(t){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:t.message||t.description,path:"common:widget/ui/page/Page.js",ln:49})}},initialize:function(){try{this.checkPages(),this.container.innerHTML=this.createHtml()}catch(a){"undefined"!=typeof alog&&alog("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/exception.fire","catch",{msg:a.message||a.description,path:"common:widget/ui/page/Page.js",ln:57})}},checkPages:function(){isNaN(parseInt(this.page))&&(this.page=1),isNaN(parseInt(this.pageCount))&&(this.pageCount=1),this.page<1&&(this.page=1),this.pageCount<1&&(this.pageCount=1),this.page>this.pageCount&&(this.page=this.pageCount),this.page=parseInt(this.page),this.pageCount=parseInt(this.pageCount)},getPage:function(){{var a=location.search,e=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");a.match(e)}this.page=RegExp.$1},createHtml:function(){var a=[],e=this.page-1,t=this.page+1;if(a.push('<p class="page">'),1>e||(this.page>=this.pagecap&&a.push('<span><a href="javascript:void(0)" tid="toFirstPage" onclick="Instance(\''+this.guid+"').toPage(1);return false;\">首页</a></span>"),a.push('<span><a href="javascript:void(0)" tid="toPrevPage" onclick="Instance(\''+this.guid+"').toPage("+e+');return false;"><上一页</a></span>')),this.page<this.pagecap){if(this.page%this.pagecap==0)var i=this.page-this.pagecap-1;else var i=this.page-this.page%this.pagecap+1;var s=i+this.pagecap-1}else{var p=Math.floor(this.pagecap/2),n=this.pagecap%2-1;if(this.pageCount>this.page+p)var s=this.page+p,i=this.page-p-n;else var s=this.pageCount,i=this.page-p-n}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap)var i=this.pageCount-this.pagecap+1,s=this.pageCount;for(var g=i;s>=g;g++)if(g>0)if(g==this.page)a.push('<span class="curPage">'+g+"</span>");else if(g>=1&&g<=this.pageCount){var h="";2==g&&(h="tid=secPageNum"),a.push('<span><a href="javascript:void(0)" '+h+" onclick=\"Instance('"+this.guid+"').toPage("+g+');return false;">'+g+"</a></span>")}return a.push(t>this.pageCount?'<span><a href="javascript:void(0)" tid="toNextPage" class="next next-none">下一页&gt;</a></span>':'<span><a href="javascript:void(0)" tid="toNextPage" onclick="Instance(\''+this.guid+"').toPage("+t+');return false;">下一页></a></span>'),a.push("</p>"),a.join("")},toPage:function(a){var e=a?a:1;"function"==typeof this.callback&&(this.callback(e),this.page=e),this.update&&this.render()}}),t.exports=i});
;define("common:widget/ui/iKnow/iKnow.js",function(n,t,o){var e=n("common:widget/ui/config/config.js"),i=e.modelConfig,a={IknowBtnOver:function(n){n.style.backgroundPosition="left center"},IknowBtnOut:function(n){n.style.backgroundPosition="left top"},IknowBtnDown:function(n){n.style.backgroundPosition="left bottom"},IknowBtnUp:function(n){n.style.backgroundPosition="left center"},getIknowCode:function(n){return n=baidu.string.filterFormat.escapeString(n),['<div class="nr_know"><p>您可以在知道提问，让其他网友帮您解决问题：</p>','<form name="IknowForm" action="http://zhidao.baidu.com/q" method="get" target="_blank">','<p class="nr_pi"><input type="text" name="word" value="'+n+'" /></p>','<div class="IknownBtn" onmouseover="IknowInst.IknowBtnOver(this)" onmouseout="IknowInst.IknowBtnOut(this)" onmousedown="IknowInst.IknowBtnDown(this)" onmouseup="IknowInst.IknowBtnUp(this)" onclick="IknowForm.submit()">我要提问</div>','<input type="hidden" name="ct" value="17" />','<input type="hidden" name="tn" value="ikask" />','<input type="hidden" name="cm" value="1" />','<input type="hidden" name="lm" value="394496" />','<input type="hidden" name="pn" value="0" />','<input type="hidden" name="rn" value="10" />','<input type="hidden" name="fr" value="map" /></form></div>'].join("")},getPromptInfo:function(n,t){var o="http://zhidao.baidu.com/new?word=#{word}&ct=#{ct}&tn=#{tn}&cm=#{cm}&lm=#{lm}&pn=#{pn}&rn=#{rn}&fr=#{fr}",e={word:n,ct:17,tn:"ikask",cm:1,lm:394496,pn:0,rn:10,fr:"map"},a="http://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(t)+"&cl=3",r=[],u=(i&&i.cityName?i.cityName:"全国",{city_id:i.cityCode||1,business_trigger:7,poi_name:t});return r.push("<div class='nr_suggest'>","<p class='sg_title'>您还可以：</p>","<ul>","<li>检查输入是否正确或者输入其它词</li>","<li>在百度网页中查找“<a href='"+a+"' target='_blank'>"+t+"</a>”</li>","<li>在百度知道<a href='"+baidu.string.format(o,e)+"' target='_blank'>提问</a>让其他网友帮您解决</li>","<li>在百度地图<a href='http://i.map.baidu.com/api/page/poicorrect/addpoipc?"+baidu.url.jsonToQuery(u,encodeURIComponent)+"' target='_blank'>添加该地点</a></li>","</ul>","</div>"),r.join("")}};o.exports=a,window.IknowInst=a});
;define("common:widget/ui/PanoEntranceUtil/PanoEntranceUtil.js",function(t,e,a){var n=t("common:widget/ui/util/util.js"),i=t("common:widget/ui/config/config.js"),o=t("common:widget/ui/indexUtil/IndexUtil.js"),r=t("common:widget/ui/PanoUtil/PanoUtil.js"),d=(t("common:widget/ui/PanoInfoUtil/PanoInfoUtil.js"),t("common:widget/pano/PanoInterface/PanoInterface.js")),s=(t("common:widget/pano/base/service.js"),i.urlConfig),p=i.mapVersion,u=window.Pano=window.Pano||{},l={insertPanoInfoInSearch:function(t,e,a){if(!o.isSupportStreetView())return a(null),void this.dispatchEvent("onSearchPanoDataReady",{data:null});for(var n=[],r=0,d=t.length;d>r;r++)n.push(t[r].uid||t[r].mercatorLnglat);var u=this,l="udt="+p.UDT_VERSION+"&qt=batchdata&from="+e+"&key="+n.join("|");baidu.ajax("/?qt=panobatch",{method:"post",dataType:"json",data:l,success:function(e){for(var n=e||{},i=n.content||[],o=[],r=null,d=null,l=!0,c=0,h=i.length;h>c;c++){r=i[c]||{},d=t[c],r.PID&&l&&(l=!1);var m="";if(m=d.name?d.name:r.name,d.mercatorLnglat){var f=d.mercatorLnglat.split(",");r.Dir||(r.Dir=90-180*Math.atan2(f[1]-r.PanoY,f[0]-r.PanoX)/Math.PI),r.Dir<0&&(r.Dir+=360)}else f=[0,0];var g=0;g=d.direction&&0!=c&&c!=h-1?d.direction:r.Dir;var v=s.PANO_URL;v=r.UID?s.PANO_URL+"/pr/?qt=poiprv&uid="+r.UID+"&width=100&height=75&quality=80&fovx=80&udt="+p.UDT_VERSION:s.PANO_URL+"/pr/?qt=prv&panoid="+r.PID+"&width=100&height=75&quality=80&fovx=80&heading="+g+"&udt="+p.UDT_VERSION;var b={panoId:r.PID||"",uid:r.UID||"",panoMarker:{addr:r.name||"",poiuid:r.UID||"",pid:r.PID||"",catalog:d.poiType||"",name:m,rank:r.Rank||0,heading:g,pitch:r.Pitch||0,x:r.X||f[0],y:r.Y||f[1],px:r.PanoX||f[0],py:r.PanoY||f[1],index:d.index||-1},panoThumbnailUrl:v};o.push(b)}l&&(o=null),a(o),u.dispatchEvent("onSearchPanoDataReady",{data:o})},error:function(t){console.log("panopatch",t)}}),addStat(STAT_CODE.STAT_STREETVIEW,{cityCode:i.modelConfig.cityCode,catalog:e,item:"panobatch"})},showStreetViewPreview:function(t,e,a,i){var o=this,r=T(".list_street_view_preview"),d=e.getAttribute("data-thumbnail"),s={buslineUid:e.getAttribute("data-buslineUid"),panoId:e.getAttribute("data-pid"),uid:e.getAttribute("data-uid"),panoMarker:{addr:e.getAttribute("data-paddr"),px:e.getAttribute("data-px"),py:e.getAttribute("data-py"),name:e.getAttribute("data-pname"),heading:e.getAttribute("data-pheading")},hasRouteVideo:i},p=e.getAttribute("data-pfrom");t?this.timeoutId=setTimeout(function(){var e=n.getClientSize().height-t.top<150;r.length?(r.css({left:t.left-1,top:t.top}),r.find("img").attr("src",d),r.off("click"),r.on("click",function(){o.enterPanorama(s,a,"search",p)}),r.show()):(r=T('<div style="left:'+(t.left-1)+"px;top:"+t.top+'px" class="list_street_view_preview"><img src="'+d+'" onerror="Pano.PanoEntranceUtil.thumbnailNotFound(this, 100, 75);" width="100" height="75" /><div class="list_street_view_preview_icon_box"><div class="list_street_view_preview_icon"></div></div></div>'),T("body").append(r),r.on("mouseleave",function(){r.hide()}),r.on("click",function(){o.enterPanorama(s,a,"search",p)})),e?(r.addClass("bottom"),r.css({top:t.top-53})):r.removeClass("bottom")},200):o.enterPanorama(s,a,"routeVideo_button",p)},thumbnailNotFound:function(t){t.src="../../../../../webmap0.map.bdstatic.com/newmap/static/common/images/panorama/2d_default_aspect_ratio_3_d58ce0c.png"/*tpa=http://webmap0.map.bdstatic.com/newmap/static/common/images/panorama/2d_default_aspect_ratio_3_d58ce0c.png*/},walkThroughPanoEntrances:function(t,e,a,n,i){var o,r=this;if(e&&0!=e.length){T(".closeWalkInfo").css({"margin-top":0});for(var d=0;d<t.length;d++)o=e[d],this.setPanoPreviewDomAttribute(t[d],o,a);t.off("mouseleave"),t.off("mouseenter"),t.on("mouseenter",function(){var t=T(this),a=t.offset().left+22;r.showStreetViewPreview({left:a,top:t.offset().top-6},this,n||e,i)}),t.on("mouseleave",function(){clearTimeout(r.timeoutId)})}else for(var d=0;d<t.length;d++)t[d].style.display="none"},setPanoPreviewDomAttribute:function(t,e,a){e.panoId?(t.style.visibility="visible",t.setAttribute("data-thumbnail",e.panoThumbnailUrl),t.setAttribute("data-pid",e.panoId),t.setAttribute("data-pname",e.panoMarker.name),t.setAttribute("data-px",e.panoMarker.px),t.setAttribute("data-py",e.panoMarker.py),t.setAttribute("data-paddr",e.panoMarker.addr),t.setAttribute("data-pheading",e.panoMarker.heading),t.setAttribute("data-pfrom",a)):t.style.visibility="hidden"},addPanoEntranceInInfoWindow:function(t,e,a){var n=this;n.insertPanoInfoInSearch([{mercatorLnglat:e.lng+","+e.lat}],"",function(e){if(e&&e.length>0){var i=n.addPanoThumbnailsInInfoWnd([t],[e[0]],e,"contextMenu",!0);a(i)}else a([t])})},addPanoThumbnailsInInfoWnd:function(t,e,a,n){var i,o,r=null,d=this;switch(n){case"contextMenu":case"busline":thumbnailProperty={size:{width:323,height:101},position:"top",fovx:250,margin:"10px 10px 0 10px"};break;case"bus":case"buswalk":case"nav":case"walk":thumbnailProperty={size:{width:240,height:75},position:"middle",elemIndexArr:[0,-1],fovx:250,margin:"6px 0"};break;case"routeaddr":thumbnailProperty={size:{width:258,height:81},position:"middle",elemIndexArr:[1],fovx:250,margin:"0 10px 5px 10px"}}for(i=0,o=t.length;o>i;i++)r=t[i],e[i]&&(r.content=this._getPanoThumbnailHtmlInInfoWnd(r.content,e[i],thumbnailProperty),r.addEventListener("open",function(t){return function(){baidu(".panoInfoBox").on("click",function(){d.enterPanorama(e[t],a,"infownd",n)})}}(i)));return t},_getPanoThumbnailHtmlInInfoWnd:function(t,e,a){function n(t,e,a){var n=document.createElement("div"),i=n.cloneNode();n.innerHTML=e,n=n.childNodes[0],i.innerHTML=t;for(var o=null,o=i,r=0,d=a.length,s=0;d>r;r++)s=a[r],0>s&&(s=o.childNodes.length+s),r!=d-1?o=o.childNodes[s]:o.insertBefore(n,o.childNodes[s]);return i.innerHTML}if(!e||!e.panoId||!e.panoMarker)return t;var i=[],o="",r=a.size.height,d=a.size.width,u=a.fovx,l=a.position;i.push("<div class='panoInfoBox' style='height:"+r+"px;width:"+d+"px; margin:"+a.margin+";' title='"+e.panoMarker.name+"外景' title='查看全景' >");var c="";switch(c=e.panoMarker.poiuid?s.PANO_URL+"/pr/?qt=poiprv&uid="+e.panoMarker.poiuid+"&width="+d+"&height="+r+"&quality=80&fovx="+u+"&udt="+p.UDT_VERSION:s.PANO_URL+"/pr/?qt=prv&panoid="+e.panoId+"&width="+d+"&height="+r+"&quality=80&fovx="+u+"&heading="+e.panoMarker.heading+"&udt="+p.UDT_VERSION,i.push("<img class='pano_thumnail_img' width='"+d+"' height='"+r+"' border='0' alt='"+e.name+"外景' src='"+c+"' onerror='Pano.PanoEntranceUtil.thumbnailNotFound(this, "+d+", "+r+");' />"),i.push("<div class='panoInfoBoxTitleBg' style='width:"+d+"px;'></div><a href='javascript:void(0)' class='panoInfoBoxTitleContent' >进入全景&gt;&gt;</a>"),i.push("</div>"),o=i.join(""),l){case"top":t=o+t;break;case"bottom":t+=o;break;case"middle":t=n(t,o,a.elemIndexArr)}return t},enterPanorama:function(t,e,a,n){addStat(STAT_CODE.STAT_STREETVIEW,{from:a,catalog:n});var i={point:new BMap.Point(t.panoMarker.px,t.panoMarker.py),buslineUid:t.buslineUid,uid:t.uid,panoId:t.panoId,panoType:"street",panoHeading:t.panoMarker.heading,from:n,addr:t.panoMarker.addr,name:t.panoMarker.name,markers:[],panoMarkers:[],hasRouteVideo:t.hasRouteVideo};"routeaddr"===n&&(i.research=!0,i.searchParam={uid:t.uid});for(var o=0,s=e.length;s>o;o++)i.markers.push(e[o].panoMarker);s>2&&i.markers[0].pid==i.markers[1].pid&&(i.markers.splice(1,1),s--),s>2&&i.markers[s-1].pid==i.markers[s-2].pid&&i.markers.splice(s-2,1);for(var o=0,s=i.markers.length;s>o;o++)i.markers[o].pid===i.panoId&&(i.panoMarkers.push(i.markers[o]),!i.panoMarkers[0].poiuid&&i.uid&&(i.panoMarkers[0].poiuid=i.uid));"routeVideo_button"==a&&(i.playRouteVideo=!0),window.__$old?r.showPano(i):d.showPano(i)}};l=baidu.lang.createSingle(l),u.PanoEntranceUtil=l,a.exports=l});
;define("common:widget/ui/PanoInfoUtil/PanoInfoUtil.js",function(o,n,i){function a(o,n,i){t.showPano(o);var a=n.split("|");if(a.length>1){var e={from:a[0],catalog:a[1]};o.poi&&o.poi.poiuid&&(e.uid=o.poi.poiuid),addStat(STAT_CODE.STAT_STREETVIEW,e)}else addStat(STAT_CODE.STAT_STREETVIEW,{item:o.panoType,catalog:n,func:"click",query:i}),"餐馆"==i&&addStat("http://webmap1.map.bdstatic.com/newmap/static/common/pkg/poilistnormal.poi.pano")}var e=(o("common:widget/com/componentManager.js"),o("common:widget/ui/PanoService/PanoService.js")),t=o("common:widget/pano/PanoInterface/PanoInterface.js"),d=(o("common:widget/ui/PanoUtil/PanoUtil.js"),window.Pano=window.Pano||{}),r={show:function(n){var i=baidu.g("panoInfoWindow"),n=n||{},a=n.data;o.async(["common:widget/com/PanoInfoWindow/PanoInfoWindow.js","common:widget/ui/searchInfoWindow/searchInfoWindow.js"],function(o,e){new o({dom:i,cinfo:{uid:a.uid,panoViewIns:n.panoView,direction:a.direction,exitLargeMapMode:!1,searchInfoWindow:e}})}),baidu.dom.show(i),baidu.dom.setStyle(i,"top",a.screenY-57+"px");var e=baidu.dom.getPosition("MapHolder");a.direction?baidu.dom.setStyle(i,"left",a.screenX+e.left-345-11+"px"):baidu.dom.setStyle(i,"left",a.screenX+e.left+11+"px")},close:function(){var o=o||{};o.iw_sugg_0&&(o.iw_sugg_0.disposeSug(),o.iw_sugg_0=null),o.iw_sugg_1&&(o.iw_sugg_1.disposeSug(),o.iw_sugg_1=null),baidu.g("panoInfoWindow").innerHTML="",baidu.setStyle("panoInfoWindow","display","none")},callPano:function(o){o=o||{};var n=this,i=o.uid,t=o.index,r=o.addr,c=o.from,p=o.wd||"",s=function(o){if(0==o.error&&o.content){var n=o.content,e=parseFloat(n.PanoX),s=parseFloat(n.PanoY),u=new BMap.Point(e,s),l=null,f=null;l={addr:r,poiuid:i,index:"undefined"==typeof t?-1:t,x:n.X,y:n.Y,pid:n.PID,px:e,py:s,name:n.name||"",rank:n.Rank||10,catalog:n.Catalog||"",heading:n.Dir,pitch:n.Pitch},f={point:u,panoId:n.PID,panoType:d.PANO_TYPE_STREET,panoHeading:n.Dir,panoPitch:n.Pitch,from:"poi",panoMarkers:[l],poiUid:i},a(f,c,p)}};e.getStreetViewByUid(i,s,n)},callInnerPano:function(o){o=o||{};var n=this,i=o.uid,a=(o.from,o.wd||"",o.isFromMPC||!1,function(o){if(0==o.error&&o.content){var n=o.content;pinfo={panoId:n.IID,panoType:d.PANO_TYPE_INDOOR,poiUid:i},t.showPano({research:!0,panoType:"inter",searchParam:{uid:i,from:"list"}})}});e.getStreetViewByUid(i,a,n)}};d.PanoInfoUtil=r,i.exports=r});
;define("common:widget/ui/place/placeEnter.js",function(e,a,n){var c=e("common:widget/com/componentManager.js"),t=e("common:widget/ui/util/util.js"),r={BD:["餐饮","酒店","超市","KTV","电影院","银行","医院","公交站","停车场","加油站"],placeCaterWd:["中餐馆","西餐厅","日本菜","韩国料理","东南亚菜","快餐","甜点冷饮","火锅"],placeHotelWd:["快捷酒店","星级酒店","旅馆","度假村","五星级","四星级","三星级","招待所","青年旅社"],placeHospitalWd:["中医院","口腔医院","儿童医院","肿瘤医院","妇科医院","眼科医院","骨科医院","妇幼保健院"],placeLifeWd:["电影院","KTV","体育场馆","健身","游泳馆","羽毛球馆","棋牌室","网吧","洗浴","按摩","足疗"],insertHtml:function(e,a,n,c,t,i){var l=r,o="",s="",d=[];switch(e){case 33:o=l.BD,s=i;break;case 13:o=l.placeCaterWd,s="餐饮";break;case 14:o=l.placeHotelWd,s="酒店";break;case 18:o=l.placeLifeWd,s="休闲娱乐";break;case 20:o=l.placeHospitalWd,s="医院";break;default:o=""}if(33==e){d.push('<div tid="placeEntranceBox" class="placeEntranceBox_bd">'),d.push("<h3>在“<span>"+s+"</span>”附近找</h3>");for(var p=0;p<o.length;p++)d.push('<a href="javascript:void(0)" onclick="place.placeEntrance._showPlaceWdLink_NB(this,'+a+", "+n+", "+c+", '"+t+"');return false;\">"+o[p]+"</a>");d.push("</div>")}else{d.push('<div tid="placeEntranceBox" class="placeEntranceBox">'),d.push('<h3>查看更多附近“<a href="javascript:void(0)" onclick="place.placeEntrance._showPlaceWdLink_BD(this,'+a+","+e+');return false;">'+s+"</a>”</h3>");for(var p=0;p<o.length;p++)d.push('<a href="javascript:void(0)" onclick="place.placeEntrance._showPlaceWdLink_BD(this,'+a+", "+e+');return false;">'+o[p]+"</a>");d.push("</div>")}return d.join("")},_showPlaceWdLink_BD:function(e,a,n){var t=e.innerHTML;switch(document.fmwd.word.value=t,n){case 13:addStat(917,{name:t});break;case 14:addStat(918,{name:t});break;case 18:addStat(919,{name:t});break;case 20:addStat(920,{name:t})}c.go("bd&c="+a+"&wd="+encodeURIComponent(t)),window.searchInViewCtrl&&searchInViewCtrl.isOpen&&searchInViewCtrl._container.onclick()},_showPlaceWdLink_NB:function(e,a,n,c,r){var i=2e3;n=1*n,c=1*c,i=1*i;var l=n-i,o=c-i,s=n+i,d=c+i,p="("+l+","+o+";"+s+","+d+")",h=e.innerHTML,u="("+n+","+c+")";map.centerAndZoom(u,16),param={c:a,l:map.zoomLevel,wd:h,nb_x:n,nb_y:c,r:i,b:p,uid:r},t.loadSearchInfo(function(e){e.roundSearchByValue(h,r,"crangeListI",a,null,n,c)}),addStat(915,{name:h})},execGeo:function(e){var a=/([^\|;]*)(?=;)/,n=a.exec(e),c=1*n[0].split(",")[0],t=1*n[0].split(",")[1],r={x:c,y:t};return r}},i=window.place=window.place||{};i.placeEntrance=r,n.exports=r});